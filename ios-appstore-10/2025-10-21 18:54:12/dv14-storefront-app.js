/*
** Copyright Â© 2025 Apple Inc.
** All rights reserved.
*/

its.dv14={},its.p14={},its.k14={},its.App=Class.extend(its.BaseApp,{_logger:its.Logger.named("its.App"),_buyAttemptPageInfo:{},onLaunch:function(e,t){this.fetchRequiredLaunchData(function(){this.continueLaunch(e,t)}.bind(this))},fetchRequiredLaunchData:function(e){var t=!1,n=!1,r=function(){t&&n&&e()}.bind(this);
its.dv14.Util.Client.isAppStore()&&its.sf.Client.isVersion("10.0")?its.dv14.Util.Apps.installedApps(function(){t=!0,r()}):t=!0,its.dv14.Util.Client.isAppStore()&&its.sf.Client.isVersion("10.3")&&itms.getBag()["SF.isPersonalizedMSOEnabled"]?its.dv14.Util.Client.MSO.initialize(function(){n=!0,r()}):n=!0,r()},continueLaunch:function(e,t){var n=e||{};
if(n&&n.url&&!this.isTrustedUrl(n.url))return;if(n&&n.url&&this.isMusicUrl(n)){var r=n.url.replace("https://","music://");
its.sf14.PageController.loadExternalPage({url:r})}t||this._registerForGlobalEvents(),this._logger.debug(["---------- launchDataParam: ",n]),this.handleToneRestorePage(n),its.App.ParentalRequestData=n.parentalRequestData,its.App.StoreSheetData=n.storeSheet,its.App.isGizmoSheet=!1,its.App._windowSize=Class.shallowClone(e.windowSize?e.windowSize:Settings.Screen),n.launchTime&&its.sf14.Metrics.Events.PageRender.isAvailable()&&(its.sf14.Metrics.Events.PageRender.lastInteractionTime=n.launchTime);
if(its.App.StoreSheetData)this.launchInStoreSheet(its.App.StoreSheetData);
else{var i=n.restoreData&&!n.url&&!n.selectedTabId&&!its.dv14.Util.Client.isIBooks()&&!its.dv14.Util.Client.isPodcasts()&&!its.dv14.Util.Client.isVoyager();
i?(its.sf14.Metrics.Events.PageRender.isUpdateInteractionTimeEnabled=!1,its.sf14.History.restoreState()):its.sf14.History.clearHistory();
var s,o,u;
n.url?(s=n.url,its.dv14.Util.Client.isSearchSupported()&&its.dv14.SearchUtil.isSearchUrl(s)?o=its.sf14.PageController.PageTarget.SEARCH:n.url.indexOf("isPurchasedModal=true")>-1?(o=its.sf14.PageController.PageTarget.MODAL,u=!0):o=its.sf14.PageController.PageTarget.TRANSIENT):(o=its.sf14.PageController.PageTarget.targetForId(TabBar.selectedTab.identifier),s=TabBar.selectedTab.rootURL),s=this.specialCaseLaunchUrlModifications(s);
var a=!1;
if(n.initialPageData&&!i){n.initialPageData.isRootDocument=!0;
var f=n.initialPageData.pageData.componentName,l=n.initialPageData.pageTarget;
its.dv14.Util.copyExtRefDataFromDict(n,n.initialPageData);
var c=its.sf14.BaseDocument.renderDocumentWithData(f,n.initialPageData,its.dv14.PageController.getDocumentSize(l));
its.sf14.Util.transferXHRMetricsData(n.metrics,c.componentRepresentation);
var h={document:c,pageTarget:l};
const p=its.sf14.PageController.PageTarget.targetForId(TabBar.selectedTab.identifier);
its.dv14.PageController.shouldShowStopPageForPageTarget(p)?its.dv14.PageController.showStopPage(p):its.property("isStopPageOneEnabled")&&(its.dv14.Util.Client.isIBooks()||its.dv14.Util.Client.isITunes())?its.dv14.PageController.showLegacyStopPage(its.sf14.PageController.PageTarget.targetForId(TabBar.selectedTab.identifier)):its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,h),a=o==l}var d=!1;
if(its.dv14.Util.Client.isSearchSupported()){var v=its.dv14.SearchUtil.isSearchUrl(s)?s:null;
its.dv14.SearchPage.initializeSearchPage();
if(its.isDefinedNonNull(v)){its.dv14.SearchPage.setSearchLaunchUrl(n.url);
var m={url:v};
its.dv14.Util.copyExtRefDataFromDict(n,m),its.dv14.SearchPage.fetchSearch(m,!0),d=!0}}if(!a&&!i&&!d){var g=this._contentIdFromURL(s),y=null;
function b(){g=null;
if(its.string.contains(s,"action=lookup")){var e=its.url.queryParamValue("ids",s);
g=e.split(",")[0],s=null}y={url:s,contentId:g,pageTarget:o,setTabAsSelected:!0,suppresssNavigationBar:o==its.sf14.PageController.PageTarget.SEARCH},its.dv14.Util.copyExtRefDataFromDict(n,y),its.sf.Platform.iPad()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0&&u&&(y.options={type:"overlay"}),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,y)}if(its.dv14.Util.Client.isIBooks()&&this._isStoreURLForiBooks(s)&&g&&g.length>0){var w=its.sf.StorePlatform.ArtworkProfiles.PRODUCT,E=its.sf.StorePlatform.Profiles.PRODUCT_DIRECT_VIEW;
function S(e,t){var r=e[g],i=r.kind,o=its.sf.StorePlatform.calculatedProfile(E,w),u={calculatedProfile:{results:e}};
y={url:s,contentId:g,kind:i,storePlatformData:u},its.dv14.Util.copyExtRefDataFromDict(n,y),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,y)}var x=window.storePlatform||new its.sf.StorePlatform;
x.fetchContent({artworkProfile:w,ids:[g],profile:E,onOKMissingContent:function(){b()},onError:function(){b()},onOKHasAllContent:S})}else b()}}its.App.StoreSheetData&&!t&&(n.app=its.dv14.Util.Client.getAppIdentifierForUrl(its.App.StoreSheetData.url),its.App.StoreSheetRefApp=n.refApp),n.refUrl?(n.type=its.sf14.Metrics.Events.Enter.Type.LINK,sessionStorage.setItem("extRefUrl2",n.refUrl)):t?n.type=its.sf14.Metrics.Events.Enter.Type.TASK_SWITCH:n.type=its.sf14.Metrics.Events.Enter.Type.LAUNCH,its.dv14.Util.Apps.initialize(),t?its.notifications.publish(its.sf14.Events.ON_APP_RESUME,n):(its.notifications.publish(its.sf14.Events.ON_APP_LAUNCH,n),its.dv14.Util.Client.isPodcasts()&&podcasts.presentExplicitRestrictionAlertIfNeededOfType?podcasts.presentExplicitRestrictionAlertIfNeededOfType("onLaunch",function(){}):itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onLaunch",function(){})),its.sf14.Metrics.Events.PageRender.isUpdateInteractionTimeEnabled=!0,App.launchComplete&&App.launchComplete({jsResourcesStartTime:n.jsResourcesStartTime,jsResourcesEndTime:n.jsResourcesEndTime,initialTabMetrics:n.metrics})},onExit:function(){this._logger.debug("onExit()"),itms.flushUnreportedEvents&&itms.flushUnreportedEvents()},onResume:function(e){this._logger.debug("----------------- App Resume ------------------"),its.App.IsSuspended=!1,e=e||{},e.url||e.storeSheet||e.parentalRequestData?this.onLaunch(e,!0):(e.type=its.sf14.Metrics.Events.Enter.Type.TASK_SWITCH,its.notifications.publish(its.sf14.Events.ON_APP_RESUME,e)),its.dv14.Util.Apps.initialize()},onSuspend:function(){its.App.IsSuspended=!0;
var e=getActiveDocument();
e&&e.onDisappear&&e.onDisappear(),its.notifications.publish(its.sf14.Events.ON_APP_EXIT),itms.flushUnreportedEvents&&itms.flushUnreportedEvents(),its.dv14.Util.Client.isVoyager()&&TabBar.selectedTab&&TabBar.selectedTab.navigationDocument&&TabBar.selectedTab.navigationDocument.documents.length>1&&TabBar.selectedTab.navigationDocument.popToRootDocument()},onError:function(e){this._logger.error([e]),its.Template.resetAllCachedTemplates()},launchInStoreSheet:function(e){var t,n={};
e.at&&(n.at=e.at),e.ct&&(n.ct=e.ct),e.pt&&(n.pt=e.pt),e.adId&&(n.adId=e.adId),e.advp&&(n.advp=e.advp),e.url&&e.url.indexOf("media=watch")>=0&&(its.App.isGizmoSheet=!0);
if(e.sidePackData){var r=e.sidePackData,i=r.collectionId&&(!its.sf.Platform.iPhone()||r.kind!=its.sf.StorePlatform.Kind.TvEpisode)?r.collectionId:r.id,s=r.kind,o=its.url.appendUrlParameters(r.url,n),u={},a={};
a[r.id]=r,u[its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.LOCKUP,its.sf.StorePlatform.ArtworkProfiles.SWOOSH)]={results:a},its.sf14.Metrics.Events.Page.launchData&&!its.sf14.Metrics.Events.Page.launchData.url&&(its.sf14.Metrics.Events.Page.launchData.url=r.url),t={url:o,contentId:i,kind:s,pageTarget:its.sf14.PageController.PageTarget.MAIN,storePlatformData:u,suppressPersonalizationForPrewarmData:!0}}else{var f=its.sf14.BaseComponent.renderComponentWithData("navigation_bar_with_cancel_button",{}),l=function(r){its.sf14.Metrics.Events.Page.launchData&&!its.sf14.Metrics.Events.Page.launchData.url&&(its.sf14.Metrics.Events.Page.launchData.url=r);
var i=e.its_qt?its.url.appendUrlParameters(r,{its_qt:e.its_qt}):r;
t={url:its.url.appendUrlParameters(i,n),pageTarget:its.sf14.PageController.PageTarget.MAIN,setTabAsSelected:!0,navigationBarElement:f},its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,t)},c=e.i||e.id;
c?this.fetchUrlForContentId(c,l,its.isDefinedNonNull(its.App.ParentalRequestData)):e.url&&l(e.url)}},handleToneRestorePage:function(e){if(e&&e.url)if(e.url.toLowerCase().indexOf("/webobjects/mzcontentlink.woa/wa/link?path=restore-tones-done")>=0){e.url=null;
var t={type:"sheet",url:"https://itunes.apple.com/WebObjects/MZStore.woa/wa/genericPageTemplate?pageComponent=restore_tones_done"};
modal.pushDocument(null,t)}else if(e.url.toLowerCase().indexOf("/webobjects/mzcontentlink.woa/wa/link?path=restore-tones")>=0){e.url=null;
var t={type:"sheet",url:"https://itunes.apple.com/WebObjects/MZStore.woa/wa/genericPageTemplate?pageComponent=restore_tones_page"};
modal.pushDocument(null,t)}},fetchUrlForContentId:function(e,t,n){var r=new its.sf.StorePlatform,i={profile:its.sf.StorePlatform.Profiles.URL,ids:[e],onOKHasAllContent:function(n){t(n[e].url)}};
n&&(i.platform="omni"),r.fetchContent([i])},_registerForGlobalEvents:function(){itms.onBuy=this.onBuy.bind(this),itms.onXEvent=this.onXEvent.bind(this),itms.onLibraryChange=this.onLibraryChange.bind(this),itms.onPageResponse=this.onPageResponse.bind(this),itms.onAccountChange=this.onAccountChange.bind(this),itms.onAppStateChanged=this.onAppStateChanged.bind(this),Device.onNetworkChange=this.onNetworkChange.bind(this),itms.onAppPreviewStateChanged=this.onAppPreviewStateChanged.bind(this),itms.onWindowSizeDidUpdate=this.onWindowSizeDidUpdate.bind(this),itms.onNavigationStackWillPop=this.onNavigationStackWillPop.bind(this),itms.onShowPage=this.onShowPage.bind(this),itms.onVideoSubscriberAccountChanged=this.onVideoSubscriberAccountChanged.bind(this),itms.onCategoryLoadEvent=function(e){this.onShowPage({type:"category",data:e})}.bind(this),itms.onShowSearchPage=function(e){this.onShowPage({type:"search",data:e})}.bind(this),itms.onRentalInformationChange=this.onRentalInformationChange.bind(this),App.onError=this.onError.bind(this)},onXEvent:function(e){if(e.sidePackData){var t=e.sidePackData,n=t.collectionId&&(!its.sf.Platform.iPhone()||t.kind!=its.sf.StorePlatform.Kind.TvEpisode)?t.collectionId:t.id,r=t.kind,i=t.url,s={},o={};
o[t.id]=t,s[its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.LOCKUP,its.sf.StorePlatform.ArtworkProfiles.SWOOSH)]={results:o};
var u={url:i,contentId:n,kind:r,storePlatformData:s,suppressPersonalizationForPrewarmData:!0,isProductPage:n&&r};
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,u)}else e.type=="goToWishlist"?this._onXEventForWishlist():e.type=="search"?this._onXEventForSearch(e):e.url&&its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:e.url})},onPageResponse:function(e,t){var n=null,r=!1;
try{if(App.sendDocumentMessage){var i=Date.now();
n=JSON.parse(t.responseText),App.sendDocumentMessage(e,"skui.metrics.reportPlatformJsonParsingTimes",{jsonParseStartTime:i,jsonParseEndTime:Date.now()})}else n=JSON.parse(t.responseText)}catch(s){r=!0}if(!n){try{n=its.sf.PlistXMLToJSONUtil.parseXmlString(t.responseText)}catch(s){n={}}r=!0}its.notifications.publishToSender(its.sf14.Events.PAGE_RESPONSE,{callerDocument:e,json:n,response:t,error:r},e)},onLibraryChange:function(e){its.notifications.publish(its.sf14.Events.LIBRARY_CHANGE,e)},onAccountChange:function(){its.notifications.publish(its.sf14.Events.ACCOUNT_CHANGE,{accountInfo:itms.accountInfo})},onNetworkChange:function(){its.notifications.publish(its.sf14.Events.NETWORK_CHANGE,{networkConnectionType:itms.networkConnectionType})},onAppStateChanged:function(e){its.notifications.publish(its.sf14.Events.APPS_INSTALLED_CHANGE,e)},onAppPreviewStateChanged:function(e){its.notifications.publish(its.sf14.Events.APP_PREVIEW_CHANGE,e)},onWindowSizeDidUpdate:function(e){var t=e.width!=its.App._windowSize.width||e.height!=its.App._windowSize.height;
its.App._windowSize=Class.shallowClone(e),t&&its.notifications.publish(its.sf14.Events.WINDOW_SIZE_CHANGED,e)},windowSize:function(){return Class.shallowClone(its.App._windowSize)},onNavigationStackWillPop:function(e){its.notifications.publish(its.sf14.Events.NAVIGATION_WILL_POP,e)},onShowPage:function(e){its.notifications.publish(its.sf14.Events.NATIVE_PAGE_TRANSITION,e)},onVideoSubscriberAccountChanged:function(e){its.dv14.Util.Client.MSO.refresh()},onRentalInformationChange:function(e){console.log("onRentalInformationChange Received"),its.notifications.publish(its.sf14.Events.RENTAL_INFO_CHANGED,e)},isAppPreview:function(){return its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0?itms.isAppPreview:!1},specialCaseLaunchUrlModifications:function(e){var t=e;
return e==="https://?action=passbook"&&(t=itms.getBag().passbook),its.dv14.SearchUtil.isSearchUrl(e)&&its.string.contains(e,"term=")&&(t=its.url.appendUrlParameter(e,"clientApplication",its.dv14.Util.Client.getClientApplication())),t},isTrustedUrl:function(e){var t=e.match(/^https?:\/\/(?:[^@\n]+@)?([^\/:?#]+)/)[1],n=itms.getBag().trustedDomains,r=!1;
for(i=0,len=n.length;
i<len;
i++){var s=n[i].replace("*","");
if(s.match(/^\./)&&this.endsWith(t,s)){r=!0;
break}if(t==s){r=!0;
break}}return r},isMusicUrl:function(e){var t=e.url,n=e.refApp;
if(n==="com.apple.Music")return!1;
var r=t.split("#")[0].split("?")[0].split("/").slice(3)[0]||"",i=r.match(/^festival|^beats1$|^carrier$|^connect$|^curator$|^foryou$|^music$|^mymusic$|^new$|^playlist$|^post$|^subscribe$/),s=its.string.compareNumerically(its.sf.Client.version(),"8.4")>=0;
return i&&s},endsWith:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},onBuy:function(e){e.result?(its.App.StoreSheetData&&(its.App.StoreSheetData.purchaseHappened=!0),this._onBuySuccess(e)):e.options&&e.options.isNotifyMeContent&&e.metrics&&e.metrics.dialogId=="MZCommerce.Sprite.NotifyMe.Success"?its.notifications.publish(its.sf14.Events.NOTIFY_ME_SUCCESS,{product:e.options}):this._onBuyFailure(e)},_onBuySuccess:function(e){var t=null,n=null;
e.options&&(t=e.options.clientBuyId,n=e.options.pageInfo),t||(t=e.metrics?e.metrics.clientBuyId:null),t&&(n||(n=this._buyAttemptPageInfo[t],e.metrics.detoured=!0),delete this._buyAttemptPageInfo[t]),its.notifications.publish(its.sf14.Events.BUY_DID_COMPLETE,{pageInfo:n,metrics:e.metrics,product:e.options})},_onBuyFailure:function(e){var t=e.options?e.options.clientBuyId:null;
t&&(this._buyAttemptPageInfo[t]=e.options.pageInfo),e.error==1?(its.notifications.publish(its.sf14.Events.BUY_REQUIRES_PERMISSION,e),its.notifications.publishToTarget(its.sf14.Events.BUY_REQUIRES_PERMISSION,e,e.options.id)):this._logger.debug(["---------- _onBuyFailure: Buy failed for ",JSON.stringify(e)])},_onXEventForSearch:function(e){var t=e.url,n="src",r=its.url.queryParamValue(n,t),i=its.dv14.SearchUtil.searchUrlForTerm(e.term);
i=its.url.appendUrlParameter(i,n,r),its.dv14.SearchPage.initializeSearchPage(),its.dv14.SearchPage.fetchSearch({url:i},!0),its.notifications.publish(its.dv14.SearchField.Events.TERM_CHANGED,e)},_onXEventForWishlist:function(){const e={url:its.serverData.constants.viewGlobalLists,options:{},pageTarget:its.sf14.PageController.PageTarget.MODAL};
e.navigationBarElement=its.sf14.BaseComponent.renderComponentWithData("navigation_bar_with_done_button",{}),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,e)},_isStoreURLForiBooks:function(e){if(e){var t=e.split("/"),n=e.indexOf("://")>-1?t[2]:t[0];
n=n.split(":")[0],n=n.split("?")[0];
if(n&&n.length>0){var r=itms.getBag();
if(r&&r["p2-launch-ebookstore-host-patterns"]){var i=r["p2-launch-ebookstore-host-patterns"];
for(var s=0;
s<i.length;
s++){var o=n.match(i[s]);
if(o)return!0}}n=n.toLowerCase();
if(n==="itunes.apple.com"||n==="geo.itunes.apple.com"||n==="buy.itunes.apple.com")return!0}}return!1},_contentIdFromURL:function(e){if(e){var t=e.split("/").reverse()[0].match(/id([\d]+)/);
return t?t[1]:null}return null},reload:function(){for(var e=0;
e<TabBar.tabs.length;
e++)TabBar.tabs[e].navigationDocument.popToRootDocument(),TabBar.tabs[e].navigationDocument.popDocument();
App.onLaunch()},onRevNumChanged:function(e){this._logger.debug(["onRevNumChanged(): ",e]),App.reload({when:"onResume"})}}),its.dv14.PageController=Class.extend(its.sf14.PageController,{loadExternalPage:function(e){if(!its.dv14.Util.Client.isITunesU()&&!its.dv14.Util.Apps.hasITunesU&&(e.kind==its.sf.StorePlatform.Kind.Course||e.isiTunesU)){var t=its.loc("DV6.SecondPartyAppRequiredDialog.Title.iTunesU"),n=its.loc("DV6.SecondPartyAppRequiredDialog.Body.iTunesU"),r=its.loc("Cancel"),i=its.loc("DV6.SecondPartyAppRequiredDialog.ViewButton.iTunesU");
its.sf14.DialogDocument.showDialog(t,n,i,function(){openURL(its.serverData.constants.iTunesUAppUrl)},r,function(){})}else{its.sf14.Metrics.Events.Exit.setDestinationUrl(e.url);
if(its.App.StoreSheetRefApp){var s=its.url.appendUrlParameters(e.url,{SKUIServiceRefApp:its.App.StoreSheetRefApp});
openURL(s)}else openURL(e.url)}},showLegacyStopPage:function(e){var t=this.tabForPageTarget(e);
if(!t.navigationDocument)return;var n=its.sf14.BaseDocument.renderDocumentWithData("error_page",{title:its.dv14.Util.Client.isIBooks()?its.loc("SF.StopPage.Books"):its.loc("SF.StopPage.Movies"),type:"stop",message:its.dv14.Util.Client.isIBooks()?its.loc("SF.StopPage.BooksUnavailable"):its.loc("SF.StopPage.MoviesUnavailable"),hideSearch:!0,hideGlobalList:!0},its.dv14.PageController.getDocumentSize(e));
t.navigationDocument.clear(),its.sf.Metrics.setTargetInfo(t,t.identifier,"tab",its.sf.Metrics.ActionType.STOP,null,"displayedStopPage"),this.pushDocument(n,{pageTarget:e},!1)},shouldShowStopPageForPageTarget:function(e){const t=itms.getBag()["itunes-stop-pages"]||{};
var n=this.tabForPageTarget(e);
const r=n.navigationDocument,i=r&&r.showStopPageForTab;
if(!i)return!1;
const s=its.isDefinedNonNull(r.isStopPageBagValueOverrideEnabledForTab)&&r.isStopPageBagValueOverrideEnabledForTab(e);
if(s)return!0;
const o=its.isDefinedNonNull(r.isStopPageEnabledForTab),u=o&&r.isStopPageEnabledForTab(e);
return(!o||u)&&t[e]?!0:!1},showStopPage:function(e){if(!this.shouldShowStopPageForPageTarget(e))return;var t=this.tabForPageTarget(e);
if(!t.navigationDocument)return;const n={tv:"1174078549",movies:"1174078549"},r={tv:"ATV.Videos.StopPage.TVShow.Title",movies:"ATV.Videos.StopPage.Movies.Title"},i={tv:"ATV.Videos.StopPage.TVShow.Subtitle",movies:"ATV.Videos.StopPage.Movies.Subtitle"},s=r[e],o=i[e],u=its.isDefinedNonNull(s)?its.loc(s):null,a=its.isDefinedNonNull(o)?its.loc(o):null;
t.navigationDocument.showStopPageForTab(e,n[e],u,a,undefined,undefined,undefined,undefined,undefined,!0),its.sf.Metrics.setTargetInfo(t,t.identifier,"tab",its.sf.Metrics.ActionType.STOP,null,"displayedStopPage")},getDocumentSize:function(e,t,n,r){var i=n;
if(!i){var s={pageTarget:r&&its.sf.Platform.iPad()?its.sf14.PageController.PageTarget.MODAL:e,target:t};
i=this.navigationDocumentForPageTarget(s)}var o;
return its.sf.Client.isVersion("10.0")?i&&its.isDefinedNonNull(itms.documentSizeForNavigationDocument)?o=itms.documentSizeForNavigationDocument(i):o=its.App.windowSize():o=Settings.Screen,o},_shouldShowPodcastsMedusaError:function(){var e=its.sf.Client.isVersion("10.0"),t=its.dv14.Util.UI.isMedusa(),n=its.sf.Platform.iPad(),r=its.dv14.Util.Client.isPodcasts();
return!e&&t&&r&&n},loadPage:function(e){var t=e.pageTarget,n=this.tabForPageTarget(t),r=its.dv14.Util.Client.isPodcasts(),i=its.dv14.Util.Client.isAppStore(),s=its.sf.Client.isVersion("10.0"),o=its.sf.Client.isVersion("11.0"),u=its.dv14.Util.UI.isMedusa(),a=its.sf14.Util.isAppStoreStoryUrl(e.url),f=its.sf14.Util.isAppStoreTodayUrl(e.url);
!s&&r&&(this._isMedusa=u);
if(this._shouldShowPodcastsMedusaError()){n.navigationDocument.clear();
var l=its.sf14.BaseDocument.renderDocumentWithData("error_page",{explanation:its.loc("DV14.Podcasts.StoreAvailableInFullScreen"),type:"podcast",hideSearch:!0},its.dv14.PageController.getDocumentSize(t));
this.pushDocument(l,e,!1)}else if(t==its.dv14.PageController.PageTarget.SEARCH)its.App.SearchDocument||its.dv14.SearchPage.initialize(),its.dv14.SearchPage.showSearchPage();
else if(i&&!o&&(a||f)){var c=a?"DV14.NotSupportedPage.ClientIsUnsupported.Description.Story":"DV.NotSupportedPage.iOS.Required.Description",h=its.sf14.BaseDocument.renderDocumentWithData("error_page",{title:its.loc("App Store"),message:its.loc("DV14.NotSupportedPage.ClientIsUnsupported.Title"),explanation:its.loc(c),img:{url:its.serverData.constants.resourceBaseUrl+"/images/settings_icon@"+Device.pixelRatio+"x.png",width:111,height:111},externalLink:{title:its.loc("DV14.NotSupportedPage.ClientIsUnsupported.GetIOS"),url:"prefs:root=General&path=SOFTWARE_UPDATE_LINK"},hideSearch:!0},its.dv14.PageController.getDocumentSize(t));
delete e.url,this.pushDocument(h,e,!1)}else this.loadPageBase(e)},pushDocument:function(e,t,n){if(this.handleSpecialCaseBridgeDocument(t))return;if(its.dv14.Util.Client.isVoyager()&&t.pageTarget==its.sf14.PageController.PageTarget.TRANSIENT&&!t.isSearchDocument){var r=TabBar.tabs&&TabBar.tabs.length?TabBar.tabs[0].identifier:null;
if(r){var i=this.tabForPageTarget(r);
TabBar.selectedTab=i;
var s=i.navigationDocument,o=s.documents.length==0;
o?this.loadPage({url:i.rootURL,pageTarget:r,navigationTitle:its.loc("DV14.IMessageApps.Title"),options:{animated:!1}}):s.popToRootDocument();
var u=t.url?{url:t.url}:{};
its.sf.Platform.iPad()&&s.clear();
var a=!1,f=its.url.baseUrl(t.url),l=its.url.baseUrl(i.rootURL);
if(f==l){a=!0;
var c=its.url.queryParamsDict(t.url),h=its.url.queryParamsDict(t.url);
for(var p in h)if(p!="app"&&p!="ls"){a=c[p]==h[p];
if(!a)break}}a||s.pushDocument(e,u)}}else{t.setTabAsSelected&&(TabBar.selectedTab=this.tabForPageTarget(t.pageTarget),TabBar.selectedTab.identifier==its.sf14.PageController.PageTarget.TRANSIENT&&t.pageTarget!=its.sf14.PageController.PageTarget.TRANSIENT&&setTimeout(function(){TabBar.selectedTab=this.tabForPageTarget(t.pageTarget)}.bind(this),1));
var d=this.navigationDocumentForPageTarget(t),u={},v=!1;
n?its.sf.Platform.iPad()&&(u={sourceElement:t.target,type:"overlay"},d=this.navigationDocumentForPageTarget({pageTarget:its.sf14.PageController.PageTarget.MODAL}),v=!0):u=t.url?{url:t.url}:{},u=Class.extend(u,t.options),t.shouldClearModal!=0&&modal.clear();
var m=its.sf.Platform.isIPhone4ScreenSize()||its.sf.Platform.isIPhone5ScreenSize(),g=t.url&&t.url.indexOf("isPurchasedModal")>-1&&t.kind==="tvEpisode",y=m&&g&&modal&&modal.documents&&modal.documents.length;
y?modal.pushDocument(e,u):(v&&its.dv14.Util.Client.isIBooks()&&its.sf.Client.isVersion("11.0")&&d.clear(),d.pushDocument(e,u))}},handleSpecialCaseBridgeDocument:function(e){var t=!1;
if(its.dv14.Util.Client.isBridge()&&!its.App.StoreSheetData)if(e&&e.pageTarget=="explore"){var n=its.property("DV14.Gizmo.exploreTabShowsVideos")||!1;
if(n){var r=its.sf14.BaseDocument.renderDocumentWithData("watch_video_page",null),i=this.navigationDocumentForPageTarget(e);
i.pushDocument(r,{}),t=!0}}else{var s=e.url&&e.url.indexOf("bwc=1")>0||sessionStorage&&sessionStorage.getItem("bwc");
if(!s){var o=its.property("DV14.Gizmo.currentLaunchState")||0,u=PairedDeviceRegistry&&PairedDeviceRegistry.numberOfPairedDevices>0;
if(!u&&o>=1){var a=its.sf14.BaseDocument.renderDocumentWithData("curtain_page",null),i=this.navigationDocumentForPageTarget(e);
i.pushDocument(a,{}),sessionStorage.setItem("curtainShown","1"),t=!0}}else sessionStorage.setItem("bwc","1")}return t},insertDocumentAtRoot:function(e,t,n){t.setTabAsSelected&&(TabBar.selectedTab=this.tabForPageTarget(t.pageTarget),TabBar.selectedTab.identifier==its.sf14.PageController.PageTarget.TRANSIENT&&t.pageTarget!=its.sf14.PageController.PageTarget.TRANSIENT&&setTimeout(function(){TabBar.selectedTab=this.tabForPageTarget(t.pageTarget)}.bind(this),1));
var r=this.navigationDocumentForPageTarget(t),i={};
n?its.sf.Platform.iPad()&&(i={sourceElement:t.target,type:"overlay"},r=this.navigationDocumentForPageTarget({pageTarget:its.sf14.PageController.PageTarget.MODAL})):i=t.url?{url:t.url}:{},i=Class.extend(i,t.options),r&&r.insertBeforeDocument&&(r.documents.length>0?r.insertBeforeDocument(e,r.documents[0],i):r.pushDocument(e,i))},loadProductPage:function(e){if(its.sf.Platform.device()){var t=its.sf14.Util.shouldOpenProductInStoreSheet(e.kind);
t&&(e.pageTarget=its.sf14.PageController.PageTarget.MODAL);
var n=its.dv14.PageController.getDocumentSize(e.pageTarget,e.target,null,!t),r=its.sf14.ProductPage.renderProductPage(e,n);
if(!r){var i={text:its.sf14.Util.UI.loadingText(),url:e.url};
its.dv14.Util.copyExtRefDataFromDict(e,i),e.options||(e.options={}),e.options.url=e.url,r=its.sf14.BaseDocument.renderDocumentWithData("loading_document",i,n)}e.shouldClearModal=!1,t?this.loadPageInStoreSheet(r,e):this.pushDocument(r,e,!0)}},loadPageInStoreSheet:function(e,t){var n={animated:!0,type:its.sf.Platform.iPad()?"overlay":"sheet",overlayType:its.sf.Platform.iPad()?"external":null};
t.options=Class.extend(n,t.options),this.pushDocument(e,t)},loadTab:function(e,t){var n=this.tabForPageTarget(e);
if(n.identifier==="categories")return;var r=its.dv14.Util.Client.isPodcasts(),i=its.sf.Client.isVersion("10.0"),s=r&&e===its.sf14.PageController.PageTarget.SEARCH;
if(its.property("isStopPageOneEnabled")){if(its.dv14.Util.Client.isIBooks()&&n.identifier!=="library"){this.showLegacyStopPage(e);
return}if(its.dv14.Util.Client.isITunes()){this.showLegacyStopPage(e);
return}}if(this.shouldShowStopPageForPageTarget(e)){this.showStopPage(e);
return}r&&(this._isMedusa=!i&&its.dv14.Util.UI.isMedusa());
if(n.navigationDocument&&n.navigationDocument.documents){if(n.navigationDocument.documents.length==1){(n.navigationDocument.documents[0]&&n.navigationDocument.documents[0].isErrorDocument||this._isMedusa||s&&t)&&n.navigationDocument.clear();
if(its.dv14.Util.Client.isBridge()&&n.identifier=="app_store"){var o=PairedDeviceRegistry&&PairedDeviceRegistry.numberOfPairedDevices>0;
o&&sessionStorage&&sessionStorage.getItem("curtainShown")&&(n.navigationDocument.clear(),sessionStorage.removeItem("curtainShown"))}}n.navigationDocument.documents.length>=1&&its.dv14.Util.Client.isIBooks()&&e==its.sf14.PageController.PageTarget.PURCHASED&&its.string.compareNumerically(its.sf.Client.version(),"9.3")>=0&&n.navigationDocument.clear(),e!=its.sf14.PageController.TRANSIENT&&its.sf14.History.setActiveStackId(n.identifier);
if(n.navigationDocument.documents.length==0){var u={pageTarget:e};
if(this._shouldShowPodcastsMedusaError()){n.navigationDocument.clear();
var a=its.sf14.BaseDocument.renderDocumentWithData("error_page",{explanation:its.loc("DV14.Podcasts.StoreAvailableInFullScreen"),type:"podcast",hideSearch:!0},its.dv14.PageController.getDocumentSize(e));
this.pushDocument(a,u,!1)}else if(s)u.contentId=e,its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,u);
else if(n.rootURL){u.url=n.rootURL,u.suppresssNavigationBar=e==its.sf14.PageController.PageTarget.PURCHASED;
if(its.dv14.Util.Client.isIBooks()&&e==its.sf14.PageController.PageTarget.PURCHASED){if(its.sf14.PageController.hasLoadedPurchases&&its.string.compareNumerically(its.sf.Client.version(),"9.3")==-1)return;its.sf14.PageController.hasLoadedPurchases=!0}its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,u)}}}},navigationDocumentForPageTarget:function(e){var t,n=e.pageTarget;
n==its.sf14.PageController.PageTarget.MODAL?t=modal:n==its.sf14.PageController.PageTarget.DOCUMENT&&(e.target?t=e.target.ownerDocument.navigationDocument:this._logger.debug(["---------- navigationDocumentForPageTarget: eventData.target is needed when using its.sf14.PageController.PageTarget.DOCUMENT"]));
if(!t){var r=this.tabForPageTarget(n);
r&&(t=r.navigationDocument)}return t},tabForPageTarget:function(e){var t=null;
if(e==its.sf14.PageController.PageTarget.TRANSIENT)t=TabBar.transientTab,t.navigationDocument.clear();
else for(var n=0;
n<TabBar.tabs.length;
n++){var r=TabBar.tabs[n];
if(r.identifier==e){t=r;
break}}return t||(t=TabBar.selectedTab),t=its.isDefinedNonNull(t.navigationDocument)?t:TabBar.transientTab,t},reportClickEventOnTabSelect:function(){var e=its.App.CurrentActiveDocumentPageInfoForMetrics,t=e?e:{metricsBase:{}},n=-1,r;
for(var i=0;
i<TabBar.tabs.length;
i++){r=TabBar.tabs[i];
if(r.identifier==TabBar.selectedTab.identifier){n=i;
break}}var s=[{locationPosition:n,locationType:"tab"},{locationPosition:0,locationType:"tabBar"}],o=its.string.capitalizeString(TabBar.selectedTab.identifier);
its.sf.Metrics.setTargetInfo(TabBar.selectedTab,o,"tab",its.sf.Metrics.ActionType.SELECT,TabBar.selectedTab.rootURL),its.notifications.publish(its.sf14.Events.SELECT,{pageInfo:t,target:TabBar.selectedTab,location:s}),its.App.CurrentActiveDocumentPageInfoForMetrics=null},showProductViewForContentId:function(e,t,n){function s(n,s){var o=n[e],u=o.url,a=o.kind,f=its.sf.StorePlatform.calculatedProfile(i,r),l={};
l[f]={results:n},its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:u,contentId:e,kind:a,storePlatformData:l}),t(n,s)}var r=its.sf.StorePlatform.ArtworkProfiles.PRODUCT,i=its.sf.StorePlatform.Profiles.PRODUCT_DIRECT_VIEW;
t=typeof t=="function"?t:function(){},n=typeof n=="function"?n:function(){};
var o=window.storePlatform||new its.sf.StorePlatform;
o.fetchContent({artworkProfile:r,ids:[e],profile:i,onError:n,onOKHasAllContent:s})},showUrl:function(e,t,n){var r=e.indexOf("/WebObjects/MZStore.woa/wa/")!==-1||e.indexOf("/collection/")!==-1;
t=typeof t=="function"?t:function(){},n=typeof n=="function"?n:function(){};
if(r)its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:e}),t();
else{var i=e.split("/").reverse()[0].match(/id([\d]+)/);
if(i){var s=i[1];
s&&this.showProductViewForContentId(s,t,n)}}}}),window.openLocation=function(e,t){var n=null;
t&&(n=its.sf14.PageController.PageTarget.targetForId(targetIdentifier)),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:e,pageTarget:n})},its.notifications.subscribe(its.sf14.Events.ON_APP_LAUNCH,function(){TabBar.onSelect=function(e){its.BaseApp.CONSECUTIVE_TAB_SELECTS.tab==TabBar.selectedTab.identifier?its.BaseApp.CONSECUTIVE_TAB_SELECTS.count++:(its.BaseApp.CONSECUTIVE_TAB_SELECTS.tab=TabBar.selectedTab.identifier,its.BaseApp.CONSECUTIVE_TAB_SELECTS.count=1),its.BaseApp.CONSECUTIVE_TAB_SELECTS.count==10&&(localStorage.clear(),App.reload({when:"now"})),(!its.isDefinedNonNull(e)||e)&&its.dv14.PageController.reportClickEventOnTabSelect();
var t=its.sf14.PageController.PageTarget.targetForId(TabBar.selectedTab.identifier);
its.dv14.PageController.loadTab(t)},TabBar.selectedTab&&TabBar.selectedTab.identifier!==its.sf14.PageController.PageTarget.TRANSIENT&&TabBar.onSelect(!1)}),its.notifications.subscribe(its.sf14.Events.WINDOW_SIZE_CHANGED,function(){var e=its.sf.Client.isVersion("10.0"),t=its.dv14.Util.Client.isPodcasts(),n=TabBar.selectedTab&&TabBar.selectedTab.identifier===its.sf14.PageController.PageTarget.SEARCH,r=its.dv14.Util.UI.isWindowCompact();
typeof this._isCompact=="undefined"&&(this._isCompact=r);
var i=this._isCompact!=r;
this._isCompact=r,e&&t&&n&&i&&its.dv14.PageController.loadTab.call(its.dv14.PageController,TabBar.selectedTab.identifier,i)}),its.sf14.PageController.PageTarget=Class.extend(its.sf14.PageController.PageTarget,{targetForId:function(e){var t;
for(var n in this){var r=this[n];
if(e==r){t=r;
break}}if(!t)for(var i=0;
i<TabBar.tabs.length;
i++){var s=TabBar.tabs[i];
if(e==s.identifier){t=s.identifier;
break}}return t},AUDIOBOOKS:"audioBooks",CHARTS:"charts",DOCUMENT:"document",DOWNLOADS:"downloads",CATEGORIES:"categories",EXPLORE:"explore",FEATURED:"featured",GENIUS:"genius",MAIN:"main",MODAL:"modal",MOVIES:"movies",MUSIC:"music",NEAR_ME:"nearme",NY_TIMES:"nytimes",PURCHASED:"purchased",SEARCH:"search",TRANSIENT:"transient",TV:"tv",TONES:"tones",TOP_AUTHORS:"authors",TOP_CHARTS:"topcharts",UPDATES:"updates",ITUNESU:"itunesu"}),its.dv14.PageController.Events=its.dv14.PageController.Events||{},its.dv14.PageController.Events.MEDUSA_WIDTH_CHANGED="its.dv14.PageController.Events.MEDUSA_WIDTH_CHANGED",its.notifications.subscribeToSender(its.dv14.PageController.Events.MEDUSA_WIDTH_CHANGED,function(e){if(its.dv14.Util.Client.isPodcasts()&&!its.sf.Client.isVersion("10.0")){var t=its.dv14.PageController,n=its.sf14.PageController.PageTarget,r=TabBar.selectedTab;
e=e===!0,t._isMedusa!==e&&(t._isMedusa=e,r.navigationDocument.clear(),t.loadTab.call(t,n.targetForId(r.identifier)))}},document),its.sf14.PageController.hasLoadedPurchases=!1,function(){var e={album_page:{componentName:"its.dv14.AlbumPage"},album_product_lockup:{componentName:"its.dv14.AlbumProductLockup"},additional_app_types:{componentName:"its.dv14.AdditionalAppTypes"},app_explore_page:{componentName:"its.dv14.AppExplorePage"},apple_pack:{componentName:"its.dv14.ApplePack"},artist_page:{componentName:"its.dv14.ArtistPage"},audiobook_page:{componentName:"its.dv14.AudiobookPage"},audiobook_product_lockup:{componentName:"its.dv14.AudiobookProductLockup"},banner_room_page:{componentName:"its.dv14.BannerRoomPage"},navigation_bar:{componentName:"its.dv14.NavigationBar"},brick_row:{componentName:"its.dv14.BrickRow"},brick:{componentName:"its.dv14.Brick"},button_list_block:{componentName:"its.dv14.ButtonListBlock"},buy_button:{componentName:"its.dv14.BuyButton"},card:{componentName:"its.dv14.Card"},category_lockup:{componentName:"its.dv14.CategoryLockup"},categories_page:{componentName:"its.dv14.CategoriesPage"},category_sheet:{componentName:"its.dv14.CategorySheet"},charity_sheet:{componentName:"its.dv14.CharitySheet"},charts_column:{componentName:"its.dv14.ChartsColumn"},collection_list:{componentName:"its.dv14.CollectionList"},column_list:{componentName:"its.dv14.ColumnList"},course_page:{componentName:"its.dv14.CoursePage"},course_product_lockup:{componentName:"its.dv14.CourseProductLockup"},curtain_page:{componentName:"its.dv14.CurtainPage"},custom_lockup:{componentName:"its.dv14.CustomLockup"},custom_page:{componentName:"its.dv14.CustomPage"},description:{componentName:"its.dv14.Description"},doc_type_lookup_page:{componentName:"its.dv14.DocTypeLookupPage"},ebook_page:{componentName:"its.dv14.EBookPage"},ebook_product_lockup:{componentName:"its.dv14.EBookProductLockup"},editorial_block:{componentName:"its.dv14.EditorialBlock"},editorial_card:{componentName:"its.dv14.EditorialCard"},editorial_product_lockup:{componentName:"its.dv14.EditorialProductLockup"},editorial_item_product_page:{componentName:"its.dv14.UnsupportedProductPage"},error_page:{componentName:"its.dv14.ErrorPage"},extended_navigation_bar:{componentName:"its.dv14.ExtendedNavigationBar"},festival_artist_page_block:{componentName:"its.dv14.FestivalArtistPageBlock"},flowcase:{componentName:"its.dv14.Flowcase"},flowcase_item:{componentName:"its.dv14.FlowcaseItem"},gallery:{componentName:"its.dv14.Gallery"},gift_sheet:{componentName:"its.dv14.GiftSheet"},global_lists_page:{componentName:"its.dv14.GlobalListsPage"},grid:{componentName:"its.dv14.Grid"},grid_block:{componentName:"its.dv14.GridBlock"},grouping_mainstack:{componentName:"its.dv14.GroupingMainStack"},grouping_page:{componentName:"its.dv14.GroupingPage"},info_list:{componentName:"its.dv14.InfoList"},loading_document:{componentName:"its.dv14.LoadingDocument"},mac_app_page:{componentName:"its.dv14.MacAppPage"},media_block:{componentName:"its.dv14.MediaBlock"},mix_page:{componentName:"its.dv14.MixPage"},mix_product_lockup:{componentName:"its.dv14.MixProductLockup"},movie_page:{componentName:"its.dv14.MoviePage"},movie_bundle_page:{componentName:"its.dv14.MovieBundlePage"},movie_product_lockup:{componentName:"its.dv14.MovieProductLockup"},movie_bundle_product_lockup:{componentName:"its.dv14.MovieBundleProductLockup"},multi_room_page:{componentName:"its.dv14.MultiRoomPage"},music_video_page:{componentName:"its.dv14.MusicVideoPage"},music_video_product_lockup:{componentName:"its.dv14.MusicVideoProductLockup"},navigation_bar_with_done_button:{componentName:"its.dv14.NavigationBarWithDoneButton"},navigation_bar_with_cancel_button:{componentName:"its.dv14.NavigationBarWithCancelButton"},nearby_apps_page:{componentName:"its.dv14.NearbyAppsPage"},notify_me_button:{componentName:"its.dv14.NotifyMeButton"},offer:{componentName:"its.dv14.Offer"},personalized_swoosh:{componentName:"its.dv14.PersonalizedSwoosh"},personalized_room_page:{componentName:"its.dv14.PersonalizedRoomPage"},preview_overlay:{componentName:"its.dv14.PreviewOverlay"},pills:{componentName:"its.dv14.Pills"},podcast_page:{componentName:"its.dv14.PodcastPage"},podcast_product_lockup:{componentName:"its.dv14.PodcastProductLockup"},purchases_content_page:{componentName:"its.dv14.PurchasesContentPage"},purchases_artist_based_content_page:{componentName:"its.dv14.PurchasesContentPage.ArtistBased"},purchases_media_type_selector_page:{componentName:"its.dv14.PurchasesMediaTypeSelectorPage"},purchases_media_type_navigator_page:{componentName:"its.dv14.PurchasesMediaTypeNavigatorPage"},purchases_media_type_navigator_page_apps:{componentName:"its.dv14.PurchasesMediaTypeNavigatorPage.Apps"},purchases_lockup:{componentName:"its.dv14.PurchasesLockup"},purchases_page:{componentName:"its.dv14.PurchasesPage"},purchases_playlist:{componentName:"its.dv14.PurchasesPlaylist"},radio_station_lockup:{componentName:"its.dv14.RadioStationLockup"},radio_swoosh:{componentName:"its.dv14.RadioSwoosh"},radio_promo:{componentName:"its.dv14.RadioPromo"},redeem_page:{componentName:"its.dv14.RedeemPage"},rotten_tomatoes_reviews:{componentName:"its.dv14.RottenTomatoesReviews"},row_block:{componentName:"its.dv14.RowBlock"},search_field:{componentName:"its.dv14.SearchField"},redownload_button:{componentName:"its.dv14.RedownloadButton"},search_page:{componentName:"its.dv14.SearchPage"},segmented_page:{componentName:"its.dv14.SegmentedPage"},select:{componentName:"its.dv14.Select"},share_button:{componentName:"its.dv14.ShareButton"},share_sheet:{componentName:"its.dv14.ShareSheet"},shelf_block:{componentName:"its.dv14.ShelfBlock"},small_lockup:{componentName:"its.dv14.SmallLockup"},software_eula_page:{componentName:"its.dv14.SoftwareEulaPage"},software_only_page:{componentName:"its.dv14.SoftwareOnlyPage"},software_page:{componentName:"its.dv14.SoftwarePage"},software_product_lockup:{componentName:"its.dv14.SoftwareProductLockup"},spacer_block:{componentName:"its.dv14.SpacerBlock"},star_histogram:{componentName:"its.dv14.StarHistogram"},styles:{componentName:"its.dv14.Styles"},swoosh:{componentName:"its.dv14.Swoosh"},sample_button:{componentName:"its.dv14.SampleButton"},tabbed_pane:{componentName:"its.dv14.TabbedPane"},thank_you_placard:{componentName:"its.dv14.ThankYouPlacard"},tone_album_product_lockup:{componentName:"its.dv14.ToneAlbumProductLockup"},top_authors_content:{componentName:"its.dv14.TopAuthorsContent"},top_authors_page:{componentName:"its.dv14.TopAuthorsPage"},track:{componentName:"its.dv14.Track"},track_list:{componentName:"its.dv14.TrackList"},trailer_lockup:{componentName:"its.dv14.TrailerLockup"},tv_season_page:{componentName:"its.dv14.TvSeasonPage"},tv_season_product_lockup:{componentName:"its.dv14.TvSeasonProductLockup"},unsupported_product_page:{componentName:"its.dv14.UnsupportedProductPage"},upgrade_device:{componentName:"its.dv14.UpgradeDevice"},user_reviews_container:{componentName:"its.dv14.UserReviewsContainer"},video_playlist:{componentName:"its.dv14.VideoPlaylist"},watch_video_page:{componentName:"its.dv14.WatchVideoPage"}};
its.Components.addComponents(e)}(),its.dv14.BaseDocument=Class.createSubclass("its.dv14.BaseDocument",its.sf14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},_documentRestoreData:function(){if(!this.suppressRestoreData()){var e=this.restoreData();
return e||(e={}),e.stackId=e.stackId?e.stackId:TabBar.selectedTab.identifier,e.url=this._documentUrl,e}return null},onPreview:function(e){this.base(e);
var t=e.target,n=t.getAttribute("data-content-kind"),r=t.getAttribute("data-content-id"),i=t.getAttribute("data-url"),s=this.storePlatform.getCachedDataByProfiles([r],!0);
if(s){var o={};
o.storePlatformData=s,o.kind=n,o.contentId=r,o.url=i,o.isRestored=!0;
var u=its.sf14.ProductPage.renderProductPage(o,its.dv14.PageController.getDocumentSize());
e.previewContainer.previewDocument(u)}}}),its.dv14.LoadingDocument=Class.createSubclass("its.dv14.LoadingDocument",its.sf14.BaseLoadingDocument,{initialize:function(){this.base.apply(this,arguments),this._message=this.lookup("message"),its.sf14.Metrics.Events.PageRender.isAvailable()&&(this._savedPageRequestedTime=its.sf14.Metrics.lastInteractionTime),its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0&&this.subscribe(its.sf14.Events.NAVIGATION_WILL_POP,this._onNavigationWillPop.bind(this))},_onNavigationWillPop:function(){this._savedPageRequestedTime=its.sf14.Metrics.lastInteractionTime},render:function(){if(!this.lookup("suppresssNavigationBar")){this._template.keepBlock("navigationBlock",!0);
var e=this._template.getBlock("navigationBlock"),t;
this.lookup("navigationBarElement")?t=this.lookup("navigationBarElement"):t=this.renderComponentWithData("navigation_bar",{navigationTitle:this.lookup("navigationTitle")}),e.replaceTokenWithElement("navigation",t)}return this.base()},styleData:function(){return{tabId:this.data.pageTarget,url:this.documentUrl()}},onPageResponse:function(e){this._logger.debug("----------------- On Page Response ------------------"),e.error?this.onPageResponseFailure(e.json,e.response,e.callerDocument):this.onPageResponseSuccess(e.json,e.response,e.callerDocument)},onPageResponseSuccess:function(e,t,n){e.url=this.documentUrl();
var r=e.pageData.componentName;
e.isRestored=this.lookup("isRestored");
var i=n.navigationDocument&&n.navigationDocument.documents;
e.isRootDocument=i&&i.length&&i[0]==n,its.dv14.Util.copyExtRefDataFromDict(this.data,e),its.sf14.Metrics.Events.PageRender.isAvailable()&&(e.pageRequestedTime=this._savedPageRequestedTime);
var s=its.dv14.PageController.getDocumentSize(null,n);
a&&its.sf.Platform.iPad()&&!its.sf14.Util.isDocumentOnNavigationDocument(modal,n)&&!its.App.StoreSheetData&&(s=its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
var o;
if(e.pageData.fcKind!="470"&&e.pageData.fcKind!="471"||!its.dv14.Util.Client.isIBooks()){var u=its.sf14.BaseDocument.documentWithData(r,e,s);
u.setXHRMetricsData(t),u.setRefUrl(this.data.refUrl),o=u.renderDocument()}else o=its.sf14.BaseDocument.renderDocumentWithData("error_page",{title:its.loc("Books"),message:its.loc("DV14.NotSupportedPage.ClientIsUnsupported.Title"),explanation:its.loc("DV14.NotSupportedPage.ClientIsUnsupported.Description.Books"),img:{url:its.serverData.constants.resourceBaseUrl+"/images/settings_icon@"+Device.pixelRatio+"x.png",width:111,height:111},externalLink:{title:its.loc("DV14.NotSupportedPage.ClientIsUnsupported.GetIOS"),url:"prefs:root=General&path=SOFTWARE_UPDATE_LINK"},hideSearch:!0},s);
var a=its.sf14.ProductPage.kindForComponent[r];
this._shouldRedirectToTVShowsTabStopPage(e,a)?(TabBar.selectedTab=its.dv14.PageController.tabForPageTarget(its.sf14.PageController.PageTarget.TV),its.dv14.PageController.loadTab(its.sf14.PageController.PageTarget.TV)):this._shouldRedirectToMoviesTabStopPage(e,a)?(TabBar.selectedTab=its.dv14.PageController.tabForPageTarget(its.sf14.PageController.PageTarget.MOVIES),its.dv14.PageController.loadTab(its.sf14.PageController.PageTarget.MOVIES)):a&&its.sf.Platform.iPad()&&!its.sf14.Util.isDocumentOnNavigationDocument(modal,n)&&!its.App.StoreSheetData?(its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:o,pageTarget:its.sf14.PageController.PageTarget.MODAL,options:{type:"overlay"}}),this._renderGroupingForKind(a,n)):(its.sf.Platform.iPad()&&its.dv14.DeepLinkUtil.openFinanceSheetIfPresent(e),n.replace(o)),e.properties&&e.properties.revNum&&its.App.setRevNum(e.properties.revNum,e.properties.timestamp)},onPageResponseFailure:function(e,t){this._logger.debug(["---------- _pageLoadFailure: Page load failed for ",t]);
var n=its.sf14.Util.mediaTypeForUrl(this.documentUrl()),r=n?n.name:null;
its.dv14.PlistUtil.handlePlist(t,e,this.documentUrl(),!0,r)},_renderGroupingForKind:function(e,t){this._documentUrl=TabBar.selectedTab.rootURL;
if(!this._documentUrl){var n=its.sf14.Util.displayableKindForExternalId(e);
if(n)this._documentUrl=its.url.appendUrlParameter(its.serverData.constants.groupingBaseUrl,"mt",n.mtId);
else{var r=TabBar.tabs;
for(var i=0;
i<r.length;
i++)if(r[i].rootURL){this._documentUrl=r[i].rootURL;
break}this._logger.error("its.dv14.LoadingDocument._renderGroupingForKind(): Displayable Kind NOT found for the specified kind: "+e)}}this._documentUrl&&its.sf14.Util.getJSON(this._documentUrl,function(e,n){this.onPageResponseSuccess(e,n,t)}.bind(this),this.onPageResponseFailure.bind(this))},_shouldRedirectToTVShowsTabStopPage:function(e,t){const n=its.dv14.PageController.shouldShowStopPageForPageTarget("tv");
if(!n)return!1;
if(!t||t!==its.sf.StorePlatform.Kind.TvEpisode&&t!==its.sf.StorePlatform.Kind.TvSeason){if(e.pageData.url){const r=e.pageData.url,i=itms.getBag().tabs.standard.find(function(e){return e.url&&e.url.toLowerCase()==r.toLowerCase()});
return i&&i.id=="tv"}return!1}return!0},_shouldRedirectToMoviesTabStopPage:function(e,t){const n=its.dv14.PageController.shouldShowStopPageForPageTarget("movies");
if(!n)return!1;
if(!t||t!==its.sf.StorePlatform.Kind.Movie&&t!==its.sf.StorePlatform.Kind.MovieBundle){if(e.pageData.url){const r=e.pageData.url,i=itms.getBag().tabs.standard.find(function(e){return e.url&&e.url.toLowerCase()==r.toLowerCase()});
return i&&i.id=="movies"}return!1}return!0}}),its.dv14.LoadingDocument.createLoadingDocument=function(e,t,n,r){var i={text:e,url:t,contentId:n,suppresssNavigationBar:r};
return its.sf14.BaseDocument.renderDocumentWithData("loading_document",i)},window.its||(window.its={}),its.sf||(its.sf={}),its.sf.history||(its.sf.history={}),its.sf.history.manager=function(){var e=function(e,t,n){if(its.sf.Platform.isITML())its.sf14.Util.fetchServerPostResponse(e,t,n);
else{var r=!!document.querySelector("body.global-lists")||!!document.querySelector("body .global-lists");
r&&(t.dataOnly=!0),iTSInclude.makeHttpRequest({url:e,formParams:t,failureCallback:function(e){},successCallback:function(e){e.responseText&&n(e.responseText)}})}};
return{doXhr:e}}(),its.sf.history.manager.preview=function(){var e=its.Logger.named("its.sf.history.manager.preview"),t={},n=function(e){if(iTunes.primaryAccount!=null||its.sf.Client.dsId()){var t=its.string.toInt(its.url.queryParamValue("test")),n={ids:[e],action:"add"};
t&&!isNaN(t)&&t>0&&(n.test=t),u(n,function(e){its.notifications.publish(its.sf.history.manager.preview.PREVIEW,its.string.evalJson(e))})}},r=function(e){u({action:"clear"},e)},i=function(e,n){t[e]||(t[e]=o(e,n))},s=function(e,n){clearTimeout(t[e]),delete t[e],t[e]=void 0},o=function(e,t){var r=its.sf.history.manager.preview.HISTORY_RECORD_THRESHOLD_TIME;
return t=="tone"&&(r=0),setTimeout(function(){n(e)},r)},u=function(t,n){if(!t||!t.action){var r=[];
t=t||{};
for(var i in t)r.push(i+": "+t[i]);
e.warn("No 'action' param found. 'formData': {"+r.join(", ")+"}");
return}var s=n?n:function(){};
its.sf.history.manager.doXhr(its.serverData.constants.GlobalLists.updatePreviewHistoryUrl,t,s)};
return{historyEventStart:i,historyEventStop:s,clearHistory:r}}(),its.sf.history.manager.preview.HISTORY_RECORD_THRESHOLD_TIME=5e3,its.sf.history.manager.radio=function(){var e=its.Logger.named("its.sf.history.manager.radio"),t=function(e){n({action:"clear"},e)},n=function(e,t){var n=t?t:function(){};
its.sf.history.manager.doXhr(its.serverData.constants.GlobalLists.updateRadioHistoryUrl,e,n)};
return{clearHistory:t}}(),its.sf.history.manager.SiriTagHistory=function(){var e=function(e){t({action:"clear"},e)},t=function(e,t){var n=t?t:function(){};
its.sf.history.manager.doXhr(its.serverData.constants.GlobalLists.updateSiriTagHistoryUrl,e,n)};
return{clearHistory:e}}(),its.sf.history.manager.Events={PREVIEW:"its.sf.history.manager.Events.PREVIEW"},window.its||(window.its={}),its.sf||(its.sf={}),its.sf.wishlist||(its.sf.wishlist={}),its.sf.wishlist.manager=function(){var e=function(e){var t=its.serverData.constants.GlobalLists.removeFromWishlistUrl,n={ids:Array.isArray(e)?e:[e]},r=function(){its.notifications.publish(its.sf.wishlist.manager.Events.REMOVE_ITEMS,e)};
its.sf.Platform.isITML()?its.sf14.Util.fetchServerPostResponse(t,n,r):iTSInclude.makeHttpRequest({url:t,formParams:n,successCallback:r,failureCallback:r})},t=function(e,t,n,r){var i=its.sf.Client.dsId();
if(!i){r();
return}var s=its.sf14.Util.offerForShareActivity(e,t);
if(!s){n();
return}var o={audiobook:"book","movie-bundle":"movieBundle","music-video":"musicVideo","tv-episode":"tvEpisode","tv-season":"tvSeason"},u=o[e.kind]?o[e.kind]:e.kind,a=its.url.parseQueryParams(s.buyParams,!0);
a.id=e.id,a.dsid=i,a.kind=u,a.wishlistItemName=e.name;
var f=its.serverData.constants.addToWishListBaseUrl,l=function(e){var t={SUCCESS:0,SOME_CONTENT_ALREADY_IN_WISHLIST:1,FAILURE:2,LIST_FULL:3,SOME_CONTENT_ALREADY_OWNED:4,SOME_CONTENT_ALREADY_OWNED_BUT_UNFULFILLED:5,ITEM_IS_FREE:6},r=JSON.parse(e.responseText);
r.status==t.FAILURE&&n(r)};
its.sf.Platform.isITML()?its.sf14.Util.fetchServerPostResponse(f,a,l,r):iTSInclude.makeHttpRequest({url:f,formParams:a,successCallback:l,failureCallback:r})};
return{addItem:t,removeItems:e}}(),its.sf.wishlist.manager.Events={ADD_ITEM:"its.sf.wishlist.manager.Events.ADD_ITEM",REMOVE_ITEMS:"its.sf.wishlist.manager.Events.REMOVE_ITEMS"},its.dv14.BadgeUtil=Class.extend(its.sf.BadgeUtil,{badgeCache:{},createBadge:function(e,t){return e.textOnly?this.createTextOnlyBadge(e,t):this.createResourceBadge(e,t)},createCleanOrExplicitBadge:function(e,t){var n=null;
return its.sf.StorePlatformUtil.ContentRating.isExplicit(e)?n=its.dv14.BadgeUtil.Badges.EXPLICIT:its.sf.StorePlatformUtil.ContentRating.isClean(e)&&(n=its.dv14.BadgeUtil.Badges.CLEAN),n?its.dv14.BadgeUtil.createBadge(n,t):null},createTextOnlyBadge:function(e,t){var n=its.Templates.get("utils/dv14_badge_util/badge_text_only"),r=e.classname||"badge";
return n.replaceToken("badgeClass",r),n.replaceToken("badgeText",e.name),t?n.composeAsElement():n.compose()},createResourceBadge:function(e,t){var n=e.createAsImage?its.Templates.get("utils/dv14_badge_util/badge_as_image"):its.Templates.get("utils/dv14_badge_util/badge"),r=this.getAssetData(e),i=e.classname||"badge";
r.url&&(r.width&&n.replaceToken("badgeWidth",r.width),r.height&&n.replaceToken("badgeHeight",r.height),n.replaceToken("resource",r.url)),n.replaceToken("badgeClass",i);
var s=its.loc(e.key);
return s&&(n.keepBlock("hasAltText"),n.replaceToken("altText",s)),t?n.composeAsElement():n.compose()},createEditorialBadge:function(e,t){var n=its.Templates.get("utils/dv14_badge_util/editorial_badge");
return n.replaceToken("badgeText",e),t?n.composeAsElement():n.compose()},_buildResourcePath:function(e){var t=null;
if(e.name){var n=e.localResourceName;
if(!n){var r=e.system&&e.name.indexOf(e.system)==-1?e.system+" "+e.name.replace("-","").replace(" ",""):e.name;
n=r.toLowerCase().split("-").join("_").split(" ").join("_")}var i="resource://"+n;
if(itms.resourceExists(i))t=i;
else{var s=this.buildImagePath(e);
e.localized&&(s=this._localizePath(s,e.checkStoreForLanguage));
var o=its.frameworks.ImageManifest[s];
its.dv14.BadgeUtil.Manifest[s]&&(o=its.dv14.BadgeUtil.Manifest[s]);
var u=its.serverData.constants.resourceImagePathFrameworks;
t=u+s,o?(this.badgeCache[t]||(this.badgeCache[t]={}),this.badgeCache[t].width=o.width,this.badgeCache[t].height=o.height):this.badgeCache[t]={width:15,height:17}}}return t},_localizePath:function(e,t){var n=its.serverData.constants.languageCode;
n=="en"&&(n="");
if(t&&t.indexOf(n)!==-1)var r=its.serverData.constants.countryCode,i=e.replace(".png","-"+n+"-"+r+".png");
else var i=e.replace(".png","-"+n+".png");
return its.frameworks.ImageManifest[i]?i:e},shouldShowCleanExplicitBadgeForKind:function(e){var t={};
return t[its.sf.StorePlatform.Kind.EBook]=!0,t[its.sf.StorePlatform.Kind.EBookApple]=!0,t[its.sf.StorePlatform.Kind.EBookMeta]=!0,t[its.sf.StorePlatform.Kind.EBookTextbook]=!0,t[its.sf.StorePlatform.Kind.EBookSeries]=!0,!t[e]},getAssetData:function(e){var t=this._buildResourcePath(e),n=null,r=null;
e.dimensions?n=e.dimensions.width:this.badgeCache[t]&&(n=this.badgeCache[t].width),e.dimensions?r=e.dimensions.height:this.badgeCache[t]&&(r=this.badgeCache[t].height);
var i={url:t,width:n,height:r};
return i}}),its.dv14.BadgeUtil.AppRatings={badge:function(e,t){var n=e.systemName,r=e.rating.rank,i=n=="appsBrazil"?"apps_brazil":n;
return its.dv14.BadgeUtil.createBadge({name:i+"_"+r},t)}},its.dv14.BadgeUtil.VideoAgeRating={_logger:its.Logger.named("its.dv14.BadgeUtil.VideoAgeRating"),badge:function(e,t,n){var r=t.system,i=r?r.toLowerCase():"",s=t.name?t.name.toLowerCase():"",o=i=="mpaa"||i=="tv"&&(s=="tv-y"||s=="tv-y7"||s=="tv-y7fv"||s=="tv-g"||s=="tv-pg"||s=="tv-14"||s=="tv-ma"),u=its.sf.BadgeUtil.systems_that_have_new_logos.indexOf(i)>-1,a={classname:"badge-for-video-rating",name:t.name,rank:t.rank,system:t.system,textOnly:!o&&!u,value:t.value};
i=="mpaa"&&s=="unrated"&&(o=itms.resourceExists("resource://mpaa_ur"),a.textOnly=!o,o?a.name="ur":a.name="UNRATED");
if(!t.name){var f=e.product&&e.product.id?e.product.id:"unknown";
this._logger.error("badge() could not find rating name for "+f,null,!0),a.name=""}return!o&&!u&&!its.sf.Platform.isBadgeTextColoringSupported()?(s=a.name.toUpperCase(),its.sf14.ComponentUtil.createText(e,s,{type:its.sf14.ComponentUtil.TextType.DEFAULT,attributes:{"class":"badge-text"}},n)):its.dv14.BadgeUtil.createBadge(a,n)}},its.dv14.BadgeUtil.Badges={HD:{key:"MZAccessibility.tags.hd",name:"HD",classname:"badge"},UHD:{key:"MZAccessibility.tags.4k",localResourceName:"4k",system:"badges",name:"4K",size:"sm",classname:"badge",respectPixelRatio:!0},DOVI:{key:"MZAccessibility.tags.dovi",localResourceName:"dv",system:"badges",name:"DoVi",size:"sm",classname:"badge",respectPixelRatio:!0},HDR:{key:"MZAccessibility.tags.hdr",localResourceName:"hdr",system:"badges",name:"HDR",size:"sm",classname:"badge",respectPixelRatio:!0},DA:{key:"MZAccessibility.tags.da",localResourceName:"da",system:"badges",name:"da",size:"sm",classname:"badge",respectPixelRatio:!0},CC:{key:"MZAccessibility.tags.closedCaptioning",name:"CC",classname:"badge"},EXPLICIT:{key:"MZAccessibility.tags.explicit",name:"Explicit",classname:"badge-explicit"},CLEAN:{key:"MZAccessibility.tags.clean",name:"Clean",classname:"badge-clean"},SDH:{key:"MZAccessibility.tags.SDH",system:"badges",name:"SDH",localResourceName:"sdh",size:"sm",classname:"badge",respectPixelRatio:!0},AD:{key:"MZAccessibility.tags.AudioDescription",system:"badges",name:"AD",localResourceName:"ad",size:"sm",classname:"badge",respectPixelRatio:!0},OFFERS_IMESSAGE_APP:{key:"MZAccessibility.tags.OffersIMessageApp",name:"offers-imessage-app",localResourceName:"offers_imessage_app",classname:"badge secondary-color",system:"badges",respectPixelRatio:!0,dimensions:{height:16,width:17}},OFFERS_WATCH_APP:{key:"MZAccessibility.tags.OffersWatchApp",name:"offers-watch-app",localResourceName:"offers_watch_app",classname:"badge secondary-color",system:"badges",respectPixelRatio:!0,dimensions:{height:16,width:15}},OFFERS_TV_APP:{key:"MZAccessibility.tags.OffersTvApp",name:"offers-tv-app",localResourceName:"offers_tv_app",classname:"badge secondary-color",system:"badges",respectPixelRatio:!0,dimensions:{height:16,width:17}},HELPFUL:{key:"MZAccessibility.tags.Helpful",name:"helpful",localResourceName:"action-thumbsup",classname:"badge",respectPixelRatio:!0,dimensions:{height:28,width:28}},NOT_HELPFUL:{key:"MZAccessibility.tags.NotHelpful",name:"not-helpful",localResourceName:"action-thumbsdown",classname:"badge",respectPixelRatio:!0,dimensions:{height:28,width:28}},REPORT_A_CONCERN:{key:"MZAccessibility.tags.ReportAConcern",name:"report-a-concern",localResourceName:"action-exclamation",classname:"badge",respectPixelRatio:!0,dimensions:{height:28,width:28}},BOOKLET:{name:"booklet",key:"booklet"},ITUNES_EXTRAS:{key:"iTunes Extras",name:"itunes-extras",system:"itunes-extras",localized:!0},BONUS_CONTENT:{key:"Bonus Content",system:"glyphs",name:"bonus-content"},MASTERED_FOR_ITUNES:{key:"Mastered for iTunes",system:"itunes-mastered",name:"itunes-mastered",localized:!0,classname:"badge-bottom-right"},APPLE_DIGITAL_MASTER_STACKED:{key:"Apple Digital Master",system:"apple-digital-master",name:"adm-stacked",localized:!0,checkStoreForLanguage:["zh","pt"],classname:"badge-bottom-right",localResourceName:"adm-stacked",respectPixelRatio:!0},ITUNES_LP:{key:"iTunes LP",system:"itunes-lp",name:"itunes-lp",classname:"badge-bottom-right"},IBOOKS_AUTHOR:{key:"iBooks Author",name:"ibooks-author",system:"ibooks-author",localized:!0,classname:"badge-bottom-right"},MADE_IBOOKS:{key:"Made for iBooks",name:"made-ibooks",system:"made-ibooks",localized:!0,classname:"badge-bottom-right"},PARENTAL_ADVISORY:{key:"Parental Advisory",system:"parental-advisory",name:"parental-advisory",classname:"badge-bottom-right"}},its.dv14.BadgeUtil.Manifest={"content-badging/ibooks-author/ibooks-author.png":{height:44,width:64},"content-badging/made-ibooks/made-ibooks.png":{height:44,width:64},"content-badging/apple-digital-master/adm-stacked.png":{height:30,width:98},"content-badging/apple-digital-master/adm-stacked@2x.png":{height:30,width:98},"content-badging/apple-digital-master/adm-stacked@3x.png":{height:30,width:98},"content-badging/apple-digital-master/adm-stacked-fr.png":{height:30,width:83},"content-badging/apple-digital-master/adm-stacked@2x-fr.png":{height:30,width:83},"content-badging/apple-digital-master/adm-stacked@3x-fr.png":{height:30,width:83},"content-badging/apple-digital-master/adm-stacked-pt-prt.png":{height:30,width:124},"content-badging/apple-digital-master/adm-stacked@2x-pt-prt.png":{height:30,width:124},"content-badging/apple-digital-master/adm-stacked@3x-pt-prt.png":{height:30,width:124},"content-badging/apple-digital-master/adm-stacked-uk.png":{height:30,width:92},"content-badging/apple-digital-master/adm-stacked@2x-uk.png":{height:30,width:92},"content-badging/apple-digital-master/adm-stacked@3x-uk.png":{height:30,width:92},"content-badging/itunes-extras/itunes-extras.png":{height:19,width:21},"content-badging/itunes-extras/itunes-extras-zh.png":{height:19,width:21},"content-badging/itunes-lp/itunes-lp.png":{height:44,width:50},"content-badging/parental-advisory/parental-advisory.png":{height:30,width:43},"content-badging/glyphs/bonus-content.png":{height:11,width:11},"content-badging/video-ratings/bbfc/pg-lg.png":{height:17,width:19},"content-badging/video-ratings/bbfc/pg-lg@2x.png":{height:17,width:19},"content-badging/video-ratings/bbfc/pg-lg@3x.png":{height:17,width:19},"content-badging/video-ratings/bbfc/u-lg.png":{height:17,width:19},"content-badging/video-ratings/bbfc/u-lg@2x.png":{height:17,width:19},"content-badging/video-ratings/bbfc/u-lg@3x.png":{height:17,width:19},"content-badging/badges/sdh-sm.png":{height:11,width:21},"content-badging/badges/sdh-sm@2x.png":{height:11,width:21},"content-badging/badges/sdh-sm@3x.png":{height:11,width:21},"content-badging/badges/ad-sm.png":{height:11,width:19},"content-badging/badges/ad-sm@2x.png":{height:11,width:19},"content-badging/badges/ad-sm@3x.png":{height:11,width:19},"content-badging/badges/4k-sm.png":{height:11,width:19},"content-badging/badges/4k-sm@2x.png":{height:11,width:19},"content-badging/badges/4k-sm@3x.png":{height:11,width:19},"content-badging/badges/dovi-sm.png":{height:11,width:39},"content-badging/badges/dovi-sm@2x.png":{height:11,width:39},"content-badging/badges/dovi-sm@3x.png":{height:11,width:39},"content-badging/badges/hdr-sm.png":{height:11,width:25},"content-badging/badges/hdr-sm@2x.png":{height:11,width:25},"content-badging/badges/hdr-sm@3x.png":{height:11,width:25},"content-badging/badges/offers-imessage-app.png":{height:16,width:17},"content-badging/badges/offers-imessage-app@2x.png":{height:16,width:17},"content-badging/badges/offers-imessage-app@3x.png":{height:16,width:17},"content-badging/badges/offers-watch-app.png":{height:16,width:15},"content-badging/badges/offers-watch-app@2x.png":{height:16,width:15},"content-badging/badges/offers-watch-app@3x.png":{height:16,width:15},"content-badging/badges/offers-tv-app.png":{height:16,width:17},"content-badging/badges/offers-tv-app@2x.png":{height:16,width:17},"content-badging/badges/offers-tv-app@3x.png":{height:16,width:17},"content-badging/badges/action-thumbsup.png":{height:28,width:28},"content-badging/badges/action-thumbsup@2x.png":{height:28,width:28},"content-badging/badges/action-thumbsup@3x.png":{height:28,width:28},"content-badging/badges/action-thumbsdown.png":{height:28,width:28},"content-badging/badges/action-thumbsdown@2x.png":{height:28,width:28},"content-badging/badges/action-thumbsdown@3x.png":{height:28,width:28},"content-badging/badges/action-exclamation.png":{height:28,width:28},"content-badging/badges/action-exclamation@2x.png":{height:28,width:28},"content-badging/badges/action-exclamation@3x.png":{height:28,width:28}},its.dv14.GratisAppUtil={_logger:its.Logger.named("its.dv14.GratisAppUtil"),gratisAppAdamIdsFreeForThisDevice:{},_gratisAppIdsKey:"gratisAppIdsForThisDevice",_launchCount:"gratisLaunchCount",launchGratisAppsSheetIfApplicable:function(){itms.loadGratisContent(its.dv14.GratisAppUtil.cacheGratisAppAdamIdsFreeForThisDevice)},launchApplePack:function(){var e=localStorage.getItem(its.dv14.GratisAppUtil._launchCount);
itms.DSID&&e&&e==="1"?(localStorage.setItem(its.dv14.GratisAppUtil._launchCount,"2"),its.dv14.GratisAppUtil._openGratisSheet()):e||itms.DSID&&localStorage.setItem(its.dv14.GratisAppUtil._launchCount,"1")},cacheGratisAppAdamIdsFreeForThisDevice:function(e){if(e&&e.length>0){var t=e.reduce(function(e,t){return e[t]=!0,e},{});
its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice=t,its.dv14.GratisAppUtil.launchApplePack()}},filterGratisApps:function(e,t){var n=e.reduce(function(e,t){return e[t]=!0,e},{});
return t.filter(function(e){return n[e]?!!its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice[e]:!0})},filterGratisAlreadyOnDevice:function(e,t){var n=function(n){var r=[];
for(var i=0;
i<e.length;
i++){var s=e[i];
n[s]||r.push(s)}t(r)},r=[];
for(var i=0;
i<e.length;
i++)r.push(e[i]);
itms.findLibraryItems(r,n,{kinds:[its.sf.StorePlatform.Kind.MobileApp]})},_openGratisSheet:function(){var e=itms.getBag()["apple-pack-url"],t=function(e){its.dv14.GratisAppUtil.filterGratisAlreadyOnDevice(e.appIds,function(t){if(t.length>0){var n=its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice,r=[];
for(var i=0;
i<t.length;
i++)n[t[i]]&&r.push(t[i]);
if(r.length>0){e.notInstalledIds=r;
var s=its.sf14.BaseDocument.renderDocumentWithData("apple_pack",e,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),o={type:"sheet"};
modal.pushDocument(s,o)}}})};
its.sf14.Util.getJSON(e,t)}},its.dv14.LockupUtil=Class.extend(its.sf14.LockupUtil,{AppArtworkStyle:{WATCH:"watch",VOYAGER:"voyager",TV:"tv",STANDARD:"standard"},getArtworkClassName:function(e,t){return e===its.sf.StorePlatform.Kind.MobileApp?t===its.dv14.LockupUtil.AppArtworkStyle.WATCH?"watch-app-art":t===its.dv14.LockupUtil.AppArtworkStyle.VOYAGER?"voyager-app-art":t===its.dv14.LockupUtil.AppArtworkStyle.TV?"tv-app-art":"app-art":e===its.sf.StorePlatform.Kind.MobileAppBundle?"app-art":e===its.sf.StorePlatform.Kind.RadioStation?"radio-art":its.dv14.Styles.isDarkKind({kind:e})?"dark-art":e===its.sf.StorePlatform.Kind.MacApp?"":e===its.sf.StorePlatform.Kind.Course?"course-art":e==="watch-screenshot"?"watch-screenshot":"light-art"},getAppArtworkStyle:function(e){return its.dv14.Util.Client.isBridge()&&e.isAppleWatchSupported?its.dv14.LockupUtil.AppArtworkStyle.WATCH:its.sf.Client.isVersion("10.0")&&e.hasMessagesExtension&&(its.dv14.Util.Client.isVoyager()||e.isHiddenFromSpringboard)?its.dv14.LockupUtil.AppArtworkStyle.VOYAGER:its.dv14.Util.UI.isTVOnlyApp(e)?its.dv14.LockupUtil.AppArtworkStyle.TV:its.dv14.LockupUtil.AppArtworkStyle.STANDARD},getArtworkUrlsForStyle:function(e,t){return t===its.dv14.LockupUtil.AppArtworkStyle.WATCH?e.circularArtwork:t===its.dv14.LockupUtil.AppArtworkStyle.VOYAGER?e.ovalArtwork:e.artwork},getArtworkData:function(e,t,n,r,i){var s=its.dv14.LockupUtil.getAppArtworkStyle(e),o=its.dv14.LockupUtil.getArtworkUrlsForStyle(e,s),u=[its.dv14.LockupUtil.getArtworkClassName(e.kind,s)],a=t.lookup("kindOrName")||e.kind;
s===its.dv14.LockupUtil.AppArtworkStyle.STANDARD&&e.newsstandArtwork?(o=e.newsstandArtwork,u=[],t.lookup("isNewsstandGenre")&&(a="newsstand")):s===its.dv14.LockupUtil.AppArtworkStyle.VOYAGER?a="voyager":s===its.dv14.LockupUtil.AppArtworkStyle.TV&&(a="tv"),r&&(e.kind==its.sf.StorePlatform.Kind.Audiobook?o=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_AUDIOBOOK:e.kind==its.sf.StorePlatform.Kind.EBook&&(o=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_BOOK));
var f=t.lookup("artworkEffects")||its.sf14.Artwork.effects(e.kind),l={artworkUrls:o,size:its.dv14.LockupUtil.getArtworkDimensions(a,n,t.documentSize()),crop:its.dv14.LockupUtil.getArtworkCropStyles(a),effects:f,alt:e.name,classes:u,disabled:i};
return l}}),its.dv14.LockupUtil.BookDetailsGenerator={details:function(e,t){var n=e.name,r=t&&e.ebookInfo&&e.ebookInfo.seriesInfo?e.ebookInfo.seriesInfo.sequenceDisplayLabel:e.artistName,i=its.sf14.ComponentUtil.createText(this,its.locDate(e.releaseDate)),s=its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!1,!0),o=[];
return its.isDefinedNonNull(n)&&(n.classNames=["title-line"],o.push({value:n})),its.isDefinedNonNull(r)&&o.push({value:r}),its.isDefinedNonNull(i)&&o.push({markup:i}),its.isDefinedNonNull(s)&&o.push({markup:s}),o},suppressBuyButton:function(e){return!1}},its.dv14.LockupUtil.BookInSeriesDetailsGenerator={details:function(e){return its.dv14.LockupUtil.BookDetailsGenerator.details(e,!0)},suppressBuyButton:function(e){return its.dv14.LockupUtil.BookDetailsGenerator.suppressBuyButton(e)}},its.dv14.LockupUtil.SoftwareCardDetailsGenerator={details:function(e){var t=[],n={},r={},i="",s=itms.getBag().enableUnifiedAppRating,o={value:s?e.userRating.value:e.userRating.valueCurrentVersion,ratingCount:s?e.userRating.ratingCount:e.userRating.ratingCountCurrentVersion},u=its.isDefinedNonNull(e.iad)&&e.iad.format.userRating===!1;
u||(i=its.dv14.UserRatingsUtil.createSmallStarRatings(o,!1,!0)),n.value=e.name,r.value=e.artistName,its.isDefinedNonNull(n.value)&&(n.classNames=["title-line"],t.push(n)),its.isDefinedNonNull(r.value)&&t.push(r);
var a=e.iad&&e.iad.format&&e.iad.format.icon==="small";
if(its.isDefinedNonNull(e.editorialBadgeInfo)&&!a){var f=its.dv14.BadgeUtil.createEditorialBadge(e.editorialBadgeInfo.nameForDisplay);
e.iad&&e.iad.format&&e.iad.format.icon==="small"&&!its.sf.Platform.iPad()&&(f=""),t.push({markup:f})}return its.isDefinedNonNull(i)&&t.push({markup:i}),t},suppressBuyButton:function(e){return!1}},its.dv14.LockupUtil.BrowsePageSwooshSoftwareLockupDetailsGenerator={details:function(e){var t=[],n={},r={},i={},s=its.sf.StorePlatformUtil.orderedOffers(e.offers)[0];
if(s){var o=null;
s.price&&s.price!==0&&(o=s.priceFormatted),o&&(i.value=o)}return n.value=e.name,r.value=e.artistName,its.isDefinedNonNull(n.value)&&(n.classNames=["title-line"],t.push(n)),its.isDefinedNonNull(r.value)&&t.push(r),its.isDefinedNonNull(i.value)&&t.push(i),t},suppressBuyButton:function(e){return!0}},its.dv14.LockupUtil.AppTrailerLockupDetailsGenerator={details:function(e){var t=[],n={},r={};
return n.value=e.name,r.value=e.genres[0].name,its.isDefinedNonNull(n.value)&&(n.classNames=["title-line"],t.push(n)),its.isDefinedNonNull(r.value)&&t.push(r),t},suppressBuyButton:function(e){return!1}},its.dv14.PlistUtil={handlePlist:function(e,t,n,r,i){var s=t||its.sf14.Util.parseResponseTextAsJson(e);
if(its.reflect.keys(s).length==0)e.status==404&&its.dv14.Util.Client.isIBooks()?its.dv14.ErrorPage.showErrorPage(i,n,its.loc("DV14.ErrorPage.ItemNotAvailableInBooks_message"),its.loc("DV14.ErrorPage.ItemNotAvailableInBooks_customerMessage")):its.dv14.ErrorPage.showErrorPage(i,n);
else if(s.wasParsedFromPLIST||t.dialog){var o=s.dialog;
if(o){var u=o[its.dv14.PlistUtil.Keys.KIND],a=o[its.dv14.PlistUtil.Keys.OK_BUTTON_STRING],f=o[its.dv14.PlistUtil.Keys.OK_BUTTON_ACTION],l=its.dv14.PlistUtil.okButtonCallback(f),c=o[its.dv14.PlistUtil.Keys.CANCEL_BUTTON_STRING],h=o[its.dv14.PlistUtil.Keys.MESSAGE],p=o[its.dv14.PlistUtil.Keys.EXPLANATION],d=s[its.dv14.PlistUtil.Keys.PINGS];
if(d&&d.length>0)for(var v=0;
v<d.length;
v++)its.sf14.Util.fetchServerGetResponse(d[v]);
u==its.dv14.PlistUtil.DialogKind.AUTHORIZATION?its.dv14.PlistUtil.showSignInDialog(o,l):(r&&its.dv14.ErrorPage.showErrorPage(i,n,h,p),r&&l&&its.sf14.DialogDocument.showDialog(h,p,a,l,c))}else its.dv14.ErrorPage.showErrorPage(i)}else its.dv14.ErrorPage.showErrorPage(i)},okButtonCallback:function(e){var t=null;
if(e){var n=e[its.dv14.PlistUtil.Keys.KIND];
if(n==its.dv14.PlistUtil.OkActionKind.GOTO){var r=e[its.dv14.PlistUtil.Keys.URL];
t=function(){openURL(r)}}else n==its.dv14.PlistUtil.OkActionKind.BUY&&(t=function(){var t=[{buyParams:e[its.dv14.PlistUtil.Keys.BUY_PARAMS],type:e[its.dv14.PlistUtil.Keys.KIND]}];
itms.buy({name:e[its.dv14.PlistUtil.Keys.ITEM_NAME],offers:t})})}return t},showSignInDialog:function(e,t){var n={},r=e[its.dv14.PlistUtil.Keys.MESSAGE];
r&&(n.reason=r),itms.authenticate(n,t)}},its.dv14.PlistUtil.Keys={BUY_PARAMS:"buyParams",CANCEL_BUTTON_STRING:"cancelButtonString",DEFAULT_BUTTON:"defaultButton",EXPLANATION:"explanation",FAILURE_TYPE:"failureType",ITEM_NAME:"itemName",KIND:"kind",MESSAGE:"message",OK_BUTTON_ACTION:"okButtonAction",OK_BUTTON_STRING:"okButtonString",PINGS:"pings",URL:"url"},its.dv14.PlistUtil.OkActionKind={BUY:"Buy",GOTO:"Goto"},its.dv14.PlistUtil.DialogKind={AUTHORIZATION:"authorization"},its.dv14.ProductPageUtil={sortChildrenByTrackNumber:function(e){var t=[];
for(var n in e){if(!e.hasOwnProperty(n))continue;t.push(e[n])}var r=function(e,t){return e.trackNumber-t.trackNumber},i=t.slice(0);
return i.sort(r)},shouldShowContentsForProductPageState:function(e,t){var n=!0;
t==its.sf14.ProductPage.State.HD?n=its.sf.StorePlatformUtil.hasAnyHDOffers(e.offers):t==its.sf14.ProductPage.State.SD&&(n=its.sf.StorePlatformUtil.hasAnySDOffers(e.offers));
var r=e.children;
if(r){var i=!1;
for(var s in r){var o=r[s],u=t==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(o.offers):its.sf.StorePlatformUtil.findSDOffers(o.offers);
if(u.length>0){i=!0;
break}}n=n&&i}return n},fileSizesForVideo:function(e){var t=its.sf.StorePlatformUtil.assetForAssetFlavor(e,its.sf.StorePlatform.Offer.AssetFlavor.HD1080P),n=its.sf.StorePlatformUtil.assetForAssetFlavor(e,its.sf.StorePlatform.Offer.AssetFlavor.HD720P),r=its.sf.StorePlatformUtil.assetForAssetFlavor(e,its.sf.StorePlatform.Offer.AssetFlavor.SD),i=its.sf.StorePlatformUtil.assetForAssetFlavor(e,its.sf.StorePlatform.Offer.AssetFlavor.SDPLUS),s={};
return t&&(s.size1080p=t.size),n&&(s.size720p=n.size),r&&(s.sizeSd=r.size),i&&(s.sizeSdPlus=i.size),s},isWideScreen:function(e){if(!e||!e.aspectRatio)return!1;
var t=e.aspectRatio.split(":");
return t[0]/t[1]>its.dv14.ProductPageUtil.Constants.MAX_STANDARD_ASPECT_RATIO},languageDetailsText:function(e){var t=[];
e.hasDolbyAtmos&&t.push(its.loc("DV14.DolbyAtmos")),e.hasDolby71&&t.push(its.loc("DV14.Dolby71")),e.hasDolby?t.push(its.loc("DV14.Dolby51")):e.hasStereo&&t.push(its.loc("DV14.Stereo")),e.hasSubtitles&&t.push(its.loc("DV14.Subtitles")),e.hasClosedCaptioning&&t.push(its.loc("DV14.CC")),e.hasSDH&&t.push(its.loc("DV14.SDH")),e.hasAudioDescription&&t.push(its.loc("DV14.AD"));
var n=null;
return t.length>0&&(n="("+t.join(its.loc("DV14.LanguageComponentsSeparator"))+")"),n},isVersionedKind:function(e){return e==its.sf.StorePlatform.Kind.MobileApp},getDeviceDisplayDimensionTypeForCurrentDevice:function(){var e;
return its.sf.Platform.iPadPro()?e="ipadPro":its.sf.Platform.iPad()?e="ipad":its.sf.Platform.isIPhone6PlusScreenSize()?e="iphone6+":its.sf.Platform.isIPhone6ScreenSize()?e="iphone6":its.sf.Platform.isIPhone5ScreenSize()?e="iphone5":its.sf.Platform.isIPhone4ScreenSize()&&(e="iphone"),e},getBestTypeOfScreenshot:function(e){if(!e)return{};
var t=function(t){var n=e[t];
if(!n||n.length==0)return null;
var r=its.dv14.ProductPageUtil.getScreenshotTitleForType(t);
return{title:r,screenshots:n}},n=its.dv14.ProductPageUtil.getDeviceDisplayDimensionTypeForCurrentDevice(),r;
its.sf.Platform.iPad()?r=["ipadPro","ipad","iphone6+","iphone6","iphone5","iphone"]:r=["iphone6+","iphone6","iphone5","iphone"];
var i=[],s=!1;
for(var o=0;
o<r.length;
o++){var u=r[o];
s?i.push(u):i.unshift(u),n==u&&(s=!0)}var a;
for(var o=0;
o<i.length;
o++){var f=i[o];
a=t(f);
if(a)break}return a?a:{}},getScreenshotTitleForType:function(e){switch(e){case"ipad":case"ipadPro":return its.loc("DV14.Screenshots.iPad");
case"iphone":case"iphone5":case"iphone6":case"iphone6+":default:return its.loc("DV14.Screenshots.iPhone")}},getBestTypeOfTrailer:function(e){var t=e.videoPreviewByType;
if(!t)return;var n;
its.sf.Platform.iPad()?n=["ipadPro","ipad","iphone6+","iphone6","iphone5","iphone"]:n=["iphone6+","iphone6","iphone5","iphone"];
var r=its.dv14.ProductPageUtil.getDeviceDisplayDimensionTypeForCurrentDevice(),i=[],s=!1;
for(var o=0;
o<n.length;
o++){var u=n[o];
s?i.push(u):i.unshift(u),r==u&&(s=!0)}var a;
for(var o=0;
o<i.length;
o++){var f=i[o];
a=t[f];
if(a)break}return a},trimSwooshIds:function(e,t){var n=null,r;
return e&&(t?r=t:r=its.serverData.properties["its.dv14.ProductPage.maxItemsPerSwoosh"]?its.serverData.properties["its.dv14.ProductPage.maxItemsPerSwoosh"]:10,n=e.slice(),n.length>r&&(n=n.slice(0,r))),n}},Class.extend(its.dv14.ProductPageUtil,its.sf.ProductPageUtil),its.dv14.ProductPageUtil.Constants={MAX_STANDARD_ASPECT_RATIO:1.55},its.dv14.ProductPageUtil.Tabs={ALL_VERSIONS:"its.dv14.ProductPageUtil.Tabs.ALL_VERSIONS",CURRENT_VERSION:"its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION",DETAILS:"its.dv14.ProductPageUtil.Tabs.DETAILS",ITUNES_EXTRAS:"its.dv14.ProductPageUtil.Tabs.ITUNES_EXTRAS",ITUNES_LP:"its.dv14.ProductPageUtil.Tabs.ITUNES_LP",RELATED:"its.dv14.ProductPageUtil.Tabs.RELATED",REVIEWS:"its.dv14.ProductPageUtil.Tabs.REVIEWS",SONGS:"its.dv14.ProductPageUtil.Tabs.SONGS"},its.dv14.ProductPageUtil.PinStyle={NONE:"none",ALONE:"alone",GROUP:"group",RUBBERBAND:"rubberband",GROUP_RUBBERBAND:"group-rubberband"},its.dv14.PurchasesUtil={findLibraryItems:function(e,t){var n=function(e){var n={};
for(var r in e)n[e[r].id]=e[r];
t(n)};
itms.findLibraryItems(e,n)}},its.dv14.SearchUtil={searchUrlForTerm:function(e){var t={clientApplication:its.dv14.Util.Client.getClientApplication(),term:e};
its.dv14.PageController.shouldShowStopPageForPageTarget("tv")&&(t.videos="false");
var n=its.url.appendUrlParameters(itms.getBag().search,t);
return n},isSearchUrl:function(e){return its.string.contains(e,"search?")}},its.dv14.Styles=Class.createSubclass("its.dv14.Styles",its.sf14.Styles,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_styles"),this.elementNeedingStyles=this.lookup("element"),this.iPadPro=its.sf.Platform.iPadPro()},render:function(){this.setKeyColor(),this.renderStyles(),this.renderUberImage()},setKeyColor:function(){its.dv14.Util.Client.isPodcasts()?(this.lightKeyColor="rgb(114,36,216)",this.darkKeyColor="rgb(114,36,216)"):its.sf.Client.isVersion("13.0")&&its.dv14.Util.Client.isITunes()?(this.lightKeyColor="systemBlue",this.darkKeyColor="systemBlue"):(this.lightKeyColor="rgb(0,128,252)",this.darkKeyColor="rgb(90,160,252)")},renderStyles:function(){var e=this.lookup("uber"),t=this.lookup("blocks"),n=this._colorMap().light,r=this.lookup("isDarkKind");
isPurchasedModal=this.lookup("isPurchasedModal"),its.isDefined(r)||(r=its.dv14.Styles.isDarkKind(this.data));
if(e&&e.primaryTextColor&&!isPurchasedModal){this._template.keepBlock("uberBlock");
var i=this._isDarkUber(e.backgroundColor),n=i?this._colorMap().dark:this._colorMap().light;
its.sf.Client.isVersion("13.0")&&its.dv14.Util.Client.isITunes()?n=Class.extend(n,{padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt"}):n=Class.extend(n,{backgroundColor:this._hex2rgba(e.backgroundColor),bannerBackgroundColor:this._hex2rgba(e.primaryTextColor,.6),topBackgroundColor:this._hex2rgba(e.backgroundColor),bottomBackgroundColor:this._lighten(e.backgroundColor,10),titleTextColor:this._hex2rgba(e.titleTextColor),primaryTextColor:this._hex2rgba(e.primaryTextColor),pillColor:this._hex2rgba(e.titleTextColor),borderColor:this._hex2rgba(e.primaryTextColor,.2),padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt",linkColor:this._hex2rgba(e.titleTextColor),actionColor:this._hex2rgba(e.titleTextColor),primaryTextColor40:this._hex2rgba(e.primaryTextColor,.4),primaryTextColor60:this._hex2rgba(e.primaryTextColor,.6),primaryTextColor80:this._hex2rgba(e.primaryTextColor,.8),primaryTextColor76:this._hex2rgba(e.primaryTextColor,.76),buyButtonColor:this._hex2rgba(e.titleTextColor),buyButtonButtonlessColor:this._hex2rgba(e.primaryTextColor),buyButtonTextOnlyColor:this._hex2rgba(e.primaryTextColor),buyButtonDisabledColor:this._hex2rgba(e.primaryTextColor),arrowColor:this._hex2rgba(e.primaryTextColor,.2),accountButtons:this._hex2rgba(e.titleTextColor),accountButtonBorders:this._hex2rgba(e.titleTextColor),buyButtonTextOnlyColor:this._hex2rgba(e.primaryTextColor,.8),cmcSubtitleColor:this._hex2rgba(e.primaryTextColor,.6),closeButtonImgColor:this._hex2rgba(e.primaryTextColor,.6)})}else r&&(this._template.keepBlock("uberBlock"),n=this._colorMap().dark);
t&&this._template.keepBlock("blocksBlock");
if(!its.sf.Client.isVersion("13.0")||!its.dv14.Util.Client.isITunes())n.searchFieldColor=r?"rgb(255,255,255)":"rgb(0,0,0)";
Object.keys(n).map(function(e){this._template.replaceToken(e,n[e])}.bind(this));
var s=this._template.composeAsElement();
this.elementNeedingStyles.replaceTokenWithElement("styles",s)},renderUberImage:function(){var e=this.lookup("uber"),t=this.lookup("noFade"),n=e&&e.masterArt;
if(n&&(n.length>0||n.url)){var r=function(){var e=this.renderComponentWithData("artwork",{artworkUrls:n,size:its.dv14.LockupUtil.getArtworkDimensions("uber",this.lookup("artworkProfile"),this.documentSize()),crop:its.dv14.LockupUtil.getArtworkCropStyles("uber",n),classes:t?[]:["uber"],aspectRatioIsDifferent:!0,disabled:!0,alt:this.lookup("name")});
this.lookup("backgroundImagePinStyle")&&e.setAttribute("pin",this.lookup("backgroundImagePinStyle")),this.lookup("pinGroup")&&e.setAttribute("pinGroup",this.lookup("pinGroup")),this.elementNeedingStyles.replaceTokenWithElement("backgroundImage",e),this.elementNeedingStyles.uberImageSet=!0}.bind(this);
r(),its.notifications.subscribeToSender(its.sf14.Events.DID_ROTATE,r,document)}else this.elementNeedingStyles.uberImageSet&&(this.elementNeedingStyles.replaceTokenWithElement("backgroundImage",document.createElement("<placeholder/>")),this.elementNeedingStyles.uberImageSet=!1)},_colorMap:function(){return its.sf.Client.isVersion("13.0")&&its.dv14.Util.Client.isITunes()?{light:{backgroundColor:"systemBackground",topBackgroundColor:"systemBackground",bottomBackgroundColor:"secondarySystemBackground",titleTextColor:"label",primaryTextColor:"label",filterBarColor:"labelColor",pillColor:"rgb(132,132,132)",artworkStrokeColor:"separator",borderColor:"separator",padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt",linkColor:"secondaryLabel",primaryTextColor40:"tertiaryLabel",primaryTextColor60:"secondaryLabel",primaryTextColor80:"secondaryLabel",primaryTextColor76:"secondaryLabel",keyColor:this.lightKeyColor,actionColor:this.lightKeyColor,buyButtonColor:this.lightKeyColor,buyButtonDisabledColor:"tertiaryLabel",buyButtonButtonlessColor:"label",buyButtonTextOnlyColor:"secondaryLabel",buyButtonDownloadColor:"tertiaryLabel",buyButtonCMCColor:this.lightKeyColor,buyPreorderColor:"systemOrange",cmcSubtitleColor:"secondaryLabel",copyrightTextColor:"secondaryLabel",arrowColor:"fill",accountButtons:"rgb(116,116,116)",accountButtonBorders:"rgb(184,184,184)",transparentColor:"transparent",closeButtonImgColor:"labelColor"},dark:{backgroundColor:"systemBackground",topBackgroundColor:"systemBackground",bottomBackgroundColor:"secondarySystemBackground",titleTextColor:"label",primaryTextColor:"label",filterBarColor:"labelColor",pillColor:"rgb(132,132,132)",artworkStrokeColor:"separator",borderColor:"separator",padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt",linkColor:"secondaryLabel",primaryTextColor40:"tertiaryLabel",primaryTextColor60:"secondaryLabel",primaryTextColor80:"secondaryLabel",primaryTextColor76:"secondaryLabel",keyColor:this.lightKeyColor,actionColor:this.lightKeyColor,buyButtonColor:this.lightKeyColor,buyButtonDisabledColor:"tertiaryLabel",buyButtonButtonlessColor:"label",buyButtonTextOnlyColor:"secondaryLabel",buyButtonDownloadColor:"tertiaryLabel",buyButtonCMCColor:this.lightKeyColor,buyPreorderColor:"systemOrange",cmcSubtitleColor:"secondaryLabel",copyrightTextColor:"secondaryLabel",arrowColor:"fill",accountButtons:"rgb(116,116,116)",accountButtonBorders:"rgb(184,184,184)",transparentColor:"transparent",closeButtonImgColor:"labelColor"}}:{light:{backgroundColor:"rgb(255,255,255)",topBackgroundColor:"rgb(255,255,255)",bottomBackgroundColor:"rgb(248,248,248)",titleTextColor:"rgb(0,0,0)",primaryTextColor:"rgb(0,0,0)",filterBarColor:"rgb(0,0,0)",pillColor:"rgb(132,132,132)",artworkStrokeColor:"rgba(0,0,0,0.2)",borderColor:"rgba(0,0,0,0.2)",padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt",linkColor:"rgba(0,0,0,0.6)",primaryTextColor40:"rgba(0,0,0,0.4)",primaryTextColor60:"rgba(0,0,0,0.6)",primaryTextColor80:"rgba(0,0,0,0.8)",primaryTextColor76:"rgba(0,0,0,0.76)",keyColor:this.lightKeyColor,actionColor:this.lightKeyColor,buyButtonColor:this.lightKeyColor,buyButtonDisabledColor:"rgba(0,0,0,0.6)",buyButtonButtonlessColor:"rgba(0,0,0,1)",buyButtonTextOnlyColor:"rgb(119,119,119)",buyButtonDownloadColor:"rgba(0,0,0,0.6)",buyButtonCMCColor:this.lightKeyColor,buyPreorderColor:"rgb(255,149,0)",cmcSubtitleColor:"rgba(0,0,0,0.6)",copyrightTextColor:"rgb(100,100,100)",arrowColor:"rgba(0,0,0,.2)",accountButtons:"rgb(116,116,116)",accountButtonBorders:"rgb(184,184,184)",transparentColor:"transparent",closeButtonImgColor:"rgb(0,0,0)"},dark:{backgroundColor:"rgb(28,28,28)",topBackgroundColor:"rgb(38,38,38)",bottomBackgroundColor:"rgb(28,28,28)",titleTextColor:"rgb(255,255,255)",primaryTextColor:"rgb(255,255,255)",filterBarColor:"rgb(255,255,255)",pillColor:"rgb(110,110,110)",artworkStrokeColor:"rgba(255,255,255,0.15)",borderColor:"rgba(255,255,255,0.15)",padding:this.iPadPro?"0pt 5pt 40pt 0pt":"0pt 5pt 5pt 0pt",paddingDivider:this.iPadPro?"0pt 0pt 20pt 0pt":"0pt",linkColor:"rgba(255,255,255,0.4)",primaryTextColor40:"rgba(255,255,255,0.4)",primaryTextColor60:"rgba(255,255,255,0.6)",primaryTextColor80:"rgba(255,255,255,0.8)",primaryTextColor76:"rgba(255,255,255,0.76)",keyColor:this.darkKeyColor,actionColor:this.darkKeyColor,buyButtonColor:this.darkKeyColor,buyButtonDisabledColor:"rgba(255,255,255,0.4)",buyButtonButtonlessColor:"rgba(255,255,255,1)",buyButtonTextOnlyColor:"rgb(255,255,255)",buyButtonDownloadColor:"rgba(255,255,255,0.4)",buyButtonCMCColor:this.darkKeyColor,buyPreorderColor:"rgb(255,149,0)",cmcSubtitleColor:"rgba(255,255,255,0.4)",copyrightTextColor:"rgba(255,255,255,.2)",arrowColor:"rgba(255,255,255,.15)",accountButtons:"rgb(200,200,200)",accountButtonBorders:"rgb(96,96,96)",transparentColor:"transparent"}}}}),its.dv14.Styles.isDarkKind=function(e){var t=e.kind?e.kind:null,n=e.mt?e.mt:null,r=e.url?e.url:null,i=null;
if(e.tabId)i=e.tabId;
else if(!its.dv14.Util.Client.isVoyager()||typeof TabBar.selectedTab!="undefined")i=TabBar.selectedTab.identifier;
if(n)return n===4||n===6||n===5;
if(t){if(t===its.sf.StorePlatform.Kind.Movie||t===its.sf.StorePlatform.Kind.MovieBundle||t===its.sf.StorePlatform.Kind.TvSeason||t===its.sf.StorePlatform.Kind.TvEpisode||t===its.sf.StorePlatform.Kind.MusicVideo)return!0}else if(i){if(i==its.sf14.PageController.PageTarget.MOVIES||i==its.sf14.PageController.PageTarget.TV)return!0}else r;
return!1},its.dv14.ChartsUtil={hasAnyChartContent:function(e){if(e)for(var t=0;
t<e.length;
++t){var n=e[t];
if(n&&n.adamIds&&n.adamIds.length>0)return!0}return!1},createNoContentElement:function(){var e;
its.dv14.Util.Client.isAppStore()?e="resource://placeholderApps":its.dv14.Util.Client.isITunes()?e="resource://placeholderMusic":its.dv14.Util.Client.isITunesU()?e="resource://placeholderiTunesU":its.dv14.Util.Client.isIBooks()?e="resource://placeholderBooks":its.dv14.Util.Client.isPodcasts()&&(e="resource://placeholderPodcasts");
var t=its.Templates.get("components/dv14_content_unavailable");
return t.replaceToken("message",its.loc("SF.NoChartContent")),t.replaceToken("resource",e),t.composeAsElement()},determineSelectedCategoryFromChart:function(e,t){if(e&&e.children&&t)for(var n=0;
n<e.children.length;
++n){var r=e.children[n];
if(t.seeAllUrl==r.url)return r}return null}},its.dv14.UserRatingsUtil={createSmallStarRatings:function(e,t,n){var r;
return!e||!e.ratingCount?n?null:null:(r=its.Templates.get("utils/dv14_user_ratings_util/small_star"),r.replaceToken("value",e.value),r.replaceToken("count",e.ratingCount),t?r.composeAsElement():r.compose())},createWriteAReviewDocument:function(e,t,n){var r=its.Templates.get("utils/dv14_user_ratings_util/write_a_review");
r.replaceToken("url",e),r.replaceToken("adamId",t);
var i=r.composeAsElement();
return i.addEventListener("submit",n),i},createReportAConcernDocument:function(e){var t=its.Templates.get("utils/dv14_user_ratings_util/report_a_concern");
t.replaceToken("url",e.reportConcernUrl),t.replaceToken("itemId",e.userReviewId),t.replaceToken("explanation",e.reportConcernExplanation),t.replaceToken("title",its.loc("DV14.UserReviews.ReportAConcern.Title")),t.replaceToken("subtitle",its.loc("DV14.UserReviews.ReportAConcern.Subtitle")),t.replaceToken("privacy",its.loc("DV14.UserReviews.ReportAConcern.Privacy"));
var n=t.getBlock("reasonsLoop");
for(var r=0;
r<e.reportConcernReasons.length;
r++){var i=e.reportConcernReasons[r];
n.replaceToken("reasonId",i.reasonId),n.replaceToken("name",i.name),i.upperCaseName&&n.replaceToken("uppercaseName",i.upperCaseName),n.next()}return its.sf14.Util.ensureDocumentType(t.composeAsElement())}},its.dv14.Util={_logger:its.Logger.named("its.dv14.Util"),copyExtRefDataFromDict:function(e,t){if(!e||!t)return;var n=e.refUrl||e.extRefUrl2;
n?t.extRefUrl2=n:delete t.extRefUrl2;
var r=e.refApp||e.extRefApp2;
r?t.extRefApp2=r:delete t.extRefApp2}},its.dv14.Util.Client={getClientApplication:function(){var e=its.dv14.Util.clientApplication.ITUNES;
return this.isIBooks()?e=its.dv14.Util.clientApplication.IBOOKS:this.isAppStore()?e=its.dv14.Util.clientApplication.APP_STORE:this.isPodcasts()?e=its.dv14.Util.clientApplication.PODCASTS:this.isBridge()?e=its.dv14.Util.clientApplication.WATCH:this.isVoyager()&&(e=its.dv14.Util.clientApplication.VOYAGER),e},getAppIdentifierForUrl:function(e){var t=its.sf14.Util.mediaTypeForUrl(e),n=t?t.name:null;
return its.dv14.Util.AppIdentifierMediaTypeLookup[n]},isIBooks:function(){return Device.appIdentifier==its.dv14.Util.BundleId.IBOOKS},isITunes:function(){return Device.appIdentifier==its.dv14.Util.BundleId.ITUNES},isITunesU:function(){return Device.appIdentifier==its.dv14.Util.BundleId.ITUNES_U},isAppStore:function(){return Device.appIdentifier==its.dv14.Util.BundleId.APP_STORE},isPodcasts:function(){return Device.appIdentifier==its.dv14.Util.BundleId.PODCASTS},isStoreKit:function(){return Device.appIdentifier==its.dv14.Util.BundleId.STORE_KIT},isBridge:function(){return Device.appIdentifier==its.dv14.Util.BundleId.BRIDGE||this.isStoreKit()&&its.App.isGizmoSheet},isVoyager:function(){return Device.appIdentifier==its.dv14.Util.BundleId.VOYAGER||Device.appIdentifier==its.dv14.Util.BundleId.MESSAGES},isSearchSupported:function(){return!this.isITunesUTabOnITunes()},isTvSupported:function(){var e=itms.getBag();
return its.sf.Client.isVersion("10.2")&&e&&e.uvSearch&&e.uvSearch["nowplaying-enabled"]},isGlobalListsSupported:function(){return!(this.isITunesUTabOnITunes()||this.isIBooks()||this.isPodcasts()||this.isITunesU()||this.isBridge()||this.isVoyager())},isITunesUTabOnITunes:function(){var e=its.sf14.PageController.PageTarget.targetForId(TabBar.selectedTab.identifier);
return this.isITunes()&&e==its.sf14.PageController.PageTarget.ITUNESU},isWinBackSupported:function(e){return e&&e.kind==="album"&&its.sf.Platform.iPhone()&&Device.model.indexOf("iPod")===-1&&its.string.compareNumerically(its.sf.Client.version(),"10")>-1&&!this.isWinBackSuppressed()},isWinBackSuppressed:function(e){var t=localStorage.getItem("suppressAppleMusicWinBack");
return!!t},optOutOfWinBack:function(){var e=new Date,t={optedOutDate:e,v:1};
localStorage.setItem("suppressAppleMusicWinBack",JSON.stringify(t))},tabExistsInTabBar:function(e){for(var t=0;
t<TabBar.tabs.length;
t++){var n=TabBar.tabs[t];
if(n.identifier==e)return!0}return!1}},its.dv14.Util.Client.MSO={noProviderId:"NO_PROVIDER",msoData:{},_providerAppsData:null,_reuestTimeoutMilis:2e3,_msoAppsEndpoint:"https://itunes.apple.com/WebObjects/MZStore.woa/wa/multipleSystemOperatorApps",refresh:function(){this.msoData={},this.initialize(function(){its.notifications.publish(its.sf14.Events.MSO_ACCOUNT_CHANGED,this.msoData)})},initialize:function(e){if(its.isDefinedNonNull(this.msoData.providerId)&&this.msoData.providerId!=this.noProviderId){e(this.msoData);
return}var t=!1,n=function(){t||(t=!0,this.msoData={providerId:this.noProviderId,availableAppTitles:[],providerStorePlatformData:{}},e(this.msoData))}.bind(this),r=function(r){if(r.providerId){this.msoData.providerId=r.providerId,this.msoData.availableAppTitles=r.providedAppTitles;
var i={profile:its.sf.StorePlatform.Profiles.PRODUCT_DIRECT_VIEW,ids:[this.msoData.providerId],onOK:function(n){t||(t=!0,this.msoData.providerStorePlatformData=n[this.msoData.providerId]||{},e(this.msoData))}.bind(this),onError:n},s=new its.sf.StorePlatform;
s.fetchContent([i])}else n()}.bind(this);
itms.fetchMSOProviderStatus?itms.fetchMSOProviderStatus(r):n(),setTimeout(n,this._reuestTimeoutMilis)},fetchProviderAppIds:function(e){if(this.msoData.providerId==null){this.initialize(function(){this.fetchProviderAppIds(e)}.bind(this));
return}var t=function(t){this.msoData.alwaysAvailableAppIds=[],this.msoData.availableAppIds=[],t.appsToAlwaysShow&&t.appsToAlwaysShow.forEach(function(e){this.msoData.availableAppIds.push(e),this.msoData.alwaysAvailableAppIds.push(e)}.bind(this));
if(t.apps)for(var n=0;
n<t.apps.length;
n++){var r=t.apps[n];
for(var i=0;
i<r.channelIds.length;
i++)if(this.msoData.availableAppTitles.indexOf(r.channelIds[i])!=-1){this.msoData.availableAppIds.push(r.id);
break}}e(this.msoData)}.bind(this),n=function(){this.msoData.alwaysAvailableAppIds=[],this.msoData.availableAppIds=[],e(this.msoData)}.bind(this);
if(this.msoData.providerId==this.noProviderId||!its.isDefinedNonNullNonEmpty(this.msoData.availableAppTitles))n();
else if(its.isDefinedNonNull(this.msoData.availableAppIds))e(this.msoData);
else{var r=its.url.appendUrlParameter(this._msoAppsEndpoint,"id",this.msoData.providerId);
its.sf14.Util.getJSON(r,t,n)}},personalizedReplacementFCData:function(e){if(!this.msoData.providerStorePlatformData||Object.getOwnPropertyNames(this.msoData.providerStorePlatformData).length==0)return e;
var t=this.msoData.providerStorePlatformData,n=t.artwork;
t.editorialArtwork&&t.editorialArtwork.storeFlowcase?n=t.editorialArtwork.storeFlowcase:t.editorialArtwork&&t.editorialArtwork.bannerUber&&(n=t.editorialArtwork.bannerUber);
if(!n||Object.getOwnPropertyNames(n).length==0)return e;
var r={fcKind:e.fcKind,adamId:e.adamId,doNotFilter:e.doNotFilter,artwork:n};
return r.link={type:"link",label:t.name,url:t.url,content:t},r}},its.dv14.Util.UI=Class.extend(its.sf14.Util.UI,{displayModeSingleView:function(){return this.isPortrait()&&this.shouldToggleSplitView()&&its.dv14.Util.UI.isWindowCompact()},displayModeSplitView:function(){return this.isLandscape()&&this.shouldToggleSplitView()&&(its.dv14.Util.Client.isIBooks&&!its.sf.Platform.iPad()||!its.dv14.Util.UI.isWindowCompact())},shouldToggleSplitView:function(){return!its.sf.Platform.iPad()&&its.dv14.Util.UI.DeviceHeight==736&&!its.App.StoreSheetData},shouldPinProductLockup:function(e){return e=e||{},its.sf.Platform.iPad()||its.dv14.Util.UI.DeviceWidth>375&&(!its.dv14.Util.UI.isLandscape()||!its.sf.Platform.isIPhone6PlusScreenSize())&&!e.isPurchasedModal},shouldShowPopularity:function(){return its.dv14.Util.UI.DeviceWidth>375},shouldShowTrackListHeaders:function(){return its.dv14.Util.UI.DeviceWidth>375},shouldShowiPadTVEpisode:function(){return its.dv14.Util.UI.DeviceWidth>320},isMultiItemCarousel:function(e){return e.width>375},shouldShowSeeAll:function(e,t){var n,r=this._type==its.dv14.Swoosh.Type.List,i=this.isLandscape();
return its.sf.Platform.iPad()?r?n=i?3:2:n=i?6:4:n=r?1:3,e&&t.length>n},isLandscape:function(){return Settings.Screen.width>Settings.Screen.height},isPortrait:function(){return Settings.Screen.width<Settings.Screen.height},setIsMedusa:function(e){this._isMedusa=e},isMedusa:function(){return this._isMedusa},clientSupportsMedusa:function(){return its.dv14.Util.Client.isAppStore()||its.dv14.Util.Client.isVoyager()},isCompact:function(e){return e&&e.width<630},isWindowCompact:function(){return this.isCompact(its.sf.Client.isVersion("10.0")?its.App.windowSize():Settings.Screen)},isFirstPartyHideableApp:function(e){return e&&typeof itms.isRemovedSystemApp=="function"&&e.isFirstPartyHideableApp},isTVOnlyApp:function(e){return this.hasTVApp(e)&&e.deviceFamilies.length===1},hasTVApp:function(e){return e.deviceFamilies&&e.deviceFamilies.indexOf("tvos")!==-1},shouldFilterFirstPartyHideableApp:function(e){var t=!1;
if(!e||!e.isFirstPartyHideableApp)return t;
var n=itms.storefront&&itms.storefront.indexOf("143441")!=-1,r=its.sf.Client.isVersion("10.2"),i=its.sf.Client.isVersion("10.0"),s=its.sf.Client.isVersion("9.0");
if(!i)t=!0,e.bundleId==="com.apple.mobileme.fmf1"&&!s&&(t=!1);
else switch(e.bundleId){case"com.apple.compass":case"com.apple.MobileAddressBook":Device.model!==its.dv14.Util.DeviceModel.IPHONE&&(t=!0);
break;case"com.apple.Bridge":t=!0,Device.model===its.dv14.Util.DeviceModel.IPHONE&&Device.productType!=="iPhone4,1"&&(t=!1);
break;case"com.apple.calculator":case"com.apple.VoiceMemos":case"com.apple.weather":case"com.apple.stocks":Device.model===its.dv14.Util.DeviceModel.IPAD&&(t=!0);
break;case"com.apple.videos":t=r&&n;
break;case"com.apple.tv":t=!r||!n;
break;case"com.apple.DocumentsApp":case"com.apple.Photo-Booth":case"com.apple.Fitness":case"com.apple.Jellyfish":t=!0;
break;default:}return!t&&itms.restrictions&&itms.restrictions.isRestrictedApp&&itms.restrictions.isRestrictedApp(e.bundleId)&&(t=!0),t},removeAppFromArray:function(e){var t=this.indexOf(e);
return t!=-1?this.splice(t,1):!1},filterByInstalledApps:function(e,t,n){t=t||!1;
var r=n||its.dv14.Util.deviceWidthFilteringThreshold,i=e.length-1;
if(its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0)while(i>=0&&e.length>r){var s=null;
t?e[i].link!==undefined&&e[i].link.content!==undefined&&e[i].link.content.id!==undefined?s=e[i].link.content.id:e[i].link!==undefined&&e[i].link.contentId?s=e[i].link.contentId:e[i].link!==undefined&&e[i].link.adamId&&(s=e[i].link.adamId):s=e[i],App.installedApps[s]!==undefined&&this.removeAppFromArray.call(e,e[i]),i--}return e},filterMixedRoomByInstalledApps:function(e){var t=its.dv14.Util.deviceWidthFilteringThreshold,n=e.length-1;
if(its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0)while(n>=0&&e.length>t)e[n].adamId&&App.installedApps[e[n].adamId]!==undefined&&this.removeAppFromArray.call(e,e[n]),n--;
return e},filterUnsupportedPreOrders:function(e,t){return t?e?t.filter(function(t){var n=e.getCachedData(t);
return its.dv14.Util.UI.isUnsupportedPreOrder(n)?!1:!0}):t:null},isUnsupportedPreOrder:function(e){return e&&e.kind&&e.offers&&its.sf.StorePlatformUtil.hasAnyPreorderOffers(e.offers)&&(e.kind===its.sf.StorePlatform.Kind.MobileApp||e.kind===its.sf.StorePlatform.Kind.MobileAppBundle||e.kind===its.sf.StorePlatform.Kind.MacApp)},getShowIdsForEpisodeLockups:function(){if(!this.storePlatform){console.warn("getShowIdsForEpisodeLockups must be called with a context that contains storePlatform");
return}var e=typeof TabBar!="undefined"&&TabBar.selectedTab.identifier==="tv",t=this.data&&this.data.storePlatformData&&this.data.storePlatformData.lockup&&this.data.storePlatformData.lockup.results;
if(!its.sf.Platform.iPad()||!e||!t)return;t=t||{};
var n,r=[];
for(var i in t)t.hasOwnProperty(i)&&(n=t[i]),n.kind==="tvEpisode"&&r.push(n.artistId);
this.storePlatform.fetchContent({ids:r,profile:"lockup",artworkProfile:"room"})},addSearchTermToPageInfo:function(e){return its.App.SearchDocument&&e&&(e.searchTerm=its.App.SearchDocument.componentRepresentation.term()),e}}),its.dv14.Util.deviceWidthFilteringThreshold=function(){var e=10,t=its.dv14.Util.UI.DeviceWidth;
return t<=375?e=3:t>=376&&t<=414?e=4:t>=415&&t<=768?e=8:e=8,e}(),its.dv14.Util.clientApplication={APP_STORE:"Software",IBOOKS:"eBooks",ITUNES:"WiFi-Music",WATCH:"Watch",PODCASTS:"Podcasts",VOYAGER:"Messages"},its.dv14.Util.BundleId={APP_STORE:"com.apple.AppStore",IBOOKS:"com.apple.iBooks",ITUNES:"com.apple.MobileStore",ITUNES_U:"com.apple.itunesu",PODCASTS:"com.apple.podcasts",STORE_KIT:"com.apple.ios.StoreKitUIService",BRIDGE:"com.apple.Bridge",VOYAGER:"com.apple.Voyager",MUSIC:"com.apple.Music",VIDEOS:"com.apple.videos",TV:"com.apple.tv",MESSAGES:"com.apple.MobileSMS",adamIdForBundleId:function(e){var t;
if(itms.getBag()&&itms.getBag().hideableSystemApps)for(var n=0;
n<itms.getBag().hideableSystemApps.length;
n++){var r=itms.getBag().hideableSystemApps[n];
if(r["bundle-id"]==e){t=r.id;
break}}return t}},its.dv14.Util.DeviceModel={IPAD:"iPad",IPOD_TOUCH:"iPod touch",IPHONE:"iPhone"};
var isCopperOrGreater=its.sf14.Util.isCopperOrGreater();
its.dv14.Util.AppIdentifierMediaTypeLookup={},its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.Audiobooks.name]=isCopperOrGreater?its.dv14.Util.BundleId.IBOOKS:its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.ClassicSoftware.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.EBooks.name]=its.dv14.Util.BundleId.IBOOKS,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.MobileSoftware.name]=its.dv14.Util.BundleId.APP_STORE,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.Movies.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.Music.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.MusicVideos.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.Podcasts.name]=its.dv14.Util.BundleId.PODCASTS,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.Ringtones.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.TVShows.name]=its.dv14.Util.BundleId.ITUNES,its.dv14.Util.AppIdentifierMediaTypeLookup[its.serverData.constants.MZMediaType.iTunesU.name]=its.dv14.Util.BundleId.ITUNES_U,its.dv14.Util.Apps={hasITunesU:!1,hasPodcasts:!1,initialize:function(){itms.findApps([its.dv14.Util.BundleId.PODCASTS,its.dv14.Util.BundleId.ITUNES_U],function(e){if(e)for(var t in e)switch(t){case its.dv14.Util.BundleId.PODCASTS:its.dv14.Util.Apps.hasPodcasts=!0;
break;case its.dv14.Util.BundleId.ITUNES_U:its.dv14.Util.Apps.hasITunesU=!0}})},installedApps:function(e){function t(e){itms.findApps(null,function(t){for(var n in t){var r=t[n].id;
r&&(App.installedApps[r]={})}e&&e()},null)}App.installedApps={},App.installedApps.timeOfQuery=new Date,its.notifications.subscribe(its.sf14.Events.APPS_INSTALLED_CHANGE,function(e){var n=(new Date-App.installedApps.timeOfQuery)/1e3;
n>20&&t(),App.installedApps.timeOfQuery=new Date}),t(e)}},its.dv14.DeepLinkUtil={_logger:its.Logger.named("its.dv14.DeepLinkUtil"),openCharitySheet:function(e){var t=its.sf14.BaseDocument.renderDocumentWithData("charity_sheet",{campaignId:e.campaignId||"COH",dataUrl:"https://itunes.apple.com/WebObjects/MZStore.woa/wa/charityGiftPageData"},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),n={type:"sheet"};
modal.pushDocument(t,n)},openGiftSheet:function(e){var t=its.sf14.BaseDocument.renderDocumentWithData("gift_sheet",{},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),n={type:"sheet"};
modal.pushDocument(t,n)},openRedeemSheet:function(e){var t={type:"sheet"},n=its.sf14.BaseDocument.renderDocumentWithData("redeem_page",e,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
modal.pushDocument(n,t)},openFinanceSheetIfPresent:function(e){if(e.pageData)switch(e.pageData.overlay){case"charity":return its.dv14.DeepLinkUtil.openCharitySheet(e),!0;
case"checkpreorders":break;case"gift":return its.dv14.DeepLinkUtil.openGiftSheet(e),!0;
case"redeem":return its.dv14.DeepLinkUtil.openRedeemSheet(e),!0}return!1},checkForDeepLinkUrlOnPageLoad:function(e){e.url&&(e.url=e.url.toLowerCase(),e.url.indexOf("#gift")>=0?its.dv14.DeepLinkUtil.openGiftSheet():e.url.indexOf("#redeem")>=0?its.dv14.DeepLinkUtil.openRedeemSheet():e.url.indexOf("#charity")>=0||e.url.indexOf("#checkpreorders")>=0||e.url.indexOf("familysharing")>=0&&itms.launchICloudFamilySettings())}},its.notifications.subscribe(its.sf14.PageController.Events.LOAD_PAGE,its.dv14.DeepLinkUtil.checkForDeepLinkUrlOnPageLoad),its.dv14.AdditionalAppTypes=Class.createSubclass("its.dv14.AdditionalAppTypes",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content")},templateName:function(){return its.sf.Client.isVersion("10.0")?"components/dv14_additional_app_types_OS10":"components/dv14_additional_app_types"},renderAsString:function(){var e=this._offers();
return its.sf.Client.isVersion("10.0")?this._renderStringUsingStackList(e):this._renderStringUsingLockups(e)},_renderStringUsingStackList:function(e){var t=this.template.getBlock("ItemLoop");
if(e.length>2)t.replaceTokenUnescaped("item",this._createLockupMarkupForAllApps()),t.next();
else if(e.length)for(var n=0;
n<e.length;
n++)t.replaceTokenUnescaped("item",this._createLockupMarkupForOffer(e[n])),t.next();
var r=this.lookup("stackListClasses");
return r&&r.forEach(function(e){this.addClass(e)}.bind(this)),this.lookup("shouldPin")&&this.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),this.template.compose()},_renderStringUsingLockups:function(e){var t=this.template.getBlock("LockupLoop");
if(e.length>2)t.replaceTokenUnescaped("lockup",this._createLockupMarkupForAllApps()),t.next();
else if(e.length)for(var n=0;
n<e.length;
n++)t.replaceTokenUnescaped("lockup",this._createLockupMarkupForOffer(e[n])),t.next();
return this.template.compose()},_offers:function(){var e=[];
its.dv14.AdditionalAppTypes.shouldShowOffersIMessageApp(this._content)&&e.push({text:this._content.isHiddenFromSpringboard?its.loc("DV14.OnlyForIMessage"):its.loc("DV14.OffersIMessageApp"),badgeMarkup:its.dv14.BadgeUtil.createBadge(Class.extend(its.dv14.BadgeUtil.Badges.OFFERS_IMESSAGE_APP,{createAsImage:!0}),!1)}),its.dv14.AdditionalAppTypes.shouldShowOffersAppleWatchApp(this._content)&&e.push({text:its.loc("DV14.OffersAppleWatchApp"),badgeMarkup:its.dv14.BadgeUtil.createBadge(Class.extend(its.dv14.BadgeUtil.Badges.OFFERS_WATCH_APP,{createAsImage:!0}),!1)});
if(its.dv14.AdditionalAppTypes.shouldShowOffersATVApp(this._content)){var t=its.dv14.Util.UI.isTVOnlyApp(this._content);
e.push({text:t?its.loc("DV14.OnlyForAppleTV"):its.loc("DV14.OffersAppleTVApp"),badgeMarkup:its.dv14.BadgeUtil.createBadge(Class.extend(its.dv14.BadgeUtil.Badges.OFFERS_TV_APP,{createAsImage:!0}),!1)})}return e},_createLockupMarkupForOffer:function(e){var t=its.sf.Client.isVersion("10.0")?its.Templates.get("components/dv14_additional_app_types/offer_detail_OS10"):its.Templates.get("components/dv14_additional_app_types/offer_detail");
t.keepBlock("BadgesLoop",!0),t.replaceTokenUnescaped("badge",e.badgeMarkup);
var n={"class":"additional-app-available-title"};
return its.sf.Client.isVersion("10.0")||(n.maxLines=2,this.lookup("shouldPin")&&t.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString({pin:its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND}))),t.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,e.text,{type:its.sf14.ComponentUtil.TextType.DESCRIPTION,attributes:n},!1)),t.compose()},_createLockupMarkupForAllApps:function(){var e=its.sf.Client.isVersion("10.0")?its.Templates.get("components/dv14_additional_app_types/offer_detail_OS10"):its.Templates.get("components/dv14_additional_app_types/multi_offer_detail"),t=e.getBlock("BadgesLoop"),n=[its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.OFFERS_IMESSAGE_APP,!1),its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.OFFERS_WATCH_APP,!1),its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.OFFERS_TV_APP,!1)];
for(var r=0;
r<n.length;
r++)t.replaceTokenUnescaped("badge",n[r]),t.next();
var i={"class":"additional-app-available-title"};
return its.sf.Client.isVersion("10.0")||(i.maxLines=2),e.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,its.loc("DV14.OffersAllPlatformApps"),{type:its.sf14.ComponentUtil.TextType.DESCRIPTION,attributes:i},!1)),e.compose()}}),its.dv14.AdditionalAppTypes.shouldShowOffersAppleWatchApp=function(e){var t=!1;
return its.dv14.NotifyMeButton.isNotifyMeContent(e.id)?t=its.dv14.NotifyMeButton.isNotifyMeContentWithAppleWatchApp(e.id):t=its.property("DV14.Gizmo.showAppleWatchDetailsInAppStore")&&e.isAppleWatchSupported,its.sf.Client.isVersion("8.2")&&!its.dv14.Util.Client.isBridge()&&t},its.dv14.AdditionalAppTypes.shouldShowOffersIMessageApp=function(e){return its.sf.Client.isVersion("10")&&e.hasMessagesExtension&&!its.dv14.Util.Client.isVoyager()},its.dv14.AdditionalAppTypes.shouldShowOffersATVApp=function(e){var t=!1;
return its.dv14.NotifyMeButton.isNotifyMeContent(e.id)?t=its.dv14.NotifyMeButton.isNotifyMeContentWithTvApp(e.id):t=its.dv14.Util.UI.hasTVApp(e),its.sf.Client.isVersion("10")&&t},its.dv14.AdditionalAppTypes.appHasAdditionalTypes=function(e){return its.dv14.AdditionalAppTypes.shouldShowOffersIMessageApp(e)||its.dv14.AdditionalAppTypes.shouldShowOffersAppleWatchApp(e)||its.dv14.AdditionalAppTypes.shouldShowOffersATVApp(e)},its.dv14.ApplePack=Class.createSubclass("its.dv14.ApplePack",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.storePlatform.cacheStorePlatformDataForProfiles(this.data.storePlatformData),this.subscribe(its.dv14.ApplePack.Event.DOWNLOAD_ONE,this._downloadOneAction.bind(this))},render:function(){var e=its.Templates.get("components/apple_pack");
its.sf.Platform.iPad()?e.replaceToken("applePackHeader",this.data.header_ipad):Device.model=="iPhone"?e.replaceToken("applePackHeader",this.data.header_iphone):e.replaceToken("applePackHeader",this.data.header_ipod),e.replaceTokenUnescaped("legal",its.sf14.ComponentUtil.createButton(this,this.data.legal_text,its.sf14.ComponentUtil.ButtonType.LINK,{"class":"apple-pack-footer",maxLines:10,"data-url":this.data.legal_url,"data-page-target":"external"})),e.replaceToken("disclaimer",this.data.disclaimer_text),this._applePackElement=e.composeAsElement(),this._applePackElement.replaceTokenWithElement("navigationBar",this.navigationBar());
if(this._showDownloadAllButton()){var t=its.Templates.get("components/apple_pack/download_all_button");
t.replaceToken("buttonText",its.loc("DT6.RedownloadButton.DownloadAll")),this._downloadAllButton=t.composeAsElement(),its.sf.Metrics.setTargetInfo(this._downloadAllButton,"button",its.dv14.ApplePack.Metrics.DOWNLOAD_ALL,its.sf.Metrics.ActionType.DOWNLOAD,null),this._applePackElement.replaceTokenWithElement("downloadAll",this._downloadAllButton),this._downloadAllButton.addEventListener("select",this._downloadAllAction.bind(this))}var n=Device.model=="iPad"?"apple-pack-grid-ipad":"no-borders-grid",r={contentIds:this.data.notInstalledIds,classes:[n],"its.dv14.BuyButton":{applePackDownloadAllEvent:!0},"its.dv14.SmallLockup":{artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,detailsGenerator:this.detailsGenerator(this.data),disableLockupOnSelect:!0}},i=this.renderComponentWithData("grid",r);
return this._applePackElement.replaceTokenWithElement("grid",i),this.addDocumentStyles(this._applePackElement),this._applePackElement},navigationBar:function(){var e=its.Templates.get("components/apple_pack/navigation_bar"),t=function(e){modal.popDocument()};
e.replaceToken("title",this.data.pageTitle);
var n=e.composeAsElement();
return this.cancelButton=its.sf14.ComponentUtil.createButton(this,its.loc("MZStore.NotNowButton"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},t.bind(this),!0),its.sf.Metrics.setTargetInfo(this.cancelButton,"button",its.dv14.ApplePack.Metrics.CLOSE_SHEET,its.sf.Metrics.ActionType.DISMISS,null),n.replaceTokenWithElement("cancelButton",this.cancelButton),n},detailsGenerator:function(e){return{details:function(t){var n=[],r={},i={};
return r.value=t.name,i.markup=its.sf14.ComponentUtil.createText(this,e.descriptions[t.id],{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{maxLines:10}}),its.isDefinedNonNull(r.value)&&n.push(r),its.isDefinedNonNull(i.markup)&&n.push(i),n},suppressBuyButton:function(e){return!1}}},_showDownloadAllButton:function(){if(this._showDownloadAll==undefined){var e=Device.capacity("totalDataAvailable"),t=its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.LOCKUP,its.sf.StorePlatform.ArtworkProfiles.ROOM),n=0;
for(var r=0;
r<this.data.notInstalledIds.length;
r++){var i=this.storePlatform.getCachedData(this.data.notInstalledIds[r],t);
n+=i.offers[0].assets[0].size}this._showDownloadAll=e>n}return this._showDownloadAll},_downloadAllAction:function(e){this._downloadingAll||(this._downloadingAll=!0,its.notifications.publish(its.dv14.ApplePack.Event.DOWNLOADALL,{}))},_downloadOneAction:function(e){this.cancelButton.textContent=its.loc("Done")}}),its.dv14.ApplePack.Event={DOWNLOADALL:"DOWNLOADALL_GRATIS_APPS",DOWNLOAD_ONE:"DOWNLOAD_ONE_GRATIS_APP"},its.dv14.ApplePack.Metrics={DOWNLOAD_ALL:"downloadAllApplePack",CLOSE_SHEET:"closeApplePack"},its.dv14.Artwork=Class.createSubclass("its.dv14.Artwork",its.sf14.Artwork,{}),its.dv14.Artwork.PlaceholderArtwork={EXPLICIT_BOOK:[{url:its.serverData.constants.resourceBaseUrl+"/images/ibooks/modern_explicit_book.png",height:812,width:512}],EXPLICIT_AUDIOBOOK:[{url:its.serverData.constants.resourceBaseUrl+"/images/ibooks/modern_explicit_audiobook.png",height:512,width:512}],RADIO_PLACARD:[{url:its.serverData.constants.resourceBaseUrl+"/../dvx-frameworks/images/radio_logo_placard_2x.png",height:130,width:140}],RADIO_PROMO:[{url:its.serverData.constants.resourceBaseUrl+"/images/radio_icon_mask.2x.png",height:52,width:54}]},its.dv14.BuyButton=Class.createSubclass("its.dv14.BuyButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._isFirstPartyHideableApp=its.dv14.Util.UI.isFirstPartyHideableApp(this._content),this._shouldFilterFirstPartyHideableApp=its.dv14.Util.UI.shouldFilterFirstPartyHideableApp(this._content),this._kind=this._content.kind,this._buttonStyle=this.lookup("buttonStyle")||its.dv14.BuyButton.ButtonStyle.default,this._ignoreDisabled=this.lookup("ignoreDisabled"),this._isPurchasedModal=this.lookup("isPurchasedModal");
var e=this.lookup("offer");
e||this.logger.error("IllegalArgumentException: Buy button created without valid offer"),this._currentOffer=e,this._isUnsupportedPreOrder()&&this._buttonStyle===its.dv14.BuyButton.ButtonStyle.preorder&&(this._buttonStyle=its.dv14.BuyButton.ButtonStyle.default),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._refresh.bind(this)),this.subscribe(its.sf14.Events.ACCOUNT_CHANGE,this._refresh.bind(this)),its.notifications.remove(its.sf14.Events.PLAYBACK_DISABLED),this.subscribe(its.sf14.Events.PLAYBACK_DISABLED,this._displayHiddenSystemAppMessage.bind(this)),this.subscribeToTarget(its.dv14.MovieProductLockup.Events.RENTAL_INFO_CHANGED,this._updateRentalState.bind(this),this.itsId()),this._belongsToApplePackSheet=this.lookup("applePackDownloadAllEvent"),this._belongsToApplePackSheet&&this._subscribeToApplePackEvents(),this._useGratisPricingIfElegible(),this._content.isFirstEpisode&&this.subscribeToTarget(its.dv14.TvSeasonPage.Events.WATCH_FIRST_EPISODE,this._downloadFirstEpisdode.bind(this),this._content.collectionId)},templateName:function(){return"components/dv14_buy_button"},_useGratisPricingIfElegible:function(){if(its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice[this._content.id]){var e=""+this._currentOffer.price*1e3;
this._currentOffer.buyParams=this._currentOffer.buyParams.replace(e,"0"),this._currentOffer.price=0}},_subscribeToApplePackEvents:function(){its.notifications.subscribe(its.dv14.ApplePack.Event.DOWNLOADALL,this._downloadAllEvent.bind(this))},_sendBuyEventToApplePack:function(){its.notifications.publish(its.dv14.ApplePack.Event.DOWNLOAD_ONE,{})},_offer:function(){return this._currentOffer},renderAsString:function(){return this.setAttribute("data-content-id",this._content.id),its.sf.ProductPageUtil.isUniversalApp(this._content)&&this.setAttribute("badge","resource://plus"),this._content.feedUrl&&this.setAttribute("feed-url",this._content.feedUrl),this._content.bundleId&&this.setAttribute("bundle-id",this._content.bundleId),this._setType(its.sf14.ComponentUtil.ButtonType.BUY),this.addClass(this._buttonStyle),this._refreshGivenHideability(),this._shouldShowAsView()?(this.setAttribute("data-url",this._content.url),this.template.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(this._attributes))):(this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSelectEvent.bind(this),this.itsId()),this.subscribeToTarget(its.sf14.Events.DISABLEDSELECT,this._handleDisabledSelectEvent.bind(this),this.itsId())),this._markup=this.template.compose(this.itsId()),this.subscribeToTarget(its.sf14.Events.ACTION,this._setMetricsTargetInfo.bind(this),this.itsId()),this.subscribeToTarget(its.sf14.Events.BUY_REQUIRES_PERMISSION,this._handleAskToBuy.bind(this),this._content.id),this._personalize(),this._markup},_disableOffer:function(){this._ignoreDisabled=!1,this._setDisabled(!0)},_shouldHideButton:function(){return its.App.ParentalRequestData||its.dv14.Util.Client.isAppStore()&&Device.isInRetailDemoMode||(this._kind==its.sf.StorePlatform.Kind.MobileApp||this._kind==its.sf.StorePlatform.Kind.MobileAppBundle)&&!its.sf.ParentalRatingUtil.isAppInstallationAllowed()||this._unpersonalizedOffer()&&this._unpersonalizedOffer().type==its.sf.StorePlatform.Offer.Type.RENT&&its.sf.StorePlatformUtil.isOwnedOffer(this._offer())&&!this._offer().rentalExpirationDate||this._unpersonalizedOffer()&&this._unpersonalizedOffer().type==its.sf.StorePlatform.Offer.Type.BUY&&its.sf.StorePlatformUtil.isOwnedOffer(this._offer())&&this._offer().rentalExpirationDate},_refreshGivenHideability:function(){this._isFirstPartyHideableApp?this._shouldFilterFirstPartyHideableApp?this._disableOffer():this._handleFirstPartyHideableApp():this._offer()&&this._updateButtonState(this._offer())},_refresh:function(){this._refreshGivenHideability()},_updateButtonState:function(e){this._currentOffer=e,this._offer().variant?this.setAttribute("data-variant",this._offer().variant):this.removeAttribute("data-variant");
if(this._offer().type){var t;
this._offer().type==="anonymousDownload"?t="buy":this._unpersonalizedOffer()&&this._unpersonalizedOffer().type===its.sf.StorePlatform.Offer.Type.RENT?t="rent":t=this._offer().type,this.setAttribute("data-type",t)}else this.removeAttribute("data-type");
this._shouldSuppressCloudRestoreForContent(this._content)&&this.setAttribute("suppress-cloud-restore","true");
var n=this._offer().price===0,r=!this._isPurchasableInStore()&&!n&&!this.lookup("overrideLinkUrl")&&!this._shouldShowAsView()||this.lookup("showAsButtonless");
this._setButtonless(r);
if(this._offer().type==its.sf.StorePlatform.Offer.Type.PURCHASED)this._showAsPurchased();
else if(this._offer().type==its.sf.StorePlatform.Offer.Type.PREORDERED)this._showAsPreOrdered();
else if(this._offer().type==its.sf.StorePlatform.Offer.Type.REDOWNLOAD||this._offer().type==its.sf.StorePlatform.Offer.Type.UPDATE){if(this._usesVideosApp()&&this.element){var i=its.sf.Client.isVersion("10.1")||itms.areVideosCloudPurchasesEnabled&&itms.areVideosCloudPurchasesEnabled(),s=!isNaN(e.ownerDsid)&&e.ownerDsid!=itms.DSID;
!s&&i&&its.sf.ParentalRatingUtil.doesPass(this._content)&&(this.element.setAttribute("supportsPlayButton","YES"),this.element.parentNode&&this.element.parentNode.setAttribute&&this.element.parentNode.setAttribute("supportsPlayButton","YES"))}this._showAsDownload()}else if(this._content.kind==its.sf.StorePlatform.Kind.PodcastEpisode)if(this._offer().assets.length>0){var o=this._offer().assets[0].flavor.toLowerCase(),u=o.indexOf("audio")===-1&&o.indexOf("video")===-1;
u?this._showAsOpen():this._showAsDownload()}else this._showAsDownload();
else{var a=this._overrideText(),f="",l="";
a?f=a:(f=this.actionText(),l=this.confirmText()),this._setActionText(f),this._setConfirmText(l),itms.managedAppleID&&TabBar.selectedTab.identifier!=="purchased"&&this._content.kind!==its.sf.StorePlatform.Kind.Podcast&&this._content.kind!==its.sf.StorePlatform.Kind.PodcastEpisode&&this._disableOffer(),this._shouldFilterFirstPartyHideableApp&&this._disableOffer(),this._isUnsupportedPreOrder()&&this._disableOffer()}this._shouldHideButton()?this._hide():this._show()},_updateButtonStyle:function(e){e!==this._buttonStyle&&(this.removeClass(this._buttonStyle),this.addClass(e),this._buttonStyle=e)},_isUnsupportedPreOrder:function(){var e=this._offer();
if(!e||!this._content)return!1;
var t=this._content.kind;
return(e.type===its.sf.StorePlatform.Offer.Type.PREORDER||e.type===its.sf.StorePlatform.Offer.Type.PREORDERED)&&(t===its.sf.StorePlatform.Kind.MobileApp||t===its.sf.StorePlatform.Kind.MobileAppBundle||t===its.sf.StorePlatform.Kind.MacApp)},_handleSelectEvent:function(e){this._setMetricsTargetInfo(e);
if(this._isFirstPartyHideableApp)this._isHidden&&itms.restoreRemovedSystemApp(this._content.bundleId,function(){});
else{var t=this.lookup("overrideLinkUrl");
t?its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:t}):this._performBuy()}},_handleFirstPartyHideableApp:function(){var e=function(e){e?(this._isHidden=!0,this._showAsDownload()):(this._isHidden=!1,this._setType(its.sf14.ComponentUtil.ButtonType.BUY),this._setActionText(its.loc("DV14.ActionText.FREE")))};
itms.isRemovedSystemApp(this._content.bundleId,e.bind(this))},_handleDisabledSelectEvent:function(e){if(its.dv14.Util.Client.isPodcasts()&&podcasts.presentExplicitRestrictionAlertIfNeededOfType)podcasts.isSubscribed&&!podcasts.isSubscribed(this._content)&&podcasts.presentExplicitRestrictionAlertIfNeededOfType("onPurchase",function(){});
else{itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onPurchase",function(){});
if(itms.managedAppleID){var t={type:"error",title:its.loc("MZCommerce.PurchaseBlockedForSpecialEdu_message"),neutral:{text:its.loc("OK")}},n=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",t,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:n,options:{type:"error"},pageTarget:its.sf14.PageController.PageTarget.MODAL})}}},_downloadAllEvent:function(e){this._performBuy()},_performBuy:function(){this._belongsToApplePackSheet&&this._sendBuyEventToApplePack();
if(this._kind==its.sf.StorePlatform.Kind.PodcastEpisode){this._performBuyOfPodcastEpisode();
return}var e=Class.shallowClone(this._offer());
if((!e||!e.buyParams)&&e.type!=="subscribe")return;this._content.hasMessagesExtension&&(its.dv14.Util.Client.isVoyager()||this._content.isHiddenFromSpringboard)&&(e.shouldEnableMessagesExtension=!0);
var t=Class.shallowClone(this._content);
t.offers=[e],t.documentUrl=this.documentUrl(),t.buyButton=this.element;
var n;
this.rootComponent.pageInfo&&(t.pageInfo=this.rootComponent.pageInfo(),t.pageInfo&&t.pageInfo.metricsBase&&(n=t.pageInfo.metricsBase.page));
var r=this.lookup("siriTabAffiliateToken");
if(r&&r.length>0)for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&oneTimeBuyAffiliateToken="+r;
t.clientBuyId=its.dv14.BuyButton.createBuyClientId();
var s=null;
this.lookup("isProductDirectlyFromSearch")&&(s=its.App.SearchDocument.componentRepresentation.term());
var o=its.sf.Metrics.Events.BuyConfirmed.metricsBuyParamsString(its.objectAtPath("pageInfo.metricsBase.pageId",t),its.objectAtPath("pageInfo.metricsBase.pageType",t),its.objectAtPath("pageInfo.metricsBase.pageContext",t),s,its.sf.Metrics._TOPIC_MAIN);
for(var i=0;
i<t.offers.length;
i++)n&&(t.offers[i].buyParams+="&origName="+n),t.offers[i].buyParams+="&clientBuyId="+t.clientBuyId+"&"+o;
if(this._lookupDocumentLevelData("extRefUrl2")){var u=this._lookupDocumentLevelData("extRefUrl2");
for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&extRefUrl2="+encodeURIComponent(u)}if(this._lookupDocumentLevelData("extRefApp2")){var a=this._lookupDocumentLevelData("extRefApp2");
for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&extRefApp2="+encodeURIComponent(a)}var f=its.dv14.Util.Client.isPodcasts(),l=f&&typeof podcasts.subscribe=="function",c=f&&typeof podcasts.subscribeWithCallback=="function";
if(e.type==="subscribe"&&(l||c))c?(this._setDisabled(!0),podcasts.subscribeWithCallback(t,function(e){this._setDisabled(!1)}.bind(this))):podcasts.subscribe(t);
else{its.sf.Client.isVersion("10.0")&&this._usesVideosApp()&&e.type!==its.sf.StorePlatform.Offer.Type.PREORDER&&(this._shouldShowUserHLSDialog=its.property("DV14.Videos.showHLSDialogAndOptions")&&localStorage.getItem("hasUserSeenHLSDialog")!=="true",e.type!==its.sf.StorePlatform.Offer.Type.REDOWNLOAD&&(its.notifications.unsubscribe(its.sf14.Events.BUY_DID_COMPLETE,this._buyDidCompleteCallback),this._buyDidCompleteCallback=this._buyDidComplete.bind(this,t,e),this.subscribe(its.sf14.Events.BUY_DID_COMPLETE,this._buyDidCompleteCallback)));
var h=e.type===its.sf.StorePlatform.Offer.Type.REDOWNLOAD,p=e.type===its.sf.StorePlatform.Offer.Type.RENT&&this.isRented&&!its.sf.Client.isVersion("10.3");
p&&(this._isDownloadingRentalPreErie=!0);
var d=this._usesVideosApp()&&(h||p)&&itms.networkConnectionType!=="WiFi"&&its.sf.Client.isVersion("10.0");
if(d){var v={type:its.sf14.DialogDocument.Type.ERROR,title:its.loc("DV14.Videos.ConnectToWifi.Title"),description:its.loc("DV14.Videos.ConnectToWifi.Description"),positive:{text:its.loc("OK")}},m=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",v,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:m,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})}else this._buy(t)}},_buyDidComplete:function(e,t,n){if(this._content.id!=(n.product&&n.product.id))return;its.notifications.unsubscribe(its.sf14.Events.BUY_DID_COMPLETE,this._buyDidCompleteCallback);
if(t.type==="rent"){its.sf.Client.isVersion("10.3")||this._removeBuyButtonAfterRental();
if(its.sf.Client.isVersion("10.0.2")&&!its.sf.Client.isVersion("10.3"))return}this._shouldShowUserHLSDialog&&itms.areVideosCloudPurchasesEnabled&&itms.areVideosCloudPurchasesEnabled()?this._showUserHLSDialog(e,t,n):this._promptWatchOptions(e,t,n)},_removeBuyButtonAfterRental:function(){var e,t=this.element.ownerDocument.getElementsByTagName("offer");
if(!this.isRented&&t.length)for(var n=t.length-1;
n>=0;
n--)e=t&&t.length&&t.item(n)&&t.item(n).getElementsByTagName("button"),e&&e.length&&e.item(0).getAttribute("data-type")==="buy"&&t.item(n).remove()},_updateRentalState:function(e){this.isRented=e["item-id"]==this._content.id&&!!e["expiration-date"]},_showUserHLSDialog:function(e,t,n){if(this._shouldShowUserHLSDialog&&localStorage.getItem("hasUserSeenHLSDialog")!=="true"){this._shouldShowUserHLSDialog=!1,localStorage.setItem("hasUserSeenHLSDialog","true");
var r={type:"dialog",title:its.loc("DV14.Videos.StreamingAvailable.Title"),description:its.loc("DV14.Videos.StreamingAvailable.Description"),neutral:{text:its.loc("OK"),callback:this._promptWatchOptions.bind(this,e,t,n)}},i=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",r,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:i,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})}},_promptWatchOptions:function(e,t,n){if(this._isDownloadingRentalPreErie){this._isDownloadingRentalPreErie=!1,this._buy(e);
return}if(e.kind=="movieBundle"){this._movieBundlePurchased=!0,this._showAsPurchased();
return}var r;
e.kind==="tvSeason"?r=its.loc("DV14.Videos.WatchNowDialog.WatchFirstEpisode"):r=its.loc("DV14.Videos.WatchNowDialog.Title",{videoName:e.name});
var i={type:"dialog",title:r,positive:{text:its.loc("DV14.Videos.WatchNowDialog.WatchNow"),callback:this._watchNow.bind(this,e)},negative:{text:its.loc("DV14.Videos.WatchNowDialog.Download"),callback:this._downloadNow.bind(this,e,t)},neutral:{text:its.loc("MZStore.NotNowButton")}};
if(!its.property("DV14.Videos.showHLSDialogAndOptions")||itms.areVideosCloudPurchasesEnabled&&!itms.areVideosCloudPurchasesEnabled())e.kind==="tvSeason"?r=its.loc("DV14.Videos.WatchNowDialog.TitleDownloadFirstEpisode"):r=its.loc("DV14.Videos.WatchNowDialog.TitleDownload",{videoName:e.name}),i={type:"dialog",title:r,positive:{text:its.loc("MZStore.NotNowButton")},negative:{text:its.loc("DV14.Videos.WatchNowDialog.Download"),callback:this._downloadNow.bind(this,e,t)}};
var s=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",i,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:s,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},_watchNow:function(e){if(e.kind==="tvSeason")its.notifications.publishToTarget(its.dv14.TvSeasonPage.Events.WATCH_FIRST_EPISODE,{watchNow:!0},this._content.id);
else{var t=e.id,n="videos://play?adam-id="+t+"&allowCloudPlayback=1";
openURL(n)}},_downloadNow:function(e,t){e.kind==="tvSeason"?its.notifications.publishToTarget(its.dv14.TvSeasonPage.Events.WATCH_FIRST_EPISODE,{downloadNow:!0},this._content.id):t.type==="rent"&&!its.sf.Client.isVersion("10.3")?this.isRented?this._buy(e):(this._rentalInfoChangedCallback=this._buy.bind(this,e),its.notifications.subscribe(its.sf14.Events.RENTAL_INFO_CHANGED,this._rentalInfoChangedCallback)):this._redownloadOfferAvailable?this._downloadPurchasedContent():(this._downloadPurchasedContentCallback=this._downloadPurchasedContent.bind(this),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._downloadPurchasedContentCallback))},_downloadPurchasedContent:function(){its.notifications.unsubscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._downloadPurchasedContentCallback),setTimeout(this._performBuy.bind(this),100)},_downloadFirstEpisdode:function(e){e.watchNow?this._watchNow({id:this._content.id}):e.downloadNow&&(this._redownloadOfferAvailable?this._performBuy():(this._downloadPurchasedContentCallback=this._downloadPurchasedContent.bind(this),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._downloadPurchasedContentCallback)))},_performBuyOfPodcastEpisode:function(){if(!its.dv14.Util.Client.isPodcasts()){var e=this._content.url,t=this._content.itunesuType;
if(t){var n=its.url.baseUrl(e),r=its.url.queryParamsDict(e);
r.mt="10",e=its.url.appendUrlParameters(n,r),e=its.url.changeUrlScheme(e,"itms-itunesus")}this._refresh();
var i={isiTunesU:t,kind:this._kind,url:e};
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,i)}else{var s=this._offer().assets[0].flavor.toLowerCase(),o=s.indexOf("audio")===-1&&s.indexOf("video")===-1;
o?openURL(this._content.offers[0].download.url):this._content.podcastEpisodeGuid?this._downloadPodcast():this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.ITEM,ids:[this._content.id],onOK:function(e){var t=e[e.orderedKeys[0]],n=t.podcastEpisodeGuid;
n&&(this._content.podcastEpisodeGuid=n,this._downloadPodcast())}.bind(this),suppressPersonalization:!0}])}},_downloadPodcast:function(){var e=this.createDownloadDictForPodcastEpisode();
itms.download(e)},createDownloadDictForPodcastEpisode:function(){var e=new Object;
e["episode-kind"]="episode",e["collection-id"]=this._content.collectionId+"",e.type="podcast-episode",e["artist-name"]=this._content.artistName,e["genre-name"]=this._content.genres[0].name,e["collection-name"]=this._content.collectionName,e["unmodified-title"]=this._content.nameRaw,e["item-id"]=parseInt(this._content.id),e.itemId=e["item-id"],e.url=this._content.url;
var t=this._content.releaseDate;
t&&(e["release-date"]=t),e["episode-guid"]=this._content.podcastEpisodeGuid,e.longDescription=this._content.description?this._content.description.standard:undefined;
var n=this._content.feedUrl;
n&&(e["podcast-feed-url"]=n),e["podcast-type-dzc"]="1";
var r=new Object;
r["asset-url"]=this._content.offers[0].download.url,r.duration=parseInt(this._content.offers[0].assets[0].duration);
var i=this._content.offers[0].assets[0].flavor,s=i&&i.indexOf("Video")!==-1,o=s?"standard-video":"standard-audio",u=new Object;
u[o]=r,u.foo=r,e["store-offers"]=u;
var a=new Object,f=its.sf14.ArtworkUtil.bestArtworkForSize(this._content.artwork,{height:136,width:136});
a["box-height"]=parseInt(f.height),a["box-width"]=parseInt(f.width),a.url=f.url;
var l=new Object,c=its.sf14.ArtworkUtil.bestArtworkForSize(this._content.artwork,{height:340,width:340});
l["box-height"]=parseInt(c.height),l["box-width"]=parseInt(c.width),l.url=c.url;
var h=new Array(a,l);
return e["artwork-urls"]=h,e},_overrideText:function(){return this.lookup("overrideText")},actionText:function(){var e="",t=this._offer(),n=t.price===0,r=n?null:{price:t.priceFormatted},i="DV14.ActionText.BUY";
return n&&(i="DV14.ActionText.FREE"),t.type==its.sf.StorePlatform.Offer.Type.RENT&&(i=n?"DV14.ActionText.RENT.free":"DV14.ActionText.RENT"),this._shouldShowAsView()&&(i="DV14.ActionText.VIEW"),t.type==its.sf.StorePlatform.Offer.Type.PREORDER&&!this._isUnsupportedPreOrder()&&(i="DV14.ActionText.PREORDER"),!n&&!t.price&&this._content.kind==its.sf.StorePlatform.Kind.TvEpisode&&(i="DV14.ActionText.SEASON_ONLY"),!n&&!t.price&&(this._content.kind==its.sf.StorePlatform.Kind.Song||this._content.kind==its.sf.StorePlatform.Kind.MusicVideo||this._content.kind==its.sf.StorePlatform.Kind.Booklet||this._content.kind==its.sf.StorePlatform.Kind.Work)&&(t.preorderOnly?i="DV14.ActionText.PREORDER_ONLY":i="DV14.ActionText.ALBUM_ONLY"),i+="."+this._content.kind,t.variant==its.sf.StorePlatform.Offer.Variant.HD&&(i+="."+its.sf.StorePlatform.Offer.Variant.HD),e=its.dv14.BuyButton.locButtonText(i,r),e||(e=t.actionText.short),e},_setActionText:function(e){this._actionText=e,this.element?this.element.textContent=e:this.template.replaceToken("actionText",e),this._updateButtonStyle(this._buttonStyle)},_clearActionText:function(){this.element?this.element.textContent="":this.template.replaceToken("actionText","")},confirmText:function(){var e="";
if(!this._shouldShowAsView()){var t=this._offer(),n=t.price===0,r="DV14.ConfirmText.BUY";
n&&(r="DV14.ConfirmText.FREE"),t.type==its.sf.StorePlatform.Offer.Type.RENT&&(r="DV14.ConfirmText.RENT"),t.type==its.sf.StorePlatform.Offer.Type.PREORDER&&!this._isUnsupportedPreOrder()&&(r="DV14.ConfirmText.PREORDER"),r+="."+this._content.kind,this._content.isSingle&&(r+=".single"),this._content.passType&&(r+="."+this._content.passType+"Pass"),t.variant==its.sf.StorePlatform.Offer.Variant.HD&&(r+="."+its.sf.StorePlatform.Offer.Variant.HD),e=its.dv14.BuyButton.locButtonText(r)}return e},_setConfirmText:function(e){if(its.dv14.Util.Client.isPodcasts()||its.dv14.Util.UI.isTVOnlyApp(this._content)||its.sf.Client.isVersion("11.0"))return;this._confirmText=e,this.setAttribute("confirm-text",e)},_clearConfirmText:function(){this.setAttribute("confirm-text","")},_setButtonless:function(e){this._setDisabled(e||this._shouldDisable()),e?(this._setType(its.sf14.ComponentUtil.ButtonType.TEXT_ONLY),this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.buttonless)):(this._setType(its.sf14.ComponentUtil.ButtonType.BUY),this._updateButtonStyle(this._buttonStyle))},_setTextOnly:function(e){e?(this._originalButtonStyle=this._buttonStyle,this.setAttribute("type",its.sf14.ComponentUtil.ButtonType.TEXT_ONLY),this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.textonly)):(this.setAttribute("type",its.sf14.ComponentUtil.ButtonType.BUY),this._updateButtonStyle(this._originalButtonStyle))},_setDisabled:function(e){var t=this._content&&this._usesVideosApp()&&this._content.kind!==its.sf.StorePlatform.Kind.MusicVideo,n=its.sf14.Util.UI.SupportsDisabledButSelectable()&&this.lookup("showAsButtonless")!==!1&&this.lookup("showActionTextAndPrice")!==!1&&!t,r=n?"disabled-but-selectable":"disabled";
e&&!this._ignoreDisabled?this.setAttribute(r,"true"):this.removeAttribute(r)},_hide:function(){this._setType(),this._clearActionText(),this._clearConfirmText()},_show:function(){this._setType(this._type),this._setActionText(this._actionText),this._setConfirmText(this._confirmText)},_setType:function(e){e?(this._type=e,this.setAttribute("type",this._type)):this.removeAttribute("type")},_showAsPurchased:function(){this._setActionText(its.loc("DV14.BuyButton.Purchased")),this._setConfirmText(""),this._setDisabled(!0),(!its.sf.Client.isVersion("13.0")||!its.dv14.Util.Client.isITunes())&&this._setButtonless(!0)},_showAsPreOrdered:function(){this._setActionText(its.loc("DV14.BuyButton.PreOrdered")),this._setConfirmText(""),this._setDisabled(!0),this._setButtonless(!0)},_showAsDownload:function(){this._setActionText(""),this._setConfirmText(""),this._setDisabled(this._shouldDisable()),this._setType(its.sf14.ComponentUtil.ButtonType.DOWNLOAD),this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.download)},_showAsOpen:function(){this._setActionText(its.loc("DV14.ActionText.OPEN")),this._setConfirmText(""),this._setDisabled(this._shouldDisable()),this._setType(its.sf14.ComponentUtil.ButtonType.BUY),this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.default)},_unpersonalizedOffer:function(){if(!this._myUnpersonalizedOffer&&this._content.offers){var e=this.lookup("offer");
if(its.sf.StorePlatformUtil.isPersonalizedOffer(e)){var t=its.sf.StorePlatformUtil.findBuyOffers(this._content.offers);
for(var n=0;
n<t.length;
n++)if(e.variant==t[n].variant){this._myUnpersonalizedOffer=t[n];
break}}else this._myUnpersonalizedOffer=e}return this._myUnpersonalizedOffer},_shouldDisable:function(){var e=!1;
return this.lookup("forceDisabled")&&(e=!0),its.sf.ParentalRatingUtil.doesPass(this._content)||(e=!0),e},_shouldShowAsView:function(){var e=(this._kind==its.sf.StorePlatform.Kind.Mix||this._kind==its.sf.StorePlatform.Kind.RingtoneAlbum)&&this._offer()&&its.sf.StorePlatformUtil.isVisibleButNotAvailable(this._offer());
return e||this.lookup("showAsViewButton")||this._kind==its.sf.StorePlatform.Kind.EBookMeta},_isPurchasableInStore:function(){var e=this._unpersonalizedOffer();
return e&&its.isDefinedNonNull(e.price)&&(e.type==its.sf.StorePlatform.Offer.Type.BUY||e.type==its.sf.StorePlatform.Offer.Type.RENT||e.type==its.sf.StorePlatform.Offer.Type.PREORDER)},_usesVideosApp:function(){var e=this._content.kind==its.sf.StorePlatform.Kind.MusicVideo&&!its.sf.Client.isVersion("10.0");
return this._content.kind==its.sf.StorePlatform.Kind.TvEpisode||this._content.kind==its.sf.StorePlatform.Kind.TvSeason||this._content.kind==its.sf.StorePlatform.Kind.Movie||this._content.kind==its.sf.StorePlatform.Kind.MovieBundle||this._content.kind==its.sf.StorePlatform.Kind.ShortFilm||e},_usesIBooksApp:function(){return this._content.kind==its.sf.StorePlatform.Kind.EBook||this._content.kind==its.sf.StorePlatform.Kind.EBookApple||this._content.kind==its.sf.StorePlatform.Kind.EBookMeta||this._content.kind==its.sf.StorePlatform.Kind.EBookSeries||this._content.kind==its.sf.StorePlatform.Kind.Audiobook||this._content.kind==its.sf.StorePlatform.Kind.EBookTextbook},_usesMusicApp:function(){var e=this._content.kind==its.sf.StorePlatform.Kind.MusicVideo&&its.sf.Client.isVersion("10.0");
return this._content.kind==its.sf.StorePlatform.Kind.Song||this._content.kind==its.sf.StorePlatform.Kind.Work||this._content.kind==its.sf.StorePlatform.Kind.Mix||this._content.kind==its.sf.StorePlatform.Kind.Album||e},_handlePersonalizationEvent:function(e){this.storePlatform==e.caller&&its.isDefined(e.data[this._content.id])&&this._personalize()},_personalize:function(){if(this._content.kind==="movieBundle"&&this._movieBundlePurchased)return;if(this._content.kind!=its.sf.StorePlatform.Kind.Audiobook||this._content.kind==its.sf.StorePlatform.Kind.Audiobook&&its.sf.Client.isVersion("9.3")){var e=[],t=this.storePlatform.getCachedOffersArray(this._content.id);
t.length>0&&(e=its.sf.StorePlatformUtil.orderedOffers(t));
if(e.length>0){var n=null,r=this._unpersonalizedOffer();
r&&this._usesVideosApp()&&!Object.keys(r).length&&(r=e[0]);
if(r){for(var i=0;
i<e.length;
i++){if(r.variant==e[i].variant){n=e[i],n.type==="redownload"&&n.moviesAnywhereEntitlement===0&&its.notifications.publish(its.dv14.ProductPage.Events.UPDATE_PRODUCT_DATA,{id:this._content.id,hide4kAndHdrBadges:!0});
break}if(e[i].type==="redownload"&&this._usesVideosApp()&&this._isPurchasedModal&&!e[i].variant){if(!this._content.seasonId){var s={pageState:its.sf14.ProductPage.State.SD,contentId:this._content.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,s);
return}n=e[i];
break}}r&&n&&r.type==its.sf.StorePlatform.Offer.Type.RENT&&n.type!=its.sf.StorePlatform.Offer.Type.REDOWNLOAD&&n.type!=its.sf.StorePlatform.Offer.Type.RENT?n=null:r&&n&&this._isPurchasedModal&&r.variant==="HD"&&!n.variant&&(n=null)}n&&n.type===its.sf.StorePlatform.Offer.Type.REDOWNLOAD&&(this._redownloadOfferAvailable=!0),n!=null&&this._updateButtonState(n)}}},_handleAskToBuy:function(){this._setTextOnly(!0),this.subscribeToTarget("approveInPersonSucceded",function(){this._setTextOnly(!1)}.bind(this),this._content.id)},onElementCreated:function(e){this._refresh()},_setMetricsTargetInfo:function(e){e&&e.action&&(e.eventInfo.name="");
if(this.element){var t=this._content?this._content.id:null,n,r;
if(e&&e.eventInfo&&e.eventInfo.name==its.sf14.Events.ACTION)n=its.sf.Metrics.ActionType.SELECT,r=this._content?this._content.bundleId:null,its.sf.Metrics.setTargetInfo(this.element,t,"button",n,null,r),its.notifications.publish(its.sf14.Events.SELECT,{pageInfo:e.pageInfo,target:this.element});
else{n=this._getMetricsActionType(e);
if(n==its.sf.Metrics.ActionType.BUY||n==its.sf.Metrics.ActionType.UPDATE||n==its.sf.Metrics.ActionType.DOWNLOAD){var i=this._offer(),s=i?i.buyParams:null;
s?r={buyParams:s}:i&&i.download&&i.download.url&&(r=i.download.url)}its.sf.Metrics.setTargetInfo(this.element,t,"button",n,null,r);
if(n==its.sf.Metrics.ActionType.BUY_INITIATE||n==its.sf.Metrics.ActionType.OPEN)this._recordEventThatDoesNotHaveASelectHandler(e,n);
else if(n==its.sf.Metrics.ActionType.DOWNLOAD&&its.dv14.Util.Client.isPodcasts()){var o=this.createDownloadDictForPodcastEpisode(),u=this._content,a=its.dv14.PodcastReportingUtil.reportDownload({episodeGuid:u.podcastEpisodeGuid,episodeKind:o["episode-kind"],episodeUrl:u.offers[0].download.url,feedUrl:u.feedUrl,podcastName:u.collectionName,podcastId:u.collectionId,podcastType:o["podcast-type-dzc"]}),f=its.sf.Metrics.Events.Click.clickTargetElement(e.target),l=its.sf.Metrics.Events.Click.clickDataFromElement(f,null,e.x,e.y),c=e.pageInfo;
if(l&&c){l.actionType=its.sf.Metrics.ActionType.DOWNLOAD,l.impressions=[],f.ownerDocument&&(l.impressions=its.sf14.Metrics.Events.Impressions.processRecordedImpressions(f.ownerDocument.snapshotImpressions()).impressionsArray);
if(podcasts.isDiagnosticSubmissionAllowed&&podcasts.isDiagnosticSubmissionAllowed()){var h=new its.sf14.Metrics.Events.Click(l,c.metricsBase);
h.topic="xp_its_podcasts_main",h.fields=Class.extend(h.fields,a),h.fields.topic="xp_its_podcasts_main",h.fields.eventType="reporting_event",h.fields.pageType="download",its.sf.Metrics.recordEvent(h,"xp_its_podcasts_main")}}}}}},_getMetricsActionType:function(e){var t="",n=this._offer();
if(e&&e.action){switch(e.action){case"buyInitiate":t=its.sf.Metrics.ActionType.BUY_INITIATE;
break;case"buy":t=its.sf.Metrics.ActionType.BUY;
break;case"download":t=its.sf.Metrics.ActionType.DOWNLOAD;
break;case"update":t=its.sf.Metrics.ActionType.UPDATE;
break;case"open":t=its.sf.Metrics.ActionType.OPEN;
break;default:t=its.sf.Metrics.ActionType.BUY}return t}if(n){if(n.type==its.sf.StorePlatform.Offer.Type.UPDATE)return its.sf.Metrics.ActionType.UPDATE;
if(n.type==its.sf.StorePlatform.Offer.Type.REDOWNLOAD||n.type==its.sf.StorePlatform.Offer.Type.ANONYMOUS_DOWNLOAD)return its.sf.Metrics.ActionType.DOWNLOAD;
if(n.type==its.sf.StorePlatform.Offer.Type.BUY||n.type==its.sf.StorePlatform.Offer.Type.COMPLETE||n.type==its.sf.StorePlatform.Offer.Type.GET||n.type==its.sf.StorePlatform.Offer.Type.RENT||n.type==its.sf.StorePlatform.Offer.Type.PREORDER)return its.sf.Metrics.ActionType.BUY;
if(n.type==its.sf.StorePlatform.Offer.Type.SUBSCRIBE)return its.sf.Metrics.ActionType.SUBSCRIBE}},_recordEventThatDoesNotHaveASelectHandler:function(e,t){var n=e.pageInfo;
if(n){var r=its.sf.Metrics.Events.Click.clickTargetElement(e.target),i=its.sf.Metrics.Events.Click.clickDataFromElement(r,null,e.x,e.y);
if(i){i.actionType=t,i.impressions=r.ownerDocument?its.sf14.Metrics.Events.Impressions.processRecordedImpressions(r.ownerDocument.snapshotImpressions()).impressionsArray:[];
var s=n.metricsBase;
e.target.metrics&&e.target.metrics.iAdId&&(i.iAdId=e.target.metrics.iAdId,i.iAdAlgoId=e.target.metrics.iAdAlgoId,i.iAdMetadata=e.target.metrics.iAdMetadata,i.iAdFormat=e.target.metrics.iAdFormat),its.sf.Metrics.recordEvent(new its.sf14.Metrics.Events.Click(i,s))}}},_buy:function(e){var t;
its.notifications.unsubscribe(its.sf14.Events.RENTAL_INFO_CHANGED,this._rentalInfoChangedCallback),its.sf.Client.isVersion("10.0")&&(this._usesIBooksApp()?t=its.dv14.Util.BundleId.IBOOKS:this._usesVideosApp()?t=its.dv14.Util.Client.isTvSupported()?its.dv14.Util.BundleId.TV:its.dv14.Util.BundleId.VIDEOS:this._usesMusicApp()&&(t=its.dv14.Util.BundleId.MUSIC));
var n=its.dv14.Util.UI.isTVOnlyApp(this._content);
n?its.sf.Client.isVersion("10.1")?this._displayTVOSMessages(function(){itms.buy(e)}):this._displayUpdateIOSVersionDialog(its.loc("iOS"),"10.1",this._content.kind):t&&itms.isRemovedSystemApp?itms.isRemovedSystemApp(t,function(n){n?this._displayHiddenSystemAppMessage(t):itms.buy(e)}.bind(this)):itms.buy(e)},_displayHiddenSystemAppMessage:function(e){var t,n,r=its.dv14.Util.BundleId.adamIdForBundleId(e),i=r?"https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id="+r+"&mt=8":null;
e==its.dv14.Util.BundleId.VIDEOS?(t="DV14.VideoHidden.Title",n="DV14.VideoHidden.DownloadFromAppStore",i=itms.getBag().productPageForVideos||i):e==its.dv14.Util.BundleId.TV?(t="DV14.TvHidden.Title",n="DV14.TvHidden.DownloadFromAppStore",i=itms.getBag().productPageForTv||i):e==its.dv14.Util.BundleId.IBOOKS?(t="DV14.IBooksHidden.Title",n=this._content.kind==its.sf.StorePlatform.Kind.Audiobook?"DV14.IBooksHidden.DownloadFromAppStore.Audiobook":"DV14.IBooksHidden.DownloadFromAppStore",i=itms.getBag().productPageForIBooks||i):e==its.dv14.Util.BundleId.MUSIC&&(t="DV14.MusicHidden.Title",n="DV14.MusicHidden.DownloadFromAppStore",i=itms.getBag().productPageForMusic||i);
var s={type:"dialog",title:its.loc(t),description:its.loc(n),positive:{text:its.loc("DV14.VideoHidden.Dialog.AppStore"),callback:function(){var e=i||"itms-appss://";
openURL(e)}},negative:{text:its.loc("Cancel")}},o=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",s,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:o,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},_displayTVOSMessages:function(e){var t=function(e){var t=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",e,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:t,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},n={type:"dialog",title:its.loc("DV14.BuyButton.GameControllerConfirmation.Title"),description:its.loc("DV14.BuyButton.GameControllerConfirmation.Description"),positive:{text:its.loc("Continue"),callback:e},negative:{text:its.loc("Cancel"),type:"cancel"}},r={type:"dialog",title:its.loc("DV14.BuyButton.TVOnlyConfirmation.Title"),description:its.loc("DV14.BuyButton.TVOnlyConfirmation.Description"),positive:{text:its.loc("Continue"),callback:function(){this._content.requiresGameController?t(n):e()}.bind(this)},negative:{text:its.loc("Cancel"),type:"cancel"}};
t(r)},_shouldSuppressCloudRestoreForContent:function(e){return its.dv14.Util.UI.isTVOnlyApp(e)},_displayUpdateIOSVersionDialog:function(e,t,n){var r={type:"dialog",title:its.loc("DV14.BuyButton.updateIOSVersion.title"),description:its.loc("DV14.BuyButton.updateIOSVersion.description",{version:t,typeNameInLowercase:n}),positive:{text:its.loc("Ok")}},i=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",r,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:i,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})}}),its.dv14.BuyButton.createBuyClientId=function(){var e=0;
return function(){return e++,e}}(),its.dv14.BuyButton.locButtonText=function(e,t){var n=its.loc(e,t);
while(n==e&&e.length>0)e=e.substr(0,e.lastIndexOf(".")),n=its.loc(e,t);
return n},its.dv14.BuyButton.ButtonStyle={"default":"buy-button",filled:"filled-buy-button",disabled:"buy-disabled",buttonless:"buy-buttonless",textonly:"buy-textonly",download:"buy-download",preorder:"buy-preorder",filledPreorder:"filled-buy-preorder"},its.dv14.BrickRow=Class.createSubclass("its.dv14.BrickRow",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._unAvailableContentIds=this.lookup("unAvailableContentIds")?this.lookup("unAvailableContentIds"):{}},templateName:function(){return"components/dv14_shelf"},componentType:function(){return"brick_row"},render:function(){this._adamId()&&this.template.replaceToken("adamId",this._adamId());
var e=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0,t=!1;
its.sf.Platform.iPadPro()&&(e=!1,t=!0),this.template.keepBlock("addHiddenDivider",t),this.template.keepBlock("showDivider",e);
if(this.data.title){this.template.keepBlock("headerBlock",!0);
var n=this.template.getBlock("headerBlock");
n.replaceToken("title",this.data.title)}var r=[];
this._contentIdToItsId={},this._contentIdToBrickComponent={},this._contentIds=[],this._redeemBricks=[],this._giftBricks=[],this.data.doNotFilter||(this.data.bricks=its.dv14.Util.UI.filterByInstalledApps(this.data.bricks,!0,2));
for(var i=0;
i<this._bricks().length;
i++){var s=this._bricks()[i];
if(s.link&&its.dv14.UpgradeDevice.isUpgradeUrl(s.link.url)){if(!its.dv14.UpgradeDevice.isUpgradeApplicable())continue;its.dv14.UpgradeDevice.setFeaturedLinkData(s.link)}if(s.fcKind==its.dv14.GroupingPage.FCKinds.mso_brick_marker)s=its.dv14.Util.Client.MSO.personalizedReplacementFCData(s);
else if(s.link&&s.link.type=="content"&&this._unAvailableContentIds[its.sf.StorePlatformUtil.contentIdFromLinkable(s)])continue;var o=this.componentWithData("brick",s),u=o.renderAsString();
if(s.link)switch(s.link.type){case"link":its.sf14.Util.isFinanceRedeemUrl(s.link.url)?this._redeemBricks.push(u):its.sf14.Util.isFinanceGiftUrl(s.link.url)&&this._giftBricks.push(u);
break;case"content":var a=its.sf.StorePlatformUtil.contentIdFromLinkable(s);
this._contentIdToItsId[a]=u.itsId(),this._contentIdToBrickComponent[a]=o,this._contentIds.push(a);
break;default:}r.push(u)}this._brickRowElement=this.template.composeAsElement(this.itsId()),this._brickRowElement.replaceTokenWithElement("lockups",its.element.createDocumentFragmentFromString(r.join(" "))),this._fetchContentBrickData();
for(i=0;
i<this._redeemBricks.length;
i++){var f=this._redeemBricks[i];
this.subscribeToTarget(its.sf14.Events.SELECT,its.dv14.DeepLinkUtil.openRedeemSheet,f.itsId())}for(i=0;
i<this._giftBricks.length;
i++){var l=this._giftBricks[i];
this.subscribeToTarget(its.sf14.Events.SELECT,its.dv14.DeepLinkUtil.openGiftSheet,l.itsId())}return this._setMetricsTargetInfoForBricks(this._brickRowElement),this._brickRowElement},_setMetricsTargetInfoForBricks:function(e){var t=e.querySelectorAll("lockup"),n,r;
if(t&&t.length>0)for(var i=0;
i<t.length;
i++)n=t[i],r=this._bricks()[i],n&&r&&this._setMetricsTargetAndLocationInfo(n,r)},_fetchContentBrickData:function(){if(this._contentIds.length==0)return;var e=function(e){this._brickDataFetched(e)}.bind(this),t={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.GROUPING,ids:this._contentIds,onOK:e};
this.storePlatform.fetchContentBatched(t)},_brickDataFetched:function(e){for(var t=0;
t<this._contentIds.length;
t++){var n=this._contentIds[t],r=this._brickRowElement.querySelector('[itsId = "'+this._contentIdToItsId[n]+'"]'),i=e[n],s=this._contentIdToBrickComponent[n];
s&&i?(s.updateBrickContent(i),this._setMetricsTargetAndLocationInfo(r,i)):r.parentNode.removeChild(r)}},_setMetricsTargetAndLocationInfo:function(e,t){var n=t.adamId?t.adamId:t.id,r=t.link&&t.link.url?t.link.url:t.url;
its.sf.Metrics.setLocationInfo(e,[t],"brick"),its.sf.Metrics.setTargetInfo(e,n,"brick",its.sf.Metrics.ActionType.SELECT,r);
if(t&&t.link&&t.link.type&&t.link.type==="content"&&its.dv14.Util.Client.isAppStore())try{var i=e.getAttribute("data-metrics");
i&&(i=JSON.parse(i),i.kind=t.content?t.content.kind:"iOSSoftware",e.setAttribute("data-metrics",JSON.stringify(i)))}catch(s){this._logger.error(["---------- _setMetricsTargetAndLocationInfo: Unable to attach metrics data for iOSSoftware on a brick element"+s])}},_adamId:function(){return this.data.adamId},_bricks:function(){return this.data.bricks},_parent:function(){return this.data.parent}}),its.dv14.Brick=Class.createSubclass("its.dv14.Brick",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},componentType:function(){return"brick"},templateName:function(){var e="components/dv14_brick";
return this.data.type=="time"?e="components/dv14_timer_brick":this.data.type=="number"&&(e="components/dv14_counter_brick"),e},renderAsString:function(){if(this.data.link)switch(this.data.link.type){case"link":its.sf14.Util.isFinanceRedeemUrl(this.data.link.url)||its.sf14.Util.isFinanceGiftUrl(this.data.link.url)?(this.setAttribute("data-content-id",this.data.adamId),this.setAttribute("data-preview-id",this.data.adamId)):((its.sf14.Util.isRadioStationLink(this.data.link.url)||this.data.link.target==its.sf14.PageController.PageTarget.EXTERNAL)&&this.setAttribute("data-page-target",its.sf14.PageController.PageTarget.EXTERNAL),this.setAttribute("data-url",this.data.link.url),this.setAttribute("data-content-id",""),this.setAttribute("data-preview-id",""));
case"content":this.setAttribute("data-content-id",this.data.link.adamId),this.setAttribute("data-preview-id",this.data.link.adamId),this.data.content=this.storePlatform.getCachedData(this.data.link.adamId)}var e=its.dv14.SmallLockup.DefaultDetailsGenerator.generateAltTag(this.data);
if(this.data.endArtwork){var t={isEndBrick:!0,adamId:this.data.adamId,artwork:this.data.endArtwork,content:this.data.content,designLabel:this.data.designLabel,link:this.data.link};
this._endBrickComponent=this.componentWithData("brick",t),this.endBrick=this._endBrickComponent.render()}this.data.type=="number"?this.renderNumber():this.data.type=="time"?this.renderTime():this.data.externalBrickSourceUrl&&this.renderTimeline();
var n=this.data.artwork;
this.data.externalBrickSourceUrl&&(n=[{url:"",width:416,height:204}]);
var r=this.renderComponentStringWithData("artwork",{artworkUrls:n,size:its.sf14.LockupUtil.getArtworkDimensions("brick",null,this.documentSize()),crop:its.sf14.LockupUtil.getArtworkCropStyles("brick"),alt:e,classes:["brick-art"]});
return this.updateBrickContent(this.data.content),this.template.replaceTokenUnescaped("artwork",r),this._markup=this.template.compose(this.itsId()),this._markup},renderTime:function(){this.template.replaceToken("classes","brick-counter");
if(this.data.endDate){this.ended=!1,this.dateGMT=new Date(this.data.endDate),this.timeGMT=this.dateGMT.getTime();
var e=(new Date(this.timeGMT-this.dateGMT.getTimezoneOffset()*6e4)).toISOString();
e=e.replace(/.000/,""),this.endTime=this.timeGMT,this.updateTimer=setInterval(this.updateTime.bind(this),1e3),this.setAttribute("dateFormat",this.data.dateFormat?this.data.dateFormat:"dhms"),this.setAttribute("endDate",e)}},updateTime:function(){var e=new Date,t=e.getTime(),n=this.endTime-t;
n<=0&&(this.ended=!0,clearInterval(this.updateTimer),this.displayEndBrick())},renderNumber:function(){this.template.replaceToken("classes","brick-counter"),this.ended=!1,this.fetchData()},updateNumber:function(){if(this.fetchedData){var e=(new Date-new Date(this.fetchedData.sampleTimestamp*1e3))/1e3,t=this.fetchedData.count+e*(this.fetchedData.rate/60/60),n=this.data.startAltTag||"";
this.data.endValue&&t>this.data.endValue&&(this.ended=!0,this.displayEndBrick(),t=this.data.endValue,clearInterval(this.updateNumber),n=this.data.endAltTag||this.data.startAltTag||""),t=its.formatNumber(Math.floor(t)),this.number!=t&&(this.setAttribute("numberFormat",this.data.numberFormat?this.data.numberFormat:"#,###"),this.setAttribute("timestamp",this.fetchedData.sampleTimestamp),this.setAttribute("rate",this.fetchedData.rate),this.setAttribute("value",this.fetchedData.count),this.setAttribute("endValue",this.data.endValue),this.number=t)}},fetchData:function(){its.sf14.Util.fetchServerGetResponse(this.data.url,this.fetchSuccess.bind(this))},fetchSuccess:function(e){var t=JSON.parse(e.responseText);
this.fetchedData=t,this.updateNumber()},displayEndBrick:function(){var e=getActiveDocument().documentElement.querySelector('[itsId = "'+this.itsId()+'"]');
e&&!this.endBrickReplaced&&this.endBrick&&(e.parentNode.replaceChild(this.endBrick,e),this.endBrickReplaced=!0,this.currentBrickElement=this.endBrick)},renderTimeline:function(){if(this.data.externalBrickSourceUrl){if(!this.data.externalBrickSourceUrl.match(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/)){delete this.data.externalBrickSourceUrl;
return}this.getTimelineData(),this.timelineDataUpdateTimer=setInterval(bind(this,"getTimelineData"),6e5)}},getTimelineData:function(){var e=this.data.externalBrickSourceUrl;
its.sf14.Util.fetchServerGetResponse(e,bind(this,"fetchedTimelineData"),bind(this,"fallback"))},updateBrick:function(e){var t="brick",n,r;
delete e.endArtwork,r=this.renderComponentWithData(t,e),this.currentBrickElement=this.element;
if(this.currentBrickElement!=r)return this.currentBrickElement&&this.currentBrickElement.parentNode.replaceChild(r,this.currentBrickElement),this.currentBrickElement=this.element=r,this.currentBrickElement},fallback:function(){return delete this.data.externalBrickSourceUrl,this.updateBrick(this.data)},fetchedTimelineData:function(e){var t=JSON.parse(e.responseText);
this.fetchedData=t,this.runTimeline()},runTimeline:function(){var e,t,n=its.sf14.Util.getUTCTime();
clearTimeout(this.brickTimer);
for(var r=0;
r<this.fetchedData.children.length;
r++){e=this.fetchedData.children[r],t=new Date(e.endDate),t=t.getTime();
if(t>n){this.updateBrick(e),this.brickDuration=Math.min(this.getBrickDuration(e),6e5),this.brickTimer=setTimeout(bind(this,"runTimeline"),this.brickDuration);
break}r==this.fetchedData.children.length-1&&(clearInterval(this.timelineDataUpdateTimer),this.fallback())}},getBrickDuration:function(e){var t=new Date(e.endDate),n=new Date,r=n.getTime();
t=t.getTime();
var i=t-r;
return i},updateBrickContent:function(e){e&&(this.data.content=e,e.kind!=its.sf.StorePlatform.Kind.Artist?(this.setAttribute("data-content-kind",e.kind),this.setAttribute("data-content-id",e.id)):this.setAttribute("data-preview-id",""),this.setAttribute("data-url",e.url));
if(this.element||this.currentBrickElement){var t=this.currentBrickElement?this.currentBrickElement.querySelector("img"):this.element.querySelector("img");
if(t){var n=its.dv14.SmallLockup.DefaultDetailsGenerator.generateAltTag(this.data);
t.setAttribute("alt",n)}}this._endBrickComponent&&this._endBrickComponent.updateBrickContent(e)}}),its.dv14.CategorySheet=Class.createSubclass("its.dv14.CategorySheet",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._onCategoryChangedEventType=this.lookup("onCategoryChangedEventType")?this.lookup("onCategoryChangedEventType"):its.dv14.CategorySheet.Events.DEFAULT_CATEGORY_CHANGED_EVENT,this._sheetDocuments={},this._onResumeCallback=this.onAppear.bind(this)},onDisappear:function(){this.base.apply(this,arguments),this.stashDocumentEventCallbacks(),its.notifications.subscribe(its.sf14.Events.ON_APP_RESUME,this._onResumeCallback)},onAppear:function(){this.base.apply(this,arguments),its.notifications.unsubscribe(its.sf14.Events.ON_APP_RESUME,this._onResumeCallback),this.restoreDocumentEventCallbacks()},wantsRenderMetrics:function(){return!1},render:function(){var e=this.lookup("categories"),t=this.lookup("selectedCategory"),n=its.Templates.get("components/category_sheet"),r=this.lookup("subSheet"),i,s,o,u;
this._checkbox=document.createElement("decorationImage"),this._checkbox.classList.add("checkbox"),this._checkbox.setAttribute("src","resource://checkmark");
var a=[],f=!its.isDefinedNonNull(t),l=this._composeCategoryLockup(e,!0,f);
a.push(l),a.push(its.sf14.ComponentUtil.createDivider(this));
for(var c=0;
c<e.children.length;
c++){var h=e.children[c];
h.children||h.chartUrl?(t&&(s=t.genreId,o=t.groupingId),i=s&&s==h.genreId||its.dv14.Util.Client.isIBooks()&&o&&o==h.groupingId,i&&(u=!0),a.push(this._composeCategoryLockup(h,!1,i))):this._logger.debug(["dv14_category_sheet.js > render(): categoryData.chartUrl is null or undefined for category: ",h.name+" with genreId: "+h.genreId],null,!0)}!f&&!u&&(l=this._composeCategoryLockup(e,!0,!0),a[0]=l),n.replaceTokenUnescaped("lockups",a.join(" ")),n.replaceTokenUnescaped("navigationBar",this.composeNavigationBar(e.name,r)),this._categorySheet=n.composeAsElement(),this.addDocumentStyles(this._categorySheet,{isDarkKind:!1});
var p=this.lookup("metricsBase");
return p&&(this.data.metricsBase=its.sf14.Util.createMetricsBaseObject(p,"Categories","")),this._categorySheet},composeNavigationBar:function(e,t){var n=its.Templates.get("components/category_sheet/navigation_bar");
if(!t){n.keepBlock("cancelBlock",!0);
var r=n.getBlock("cancelBlock");
r.replaceTokenUnescaped("cancelButton",its.sf14.ComponentUtil.createButton(this,its.loc("Cancel"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},this._cancel.bind(this)))}else{n.keepBlock("navigationTitleBlock");
var i=n.getBlock("navigationTitleBlock");
i.replaceToken("navigationTitle",e)}var s=this.lookup("titleOverride");
return s?n.replaceToken("title",s):n.replaceToken("title",e),n.compose()},_composeCategoryLockup:function(e,t,n){var r={category:t?e.parentCategoryLabel:e.name,artwork:e.artwork,kind:e.kind,hasChildren:e.children&&!t,isSelected:n,checkbox:n?this._checkbox:null,url:e.url,genreId:e.genreId},i=this.renderComponentStringWithData("category_lockup",r);
if(e.children&&!t){var s=its.sf14.BaseDocument.renderDocumentWithData("category_sheet",{categories:e,subSheet:!0,onCategoryChangedEventType:this._onCategoryChangedEventType,prevSheetCheckBox:this._checkbox},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),o=its.dv14.CategorySheet.createCategoryKey(e.groupingId,e.genreId);
this._sheetDocuments[o]=s,this.subscribeToTarget(its.sf14.Events.SELECT,this._createLockupWithSubCategoriesSelectCallback(o),i.itsId())}else{var u=this._createStandardLockupSelectCallback(e,this._onCategoryChangedEventType);
this.subscribeToTarget(its.sf14.Events.SELECT,u.bind(this),i.itsId())}return i},_createLockupWithSubCategoriesSelectCallback:function(e){return function(){var t=this._sheetDocuments[e];
modal.documents[0].navigationDocument.documents.length===1&&(this._rootDocument=modal.documents[0].navigationDocument.documents[0]),this._currentDocument=t,modal.documents[0].navigationDocument.pushDocument(t)}.bind(this)},_createStandardLockupSelectCallback:function(e,t){return function(n){this._checkbox.parentNode&&this._checkbox.parentNode.removeChild(this._checkbox);
var r=this.lookup("prevSheetCheckBox");
r&&r.parentNode&&r.parentNode.removeChild(r),this._unselectCurrentCategory(),n.target.appendChild(this._checkbox),n.target.classList.add("selected");
var i={categoryKey:its.dv14.CategorySheet.createCategoryKey(e.groupingId,e.genreId),url:e.url,chartUrl:e.chartUrl,genreId:e.genreId,pageTitle:e.name};
its.notifications.publish(t,i),modal.documents[0].navigationDocument.documents.length===1&&(this._currentDocument=modal.documents[0].navigationDocument.documents[0],this._rootDocument=null),modal.popDocument()}.bind(this)},_unselectCurrentCategory:function(){this._lockups||(this._lockups=this._categorySheet.getElementsByTagName("lockup"));
for(var e=0;
e<this._lockups.length;
e++)this._lockups.item(e).getAttribute("class").indexOf("selected")>-1&&this._lockups.item(e).classList.remove("selected")},getCurrentDocument:function(){return this._currentDocument},setCurrentDocument:function(e){this._currentDocument=e},getRootDocument:function(){return this._rootDocument},_cancel:function(e){modal.popDocument()}}),its.dv14.CategorySheet.createCategoryKey=function(e,t){return"group_"+(e?e:0)+"_"+"genre_"+(t?t:0)},its.dv14.CategorySheet.Events={DEFAULT_CATEGORY_CHANGED_EVENT:"its.dv14.GroupingPage.Events.DEFAULT_CATEGORY_CHANGED_EVENT",GROUPING_CATEGORY_CHANGED_EVENT:"its.dv14.GroupingPage.Events.GROUPING_CATEGORY_CHANGED_EVENT"},its.dv14.CollectionList=Class.createSubclass("its.dv14.CollectionList",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._bucketedData=this.lookup("bucketedData"),this._selectEventName=this.lookup("selectEventName"),this._isFree=this.lookup("isFree")},templateName:function(){return"components/dv14_collection_list"},renderAsString:function(){var e,t,n,r=[],i=this._bucketedData.orderedKeys!=null,s=i?this._bucketedData.orderedKeys:sort(its.reflect.keys(this._bucketedData),{bucket:!0});
for(var o=0;
o<s.length;
++o){var u=s[o],a=i?this._bucketedData[u]:u.values;
e=its.Templates.get("components/dv14_collection_list/collection_list_header"),e.replaceToken("text",i?u:u.sectionTitle),e.replaceToken("id",i?"systemBucketID-"+u:u.indexBarEntryID),r.push(e.compose());
for(var f=0;
f<a.length;
++f){var l=a[f],c=i?l:this._bucketedData[l];
t=its.Templates.get("components/dv14_collection_list/collection_list_lockup"),t.replaceToken("text",c.name),n=t.compose(),this._selectEventName&&this.subscribeToTarget(its.sf14.Events.SELECT,function(e){return function(){var t={entry:e,isFree:this._isFree,genre:this._genre};
its.notifications.publish(this._selectEventName,t)}}(c).bind(this),n.itsId()),r.push(n)}}return this.template.replaceTokenUnescaped("content",r.join(" ")),this._markup=this.template.compose(this.itsId()),this._markup},onElementCreated:function(e){var t=e.querySelectorAll("lockup"),n;
for(var r=0;
r<t.length;
r++)n=t[r],n&&its.sf.Metrics.setTargetInfo(n,"","lockup",its.sf.Metrics.ActionType.SELECT,null,{selectedText:n.textContent})}}),its.dv14.ColumnList=Class.createSubclass("its.dv14.ColumnList",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._showOrdinal=this.lookup("showOrdinal");
var e;
its.isDefined(this.lookup("ineligibleGratisIds"))?e=its.dv14.GratisAppUtil.filterGratisApps(this.lookup("ineligibleGratisIds"),this.lookup("contentIds")):e=this.lookup("contentIds"),this._contentIds=its.dv14.Util.UI.filterUnsupportedPreOrders(this.storePlatform,e),this._type=its.dv14.Swoosh.Type.List,this._titleMaxLines=this.lookup("titleMaxLines"),this._suppressPersonalization=its.isDefined(this.lookup("suppressPersonalization"))?this.lookup("suppressPersonalization"):!1,this._scrollableCellControllerClass=its.isDefined(this.lookup("scrollableCellController"))?this.lookup("scrollableCellController"):its.sf14.ScrollableCellController.List.Chart},render:function(){return this._columnList=document.createElement("grid"),this._columnList.setAttribute("class",this.lookup("hideLines")?"no-borders-grid":"grid"),this._scrollableCellController=this._createScrollableCellController(this._columnList),this._columnList},_createScrollableCellController:function(e){var t={suppressPersonalization:this._suppressPersonalization,showOrdinal:this._showOrdinal,titleMaxLines:this._titleMaxLines};
return new this._scrollableCellControllerClass(this,e,this._contentIds,t)}}),its.dv14.CharitySheet=Class.createSubclass("its.dv14.CharitySheet",its.sf14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},render:function(){var e=its.Templates.get("components/charity_sheet"),t=this.data.dataUrl||"https://itunes.apple.com/WebObjects/MZStore.woa/wa/charityGiftPageData";
return e.replaceToken("campaignId",this.data.campaignId),e.replaceToken("dataUrl",t),this._charityElement=e.composeAsElement(),this._charityElement}}),its.dv14.ChartsColumn=Class.createSubclass("its.dv14.ChartsColumn",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),its.isDefined(this.lookup("ineligibleGratisIds"))?this._contentIds=its.dv14.GratisAppUtil.filterGratisApps(this.lookup("ineligibleGratisIds"),this.lookup("contentIds")):this._contentIds=this.lookup("contentIds"),this._template=its.Templates.get("components/dv14_charts_column"),this._suppressPersonalization=its.isDefined(this.lookup("suppressPersonalization"))?this.lookup("suppressPersonalization"):!1,this._scrollableCellControllerClass=its.sf14.ScrollableCellController.List.Chart},render:function(){var e=this.lookup("title");
return this._template.replaceToken("title",e),this._chartElement=this._template.composeAsElement(),this._scrollableCellController=this._createScrollableCellController(this._chartElement),this._chartElement},_createScrollableCellController:function(e){var t={suppressPersonalization:this._suppressPersonalization,showOrdinal:!0,seeAllData:this.lookup("seeAllData")};
return new this._scrollableCellControllerClass(this,e,this._contentIds,t)}}),its.dv14.Description=Class.createSubclass("its.dv14.Description",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"components/dv14_description"},renderAsString:function(){var e=this.template,t=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0;
e.keepBlock("showDivider",t);
var n=this.data.title;
if(n){e.keepBlock("titleBlock"),e.replaceToken("title",n);
var r=this.data.date;
r&&(e.keepBlock("dateBlock"),e.replaceToken("date",r))}var i=this.data.description;
i&&i.length>0&&(i=i.replace(/<br>/g,"<br />"),this.data.dontEscape?e.replaceTokenUnescaped("descriptionText",i):e.replaceToken("descriptionText",i));
var s=this.data.classes;
if(s)for(var o=0;
o<s.length;
o++)this.addClass(s[o]);
else this.addClass("description");
var u=this.data.maxLines;
if(its.isDefinedNonNull(u)){this.setAttribute("maxLines",u);
var a=this.data.moreLabel||its.loc("More");
this.setAttribute("moreLabel",a)}return this.template.compose(this.itsId())}}),its.dv14.NavigationBar=Class.createSubclass("its.dv14.NavigationBar",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._hideSearch=this.lookup("hideSearch"),this._hideGlobalList=this.lookup("hideGlobalList"),this._template=this.template(),its.notifications.unsubscribe(its.sf14.BaseDocument.Events.DOCUMENT_SIZE_CHANGED,this.onDocumentSizeChangedRef),this.onDocumentSizeChangedRef=this._onDocumentSizeChanged.bind(this),this.subscribe(its.sf14.BaseDocument.Events.DOCUMENT_SIZE_CHANGED,this.onDocumentSizeChangedRef)},render:function(){var e=its.isDefinedNonNull(its.App.StoreSheetData);
return e&&its.App.ParentalRequestData?this.buildATBNavBar():e?this.buildStoreSheetNavBar():this.data.isPurchasedModal?this.buildPurchasedPageModalNavBar():this.buildNavBar(),this._navigationElement=this._template.composeAsElement(),this._navigationElement},_onDocumentSizeChanged:function(){this.data.isPurchasedModal||this._refreshSearchField()},template:function(){var e=null,t=its.isDefinedNonNull(its.App.StoreSheetData);
return t&&its.App.ParentalRequestData?e=its.Templates.get("components/dv14_navigation_bar/atb_store_sheet"):t||this.data.isPurchasedModal?e=its.Templates.get("components/dv14_navigation_bar/store_sheet"):e=its.Templates.get("components/dv14_navigation_bar"),e},buildNavBar:function(){this._refreshSearchField();
var e=this.lookup("product");
if(this.data.hasShareButton){var t=this.renderComponentStringWithData("share_button",{content:e});
this._template.replaceTokenUnescaped("shareButton",t)}this.data.renderAlternateDisplay&&this._template.keepBlock("palette");
if(!this.data.hideGenreButton){var n=its.Templates.get("pages/dv14_navigation_bar/genre_button");
if(its.dv14.Util.Client.isITunes()&&its.sf14.PageController.PageTarget.AUDIOBOOKS!=its.dv14.GroupingPage.MediaType[this.data.mediaType])var r=its.loc("Genres");
else r=its.loc("Categories");
n.replaceToken("categories",r),this.data.renderAlternateDisplay?n.replaceToken("class","genre-button-right align-right"):n.replaceToken("class","genre-button-left align-left"),e||this._logger.warn(["Creating a share button inside a navigation bar, even though there is not corresponding product."])}var i=TabBar.selectedTab.navigationDocument?TabBar.selectedTab.navigationDocument.documents:[],s=i.length,o=s===0||s===1&&i[0]&&i[0].isLoadingDocument,u=its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0;
if(its.dv14.Util.Client.isGlobalListsSupported()&&(o||!u)){var a=its.Templates.get("pages/dv14_navigation_bar/preview_history_button");
a.replaceToken("previewHistoryText",its.loc("DVX.GlobalLists.Title"));
var f=a.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,this._handleGlobalListSelect.bind(this),f.itsId()),this.subscribeToTarget(its.Template.Events.NEW_ELEMENTS_CREATED,function(e){its.sf.Metrics.setTargetInfo(e.target,"global_lists_button","button",its.sf.Metrics.ActionType.OPEN,its.serverData.constants.viewGlobalLists)}.bind(this),f.itsId()),this._template.replaceTokenUnescaped("previewHistoryButton",f)}if(this.data.navigationTitle){this._template.keepBlock("navigationTitleBlock");
var l=this._template.getBlock("navigationTitleBlock");
l.replaceToken("navigationTitle",this.data.navigationTitle)}this.data.title&&this.setTitle(this.data.title)},_createNewSearchFieldElement:function(){var e={clientApplication:its.dv14.Util.Client.getClientApplication()};
its.dv14.PageController.shouldShowStopPageForPageTarget("tv")&&(e.videos="false");
var t={placeholderText:its.loc("Search"),trendingSearchUrl:itms.getBag()["trending-searches"],hintsUrl:its.url.appendUrlParameters(itms.getBag().searchHints,e)};
return this.renderComponentWithData("search_field",t)},_refreshSearchField:function(){var e=its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.documentSize())&&its.dv14.Util.Client.isSearchSupported()&&!this._hideSearch&&!its.dv14.Util.Client.isVoyager();
this._searchFieldElement&&this._placeholderSearchFieldElement?this._navigationElement.replaceTokenWithElement("searchField",e?this._searchFieldElement:this._placeholderSearchFieldElement):(this._searchFieldElement=this._createNewSearchFieldElement(),this._placeholderSearchFieldElement=its.element.createElementFromString("<placeholder/>"),this._template.replaceTokenWithElement("searchField",e?this._searchFieldElement:this._placeholderSearchFieldElement))},setTitle:function(e){if(this._titleElement){var t=its.sf14.ComponentUtil.createText(this,e,{type:its.sf14.ComponentUtil.TextType.TITLE},!0);
this._titleElement.parentNode.replaceChild(t,this._titleElement),this._titleElement=t}else this._titleElement=its.sf14.ComponentUtil.createText(this,e,{type:its.sf14.ComponentUtil.TextType.TITLE},!0),this._template.replaceTokenWithElement("title",this._titleElement)},buildStoreSheetNavBar:function(){var e=this.lookup("product"),t=its.App.StoreSheetData.url||this.documentUrl();
!t&&e&&(t=e.url),its.App.StoreSheetRefApp&&(t=its.url.appendUrlParameters(t,{SKUIServiceRefApp:its.App.StoreSheetRefApp}));
if(its.App.StoreSheetData.showsStoreButton&&t){var n=function(){itms.exit({type:"goto-url",url:t})}.bind(this);
this._template.replaceTokenUnescaped("storeButton",its.sf14.ComponentUtil.createButton(this,its.loc("Store"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},n))}its.App.isAppPreview()&&this._template.replaceTokenUnescaped("class","hidden-bar"),this.setTitle(its.dv14.NavigationBar.storeSheetTitleForContent(e));
var r=null;
its.App.StoreSheetData.isImitationStoreSheet?r=function(){modal.popDocument()}:r=function(){var e={};
its.App.StoreSheetData.purchaseHappened&&(e.type="purchased"),itms.exit(e)},this._template.replaceTokenUnescaped("cancelButton",its.sf14.ComponentUtil.createButton(this,its.loc("Cancel"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left"},r));
if(this.data.hasShareButton){var i=this.renderComponentStringWithData("share_button",{content:e});
this._template.replaceTokenUnescaped("shareButton",i)}},buildPurchasedPageModalNavBar:function(){var e=this.lookup("product"),t=this.documentUrl();
!t&&e&&(t=e.url),this.setTitle(its.dv14.NavigationBar.storeSheetTitleForContent(e));
var n=null;
n=function(){modal.popDocument()},this._template.replaceTokenUnescaped("cancelButton",its.sf14.ComponentUtil.createButton(this,its.loc("Close"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left"},n));
if(this.data.hasShareButton){var r=this.renderComponentStringWithData("share_button",{content:e});
this._template.replaceTokenUnescaped("shareButton",r)}},buildATBNavBar:function(){var e=its.App.StoreSheetData.cancelButton.title,t=its.App.StoreSheetData.okButton.title,n=function(){itms.exit({type:"left"})},r=function(){itms.exit({type:"right"})};
this._template.replaceTokenUnescaped("leftButton",its.sf14.ComponentUtil.createButton(this,e,its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left"},n)),this._template.replaceTokenUnescaped("rightButton",its.sf14.ComponentUtil.createButton(this,t,its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},r))},_handleGlobalListSelect:function(e){var t={};
its.sf.Platform.iPad()&&(t.type="popover",t.sourceElement=e.target);
var n={url:its.serverData.constants.viewGlobalLists,options:t,pageTarget:its.sf14.PageController.PageTarget.MODAL};
its.sf.Platform.iPhone()&&(n.navigationBarElement=this.renderComponentWithData("navigation_bar_with_done_button",{})),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,n)}}),its.dv14.NavigationBar.storeSheetTitleForContent=function(e){var t="";
return e&&(e.kind==its.sf.StorePlatform.Kind.EBook||e.kind==its.sf.StorePlatform.Kind.EBookApple||e.kind==its.sf.StorePlatform.Kind.EBookMeta||e.kind==its.sf.StorePlatform.Kind.EBookSeries||e.kind==its.sf.StorePlatform.Kind.EBookTextbook||e.kind==its.sf.StorePlatform.Kind.Audiobook?t=its.loc("Book Store"):e.kind==its.sf.StorePlatform.Kind.MobileApp||e.kind==its.sf.StorePlatform.Kind.MobileAppBundle?t=its.loc("App Store"):t=its.loc("iTunes Store")),t},its.dv14.ExtendedNavigationBar=Class.createSubclass("its.dv14.ExtendedNavigationBar",its.dv14.NavigationBar,{initialize:function(){this.base.apply(this,arguments),its.dv14.Util.Client.isIBooks&&this._template.replaceTokenUnescaped("genreButton",null),its.notifications.subscribe(its.dv14.GroupingPage.Events.RERENDER_CATEGORIES,this._rerenderCategories.bind(this))},template:function(){var e=null,t=its.isDefinedNonNull(its.App.StoreSheetData);
return t&&its.App.ParentalRequestData?e=its.Templates.get("components/dv14_extended_navigation_bar/atb_store_sheet"):t?e=its.Templates.get("components/dv14_extended_navigation_bar/store_sheet"):e=its.Templates.get("components/dv14_extended_navigation_bar"),e},buildNavBar:function(){this.base();
if(this.data.renderAlternateDisplay){this._template.keepBlock("palette");
var e=this._template.getBlock("palette");
e.replaceTokenWithElement("paletteTabbedPane",this.lookup("tabbedPaneElement"))}else this._template.replaceTokenWithElement("tabbedPane",this.lookup("tabbedPaneElement"));
this._shouldShowSearchButton()&&(this._searchButtonMarkup=this._composeSearchButton(),this._template.replaceTokenUnescaped("searchButton",this._searchButtonMarkup),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSearchClick.bind(this),this._searchButtonMarkup.itsId())),this.data.hideGenreButton||(this._genreButtonMarkup=this._composeGenreButton(),this._template.replaceTokenUnescaped("genreButton",this._genreButtonMarkup),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleGenreClick.bind(this),this._genreButtonMarkup.itsId()));
if(this.data.hasShareButton){var t=this.lookup("product"),n=this.renderComponentStringWithData("share_button",{content:t});
this._template.replaceTokenUnescaped("shareButton",n)}},_composeGenreButton:function(){var e=its.Templates.get("components/dv14_extended_navigation_bar/genre_button");
if(its.dv14.Util.Client.isITunes()&&its.sf14.PageController.PageTarget.AUDIOBOOKS!=its.dv14.GroupingPage.MediaType[this.data.mediaType])var t=its.loc("Genres");
else t=its.loc("Categories");
e.replaceToken("categories",t),this.data.renderAlternateDisplay?e.replaceToken("class","align-right"):e.replaceToken("class","align-left"),this._categoryComponent=its.sf14.BaseDocument.documentWithData("category_sheet",{categories:this.data.categoryList,selectedCategory:this.data.selectedCategory,onCategoryChangedEventType:this.lookup("onCategoryChangedEventType"),titleOverride:its.dv14.Util.Client.isAppStore()?null:t,metricsBase:this.data.groupingPageMetricsBase},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),this._categorySheet=this._categoryComponent.renderDocument(),this._categoryComponent.setCurrentDocument(this._categorySheet);
var n=e.compose();
return this.subscribeToTarget(its.Template.Events.NEW_ELEMENTS_CREATED,function(e){its.sf.Metrics.setTargetInfo(e.target,"genre_button","button",its.sf.Metrics.ActionType.SELECT)}.bind(this),n.itsId()),n},_handleGenreClick:function(e){var t={};
its.sf.Platform.iPad()?(t.type="popover",t.sourceElement=e.target):t.type="sheet",modal.pushDocument(this._categoryComponent.getCurrentDocument(),t);
if(this._categoryComponent.getRootDocument()){var n=modal.documents[0];
n.navigationDocument.insertBeforeDocument(this._categoryComponent.getRootDocument(),this._categoryComponent.getCurrentDocument(),t)}},_composeSearchButton:function(){var e=its.Templates.get("components/dv14_extended_navigation_bar/search_button");
e.replaceToken("class","align-left");
var t=e.compose();
return this.subscribeToTarget(its.Template.Events.NEW_ELEMENTS_CREATED,function(e){its.sf.Metrics.setTargetInfo(e.target,"search_button","button",its.sf.Metrics.ActionType.SELECT)}.bind(this),t.itsId()),t},_handleSearchClick:function(e){its.dv14.SearchPage.showSearchPage()},_rerenderCategories:function(e){this.data.categoryList=e.categoryList,this.data.selectedCategory=e.selectedCategory,this._genreButtonMarkup=this._composeGenreButton(),this._template.replaceTokenUnescaped("genreButton",this._genreButtonMarkup),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleGenreClick.bind(this),this._genreButtonMarkup.itsId())},_shouldShowSearchButton:function(){var e=TabBar.selectedTab,t=!1;
e.identifier==its.sf14.PageController.PageTarget.CATEGORIES&&(t=!0);
var n=e.navigationDocument?e.navigationDocument.documents:[],r=n.length,i=r===0||r===1&&n[0]&&n[0].isLoadingDocument;
return its.dv14.Util.Client.isVoyager()&&i&&!t}}),its.dv14.Flowcase=Class.createSubclass("its.dv14.Flowcase",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._flowcaseData=this.lookup("flowcaseData"),this._unAvailableContentIds=this.lookup("unAvailableContentIds")?this.lookup("unAvailableContentIds"):{},this._contentIds=[],this._linkTypeFlowcaseElementIds=[],this._flowcaseItemMap={},this._ignoreLinkType=this.lookup("ignoreLinkType"),this.lookup("doNotFilter")||(this._flowcaseData=its.dv14.Util.UI.filterByInstalledApps(this._flowcaseData,!0,3)),this._flowcaseData=this._flowcaseData.filter(function(e){var t=e.link&&e.link.type=="link"&&(!its.dv14.UpgradeDevice.isUpgradeUrl(e.link.url)||its.dv14.UpgradeDevice.isUpgradeApplicable()),n=e.link&&e.link.type=="content"&&!this._unAvailableContentIds[its.sf.StorePlatformUtil.contentIdFromLinkable(e)],r=its.isDefinedNonNull(e.artwork);
return r&&(t||n||this._ignoreLinkType)}.bind(this));
for(var e=0;
e<this._flowcaseData.length;
e++){var t=this._flowcaseData[e];
its.dv14.UpgradeDevice.isUpgradeUrl(t.link.url)&&its.dv14.UpgradeDevice.setFeaturedLinkData(t.link),t.fcKind==its.dv14.GroupingPage.FCKinds.mso_flowcase_marker?this._flowcaseData[e]=its.dv14.Util.Client.MSO.personalizedReplacementFCData(t):t.link.type=="content"?(t.content=this.storePlatform.getCachedData(its.sf.StorePlatformUtil.contentIdFromLinkable(t),"lockup-grouping"),this._contentIds.push(its.sf.StorePlatformUtil.contentIdFromLinkable(t))):t.link&&(its.dv14.UpgradeDevice.isUpgradeUrl(t.link.url)&&its.dv14.UpgradeDevice.setFeaturedLinkData(t.link),this._linkTypeFlowcaseElementIds.push(t.adamId))}this.subscribe(its.sf14.BaseDocument.Events.DOCUMENT_SIZE_CHANGED,this._onDocumentSizeChange.bind(this))},templateName:function(){return"components/dv14_flowcase"},render:function(){var e=this.lookup("classNames")?this.lookup("classNames").join(" "):its.dv14.Util.UI.isMultiItemCarousel(this.documentSize())?"carousel":"";
this.template.replaceToken("className",e);
var t=this.template.getBlock("flowcaseItemLoop");
for(var n=0;
n<this._flowcaseData.length;
n++){var r=this._flowcaseData[n],i=Class.shallowClone(r);
r.link.type=="content"&&(i.content=this.storePlatform.getCachedData(its.sf.StorePlatformUtil.contentIdFromLinkable(r),"lockup-grouping"));
var s=this.componentWithData("flowcase_item",i);
this._flowcaseItemMap[its.sf.StorePlatformUtil.contentIdFromLinkable(r)]=s,t.replaceTokenWithElement("flowcaseItem",s.render()),t.next()}return this._fetchFlowcaseContent(),this.template.composeAsElement(this.itsId())},_fetchFlowcaseContent:function(){if(this._contentIds.length){var e={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.GROUPING,ids:this._contentIds,onOK:this._flowcaseDataFetched.bind(this)};
this.storePlatform.fetchContentBatched(e)}},_flowcaseDataFetched:function(e){this._contentIds.forEach(function(t){var n=this._flowcaseItemMap[t],r=e[t];
n&&(r?n.setContentData(r):n.remove())}.bind(this))},_updateImageDimensions:function(){var e=its.dv14.LockupUtil.getArtworkDimensions("flowcase",this.lookup("orientation"),this.documentSize());
for(var t=0;
t<this.element.children.length;
t++){var n=this.element.children.item(t);
n.setAttribute("width",e.width),n.setAttribute("height",e.height)}},_onDocumentSizeChange:function(e){its.dv14.Util.UI.isMultiItemCarousel(this.documentSize())&&this._updateImageDimensions()},componentType:function(){return"flowcase"}}),its.dv14.FlowcaseItem=Class.createSubclass("its.dv14.FlowcaseItem",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._link=this.lookup("link"),this._artwork=this.lookup("artwork"),this._alwaysLink=this.lookup("alwaysLink")},render:function(){var e=this.lookup("carouselArtworkKind")?this.lookup("carouselArtworkKind"):"flowcase",t=this.lookup("orientation");
t||(t=its.dv14.Util.UI.isMultiItemCarousel(this.documentSize())?its.dv14.Util.UI.Orientation:"_default");
var n=its.dv14.LockupUtil.getArtworkDimensions(e,t,this.documentSize()),r=its.dv14.LockupUtil.getArtworkCropStyles(e),i=its.sf14.ArtworkUtil.bestScaledImage(this._artwork,n,r).url;
this.template.replaceToken("height",n.height),this.template.replaceToken("width",n.width),this.template.replaceToken("artworkUrl",i),this.setAttribute("alt",its.dv14.SmallLockup.DefaultDetailsGenerator.generateAltTag(this.data));
var s=its.dv14.Util.UI.isMultiItemCarousel(this.documentSize())?"flowcase-item-ipad":"flowcase-item";
this.template.replaceToken("flowcaseItemClass",s);
if(this._link.type=="link"||this._alwaysLink)this._link.target==its.sf14.PageController.PageTarget.EXTERNAL&&this.template.replaceToken("pageTarget",its.sf14.PageController.PageTarget.EXTERNAL),this._link.url&&this.setAttribute("data-url",this._link.url);
return this.lookup("content")&&(this.data.content.kind!=its.sf.StorePlatform.Kind.Artist&&(this.setAttribute("data-content-kind",this.data.content.kind),this.setAttribute("data-content-id",this.data.content.id)),this.setAttribute("data-url",this.data.content.url)),this.template.composeAsElement(this.itsId())},templateName:function(){return"components/dv14_flowcase_item"},setContentData:function(e){this.data.content=e,this.data.content.kind!=its.sf.StorePlatform.Kind.Artist&&(this.setAttribute("data-content-kind",this.data.content.kind),this.setAttribute("data-content-id",this.data.content.id)),this.setAttribute("data-url",this.data.content.url),this.setAttribute("alt",its.dv14.SmallLockup.DefaultDetailsGenerator.generateAltTag(this.data)),this.addImpressionsData(this.element)},remove:function(){this.element.remove()},componentType:function(){return"flowCard"},onElementCreated:function(e){var t,n;
this._link.type=="link"&&(t=this._link.adamId,n=this._link.url),this.lookup("content")&&(t=this.data.content.id,n=this.data.content.url),its.sf.Metrics.setTargetInfo(this.element,t,this.componentType(),its.sf.Metrics.ActionType.NAVIGATE,n)}}),its.dv14.Gallery=Class.createSubclass("its.dv14.Gallery",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_shelf"),this._link=this.lookup("link"),this._title=this.lookup("title"),this._items=this.lookup("items")},render:function(){(this._link||this._title)&&this._template.keepBlock("headerBlock",!0),this._title&&this._template.replaceToken("title",this._title),this._link&&this._template.replaceTokenUnescaped("link",its.sf14.ComponentUtil.createButton(this,this._link.label,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this._link.url}));
var e=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0;
return this._template.keepBlock("showDivider",e),this._galleryElement=this._template.composeAsElement(),this._galleryElement.replaceTokenWithElement("lockups",this._renderGalleryItems()),this._galleryElement},_renderGalleryItems:function(){var e=document.createDocumentFragment();
for(var t=0;
t<this._items.length;
t++){var n=this._items[t];
n.type==its.dv14.Gallery.Type.IMAGE?e.appendChild(this._renderImageGalleryItem(n)):n.type==its.dv14.Gallery.Type.VIDEO&&e.appendChild(this._renderVideoGalleryItem(n))}return e},_renderVideoGalleryItem:function(e){var t=its.Templates.get("components/dv14_gallery/lockup");
if(e.title){var n=t.getBlock("titleBlock");
n.replaceToken("title",e.title),n.next()}if(e.videoData.duration){var r=t.getBlock("subtitleBlock");
r.replaceTokenWithElement("subtitle",its.sf14.ComponentUtil.createDuration(this,e.videoData.duration,null,!0)),r.next()}var i=e.videoData;
i.artworkData=e.artworkData,t.replaceTokenWithElement("media",this.renderComponentWithData("video",i));
var s=t.composeAsElement(),o=i.url||i.src;
return its.sf.Metrics.setTargetInfo(s,i.contentId,"mediaElement",its.sf.Metrics.ActionType.PLAY,o,"video"),s},_renderImageGalleryItem:function(e){var t=its.Templates.get("components/dv14_gallery/lockup");
t.replaceTokenWithElement("media",this.renderComponentWithData("artwork",e.artworkData));
if(e.title){var n=t.getBlock("titleBlock");
n.replaceToken("title",e.title),n.next()}if(e.fullscreenArtworkData){var r=t.getBlock("fullscreenImageBlock"),i=this.renderComponentWithData("fullscreen_image",e.fullscreenArtworkData);
r.replaceTokenWithElement("fullscreenImage",i),r.next()}return t.composeAsElement()}}),its.dv14.Gallery.Type={IMAGE:"its.dv14.Gallery.Type.IMAGE",VIDEO:"its.dv14.Gallery.Type.VIDEO"},its.dv14.GiftSheet=Class.createSubclass("its.dv14.GiftSheet",its.sf14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},render:function(){var e=its.Templates.get("components/gift_sheet");
return this._giftElement=e.composeAsElement(),this._giftElement}}),its.dv14.Grid=Class.createSubclass("its.dv14.Grid",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._contentIds=this.lookup("contentIds"),this._artworkProfile=this.lookup("artworkProfile"),this._showOrdinal=this.lookup("showOrdinal"),this._title=this.lookup("title"),this._maxCount=this.lookup("maxCount"),this._stdQualityMap=this.lookup("stdQualityMap"),this._type=its.dv14.Swoosh.Type.List,this._suppressPersonalization=its.isDefined(this.lookup("suppressPersonalization"))?this.lookup("suppressPersonalization"):!1,this._classes=its.isDefined(this.lookup("classes"))?this.lookup("classes"):["grid"],this._useAlternateTemplate=this.lookup("useAlternateTemplate");
var e=this.lookup("scrollableCellControllerClass");
this._scrollableCellControllerClass=its.isDefined(e)?e:its.sf14.ScrollableCellController.List.Room},templateName:function(){return this.lookup("useAlternateTemplate")?"components/dv14_grid_alternate":"components/dv14_grid"},componentType:function(){return"grid"},render:function(){this._classes&&(this._useAlternateTemplate&&this._classes.push("no-borders-grid"),this.template.replaceToken("classes",this._classes.join(" ")));
var e=this._title&&this._title.length>0;
if(e&&this._useAlternateTemplate){this.template.keepBlock("titleBlock"),this.template.replaceToken("title",this._title),this.element=this.template.composeAsElement(this.itsId());
var t=this.element.querySelector("grid");
this._scrollableCellController=this._createScrollableCellController(t)}else if(e){this.template.keepBlock("titleBlock"),this.template.replaceToken("title",this._title),this.element=this.template.composeAsElement(this.itsId());
var t=this.element.querySelector("section");
this._scrollableCellController=this._createScrollableCellController(t)}else this.element=this.template.composeAsElement(this.itsId()),this._scrollableCellController=this._createScrollableCellController(this.element);
return this.element},_createScrollableCellController:function(e){var t={suppressPersonalization:this._suppressPersonalization,showOrdinal:this._showOrdinal};
this._maxCount&&(t.maxCount=this._maxCount),this._stdQualityMap&&(t.stdQualityMap=this._stdQualityMap);
if(this._contentIds)return new this._scrollableCellControllerClass(this,e,this._contentIds,t)}}),its.dv14.GroupingMainStack=Class.createSubclass("GroupingMainStack",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._groupingPageComponent=this.lookup("groupingPageComponent"),this.subscribe(its.sf14.Events.ACCOUNT_CHANGE,this._handleAccountChange.bind(this)),this.subscribe(its.sf14.Events.MSO_ACCOUNT_CHANGED,this._handleMSOAccountChange.bind(this)),this.subscribe(its.sf14.BaseDocument.Events.DOCUMENT_SIZE_CHANGED,this._onDocumentSizeChange.bind(this)),this._currentSize=Class.shallowClone(this.documentSize()),this.nfaSwooshes=[],this.recommendationSwooshes=[],this.cmaSwooshes=[],this.cmsSwooshes=[]},templateName:function(){return"pages/dv14_grouping_mainstack"},render:function(){return this.element=this._render(),this.element},_render:function(){var e,t=this.data.typ;
t&&this.template.replaceTokenWithElement("thankYouPlacard",this.renderComponentWithData("thank_you_placard",t));
var n=this.data.fcStructure.model.children[0].children,r=document.createElement("accountButtons");
r.classList.add("account-buttons"),this.storePlatform.beginContentBatch();
for(var i=0;
i<n.length;
i++)if(n[i].fcKind==its.dv14.GroupingPage.FCKinds.main_stack_sun){var s=document.createDocumentFragment();
for(var o=0;
o<n[i].children.length;
o++){var u=n[i].children[o];
if(u.fcKind==its.dv14.GroupingPage.FCKinds.flowcase)this._renderFlowcaseElement(u);
else if(u.fcKind==its.dv14.GroupingPage.FCKinds.header)this._renderHeaderElement(u);
else{var a=this._renderMainStackElements(u);
if(a)for(var f=0;
f<a.length;
f++)s.appendChild(a[f])}}this.template.replaceTokenWithElement("main_stack",s)}else n[i].fcKind==its.dv14.GroupingPage.FCKinds.quick_links_stack&&this._groupingPageComponent&&this._renderQuicklinksStackElement(n[i].children[0]);
this._fetchAdamIdsForPersonalizedSwooshes();
if(its.property("MZStore.showEmailSupportLinkInFooter")){var l={"data-url":its.loc("MZStore.EmailSupportLink.url"),"data-page-target":its.sf14.PageController.PageTarget.EXTERNAL,"class":"email-support-link"},c=its.sf14.ComponentUtil.createButton(this,its.loc("MZStore.EmailSupportLink"),its.sf14.ComponentUtil.ButtonType.LINK,l,null,!0);
this.template.replaceTokenWithElement("emailSupportLink",c)}return e=this.template.composeAsElement(),this.storePlatform.submitContentBatch(),e},_fetchAdamIdsForPersonalizedSwooshes:function(){function e(e){var t=e.component;
!t._needsAdamIds||t.fetchAdamIds()}this.nfaSwooshes.forEach(e),this.cmaSwooshes.forEach(e),this.cmsSwooshes.forEach(e);
if(this.recommendationSwooshes.length>0)if(!its.dv14.Util.Client.isIBooks())this.recommendationSwooshes.forEach(e);
else{var t={},n,r={allowExplicit:!1,fcKindIds:[]};
this.recommendationSwooshes.forEach(function(e){var i=e.component;
!i._needsAdamIds||(n=i._lookupUrlData.baseUrl,r.allowExplicit=i.allowExplicit(),r.fcKindIds.push(i._fcKindId),t[i._fcKindId]=i)});
if(n){n=its.url.appendUrlParameters(n,r);
function i(e){var n={};
Object.keys(e).forEach(function(r){t[r]||(n[r]=e[r])}),Object.keys(t).forEach(function(r){var i=t[r],s=Object.assign({},e[r],n);
i._handlePersonalizedDataFetched(s)})}function s(){this.recommendationSwooshes.forEach(function(e){var t=e.component;
t._handlePersonalizedDataFetchFailure.call(t)})}its.sf14.Util.postJSON(n,{},i,s.bind(this))}}},_handleAccountChange:function(){function e(e){for(var t=0,n=e.length;
t<n;
t++){var r=e[t];
r.element.removeAllChildNodes();
var i=this.componentWithData("personalized_swoosh",r.data);
r.component=i,r.element.appendChild(i?i.render():null)}}e.call(this,this.nfaSwooshes),e.call(this,this.recommendationSwooshes),e.call(this,this.cmaSwooshes),e.call(this,this.cmsSwooshes),this._fetchAdamIdsForPersonalizedSwooshes()},_handleMSOAccountChange:function(){var e=this._render();
this.element.parentNode.replaceChild(e,this.element),this.element=e},_onDocumentSizeChange:function(e){this._renderFlowcaseElement();
var t=Class.shallowClone(e.newSize),n=this._currentSize.height==t.width&&this._currentSize.width==t.height;
if(!n){var r=this._render();
this.element&&(this.element.parentNode.replaceChild(r,this.element),this.element=r)}this._currentSize=t},_renderMainStackElements:function(e){var t=[],n=its.dv14.GroupingPage.FCKinds,r=[""+n.recommendations_app_marker,""+n.recommendations_game_marker,""+n.recommendations_movie_marker,""+n.recommendations_tvshow_marker,""+n.recommendations_book_marker_1,""+n.recommendations_book_marker_2];
if(e.fcKind==its.dv14.GroupingPage.FCKinds.tab_set){var i=e.children,s;
for(var o=0,u=e.children.length;
o<u;
o++){var a=i[o].fcKind;
if(this._groupingPageComponent){a==n.radio_marker&&this.data.radioSwoosh&&(s=this.renderComponentWithData("radio_swoosh",this.data.radioSwoosh));
if(its.property("SFJ.isNFAEnabledInStorefront")&&a==n.new_from_artists_marker){var f={title:e.name,dk:its.sf.StorePlatform.Kind.Album,type:its.dv14.PersonalizedSwoosh.Type.NEW_FROM_ARTISTS,personalizedSwooshData:this.data.nfaSwooshData},l=document.createElement("section"),c=this.componentWithData("personalized_swoosh",f);
l.appendChild(c?c.render():null),s=l,this.nfaSwooshes.push({component:c,data:f,element:l})}else if(its.property("SFJ.isRecommendationsSwooshEnabledInStorefront")&&r.indexOf(a)!==-1){var f={title:e.name,fcKindId:a,type:its.dv14.PersonalizedSwoosh.Type.RECOMMENDATIONS,personalizedSwooshData:this.data.recommendationsSwooshData},l=document.createElement("section"),c=this.componentWithData("personalized_swoosh",f);
l.appendChild(c?c.render():null),s=l,this.recommendationSwooshes.push({component:c,data:f,element:l})}else if(a==n.cma_marker){var f={title:e.name,dk:2,type:its.dv14.PersonalizedSwoosh.Type.CMC,personalizedSwooshData:this.data.cmcSwooshData},l=document.createElement("section"),c=this.componentWithData("personalized_swoosh",f);
l.appendChild(c?c.render():null),s=l,this.cmaSwooshes.push({component:c,data:f,element:l})}else if(a==n.cms_marker){var f={title:e.name,dk:7,type:its.dv14.PersonalizedSwoosh.Type.CMC,personalizedSwooshData:this.data.cmcSwooshData},l=document.createElement("section"),c=this.componentWithData("personalized_swoosh",f);
l.appendChild(c?c.render():null),s=l,this.cmsSwooshes.push({component:c,data:f,element:l})}}if(a==n.swoosh_sun||a==n.currentlyon_swoosh||a==n.track_swoosh||a==n.appTrailerIPad||a==n.appTrailerIPhone||n.PopularitySwooshes.Lookup[a]){var f={};
f.title=i[o].name;
var h=[],p=i[o].content;
f.contentId=its.sf.StorePlatformUtil.contentIdFrom(i[o]),f.link={label:its.loc("See All"),url:i[o].seeAllUrl},f.doNotFilter=i[o].doNotFilter;
var d;
for(var v=0;
v<p.length;
v++){var m=its.sf.StorePlatformUtil.contentIdFrom(p[v]);
if(!this.data.unAvailableContentIds||!this.data.unAvailableContentIds[m])h.push(m),!d&&this.storePlatform.getCachedData(m)&&(d=this.storePlatform.getCachedData(m).kind)}f["its.dv14.SmallLockup"]={isNewsstandGenre:this.data.isNewsstandGenre?this.data.isNewsstandGenre:!1};
if(a==n.PopularitySwooshes.song||a==n.track_swoosh||d==its.sf.StorePlatform.Kind.TvEpisode)f.additionalCssClasses="shelf-with-rows",f.type=its.dv14.Swoosh.Type.LIST,f.scrollableCellControllerClass=its.sf14.ScrollableCellController.List.Chart,f["its.dv14.SmallLockup"]={titleMaxLines:1};
else if(a==n.appTrailerIPad||a==n.appTrailerIPhone)f.scrollableCellControllerClass=its.sf14.ScrollableCellController.AppTrailerSwoosh;
n.PopularitySwooshes.Lookup[a]&&(f.showOrdinal=!0,f["its.dv14.SmallLockup"]=Class.extend(f["its.dv14.SmallLockup"],{titleOrdinal:!0})),f.contentIds=its.dv14.GroupingPage.trimSwooshIds(h,!1),h.length>0&&(s=this.renderComponentWithData("swoosh",f))}s&&t.push(s)}}else if(e.fcKind==n.sliding_brickrow){var g={doNotFilter:e.doNotFilter,bricks:e.children,adamId:e.adamId,title:e.name,fcKind:e.fcKind,mt:this.data.mt,unAvailableContentIds:this.data.unAvailableContentIds};
t.push(this.renderComponentWithData("brick_row",g))}return t},_renderHeaderElement:function(e){this.template.keepBlock("headerBlock");
var t=this.template.getBlock("headerBlock"),n=its.dv14.LockupUtil.getArtworkDimensions("header",null,this.documentSize());
t.replaceToken("adamId",e.adamId);
var r=its.sf14.ArtworkUtil.bestScaledImage(e.artwork,{width:n.width,height:n.height},null).url;
t.replaceToken("height",n.height),t.replaceToken("width",n.width),t.replaceToken("artworkUrl",r)},_renderFlowcaseElement:function(e){e&&(this._flowcaseFCData=e);
if(this._flowcaseFCData){var t=this.renderComponentWithData("flowcase",{flowcaseData:this._flowcaseFCData.children,doNotFilter:this._flowcaseFCData.doNotFilter,additionalMetricsData:this._flowcaseFCData,unAvailableContentIds:this.data.unAvailableContentIds});
this.template.replaceTokenWithElement("flowcase",t)}},_renderQuicklinksStackElement:function(e){if(itms.accountInfo&&itms.accountInfo.managedAppleId){this.template.keepBlock("quickLinksBlock",!1);
return}var t=this.template.getBlock("quickLinksBlock"),n=t.getBlock("quickLinksLoop"),r;
t.replaceToken("title",e.name);
var i=e.links;
for(var s=0;
s<i.length;
s++){its.sf14.Util.isFinanceAddMoney(i[s].url)&&(i[s].target=its.sf14.PageController.PageTarget.MODAL);
var o={"data-url":i[s].url,"class":"button-color"};
if(i[s].target==its.sf14.PageController.PageTarget.EXTERNAL||its.sf14.PageController.PageTarget.MODAL)o["data-page-target"]=i[s].target;
r=its.sf14.ComponentUtil.createButton(this,i[s].label,null,o,null,!0),n.replaceTokenWithElement("quickLinkButton",r),its.sf.Metrics.setTargetInfo(r,i[s].label,"link",its.sf.Metrics.ActionType.NAVIGATE,i[s].url),n.next()}its.sf.Platform.iPad()?t.replaceToken("quicklinksClass","grid three-column"):t.replaceToken("quicklinksClass","grid"),t.next()}}),its.dv14.InfoList=Class.createSubclass("its.dv14.InfoList",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_info_list"),this._infoItems=this.lookup("infoItems"),this._title=this.lookup("title"),this._type=this.lookup("type")?this.lookup("type"):its.dv14.InfoList.Type.TITLE_LEFT},render:function(){this._title&&(this._template.keepBlock("titleBlock",!0),this._template.replaceToken("title",this._title)),this._template.replaceToken("type",this._type);
var e=this._template.getBlock("infoListItem");
for(var t=0;
t<this._infoItems.length;
t++){var n=this._infoItems[t],r=its.Templates.get("components/dv14_info_list/item");
r.replaceToken("title",n.title);
var i=r.getBlock("textLoop");
for(var s=0;
s<n.values.length;
s++){var o=n.values[s];
if(o){var u=o.value||o,a=o.url;
a?(i.keepBlock("linkBlock",!0),i.replaceToken("url",o.url)):o.elementAsString?(i.keepBlock("elementBlock",!0),i.replaceTokenUnescaped("element",o.elementAsString)):(o.numberValue&&(i.keepBlock("numberBlock",!0),i.replaceToken("number",o.numberValue)),i.keepBlock("textBlock",!0)),n.replaceUnescaped?i.replaceTokenUnescaped("text",u):i.replaceToken("text",u),i.next()}}e.replaceTokenUnescaped("infoListItem",r.compose()),e.next()}var f=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0;
this._template.keepBlock("showDivider",f);
var l=this._template.composeAsElement();
return l}}),its.dv14.InfoList.Type={TITLE_LEFT:"titleLeft",TITLE_ABOVE:"titleAbove"},its.dv14.NavigationBarWithDoneButton=Class.createSubclass("its.dv14.NavigationBarWithDoneButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_navigation_bar_with_done_button")},render:function(){var e=its.sf14.ComponentUtil.createButton(this,its.loc("Done"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},this._handleDoneButtonClick.bind(this),!0);
return this._template.replaceTokenWithElement("doneButton",e),this._navigationElement=this._template.composeAsElement(),this._navigationElement},_handleDoneButtonClick:function(){modal.popDocument()}}),its.dv14.NavigationBarWithCancelButton=Class.createSubclass("its.dv14.NavigationBarWithCancelButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_navigation_bar_with_cancel_button")},render:function(){var e=its.sf14.ComponentUtil.createButton(this,its.loc("Cancel"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left"},this._handleCancelButtonClick.bind(this),!0);
return this._template.replaceTokenWithElement("cancelButton",e),its.App.isAppPreview()&&this._template.replaceTokenUnescaped("class","hidden-bar"),this._navigationElement=this._template.composeAsElement(),this._navigationElement},_handleCancelButtonClick:function(){itms.exit()}}),its.dv14.NotifyMeButton=Class.createSubclass("its.dv14.NotifyMeButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._kind=this._content.kind,this._currentOffer=this.lookup("offer"),this._notifiedApps=localStorage.getItem(its.dv14.NotifyMeButton.notifiedAppsStorageKey)?JSON.parse(localStorage.getItem(its.dv14.NotifyMeButton.notifiedAppsStorageKey)):{},this._buyDidCompleteCallback=this._onNotificationConplete.bind(this),its.notifications.subscribe(its.sf14.Events.NOTIFY_ME_SUCCESS,this._buyDidCompleteCallback)},templateName:function(){return"components/dv14_notify_me_button"},_offer:function(){return this._currentOffer},renderAsString:function(){return this._content.bundleId&&this.setAttribute("bundle-id",this._content.bundleId),this._setType(its.sf14.ComponentUtil.ButtonType.BUY),this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.preorder),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSelectEvent.bind(this),this.itsId()),this._setActionText(its.loc("SF.NotifyText")),this._markup=this.template.compose(this.itsId()),this._markup},_disable:function(e){this.setAttribute("disabled",e),e?this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.disabled):this._updateButtonStyle(its.dv14.BuyButton.ButtonStyle.preorder)},_updateButtonState:function(e){this._currentOffer=e,this.setAttribute("data-type","buy"),this._wasNotified()?this._disable(!0):this._disable(!1)},_updateButtonStyle:function(e){e!=this._buttonStyle&&(this.removeClass(this._buttonStyle),this.addClass(e),this._buttonStyle=e)},_handleSelectEvent:function(e){this._setMetricsTargetInfo(e),this._performBuy()},_performBuy:function(){var e=Class.shallowClone(this._offer());
if((!e||!e.buyParams)&&e.type!=="subscribe"){this._disable(!1);
return}var t=Class.shallowClone(this._content);
t.isNotifyMeContent=!0,t.offers=[e],t.documentUrl=this.documentUrl(),t.buyButton=this.element;
var n;
this.rootComponent.pageInfo&&(t.pageInfo=this.rootComponent.pageInfo(),t.pageInfo&&t.pageInfo.metricsBase&&(n=t.pageInfo.metricsBase.page));
var r=this.lookup("siriTabAffiliateToken");
if(r&&r.length>0)for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&oneTimeBuyAffiliateToken="+r;
t.clientBuyId=its.dv14.BuyButton.createBuyClientId();
var s=its.sf.Metrics.Events.BuyConfirmed.metricsBuyParamsString(its.objectAtPath("pageInfo.metricsBase.pageId",t),its.objectAtPath("pageInfo.metricsBase.pageType",t),its.objectAtPath("pageInfo.metricsBase.pageContext",t),null,its.sf.Metrics._TOPIC_MAIN);
for(var i=0;
i<t.offers.length;
i++)n&&(t.offers[i].buyParams+="&origName="+n),t.offers[i].buyParams+="&clientBuyId="+t.clientBuyId+"&"+s;
if(this._lookupDocumentLevelData("extRefUrl2")){var o=this._lookupDocumentLevelData("extRefUrl2");
for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&extRefUrl2="+encodeURIComponent(o)}if(this._lookupDocumentLevelData("extRefApp2")){var u=this._lookupDocumentLevelData("extRefApp2");
for(var i=0;
i<t.offers.length;
i++)t.offers[i].buyParams=t.offers[i].buyParams+"&extRefApp2="+encodeURIComponent(u)}itms.buy(t)},_setActionText:function(e){this._actionText=e,this.element?this.element.textContent=e:this.template.replaceToken("actionText",e)},_setType:function(e){e?(this._type=e,this.setAttribute("type",this._type)):this.removeAttribute("type")},onElementCreated:function(e){this._updateButtonState(this._offer())},_setMetricsTargetInfo:function(e){e&&e.action&&(e.eventInfo.name="");
if(this.element){var t=this._content?this._content.id:null,n,r;
if(e&&e.eventInfo&&e.eventInfo.name==its.sf14.Events.ACTION)n=its.sf.Metrics.ActionType.SELECT,r=this._content?this._content.bundleId:null,its.sf.Metrics.setTargetInfo(this.element,t,"button",n,null,r),its.notifications.publish(its.sf14.Events.SELECT,{pageInfo:e.pageInfo,target:this.element});
else{n=this._getMetricsActionType(e);
if(n==its.sf.Metrics.ActionType.BUY||n==its.sf.Metrics.ActionType.UPDATE||n==its.sf.Metrics.ActionType.DOWNLOAD){var i=this._offer(),s=i?i.buyParams:null;
s?r={buyParams:s}:i&&i.download&&i.download.url&&(r=i.download.url)}its.sf.Metrics.setTargetInfo(this.element,t,"button",n,null,r)}}},_getMetricsActionType:function(e){return its.sf.Metrics.ActionType.NOTIFY},_onNotificationConplete:function(e){e.product.id===this._content.id&&(this._notifiedApps[its.sf.Client.dsId()]||(this._notifiedApps[its.sf.Client.dsId()]={}),this._notifiedApps[its.sf.Client.dsId()][e.product.id]=!0,localStorage.setItem(its.dv14.NotifyMeButton.notifiedAppsStorageKey,JSON.stringify(this._notifiedApps)),this._disable(!0))},_wasNotified:function(){return this._notifiedApps&&this._notifiedApps[its.sf.Client.dsId()]&&this._notifiedApps[its.sf.Client.dsId()][this._content.id]}}),its.dv14.NotifyMeButton.isNotifyMeContent=function(e){var t=its.serverData.properties["SF.isNotifyMeEnabled"],n=its.serverData.properties["SF.notifyMeIds"]||[],r=!1;
if(n.indexOf(e)!=-1||n.indexOf(e+"")!=-1)r=!0;
return t&&r},its.dv14.NotifyMeButton.isNotifyMeContentWithAppleWatchApp=function(e){var t=its.serverData.properties["SF.notifyMeIdsWithAppleWatchApp"]||[],n=!1;
if(t.indexOf(e)!=-1||t.indexOf(e+"")!=-1)n=!0;
return n},its.dv14.NotifyMeButton.isNotifyMeContentWithTvApp=function(e){var t=its.serverData.properties["SF.notifyMeIdsWithTvApp"]||[],n=!1;
if(t.indexOf(e)!=-1||t.indexOf(e+"")!=-1)n=!0;
return n},its.dv14.NotifyMeButton.notifiedAppsStorageKey="its.dv14.NotifyMeButton.notifiedApps",its.dv14.Offer=Class.createSubclass("its.dv14.Offer",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._buttons=this.lookup("buttons"),this._title=this.lookup("title"),this._subtitle=this.lookup("subtitle"),this._attributes=this.lookup("attributes")||{},this._layout=its.isDefined(this.lookup("layout"))?this.lookup("layout"):its.dv14.Offer.Layout.TEXT_ON_LEFT,this._styleType=its.isDefined(this.lookup("styleType"))?this.lookup("styleType"):its.dv14.Offer.OfferStyle.default,this.template=this._templateForLayout(),this._buttons||this.logger.error("IllegalArgumentException: Buy button created without buttons")},render:function(){this.template.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(this._attributes)),this.element=this.template.composeAsElement();
var e=document.createDocumentFragment(),t;
for(var n=0;
n<this._buttons.length;
n++)t=this._buttons[n],t&&(e.appendChild(t),t.getAttribute("supportsPlayButton")==="YES"&&this.element.setAttribute("supportsPlayButton","YES"));
return this.element.replaceTokenWithElement("buttons",e),this.updateTitle(this._title,this._styleType),this.updateSubtitle(this._subtitle),this.element},updateTitle:function(e,t){if(e){var n=this.rootComponent&&this.rootComponent.product;
!its.dv14.Util.Client.isWinBackSupported(n)&&its.dv14.Util.UI.shouldPinProductLockup({isPurchasedModal:this.data.isPurchasedModal})&&this.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),this.element?(this.element.replaceTokenWithElement("title",e),t&&this.addClass(its.dv14.Offer.OfferStyle[t])):(this.template.replaceTokenWithElement("title",e),t&&this.template.replaceToken("classes",its.dv14.Offer.OfferStyle[t]))}},updateSubtitle:function(e){e&&(this.element?this.element.replaceTokenWithElement("subtitle",e):this.template.replaceTokenWithElement("subtitle",e))},removeTitle:function(){var e=document.createElement("placeholder");
this.updateTitle(e)},removeSubtitle:function(){var e=document.createElement("placeholder");
this.updateSubtitle(e)},_templateForLayout:function(){var e;
switch(this._layout){case its.dv14.Offer.Layout.TEXT_ON_LEFT:e="components/dv14_offer/text_on_left";
break;case its.dv14.Offer.Layout.TEXT_ON_RIGHT:e="components/dv14_offer/text_on_right"}return its.Templates.get(e)}}),its.dv14.Offer.Layout={TEXT_ON_LEFT:"its.dv14.Offer.Layout.TEXT_ON_LEFT",TEXT_ON_RIGHT:"its.dv14.Offer.Layout.TEXT_ON_RIGHT"},its.dv14.Offer.OfferStyle={"default":"buy-button",cmc:"buy-cmc",preorder:"buy-preorder"},its.dv14.Pills=Class.createSubclass("its.dv14.Pills",its.sf14.BaseComponent,{initialize:function(e){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_pills"),this._pills=this.lookup("pills"),this._pillElements={},this._pillsById={},this._pillAliases=this.lookup("aliases")||{},this._pillClass=this.lookup("pillClass")||"pills",this._activeId=null,this._isActivePillIdActuallyAnAlias=!1,this._manuallySelectPills=this.lookup("manuallySelectPills");
for(var t=0;
t<this._pills.length;
t++)this._pillsById[this._pills[t].id]=this._pills[t]},render:function(){var e=this.lookup("maxItems"),t=this.lookup("moreLabel");
e&&this._template.replaceToken("maxItems",e),t||(t=its.loc("More")),this._template.replaceToken("moreLabel",t);
var n=this._template.getBlock("pillRepetition");
for(var r=0;
r<this._pills.length;
r++){var i=this._pills[r];
if(!its.isDefinedNonNull(i.id))throw"components/dv14_pills.js: pill does not have an id defined.";
var s=its.sf14.ComponentUtil.createItem(this,i.label,{"data-id":i.id,"data-disable-throttling":!0},this._handlePillSelected.bind(this));
n.replaceTokenUnescaped("pill",s),n.next()}this.lookup("showDivider")&&this._template.keepBlock("showDivider",!0),this._template.replaceToken("className",this._pillClass);
var o=this._template.composeAsElement();
for(var u=0;
u<this._pills.length;
u++){var i=this._pills[u],a=i.id;
this._pillElements[a]=o.querySelector('[data-id="'+a+'"]');
var f=this._pillElements[a];
its.sf.Metrics.setTargetInfo(f,a,"tab",its.sf.Metrics.ActionType.SELECT,null,{pillLabel:i.label})}return this.setActivePill(this.activePillId()),this.lookup("pinStyle")&&o.setAttribute("pin",this.lookup("pinStyle")),o},getActivePillElement:function(){var e=this.activePillId();
return this._pillElements.hasOwnProperty(e)?this._pillElements[e]:null},activePillId:function(){if(!its.isDefinedNonNull(this._activeId)){var e=this.lookup("activeId"),t=!1;
for(var n=0;
n<this._pills.length&&!t;
n++){var r=this._pills[n];
t=e==r.id}t?this._activeId=e:this._activeId=this._pills[0].id}return this._activeId},setActivePill:function(e){this._isActivePillIdActuallyAnAlias=!1,this._pillAliases[e]&&(e=this._pillAliases[e],this._isActivePillIdActuallyAnAlias=!0);
var t=this.lookup("pillsRoleType");
for(var n in this._pillElements){if(!this._pillElements.hasOwnProperty(n))continue;var r=this._pillElements[n];
n==e?(r.setAttribute("selected",!0),this._activeId=n):r.removeAttribute("selected")}},_handlePillSelected:function(e){if(its.sf14.BaseDocument.MODE.IS_IN_EDIT_MODE)return;var t=e.target.getAttribute("data-id");
if(t!=this.activePillId()||this._isActivePillIdActuallyAnAlias){this._manuallySelectPills||this.setActivePill(t);
var n=this.lookup("clickListener");
n&&n(t)}},setPillLabels:function(e){for(var t in e){var n=e[t];
this.setPillLabelForPill(t,n)}},setPillLabelForPill:function(e,t){this._pillElements[e]&&(this._pillElements[e].textContent=t)}}),its.dv14.PurchasesPlaylist=Class.createSubclass("its.dv14.PurchasesPlaylist",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_purchases_playlist"),this._primaryContent=this.lookup("primaryContent"),this._backingContent=this.lookup("backingContent"),this._idsToRedownload=this._backingContent&&this._backingContent.orderedKeys.length>0?this._backingContent.orderedKeys:[this._primaryContent.id],this._isRestoreMode=its.isDefinedNonNull(this.lookup("isRestoreMode"))?this.lookup("isRestoreMode"):!1,this._content={orderedKeys:[]};
if(this._backingContent&&this._backingContent.orderedKeys.length>0)for(var e=0;
e<this._backingContent.orderedKeys.length;
e++){var t=this._backingContent.orderedKeys[e];
this._content[t]=this._backingContent[t],this._content.orderedKeys.push(t)}this._offersMap=null},render:function(){this._template.replaceTokenUnescaped("artwork",this._artwork());
var e=this._primaryContent.kind==its.sf.StorePlatform.Kind.TvSeason?this._primaryContent.artistName:this._primaryContent.name;
this._template.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,e,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":"product-title"}}));
var t=this._primaryContent.kind==its.sf.StorePlatform.Kind.TvSeason?its.sf14.LockupUtil.tvSeasonNameWithoutShowName(this._primaryContent.name,this._primaryContent.artistName):this._primaryContent.artistName;
this._template.replaceTokenUnescaped("subtitle",its.sf14.ComponentUtil.createText(this,t,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{"class":"subtitle"}}));
if(this._primaryContent.kind!==its.sf.StorePlatform.Kind.Album){var n={content:this._backingContent,additionalClasses:["purchases-playlist-redownload-button"],isDownloadAll:this._backingContent&&this._backingContent.orderedKeys.length>1},r=this.renderComponentStringWithData("redownload_button",n);
this._template.replaceTokenUnescaped("redownloadButton",r)}return this._primaryContent.kind==its.sf.StorePlatform.Kind.Album?this._template.replaceTokenWithElement("tracklist",this._trackList()):this._primaryContent.kind==its.sf.StorePlatform.Kind.TvSeason&&this._template.replaceTokenWithElement("episodes",this._episodes()),this.element=this._template.composeAsElement(),this.element},_trackList:function(){var e=[];
e.push(new its.dv14.TrackList.Column.Ordinal),e.push(new its.dv14.TrackList.Column.Title(its.loc("DV14.TrackList.Column.Name"))),e.push(new its.dv14.TrackList.Column.Badge),e.push(new its.dv14.TrackList.Column.Duration(its.loc("DV14.TrackList.Column.Duration"))),e.push(new its.dv14.TrackList.Column.RedownloadButton(its.loc("DV14.TrackList.Column.Price")));
var t={contentIds:this._content.orderedKeys,columns:e,alwaysOverrideTrackNumbers:!0};
return this.renderComponentWithData("track_list",t)},_episodes:function(){var e=its.sf.Platform.iPad()?its.Templates.get("components/dv14_purchases_playlist/episode_list"):its.Templates.get("pages/dv14_tv_season_page/episode_item_iphone"),t=e.getBlock("episodeLockupLoop");
for(var n in this._content.orderedKeys){var r=this._content[this._content.orderedKeys[n]],i={number:formatNumber(r.trackNumber),title:r.name};
t.replaceToken("title",its.loc("DV14.TvSeasonPage.TrackNumberAndTitle",i)),t.replaceToken("description",r.description.standard),t.replaceToken("moreLabel",its.loc("More"));
if(its.sf.Platform.iPad()){var s=its.Templates.get("components/dv14_purchases_playlist/episode_preview_icon");
s.replaceToken("src",its.serverData.constants.resourceBaseUrl+"/images/play-icon.png"),s.replaceToken("height",30),s.replaceToken("width",30);
var o=s.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,function(e){return function(){this._playEpisodePreview(e)}.bind(this)}.bind(this)(r),o.itsId()),t.replaceTokenUnescaped("playIcon",o)}var u={orderedKeys:[r.id]};
u[r.id]=r;
var a={content:u};
t.replaceTokenUnescaped("redownloadButton",this.renderComponentStringWithData("redownload_button",a)),t.next()}return e.composeAsElement()},_playEpisodePreview:function(e){var t=its.sf.StorePlatformUtil.bestPreview(e.offers),n={url:t.url,contentRating:its.sf.ContentRatingsManager.legacyContentRating(e),kind:e.kind,contentId:e.id},r=its.sf14.BaseDocument.renderDocumentWithData("video_playlist",{videos:[n]},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:r,pageTarget:its.sf14.PageController.PageTarget.MODAL})},_artwork:function(){var e=this._primaryContent.artwork,t=this.lookup("kindOrName");
t||(t=this._primaryContent.kind),this._doesPassParentalRating||(this._primaryContent.kind==its.sf.StorePlatform.Kind.Audiobook?e=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_AUDIOBOOK:this._primaryContent.kind==its.sf.StorePlatform.Kind.EBook&&(e=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_BOOK));
var n=this.lookup("artworkEffects"),r={artworkUrls:e,size:its.dv14.LockupUtil.getArtworkDimensions("purchasesPlaylist",its.sf.StorePlatform.ArtworkProfiles.LOCKUP,this.documentSize()),effects:n?n:its.sf14.Artwork.effects(this._primaryContent.kind),alt:this._primaryContent.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this._primaryContent.kind)]};
return this.renderComponentStringWithData("artwork",r)}}),its.dv14.RadioSwoosh=Class.createSubclass("its.dv14.RadioSwoosh",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._additionalCssClasses=this.lookup("additionalCssClasses"),this._title=this.lookup("title"),this._content=this.lookup("content"),this._artworkProfile&&(this.data["its.dv14.SmallLockup"]={artworkProfile:this._artworkProfile})},templateName:function(){return"components/dv14_shelf"},componentType:function(){return"swoosh"},render:function(){if(this._title){this.template.keepBlock("headerBlock",!0);
var e=this.template.getBlock("headerBlock",!0);
e.replaceTokenUnescaped("title",this._title)}this._additionalCssClasses?this.template.replaceToken("classes",this._additionalCssClasses):this.template.replaceToken("classes","shelf"),this._contentId&&this.template.replaceToken("adamId",this._contentId),this.template.keepBlock("showDivider"),this._swooshElement=this.template.composeAsElement();
var t=document.createDocumentFragment(),n=this._content.length==1?its.dv14.RadioStationLockup.Type.LIST:its.dv14.RadioStationLockup.Type.SHELF;
for(var r=0;
r<this._content.length;
r++){var i=this.renderComponentWithData("radio_station_lockup",{content:this._content[r],type:n});
t.appendChild(i)}return this._swooshElement.replaceTokenWithElement("lockups",t),this._swooshElement}}),its.dv14.RottenTomatoesReviews=Class.createSubclass("its.dv14.RottenTomatoesReviews",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"components/dv14_rotten_tomatoes_component"},renderAsString:function(){var e=this.data.rottenTomatoesReviews,t=its.Templates.get("components/dv14_rotten_tomatoes_reviews");
t.replaceToken("topCriticsReviewsHeader",its.loc("DI6.RottenTomatoes.TopCriticsReviewsHeader"));
var n=e.criticReviews;
if(n&&n.length){var r=t.getBlock("reviewsLoop");
for(var i=0;
i<n.length;
i++){var s=this._reviewMarkup(n[i]);
r.replaceTokenUnescaped("reviews",s),r.next()}}var o=this._rottenTomatoesSiteLink();
return this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{pageTarget:its.sf14.PageController.PageTarget.EXTERNAL,url:e.url})}.bind(this),o.itsId()),t.replaceTokenUnescaped("linkToRottenTomatoesSite",o),t.compose()},_descriptionMarkup:function(e){var t={classes:["tomato-review-desc"],description:e,maxLines:5,showDivider:!1};
return this.renderComponentStringWithData("description",t)},_rottenTomatoesSiteLink:function(){var e=its.Templates.get("components/dv14_rotten_tomatoes_component/rotten_tomatoes_link_item");
return e.replaceToken("title",its.loc("DV6.MoreReviewsonRottenTomatoes")),e.compose()},_reviewMarkup:function(e){var t=its.Templates.get("components/dv14_rotten_tomatoes_component/review"),n=its.dv14.RottenTomatoesUtil.rottenTomatoesBaseName(e.freshness),r="resource://rottenTomatoes"+n+"Large";
t.replaceToken("imgSrc",r),t.replaceToken("title",its.loc("DV6.RottenTomatoes."+n.toLowerCase())),t.replaceTokenUnescaped("descriptionText",this._descriptionMarkup(e.reviewText));
var i=formatDate(new Date(e.date));
return t.replaceToken("citation",its.loc("SF.RottenTomatoes.Citation",{name:e.name,source:e.source,date:i})),t.compose()}}),its.dv14.RottenTomatoesUtil={_logger:its.Logger.named("its.dv14.RottenTomatoesUtil")},its.dv14.RottenTomatoesUtil.statisticsMarkup=function(e,t){var n=its.Templates.get("components/dv14_rotten_tomatoes_component/statistics"),r=t?"tomato-statistics-right-align":"tomato-statistics-left-align";
n.replaceToken("classes",r);
var i=e.numFreshReviews+e.numRottenReviews;
return n.replaceToken("tomatometerPercentage",its.loc("SF.Percentage",{percentage:e.tomatometerPercentage})),n.replaceToken("reviewsCounted",its.loc("SF.RottenTomatoes.ReviewsCounted",{count:i})),n.replaceToken("freshAndRotten",its.loc("SF.RottenTomatoes.FreshAndRotten",{freshCount:e.numFreshReviews,rottenCount:e.numRottenReviews})),n.replaceToken("averageRating",its.loc("SF.RottenTomatoes.AverageRating",{average:e.averageRating})),n.compose()},its.dv14.RottenTomatoesUtil.rottenTomatoesBaseName=function(e){switch(e){case"FRESH":case"fresh":return"Fresh";
case"certifiedFresh":case"CERTIFIED_FRESH":return"Certified";
case"rotten":case"ROTTEN":return"Rotten";
default:return this._logger.error("Unrecognized Rotten Tomatoes freshness: "+e),"Rotten"}},its.dv14.ShareButton=Class.createSubclass("its.dv14.ShareButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.data.content,this._pageState=this.data.pageState,this._isOwned=this._isContentOwned(),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this.subscribe(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,this._handlePageStateChangedEvent.bind(this))},renderAsString:function(){return this.template.replaceToken("classes",its.sf.Platform.iPad()?"share-button-product":"align-right"),this._markup=this.template.compose(this.itsId()),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleShareSheetSelect.bind(this),this.itsId()),this._markup},templateName:function(){return"components/dv14_share_button"},_handleShareSheetSelect:function(e){if(its.dv14.Util.Client.isPodcasts()&&typeof podcasts.sharePodcast=="function"){var t=JSON.parse(JSON.stringify(this._content)),n=its.sf14.ArtworkUtil.bestScaledImage(t.artwork,its.dv14.LockupUtil.getArtworkDimensions(t.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()));
n&&n.url&&(t.artwork.productLockupArtworkURL=n.url),podcasts.sharePodcast({content:t,sourceElement:e.target})}else{var r={content:this._content,pageState:this._pageState,isContentOwned:this._isOwned},i=its.sf14.BaseDocument.renderDocumentWithData("share_sheet",r,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),s={};
its.sf.Platform.iPad()&&(s.type="popover",s.sourceElement=e.target),its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:its.sf14.Util.ensureDocumentType(i),options:s,pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})}},_handlePersonalizationEvent:function(e){if(this.storePlatform==e.caller&&its.isDefined(e.data[this._content.id]))return this._isContentOwned()},_isContentOwned:function(){var e=[],t=this.storePlatform.getCachedOffersArray(this._content.id);
return t.length>0&&(e=its.sf.StorePlatformUtil.orderedOffers(t)),its.sf.StorePlatformUtil.hasOwnedOffers(e)},_handlePageStateChangedEvent:function(e){this._pageState=e.pageState},onElementCreated:function(){its.sf.Metrics.setTargetInfo(this.element,"shareButton","button",its.sf.Metrics.ActionType.SELECT)}}),its.dv14.Select=Class.createSubclass("its.dv14.Select",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"components/dv14_select"},renderAsString:function(){this._label=its.isDefined(this.lookup("label"))?this.lookup("label"):null,this._options=this.lookup("options"),this.addClass("action-color"),this._initialSelectedIndex=its.isDefined(this.lookup("selectedIndex"))?this.lookup("selectedIndex"):0,this._selectedIndex=this._initialSelectedIndex;
if(this._options.length>=1){var e=null;
this._initialSelectedValue=its.isDefined(this.lookup("selectedValue"))?this.lookup("selectedValue"):null;
if(!its.isDefined(this.lookup("selectedIndex"))&&its.isDefinedNonNull(this._initialSelectedValue))for(var t=0;
t<this._options.length;
t++){e=this._options[t];
if(this._initialSelectedValue==e.value){this._selectedIndex=t,this._initialSelectedIndex=this._selectedIndex;
break}}this._onSelectChangedCallback=this.lookup("onSelectChanged");
var n=this.template.getBlock("itemsLoop"),r=this._options;
for(var t=0;
t<r.length;
t++){e=r[t];
var i={value:e.value,selected:t==this._selectedIndex},s=function(e,t){return function(n){this._onSelectChangedCallback&&this._onSelectChangedCallback(e,t),this.setSelectedMenuItem(n.target)}.bind(this)}.bind(this)(e.value,t==this._selectedIndex);
n.replaceTokenUnescaped("item",its.sf14.ComponentUtil.createItem(this,e.name,i,s)),n.next()}this._markup=this.template.compose(this.itsId())}return this._markup},setSelectedMenuItem:function(e,t){if(this.element){var n=this.element.children;
for(var r=0;
r<n.length;
r++){var i=n.item(r),s=i.getAttribute("value");
i==e||s==t?i.setAttribute("selected",!0):i.setAttribute("selected",!1)}}}}),its.dv14.ShareSheet=Class.createSubclass("its.dv14.ShareSheet",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._content=this.data.content,this._pageState=this.data.pageState,this._isContentOwned=this.data.isContentOwned},templateName:function(){return"components/dv14_share_sheet"},render:function(){var e={artworkUrls:this._content.artwork,classes:[its.dv14.LockupUtil.getArtworkClassName(this._content.kind)],size:{width:100,height:100}};
this.template.replaceTokenWithElement("artwork",this.renderComponentWithData("artwork",e)),this.template.replaceToken("text",its.loc("DV6.ShareButton.DefaultText",{name:this._content.name,artistName:this._content.artistName}));
var t=this._content.shortUrl;
its.dv14.Util.Client.isVoyager()&&(t=its.url.appendUrlParameter(t,"app","messages"));
var n=this._content.offers;
n&&its.sf.StorePlatformUtil.findEVODOffers(n).length>0&&(t=its.url.appendUrlParameter(t,"app","tv")),this.template.replaceToken("shortUrl",t),this.template.replaceToken("url",this._content.url);
var r=this._offer(),i;
switch(this._content.kind){case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookTextbook:i=!1;
break;default:i=!0}itms.managedAppleID&&(i=!1);
if(r){i&&!this._isContentOwned&&this.template.replaceTokenUnescaped("wishlistActivity",its.sf14.ComponentUtil.createActivity(this,its.sf14.ComponentUtil.ActivityType.WISHLIST,this._handleAddToWishlistSelect.bind(this)));
var s=!0;
its.sf.ParentalRatingUtil.doesPass(this._content)||(s=!1),itms.managedAppleID&&(s=!1),r.type==="preorder"&&(s=!1),this._isGiftableKind()&&s&&this.template.replaceTokenUnescaped("giftActivity",its.sf14.ComponentUtil.createActivity(this,its.sf14.ComponentUtil.ActivityType.GIFT,this._handleGiftSelect.bind(this)))}this.element=this.template.composeAsElement(this.itsId());
var o={kind:this._content.kind};
return this.addDocumentStyles(this.element,o),this.element},_handleAddToWishlistSelect:function(){var e=function(){var e={type:its.sf.Platform.iPad()?"error":"actionSheet",title:its.loc("MZStoreElements.AddToWishlistFailed_message"),description:its.loc("MZStoreElements.AddToWishlistFailed_explanation"),neutral:{text:its.loc("OK")}},t=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",e,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:t,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL})},t=function(){itms.authenticate({},function(){this._handleAddToWishlistSelect.bind(this)})}.bind(this);
its.sf.wishlist.manager.addItem(this._content,this._isSD(),e,t)},_handleGiftSelect:function(e){var t=this._offer();
if(!t){alert("Cannot purchase gift");
return}var n=its.Templates.get("components/dv14_share_sheet/gift");
n.replaceToken("buyParams",t.buyParams),n.replaceToken("adamId",this._content.id);
var r=this._renderLockupElement();
n.replaceTokenWithElement("lockup",r);
var i=n.composeAsElement();
i=its.sf14.Util.ensureDocumentType(i),modal.pushDocument(i)},_isSD:function(){return this._pageState==its.sf14.ProductPage.State.SD},_isGiftableKind:function(){var e={};
e[its.sf.StorePlatform.Kind.Album]=!0,e[its.sf.StorePlatform.Kind.Song]=!0,e[its.sf.StorePlatform.Kind.Movie]=!0,e[its.sf.StorePlatform.Kind.ShortFilm]=!0,e[its.sf.StorePlatform.Kind.MusicVideo]=!0,e[its.sf.StorePlatform.Kind.TvSeason]=!0,e[its.sf.StorePlatform.Kind.TvEpisode]=!0,e[its.sf.StorePlatform.Kind.MobileApp]=!0,e[its.sf.StorePlatform.Kind.Audiobook]=!0,e[its.sf.StorePlatform.Kind.EBook]=!0,e[its.sf.StorePlatform.Kind.EBookMeta]=!0,e[its.sf.StorePlatform.Kind.EBookApple]=!0,e[its.sf.StorePlatform.Kind.EBookTextbook]=!0;
var t=e[this._content.kind];
if(t&&this._content.childrenIds&&this._content.childrenIds.length>0){var n=this._content.children[this._content.childrenIds[0]].kind;
t=e[n]}return this._content.passType&&(t=!1),t},_renderLockupElement:function(){var e={details:function(e){return[{value:e.name},{value:e.genres[0].name}]},suppressBuyButton:function(){return!1}},t={content:this._content,type:its.dv14.SmallLockup.Type.LIST,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.PRODUCT,detailsGenerator:e,"its.dv14.BuyButton":{showAsButtonless:!0,showActionTextAndPrice:!1,overrideText:this._offer().priceFormatted}};
return this.renderComponentWithData("small_lockup",t)},_offer:function(){return its.sf14.Util.offerForShareActivity(this._content,this._isSD())}}),its.dv14.StarHistogram=Class.createSubclass("its.dv14.StarHistogram",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._starBreakdown=this.data.starBreakdown?this.data.starBreakdown:[0,0,0,0,0],this._avgRating=this.data.avgRating?this.data.avgRating:0,this._hasRatings=this.data.starBreakdown&&this.data.avgRating,this._wasReset=!this.data._hasRatings&&this.data.wasReset,this._template=its.Templates.get("components/dv14_star_histogram"),this._totalRatingCount=0;
if(this._hasRatings)for(var e=0;
e<this.data.starBreakdown.length;
e++)this._totalRatingCount+=this.data.starBreakdown[e]},render:function(){var e;
this._hasRatings?e=this._markupForHistogram():this._wasReset?e=this._markupForWasReset():e=this._markupForNoRatings(),this._template.replaceTokenUnescaped("histogram",e);
var t=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0;
return this._template.keepBlock("showDivider",t),this._template.composeAsElement()},_markupForHistogram:function(){var e=its.Templates.get("components/dv14_star_histogram/histogram");
e.replaceToken("avgRating",this._avgRating),e.replaceToken("ratingsText",its.locWithCount("SF.RatingCount",this._totalRatingCount));
var t=e.getBlock("starBarBlock");
for(var n=this._starBreakdown.length;
n>0;
n--){var r=this._starBreakdown[n-1];
t.replaceToken("numStars",n),t.replaceToken("value",r/this._totalRatingCount),t.replaceToken("count",r),t.next()}return e.compose()},_markupForNoRatings:function(){var e=its.Templates.get("components/dv14_star_histogram/no_ratings");
if(this.data.content&&this.data.content.kind){var t="SF.NoRatings."+this.data.content.kind;
e.replaceToken("ratingsText",its.loc(t))}return e.compose()},_markupForWasReset:function(){var e=its.Templates.get("components/dv14_star_histogram/no_ratings");
return e.replaceToken("ratingsText",its.loc("SF.NoRatings.wasReset")),e.compose()}}),its.dv14.Swoosh=Class.createSubclass("its.dv14.Swoosh",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._contentId=this.lookup("contentId");
var e=this.lookup("doNotFilter")?this.lookup("contentIds"):its.dv14.Util.UI.filterByInstalledApps(this.lookup("contentIds"));
this._contentIds=its.dv14.Util.UI.filterUnsupportedPreOrders(this.storePlatform,e),this._additionalClasses=this.lookup("additionalCssClasses"),this._link=this.lookup("link"),this._title=this.lookup("title"),this._type=this.lookup("type")?this.lookup("type"):its.dv14.Swoosh.Type.DEFAULT,this._suppressPersonalization=its.isDefined(this.lookup("suppressPersonalization"))?this.lookup("suppressPersonalization"):!1,this._scrollableCellControllerClass=this.lookup("scrollableCellControllerClass")?this.lookup("scrollableCellControllerClass"):its.sf14.ScrollableCellController.Basic,this._showOrdinal=this.lookup("showOrdinal"),this._overrideBridgeFilter=its.isDefined(this.lookup("overrideBridgeFilter"))?this.lookup("overrideBridgeFilter"):!1},templateName:function(){return"components/dv14_shelf"},componentType:function(){return this.lookup("overrideComponentType")||"swoosh"},render:function(){(this._link||this._title)&&this.template.keepBlock("headerBlock",!0),this._title&&this.template.replaceToken("title",this._title);
if(this._additionalClasses)for(var e=0;
e<this._additionalClasses.length;
e++)this.addClass(this._additionalClasses[e]);
else this.addClass("shelf");
this._contentId&&this.template.replaceToken("adamId",this._contentId);
var t=!1;
if(this._shouldShowSeeAll()||this.lookup("alwaysShowSeeAll")){t=this._link.callback,this.template.keepBlock("linkBlock",!0),this.template.replaceTokenUnescaped("link",this._link.label);
var n={"class":"link-color"};
t||(n["data-url"]=this._link.url);
var r=its.sf14.ComponentUtil.createButton(this,this._link.label,its.sf14.ComponentUtil.ButtonType.LINK,n,t);
this.template.replaceTokenUnescaped("link",r),this.subscribeToTarget(its.Template.Events.NEW_ELEMENTS_CREATED,function(e){its.sf.Metrics.setTargetInfo(e.target,this._link.label,"button",its.sf.Metrics.ActionType.NAVIGATE,this._link.url)}.bind(this),r.itsId())}var i=its.isDefinedNonNull(this.lookup("showDivider"))?this.lookup("showDivider"):!0,s=!1;
its.sf.Platform.iPadPro()&&(i=!1,s=!0),this.template.keepBlock("addHiddenDivider",s),this.template.keepBlock("showDivider",i),this.element=this.template.composeAsElement(this.itsId()),this._shelfElement=this.element.querySelector("shelf"),this._scrollableCellController=this._createScrollableCellController(this._shelfElement);
if(this._type==its.dv14.Swoosh.Type.LIST){var o=its.sf.Platform.iPad()?"ipad-track-shelf":"iphone-track-shelf";
this._shelfElement.setAttribute("rowCount",4),this._shelfElement.setAttribute("class",o)}return its.dv14.Util.Client.isBridge()&&its.notifications.subscribe(its.sf14.ScrollableCellController.Events.NO_CONTENT,function(e){e&&e.parentNode&&e.remove()}),this.element},_createScrollableCellController:function(e){var t={suppressPersonalization:this._suppressPersonalization,artworkProfile:this._artworkProfile,showOrdinal:this._showOrdinal,overrideBridgeFilter:this._overrideBridgeFilter};
return new this._scrollableCellControllerClass(this,e,this._contentIds,t)},_shouldShowSeeAll:function(){return its.dv14.Util.UI.shouldShowSeeAll(this._link,this._contentIds)}}),its.dv14.Swoosh.Type={DEFAULT:"its.dv14.Swoosh.Type.DEFAULT",LIST:"its.dv14.Swoosh.Type.LIST"},its.dv14.PersonalizedSwoosh=Class.createSubclass("its.dv14.PersonalizedSwoosh",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._title=this.lookup("title"),this._dk=this.lookup("dk"),this._fcKindId=this.lookup("fcKindId"),this._swooshType=this.lookup("type"),this._personalizedSwooshData=this.lookup("personalizedSwooshData"),this._lookupUrlData=this._personalizedSwooshData.lookupUrlData,this._lockupCountMinimum=this._personalizedSwooshData.lockupCountMinimumIos,this._allowExplicit=this.lookup("allowExplicit"),this._salableAdamid=this.lookup("salableAdamid"),this._salableKind=this.lookup("salableKind"),this._fetchAdamIDsOnRender=this.lookup("fetchAdamIDsOnRender")},render:function(){return itms.DSID||this._swooshType&&this._swooshType.componentType&&this._swooshType.componentType.match(/similarTo_swoosh/)?(this._template=its.Templates.get("dv14_personalized_swoosh"),this._element=this._template.composeAsElement(),this._fetchAdamIDsOnRender?this.fetchAdamIds():this._needsAdamIds=!0):this._element=document.createElement("placeholder"),this._element},allowExplicit:function(){return this._salableKind=="epubBook"?this._allowExplicit:!its.sf.ParentalRatingUtil.parentalThresholdMusic()},fetchAdamIds:function(){var e=this._lookupUrlData.baseUrl,t=parseInt(this._lookupUrlData.timeoutInMillis,10),n={allowExplicit:this.allowExplicit(),dkIds:this._dk,fcKindId:this._fcKindId,salableAdamid:this._salableAdamid};
e=its.url.appendUrlParameters(e,n),its.sf14.Util.postJSON(e,{},this._handlePersonalizedDataFetched.bind(this),this._handlePersonalizedDataFetchFailure.bind(this))},_handlePersonalizedDataFetchFailure:function(){this._element=document.createElement("placeholder")},_handlePersonalizedDataFetched:function(e){var t=this._allowExplicit,n=null;
if(!its.sf.StorePlatformUtil.isAnyEbookKind(this._salableKind)){var r=its.url.appendUrlParameter(this._personalizedSwooshData.seeAllUrl,"allowExplicit",!its.sf.ParentalRatingUtil.parentalThresholdMusic());
this._fcKindId&&(r=its.url.appendUrlParameter(r,"fcKindId",this._fcKindId)),n={label:its.loc("See All"),url:r}}var i={link:n,title:e.title||this._title,overrideComponentType:this._swooshType.componentType};
Class.extend(i,this._swooshType.additionalSwooshData(e,this._dk,this.storePlatform));
var s=i.contentIds!==undefined&&i.contentIds.length>=this._lockupCountMinimum;
s?this._element.replaceTokenWithElement("swoosh",this.renderComponentWithData("swoosh",i)):this._element=document.createElement("placeholder")}}),its.dv14.PersonalizedSwoosh.Type={CMC:{additionalSwooshData:function(e,t,n){var r="cm-"+t,i,s=e[r].lockupData[0];
return s&&(n.cacheStorePlatformDataForProfiles(s.storePlatformData),i=e[r].contentIds),{contentIds:i}},componentType:"cmc_swoosh"},NEW_FROM_ARTISTS:{additionalSwooshData:function(e,t,n){var r,i,s=e[t];
return s&&(r=s.contentIds,i=s.recoMetricsData,n.cacheStorePlatformDataForProfiles(s.storePlatformData)),{contentIds:r,additionalMetricsData:i}},componentType:"nfa_swoosh"},RECOMMENDATIONS:{additionalSwooshData:function(e,t,n){var r,i,s=e;
return s&&(r=s.contentIds,i=s.recoMetricsData,n.cacheStorePlatformDataForProfiles(s.storePlatformData)),{contentIds:r,additionalMetricsData:i}},componentType:"recommendations_swoosh"},SIMILAR_TO:{additionalSwooshData:function(e,t,n){var r=e;
return r&&(similarToData=r.contentIds11,recoMetricsData=r.recoMetricsData,n.cacheStorePlatformDataForProfiles(r.storePlatformData)),{contentIds:similarToData,additionalMetricsData:recoMetricsData}},componentType:"similarTo_swoosh"}},its.dv14.PreviewOverlay=Class.createSubclass("its.dv14.PreviewOverlay",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._previewUrl=this.lookup("previewUrl"),this._content=this.lookup("content")},render:function(){this._template=its.Templates.get("components/dv14_preview_overlay"),this._template.replaceToken("previewUrl",this._previewUrl),this._template.replaceToken("title",this._content.name),this._template.replaceToken("subtitle",this._content.artistName),this._template.replaceToken("contentId",this._content.id);
var e={content:this._content,offer:its.sf.StorePlatformUtil.orderedOffers(this._content.offers)[0]};
this._template.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("buy_button",e));
var t=this._template.composeAsElement();
return its.sf.Metrics.setTargetInfo(t,this._content.id,"preview",its.sf.Metrics.ActionType.SELECT,this._previewUrl),t}}),its.dv14.RedownloadButton=Class.createSubclass("its.dv14.RedownloadButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._preferedVariant=this.lookup("preferedVariant"),this._onDownloadCompletedCallback=this.lookup("downloadCompletedCallback"),this._idsToRedownload=this._content.orderedKeys,this._allowPlayback=this.lookup("allowPlayback"),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateButtonState.bind(this)),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this))},templateName:function(){return"components/dv14_redownload_button"},renderAsString:function(){this._updateButtonState(),this._idsToRedownload.length===1&&this.setAttribute("data-content-id",this._idsToRedownload[0]);
var e=this.lookup("additionalClasses");
if(e)for(var t in e)this.addClass(e[t]);
return this._markup=this.template.compose(this.itsId()),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSelectEvent.bind(this),this.itsId()),this._markup},_offers:function(e){if(!this._offersMap||e){this._offersMap={};
var t=!0;
for(var n=0;
n<this._idsToRedownload.length&&t;
n++){var r=this._idsToRedownload[n],i=this.storePlatform.getCachedOffersArray(r),s=its.sf.StorePlatformUtil.findRedownloadOffers(i);
s.length>0?this._offersMap[r]=s:t=!1}t||(this._offersMap=null)}return this._offersMap},_handleSelectEvent:function(){var e=[];
for(var t=0;
t<this._content.orderedKeys.length;
t++){var n=this._content.orderedKeys[t],r=this._content[n],i=this._offers()[n];
if(!this._isContentDownloaded(n)&&r&&i){var s=r.kind!=its.sf.StorePlatform.Kind.Booklet||this._shouldAllowExtrasRedownload();
s}var o=Class.shallowClone(r);
o.offers=i,o.documentUrl=this.documentUrl(),itms.buy(o)}},_shouldAllowExtrasRedownload:function(){var e=!0,t=!1;
for(var n=0;
n<this._content.orderedKeys.length;
n++){var r=this._content.orderedKeys[n],i=this._content[r];
if(i.kind==its.sf.StorePlatform.Kind.Movie){t=!its.dv14.Client.isInLibrary(i.id);
break}}return t&&(e=!1),e},_updateButtonState:function(){!this._isAllContentDownloaded()&&this._offers()||this._allowPlayback?(this.setAttribute("disabled",!1),this._showAsHidden(!1)):(this.setAttribute("disabled",!0),this._showAsHidden(!0))},_isContentDownloaded:function(e){return localContent=this.lookup("localContent"),localContent?localContent.hasOwnProperty(e):!1},_isAllContentDownloaded:function(){var e=!0;
for(var t=0;
t<this._content.orderedKeys.length&&e;
t++){var n=this._content.orderedKeys[t];
e=this._isContentDownloaded(n)}return e},_showAsHidden:function(e){e?this.removeAttribute("type"):this.setAttribute("type",its.sf14.ComponentUtil.ButtonType.DOWNLOAD)},_handlePersonalizationEvent:function(e){for(var t in this._idsToRedownload){var n=this._idsToRedownload[t];
if(e.data[n]){this._updateButtonState();
break}}}}),its.dv14.RadioPromo=Class.createSubclass("its.dv14.RadioPromo",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._radioPromoData=this.lookup("radioPromoData")},render:function(){var e=this._radioPromoData.editorialMetadata,t=its.Templates.get("components/dv14_radio_promo");
e||(e={title:this._radioPromoData.name,subtitle:its.loc("Radio.PromoWidgetString"),showArtwork:!0}),e.title&&e.title!=""&&(e.title.toLowerCase().match(/first\s?play/)?(t.keepBlock("titleBadgeBlock"),t.replaceToken("badgeUrl",its.serverData.constants.resourceBaseUrl+"/images/radio_firstplay_mask.2x.png")):(t.keepBlock("titleBlock"),t.replaceToken("title",e.title))),e.showArtwork?t.replaceTokenWithElement("artwork",this.renderComponentWithData("artwork",{artworkUrls:this._radioPromoData.artwork,size:its.dv14.LockupUtil.getArtworkDimensions("radioPromo",null,this.documentSize())})):t.replaceTokenWithElement("artwork",this.renderComponentWithData("artwork",{artworkUrls:its.dv14.Artwork.PlaceholderArtwork.RADIO_PROMO,size:its.dv14.LockupUtil.getArtworkDimensions("radioPromo",null,this.documentSize())})),e.subtitle&&e.subtitle!=""&&(t.keepBlock("subtitleBlock",!0),t.replaceToken("subtitle",e.subtitle));
var n=t.composeAsElement();
return this.subscribeToTarget(its.sf14.Events.SELECT,function(){var e={url:this._radioPromoData.url,pageTarget:its.sf14.PageController.PageTarget.EXTERNAL};
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,e)}.bind(this),n.itsId()),!this.lookup("isArtistPage")&&its.dv14.Util.UI.shouldPinProductLockup()&&n.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),n}}),its.dv14.SampleButton=Class.createSubclass("its.dv14.SampleButton",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_sample_button"),this._content=this.lookup("content"),this._kind=this._content.kind,this._downloadDict=this.lookup("downloadDict"),this._buttonStyle=this.lookup("buttonStyle")||its.dv14.BuyButton.ButtonStyle.default,this._artworkItsId=this.lookup("artworkItsId"),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},render:function(){return this._content=this.lookup("content"),this._template.replaceToken("buttonText",its.loc("SampleButton.Sample")),this._template.replaceToken("contentId",this._content.id),this._sampleButton=this._template.composeAsElement(this.itsId()),this._sampleButton.classList.add(this._buttonStyle),its.sf.Platform.iPhone()&&this._sampleButton.classList.add("align-right"),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSelectEvent.bind(this),this.itsId()),this._updateRestrictions(),this._sampleButton},_handleSelectEvent:function(e){this._setMetricsTargetInfo(e);
var t=function(){window.iBooksContent&&iBooksContent.openContentId?iBooksContent.openContentId(this._downloadDict.itemId,{itsId:this._artworkItsId}):itms.getBookSample(this._downloadDict)}.bind(this);
itms.isRemovedSystemApp?itms.isRemovedSystemApp(its.dv14.Util.BundleId.IBOOKS,function(e){e?this._displayHiddenIBooksMessage():t()}.bind(this)):t()},_displayHiddenIBooksMessage:function(e){var t=this._content.kind==its.sf.StorePlatform.Kind.Audiobook?"DV14.IBooksHidden.DownloadFromAppStore.Audiobook":"DV14.IBooksHidden.DownloadFromAppStore",n={type:"dialog",title:its.loc("DV14.IBooksHidden.Title"),description:its.loc(t),positive:{text:its.loc("DV14.VideoHidden.Dialog.AppStore"),callback:function(){var e=itms.getBag().productPageForIBooks||"itms-appss://";
openURL(e)}},negative:{text:its.loc("Cancel")}},r=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",n,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:r,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},_updateRestrictions:function(){its.sf.ParentalRatingUtil.doesPass(this._content)?this._sampleButton.removeAttribute("disabled"):this._sampleButton.setAttribute("disabled",!0)},_personalize:function(e){e.type==its.sf.StorePlatform.Offer.Type.REDOWNLOAD&&this._sampleButton.remove()},_setMetricsTargetInfo:function(e){if(e.target){var t=this._content?this._content.id:null,n=this._getMetricsActionType(),r=this._content?this._content.bookSampleDownloadUrl:null;
e&&e.eventInfo&&e.eventInfo.name==its.sf14.Events.SELECT&&its.sf.Metrics.setTargetInfo(e.target,t,"button",n,null,r)}},_getMetricsActionType:function(){return its.sf.Metrics.ActionType.SAMPLE},_handlePersonalizationEvent:function(e){if(its.isDefined(e.data[this._content.id])){var t=this.storePlatform.getCachedOffersArray(this._content.id),n=its.sf.StorePlatformUtil.orderedOffers(t);
n.length>0&&this._personalize(n[0])}}}),its.dv14.SampleButton.createDownloadDictForEbookSample=function(e){var t=its.serverData.constants.ebookSampleBaseUrl,n=its.url.parseQueryParams(e.offers[0].buyParams),r=its.url.appendUrlParameters(t,{id:e.id,pricingParameters:n.pricingParameters}),i,s=its.sf14.ArtworkUtil.bestScaledImage(e.artwork,its.sf14.LockupUtil.getArtworkDimensions(e.kind,its.sf.StorePlatform.ArtworkProfiles.SWOOSH));
s&&(i={"image-type":"download-queue-item","default":{url:s.url}});
var o={artistName:e.artistName,isSample:!0,itemId:e.id,itemName:e.name,itemType:"eBook",genreName:e.genres[0].name,fileExtension:"epub",kind:"ebook",url:r,"artwork-urls":i,artworkURL:i?i.default.url:null,releaseDate:e.releaseDate,explicit:!its.sf.ParentalRatingUtil.doesPass(e),longDescription:""};
return o},its.dv14.SearchField=Class.createSubclass("its.dv14.SearchField",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._placeholderText=this.lookup("placeholderText"),this.subscribe(its.dv14.SearchPage.Events.SEARCH_FETCHED,this.updateSearchTerm.bind(this)),this.subscribe(its.dv14.SearchPage.Events.CLEAR_SEARCH_TERM,this._clearSearchTerm.bind(this))},templateName:function(){return"components/dv14_search_field"},renderAsString:function(){return this.setAttribute("searchHints",this.lookup("hintsUrl")),this.setAttribute("trendingSearch",this.lookup("trendingSearchUrl")),this._placeholderText&&this.setAttribute("placeholder",this._placeholderText),this.template.replaceToken("searchTerm",this.lookup("initialSearchTerm")||its.dv14.SearchField.TERM),this.lookup("initialAccessoryText")&&this.setAttribute("accessoryText",this.lookup("initialAccessoryText")),its.sf.Platform.iPad()&&!this.lookup("isCompact")&&!its.dv14.Util.Client.isVoyager()?this.addClass("search-field-on-ipad"):its.dv14.Util.Client.isVoyager()?this.addClass("search-field-ipad-messages"):this.addClass("align-center"),this.subscribeToTarget(its.sf14.Events.SUBMIT,this._onSearchSubmitted.bind(this),this.itsId()),this.subscribeToTarget(its.sf14.Events.CHANGE,this._onTermChanged.bind(this),this.itsId()),this.subscribe(its.dv14.SearchField.Events.TERM_CHANGED,this.updateSearchTerm.bind(this)),this._markup=this.template.compose(this.itsId()),this._markup},updateAccessoryText:function(e){this.setAttribute("accessoryText",e)},updateSearchTerm:function(e){its.isDefined(e.term)&&(its.dv14.SearchField.TERM=e.term,this.element&&(!e.eventInfo||e.eventInfo.sender!=this?this.element.textContent=its.dv14.SearchField.TERM:e.term==""&&this.element.textContent!=e.term&&(this.element.textContent="")))},_onTermChanged:function(e){its.notifications.publish(its.dv14.SearchField.Events.TERM_CHANGED,e,this)},_clearSearchTerm:function(){its.notifications.publish(its.dv14.SearchField.Events.TERM_CHANGED,{term:"",refreshTrendingSearches:!0})},_onSearchSubmitted:function(e){if(!e.url){var t={clientApplication:its.dv14.Util.Client.getClientApplication(),term:e.term};
its.dv14.PageController.shouldShowStopPageForPageTarget("tv")&&(t.videos="false"),e.url=its.url.appendUrlParameters(itms.getBag().search,t)}e.term&&its.notifications.publish(its.dv14.SearchField.Events.TERM_CHANGED,e),its.dv14.SearchPage.fetchSearch(e,!0)}}),its.dv14.SearchField.TERM="",its.dv14.SearchField.Events={SEARCH_SUBMITTED:"its.dv14.SearchField.Events.SEARCH_SUBMITTED",TERM_CHANGED:"its.dv14.SearchField.Events.TERM_CHANGED"},its.dv14.TabbedPane=Class.createSubclass("its.dv14.TabbedPane",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_tabbed_pane"),this._panes=this.lookup("panes"),this._aliases=this.lookup("aliases")||{},this._tabTotal=this._panes.length,this._tabInfos={},this._pillComponent=null,this._shouldPreRenderTabs=!1,this._initialActiveTabId=null,this._alwaysForceRefresh=this.lookup("alwaysForceRefeshTabs"),this._suppliedContentRegion=this.lookup("contentRegion"),this._disableCallbacks=its.isDefinedNonNull(this.lookup("disableCallbacks"))?this.lookup("disableCallbacks"):!1},render:function(){return this._tabbedPaneElement=this._template.composeAsElement(),this.replaceCurrentPanes(this._panes,this._aliases),this._updateTabbedPane(this._getInitialActiveTabId()),this._preRenderHiddenTabs(),this._tabbedPaneElement},refreshTab:function(e){var t=e||this.selectedTabId();
this._updateTabbedPane(t,!0)},refreshAllTabs:function(){this._updateTabbedPane(this.selectedTabId(),!0),this._preRenderHiddenTabs(!0)},clearTabCache:function(e){var t=this._tabInfos[e];
t&&t.clearPaneCache()},handleTabClicked:function(e){if(its.sf14.BaseDocument.MODE.IS_IN_EDIT_MODE)return;this._useHashTags?this._updateHashTag(e):this._updateTabbedPane(e);
var t=this.lookup("tabChangedCallBack");
t&&setTimeout(function(){t(e)},1)},selectedTabId:function(){return this._pillComponent.activePillId()},tabsElement:function(){return this._pillsElement},selectedTabElement:function(){return this._pillComponent.getActivePillElement()},replaceCurrentPanes:function(e,t){var n=t||{};
this._tabTotal=e.length,this._tabInfos={};
var r=[];
for(var i=0;
i<this._tabTotal;
i++){var s=e[i];
n[s.tabId]||r.push({label:s.title,id:s.tabId}),s.preRenderTab&&(this._shouldPreRenderTabs=!0),this._tabInfos[s.tabId]=new its.dv14.TabbedPane.TabInfo(s.callback,s.tabId,this._tabTotal,s.preRenderTab)}var o={pills:r,activeId:this._getInitialActiveTabId(),clickListener:this.handleTabClicked.bind(this),aliases:this.lookup("aliases"),manuallySelectPill:!0};
this._pillComponent=this.componentWithData("pills",o);
if(this._tabTotal>1||this.lookup("alwaysShowTabs"))this._pillsElement=this._pillComponent.render(),this._tabbedPaneElement.replaceTokenWithElement("pills",this._pillsElement)},showFirstPane:function(e){this._updateTabbedPane(this.lookup("panes")[0].tabId,!!e)},disableCallbacks:function(){this._disableCallbacks||(this._disableCallbacks=!0,this._updateTabbedPane(this.selectedTabId()),this._preRenderHiddenTabs())},enableCallbacks:function(){this._disableCallbacks&&(this._disableCallbacks=!1,this._updateTabbedPane(this.selectedTabId()),this._preRenderHiddenTabs())},_updateTabbedPane:function(e,t){this._pillComponent&&this._pillComponent.setActivePill(e);
if(this._suppliedContentRegion){this._suppliedContentRegion.removeAllChildNodes();
var n=this._disableCallbacks?document.createElement("placeholder"):this._tabInfos[e].paneContent(t||this._alwaysForceRefresh);
this._suppliedContentRegion.appendChild(n)}else{var n=this._disableCallbacks?document.createElement("placeholder"):this._tabInfos[e].paneContent(t||this._alwaysForceRefresh);
this._tabbedPaneElement.replaceTokenWithElement("tabbedPaneContent",n)}},_preRenderHiddenTabs:function(e){if(this._shouldPreRenderTabs&&!this._disableCallbacks)for(var t in this._tabInfos){if(!this._tabInfos.hasOwnProperty(t)||t==this.selectedTabId())continue;var n=this._tabInfos[t];
n.preRenderTab&&setTimeout(n.paneContent.bind(n,e),1)}},_getInitialActiveTabId:function(){if(!its.isDefinedNonNull(this._initialActiveTabId)){var e=this.lookup("activeTabId");
its.isDefinedNonNull(e)&&(this._initialActiveTabId=e),this._tabInfos[this._initialActiveTabId]||(this._initialActiveTabId=this.lookup("panes")[0].tabId)}return this._initialActiveTabId}}),its.dv14.TabbedPane.TabInfo=function(e,t,n,r){this.callback=e,this.tabId=t,this.preRenderTab=r,this.paneContent=function(e){if(!this._paneContentSection||e){this._paneContentSection=its.Templates.get("components/dv14_tabbed_pane/content").composeAsElement();
if(n>1){var r=/^\d+$/.test(t)?t+1:t;
this._paneContentSection.setAttribute("metrics-loc","Tab_"+r)}this.callback(t,this._paneContentSection)}return this._paneContentSection},this.clearPaneCache=function(){this._paneContentSection=null}},its.dv14.ThankYouPlacard=Class.createSubclass("its.dv14.ThankYouPlacard",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_thank_you_placard")},elementArtwork:function(){var e,t=this.data.artwork;
if(t){var n={effects:null,height:t.height,width:t.width,url:t.imgSrc},r={artworkUrls:[n],size:{width:100,height:100},alt:"Alt text for artwork"};
e=this.renderComponentWithData("artwork",r)}else e=document.createDocumentFragment();
return e},elementRedeemLink:function(){var e,t=this.data.redeemLink;
if(t){var n=its.Templates.get("components/dv14_thank_you_placard/redeem_link");
n.replaceObject("redeemLink",t),e=n.composeAsElement()}else e=document.createDocumentFragment();
return e},render:function(){var e=this.data;
if(!e||!its.sf.Platform.iPad())return document.createDocumentFragment();
try{var t=this._template;
return t.replaceToken("title",e.title),e.artwork&&t.replaceToken("url",e.artwork.url),t.replaceTokenWithElement("artwork",this.elementArtwork()),t.replaceTokenWithElement("redeemLink",this.elementRedeemLink()),this.renderExplanation(),this.renderLinks(),this._placardElement=t.composeAsElement(),this._placardElement}catch(n){return this._logger.error("Thank You Placard creation failed due to '"+n+"'\n"+"line:"+n.line+" column:"+n.column+"\nsourceURL:"+n.sourceURL+"\nstack:\n"+n.stack),document.createDocumentFragment()}},renderExplanation:function(){var e=this.data.explanation;
e||(e=[]);
var t=this._template.getBlock("explanationLoop");
for(var n=0;
n<e.length;
n++)t.replaceToken("explanation",e[n]),t.next()},renderLinks:function(){var e=this.data.links;
e||(e=[]);
var t=this._template.getBlock("linkLoop");
for(var n=0;
n<e.length;
n++)t.replaceObject("link",e[n]),t.next()}}),its.dv14.Track=Class.createSubclass("its.dv14.Track",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._data=this.lookup("trackData"),this._content=this._data.content,this._columns=this.lookup("columns"),this._workConfig=this._data.workConfig,this._isSelected=its.isDefinedNonNull(this.lookup("isSelected"))?this.lookup("isSelected"):!1,this._data.isSelected=this._isSelected,this._data.needsBadgeColumn=this.lookup("needsBadgeColumn")},templateName:function(){return"components/dv14_track"},componentType:function(){return"track"},renderAsString:function(){this.addClass("track"),this._isSelected&&this.setAttribute("selected",!0),this._data.disabled&&(this.setAttribute("disabled",!0),this.addClass("track-disabled"));
var e=this.template.getBlock("columnBlock");
for(var t=0;
t<this._columns.length;
t++){var n=its.dv14.TrackList.Column.renderColumnStringWithData(this._columns[t],this._data,this);
e.replaceTokenUnescaped("columnContent",n),e.next()}return this._markup=this.template.compose(this.itsId()),its.dv14.Util.Client.isPodcasts()&&this.subscribeToTarget(its.sf14.Events.SELECT,this._onTrackSelected.bind(this),this.itsId()),this.subscribeToTarget(its.sf14.Events.DISABLEDSELECT,this._onTrackDisableSelected.bind(this),this.itsId()),this._markup},_onTrackSelected:function(e){var t=its.dv14.PodcastTrackUtil.getTrack(this._content),n=this._content.offers[0].assets[0].flavor.toLowerCase(),r=n.indexOf("audio")===-1&&n.indexOf("video")===-1;
podcasts&&typeof podcasts.showEpisodeDetails=="function"?podcasts.showEpisodeDetails({items:[t]},function(e){console.log("podcast show episode details attempted "+e)}):r?openURL(this._content.offers[0].download.url):itms.playMedia({items:[t]},function(e){console.log("podcast playback attempted "+e)})},_onTrackDisableSelected:function(e){its.dv14.Util.Client.isPodcasts()&&podcasts.presentExplicitRestrictionAlertIfNeededOfType?podcasts.presentExplicitRestrictionAlertIfNeededOfType("onPlay",function(){}):itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onPlay",function(){})},onElementCreated:function(){this.element.__content=this._content,this.element.__disabled=this._data.disabled;
var e=its.dv14.Util.Client.isPodcasts()?"play":"preview";
its.sf.Metrics.setTargetInfo(this.element,this._data.content.id,e,its.sf.Metrics.ActionType.SELECT,this._content.url)}}),its.dv14.TrackList=Class.createSubclass("its.dv14.TrackList",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_track_list"),this._contentIds=this.lookup("contentIds"),this._columns=this.lookup("columns"),this._workConfig=this.lookup("workConfig"),this._suppressColumnHeaders=its.isDefinedNonNull(this.lookup("suppressColumnHeaders"))?this.lookup("suppressColumnHeaders"):!1,this._alwaysOverrideTrackNumbers=its.isDefinedNonNull(this.lookup("alwaysOverrideTrackNumbers"))?this.lookup("alwaysOverrideTrackNumbers"):!1,this._alwaysOverrideTrackNumbers?this._overrideTrackNumbers=its.dv14.TrackList.orderedTrackNumbers(this._contentIds):this._overrideTrackNumbers=this.lookup("overrideTrackNumbers"),this._displayTrackOrder=its.dv14.TrackList.orderedTrackNumbers(this._contentIds),this._profile=its.isDefinedNonNull(this.lookup("profile"))?this.lookup("profile"):its.sf.StorePlatform.Profiles.ITEM,this._artworkProfile=its.isDefinedNonNull(this.lookup("artworkProfile"))?this.lookup("artworkProfile"):null,this._needsBadgeColumn=its.isDefinedNonNull(this.lookup("needsBadgeColumn"))?this.lookup("needsBadgeColumn"):!1,this._useContainerExplicitRating=its.isDefinedNonNull(this.lookup("useContainerExplicitRating"))?this.lookup("useContainerExplicitRating"):!1,this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},render:function(){this._trackList=this._template.composeAsElement(),this._trackListElement=this._trackList.querySelector("trackList");
var e=this.storePlatform.getCachedDataMap(its.sf.StorePlatform.calculatedProfile(this._profile),this._contentIds);
return e.orderedKeys.length==this._contentIds.length?this._renderTrackTrackListContents(e):this._fetchTrackListContent(this._contentIds),this._trackList},_fetchTrackListContent:function(e){var t={profile:this._profile,artworkProfile:this._artworkProfile,ids:e,onOKHasAllContent:this._renderTrackTrackListContents.bind(this),suppressPersonalization:this.lookup("suppressPersonalization")};
this.storePlatform.fetchContent([t])},_renderTrackTrackListContents:function(e){its.dv14.Util.UI.shouldShowTrackListHeaders()&&!its.dv14.Util.Client.isPodcasts()&&!this._suppressColumnHeaders&&this._renderColumnsHeader(),this._workConfig?this._renderTracksForWorks(e):this._renderTracks(e);
if(this.selectedTrackData&&its.dv14.Util.Client.isPodcasts()){var t=its.dv14.PodcastTrackUtil.getTrack(this.selectedTrackData.trackData.content);
console.log(t),podcasts&&typeof podcasts.showEpisodeDetails=="function"&&podcasts.showEpisodeDetails({items:[t]},function(e){console.log("podcast show episode details attempted "+e)})}},_renderColumnsHeader:function(){var e=its.Templates.get("components/dv14_track_list/column_header"),t=e.getBlock("columnTitleLoop");
for(var n=0;
n<this._columns.length;
n++)t.replaceToken("columnTitle",this._columns[n].columnTitle()),t.next();
this._trackList.replaceTokenWithElement("columnHeader",e.composeAsElement())},_renderTracks:function(e){var t=[],n=this._allTracksHaveSameArtist(e),r=this._needsBadgeColumn,i=this.lookup("selectedTrackAdamId"),s=this.lookup("selectedTrackEpisodeGuid");
for(var o=0;
o<e.orderedKeys.length;
o++){var u=e[e.orderedKeys[o]];
u&&t.push(this._composeTrackForData(u,n,r,i,s))}var a=its.Templates.get("components/dv14_track_list/section");
a.replaceTokenUnescaped("tracks",t.join(" ")),this._trackListElement.appendChild(a.composeAsElement()),this._updateRestrictions();
if(its.dv14.Util.Client.isPodcasts()&&!this.selectedTrackData&&i&&podcasts.showEpisodeUnavailableDialog){var f=e[e.orderedKeys[0]],l=f.collectionName;
podcasts.showEpisodeUnavailableDialog(l,function(){console.log("Successfully showed unavailable dialog.")})}},_renderTracksForWorks:function(e){var t=this._idSetsForWorks(e),n=this._allTracksHaveSameArtist(e),r=this._needsBadgeColumn;
for(var i=0;
i<t.length;
i++){var s=t[i],o=[];
for(var u=0;
u<s.length;
u++){var a=e[s[u]];
a&&o.push(this._composeTrackForData(a,n,r))}if(o.length>0){var f=its.Templates.get("components/dv14_track_list/section");
f.replaceTokenUnescaped("tracks",o.join(" ")),this._trackListElement.appendChild(f.composeAsElement())}}this._updateRestrictions()},_composeTrackForData:function(e,t,n,r,i){var s;
if(e.kind==its.sf.StorePlatform.Kind.Work){var o=its.Templates.get("components/dv14_track_list/work_header");
o.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,e.name,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{maxLines:2}}));
if(!its.App.ParentalRequestData){var u=(new its.dv14.TrackList.Column.BuyButton).renderAsString(this.trackDataForContent(e,t),this);
o.replaceTokenUnescaped("buyButton",u)}s=o.compose()}else{var a=this.trackDataForContent(e,t),f=a.content.id,l=a.content.podcastEpisodeGuid,c=1e12,h=f>c?f-c:f+c,p=r==f||r==h||l&&l===i,d={trackData:a,columns:this._columns,isSelected:p,needsBadgeColumn:n};
s=this.renderComponentStringWithData("track",d),p&&(this.selectedTrackData=d)}return s},_idSetsForWorks:function(e){if(!this._idsByWorks){this._idsByWorks=[];
var t=[],n=!1;
for(var r=0;
r<this._contentIds.length;
r++){var i=this._contentIds[r],s=e[i];
if(s){var o=s.kind==its.sf.StorePlatform.Kind.Work||n&&!this._workConfig.works.childToWork[s.id];
o&&t.length>0&&(this._idsByWorks.push(t),t=[]),t.push(i),n=s.kind==its.sf.StorePlatform.Kind.Work||this._workConfig.works.childToWork[s.id]}}this._idsByWorks.push(t)}return this._idsByWorks},_allTracksHaveSameArtist:function(e){this.__allTracksHaveSameArtist=its.isDefinedNonNull(this.__allTracksHaveSameArtist)?this.__allTracksHaveSameArtist:!0;
if(e.orderedKeys.length>0){var t=e[e.orderedKeys[0]].artistName;
for(var n=0;
n<e.orderedKeys.length;
n++){this.__allTracksHaveSameArtist=t==e[e.orderedKeys[n]].artistName;
if(!this.__allTracksHaveSameArtist){this.__allTracksHaveSameArtist=!1;
break}}}return this.__allTracksHaveSameArtist},_updateRestrictions:function(){var e=this._trackList.querySelectorAll("track");
for(var t=0;
t<e.length;
t++){var n=e[t];
if(its.isDefined(n.__content)){var r=!its.sf.ParentalRatingUtil.doesPass(n.__content),i=r||n.__disabled;
i?n.setAttribute("disabled",!0):n.removeAttribute("disabled")}}},trackDataForContent:function(e,t){this._myTrackDataCache||(this._myTrackDataCache={});
var n=this._myTrackDataCache[e.id];
if(!n){n={};
var r=this.storePlatform.getCachedData(e.collectionId);
e.artwork||(e.artwork=r?r.artwork:null),n.content=e,n.allTracksHaveSameArtist=t,this._useContainerExplicitRating&&n.content&&r&&(r.contentRating&&(n.content.contentRating=r.contentRating),r.contentRatingsBySystem&&(n.content.contentRatingsBySystem=r.contentRatingsBySystem)),n.displayOrder=this._displayTrackOrder[e.id],e.pieceId&&this._workConfig&&this._workConfig.works&&this._workConfig.works[e.pieceId]&&(n.workConfig=this._workConfig);
var i=its.sf.StorePlatformUtil.hasAnyPreorderOffers(n.content.offers),s=its.sf.StorePlatformUtil.orderedOffers(n.content.offers)[0],o=its.sf.StorePlatformUtil.isVisibleButNotAvailable(s);
if(i&&o){var u=its.sf.StorePlatformUtil.bestPreview(n.content.offers);
u||(n.disabled=!0)}this._myTrackDataCache[e.id]=n}return this._overrideTrackNumbers&&(n.overrideTrackNumber=this._overrideTrackNumbers[e.id]),n},personalize:function(){return!1}}),its.dv14.TrackList.orderedTrackNumbers=function(e){var t={};
for(var n=0;
n<e.length;
n++)t[e[n]]=n+1;
return t},its.dv14.TrackList.Column=Class.create("its.dv14.TrackList.Column",{initialize:function(e){this._columnTitle=e},columnTitle:function(){return this._columnTitle?this._columnTitle:""},renderAsString:function(){this._logger.error(["---------- render: This method must be implemented by the extending classes"])}}),its.dv14.TrackList.Column.renderColumnStringWithData=function(e,t,n){var r=null;
return t&&(r=e.renderAsString(t,n)),r||(r=e.composeNoContentString()),r},its.dv14.TrackList.Column.Badge=Class.createSubclass("its.dv14.TrackList.Column.Badge",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n=null,r=its.sf.ContentRatingsManager.legacyContentRating(e.content),i=its.sf.StorePlatformUtil.ContentRating.isExplicit(r),s=its.dv14.BadgeUtil.createCleanOrExplicitBadge(r);
its.dv14.Util.Client.isPodcasts()&&!i&&(s=!1);
if(s){var o=its.Templates.get("components/dv14_track_list/column_badge");
o.replaceTokenUnescaped("badge",s),n=o.compose()}else e.needsBadgeColumn&&(n="<badge></badge>");
return n},composeNoContentString:function(){var e=its.Templates.get("components/dv14_track_list/column_badge");
return e.compose()}}),its.dv14.TrackList.Column.BuyButton=Class.createSubclass("its.dv14.TrackList.Column.BuyButton",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n=null,r=!1,i=its.sf.StorePlatformUtil.orderedOffers(e.content.offers)[0];
if(i){i.type==its.sf.StorePlatform.Offer.Type.COMPLETE&&this._logger.debug(["---------- Complete my album: ",JSON.stringify(i)]);
if(its.sf.StorePlatformUtil.isVisibleButNotAvailable(i)){var s=e.workConfig,o=e.content.pieceId;
if(o&&s){var u=s.works[o];
if(u){var a=its.sf.StorePlatformUtil.orderedOffers(u.offers)[0];
a&&its.isDefinedNonNull(a.price)&&(r=!0)}e.workConfig=s}}var f={offer:i,content:e.content,ignoreDisabled:!0};
r&&(f.overrideText=its.loc("MZStore.WorkOnly")),n=t.renderComponentStringWithData("buy_button",f)}return n},composeNoContentString:function(){return'<button type="buy"></button>'}}),its.dv14.TrackList.Column.RedownloadButton=Class.createSubclass("its.dv14.TrackList.Column.RedownloadButton",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n={orderedKeys:[e.content.id]};
n[e.content.id]=e.content;
var r={content:n};
return t.renderComponentStringWithData("redownload_button",r)},composeNoContentString:function(){return"<button></button>"}}),its.dv14.TrackList.Column.Duration=Class.createSubclass("its.dv14.TrackList.Column.Duration",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n=its.Templates.get("components/dv14_track_list/column_duration"),r=null,i=e.content.offers,s=null;
its.isDefinedNonNull(i)&&i.length>0&&(s=i[0].assets);
var o=s&&s[0]?s[0].duration:null;
return e.isSelected&&n.replaceToken("durationClass","button-color"),o&&(n.replaceToken("duration",o),r=n.compose()),r},composeNoContentString:function(){var e=its.Templates.get("components/dv14_track_list/column_duration");
return e.compose()}}),its.dv14.TrackList.Column.Ordinal=Class.createSubclass("its.dv14.TrackList.Column.Ordinal",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n=its.Templates.get("components/dv14_track_list/column_ordinal"),r=null,i=e.overrideTrackNumber,s=i||i===0?i:null;
s===null&&(s=e.content.trackNumber?e.content.trackNumber:"");
if(s){n.replaceToken("ordinal",s),e.disabled||n.replaceToken("classes","primary-color");
var o=its.sf.StorePlatformUtil.bestPreview(e.content.offers);
its.isDefinedNonNull(o)&&!its.dv14.Util.Client.isPodcasts()&&(n.keepBlock("previewBlock",!0),n.replaceToken("previewUrl",o.url),n.replaceToken("contentId",e.content.id)),r=n.compose()}return r},composeNoContentString:function(){var e=its.Templates.get("components/dv14_track_list/column_ordinal");
return e.compose()}}),its.dv14.TrackList.Column.Popularity=Class.createSubclass("its.dv14.TrackList.Column.Popularity",its.dv14.TrackList.Column,{initialize:function(e,t){this.base.apply(this,arguments),this._popularityMap=t||null},renderAsString:function(e,t){var n=its.Templates.get("components/dv14_track_list/column_popularity"),r=null;
if(e.content.kind!=its.sf.StorePlatform.Kind.Work&&e.content.kind!=its.sf.StorePlatform.Kind.Booklet){var i=this._popularity(e);
i&&(n.replaceToken("popularity",i),r=n.compose())}return r},_popularity:function(e){var t=e.content.popularity;
this._popularityMap&&this._popularityMap[e.content.id]!=undefined&&(t=this._popularityMap[e.content.id]);
if(t){var n=10;
t=Math.log(t*n+1)/Math.log(n+1)}return t},composeNoContentString:function(){var e=its.Templates.get("components/dv14_track_list/column_popularity");
return e.replaceToken("popularity",0),e.compose()}}),its.dv14.TrackList.Column.Title=Class.createSubclass("its.dv14.TrackList.Column.Title",its.dv14.TrackList.Column,{renderAsString:function(e,t){var n=its.Templates.get("components/dv14_track_list/column_title"),r=null,i=e.content.name?e.content.name:null;
if(i){if(e.workConfig&&e.workConfig.shouldShortenWorkTrackNames){var s=e.workConfig.works[e.content.pieceId],o=s.name;
its.string.startsWith(i,o,!0)&&(i=i.slice(o.length),its.string.startsWith(i,":")&&(i=its.string.trim(i.slice(1))))}n.replaceToken("title",i),e.allTracksHaveSameArtist?n.replaceToken("maxLines",2):n.replaceToken("maxLines",1),e.isSelected&&n.replaceToken("titleClass","key-color");
var u;
its.dv14.Util.Client.isPodcasts()?(u=e.content.description.standard||e.content.description.short,n.keepBlock("subTitleBlock",u),n.replaceToken("subtitleMaxLines",2)):(n.replaceToken("subtitleMaxLines",1),n.keepBlock("subTitleBlock",!e.allTracksHaveSameArtist),u=e.content.artistName?e.content.artistName:""),n.replaceToken("subTitle",u),r=n.compose()}return r},composeNoContentString:function(){var e=its.Templates.get("components/dv14_track_list/column_title");
return e.compose()}}),its.dv14.UpgradeDevice=Class.createSubclass("its.dv14.UpgradeDevice",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments);
var e=Class.shallowClone(its.sf.Metrics.bagMetricsBase()||{});
e.pageType="UpgradeSheet",e.pageId="iPhone",e.page="UpgradeSheet_iPhone",this.data={pageData:{metrics:{config:{},fields:{}},metricsBase:e}}},render:function(){var e=its.Templates.get("components/upgrade_device"),t=its.serverData.constants.resourceBaseUrl+"/images/upgrade-device/iphone-title."+Device.pixelRatio+"x.png",n=its.serverData.constants.resourceBaseUrl+"/images/upgrade-device/iphone-hero."+Device.pixelRatio+"x.png",r=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.iPhoneUpgrade.learnMore"),null,{"class":"upgrade-device-link",maxLines:2,"data-url":its.loc("DV14.iPhoneUpgrade.learnMoreUrl"),"data-page-target":"external"},this.dismissModal,!1);
its.sf.Metrics.setTargetInfo(r,its.dv14.UpgradeDevice.Metrics.LEARN_MORE,"button",its.sf.Metrics.ActionType.SELECT,null);
var i=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.iPhoneUpgrade.upgradeNow"),null,{"class":"upgrade-device-link",maxLines:2,"data-url":its.loc("DV14.iPhoneUpgrade.upgradeNowUrl"),"data-page-target":"external"},this.dismissModal,!1);
return its.sf.Metrics.setTargetInfo(r,its.dv14.UpgradeDevice.Metrics.UPGRADE_NOW,"button",its.sf.Metrics.ActionType.SELECT,null),e.replaceToken("titleSrc",t),e.replaceToken("heroSrc",n),e.replaceToken("subtitleText",its.loc("DV14.iPhoneUpgrade.subtitle")),e.replaceTokenUnescaped("learnMoreButton",r),e.replaceTokenUnescaped("upgradeButton",i),this._upgradeElement=e.composeAsElement(),this._upgradeElement.replaceTokenWithElement("navigationBar",this.navigationBar()),this.addDocumentStyles(this._upgradeElement),this._upgradeElement},navigationBar:function(){var e=its.Templates.get("components/upgrade_device/navigation_bar");
e.replaceToken("title",this.data.pageTitle);
var t=e.composeAsElement();
return this.cancelButton=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.iPhoneUpgrade.skip"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-right"},this.dismissModal,!0),its.sf.Metrics.setTargetInfo(this.cancelButton,its.dv14.UpgradeDevice.Metrics.CLOSE_SHEET,"button",its.sf.Metrics.ActionType.DISMISS,null),t.replaceTokenWithElement("cancelButton",this.cancelButton),t},dismissModal:function(){modal.popDocument()}}),its.dv14.UpgradeDevice.Metrics={LEARN_MORE:"learnMoreUpgradeDevice",UPGRADE_NOW:"upgradeNowUpgradeDevice",CLOSE_SHEET:"closeUpgradeDevice"},its.dv14.UpgradeDevice.launchUpgradeSheetIfApplicable=function(){if(its.dv14.UpgradeDevice.isUpgradeApplicable()){var e="1",t="upgradeDeviceLaunchCount",n=localStorage.getItem(t);
if(!n||n!==e){localStorage.setItem(t,e);
var r=its.sf14.BaseDocument.renderDocumentWithData("upgrade_device",null,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL)),i={type:"sheet"};
modal.pushDocument(r,i)}}},its.dv14.UpgradeDevice.setFeaturedLinkData=function(e){e.url=its.loc("DV14.iPhoneUpgrade.learnMoreUrl"),e.target=its.sf14.PageController.PageTarget.EXTERNAL},its.dv14.UpgradeDevice.isUpgradeUrl=function(e){return e==="itms://action/upgradeiphone"},its.dv14.UpgradeDevice.isUpgradeApplicable=function(){var e=!1,t=Device.productType,n=its.serverData.constants.countryCode,r=["iPhone4,1","iPhone5,1","iPhone5,2","iPhone5,3","iPhone5,4","iPhone6,1","iPhone6,2"],i=["usa","can","gbr","fra","deu","che","esp","ita","tur","are","rus","aus","chn","jpn","kor","sgp","mys","tha","ind","mex","bra","chl","col"];
return r.indexOf(t)>-1&&i.indexOf(n)>-1&&(e=!0),e},its.dv14.UserReviewsContainer=Class.createSubclass("its.dv14.UserReviewsContainer",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("components/dv14_user_reviews_container"),this._sortTypeId=its.dv14.UserReviewsContainer.SortType.HELPFUL,this._fetchedReviewsCache={},this._renderedReviewCount=0,this._totalReviewCount=this.data.numberOfReviews,this._wasRatingsReset=this.data.wasRatingsReset,this._personalizationType=its.dv14.UserReviewsContainer.PersonlizationType.UNDEFINED},render:function(){return this._template.replaceToken("highlight",this._supportsReviewActions()),this._reviewListElement=this._template.composeAsElement(),this.shouldPersonalizeReviews(function(e){this._fetchReviews(e)}.bind(this)),this._reviewListElement},shouldPersonalizeReviews:function(e){if(this._personalizationType!=its.dv14.UserReviewsContainer.PersonlizationType.UNDEFINED){e(this._personalizationType==its.dv14.UserReviewsContainer.PersonlizationType.PERSONALIZED);
return}var t=itms.getBag().personalizedUserReviewEnabled;
its.sf.Client.isVersion("10.3")&&t?itms.findOwnedItems([this.data.contentId],function(n){var r=n.indexOf(this.data.contentId)!=-1;
(r||this.data.shouldPromptAuth)&&t?(this._personalizationType=its.dv14.UserReviewsContainer.PersonlizationType.PERSONALIZED,e(!0)):(this._personalizationType=its.dv14.UserReviewsContainer.PersonlizationType.NOT_PERSONALIZED,e(!1))}.bind(this)):(this._personalizationType=its.dv14.UserReviewsContainer.PersonlizationType.NOT_PERSONALIZED,e(!1))},_fetchReviews:function(e){this._moreReviewsButton&&this._moreReviewsButton.setAttribute("disabled","true");
var t=function(){var t=!this._personalizedReviewFetched&&!!e,r=!this._reviewsPageFetched;
if(t||r)return;this._fetchedReviewsCache[n]=this._fetchedReviewsCache[n].concat(this._reviewsPageData.userReviewList.slice(0)),this._reviewsPageData.userReviewList.length<i&&(this._totalReviewCount=this._fetchedReviewsCache[n].length);
if(n==this._sortTypeId){this._renderedReviewCount==0&&(this._personalizedReview&&this._reviewsPageData.userReviewList.unshift(this._personalizedReview),its.notifications.publish(its.dv14.UserReviewsContainer.Events.USER_REVIEW_FETCHED,{review:this._personalizedReview,contentId:this.data.contentId}));
if(this._personalizedReview&&this._personalizedReview.userReviewId)for(var s=1;
s<this._reviewsPageData.userReviewList.length;
s++){var o=this._reviewsPageData.userReviewList[s];
if(o.userReviewId==this._personalizedReview.userReviewId){this._reviewsPageData.userReviewList.splice(s,1);
break}}this._renderReviews(this._reviewsPageData.userReviewList)}}.bind(this);
this._reviewsPageFetched=!1,this._totalReviewCount==0&&this._wasRatingsReset!==!0&&(this._reviewsPageFetched=!0,this._reviewsPageData={userReviewList:[]}),e&&this._fetchPersonalizedReview(t,this.data.shouldPromptAuth);
var n=this._sortTypeId;
this._fetchedReviewsCache[n]||(this._fetchedReviewsCache[n]=[]);
if(this._reviewsPageFetched)setTimeout(function(){t()},200);
else{var r=this._fetchedReviewsCache[n].length,i=15,s={id:this.data.contentId,"displayable-kind":this.data.kindId,startIndex:r,endIndex:r+i,sort:this._sortTypeId},o=its.url.appendUrlParameters(this.data.userReviewUrl,s);
its.sf14.Util.getJSON(o,function(e){this._reviewsPageFetched=!0,this._reviewsPageData=e,t()}.bind(this),this._fetchReviewsFailed.bind(this))}},_fetchPersonalizedReview:function(e,t){if(!this._personalizedReviewFetched){var n={id:this.data.contentId,"displayable-kind":this.data.kindId};
url=its.url.appendUrlParameters(itms.getBag().personalizedUserReviewUrl,n),its.sf14.Util.getJSON(url,function(t){t.userReview&&(this._personalizedReview=t.userReview),this._personalizedReviewFetched=!0,e()}.bind(this),function(n,r){t&&r.status==403?itms.authenticate({},function(){its.sf.Client.dsId()?this._fetchPersonalizedReview(e,!1):(this._personalizedReviewFetched=!0,e())}.bind(this)):(this._personalizedReviewFetched=!0,e())}.bind(this))}},_renderReviews:function(e){its.sf.Client.isVersion("10.3")?this._renderReviewsWithR2d2(e):this._renderReviewsLegacy(e);
if(this._totalReviewCount>this._renderedReviewCount){if(!this._moreReviewsButton){this._moreReviewsButton=its.sf14.ComponentUtil.createButton(this,its.loc("SF.MoreReviews"),null,{"class":"action-color"},function(){this.shouldPersonalizeReviews(function(e){this._fetchReviews(e)}.bind(this))}.bind(this),!0);
var t=its.Templates.get("utils/sf14_component/divider");
this._moreReviewsButtonDivider=t.composeAsElement()}else this._moreReviewsButton.setAttribute("disabled","false");
this._reviewListElement.parentNode.appendChild(this._moreReviewsButtonDivider),this._reviewListElement.parentNode.appendChild(this._moreReviewsButton)}else this._removeMoreReviewsButton()},_renderReviewsLegacy:function(e){var t=its.Templates.get("components/dv14_user_reviews_container/review_legacy"),n=document.createDocumentFragment();
for(var r=0;
r<e.length;
r++){var i=e[r];
t.replaceToken("title",i.title),t.replaceToken("value",i.rating),t.replaceToken("byLine",its.loc("DV14.UserReviews.ByLineLegacy",{name:i.name,date:its.locDate(i.date)}));
var s={description:i.body,maxLines:5};
t.replaceTokenWithElement("reviewText",this.renderComponentWithData("description",s)),n.appendChild(t.composeAsElement()),this._renderedReviewCount++}this._reviewListElement.appendChild(n)},_renderReviewsWithR2d2:function(e){var t=its.Templates.get("components/dv14_user_reviews_container/review"),n=document.createDocumentFragment();
e.forEach(function(e){t.replaceToken("title",e.title),t.replaceToken("value",e.rating),t.replaceToken("byLine",its.loc("DV14.UserReviews.ByLine",{name:e.name})),e.isEdited?its.secondsAgo(e.date)<3600?t.replaceToken("date",its.loc("DV14.TimeAgo.EditedJustNow")):t.replaceToken("date",its.loc("DV14.UserReviews.EditedTime",{time:its.locTimeAgo(e.date)})):t.replaceToken("date",its.locTimeAgo(e.date));
var r={description:e.body,maxLines:5};
t.replaceTokenWithElement("reviewText",this.renderComponentWithData("description",r));
var i=e.developerResponse;
if(i&&i.id>0){t.keepBlock("developerResponseBlock");
var s=t.getBlock("developerResponseBlock");
s.replaceToken("developerResponseTitle",its.loc("DV14.UserReviews.DeveloperResponseTitle")),s.replaceToken("developerResponseDate",its.locTimeAgo(i.modified));
var o=new Date(e.date),u=new Date(i.modified);
o>u&&(s.keepBlock("developerResponseEditedBlock"),s.replaceToken("developerResponseEdited",its.loc("DV14.UserReviews.DeveloperResponseEdited")));
var r={description:i.body,maxLines:3};
s.replaceTokenWithElement("developerResponseText",this.renderComponentWithData("description",r))}if(this._supportsReviewActions()){t.keepBlock("contextActionsBlock");
var a=t.getBlock("contextActionsLoop");
a.replaceTokenUnescaped("contextAction",its.sf14.ComponentUtil.createBadgeButton(this,its.loc("DV14.UserReviews.Helpful"),its.dv14.BadgeUtil.Badges.HELPFUL,null,function(){this._sendHelpfulnessRating(e,!0)}.bind(this))),a.next(),a.replaceTokenUnescaped("contextAction",its.sf14.ComponentUtil.createBadgeButton(this,its.loc("DV14.UserReviews.NotHelpful"),its.dv14.BadgeUtil.Badges.NOT_HELPFUL,null,function(){this._sendHelpfulnessRating(e,!1)}.bind(this))),a.next(),a.replaceTokenUnescaped("contextAction",its.sf14.ComponentUtil.createBadgeButton(this,its.loc("DV14.UserReviews.ReportAConcern"),its.dv14.BadgeUtil.Badges.REPORT_A_CONCERN,null,function(){var t=its.dv14.UserRatingsUtil.createReportAConcernDocument(e);
modal.pushDocument(t,{type:"sheet"})}.bind(this))),a.next()}n.appendChild(t.composeAsElement()),this._renderedReviewCount++}.bind(this)),this._reviewListElement.appendChild(n)},_supportsReviewActions:function(){return its.dv14.Util.Client.isAppStore()||its.dv14.Util.Client.isBridge()||its.dv14.Util.Client.isVoyager()},_removeMoreReviewsButton:function(){this._moreReviewsButton&&(this._moreReviewsButton.remove(),this._moreReviewsButton=null),this._moreReviewsButtonDivider&&(this._moreReviewsButtonDivider.remove(),this._moreReviewsButtonDivider=null)},_fetchReviewsFailed:function(){this._logger.debug(["---------- _fetchReviewsFailed: Failed to fetch user reviews"])},_sendHelpfulnessRating:function(e,t){its.sf14.Util.fetchServerPostResponse(e.voteUrl,{vote:t?1:0},null,null);
var n=t?its.dv14.BadgeUtil.getAssetData({name:"toast-helpful",localResourceName:"toast-helpful"}):its.dv14.BadgeUtil.getAssetData({name:"toast-not-helpful",localResourceName:"toast-not-helpful"}),r={type:"toast",resourceUrl:n.url,title:its.loc(t?"DV14.UserReviews.Toast.HelpfulTitle":"DV14.UserReviews.Toast.NotHelpfulTitle"),description:its.loc(t?"DV14.UserReviews.Toast.HelpfulDescription":"DV14.UserReviews.Toast.NotHelpfulDescription")},i=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",r,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:i,options:{type:"dialog"},pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},sortUserReviews:function(e){this._removeMoreReviewsButton(),this._reviewListElement.textContent="",this._sortTypeId=e;
var t=this._fetchedReviewsCache[this._sortTypeId];
this._renderedReviewCount=0,t?this._renderReviews(t):this.shouldPersonalizeReviews(function(e){this._fetchReviews(e)}.bind(this))}}),its.dv14.UserReviewsContainer.PersonlizationType={UNDEFINED:0,PERSONALIZED:1,NOT_PERSONALIZED:2},its.dv14.UserReviewsContainer.Events={USER_REVIEW_FETCHED:"its.dv14.UserReviewsContainer.USER_REVIEW_FETCHED"},its.dv14.UserReviewsContainer.SortType={HELPFUL:1,FAVORABLE:2,CRITICAL:3,RECENT:4},its.dv14.ProductPage=Class.createSubclass("its.dv14.ProductPage",its.sf14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this.data.isPurchasedModal=this.data.url.indexOf("isPurchasedModal=true")>-1,this.subscribeToSender(its.sf14.ProductPage.Events.COMPLETE_DATA_FETCHED,this._onCompleteDataFetched.bind(this),this),this._onRestrictionsChanged=function(){this.renderTabbedPane(!0)}.bind(this),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._onRestrictionsChanged,this.restrictionsChangeFilter.bind(this)),this.subscribe(its.sf14.Events.APP_PREVIEW_CHANGE,this._onAppPreviewStateChanged.bind(this)),this.subscribe(its.dv14.UserReviewsContainer.Events.USER_REVIEW_FETCHED,this._onUserReviewFetched.bind(this)),this._isPageComingDirectlyFromSearch()&&(this.data["its.dv14.BuyButton"]=Class.extend(this.data["its.dv14.BuyButton"],{isProductDirectlyFromSearch:!0}))},restrictionsChangeFilter:function(){return!0},_templateName:function(){return"pages/dv14_product_page"},_onAppPreviewStateChanged:function(){this._renderNavigationBar(!0)},onUnload:function(){this.base.apply(this,arguments),its.App.StoreSheetData=null,its.sf.Platform.iPad()&&its.notifications.publish(its.sf14.Events.FAKE_ON_APPEAR_TRIGGER),its.sf.Platform.iPad()&&!this._haveDisappeared&&(this._haveUnloaded=!0,this.onDisappear())},onDisappear:function(){this.base.apply(this,arguments),its.sf.Platform.iPad()&&!this._haveUnloaded&&!its.App.IsSuspended&&(this._haveDisappeared=!0,this.onUnload())},renderPageWithPartialData:function(e){this.loadingSpinner=its.sf14.ComponentUtil.createActivityIndicator(this,null,!1,!0),this.pageElement.replaceTokenWithElement("loadingSpinner",this.loadingSpinner),!its.App.StoreSheetData&&its.sf14.Util.shouldOpenProductInStoreSheet(this.product.kind)&&(its.App.StoreSheetData={url:this.product.url,showsStoreButton:!0,isImitationStoreSheet:!0});
if(!this._haveRenderedStyles||e){var t={kind:this.product.kind,name:this.product.name};
this.data.isPurchasedModal?t.isPurchasedModal=!0:(t.uber=this.product.uber,t.backgroundImagePinStyle=its.dv14.ProductPageUtil.PinStyle.RUBBERBAND),this.data.isEVOD&&(t.pinGroup="before-top"),this.addDocumentStyles(this.pageElement,t),this._haveRenderedStyles=!0}if(its.App.ParentalRequestData)this.renderComponentWithData("banner",{elementForBanner:this.pageElement,message:its.App.ParentalRequestData.prompt,typeOfBanner:"requestApproval"});
else if(its.dv14.Util.Client.isWinBackSupported(this.product)){var n=this.data&&this.data.pageData&&this.data.pageData.isAvailableForSubscription?!0:!1;
if(n){var r=this.data&&this.data.pageData&&this.data.pageData?!0:!1,i=this.data&&this.data.pageData&&this.data.pageData.hasPrimaryArtist?!0:!1;
this.renderComponentWithData("banner",{adamId:this.product.id,elementForBanner:this.pageElement,typeOfBanner:"appleMusicWinBack",isProductDataReady:r,isAvailableForSubscription:n,hasPrimaryArtist:i})}}var s=!this._pageContent||e;
this._renderPageContents(s)},renderPageWithCompleteData:function(){this._tabbedPane&&this._completeStorePlatformDataFetched&&this._tabbedPane.enableCallbacks()},_rerenderPageContents:function(){this._didSidePack=!1,this.renderPageWithPartialData(!0),this.renderPageWithCompleteData()},_renderPageContents:function(e){if(e){var t=this._shouldRenderInSplitMode()?its.Templates.get("pages/dv14_product_split_page_content"):its.Templates.get("pages/dv14_product_page_content");
this._pageContent=t.composeAsElement()}this._shouldRenderInSplitMode()?this._renderPageContentsForSplitView(e):this._renderDefaultPageContents(e)},_renderDefaultPageContents:function(e){this._renderNavigationBar(e),this._renderProductLockup(e),this.renderTabbedPane(e);
if(!this._didSidePack||e)this.pageElement.replaceTokenWithElement("content",this._pageContent),this._didSidePack=!0},_renderPageContentsForSplitView:function(e){this._bottomSection=document.createElement("section"),this._pageContent.replaceTokenWithElement("tabbedContent",this._bottomSection),this._rightSection=document.createElement("section"),this._pageContent.replaceTokenWithElement("rightContent",this._rightSection);
var t=this.panesToShow();
t.length>2&&(this._detailsPane=t[0],this._relatedPane=t.pop(),this._detailsCallback=this._detailsPane.callback,t[0].callback=this._renderDetailsPane.bind(this));
var n={panes:t,"its.dv14.Pills":{pinStyle:its.dv14.ProductPageUtil.PinStyle.ALONE,pillClass:"tabs"},contentRegion:this._bottomSection,activeTabId:this._currentTabId||t[0].tabId,disableCallbacks:!its.isDefinedNonNull(this.pageData)||!this._completeStorePlatformDataFetched,alwaysForceRefeshTabs:!0};
this._tabbedPane=this.componentWithData("tabbed_pane",n),this._tabbedPaneElement=this._tabbedPane.render(),this._renderExtendedNavigationBar(!0),this._renderProductLockup(!0),e&&this.pageElement.replaceTokenWithElement("content",this._pageContent)},_onCompleteDataFetched:function(e){if(this.product.id==e.id){var t={id:this.product.id,product:this.product,artworkUrls:this.product.artwork};
its.reflect.copyKeysAndValues(this.pageData,t),its.notifications.publish(its.dv14.ProductPage.Events.UPDATE_PRODUCT_DATA,t)}this.loadingSpinner&&this.loadingSpinner.setAttribute("style","visibility: hidden;")},_renderNavigationBar:function(e){if(!this._navigationBar||e){var t={navigationTitle:this.product.name,product:this.product,hasShareButton:!0};
this._navigationBar=this.renderComponentWithData("navigation_bar",t),this.pageElement.replaceTokenWithElement("navigationBar",this._navigationBar)}},_renderExtendedNavigationBar:function(e){if(!this._navigationBar||e){var t={product:this.product,hideGenreButton:!0,hasShareButton:!0,tabbedPaneElement:this._tabbedPaneElement};
this._navigationBar=this.renderComponentWithData("extended_navigation_bar",t),this.pageElement.replaceTokenWithElement("navigationBar",this._navigationBar)}},_renderRatingsAndReviewsTab:function(e,t){this._currentTabId=e;
if(this._shouldRenderInSplitMode()){var n=e===its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION?its.url.appendUrlParameter(this.pageData.customerReviewsUrl,"appVersion","current"):this.pageData.customerReviewsUrl,r=function(n){n&&this._renderSplitViewRatingsAndReviewsData(n,e,t)}.bind(this),i=function(){this._logger.error(["---------- _fetchRatingsAndReviewsData: Failed to fetch user reviews data for adamId: ",this.product.id])}.bind(this);
its.sf14.Util.getJSON(n,r,i)}else this._renderDefaultRatingsAndReviewsTab(e,t)},handleSplitViewTabClicked:function(e){this._renderRatingsAndReviewsTab(e,null)},_renderSplitViewRatingsAndReviewsData:function(e,t){var n=its.Templates.get("pages/dv14_product_page/split/ratings_and_reviews_bottom"),r=its.Templates.get("pages/dv14_product_page/split/ratings_and_reviews_right");
r.replaceTokenWithElement("facebook",its.sf14.ComponentUtil.createFacebookLarge(this,this.product.url,!0)),r.replaceToken("ratingsAndReviewsTitle",its.loc("K6.ProductPage.Pills.Reviews"));
var i=this.product.rottenTomatoesReviews;
i&&r.replaceTokenWithElement("rottenTomatoes",this._renderRottenTomatoesLink());
var s={starBreakdown:e.ratingCountList,avgRating:e.ratingAverage,content:this.product,showDivider:!1};
r.replaceTokenWithElement("starHistogram",this.renderComponentWithData("star_histogram",s));
var o=r.composeAsElement();
while(this._rightSection.childNodes.length>0)this._rightSection.firstChild.remove();
this._rightSection.appendChild(o);
if(its.dv14.ProductPageUtil.isVersionedKind(this.product.kind)){var u=[];
u.push({label:its.loc("SF.CurrentVersion"),id:its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION}),u.push({label:its.loc("SF.AllVersions"),id:its.dv14.ProductPageUtil.Tabs.ALL_VERSIONS});
var a={pills:u,activeId:t,clickListener:this.handleSplitViewTabClicked.bind(this),manuallySelectPill:!0};
n.replaceTokenWithElement("pills",this.renderComponentWithData("pills",a))}this._showWriteAReviewOverlay=function(){var t=its.url.appendUrlParameter(e.writeUserReviewUrl,"dataOnly","true"),n=e.adamId,r=its.dv14.UserRatingsUtil.createWriteAReviewDocument(t,n,this._reviewSubmitted.bind(this)),i=its.sf14.Util.ensureDocumentType(r);
modal.pushDocument(i,{type:"sheet"})}.bind(this);
var f=its.url.queryParamsDict(this._pageDataUrl),l=e.userReviewsRowUrl;
t==its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION&&(l=its.url.appendUrlParameter(l,"appVersion","current"));
var c={userReviewUrl:l,numberOfReviews:e.totalNumberOfReviews,contentId:this.product.id,kindId:e.kindId,shouldPromptAuth:f.action=="reviews"};
this._userReviewsComponent=this.componentWithData("user_reviews_container",c),this._userReviewsComponent.shouldPersonalizeReviews(function(e){if(!its.dv14.Util.UI.isTVOnlyApp(this.product)){n.keepBlock("WriteAReviewButtonBlock",!0);
if(!e){var t=n.getBlock("WriteAReviewButtonBlock"),r=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.WriteAReview"),its.sf14.ComponentUtil.ButtonType.DEFAULT,{"class":"write-review"},this._showWriteAReviewOverlay,!0);
itms.managedAppleID&&r.setAttribute("disabled","true"),t.replaceTokenWithElement("writeAReviewButton",r)}f.action=="write-review"&&this._showWriteAReviewOverlay()}if(this.product.softwareInfo&&this.product.softwareInfo.supportUrl){var i={"data-url":this.product.softwareInfo.supportUrl,"data-page-target":its.sf14.PageController.PageTarget.EXTERNAL,"class":"app-support"},s=its.sf14.ComponentUtil.createButton(this,its.loc("SF.AppSupport"),its.sf14.ComponentUtil.ButtonType.DEFAULT,i,null,!0);
n.keepBlock("SupportButtonBlock",!0);
var o=n.getBlock("SupportButtonBlock");
o.replaceTokenWithElement("supportButton",s)}n.replaceTokenWithElement("userReviews",this._userReviewsComponent.render());
while(this._bottomSection.childNodes.length>0)this._bottomSection.firstChild.remove();
this._reviewsContent=n.composeAsElement(),this._bottomSection.appendChild(this._reviewsContent)}.bind(this))},_renderDefaultRatingsAndReviewsTab:function(e,t){var n=its.Templates.get("pages/dv14_product_page/ratings_and_reviews_tab");
n.replaceTokenWithElement("facebook",its.sf14.ComponentUtil.createFacebookLarge(this,this.product.url,!0)),n.replaceToken("ratingsAndReviewsTitle",its.loc("K6.ProductPage.Pills.Reviews"));
var r=this.product.rottenTomatoesReviews;
this.pageData.isRottenTomatoesEnabled&&r&&n.replaceTokenWithElement("rottenTomatoes",this._renderRottenTomatoesLink());
var i=itms.getBag().enableUnifiedAppRating;
if(i){var s=document.createElement("section");
this._fetchRatingsAndReviewsData(this.pageData.customerReviewsUrl,s),n.replaceTokenWithElement("tabbedPane",s)}else{var o=[];
its.dv14.ProductPageUtil.isVersionedKind(this.product.kind)&&o.push({title:its.loc("SF.CurrentVersion"),callback:function(e,t){var n=its.url.appendUrlParameter(this.pageData.customerReviewsUrl,"appVersion","current");
this._fetchRatingsAndReviewsData(n,t,e)}.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION}),o.push({title:its.loc("SF.AllVersions"),callback:function(e,t){this._fetchRatingsAndReviewsData(this.pageData.customerReviewsUrl,t,e)}.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.ALL_VERSIONS});
var u={panes:o};
n.replaceTokenWithElement("tabbedPane",this.renderComponentWithData("tabbed_pane",u))}var a=n.composeAsElement();
t.appendChild(a)},_fetchRatingsAndReviewsData:function(e,t,n){var r=function(e){e&&this._renderRatingsAndReviewsData(e,t,n)}.bind(this),i=function(){this._logger.error(["---------- _fetchRatingsAndReviewsData: Failed to fetch user reviews data for adamId: ",this.product.id])}.bind(this);
its.sf14.Util.getJSON(e,r,i)},_renderRatingsAndReviewsData:function(e,t,n){var r=its.Templates.get("pages/dv14_product_page/ratings_and_reviews_pane_content"),i={starBreakdown:e.ratingCountList,avgRating:e.ratingAverage,content:this.product,showDivider:!1,wasReset:e.wasReset===!0};
r.replaceTokenWithElement("starHistogram",this.renderComponentWithData("star_histogram",i)),its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())&&r.keepBlock("iPadTapToRate",!its.dv14.Util.UI.isTVOnlyApp(this.product)),this._showWriteAReviewOverlay=function(){var t=its.url.appendUrlParameter(e.writeUserReviewUrl,"dataOnly","true"),n=e.adamId,r=its.dv14.UserRatingsUtil.createWriteAReviewDocument(t,n,this._reviewSubmitted.bind(this)),i=its.sf14.Util.ensureDocumentType(r);
modal.pushDocument(i,{type:"sheet"})}.bind(this);
var s=its.url.queryParamsDict(this._pageDataUrl),o=e.userReviewsRowUrl;
n==its.dv14.ProductPageUtil.Tabs.CURRENT_VERSION&&(o=its.url.appendUrlParameter(o,"appVersion","current"));
var u={userReviewUrl:o,numberOfReviews:e.totalNumberOfReviews,contentId:this.product.id,kindId:e.kindId,shouldPromptAuth:s.action=="reviews",wasRatingsReset:e.wasReset===!0};
this._userReviewsComponent=this.componentWithData("user_reviews_container",u),this._userReviewsComponent.shouldPersonalizeReviews(function(n){if(!its.dv14.Util.UI.isTVOnlyApp(this.product)){r.keepBlock("WriteAReviewButtonBlock",!0);
if(!n){var i=r.getBlock("WriteAReviewButtonBlock"),o=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.WriteAReview"),its.sf14.ComponentUtil.ButtonType.DEFAULT,{"class":"write-review"},this._showWriteAReviewOverlay,!0);
itms.managedAppleID&&o.setAttribute("disabled","true"),i.replaceTokenWithElement("writeAReviewButton",o)}s.action=="write-review"&&this._showWriteAReviewOverlay()}if(this.product.softwareInfo&&this.product.softwareInfo.supportUrl){var u={"data-url":this.product.softwareInfo.supportUrl,"data-page-target":its.sf14.PageController.PageTarget.EXTERNAL,"class":"app-support"},a=its.sf14.ComponentUtil.createButton(this,its.loc("SF.AppSupport"),its.sf14.ComponentUtil.ButtonType.DEFAULT,u,null,!0);
r.keepBlock("SupportButtonBlock",!0);
var f=r.getBlock("SupportButtonBlock");
f.replaceTokenWithElement("supportButton",a)}r.replaceTokenWithElement("userReviews",this._userReviewsComponent.render());
if(its.sf.Platform.iPad()){r.replaceTokenUnescaped("tapToRateText",its.sf14.ComponentUtil.createText(this,its.loc("DV6.Product.TapToRate"),{type:its.sf14.ComponentUtil.TextType.TITLE})),r.replaceTokenUnescaped("tapToRate",its.sf14.ComponentUtil.createStarRating(this,0,"large",function(e){var t=its.serverData.constants.tapToRateBaseUrl,n=its.sf14.Util.displayableKindForExternalId(this.product.kind),r={id:this.product.id,rating:e.value};
n&&(r["displayable-kind"]=n.id);
var i=its.url.appendUrlParameters(t,r);
its.sf14.Util.getJSON(i)}.bind(this)));
if(e.totalNumberOfReviews>0){r.keepBlock("iPadSort",!0),r.replaceToken("sortByText",its.loc("Sort by:"));
var l=[];
for(var c=0;
c<e.userReviewsSortOptions.length;
c++){var h=e.userReviewsSortOptions[c];
l.push({name:h.name,value:h.sortId})}var p=this.renderComponentStringWithData("select",{options:l,onSelectChanged:this._userReviewsComponent.sortUserReviews.bind(this._userReviewsComponent)});
r.replaceTokenUnescaped("sortSelect",p)}}this._reviewsContent=r.composeAsElement(),t.appendChild(this._reviewsContent)}.bind(this))},_onUserReviewFetched:function(e){var t=this.product.id==e.contentId&&e.review?its.loc("DV14.EditReview"):its.loc("DV14.WriteAReview"),n=its.sf14.ComponentUtil.createButton(this,t,its.sf14.ComponentUtil.ButtonType.DEFAULT,{"class":"write-review"},this._showWriteAReviewOverlay,!0);
itms.managedAppleID&&n.setAttribute("disabled","true"),this._shouldRenderInSplitMode()?this._reviewsContent.replaceTokenWithElement("pages/dv14_product_page/split/ratings_and_reviews_bottom.WriteAReviewButtonBlock.1.writeAReviewButton",n):this._reviewsContent.replaceTokenWithElement("pages/dv14_product_page/ratings_and_reviews_pane_content.WriteAReviewButtonBlock.1.writeAReviewButton",n)},_reviewSubmitted:function(e){var t=e.edited?e.edited:!1;
t&&this.renderTabbedPane(!0)},_renderProductLockup:function(e){if(!this._productLockupElement||e)this._productLockupElement=this.productLockup(),this._productLockupElement&&this._pageContent.replaceTokenWithElement("productLockup",this._productLockupElement)},_renderRottenTomatoesLink:function(){return its.sf.Platform.iPad()?this._renderRottenTomatoesLinkForIPad():this._renderRottenTomatoesLinkForIPhone()},_renderRottenTomatoesLinkForIPad:function(){var e=this.product.rottenTomatoesReviews,t=its.Templates.get("pages/dv14_product_page/rotten_tomatoes_ipad");
if(e){t.replaceToken("title",its.loc("DI6.RottenTomatoes.RottenTomatoes"));
var n=e.tomatometerPercentage,r=its.loc("SF.Percentage",{percentage:n});
t.replaceToken("percentage",r);
var i=its.dv14.RottenTomatoesUtil.rottenTomatoesBaseName(e.freshness);
if(i){var s=its.loc("SF.RottenTomatoes.Aria."+i,{percentage:n});
t.replaceToken("accessibilityText",s);
var o="resource://rottenTomatoes"+i+"Giant";
t.replaceToken("imgSrc",o)}t.replaceTokenUnescaped("statistics",its.dv14.RottenTomatoesUtil.statisticsMarkup(this.product.rottenTomatoesReviews,!1)),t.replaceToken("showCriticsReviews",its.loc("DV6.ShowCriticsReviews")),this._isReviewSectionExpanded=!1,this.subscribeToTarget(its.sf14.Events.SELECT,function(){this._isReviewSectionExpanded=!this._isReviewSectionExpanded,this.pageElement.querySelector("#rottenTomatoesExpand").setAttribute("open",this._isReviewSectionExpanded)}.bind(this),"expandRottenTomatoesReviewsButton");
var u={kind:this.product.kind,rottenTomatoesReviews:this.product.rottenTomatoesReviews};
t.replaceTokenUnescaped("reviews",this.renderComponentStringWithData("rotten_tomatoes_reviews",u))}return t.composeAsElement()},_renderRottenTomatoesLinkForIPhone:function(){var e=this.product.rottenTomatoesReviews,t=its.Templates.get("pages/dv14_product_page/rotten_tomatoes_iphone");
if(e){t.replaceToken("title",its.loc("DI6.RottenTomatoes.RottenTomatoes"));
var n=e.tomatometerPercentage,r=its.loc("SF.Percentage",{percentage:n});
t.replaceToken("percentage",r);
var i=its.dv14.RottenTomatoesUtil.rottenTomatoesBaseName(e.freshness);
if(i){var s=its.loc("SF.RottenTomatoes.Aria."+i,{percentage:n});
t.replaceToken("accessibilityText",s);
var o="resource://rottenTomatoes"+i+"Large";
t.replaceToken("imgSrc",o)}}var u=t.composeAsElement();
return this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:its.sf14.BaseDocument.renderDocumentWithData("rotten_tomatoes_page",{kind:this.product.kind,rottenTomatoesReviews:e},its.dv14.PageController.getDocumentSize())})}.bind(this),"rtLink"),u},productLockup:function(){this._logger.error(["---------- productLockup: Needs to be overridden in each specific product page and must return the product lockup element"])},renderTabbedPane:function(e){if(!this._tabbedPane||e){var t=this.panesToShow(),n={panes:t,"its.dv14.Pills":{pinStyle:its.dv14.Util.UI.shouldPinProductLockup()&&!its.dv14.Util.Client.isWinBackSupported(this.product)?its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND:its.dv14.ProductPageUtil.PinStyle.ALONE,showDivider:!0,pillClass:"product-page-pills"},activeTabId:this._currentTabId||t[0].tabId,disableCallbacks:!its.isDefinedNonNull(this.pageData)||!this._completeStorePlatformDataFetched};
this._isUserReviewsProductPage()&&(n.activeTabId=its.dv14.ProductPageUtil.Tabs.REVIEWS),this._tabbedPane=this.componentWithData("tabbed_pane",n),this._pageContent.replaceTokenWithElement("tabbedPane",this._tabbedPane.render())}},_renderDetailsPane:function(){this._currentTabId=this._detailsPane.tabId,this._detailsCallback(this._detailsPane.tabId,this._bottomSection,!0),this._renderRelatedPane()},_renderRelatedPane:function(){this._rightSection.removeAllChildNodes();
var e=this._relatedPane.callback;
e(this._relatedPane.tabId,this._rightSection,!0)},_shouldRenderInSplitMode:function(){return its.dv14.Util.UI.isLandscape()&&its.sf.Platform.isIPhone6PlusScreenSize()&&!its.dv14.Util.UI.isCompact(this.size())&&!this.data.isPurchasedModal&&!its.dv14.NotifyMeButton.isNotifyMeContent(this.contentId)},onOrientationChange:function(e){this.base(e),its.sf.Client.isVersion("10.0")||its.dv14.Util.UI.shouldToggleSplitView()&&this._rerenderPageContents()},onDocumentSizeChange:function(e){if(this.data.isPurchasedModal&&its.sf.Platform.isIPhone6PlusScreenSize())return;this.base(e),this._rerenderPageContents()},panesToShow:function(){this._logger.error(["---------- panesToShow: Needs to be overridden in each specific product page"])},_documentRestoreData:function(){var e=this.restoreData();
return e&&(e.stackId=its.sf.Platform.iPad()?its.sf14.PageController.PageTarget.MODAL:TabBar.selectedTab.identifier,e.url=this._documentUrl,e.isProductPage=!0,e.itsId=this.itsId()),e},_pageDataFetchFailure:function(e,t){this._logger.debug(["---------- _pageDataFetchFailure: Failed to fetch page data for ",this.contentId]);
var n=this.product?this.product.kind:null;
its.dv14.PlistUtil.handlePlist(t,e,this.documentUrl(),!0,n)},_isUserReviewsProductPage:function(){return this.documentUrl()&&this.documentUrl().indexOf("viewContentsUserReviews")>0},setMetricsData:function(e){return this._isPageComingDirectlyFromSearch()&&its.dv14.Util.UI.addSearchTermToPageInfo(e),e},_isPageComingDirectlyFromSearch:function(){var e=its.dv14.SearchPage.findCurrentSearchTab();
if(!e||TabBar.selectedTab!=e)return!1;
var t=!1,n=e.navigationDocument;
return e.identifier==its.sf14.PageController.PageTarget.SEARCH&&(n.documents.length==1||n.documents.length>1&&n.documents.indexOf(this._document)==1)?t=!0:e.identifier==its.sf14.PageController.PageTarget.TRANSIENT&&(modal.documents.length==0||modal.documents.length>0&&modal.documents.indexOf(this._document)==0)&&(t=!0),t}}),its.dv14.AlbumPage=Class.createSubclass("its.dv14.AlbumPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this._variantPageData=null,this._productVariant=null},productLockup:function(){this._logger.debug(["---------- renderProductLockup: "]);
var e=null,t=!0;
this.pageData&&(this.pageData.radioSwoosh&&(e=this.pageData.radioSwoosh),t=this.pageData.hasPrimaryArtist);
var n={content:this.product,radioPromo:e,hasPrimaryArtist:t},r=this.isToneAlbum()?"tone_album_product_lockup":"album_product_lockup";
return this.renderComponentWithData(r,n)},isToneAlbum:function(){switch(this.product.kind){case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.ToneAlbum:return!0}return this.product.childrenIds&&this.product.childrenIds.length>0&&this.product.children[this.product.childrenIds[0]]&&this.product.children[this.product.childrenIds[0]].kind==its.sf.StorePlatform.Kind.Tone?!0:!1},_onCompleteDataFetched:function(e){this.product.id==e.id&&(this.base(e),e.radioPromo=this.pageData.radioSwoosh?this.pageData.radioSwoosh[0]:null,e.hasPrimaryArtist=this.pageData.hasPrimaryArtist,this.pageData&&!its.isDefined(this.product.preorderData)&&(this.product.preorderData=this.pageData.preorderData),this.product.isExplicit&&itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onContainerLoad",function(){}))},panesToShow:function(){var e=[],t=function(e,t){this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.ITEM,ids:this.product.childrenIds,onOK:function(){this._renderSongsTab(e,t)}.bind(this),suppressPersonalization:!0}])}.bind(this);
return e.push({title:its.loc("DV14.ProductPage.Tab.Songs"),callback:t,tabId:its.dv14.ProductPageUtil.Tabs.SONGS,preRenderTab:!0}),its.sf.Platform.iPad()&&this.product.mediaArchiveAdamId&&e.push({title:its.loc("DV14.ProductPage.Tab.ITunesLP"),callback:function(e,t){t.appendChild(this._renderBonusContent())}.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.ITUNES_LP}),e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),e},_renderSongsTab:function(e,t){var n=its.Templates.get("pages/dv14_album_page/songs_tab");
if(this.pageData.preorderData&&this.pageData.preorderData.disclaimer){var r={description:this.pageData.preorderData.disclaimer,maxLines:3};
n.replaceTokenWithElement("preorderDisclaimer",this.renderComponentWithData("description",r))}var i=this.product.itunesNotes?this.product.itunesNotes.standard:null,s=null,o=this.product.isMasteredForItunes?!1:its.sf.Platform.iPhone()&&!its.dv14.Util.UI.shouldShowTrackListHeaders();
if(i){var u={title:its.loc("iTunesNotes"),description:i,dontEscape:!0,maxLines:3,showDivider:o};
n.replaceTokenWithElement("notes",this.renderComponentWithData("description",u))}var a=this.product.description;
if(a&&a.standard){var f=a.standard,l=a.title;
if(f&&l){var c={title:l,description:f,dontEscape:!0,maxLines:3};
n.replaceTokenWithElement("description",this.renderComponentWithData("description",c))}}if(this.product.isMasteredForItunes&&its.sf.Platform.iPhone()){n.keepBlock("masteredForITunesBlock");
var h=n.getBlock("masteredForITunesBlock");
h.replaceTokenWithElement("masteredForITunesBadge",its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.APPLE_DIGITAL_MASTER_STACKED,!0))}this._workData=this.pageData.works,this._workData&&(this.storePlatform.cacheStorePlatformDataForProfile(its.sf.StorePlatform.Profiles.ITEM,this._workData),this._workData.childToWork={});
var p=[];
p.push(new its.dv14.TrackList.Column.Ordinal),p.push(new its.dv14.TrackList.Column.Title(its.loc("DV14.TrackList.Column.Name"))),p.push(new its.dv14.TrackList.Column.Badge),p.push(new its.dv14.TrackList.Column.Duration(its.loc("DV14.TrackList.Column.Duration")));
if(its.dv14.Util.UI.shouldShowPopularity()){var d=this.pageData.popularityMap?this.pageData.popularityMap.song:{};
p.push(new its.dv14.TrackList.Column.Popularity(its.loc("DV14.TrackList.Column.Popularity"),d))}its.App.ParentalRequestData||p.push(new its.dv14.TrackList.Column.BuyButton(its.loc("DV14.TrackList.Column.Price")));
var v=its.sf.ContentRatingsManager.legacyContentRating(this.product),m=its.sf.StorePlatformUtil.ContentRating.isClean(v),g=its.sf.StorePlatformUtil.ContentRating.isExplicit(v),y={contentIds:this._idsForTracklistIncludingWorks(),columns:p,selectedTrackAdamId:its.url.queryParamValue("i",this.documentUrl()),suppressPersonalization:!0,needsBadgeColumn:!0};
this._workData&&(y.workConfig={works:this._workData,shouldShortenWorkTrackNames:this.pageData.isClassicalOrOpera});
var b=this.renderComponentWithData("track_list",y);
n.replaceTokenWithElement("trackList",b),its.sf.Platform.iPhone()&&this.product.mediaArchiveAdamId&&n.replaceTokenWithElement("bonusContent",this._renderBonusContent()),this.product.copyright&&n.replaceToken("copyright",this.product.copyright),m&&(this.product.explicitVariantUrl=v.riaaVariantUrl),g&&(this.product.cleanVariantUrl=v.riaaVariantUrl);
if(m&&this.product.explicitVariantUrl||g&&this.product.cleanVariantUrl){var w=n.getBlock("hasVariant"),E=m?its.loc("DV14.AlbumPage.ShowExplicitVersion"):its.loc("DV14.AlbumPage.ShowCleanVersion"),S=m?this.product.explicitVariantUrl:this.product.cleanVariantUrl;
w.replaceTokenWithElement("variantButton",its.sf14.ComponentUtil.createButton(this,E,null,null,function(){this._fetchAndRenderAlbumVariant(S)}.bind(this),!0)),w.next()}var x=n.composeAsElement();
t.appendChild(x)},_idsForTracklistIncludingWorks:function(){var e=this.product.childrenIds;
this._idsForTracklist=[];
var t={};
for(var n=0;
n<e.length;
n++){var r=e[n];
if(this.pageData.availableChildren[r]){var i=this.product.children[r];
if(i){var s=i.pieceId;
s&&this._workData&&(this._workData[s]&&!t[s]&&(this._idsForTracklist.push(s),t[s]=!0),this._workData.childToWork[r]=s)}this._idsForTracklist.push(r)}}return this._idsForTracklist},_renderBonusContent:function(){var e=this.pageData?this.pageData.mediaArchive:null,t=its.Templates.get("pages/dv14_album_page/bonus_content");
t.replaceToken("title",its.loc("DV14.ProductPage.BonusContent")),t.replaceToken("aboutBonusContent",its.loc("DV14.AlbumPage.BonusContentExplanation"));
var n=its.dv14.BadgeUtil.getAssetData(its.dv14.BadgeUtil.Badges.BONUS_CONTENT);
t.replaceToken("glyph",n.url),t.replaceToken("width",n.width),t.replaceToken("height",n.height),t.replaceToken("bonusText",its.loc("DV14.AlbumPage.ITunesLP.AvailableMacPC")),e.description&&t.replaceTokenUnescaped("bonusContentDescription",e.description);
if(e.previewArtworks){var r=[];
for(var i=0;
i<e.previewArtworks.length;
i++){var s=e.previewArtworks[i];
r.push({artworkData:{artworkUrls:[s],size:its.dv14.LockupUtil.getArtworkDimensions("mediaArchive",null,this.size()),alt:its.loc("DV14.ProductPage.ITunesExtras.PreviewArtwork",{index:i+1})},fullscreenArtworkData:{artworkUrls:[s],size:its.dv14.LockupUtil.getArtworkDimensions("fullscreen",null,this.size()),alt:its.loc("DV14.ProductPage.ITunesExtras.PreviewArtwork",{index:i+1})},type:its.dv14.Gallery.Type.IMAGE})}var o={items:r};
t.replaceTokenWithElement("gallery",this.renderComponentWithData("gallery",o))}return t.composeAsElement()},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_album_page/related_tab"),i=n?"grid":"swoosh",s=function(){if(this.pageData.topAlbumsByArtist&&this.pageData.topAlbumsByArtist.length>0){var e=n?3:null,s={title:its.loc("DV14.AlbumPage.TopAlbumsByArtist",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.topAlbumsByArtist,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("topAlbumsByArtist",this.renderComponentWithData(i,s))}if(this.pageData.topSongsByArtist&&this.pageData.topSongsByArtist.length>0){var e=n?3:null,o={title:its.loc("DV14.AlbumPage.TopSongsByArtist",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.topSongsByArtist,e),type:its.dv14.Swoosh.Type.LIST,suppressPersonalization:!0,"its.dv14.SmallLockup":{titleMaxLines:1,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.CHARTS},scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.List,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("topSongsByArtist",this.renderComponentWithData(i,o))}if(this.pageData.listenersAlsoBoughtAlbums&&this.pageData.listenersAlsoBoughtAlbums.length>0){var e=n?3:null,u={title:its.loc("DV14.listenersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.listenersAlsoBoughtAlbums,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("listenersAlsoBoughtAlbums",this.renderComponentWithData(i,u))}if(this.pageData.listenersAlsoBoughtSongs&&this.pageData.listenersAlsoBoughtSongs.length>0){var e=n?3:null,a={title:its.loc("DV14.listenersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.listenersAlsoBoughtSongs,e),type:its.dv14.Swoosh.Type.LIST,suppressPersonalization:!0,"its.dv14.SmallLockup":{titleMaxLines:1,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.CHARTS},scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.List,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("listenersAlsoBoughtSongs",this.renderComponentWithData(i,a))}if(this.pageData.moreInGenre&&this.pageData.moreInGenre.length>0){var e=n?3:null,f=this.product.genres[0],l=f?f.name:null,c={title:its.loc("DV14.AlbumPage.TopAlbumsInGenre",{genre:l}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreInGenre,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreInGenre",this.renderComponentWithData(i,c))}t.appendChild(r.composeAsElement());
if(t.lastElementChild){var h=t.lastElementChild.getElementsByTagName("divider").item(0);
h&&h.remove()}}.bind(this),o=[];
this.pageData.topAlbumsByArtist&&(o=o.concat(this.pageData.topAlbumsByArtist)),this.pageData.topSongsByArtist&&(o=o.concat(this.pageData.topSongsByArtist)),this.pageData.listenersAlsoBoughtAlbums&&(o=o.concat(this.pageData.listenersAlsoBoughtAlbums)),this.pageData.listenersAlsoBoughtSongs&&(o=o.concat(this.pageData.listenersAlsoBoughtSongs)),this.pageData.moreInGenre&&(o=o.concat(this.pageData.moreInGenre));
var u={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:o,onOKHasAllContent:s,onOKMissingContent:s,suppressPersonalization:!0};
this.storePlatform.fetchContent(u)},_fetchAndRenderAlbumVariant:function(e){var t=function(e){e.pageData&&(this._variantPageData=e.pageData),e.storePlatformData&&this.storePlatform.cacheStorePlatformDataForProfiles(e.storePlatformData);
var t={profile:this.productProfile(),artworkProfile:this.artworkProfile(),ids:[this._variantPageData.id],onOKHasAllContent:function(e){this._productVariant=e[this._variantPageData.id],this._renderVariant()}.bind(this),onError:this._completeStorePlatformDataFetchFailure.bind(this)};
this.storePlatform.fetchContent([t])}.bind(this),n=function(){this._logger.debug(["---------- _fetchAndRenderAlbumVariant: Could not fetch album variant"])}.bind(this);
this._variantPageData&&this._productVariant?this._renderVariant():its.sf14.Util.getJSON(e,t,n)},_renderVariant:function(){var e=this.product,t=this.pageData;
this.product=this._productVariant,this.pageData=this._variantPageData,this._productVariant=e,this._variantPageData=t,this.renderPageWithPartialData(!0),this.renderPageWithCompleteData(!0)}}),its.dv14.AppExplorePage=Class.createSubclass("its.dv14.AppExplorePage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.AppExplorePage"),this.loadingSpinner=its.sf14.ComponentUtil.createActivityIndicator(this,its.sf14.Util.UI.loadingText(),!1,!0),this._pageDataCache={},this._browseCategories=[],this._browseGridCache={},this._baseUrl=this.pageData().baseUrl,this.processPageData(this.pageData())},restoreData:function(){return{title:its.loc("DV14.AppExplore.Browse")}},pageData:function(){return this.lookup("pageData")},processPageData:function(e){this._pageDataCache[e.id]=e.data;
if(e.childrenData)for(var t=0;
t<e.childrenData.length;
++t){var n=e.childrenData[t],r=this._pageDataCache[n.id];
if(r==null||r.isChild)this._pageDataCache[n.id]=n}},rootPageData:function(){return this._pageDataCache["dg.36"]},render:function(){return this._pageElement=this.renderPage(),this._pageElement},renderPage:function(){this._currentlyRendering=its.dv14.AppExplorePage.CurrentlyRenderingKeys.INITIAL_PAGE_LOAD;
var e=its.Templates.get("pages/dv14_app_explore_page");
e.replaceTokenWithElement("navigation",this.renderComponentWithData("extended_navigation_bar",{title:its.loc("DV14.AppExplore.Browse"),hideGenreButton:!0})),e.replaceTokenWithElement("content",this._isSplit()?this.renderSplitContent():this.renderUnifiedContent());
var t=e.composeAsElement();
this._exploreElement=t.querySelector("exploreTemplate"),this.addDocumentStyles(t,{}),this._head=t.querySelector("head"),this._originalStyle=this._head.querySelector("style"),this._nearByAppsElement=t.querySelector("nearByApps"),this._nearByAppsElement&&this._nearByAppsElement.addEventListener("dataavailable",this._handleNearByApps.bind(this));
if(this._browseCategories.length>0){this._isSplit()&&(this._rightSplitElement.children.length!=0&&this._rightSplitElement.removeAllChildNodes(),this._currentlyRendering=this._browseCategories[this._browseCategories.length-1]+its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR);
var n=this._isSplit()?this._leftSplitElement:this._exploreElement,r,i,s;
for(var o=0;
o<this._browseCategories.length;
++o){i=this._browseCategories[o],s=this._pageDataCache[i];
var u=this._isSplit()&&o==this._browseCategories.length-1;
if(u&&!s.categoriesData){if(r){var a=r.querySelector('item[selected="true"]');
a.setAttribute("selected","false");
var f=r.querySelector('item[data-category-id="'+i+'"]');
f.setAttribute("selected","true")}}else r=this.renderBrowse(s),n.appendChild(r);
u&&this._renderGrid(s)}}return t},renderSplitContent:function(){this._logger.info("Rendering split content");
var e=its.Templates.get("pages/dv14_app_explore_page/split"),t=e.composeAsElement();
return this._leftSplitElement=t.querySelector("#leftSplit"),this._rightSplitElement=t.querySelector("#rightSplit"),t.replaceTokenWithElement("browse",this.renderBrowse(this._pageDataCache["dg.36"])),itms.accountInfo.managedAppleId||t.replaceTokenWithElement("nearMeHidden",this._nearByAppsShelf?this._nearByAppsElement:this.swooshHiddenTemplate(its.loc("DV14.AppExplore.PopularNearMe"),90,!0,!0)),this._renderGrid(this._pageDataCache["dg.36"]),t},renderUnifiedContent:function(){return this._logger.info("Rendering unified content"),this.renderBrowse(this._pageDataCache["dg.36"])},swooshHiddenTemplate:function(e,t,n,r){var i=its.Templates.get("pages/dv14_app_explore_page/swoosh_hidden");
return r&&i.keepBlock("nearByAppsBlock"),n&&i.keepBlock("dividerBlock"),i.replaceToken("title",e),i.replaceToken("imgSize",t),i.composeAsElement()},_isSplit:function(){var e=its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()&&its.serverData.properties["DV14.AppExplore.enableRotation"];
return e},_isRootGenre:function(e){return e=="dg.36"},renderBrowse:function(e){var t=its.Templates.get("pages/dv14_app_explore_page/browse"),n=this._isRootGenre(e.id);
e.id&&t.replaceToken("id",e.id);
var r="";
e.title&&(r=n?its.loc("DV14.AppExplore.All"):e.title,t.replaceToken("title",r));
if(n){t.keepBlock("rootBlock",!0);
var i=t.getBlock("rootBlock");
i.replaceToken("categoriesLabel",its.loc("DV14.AppExplore.Categories"));
if(this._isSplit()){var s=its.Templates.get("pages/dv14_app_explore_page/collections_item");
s.replaceToken("collectionsLabel",its.loc("DV14.AppExplore.Collections")),i.replaceTokenWithElement("topElement",s.composeAsElement())}else{var o=this._renderCarouselElement();
o&&i.replaceTokenWithElement("topElement",o);
if(its.dv14.Util.Client.isBridge()&&its.property("DV14.Gizmo.showWatchVideoShelfInExplore")){t.keepBlock("watchVideoBlock",!0);
var u=this._nearByAppsShelf?!0:!1;
this.renderWatchVideoShelf(u)}itms.accountInfo.managedAppleId||i.replaceTokenWithElement("nearMeHidden",this._nearByAppsShelf?this._nearByAppsElement:this.swooshHiddenTemplate(its.loc("DV14.AppExplore.PopularNearMe"),80,!1,!0))}}var a=e.categoriesData;
if(a&&a.items||e.groupingUrl){var f=t.getBlock("itemLoop");
if(!n){this._isSplit()?this._addItemToLoop(its.loc("DV14.AppExplore.MostPopular"),null,e.id,e.id,null,"true","false",!1,f):e.contentIds?t.replaceTokenWithElement("shelf",this.renderSwooshElement(e)):e.isChild&&t.replaceTokenWithElement("shelf",this.swooshHiddenTemplate(its.loc("DV14.AppExplore.MostPopular"),80,!1,!1)),e.groupingUrl&&this._addItemToLoop(its.loc("DV14.AppExplore.FeaturedGenre",{genreName:e.title}),null,null,e.id,e.groupingUrl,"false","false",!1,f);
if(e.featuredContent&&e.featuredContent.items&&e.featuredContent.items.length>0)for(var l=0;
l<e.featuredContent.items.length;
++l){var c=e.featuredContent.items[l];
this._addItemToLoop(c.link.label,null,null,e.id,c.link.url,"false","false",!1,f)}}if(a&&a.items)for(var l=0;
l<a.items.length;
l++){var h=a.items[l],p=this._isSplit()?h.hasChildren?"true":"false":"true",d=this._isSplit()?h.hasChildren:!0;
this._addItemToLoop(h.title,n?null:h.count,h.id,e.id,null,"false",p,d,f)}}else if(!this._isSplit()){t.keepBlock("itemLoop",!1);
var v=t.composeAsElement();
its.sf.Metrics.setTargetInfo(v,e.id,"listItem",its.sf.Metrics.ActionType.SELECT,null,{name:r});
var m={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,ids:e.contentIds.length>this._maxNumberOfLockups()?e.contentIds.slice(0,this._maxNumberOfLockups()):e.contentIds,onOKHasAllContent:function(e){this._renderLeafLevelBrowse(v,e)}.bind(this),onOKMissingContent:function(e){this._renderLeafLevelBrowse(v,e)}.bind(this),suppressPersonalization:this.lookup("suppressPersonalization")};
return this.storePlatform.fetchContent(m),v}return this.browseElement=t.composeAsElement(),its.sf.Metrics.setTargetInfo(this.browseElement,e.id,"listItem",its.sf.Metrics.ActionType.SELECT,null,{name:r}),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleBrowseElementSelected.bind(this),this.browseElement.itsId()),this.browseElement},renderWatchVideoShelf:function(e){var t=its.serverData.constants.countryCode.toUpperCase(),n=its.Templates.get("pages/dv14_app_explore_page/video_shelf");
n.replaceToken("videoShelfTitle",its.loc("DV14.AppExplore.AppleWatchFilms")),e&&n.keepBlock("videosDivider",!0),its.sf14.Util.fetchServerGetResponse(its.serverData.constants.resourceBaseUrl+"/images/watch/videoFeed_"+t+".json",function(e){var t=e.responseText?JSON.parse(e.responseText):null;
if(t){var r=n.getBlock("videoLoop");
for(i=0,len=t.videos.length;
i<len;
i++)r.replaceToken("posterArtUrl",t.videos[i].posterImage),r.replaceToken("videoUrl",t.videos[i].url),r.replaceToken("title",t.videos[i].title),r.next();
var s=this.browseElement.querySelector(".watch-videos");
s.parentNode.replaceChild(n.composeAsElement(),s)}else this._logger.error("error")}.bind(this),function(e){this._logger.error(["No data at url:",url])}.bind(this))},renderSwooshElement:function(e){var t=its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]?its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]:16,n=e.contentIds.length>t?e.contentIds.slice(0,t):e.contentIds,r=e.contentIds.length>this._maxNumberOfLockups()?e.contentIds.slice(0,this._maxNumberOfLockups()):e.contentIds,i={},s=this.storePlatform.getCachedDataByProfiles(r);
return i.title=its.loc("DV14.AppExplore.MostPopular"),i.link={label:its.loc("See All"),callback:function(){var t={pageData:{pageTitle:its.loc("DV14.AppExplore.MostPopular"),defaultSort:0,sorts:[],adamIds:r,refUrl:this._documentUrl,metricsBase:its.sf14.Util.createMetricsBaseObject(e.metricsBase,"Most Popular","room")},"its.dv14.ColumnList":{scrollableCellController:its.dv14.AppExplorePage.ListScrollableCellController},storePlatformData:s},n=its.sf14.BaseDocument.renderDocumentWithData("room_page",t,its.dv14.PageController.getDocumentSize());
its.dv14.PageController.pushDocument(n,{},!1)}.bind(this)},i.showDivider=!1,i.contentIds=n,i["its.dv14.SmallLockup"]={detailsGenerator:its.dv14.LockupUtil.BrowsePageSwooshSoftwareLockupDetailsGenerator,titleMaxLines:2},this.renderComponentWithData("swoosh",i)},_addItemToLoop:function(e,t,n,r,i,s,o,u,a){var f=its.Templates.get("pages/dv14_app_explore_page/item");
f.replaceToken("title",e),n&&f.replaceToken("id",n),r&&f.replaceToken("parentId",r),i&&f.replaceToken("fcUrl",i),s&&f.replaceToken("isSelected",s),o&&f.replaceToken("doesExpand",o),u&&f.keepBlock("downChevron");
var l=f.composeAsElement(),c=i?i:this._getUrlForSelectedCategory(n);
its.sf.Metrics.setTargetInfo(l,n,"listItem",its.sf.Metrics.ActionType.SELECT,c,{name:e}),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleBrowseElementSelected.bind(this),l.itsId()),a.replaceTokenWithElement("item",l),a.next()},_renderRightSplit:function(e,t,n,r){var i=e+t;
this._logger.info("_renderRightSplit: Trying to render: "+i),this._logger.info("_renderRightSplit: Will render if same as: "+this._currentlyRendering);
if(this._currentlyRendering==i){if(!n){var n=this.renderComponentWithData("grid",r);
n.setAttribute("class","no-borders-grid")}this._browseGridCache[e]=n,this._logger.info("Rendering "+i),this._rightSplitElement.removeAllChildNodes(),this._rightSplitElement.appendChild(n),this._currentlyRendering=null}},_renderGrid:function(e){if(e.id=="dg.36"){var t=this.rootPageData().featuredContent;
if(t&&t.items){var n=its.Templates.get("pages/dv14_app_explore_page/grid"),r="no-borders-grid";
its.dv14.Util.UI.displayModeSplitView()&&(r="no-borders-grid two-column"),n.replaceToken("class",r);
var i=n.getBlock("cardLoop");
for(var s=0;
s<t.items.length;
++s){var o=t.items[s];
if(o.artwork){var u=its.Templates.get("pages/dv14_app_explore_page/lockup_brick"),a={artworkUrls:o.artwork,size:this._isLandscape()?its.dv14.AppExplorePage.MainBrickArtwork.landscape:its.dv14.AppExplorePage.MainBrickArtwork.portrait,alt:o.link.label,classes:["light-art"],disabled:!0};
its.dv14.Util.UI.displayModeSplitView()&&(a.size={width:198,height:97});
var f=this.renderComponentWithData("artwork",a);
u.replaceTokenWithElement("artwork",f),u.replaceToken("url",o.link.url);
if(o.description){u.keepBlock("descriptionBlock");
var l=u.getBlock("descriptionBlock");
l.replaceToken("description",o.description),its.sf.Platform.iPadPro()||u.keepBlock("showDivider")}var c=u.composeAsElement();
its.sf.Metrics.setTargetInfo(c,"","lockup",its.sf.Metrics.ActionType.SELECT,o.link.url),i.replaceTokenWithElement("card",c),i.next()}}this._fcGridElement=n.composeAsElement(),this._currentlyRendering==its.dv14.AppExplorePage.CurrentlyRenderingKeys.INITIAL_PAGE_LOAD&&this._rightSplitElement.appendChild(this._fcGridElement)}}else e.contentIds?this._fetchGridData(e):this._renderRightSplit(e.id,its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR,document.createDocumentFragment())},_fetchGridData:function(e){var t={contentIds:e.contentIds.length>this._maxNumberOfLockups()?e.contentIds.slice(0,this._maxNumberOfLockups()):e.contentIds,scrollableCellControllerClass:its.sf14.ScrollableCellController.AppCard,"its.dv14.SmallLockup":{artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,detailsGenerator:its.dv14.LockupUtil.SoftwareCardDetailsGenerator}};
this._renderRightSplit(e.id,its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR,null,t)},_handleBrowseElementSelected:function(e){this._revertStylesIfNeeded();
var t=e.target;
t.tagName=="item"?this._handleItemTagSelected(e):t.tagName=="browse"&&this._handleBrowseTagSelected(e)},_handleBrowseTagSelected:function(e){var t=e.target,n=t.getAttribute("id");
if(!t.nextSibling)return;this._logger.info("Select event for: "+n),this._browseCategories=this._browseCategories.slice(0,this._browseCategories.indexOf(n)+1);
var r=this._pageDataCache[n];
this.handlePageDataChange(r,this._documentUrl,null);
if(this._isSplit()){this._currentlyRendering=n+its.dv14.AppExplorePage.CurrentlyRenderingKeys.LAST_SEEN;
while(t.nextSibling)delete this._browseGridCache[t.nextSibling.getAttribute("id")],t.nextSibling.remove();
this._rightSplitElement.children.length!=0&&this._rightSplitElement.removeAllChildNodes();
if(n=="dg.36")this._nearByAppsElement&&this._rightSplitElement.appendChild(this._nearByAppsElement),this._fcGridElement&&this._rightSplitElement.appendChild(this._fcGridElement),this._currentlyRendering=null;
else{var i=this._browseGridCache[n];
i&&this._renderRightSplit(n,its.dv14.AppExplorePage.CurrentlyRenderingKeys.LAST_SEEN,i)}}else{this._currentlyRendering=n+its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR;
while(t.nextSibling)t.nextSibling.remove();
var s=t.querySelector(".hidden-swoosh");
s&&n!="dg.36"&&s.parentNode.replaceChild(this.renderSwooshElement(r),s),this._currentlyRendering=null}},_handleItemTagSelected:function(e){if(e.target.getAttribute("selected")=="true")return;var t=e.target,n=e.target.getAttribute("data-fc-url"),r=e.target.getAttribute("data-category-id"),i=this._getUrlForSelectedCategory(r);
this._logger.info("Select event for: "+r);
var s=this._pageDataCache[r],o=null,u=s&&(s.categoriesData&&s.categoriesData.items||s.groupingUrl);
if(u)o=this.renderBrowse(s);
else{var a=its.Templates.get("pages/dv14_app_explore_page/browse");
a.replaceToken("id",e.target.getAttribute("data-category-id")),a.replaceToken("title",e.target.querySelector("title").textContent),o=a.composeAsElement()}if(this._isSplit()){var f=e.target.getAttribute("expands"),l=t.parentNode.querySelector('item[selected="true"]');
l.setAttribute("selected","false"),t.setAttribute("selected","true"),f=="true"&&(this._leftSplitElement.appendChild(o),setTimeout(function(){t.setAttribute("selected","false"),l.setAttribute("selected","true")}.bind(this),500)),this._rightSplitElement.children.length!=0&&(this._rightSplitElement.removeAllChildNodes(),this._rightSplitElement.appendChild(this.loadingSpinner));
if(n){var c=e.target.getAttribute("data-parent-id");
this._currentlyRendering=c+n,its.sf14.Util.getJSON(n,function(e,t){this._handleFCLink(e,t,c,n)}.bind(this),function(){this._logger.error(["Error fetching data: ",n])}.bind(this));
return}}else{if(n){its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:n});
return}this._exploreElement.appendChild(o)}r&&(this._currentlyRendering=r+its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR,!s||s.isChild?its.sf14.Util.fetchServerGetResponse(i,function(e){var t=e.responseText?JSON.parse(e.responseText):null;
t&&(this.processPageData(t.pageData),this.handlePageDataChange(t.pageData,i,e),this.storePlatform.cacheStorePlatformDataForProfiles(t.storePlatformData,!0),this._handleCategoryLink(r,f))}.bind(this),function(e){this._logger.error(["---------- _newCategoryData: Failed to fetch browse category data for genreId: ",r])}.bind(this)):this._handleCategoryLink(r,f))},_getUrlForSelectedCategory:function(e){return its.url.appendUrlParameter(this._baseUrl,"id",e)},_handleFCLink:function(e,t,n,r){this.storePlatform.cacheStorePlatformDataForProfiles(e.storePlatformData,!0);
var i=e.pageData.componentName,s=document.createElement("section");
if(i=="grouping_page")e.pageData.carouselArtworkKind="flowcaseSmall",s.appendChild(this.renderComponentWithData("grouping_mainstack",e.pageData));
else if(i=="room_page"){this._processUber(e.pageData.uber,s);
var o={contentIds:e.pageData.adamIds,"its.dv14.SmallLockup":{artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,detailsGenerator:this.lockupDetailsGenerator?this.lockupDetailsGenerator():null}};
s.appendChild(this.renderComponentWithData("grid",o))}else if(i=="multi_room_page"){this._processUber(e.pageData.uber,s);
var u=e.pageData.segments;
for(var a=0;
a<u.length;
a++){var f={title:u[a].title,contentIds:u[a].adamIds,link:{label:its.loc("See All"),url:u[a].seeAllUrl.url}},l=this.renderComponentWithData("swoosh",f);
s.appendChild(l)}}this._renderRightSplit(n,r,s),this.handlePageDataChange(e.pageData,r,t)},_processUber:function(e,t){if(e==null)return;this._stylesHaveChanged=!0;
var n=its.Templates.get("pages/dv14_app_explore_page/uber_block").composeAsElement(),r=its.sf.Platform.iPadPro()?this._isLandscape()?"browse_landscape":"browse_portrait":"browse_landscape";
this.renderComponentWithData("styles",{uber:e,element:n,artworkProfile:r});
var i=n.querySelector("style");
this._head.replaceChild(i,this._head.querySelector("style"));
var s=n.querySelector("img");
s&&t.appendChild(s)},_revertStylesIfNeeded:function(){this._stylesHaveChanged&&(this._head.replaceChild(this._originalStyle,this._head.querySelector("style")),this._stylesHaveChanged=!1)},_handleCategoryLink:function(e,t){var n=this._pageDataCache[e];
if(n){if(e+its.dv14.AppExplorePage.CurrentlyRenderingKeys.MOST_POPULAR!=this._currentlyRendering){this._logger.info("Not rendering "+e+" because currentlyRendering is "+this._currentlyRendering);
return}if(this._isSplit()){var r=this._browseCategories[this._browseCategories.length-1],i=this._pageDataCache[r];
i&&!i.categoriesData&&this._browseCategories.pop(),this._browseCategories.push(e);
if(t=="true"){var s=this._leftSplitElement.querySelector("browse[id='"+e+"']");
if(!s||!s.querySelector("item")){var o=this.renderBrowse(n);
s&&this._leftSplitElement.removeChild(s),this._leftSplitElement.appendChild(o)}}this._renderGrid(n)}else{this._browseCategories.push(e);
var s=this._exploreElement.querySelector("browse[id='"+e+"']");
if(s&&s.querySelector("item")&&s.querySelector(".hidden-swoosh")){var u=s.querySelector(".hidden-swoosh");
u.parentNode.replaceChild(this.renderSwooshElement(n),u)}else if(!s||!s.querySelector("item")){var o=this.renderBrowse(n);
s&&this._exploreElement.removeChild(s),this._exploreElement.appendChild(o)}this._currentlyRendering=null}}},_renderCarouselElement:function(){var e=this.rootPageData().featuredContent;
if(e&&e.items){var t=this.renderComponentWithData("flowcase",{flowcaseData:e.items,orientation:"explore",classNames:[],ignoreLinkType:!0,"its.dv14.FlowcaseItem":{orientation:"explore",alwaysLink:!0}});
return t}return null},_renderLeafLevelBrowse:function(e,t){var n={contentIds:t.orderedKeys,"its.dv14.SmallLockup":{detailsGenerator:its.dv14.LockupUtil.SoftwareCardDetailsGenerator,titleMaxLines:2}};
its.dv14.Util.UI.displayModeSingleView()&&(n={contentIds:t.orderedKeys,scrollableCellControllerClass:its.sf14.ScrollableCellController.AppCard,"its.dv14.SmallLockup":{artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,detailsGenerator:its.dv14.LockupUtil.SoftwareCardDetailsGenerator}}),e.appendChild(this.renderComponentWithData("grid",n))},_maxNumberOfLockups:function(){return its.property("DV14.AppExplore.maxNumberOfLockups")},onOrientationChange:function(e){if(this._fcGridElement){var t=e.newOrientation=="landscape"?its.dv14.AppExplorePage.MainBrickArtwork.landscape:its.dv14.AppExplorePage.MainBrickArtwork.portrait,n=this._fcGridElement.querySelectorAll("img");
for(var r=0;
r<n.length;
++r){var i=n[r];
i.setAttribute("height",t.height),i.setAttribute("width",t.width)}}if(its.dv14.Util.UI.shouldToggleSplitView()&&its.serverData.properties["DV14.AppExplore.enableRotation"]){if(this._nearByAppsShelf){var s=this._nearByAppsShelf.querySelector("divider");
its.dv14.Util.UI.displayModeSplitView()?s||this._nearByAppsShelf.appendChild(its.sf14.ComponentUtil.createDivider(this,!0)):s.parentNode.removeChild(s)}var o=this.renderPage();
this._pageElement.removeAllChildNodes();
while(o.childNodes.length>0)this._pageElement.appendChild(o.firstChild)}},_isLandscape:function(){return Settings.Screen.width>Settings.Screen.height},_handleNearByApps:function(e){this._logger.info("handleNearByApps is called");
if(this._nearByAppsShelf){var t=(new Date).getTime();
if(t-this._lastNearByAppsTime<3e4){this._logger.info("handleNearByApps: last call was too recent, ignoring event");
return}}this._lastNearByAppsTime=(new Date).getTime();
var n=JSON.parse(e.nearMe),r=its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.NATIVE_SEARCH_LOCKUP,its.sf.StorePlatform.ArtworkProfiles.SEARCH),i={};
i[r]=n,this.storePlatform.cacheStorePlatformDataForProfiles(i);
var s=its.reflect.keys(n.results),o={};
o.title=its.loc("DV14.AppExplore.PopularNearMe"),o.link={label:its.loc("See All"),callback:function(){var e={pageData:{pageTitle:its.loc("DV14.AppExplore.PopularNearMe"),defaultSort:0,sorts:[],adamIds:s,refUrl:this._documentUrl,metricsBase:its.sf14.Util.createMetricsBaseObject(this.pageData().metricsBase,"Popular Near Me","room")},storePlatformData:i,"its.dv14.ColumnList":{scrollableCellController:its.dv14.AppExplorePage.ListNearMeScrollableCellController}},t=its.sf14.BaseDocument.renderDocumentWithData("room_page",e,its.dv14.PageController.getDocumentSize());
its.dv14.PageController.pushDocument(t,{},!1)}.bind(this)},o.contentIds=s,o.scrollableCellControllerClass=its.dv14.AppExplorePage.ScrollableCellController,this._isSplit()||(o.showDivider=!1,o["its.dv14.SmallLockup"]={detailsGenerator:its.dv14.LockupUtil.BrowsePageSwooshSoftwareLockupDetailsGenerator,titleMaxLines:2}),this._nearByAppsShelf=this.renderComponentWithData("swoosh",o),this._nearByAppsElement.replaceChild(this._nearByAppsShelf,this._nearByAppsElement.firstChild)}}),its.dv14.AppExplorePage.CurrentlyRenderingKeys={INITIAL_PAGE_LOAD:"initialPageLoad",MOST_POPULAR:"mostPopular",LAST_SEEN:"lastSeen"},its.dv14.AppExplorePage.MainBrickArtwork={landscape:its.sf.Platform.iPadPro()?{width:465,height:228}:{width:337,height:165},portrait:its.sf.Platform.iPadPro()?{width:294,height:144}:{width:437,height:214}},its.dv14.AppExplorePage.ScrollableCellController=Class.createSubclass("its.dv14.AppExplorePage.ScrollableCellController",its.sf14.ScrollableCellController,{renderCells:function(e){var t=[];
for(var n=0;
n<e.orderedKeys.length;
n++){var r=e.orderedKeys[n];
if(e[r]){var i={content:e[r]},s=this._parent.renderComponentWithData("small_lockup",i);
t.push(s)}}this._appendCells(t)},_profile:function(){return its.sf.StorePlatform.Profiles.NATIVE_SEARCH_LOCKUP},_artworkProfile:function(){return its.sf.StorePlatform.ArtworkProfiles.SEARCH}}),its.dv14.AppExplorePage.ListScrollableCellController=Class.createSubclass("its.dv14.AppExplorePage.ListScrollableCellController",its.sf14.ScrollableCellController.List,{_artworkProfile:function(){return its.sf.StorePlatform.ArtworkProfiles.GROUPING}}),its.dv14.AppExplorePage.ListNearMeScrollableCellController=Class.createSubclass("its.dv14.AppExplorePage.ListNearMeScrollableCellController",its.sf14.ScrollableCellController.List,{_profile:function(){return its.sf.StorePlatform.Profiles.NATIVE_SEARCH_LOCKUP},_artworkProfile:function(){return its.sf.StorePlatform.ArtworkProfiles.SEARCH}}),its.dv14.ArtistPage=Class.createSubclass("its.dv14.ArtistPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._pageData=this.data.pageData,this._artist=this._pageData.artist,this.template=its.Templates.get("pages/dv14_artist_page"),this.subscribe(its.sf14.Events.APP_PREVIEW_CHANGE,this._onAppPreviewStateChanged.bind(this))},render:function(){this._pageElement=this.template.composeAsElement();
var e=this._pageData.typ;
e&&this._pageElement.replaceTokenWithElement("thankYouPlacard",this.renderComponentWithData("thank_you_placard",e));
var t=this._blocks();
if(its.isArray(t)){var n=document.createDocumentFragment();
its.dv14.BlockUtil.validateBlocks(t,function(){for(var e=0;
e<t.length;
e++){var r=this.renderComponentWithData(t[e].type,t[e]);
its.isElement(r)&&n.appendChild(r)}this._pageElement.replaceTokenWithElement("blocks",n)}.bind(this))}var r=this._pageData.radioSwoosh;
if(r&&r.content){var i;
if(r.content.length==1){var s={radioPromoData:r.content[0],isArtistPage:!0};
i=this.renderComponentWithData("radio_promo",s)}else i=this.renderComponentWithData("radio_swoosh",r);
this._pageElement.replaceTokenWithElement("radioPromo",i)}return this._renderSwooshes(!1),this._renderNavigationBar(),this.addDocumentStyles(this._pageElement,{uber:this._pageData.uber,blocks:this._blocks(),noFade:!0}),this._pageElement},_renderNavigationBar:function(){var e={title:this._artist.name};
this._navigationElement=this.renderComponentWithData("navigation_bar",e),this._pageElement.replaceTokenWithElement("navigation",this._navigationElement)},_renderSwooshes:function(e){var t=this._swooshes(),n=e?this.documentElement():this._pageElement;
if(t&&t.length!=0)if(t.length==1){var r={contentIds:t[0].adamIds},i=this.renderComponentWithData("column_list",r);
n.replaceTokenWithElement("content",i)}else n.replaceTokenWithElement("content",this._createCenterStack(t))},_swooshes:function(){if(!this._swooshesForDisplay){var e=this._pageData.contentData;
if(e){var t=new Array,n=its.dv14.Util.Client.getClientApplication();
for(var r=0;
r<e.length;
r++){var i=e[r];
if(its.dv14.Util.Client.isITunes()&&i.dkId==25)continue;if(its.dv14.Util.Client.isIBooks()&&!(i.dkId==25||its.sf14.Util.isCopperOrGreater()&&i.dkId==3))continue;if(its.dv14.Util.Client.isBridge()&&i.dkId==43)continue;t.push(i)}this._swooshesForDisplay=t}}return this._swooshesForDisplay},_createCenterStack:function(e){var t=document.createDocumentFragment();
for(var n=0;
n<e.length;
n++){var r=e[n];
if(r&&r.adamIds.length>0){var i=r.adamIds,s=its.dv14.Swoosh.Type.DEFAULT,o=its.sf14.ScrollableCellController.Basic,u="";
this._isForSongsOrRingTones(r)&&(o=its.sf14.ScrollableCellController.List.Chart,s=its.dv14.Swoosh.Type.LIST,u="shelf-with-rows");
var a={dkId:r.dkId,ids:this._artist.adamId,section:n};
r.dkId==11&&(r.deviceFamily==its.sf.StorePlatform.DeviceFamily.iPhone?a.softwareType="iPhone":a.softwareType="iPad");
var f=its.url.appendUrlParameters(this.data.constants["SFJArtistPage.artistSeeAllBaseUrl"],a),l={label:its.loc("See All"),url:f};
its.dv14.Util.Client.isPodcasts()&&(l=undefined);
var c={title:r.title,contentIds:i,scrollableCellControllerClass:o,link:l,additionalClasses:u,type:s,doNotFilter:!0};
c["its.dv14.SmallLockup"]={isNewsstandGenre:!1},t.appendChild(this.renderComponentWithData("swoosh",c))}}return t},_isForSongsOrRingTones:function(e){return e.dkId===1||e.dkId===21},_onAppPreviewStateChanged:function(){this._renderNavigationBar()},_blocks:function(){var e=this._pageData.blocks,t;
return e&&!its.isArray(e)?t=its.dv14.Util.UI.isCompact(this.size())?e.iphone:e.ipad:t=e,t},onDocumentSizeChange:function(e){this.base(e),this._renderSwooshes(!0)},onOrientationChange:function(e){this.base(e);
var t={page:this._pageElement,orientation:e.newOrientation};
its.notifications.publish("artist_page:orientationChange",t)}}),its.dv14.AudiobookPage=Class.createSubclass("its.dv14.AudiobookPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments)},productLockup:function(){var e={content:this.product};
return this.renderComponentWithData("audiobook_product_lockup",e)},panesToShow:function(){var e;
return its.sf.ParentalRatingUtil.doesPass(this.product)?(e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0},{title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}],its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED})):e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderExplicitContentTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}],e},_renderExplicitContentTab:function(e,t){var n=its.Templates.get("pages/dv14_ebook_page/explicit_tab");
n.replaceToken("title",its.loc("ParentalControl.eBooks")),n.replaceToken("subtitle",its.loc("ParentalControl.eBooks.ToDownload")),t.appendChild(n.composeAsElement())},_genre:function(){return this.product.genres[0]},_informationElement:function(){var e=[],t=this.product,n=this.pageData;
n.narrator&&e.push({title:its.loc("DV14.AudiobookPage.Narrator"),values:[n.narrator]});
if(n.durationInMs){var r=its.sf14.Util.Duration.generateDurationString(n.durationInMs/1e3);
e.push({title:its.loc("DV14.AudiobookPage.Length"),values:[r],replaceUnescaped:!0})}t.releaseDate&&e.push({title:its.loc("Published"),values:[its.locDate(t.releaseDate)]});
var i=this._genre();
i&&e.push({title:its.loc("Category"),values:[i.name]}),n.provider&&e.push({title:its.loc("DV14.AudiobookPage.Provider"),values:[n.provider]}),n.presenter&&e.push({title:its.loc("DV14.AudiobookPage.PresentedBy"),values:[n.presenter]});
var s={title:its.loc("DV14.Information"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",s)},_elementForDetails:function(){var e=its.Templates.get("pages/dv14_ebook_page/details_tab"),t=this.product,n=t.description;
if(n){var r={title:its.loc("BookDescription"),description:n.standard,dontEscape:!0,maxLines:5};
e.replaceTokenWithElement("description",this.renderComponentWithData("description",r))}return e.replaceTokenWithElement("information",this._informationElement()),t.copyright&&e.replaceToken("copyright",t.copyright),e.composeAsElement()},_renderDetailsTab:function(e,t){t.appendChild(this._elementForDetails())},_elementForRelatedTab:function(e){var t=document.createDocumentFragment(),n=this.pageData,r=e?"grid":"swoosh",i=n.moreAudiobooksByThisAuthorAdamIds;
if(i&&i.length>0){var s=e?3:null;
swooshData={title:its.loc("DV14.ProductPage.MoreAudioBooksByAuthor",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(i,s),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},t.appendChild(this.renderComponentWithData(r,swooshData))}i=n.moreBooksByThisAuthorAdamIds;
if(i&&i.length>0){var s=e?3:null;
swooshData={title:its.loc("DV14.ProductPage.MoreBooksByAuthor",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(i,s),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},t.appendChild(this.renderComponentWithData(r,swooshData))}i=n.listenersAlsoBoughAdamIdst;
if(i&&i.length>0){var s=e?3:null;
swooshData={title:its.loc("DV14.ProductPage.CustomersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(i,s),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},t.appendChild(this.renderComponentWithData(r,swooshData))}i=n.topInGenreAdamIds;
if(i&&i.length>0){var s=e?3:null;
swooshData={title:its.loc("TopBooksInGenre",{genre:this._genre().name}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(i,s),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},t.appendChild(this.renderComponentWithData(r,swooshData))}return t},_renderRelatedTab:function(e,t,n){var r=function(){t.appendChild(this._elementForRelatedTab(n));
if(t.lastElementChild){var e=t.lastElementChild.getElementsByTagName("divider").item(0);
e&&e.remove()}}.bind(this),i=this.pageData,s=i.moreAudiobooksByThisAuthorAdamIds,o=i.moreBooksByThisAuthorAdamIds,u=i.customersAlsoBought,a=i.topInGenreAdamIds,f=[];
s&&(f=f.concat(s)),o&&(f=f.concat(o)),u&&(f=f.concat(u)),a&&(f=f.concat(a));
var l={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:f,onOKHasAllContent:r,onOKMissingContent:r,suppressPersonalization:!0};
this.storePlatform.fetchContent(l)}}),its.dv14.BannerRoomPage=Class.createSubclass("its.dv14.BannerRoomPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.BannerRoomPage"),this._template=its.Templates.get("pages/dv14_banner_room_page")},render:function(){return this._renderNavigationBar(),this._template.replaceTokenUnescaped("descriptionText",this.pageData().uber.description),this._renderRoomContent(),this._pageElement=this._template.composeAsElement(),this._refreshStyling(),this.addDocumentStyles(this._pageElement,{uber:this.pageData().uber,mt:this.pageData().mt}),this.subscribe("banner_room:orientationChange",this._updateBannerImageDimensions.bind(this)),this._pageElement},_renderNavigationBar:function(){var e={title:this.pageData().pageTitle,hasShareButton:!1};
this._template.replaceTokenWithElement("navigationBar",this.renderComponentWithData("navigation_bar",e))},_renderRoomContent:function(){var e={},t=this.pageData().doNotFilter?this.pageData().doNotFilter:!0;
t?e=this.pageData().contents:e=its.dv14.Util.UI.filterMixedRoomByInstalledApps(this.pageData().contents);
var n=this._template.getBlock("lockupLoop"),r=its.Templates.get("pages/dv14_banner_room_page/banner_room_lockup");
for(var i=0,s=e.length;
i<s;
i++){var o=e[i];
if(o.link)r.replaceToken("url",o.link.url);
else if(o.adamId){var u=this.storePlatform.getCachedData(o.adamId,its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.LOCKUP,its.sf.StorePlatform.ArtworkProfiles.ROOM));
u&&(r.replaceToken("url",u.url),r.replaceToken("kind",u.kind),r.replaceToken("contentId",u.id))}var a=its.dv14.LockupUtil.getArtworkDimensions("banner",null,this.size()),f=o.artwork;
if(!f||f.length==0)f=[{url:o.imageUrl,width:a.width,height:a.height}];
r.replaceTokenUnescaped("artwork",this.renderComponentStringWithData("artwork",{artworkUrls:f,size:a,classes:["brick-art"],alt:o.imageAltText})),o.text&&(r.keepBlock("descriptionTextBlock",!0),r.replaceTokenUnescaped("descriptionText",o.text)),n.replaceTokenWithElement("lockup",r.composeAsElement()),n.next()}},onOrientationChange:function(e){var t={page:this._pageElement,orientation:e.newOrientation};
its.notifications.publish("banner_room:orientationChange",t)},onDocumentSizeChange:function(e){this.base.apply(this,arguments),its.dv14.Util.UI.clientSupportsMedusa()&&this._refreshStyling()},onAppear:function(){this.base.apply(this,arguments),its.dv14.Util.UI.clientSupportsMedusa()&&this._refreshStyling()},_refreshStyling:function(){var e="banner-room-page-grid-ipad",t="banner-room-page-grid-iphone",n=its.dv14.Util.UI.clientSupportsMedusa(),r=n&&its.dv14.Util.UI.isCompact(this.size());
its.sf.Platform.iPhone()||its.sf.Platform.iPad()&&r?(this._pageElement.querySelector("grid").classList.contains(e)&&this._pageElement.querySelector("grid").classList.remove(e),this._pageElement.querySelector("grid").classList.contains(t)||this._pageElement.querySelector("grid").classList.add(t)):its.sf.Platform.iPad()&&(this._pageElement.querySelector("grid").classList.contains(t)&&this._pageElement.querySelector("grid").classList.remove(t),this._pageElement.querySelector("grid").classList.contains(e)||this._pageElement.querySelector("grid").classList.add(e))},_updateBannerImageDimensions:function(e){var t=e.page.querySelectorAll(".brick"),n=its.dv14.LockupUtil.getArtworkDimensions("banner",null,this.size());
for(var r=0,i=t.length;
r<i;
r++){var s=t.item(r);
s.setAttribute("width",n.width),s.setAttribute("height",n.height)}},pageData:function(){return this.data.pageData},pageElement:function(){return this._pageElement},id:function(){return this.pageData().id}}),its.dv14.CustomPage=Class.createSubclass("its.dv14.CustomPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.template=its.Templates.get("pages/dv14_custom_page")},pageData:function(){return this.data.pageData},render:function(){this._pageElement=this._pageElement||this.template.composeAsElement(),this._renderNavigationBar(),this.addDocumentStyles(this._pageElement,{uber:this.pageData().uber,blocks:this._blocks(),mt:this.pageData().mt});
var e=this.pageData().typ;
e&&this._pageElement.replaceTokenWithElement("thankYouPlacard",this.renderComponentWithData("thank_you_placard",e));
var t=document.createDocumentFragment(),n=this._blocks();
return its.isArray(n)&&its.dv14.BlockUtil.validateBlocks(n,function(){for(var e=0;
e<n.length;
e++){var r=this.renderComponentWithData(n[e].type,n[e]);
its.isElement(r)&&t.appendChild(r)}this._pageElement.replaceTokenWithElement("content",t)}.bind(this)),this._pageElement},_renderNavigationBar:function(){var e={title:this.pageData().pageTitle};
this._pageElement.replaceTokenWithElement("navigation",this.renderComponentWithData("navigation_bar",e))},_blocks:function(){var e=this.pageData().blocks,t;
return e&&!its.isArray(e)?t=its.dv14.Util.UI.isCompact(this.size())?e.iphone:e.ipad:t=e,t},element:function(){return this._pageElement},onOrientationChange:function(e){var t={page:this._pageElement,orientation:e.newOrientation};
its.notifications.publish("custom_page:orientationChange",t)},onDocumentSizeChange:function(e){this.base(e),this.render()}}),its.dv14.CategoriesPage={initialize:function(){this._logger=its.Logger.named("its.dv14.CategoriesPage"),its.sf14.Metrics.Events.PageRender.isAvailable()&&its.sf14.Metrics.Events.PageRender.updateInteractionTime(),its.notifications.subscribe(its.sf14.Events.NATIVE_PAGE_TRANSITION,this._handleCategoryChange.bind(this),null,null,function(e){return e.type=="category"})},_handleCategoryChange:function(e){its.sf14.Metrics.Events.PageRender.isAvailable()&&its.sf14.Metrics.Events.PageRender.updateInteractionTime(),TabBar.selectedTab.navigationDocument.clear(),its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:e.data.url,suppresssNavigationBar:!0})}},its.dv14.CategoriesPage.initialize(),its.dv14.CoursePage=Class.createSubclass("its.dv14.CoursePage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments)},_primaryGenre:function(){return this.product.genres[0]},productLockup:function(){this._logger.debug(["---------- renderProductLockup: "]);
var e=!0;
this.pageData&&(e=this.pageData.hasPrimaryArtist);
var t={content:this.product,language:this.pageData.language,primaryGenre:this._primaryGenre(),hasPrimaryArtist:e},n="course_product_lockup";
return this.renderComponentWithData(n,t)},panesToShow:function(){var e=[],t=function(e,t){this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.ITEM,ids:this.product.childrenIds,onOK:function(){this._renderDetailsTab(e,t)}.bind(this),suppressPersonalization:!0}])}.bind(this);
return e.push({title:its.loc("DV14.ProductPage.Tab.Details"),callback:t,tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}),e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),e},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_course_page/details_tab"),r=this.product.description;
if(r&&r.standard){var i=r.standard,s=r.title;
s||(s=its.loc("DV14.Description"));
if(i&&s){var o={description:i,title:s,dontEscape:!1,maxLines:3,showDivider:!1};
n.replaceTokenWithElement("description",this.renderComponentWithData("description",o))}}var u=[];
u.push(new its.dv14.TrackList.Column.Ordinal),u.push(new its.dv14.TrackList.Column.Title(its.loc("DV14.TrackList.Column.Name"))),u.push(new its.dv14.TrackList.Column.Badge),u.push(new its.dv14.TrackList.Column.BuyButton(its.loc("DV14.TrackList.Column.Price")));
var a={contentIds:this.filteredChildrenIds(this.product.childrenIds),columns:u,selectedTrackAdamId:its.url.queryParamValue("i",this.documentUrl()),overrideTrackNumbers:its.dv14.TrackList.orderedTrackNumbers(this.product.childrenIds),suppressPersonalization:!0},f=this.renderComponentWithData("track_list",a);
n.replaceTokenWithElement("trackList",f);
var l={"data-url":its.serverData.constants.iTunesULearnMore,"class":"itunesu-learn-more"};
n.replaceTokenUnescaped("learnMore",its.sf14.ComponentUtil.createButton(this,its.loc("DV6.CourseProductPage.LearnAboutLink"),its.sf14.ComponentUtil.ButtonType.LINK,l));
var c=n.composeAsElement();
t.appendChild(c)},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_podcast_page/related_tab"),i=this.product.itunesuType&&this.product.itunesuType=="collection",s=n?"grid":"swoosh",o=function(){if(this.pageData.allCoursesByAuthor&&this.pageData.allCoursesByAuthor.length>0){var e=n?3:null,o=i?its.loc("DV14.ProductPage.MoreFromProvider",{artistName:this.product.artistName}):its.loc("DV14.ProductPage.MoreByArtist",{artistName:this.product.artistName}),u={title:o,contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.allCoursesByAuthor,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByArtist",this.renderComponentWithData(s,u))}if(this.pageData.customersAlsoBought&&this.pageData.customersAlsoBought.length>0&&!i){var e=n?3:null,a={title:its.loc("DV14.listenersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.listenersAlsoBought,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("listenersAlsoBought",this.renderComponentWithData(s,a))}if(this.pageData.allCollectionsByAuthor&&this.pageData.allCollectionsByAuthor.length>0){var f=this._primaryGenre(),l=f?f.name:null,e=n?3:null,c={title:its.loc("DV14.PodcastPage.MoreInGenre",{genre:l}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.allCollectionsByAuthor,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("topPodcastsInGenre",this.renderComponentWithData(s,c))}t.appendChild(r.composeAsElement())}.bind(this),u=[];
this.pageData.allCoursesByAuthor&&(u=u.concat(this.pageData.allCoursesByAuthor)),this.pageData.allCollectionsByAuthor&&(u=u.concat(this.pageData.allCollectionsByAuthor)),this.pageData.customersAlsoBought&&(u=u.concat(this.pageData.customersAlsoBought));
var a={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:u,onOKHasAllContent:o,onOKMissingContent:o,suppressPersonalization:!0};
this.storePlatform.fetchContent(a)},filteredChildrenIds:function(e){var t=this.pageData.unavailableChildrenAdamIds;
if(t){var n=Object.keys(t);
for(var r=0;
r<n.length;
r++){var i=e.indexOf(t[n[r]]);
i>=0&&e.splice(i,1)}}return e}}),its.dv14.CurtainPage=Class.createSubclass("its.dv14.CurtainPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},render:function(){var e=its.Templates.get("pages/curtain_page");
return this.curtainElement=e.composeAsElement(),this.renderDeviceContent(),this.addDocumentStyles(this.curtainElement),this.curtainElement},renderDeviceContent:function(){var e,t,n,r,i,s,o,u;
t=its.dv14.Util.UI.Orientation=="landscape"?"watch-bg-left":"watch-bg",o="watch-coming-soon",u="watch-bottom-text-large",its.sf.Platform.isIPhone6PlusScreenSize()?(e=its.dv14.Util.UI.Orientation=="landscape"?its.Templates.get("pages/curtain_page/n56/landscape"):its.Templates.get("pages/curtain_page/n56"),n="/images/watch/AppleWatchLogo.3x.png",r="/images/watch/AppleWatchLeather.3x.png",i="/images/watch/AppleWatchMetal.3x.png",s="/images/watch/AppleWatchGreen.3x.png",o="watch-coming-soon-big"):its.sf.Platform.isIPhone6ScreenSize()?(e=its.Templates.get("pages/curtain_page/n61"),n="/images/watch/AppleWatchLogo.2x.png",r="/images/watch/AppleWatchLeather.2x.png",i="/images/watch/AppleWatchMetal.2x.png",s="/images/watch/AppleWatchGreen.2x.png"):(e=its.Templates.get("pages/curtain_page/n51"),n="/images/watch/AppleWatchLogoN51.2x.png",r="/images/watch/AppleWatchLeatherN51.2x.png",i="/images/watch/AppleWatchMetalN51.2x.png",s="/images/watch/AppleWatchGreenN51.2x.png",u="watch-bottom-text"),e.replaceToken("curtainPageTitle",its.loc("DV14.Gizmo.AppStore")),e.replaceToken("stackClass",t),e.replaceToken("watchLogo",its.serverData.constants.resourceBaseUrl+n);
var a,f;
switch(its.property("DV14.Gizmo.currentLaunchState")){case 1:a=its.sf14.ComponentUtil.createText(this,its.loc("DV14.Gizmo.ComingSoon"),{attributes:{"class":o}},!0),f=its.serverData.constants.resourceBaseUrl+r;
break;case 2:a=its.sf14.ComponentUtil.createText(this,its.loc("DV14.Gizmo.PreOrderMonth"),{attributes:{"class":o}},!0),f=its.serverData.constants.resourceBaseUrl+i;
break;case 3:a=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.Gizmo.PreOrderNow"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"watch-preorder-link",maxLines:1,"data-url":its.loc("DV14.Gizmo.curtainPreOrderUrl"),"data-page-target":"external"},null,!0),f=its.serverData.constants.resourceBaseUrl+s;
break;case 4:a=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.Gizmo.LearnMore"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"watch-learnmore-link",maxLines:1,"data-url":its.loc("DV14.Gizmo.curtainLearnMoreUrl"),"data-page-target":"external"},null,!0),f=its.serverData.constants.resourceBaseUrl+s}e.replaceTokenWithElement("subtextForPhase",a),e.replaceToken("watchImage",f),e.replaceTokenWithElement("bottomText",its.sf14.ComponentUtil.createText(this,its.loc("DV14.Gizmo.BuiltForAppleWatch"),{attributes:{"class":u,maxLines:3}},!0)),this.curtainElement.replaceTokenWithElement("content",e.composeAsElement())},navigationBar:function(){var e=its.Templates.get("pages/curtain_page/navigation_bar");
e.replaceToken("curtainPageTitle",its.loc("DV14.Gizmo.AppStore"));
var t=e.composeAsElement();
return t},onOrientationChange:function(e){this.renderDeviceContent()}}),its.dv14.DocTypeLookupPage=Class.createSubclass("its.dv14.DocTypeLookupPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.BannerRoomPage"),this._pageData=this.lookup("pageData")},templateName:function(){return"pages/dv14_doc_type_lookup_page"},render:function(){this._pageElement=this.template.composeAsElement(),this.addDocumentStyles(this._pageElement,{mt:its.serverData.constants.MZMediaType.MobileSoftware.id,noFade:!0});
var e={title:this._pageData.pageTitle||its.loc("Search")};
this._navigationElement=this.renderComponentWithData("navigation_bar",e),this._pageElement.replaceTokenWithElement("navigation",this._navigationElement);
var t=this._pageData.adamIds||[];
if(t.length>0){var n={contentIds:t,"its.dv14.SmallLockup":{type:its.dv14.SmallLockup.Type.LIST}};
this._pageElement.replaceTokenWithElement("content",this.renderComponentWithData("column_list",n))}else{var r=its.Templates.get("pages/dv14_doc_type_lookup_page/no_results"),i="resource://"+(its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())?"emptySearchLarge":"emptySearch");
r.replaceToken("imgSrc",i),r.replaceToken("message",its.loc("DV14.NoResultsFound")),this._pageElement.replaceTokenWithElement("content",r.composeAsElement())}return this._pageElement},pageElement:function(){return this._pageElement}}),its.dv14.EBookPage=Class.createSubclass("its.dv14.EBookPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments)},_cachedStorePlatformData:function(){var e=[its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.LOCKUP,its.sf.StorePlatform.ArtworkProfiles.ROOM)],t;
for(var n=0;
n<e.length;
n++){t=this.storePlatform.getCachedData(this.contentId,e[n]);
if(t)break}return t||(t=this.storePlatform.getCachedData(this.contentId)),t},productLockup:function(){var e={content:this.product};
return this._ebookLockupElement=this.renderComponentWithData("ebook_product_lockup",e),this._ebookLockupElement},panesToShow:function(){var e;
return its.sf.ParentalRatingUtil.doesPass(this.product)?e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0},{title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS},{title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}]:its.App.ParentalRequestData?e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0},{title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}]:e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderExplicitContentTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}],e},_criticalReviewsElement:function(){var e=this.product.criticalReviews;
if(!e||e.length<1)return null;
e.sort(its.sf.ProductPageUtil.descendingComparatorForObjectsWithDate);
var t=e[0],n=its.loc("SFEbookPageHelper.reviewSource",{reviewSource:t.source}),r=its.locDate(t.date),i=its.loc("SF.CriticalReviewWithCopyright",{review:t.content.trim(),copyright:t.copyright}),s={title:n,date:r,description:i,maxLines:5};
return this.renderComponentWithData("description",s)},_genre:function(){return this.product.genres[0]},_informationElement:function(){var e=[],t=this.product,n=t.ebookInfo,r=n.languageDisplayString;
r&&e.push({title:its.loc("DV14.Language"),values:[r]});
var i=this._genre();
i&&e.push({title:its.loc("Category"),values:[i.name]});
var s=n.publisher;
s&&e.push({title:its.loc("Publisher"),values:[s]});
var o=n.seller;
o&&e.push({title:its.loc("Seller"),values:[o]}),t.releaseDate&&e.push({title:its.loc("Published"),values:[its.locDate(t.releaseDate)]});
var u=its.sf.StorePlatformUtil.orderedAssets(t.offers);
if(u&&u[0]){var a=u[0].size;
if(a){var f=its.dv14.ProductPageUtil.sizeString(a);
e.push({title:its.loc("DV14.Size"),values:[f]})}}var l=n.pageCount;
l&&e.push({title:its.loc("PrintLength"),values:[its.locWithCount("PagesWithCount",l)],replaceUnescaped:!0});
var c=its.sf.ProductPageUtil.bookSeriesInfoString(this.product);
c&&e.push({title:its.loc("SFBookSeries.series"),values:[c]});
var h={title:its.loc("DV14.Information"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",h)},_elementForDetails:function(){var e=its.Templates.get("pages/dv14_ebook_page/details_tab"),t=this.product,n=function(e){return e.replace(/<br>/g,"<br/>")},r=t.itunesNotes;
if(r&&r.standard){var i={title:its.loc("DT6.EbookPage.ITunesNotes"),description:n(r.standard),dontEscape:!0,maxLines:5};
e.replaceTokenWithElement("editorsNotes",this.renderComponentWithData("description",i))}var s=t.description;
if(s&&s.standard){var o={title:its.loc("BookDescription"),description:n(s.standard),dontEscape:!0,maxLines:5};
e.replaceTokenWithElement("description",this.renderComponentWithData("description",o))}this.pageData.ebookInfoMap.screenShots&&e.replaceTokenWithElement("screenshots",this._renderScreenshotsElement());
var u=this._criticalReviewsElement();
u&&e.replaceTokenWithElement("criticalReviews",u),e.replaceTokenWithElement("information",this._informationElement());
var a=this.pageData.ebookInfoMap,f=a.bookSeriesSwooshIds;
if(f&&f.length>0){var l={contentIds:f,link:{label:its.loc("See All"),url:a.bookSeriesUrl},suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:its.dv14.EBookPage.SeriesScrollableCellController,title:its.loc("SFBookSeries.otherBooksInThisSeries")};
e.replaceTokenWithElement("otherBooksInSeries",this.renderComponentWithData("swoosh",l))}this._similarToSwooshData={title:its.loc("DV14.ProductPage.BooksSimilarTo"),dk:this.pageData.kind,type:its.dv14.PersonalizedSwoosh.Type.SIMILAR_TO,personalizedSwooshData:{lookupUrlData:{baseUrl:its.serverData.constants.bookRecommendationsBaseUrl},lockupCountMinimumIos:5},allowExplicit:!its.sf.ParentalRatingUtil.parentalThresholdBooks(),salableAdamid:this.pageData.id,salableKind:"epubBook",fetchAdamIDsOnRender:!0},e.replaceTokenWithElement("similarTo",this.renderComponentWithData("personalized_swoosh",this._similarToSwooshData));
var c=a.bookRequirements;
if(c){var h={title:its.loc("Requirements"),description:c,maxLines:5};
e.replaceTokenWithElement("requirements",this.renderComponentWithData("description",h))}return this.product.copyright&&e.replaceToken("copyright",this.product.copyright),e.composeAsElement()},_renderScreenshotsElement:function(){if(!this._screenShotsElement){var e=[],t=Device.pixelRatio==2?this.pageData.ebookInfoMap.screenShots2x:this.pageData.ebookInfoMap.screenShots;
if(t)for(var n=0;
n<t.length;
n++)e.push(this._createGalleryItem(t[n],n+1));
var r={items:e};
this._screenShotsElement=this.renderComponentWithData("gallery",r)}return this._screenShotsElement},_createGalleryItem:function(e,t){var n={url:e.artworkUrl,height:e.height,width:e.width},r=its.loc("DV14.ProductPage.EBook.ScreenShotAltText",{index:t}),i=[n],s={artworkUrls:i,size:its.dv14.LockupUtil.getArtworkDimensions("screenshot",null,this.size()),alt:r},o={artworkUrls:n,size:its.dv14.LockupUtil.getArtworkDimensions("fullscreen",null,this.size()),alt:r},u={artworkData:s,fullscreenArtworkData:o,type:its.dv14.Gallery.Type.IMAGE};
return u},_renderDetailsTab:function(e,t){var n=function(){t.appendChild(this._elementForDetails())}.bind(this),r=this.pageData.ebookInfoMap.bookSeriesSwooshIds;
if(r&&r.length>0){var i={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:r,onOKHasAllContent:n,onOKMissingContent:n,suppressPersonalization:!0};
this.storePlatform.fetchContent(i)}else n()},_elementForRelatedTab:function(e){var t=its.Templates.get("pages/dv14_ebook_page/related_tab"),n=this.pageData,r=n.ebookInfoMap,i=r.bookSeriesSwooshIds,s=e?"grid":"swoosh",o;
if(!e){var u=i;
u&&u.length>0&&(o={contentIds:its.dv14.ProductPageUtil.trimSwooshIds(i,a),link:{label:its.loc("See All"),url:r.bookSeriesUrl},suppressPersonalization:this.lookup("suppressPersonalization"),title:its.loc("SFBookSeries.otherBooksInThisSeries"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.dv14.EBookPage.SeriesScrollableCellController,useAlternateTemplate:e?!0:!1},t.replaceTokenWithElement("otherBooksInSeries",this.renderComponentWithData(s,o)))}u=n.allByAuthor;
if(u&&u.length>0){var a=e?3:null;
o={title:its.loc("DV14.ProductPage.MoreByArtist",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(u,a),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},u.length>4&&(o.link={label:its.loc("See All"),url:r.allBooksByAuthor}),t.replaceTokenWithElement("moreByArtist",this.renderComponentWithData(s,o))}u=n.audioBooksByAuthor;
if(u&&u.length>0){var a=e?3:null;
o={title:its.loc("DV14.ProductPage.MoreAudioBooksByAuthor",{artistName:this.product.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(u,a),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},u.length>4,t.replaceTokenWithElement("audiobooksByArtist",this.renderComponentWithData(s,o))}e||(this._similarToSwooshData={title:its.loc("DV14.ProductPage.BooksSimilarTo"),dk:this.pageData.kind,type:its.dv14.PersonalizedSwoosh.Type.SIMILAR_TO,personalizedSwooshData:{lookupUrlData:{baseUrl:its.serverData.constants.bookRecommendationsBaseUrl},lockupCountMinimumIos:5},allowExplicit:!its.sf.ParentalRatingUtil.parentalThresholdBooks(),salableAdamid:this.pageData.id,salableKind:"epubBook",fetchAdamIDsOnRender:!0},t.replaceTokenWithElement("similarTo",this.renderComponentWithData("personalized_swoosh",this._similarToSwooshData))),u=n.customersAlsoBought;
var f=null;
if(u&&u.length>0){var a=e?3:null;
n.swooshMetrics&&n.swooshMetrics.cab_swoosh&&(f=n.swooshMetrics.cab_swoosh),o={title:its.loc("DV14.ProductPage.CustomersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(u,a),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1,additionalMetricsData:f},t.replaceTokenWithElement("customersAlsoBought",this.renderComponentWithData(s,o))}u=n.moreInGenre;
if(u&&u.length>0){var a=e?3:null;
o={title:its.loc("TopBooksInGenre",{genre:this._genre().name}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(u,a),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:e?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:e?!0:!1},t.replaceTokenWithElement("moreInGenre",this.renderComponentWithData(s,o))}return t.composeAsElement()},_renderRelatedTab:function(e,t,n){var r=function(){t.appendChild(this._elementForRelatedTab(n));
if(t.lastElementChild){var e=t.lastElementChild.getElementsByTagName("divider").item(0);
e&&e.remove()}}.bind(this),i=this.pageData,s=i.ebookInfoMap.bookSeriesSwooshIds,o=i.allByAuthor,u=i.customersAlsoBought,a=i.moreInGenre,f=[];
s&&(f=f.concat(s)),o&&(f=f.concat(o)),u&&(f=f.concat(u)),a&&(f=f.concat(a));
var l={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:f,onOKHasAllContent:r,onOKMissingContent:r,suppressPersonalization:!0};
this.storePlatform.fetchContent(l)},_renderExplicitContentTab:function(e,t){var n=its.Templates.get("pages/dv14_ebook_page/explicit_tab");
n.replaceToken("title",its.loc("ParentalControl.eBooks")),n.replaceToken("subtitle",its.loc("ParentalControl.eBooks.ToDownload")),t.appendChild(n.composeAsElement())},_updateRestrictions:function(){this.renderTabbedPane(!0)}}),its.dv14.EBookPage.SeriesScrollableCellController=Class.createSubclass("its.dv14.EBookPage.SeriesScrollableCellController",its.sf14.ScrollableCellController,{renderCells:function(e){var t=[];
for(var n=0;
n<e.orderedKeys.length;
n++){var r=e.orderedKeys[n],i=e[r];
if(i){var s={content:i},o=i.ebookInfo&&i.ebookInfo.seriesInfo?i.ebookInfo.seriesInfo.sequenceNumber:null;
its.isDefinedNonNullNonEmpty(o)&&(s.ordinal=o+this._ordinalSeparator(),s.titleOrdinal=!0);
var u=this._parent.renderComponentWithData("small_lockup",s);
t.push(u)}}this._appendCells(t)}}),its.dv14.ErrorPage=Class.createSubclass("its.dv14.ErrorPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("pages/dv14_error_page"),this._message=this.lookup("message"),this._title=this.lookup("title"),this._explanation=this.lookup("explanation"),this._img=this.lookup("img"),this._type=this.lookup("type"),this._refreshUrl=this.lookup("refreshUrl"),this._includeRetryButton=this.lookup("includeRetryButton"),this._externalLink=this.lookup("externalLink"),this._hideSearch=this.lookup("hideSearch"),this._hideGlobalList=this.lookup("hideGlobalList"),this._type||(its.dv14.ErrorPage.Types[TabBar.selectedTab.identifier]?this._type=TabBar.selectedTab.identifier:this._type=Device.appIdentifier),this._refreshUrl&&this.subscribe(its.sf14.Events.NETWORK_CHANGE,this._onNetworkChanged.bind(this))},renderDocument:function(){return this._document=this.base(),this._document.isErrorDocument=!0,this._document},render:function(){var e;
this.lookup("navigationBarElement")?e=this.lookup("navigationBarElement"):e=this.renderComponentWithData("navigation_bar",{hideSearch:this._hideSearch,hideGlobalList:this._hideGlobalList,title:this._title}),this._template.replaceTokenWithElement("navigationBar",e),its.isDefinedNonNull(this._img)?(this._template.keepBlock("showImage",!0),this._template.replaceToken("imgSrc",this._img.url),this._template.replaceToken("imgHeight",this._img.height),this._template.replaceToken("imgWidth",this._img.width)):this._type&&this._type!=="stop"&&(this._template.keepBlock("showTypeImage",!0),this._template.replaceToken("imgSrc",its.dv14.ErrorPage.Types[this._type])),this._message&&(this._template.keepBlock("hasMessage",!0),this._template.replaceToken("message",this._message)),this._explanation&&(this._template.keepBlock("hasExplanation",!0),this._template.replaceToken("explanation",this._explanation));
if(this._includeRetryButton){this._template.keepBlock("includeRetryButton",!0);
var t=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.ErrorPage.Retry"),its.sf14.ComponentUtil.ButtonType.THIN,{"class":"error-retry-button"});
this.subscribeToTarget(its.sf14.Events.SELECT,this._retry.bind(this),t.itsId()),this._template.replaceTokenUnescaped("retryButton",t)}if(its.isDefinedNonNull(this._externalLink)){this._template.keepBlock("includeExternalLink",!0);
var n={"data-url":this._externalLink.url,"data-page-target":"external","class":"upgrade-device-link"},r=its.sf14.ComponentUtil.createButton(this,this._externalLink.title,its.sf14.ComponentUtil.ButtonType.LINK,n);
this._template.replaceTokenUnescaped("externalLink",r)}return this._pageElement=this._template.composeAsElement(),this.addDocumentStyles(this._pageElement,{}),this._pageElement},_retry:function(){var e={text:its.sf14.Util.UI.loadingText(),url:this._refreshUrl,fetchServerResponse:!0},t=its.sf14.BaseDocument.renderDocumentWithData("loading_document",e,its.dv14.PageController.getDocumentSize());
this._document.replace(t)},_onNetworkChanged:function(e){e.networkConnectionType.length&&this._retry()},_documentRestoreData:function(){return null}}),its.dv14.ErrorPage._isRetryButtonIncludedForType=function(e){return its.dv14.Util.Client.isAppStore()&&its.sf.Client.isVersion("10.0")&&(e==its.sf.StorePlatform.Kind.MobileApp||e==its.sf.StorePlatform.Kind.MobileAppBundle||e==its.serverData.constants.MZMediaType.MobileSoftware.name)},its.dv14.ErrorPage.showErrorPage=function(e,t,n,r){var i=its.sf14.BaseDocument.renderDocumentWithData("error_page",{type:e,message:n,explanation:r,refreshUrl:t,includeRetryButton:its.dv14.ErrorPage._isRetryButtonIncludedForType(e)},its.dv14.PageController.getDocumentSize()),s=getActiveDocument();
s.replace(i),s.isErrorDocument=!0},its.dv14.ErrorPage.Types={},its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Album]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Artist]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Audiobook]="resource://placeholderAudiobooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Booklet]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Course]="resource://placeholderITunesU",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.EBook]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.EBookApple]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.EBookMeta]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.EBookSeries]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.EBookTextbook]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.MacApp]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Mix]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.MobileApp]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.MobileAppBundle]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Movie]="resource://placeholderMovies",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.MovieBundle]="resource://placeholderMovies",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.MusicVideo]="resource://placeholderMusicVideos",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Podcast]="resource://placeholderPodcasts",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.PodcastEpisode]="resource://placeholderPodcasts",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.RadioStation]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Ringtone]="resource://placeholderTones",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.RingtoneAlbum]="resource://placeholderTones",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.ShortFilm]="resource://placeholderMovies",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Song]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.TheyMix]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Tone]="resource://placeholderTones",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.ToneAlbum]="resource://placeholderTones",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.TvEpisode]="resource://placeholderTVShows",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.TvSeason]="resource://placeholderTVShows",its.dv14.ErrorPage.Types[its.sf.StorePlatform.Kind.Work]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.Audiobooks.name]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.ClassicSoftware.name]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.EBooks.name]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.MacSoftware.name]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.MobileSoftware.name]="resource://placeholderApps",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.Movies.name]="resource://placeholderMovies",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.Music.name]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.MusicVideos.name]="resource://placeholderMusicVideos",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.Podcasts.name]="resource://placeholderPodcasts",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.Ringtones.name]="resource://placeholderTones",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.TVShows.name]="resource://placeholderTVShows",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.iTunesU.name]="resource://placeholderITunesU",its.dv14.ErrorPage.Types["com.apple.MobileStore"]="resource://placeholderMusic",its.dv14.ErrorPage.Types["com.apple.AppStore"]="resource://placeholderApps",its.dv14.ErrorPage.Types["com.apple.iBooks"]="resource://placeholderBooks",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.MOVIES]="resource://placeholderMovies",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.AUDIOBOOKS]="resource://placeholderAudiobooks",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.MUSIC]="resource://placeholderMusic",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.SEARCH]="resource://emptySearch",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.TV]="resource://placeholderTVShows",its.dv14.ErrorPage.Types[its.sf14.PageController.PageTarget.TONES]="resource://placeholderTones",its.dv14.GlobalListsPage=Class.createSubclass("its.dv14.GlobalListsPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.GlobalListsPage"),this._template=its.Templates.get("pages/dv14_global_lists_page"),this.subscribe(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,this._refreshTabContentCallback()),this.subscribe(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE,this._enterWishListEditModeCallback()),this.subscribe(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE,this._exitWishListEditModeCallback()),this.subscribe(its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON,this._updateEditClearButtonCallback()),this.subscribe(its.sf14.Events.ON_APP_RESUME,this._onAppResume.bind(this))},render:function(){return this._pageElement=this._template.composeAsElement(),this._renderNavigationBar(),this._renderTabbedPane(),this.addDocumentStyles(this._pageElement,{isDarkKind:!1}),this._pageElement},onUnload:function(){this.base.apply(this,arguments);
for(var e in this._tabs)this._tabs[e].unload()},suppressRestoreData:function(){return!0},_handleLink:function(e){var t=e.target.getAttribute("data-url");
t&&t.length>0&&modal.clear(),this.base.apply(this,arguments)},_onAppResume:function(){var e=this._tabbedPane.selectedTabId();
this._tabs[e]._exitEditClearMode(),this._reload()},_renderNavigationBar:function(){this._navigationBarTemplate=its.Templates.get("pages/dv14_global_lists_page/navigation_bar"),its.dv14.Util.Client.isAppStore()?this._navigationBarTemplate.replaceToken("title",its.loc("DVX.GlobalLists.WishList.Title")):this._navigationBarTemplate.keepBlock("paletteBlock"),this._navigationBarTemplate.replaceTokenUnescaped("editOrClearButton",its.sf14.ComponentUtil.createButton(this,its.loc("Edit"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left"},this._handleEditOrClearButtonClick.bind(this))),this._navigationBarTemplate.replaceTokenUnescaped("doneButton",its.sf14.ComponentUtil.createButton(this,its.loc("Done"),its.sf14.ComponentUtil.ButtonType.DONE,{"class":"align-right"},this._handleDoneButtonClick.bind(this))),this._navigationElement=this._navigationBarTemplate.composeAsElement(),this.pageElement().replaceTokenWithElement("navigation",this._navigationElement)},_renderTabbedPane:function(){if(!this._tabbedPane){var e={panes:this._panesToShow(),"its.dv14.Pills":{pinStyle:its.dv14.ProductPageUtil.PinStyle.ALONE,maxItems:4,moreLabel:its.loc("More"),pillClass:"tabs"},tabChangedCallBack:this._handleTabClicked.bind(this)};
if(its.dv14.Util.Client.isITunes()){var t=document.createElement("section");
this.pageElement().replaceTokenWithElement("content",t),e.contentRegion=t,this._tabbedPane=this.componentWithData("tabbed_pane",e),this._navigationElement.querySelector("palette").appendChild(this._tabbedPane.render());
var n=its.sf.LocalStorage.getItem("its.dv14.GlobalListsPage.SELECTED_TAB_ID");
n&&this._tabs[n]&&this._tabbedPane.handleTabClicked(n)}else this._tabbedPane=this.componentWithData("tabbed_pane",e),this.pageElement().replaceTokenWithElement("content",this._tabbedPane.render())}},_panesToShow:function(){var e=[];
this._tabs={};
var t=new its.dv14.WishListTab(this);
this._tabs[its.dv14.GlobalListsTab.Tabs.WISH_LIST_TAB_ID]=t,e.push({title:its.loc("DVX.GlobalLists.WishList.Title"),callback:this._renderTab.bind(this),tabId:t.tabId(),preRenderTab:!0});
if(its.dv14.Util.Client.isITunes()){if(its.property("isSiriTagHistoryEnabled")){var n=new its.dv14.SiriTagHistoryTab(this);
this._tabs[its.dv14.GlobalListsTab.Tabs.SIRI_TAG_HISTORY_TAB_ID]=n,e.push({title:its.loc("DV7.GlobalLists.SiriTagHistory.Title"),callback:this._renderTab.bind(this),tabId:n.tabId(),preRenderTab:!0})}if(its.property("isRadioHistoryEnabled")){var r=new its.dv14.RadioHistoryTab(this);
this._tabs[its.dv14.GlobalListsTab.Tabs.RADIO_HISTORY_TAB_ID]=r,e.push({title:its.loc("DV7.GlobalLists.RadioHistory.Title"),callback:this._renderTab.bind(this),tabId:r.tabId(),preRenderTab:!0})}var i=new its.dv14.PreviewHistoryTab(this);
this._tabs[its.dv14.GlobalListsTab.Tabs.PREVIEW_HISTORY_TAB_ID]=i,e.push({title:its.loc("DVX.GlobalLists.PreviewHistory.Title"),callback:this._renderTab.bind(this),tabId:i.tabId(),preRenderTab:!0})}return this._setTabData(),e},_setTabData:function(){this._tabs[its.dv14.GlobalListsTab.Tabs.WISH_LIST_TAB_ID].setTabData(this.pageData().wishlistBuckets),its.dv14.Util.Client.isITunes()&&(this._tabs[its.dv14.GlobalListsTab.Tabs.SIRI_TAG_HISTORY_TAB_ID]&&this._tabs[its.dv14.GlobalListsTab.Tabs.SIRI_TAG_HISTORY_TAB_ID].setTabData(this.pageData().siriTagHistoryBuckets),this._tabs[its.dv14.GlobalListsTab.Tabs.RADIO_HISTORY_TAB_ID]&&this._tabs[its.dv14.GlobalListsTab.Tabs.RADIO_HISTORY_TAB_ID].setTabData(this.pageData().radioHistoryBuckets),this._tabs[its.dv14.GlobalListsTab.Tabs.PREVIEW_HISTORY_TAB_ID].setTabData(this.pageData().previewHistoryBuckets))},pageData:function(){return this.data.pageData},pageElement:function(){return this._pageElement},id:function(){return this.pageData().id},_refreshTabContentCallback:function(){return this._refreshTabContent||(this._refreshTabContent=function(e){e.refetchData?this._reload():this._tabbedPane.refreshTab(e.tabId)}.bind(this)),this._refreshTabContent},_reload:function(){its.sf14.Util.getJSON(its.serverData.constants.viewGlobalLists,function(e){this._resetPageData(e.pageData),this._tabbedPane.refreshAllTabs()}.bind(this))},_resetPageData:function(e){this.data.pageData=e,this._setTabData()},_renderTab:function(e,t){var n=this._tabs[e].render();
t.appendChild(n)},_handleTabClicked:function(e){its.sf.LocalStorage.setItem("its.dv14.GlobalListsPage.SELECTED_TAB_ID",e);
var t=this._navigationElement.querySelector(".align-left");
t.textContent=this._tabs[e].editClearButtonLabel();
var n=!this._tabs[e].hasContent();
n?t.setAttribute("disabled","true"):t.setAttribute("disabled","false")},_handleDoneButtonClick:function(){var e=this._tabbedPane.selectedTabId();
this._tabs[e].handleDoneButtonClick()},_handleEditOrClearButtonClick:function(e){var t=this._tabbedPane.selectedTabId();
this._tabs[t].handleEditClearButtonClick(e)},_enterWishListEditModeCallback:function(){return this._enterWishListEditMode||(this._enterWishListEditMode=function(){var e=this._navigationElement.querySelector(".align-left");
e.textContent=its.loc("Delete"),e.setAttribute("disabled","true");
var t=this._navigationElement.querySelector(".align-right");
t.textContent=its.loc("Cancel")}.bind(this)),this._enterWishListEditMode},_exitWishListEditModeCallback:function(){return this._exitWishListEditMode||(this._exitWishListEditMode=function(){var e=this._tabbedPane.selectedTabId(),t=this._navigationElement.querySelector(".align-left");
t.textContent=this._tabs[e].editClearButtonLabel(),t.setAttribute("disabled","false");
var n=this._navigationElement.querySelector(".align-right");
n.textContent=its.loc("Done")}.bind(this)),this._exitWishListEditMode},_updateEditClearButtonCallback:function(){return this._updateEditClearButton||(this._updateEditClearButton=function(e){var t=this._navigationElement.querySelector(".align-left");
e.buttonLabel&&(t.textContent=e.buttonLabel);
var n=e.isDisabled;
if(!its.isDefined(n)){var r=this._tabbedPane.selectedTabId();
n=!this._tabs[r].hasContent()}n?t.setAttribute("disabled","true"):t.setAttribute("disabled","false")}.bind(this)),this._updateEditClearButton},isTokenExpired:function(){return this.pageData().tokenExpired}}),its.dv14.GlobalListsTab=Class.create("its.dv14.GlobalListsTab",{initialize:function(e){this._globalListsPage=e,this._gridElements=[]},render:function(){if(this.hasContent()){its.notifications.publish(its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON,{});
var e={artworkProfile:"global_lists",detailsGenerator:its.dv14.SmallLockup.DefaultDetailsGenerator.List.GlobalList};
this.tabId()==its.dv14.GlobalListsTab.Tabs.WISH_LIST_TAB_ID&&(e.actions=[its.dv14.SmallLockup.Actions.DELETE],e.isEditable=!0);
var t=its.Templates.get("pages/dv14_global_lists_page/bucketed_lists"),n=t.getBlock("bucketedListLoop");
for(var r=0;
r<this._buckets.length;
r++){var i="";
its.dv14.Util.Client.isITunes()&&(i=this._buckets[r].name);
var s={contentIds:this._buckets[r].ids.slice(0),title:i,scrollableCellControllerClass:its.sf14.ScrollableCellController.List,"its.dv14.SmallLockup":e,maxCount:20,stdQualityMap:this._buckets[r].stdQuality};
if(this.tabId()==its.dv14.GlobalListsTab.Tabs.SIRI_TAG_HISTORY_TAB_ID){var o=its.serverData.constants.GlobalLists.shazamAffiliateToken;
o&&o.length>0&&(s["its.dv14.BuyButton"]={siriTabAffiliateToken:o})}var u=this._globalListsPage.renderComponentWithData("grid",s);
this._gridElements.push(u),n.replaceTokenWithElement("bucketedList",u),n.next()}return t.composeAsElement()}return this._emptyContent()},unload:function(){this._buckets=null,this._clearHistoryDialogDocument=null},setTabData:function(e){this._buckets=this.getHistoryBuckets(e)},_emptyContent:function(){its.notifications.publish(its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON,{});
if(this._globalListsPage.isTokenExpired()||!its.sf.Client.dsId()){var e=its.Templates.get("pages/dv14_global_lists_page/global_lists_tab/sing_in");
e.replaceToken("title",this.title()),e.replaceToken("noSignInMessage",this.signInMessage());
var t=its.sf14.ComponentUtil.createButton(this._globalListsPage,its.loc("SignIn"),null,{},this.signInButtonSelectHandler.bind(this),!0);
return e.replaceTokenWithElement("signInButton",t),e.composeAsElement()}var n=its.Templates.get("pages/dv14_global_lists_page/global_lists_tab/no_content");
return n.replaceToken("title",this.title()),n.replaceToken("noContentMessage",this.noContentMessage()),n.composeAsElement()},signInButtonSelectHandler:function(){itms.authenticate({},this.signInCallback.bind(this))},signInCallback:function(){its.sf.Client.dsId()&&its.notifications.publish(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,{tabId:this.tabId(),refetchData:!0})},handleEditClearButtonClick:function(){var e=this.confirmationDialogData(),t={type:"actionSheet",positive:{text:e.confirmationButton,callback:this._clearHistoryCallback.bind(this)},negative:{text:its.loc("Cancel")}};
its.sf.Platform.iPad()&&(t.type="error",t.title=e.title,t.description=e.message),this._clearHistoryDialogDocument=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",t,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
var n={};
n.type="dialog",its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._clearHistoryDialogDocument,options:n,pageTarget:its.sf14.PageController.PageTarget.MODAL,shouldClearModal:!1})},_exitEditClearMode:function(){getActiveDocument()==this._clearHistoryDialogDocument&&modal.popDocument()},hasContent:function(){return this._buckets&&this._buckets.length>0},_clearHistoryCallback:function(){this.clearHistory()},getHistoryBuckets:function(e){if(its.dv14.Util.Client.isAppStore()&&e&&e.length>1){var t=[],n={ids:[],stdQuality:{}};
for(var r=0;
r<e.length;
r++){its.array.pushAll(n.ids,e[r].ids);
for(var i in e[r].stdQuality)n.stdQuality[i]=e[r].stdQuality[i]}return t.push(n),t}return e},handleDoneButtonClick:function(){modal.popDocument()},title:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.title()"},signInMessage:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.signInMessage()"},noContentMessage:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.noContentMessage()"},tabId:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.tabId()"},editClearButtonLabel:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.editClearButtonLabel()"},clearHistory:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.clearHistory()"},confirmationDialogData:function(){throw"Abstract method: its.dvx.GlobalListsTab.prototype.confirmationDialogData()"}}),its.dv14.GlobalListsTab.Tabs={WISH_LIST_TAB_ID:"its.dv14.GlobalListsTab.Tabs.WishListTab",SIRI_TAG_HISTORY_TAB_ID:"its.dv14.GlobalListsTab.Tabs.SiriTagHistoryTab",RADIO_HISTORY_TAB_ID:"its.dv14.GlobalListsTab.Tabs.RadioHistoryTab",PREVIEW_HISTORY_TAB_ID:"its.dv14.GlobalListsTab.Tabs.PreviewHistoryTab",ALL_TABS:"its.dv14.GlobalListsTab.Tabs.ALL_TABS"},its.dv14.GlobalListsTab.Events={REFRESH_TAB_CONTENT:"its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT",UPDATE_EDIT_CLEAR_BUTTON:"its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON"},its.dv14.WishListTab=Class.createSubclass("its.dv14.WishListTab",its.dv14.GlobalListsTab,{initialize:function(e){this.base.apply(this,arguments),e.subscribe(its.sf.wishlist.manager.Events.REMOVE_ITEMS,this._removeItemsCallback()),e.subscribe(its.dv14.SmallLockup.Actions.Events.DELETE_SELECTED,this._handleDeleteListItemCallback()),e.subscribe(its.dv14.SmallLockup.Events.SELECTION_CHANGED,this._editModeItemSelectionToggeledCallback()),this._isListBucketed=its.dv14.Util.Client.isAppStore()?!1:!0,this._lockupsToRemove=[],this._isEditMode=!1,this._itemsToDelete=0},unload:function(){this._buckets=null,this._lockupsToRemove=[],this._isEditMode=!1,this._itemsToDelete=0},title:function(){return its.loc("DVX.GlobalLists.WishList.Title")},signInMessage:function(){return its.loc("DVX.GlobalLists.WishList.SignIn")},noContentMessage:function(){return its.loc("DVX.GlobalLists.WishList.Empty")},tabId:function(){return its.dv14.GlobalListsTab.Tabs.WISH_LIST_TAB_ID},editClearButtonLabel:function(){return its.loc("Edit")},handleEditClearButtonClick:function(e){if(!this._isEditMode){this._isEditMode=!0;
for(var t=0;
t<this._gridElements.length;
t++)this._gridElements[t].setAttribute("editMode",this._isEditMode);
its.notifications.publish(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE)}else{this._exitEditMode(),its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE);
var n=[];
for(var r in this._lockupsToRemove)n.push(r);
n.length>0&&this._removeItems(n)}},_exitEditClearMode:function(){this._isEditMode&&(this._lockupsToRemove=[],this._exitEditMode())},handleDoneButtonClick:function(){this._isEditMode?(this._lockupsToRemove=[],this._exitEditMode()):modal.popDocument()},_exitEditMode:function(){this._isEditMode=!1,this._itemsToDelete=0;
for(var e=0;
e<this._gridElements.length;
e++)this._gridElements[e].setAttribute("editMode",this._isEditMode);
its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE)},_editModeItemSelectionToggeledCallback:function(){return this._editModeItemSelectionToggeled||(this._editModeItemSelectionToggeled=function(e){var t=e.target,n=t.getAttribute("data-content-id"),r=t.querySelector("input"),i=r.getAttribute("selected");
i=="true"&&!this._lockupsToRemove[n]?(this._lockupsToRemove[n]=t,this._itemsToDelete++):this._lockupsToRemove[n]&&(this._lockupsToRemove[n]=null,this._itemsToDelete--);
var s;
this._itemsToDelete>0?s=its.loc("DI6.GlobalLists.Wishlist.DeleteWithCount",{count:this._itemsToDelete}):s=its.loc("Delete"),its.notifications.publish(its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON,{buttonLabel:s,isDisabled:this._itemsToDelete==0})}.bind(this)),this._editModeItemSelectionToggeled},_handleDeleteListItemCallback:function(){return this._handleDeleteListItem||(this._handleDeleteListItem=function(e){var t=e.target,n=t.getAttribute("data-content-id");
this._lockupsToRemove[n]||(this._lockupsToRemove[n]=t,this._removeItems([n]))}.bind(this)),this._handleDeleteListItem},_removeItems:function(e){its.sf.wishlist.manager.removeItems(e)},_removeItemsCallback:function(){return this.__removeItemsCallback||(this.__removeItemsCallback=function(){var e,t,n;
for(var r in this._lockupsToRemove){e=this._lockupsToRemove[r];
if(e&&e.parentNode){this._removeItemFromBucketedList(r);
if(this._isListBucketed){t=e.parentNode,e.remove();
if(t.childElementCount==0){n=t.parentNode;
var i=this._gridElements.indexOf(n);
i>=0&&this._gridElements.splice(i,1),n.remove()}}else e.remove()}}this._lockupsToRemove=[],this.hasContent()||its.notifications.publish(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,{tabId:this.tabId(),refetchData:!1})}.bind(this)),this.__removeItemsCallback},_removeItemFromBucketedList:function(e){var t;
for(var n=0;
n<this._buckets.length;
n++){t=this._buckets[n];
var r=parseInt(e);
if(r){var i=t.ids.indexOf(r);
if(i>=0){t.ids.splice(i,1),t.ids.length==0&&this._buckets.splice(n,1);
return}}}}}),its.dv14.SiriTagHistoryTab=Class.createSubclass("its.dv14.SiriTagHistoryTab",its.dv14.GlobalListsTab,{title:function(){return its.loc("DV7.GlobalLists.SiriTagHistory.Title")},signInMessage:function(){return its.loc("DV7.GlobalLists.SiriTagHistory.SignIn")},noContentMessage:function(){return its.loc("DV7.GlobalLists.SiriTagHistory.Empty")},tabId:function(){return its.dv14.GlobalListsTab.Tabs.SIRI_TAG_HISTORY_TAB_ID},editClearButtonLabel:function(){return its.loc("Clear")},clearHistory:function(){its.sf.history.manager.SiriTagHistory.clearHistory(function(){this._buckets=null,its.notifications.publish(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,{tabId:this.tabId(),refetchData:!1})}.bind(this))},confirmationDialogData:function(){return{title:its.loc("DV7.GlobalLists.SiriTagHistory.ConfirmationDialog.Title"),message:its.loc("DV7.GlobalLists.SiriTagHistory.ConfirmationDialog.Message"),confirmationButton:its.loc("DV7.GlobalLists.SiriTagHistory.ConfirmationDialog.Button")}}}),its.dv14.RadioHistoryTab=Class.createSubclass("its.dv14.RadioHistoryTab",its.dv14.GlobalListsTab,{title:function(){return its.loc("DV7.GlobalLists.RadioHistory.Title")},signInMessage:function(){return its.loc("DV7.GlobalLists.RadioHistory.SignIn")},noContentMessage:function(){return its.loc("DV7.GlobalLists.RadioHistory.Empty")},tabId:function(){return its.dv14.GlobalListsTab.Tabs.RADIO_HISTORY_TAB_ID},editClearButtonLabel:function(){return its.loc("Clear")},clearHistory:function(){its.sf.history.manager.radio.clearHistory(function(){this._buckets=null,its.notifications.publish(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,{tabId:this.tabId(),refetchData:!1})}.bind(this))},confirmationDialogData:function(){return{title:its.loc("DV7.GlobalLists.RadioHistory.ConfirmationDialog.Title"),message:its.loc("DV7.GlobalLists.RadioHistory.ConfirmationDialog.Message"),confirmationButton:its.loc("DV7.GlobalLists.RadioHistory.ConfirmationDialog.Button")}}}),its.dv14.PreviewHistoryTab=Class.createSubclass("its.dv14.PreviewHistoryTab",its.dv14.GlobalListsTab,{title:function(){return its.loc("DVX.GlobalLists.PreviewHistory.Title")},signInMessage:function(){return its.loc("DVX.GlobalLists.PreviewHistory.SignIn")},noContentMessage:function(){return its.loc("DVX.GlobalLists.PreviewHistory.Empty")},tabId:function(){return its.dv14.GlobalListsTab.Tabs.PREVIEW_HISTORY_TAB_ID},editClearButtonLabel:function(){return its.loc("Clear")},clearHistory:function(){its.sf.history.manager.preview.clearHistory(function(){this._buckets=null,its.notifications.publish(its.dv14.GlobalListsTab.Events.REFRESH_TAB_CONTENT,{tabId:this.tabId(),refetchData:!1})}.bind(this))},confirmationDialogData:function(){return{title:its.loc("DVX.GlobalLists.PreviewHistory.ConfirmationDialog.Title"),message:its.loc("DVX.GlobalLists.PreviewHistory.ConfirmationDialog.Message"),confirmationButton:its.loc("DVX.GlobalLists.PreviewHistory.ConfirmationDialog.Button")}}}),its.dv14.GroupingPage=Class.createSubclass("its.dv14.GroupingPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.GroupingPage"),this._template=its.Templates.get("pages/dv14_grouping_page");
var e=its.Templates.get("pages/dv14_grouping_loading");
e.replaceToken("text",its.sf14.Util.UI.loadingText()),this.loadingTemplate=e.composeAsElement(),this._currentTabId=null,this._currentCategoryKey=its.dv14.CategorySheet.createCategoryKey(this.pageData().categoryList.groupingId,this.pageData().categoryList.genreId),this._rootMt=this.pageData().mt;
var t=this.pageData();
this._usesSegmentedControl=t.segmentedControl&&(!its.dv14.Util.Client.isIBooks()||!!(t.categoryList.children&&t.categoryList.children.length>0)),this._currentTabId=its.dv14.GroupingPage.segmentTabIds.grouping,this._currentData={},this._currentData[its.dv14.GroupingPage.segmentTabIds.grouping]=Class.shallowClone(this.data),this._currentData[its.dv14.GroupingPage.segmentTabIds.charts]=null,this._loadingState=!1,this.currentCategory={},this._categoryChangeEventName=its.dv14.CategorySheet.Events.GROUPING_CATEGORY_CHANGED_EVENT+":"+this.rootComponent.itsId(),this.subscribe(this._categoryChangeEventName,this._handleCategoryChange.bind(this)),this.renderAlternateDisplay=!this.lookup("isRootDocument")||its.string.compareNumerically(its.sf.Client.version(),"8.0.1")>=0&&this._getSelectedTabIndex()>2,this._hasGroupingPageLoadedOnce=!1,this._shouldPublishPageAppearEvent=!0},pageData:function(){return this.data.pageData},pageElement:function(){return this._pageElement},id:function(){return this.pageData().id},restoreData:function(){return{title:this.tabRoot().name}},featuredContentStructure:function(){return this.pageData().fcStructure.model},tabRoot:function(){return this.featuredContentStructure().children[0]},useTabbedPage:function(){return this._usesSegmentedControl},render:function(){its.dv14.Util.UI.getShowIdsForEpisodeLockups.call(this);
var e=its.Templates.get("pages/dv14_grouping_page");
this._pageElement=e.composeAsElement(),this._tabbedPaneContent=document.createElement("section"),this._pageElement.replaceTokenWithElement("contentSection",this._tabbedPaneContent),this.rootStackTemplate=this._pageElement.querySelector("stackTemplate");
var t=this.pageData(),n=TabBar.selectedTab.identifier==="featured"&&its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0,r=TabBar.selectedTab.identifier==="categories"&&its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0,i=!t.categoryList.children||t.categoryList.children.length==0||n||r||its.dv14.Util.Client.isVoyager();
its.dv14.Util.Client.isBridge()&&!its.serverData.properties["MZFeatureEnabler.isWatchCategoriesEnabled"]&&(i=!0);
if(this.useTabbedPage()){var s=t.segmentedControl;
s&&(this._segmentedControl=s);
var o=s.segments;
this.tabsData={};
for(var u=0;
u<o.length;
u++)tabId=o[u].pageComponent+"_"+u,this.tabsData[tabId]={},this.tabsData[tabId].url=o[u].url}var a={categoryList:t.categoryList,hideGenreButton:i,tabbedPaneElement:this.useTabbedPage()?this._renderTabbedPane(null,this._currentTabId,t):null,renderAlternateDisplay:this.renderAlternateDisplay,onCategoryChangedEventType:this._categoryChangeEventName,groupingPageMetricsBase:t.metricsBase};
t.isAgeBandGrouping?a.title=t.ageBandGroupingTitle:a.title=t.categoryList.name,a.navigationTitle=a.title;
if(!this.useTabbedPage()){var f=this._renderGroupingStackElement(t);
this._tabbedPaneContent.appendChild(f)}return this._navigationElement=this.renderComponentWithData("extended_navigation_bar",a),this._pageTitle=this._navigationElement.querySelector("title"),this._pageElement.replaceTokenWithElement("navigation",this._navigationElement),this.addDocumentStyles(this._pageElement,{uber:t.uber,mt:t.mt}),this._performFinanceActions(),this._pageElement},onBuyRequested:function(e){if(e.options.documentUrl==this.documentUrl()){var t=e.options.id;
this._handleAskToBuy(this.pageElement(),t)}},onOrientationChange:function(e){var t={page:this._pageElement,orientation:e.newOrientation};
its.notifications.publish("grouping_page:orientationChange",t)},shouldPublishPageAppearEvent:function(){return this._shouldPublishPageAppearEvent},_getSelectedTabIndex:function(){for(var e=0,t=TabBar.tabs.length;
e<t;
e++)if(TabBar.tabs[e]===TabBar.selectedTab)return e},_renderGroupingStackElement:function(e){return e.groupingPageComponent=!0,this.renderComponentWithData("grouping_mainstack",e)},_renderTabbedPane:function(e,t,n){var r=[],i,s,o=n.segmentedControl||this._segmentedControl,u=o.segments;
this.currentRenderedTabs={};
for(var a=0;
a<u.length;
a++)i=u[a].pageComponent+"_"+a,its.dv14.Util.Client.isIBooks()||(this.tabsData[i].url=u[a].url),!t&&a==0&&(this._currentTabId=i),s={title:u[a].title,callback:this._renderSegmentTab.bind(this),tabId:i},r.push(s),this.currentRenderedTabs[i]={url:u[a].url};
var f={panes:r,"its.dv14.Pills":{pinStyle:its.dv14.ProductPageUtil.PinStyle.ALONE,maxItems:4,moreLabel:its.loc("More"),pillClass:"tabs"},alwaysForceRefeshTabs:!0,activeTabId:t,contentRegion:this._tabbedPaneContent},l=this.renderComponentWithData("tabbed_pane",f);
return l.setAttribute("class","grouping-tabbed-pane"),l},_renderSegmentTab:function(e,t){var n;
e!=this._currentTabId&&(n=!0),this._currentTabId=e;
var r,i=this._currentCategoryKey;
this._loadingState||(this._pageElement.replaceChild(this.loadingTemplate,this.rootStackTemplate),this._loadingState=!0);
var s=function(s,o){o||(o=s.xhr,s.xhr=null),this.storePlatform.cacheStorePlatformDataForProfiles(s.storePlatformData);
var u,a;
if(!its.dv14.Util.Client.isIBooks()&&e==its.dv14.GroupingPage.segmentTabIds.charts){var f=this._getTopChartsSegmentData(s);
u=f.pageData,a=f.url,r=this._renderChartsElement(f.pageData.topCharts)}else u=s.pageData,a=s.pageData.url,r=this._renderGroupingStackElement(s.pageData);
u.categoryList.children&&!this.tabsData[e].categoryList&&(this.tabsData[e].categoryList=u.categoryList);
if(this._navigationElement&&its.dv14.Util.Client.isIBooks()){var l=this._navigationElement.querySelector("navigationTitle");
l!=null&&u.categoryList.name!=null&&(l.textContent=u.categoryList.name)}var c=e==this._currentTabId&&i==this._currentCategoryKey;
c&&(this._pageElement.replaceChild(this.rootStackTemplate,this.loadingTemplate),this._loadingState=!1,t.appendChild(r),this._currentCategoryKey=its.dv14.CategorySheet.createCategoryKey(u.categoryList.groupingId,u.categoryList.genreId),its.dv14.Util.Client.isIBooks()&&this._hasGroupingPageLoadedOnce&&n&&its.notifications.publish(its.dv14.GroupingPage.Events.RERENDER_CATEGORIES,{categoryList:this.tabsData[e].categoryList,selectedCategory:this.currentCategory[e]})),this._hasGroupingPageLoadedOnce&&this.handlePageDataChange(u,a,o),this._hasGroupingPageLoadedOnce=!0}.bind(this),o=function(){this._loadingState&&(this._pageElement.replaceChild(this.rootStackTemplate,this.loadingTemplate),this._loadingState=!1)}.bind(this);
if(this._currentData[e])s(this._currentData[e]);
else{var u=this.tabsData[e].url;
its.sf14.Util.getJSON(u,s,o)}},_renderChartsElement:function(e){var t=its.Templates.get("pages/dv14_charts"),n=t.composeAsElement(),r=document.createDocumentFragment();
if(!its.dv14.ChartsUtil.hasAnyChartContent(e))r.appendChild(its.dv14.ChartsUtil.createNoContentElement());
else if(e.length===1){var i={showOrdinal:!0,contentIds:e[0].adamIds},s=this.renderComponentWithData("column_list",i);
r.appendChild(s)}else for(var o=0;
o<e.length;
o++){var u={pageTitle:e[o].title,contentIds:e[o].adamIds,url:e[o].seeAllUrl,pageData:{uber:this.pageData().uber,mt:this.pageData().mt}},a=function(e){var t=function(t){this._handleTopChartSwooshSelected(t,e)};
return t}(u),f={title:e[o].title,contentIds:its.dv14.GroupingPage.trimSwooshIds(e[o].adamIds,!0),showOrdinal:!0,"its.dv14.SmallLockup":{titleOrdinal:!0},link:{label:its.loc("See All"),url:e[o].seeAllUrl,callback:a.bind(this)}};
if(e[o].kinds.song||e[o].kinds.tvEpisode)f.additionalCssClasses="shelf-with-rows",f.type=its.dv14.Swoosh.Type.LIST,f.scrollableCellControllerClass=its.sf14.ScrollableCellController.List.Chart.TrackSwoosh;
var l=this.renderComponentWithData("swoosh",f);
r.appendChild(l)}return n.replaceTokenWithElement("charts",r),n},_handleTopChartSwooshSelected:function(e,t){its.sf14.Metrics.Events.PageRender.isAvailable()&&its.sf14.Metrics.Events.PageRender.updateInteractionTime();
var n=its.sf14.BaseDocument.renderDocumentWithData("top_charts_see_all_page",t,its.dv14.PageController.getDocumentSize(its.dv14.GroupingPage.MediaType[t.pageData.mt]));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:n,pageTarget:its.dv14.GroupingPage.MediaType[t.pageData.mt]})},_handleCategoryChange:function(e){its.sf.Platform.iPhone()&&(this._shouldPublishPageAppearEvent=!1);
if(this._currentCategoryKey!=e.categoryKey){this._currentCategoryKey=e.categoryKey;
var t=this._navigationElement.querySelector("navigationTitle");
t.textContent=e.pageTitle,this._pageTitle.textContent=e.pageTitle,this._loadingState||(this._pageElement.replaceChild(this.loadingTemplate,this.rootStackTemplate),this._loadingState=!0);
var n=this._currentTabId==its.dv14.GroupingPage.segmentTabIds.charts,r=n&&!its.dv14.Util.Client.isIBooks()?e.chartUrl:e.url,i=this._currentTabId,s=this._currentCategoryKey,o=function(e,t){if(e){var o=null;
this.storePlatform.cacheStorePlatformDataForProfiles(e.storePlatformData);
if(n&&!its.dv14.Util.Client.isIBooks()){var u=this._getTopChartsSegmentData(e);
o=this._renderChartsElement(u.pageData.topCharts)}else o=this._renderGroupingStackElement(e.pageData);
this.addDocumentStyles(this._pageElement,{uber:e.pageData.uber,mt:e.pageData.mt});
var a=i==this._currentTabId&&s==this._currentCategoryKey;
if(a){this._pageElement.replaceChild(this.rootStackTemplate,this.loadingTemplate),this._loadingState=!1;
if(this.useTabbedPage())e.xhr=t,i===its.dv14.GroupingPage.segmentTabIds.grouping?(this._currentData[its.dv14.GroupingPage.segmentTabIds.grouping]=e,its.dv14.Util.Client.isIBooks()||(this._currentData[its.dv14.GroupingPage.segmentTabIds.charts]=null)):(its.dv14.Util.Client.isIBooks()||(this._currentData[its.dv14.GroupingPage.segmentTabIds.grouping]=null),this._currentData[its.dv14.GroupingPage.segmentTabIds.charts]=e),this.currentCategory[i]=e.pageData.categoryList,this._renderTabbedPane(o,i,e.pageData);
else{var f=document.createElement("section");
f.appendChild(o),this._tabbedPaneContent.parentNode.replaceChild(f,this._tabbedPaneContent),this._tabbedPaneContent=f,this.handlePageDataChange(e.pageData,r,t)}}}else this._loadingState=!1;
this._shouldPublishPageAppearEvent=!0}.bind(this),u=function(){this._loadingState&&(this._pageElement.replaceChild(this.rootStackTemplate,this.loadingTemplate),this._loadingState=!1),this._shouldPublishPageAppearEvent=!0}.bind(this);
its.sf14.Util.getJSON(r,o,u)}},_getTopChartsSegmentData:function(e){for(var t in e.pageData.segmentedControl.segments){var n=e.pageData.segmentedControl.segments[t];
if(n&&n.pageComponent==its.dv14.GroupingPage.segmentTabIds.charts||n.pageComponent+"_"+t==its.dv14.GroupingPage.segmentTabIds.charts)return n}return null},_performFinanceActions:function(){var e=this.documentUrl(),t=its.url.parseQueryParams(e);
for(var n in its.dv14.GroupingPage.FinanceActions){var r=its.dv14.GroupingPage.FinanceActions[n];
if(t[r.queryParam]){var i=its.sf.Platform.iPad()?{type:"overlay"}:{};
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:r.url,options:i,pageTarget:its.sf14.PageController.PageTarget.MODAL})}}var s=t.overlay;
if(s){var o=t.code;
s==its.dv14.GroupingPage.FinanceActions.PREORDER_CHECK.queryParam&&this._checkForPreorderDownloads(o)}},_checkForPreorderDownloads:function(e){var t=its.url.appendUrlParameter(its.dv14.GroupingPage.FinanceActions.PREORDER_CHECK.url,"cpoKey",e);
its.sf14.Util.fetchServerGetResponse(t,function(e){its.dv14.PlistUtil.handlePlist(e,null,this.documentUrl())})}}),its.dv14.GroupingPage.trimSwooshIds=function(e,t){if(t)var n=its.serverData.properties["its.dv14.GroupingPage.maxItemsPerChartSwoosh"]?its.serverData.properties["its.dv14.GroupingPage.maxItemsPerChartSwoosh"]:36;
else its.dv14.Util.UI.shouldToggleSplitView()?n=its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]?its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]:16:n=its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]?its.serverData.properties["its.dv14.GroupingPage.maxItemsPerSwoosh"]:16;
var r=e.slice();
return r.length>n&&(r=r.slice(0,n)),r},its.dv14.Util.Client.isIBooks()?its.dv14.GroupingPage.segmentTabIds={grouping:"grouping_page_0",charts:"grouping_page_1"}:its.dv14.GroupingPage.segmentTabIds={grouping:"grouping_page_0",charts:"charts_page_1"},its.dv14.GroupingPage.MediaType={1:its.sf14.PageController.PageTarget.MUSIC,4:its.sf14.PageController.PageTarget.TV,6:its.sf14.PageController.PageTarget.MOVIES,3:its.sf14.PageController.PageTarget.AUDIOBOOKS,9:its.sf14.PageController.PageTarget.TONES},its.dv14.GroupingPage.FCKinds={just_for_you_marker:13,just_for_you_marker_gran_torino:179,cma_marker:251,cms_marker:252,cma_cms_marker:253,header:257,flowcase:258,swoosh_sun:260,sliding_brickrow:261,list_box_stack:263,main_stack_sun:256,new_from_artists_marker:309,recommendations_app_marker:311,recommendations_game_marker:312,recommendations_movie_marker:313,recommendations_tvshow_marker:314,recommendations_book_marker_1:381,recommendations_book_marker_2:412,list_box:265,quick_links_stack:266,genres_stack:267,tab_set:271,currentlyon_swoosh:55,track_swoosh:268,hListBox:300,listBoxSection:301,radio_marker:303,appTrailerIPad:304,appTrailerIPhone:305,mso_flowcase_marker:411,mso_brick_marker:435},its.dv14.GroupingPage.FCKinds.PopularitySwooshes={song:14,software:117,ipad_software:195,paid_software:122,paid_ipad_software:197,free_software:118,free_ipad_software:194,free_message_apps:395,paid_message_apps:396,grossing_message_apps:397,free_ipad_message_apps:398,paid_ipad_message_apps:399,grossing_ipad_message_apps:400},its.dv14.GroupingPage.FCKinds.PopularitySwooshes.Lookup=its.reflect.invert(its.dv14.GroupingPage.FCKinds.PopularitySwooshes),its.dv14.GroupingPage.Events={RERENDER_CATEGORIES:"its.dv14.GroupingPage.Events.RERENDER_CATEGORIES"},its.dv14.GroupingPage.FinanceActions={DISNEY:{queryParam:"accessToken",url:its.serverData.constants.showAccountLinkingLandingPageUrl},ITUNES_MATCH:{queryParam:"sagawelcome",url:its.serverData.constants.showSageWelcomePageUrl},PREORDER_CHECK:{queryParam:"checkpreorders",url:its.serverData.constants.checkForPreordersUrl}},its.dv14.MacAppPage=Class.createSubclass("its.dv14.MacAppPage",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this.contentId=this.pageData.id;
if(!this.contentId)throw console.log("No contentId. this:",this),"No contentId";
this.template=its.Templates.get("pages/dv14_unsupported_atb_product_page")},render:function(){this.product=this.storePlatform.getCachedData(this.contentId);
var e={navigationTitle:this.product.name,product:this.product},t=this.renderComponentWithData("navigation_bar",e);
this.template.replaceTokenWithElement("navigationBar",t),its.App.ParentalRequestData.prompt&&this.template.replaceToken("prompt",its.App.ParentalRequestData.prompt);
var n=this.renderComponentWithData("artwork",{artworkUrls:this.product.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,null),alt:this.product.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this.product.kind)]});
return this.template.replaceTokenWithElement("artwork",n),this.template.replaceTokenWithElement("title",this._renderTitle()),this.template.replaceTokenWithElement("subtitle",its.sf14.ComponentUtil.createText(this,this.product.artistName,{type:its.sf14.ComponentUtil.TextType.SUBTITLE},!0)),this.product.hasInAppPurchases&&this.template.replaceTokenWithElement("notice",its.sf14.ComponentUtil.createText(this,its.loc("Software.HasAddOns"),null,!0)),this.template.replaceTokenWithElement("description",its.sf14.ComponentUtil.createText(this,its.loc("SF.AskToBuy.LearnMoreText.desktopApp"),{type:its.sf14.ComponentUtil.TextType.DESCRIPTION,attributes:{maxLines:0}},!0)),this.template.replaceTokenWithElement("details",this._renderDetailsTab()),this._pageElement=this.template.composeAsElement(),this._pageElement},_renderTitle:function(){var e=[],t=its.sf.ContentRatingsManager.create(this.product.contentRatingsBySystem);
if(t){var n=t.ratingForAppsApple();
n&&e.push(its.dv14.BadgeUtil.createBadge({name:n.rating.name,classname:"badge-for-app-rating",textOnly:!0},!0));
var r=t.ratingsOtherThanAppsApple();
r.forEach(function(t){e.push(its.dv14.BadgeUtil.AppRatings.badge(t,!0))})}return its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e},!0)},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_software_page/details_tab");
this.pageData.addOns&&this.pageData.addOns.length>0&&(gridTemplate=its.Templates.get("pages/dv14_software_page/grid_top"),its.sf.Platform.iPad()?(gridTemplate.replaceTokenUnescaped("expand",this._createInAppPurchasesExpand()),template=its.Templates.get("pages/dv14_software_page/link_item_expand"),template.replaceToken("title",its.loc("InAppPurchases")),template.replaceTokenUnescaped("link",its.sf14.ComponentUtil.createButton(this,its.loc("SF.ShowInAppPurchases"),its.sf14.ComponentUtil.ButtonType.TEXT_ONLY,{"class":"expand-button"},function(e){e.target.parentNode.parentNode.setAttribute("class","grid-full no-padding"),this.pageElement.querySelector("#inapp").setAttribute("open","true"),e.target.parentNode.removeChild(e.target)}.bind(this))),markup=template.compose()):(template=its.Templates.get("pages/dv14_software_page/link_item"),template.replaceToken("title",its.loc("InAppPurchases")),markup=template.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createInAppPurchasesDoc()})}.bind(this),markup.itsId())),gridTemplate.replaceTokenUnescaped("item",markup),n.replaceTokenUnescaped("inAppPurchases",gridTemplate.compose()));
var r=this.pageData.versionHistory;
if(r&&r.length>0){gridTemplate=its.Templates.get("pages/dv14_software_page/grid_top"),its.sf.Platform.iPad()?(gridTemplate.replaceTokenUnescaped("expand",this._createVersionHistoryExpand()),template=its.Templates.get("pages/dv14_software_page/link_item_expand"),template.replaceToken("title",its.loc("SF.VersionHistory")),template.replaceTokenUnescaped("link",its.sf14.ComponentUtil.createButton(this,its.loc("SF.ShowVersionHistory"),its.sf14.ComponentUtil.ButtonType.TEXT_ONLY,{"class":"expand-button"},function(e){e.target.parentNode.parentNode.setAttribute("class","grid-full"),this.pageElement.querySelector("#version").setAttribute("open","true"),e.target.parentNode.removeChild(e.target)}.bind(this))),markup=template.compose()):(template=its.Templates.get("pages/dv14_software_page/link_item"),template.replaceToken("title",its.loc("SF.VersionHistory")),markup=template.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createVersionHistoryDoc()})}.bind(this),markup.itsId())),gridTemplate.replaceTokenUnescaped("item",markup),n.replaceTokenUnescaped("versionHistory",gridTemplate.compose());
if(r.length>1){var i=r[0],s=i.releaseNotes;
s&&s.length>0&&(elem=this._createDescription(its.loc("WhatsNew"),i.releaseDate,s),n.replaceTokenWithElement("whatsNew",elem))}}var o=this.product.softwareInfo.websiteUrl||this.product.softwareInfo.supportUrl;
o&&(n.keepBlock("hasWebsite"),n.replaceToken("devWebsite",its.loc("SF.DeveloperWebsite")),n.replaceToken("devWebsiteUrl",o));
var u=this.product.softwareInfo.privacyPolicyUrl;
return u&&(n.keepBlock("hasPrivacyPolicy"),n.replaceToken("privacyPolicy",its.loc("Privacy Policy")),n.replaceToken("privacyPolicyUrl",u)),this.product.softwareInfo.developerInfo&&(template=its.Templates.get("pages/dv14_software_page/link_item"),template.replaceToken("title",its.loc("SF6.DeveloperInfo.Label")),markup=template.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createDeveloperInfoDoc()})}.bind(this),markup.itsId()),n.replaceTokenUnescaped("developerInfo",markup),n.keepBlock("hasDeveloperInfo",!0)),this.product.copyright&&n.replaceToken("copyright",this.product.copyright),n.composeAsElement()},_createDescription:function(e,t,n,r){var i={title:e,date:t,description:n,dontEscape:r,maxLines:5};
return this.renderComponentWithData("description",i)},_createVersionHistoryExpand:function(){var e=its.Templates.get("pages/dv14_software_page/expand");
return e.replaceTokenUnescaped("elem",this._createVersionHistory()),e.replaceToken("id","version"),e.compose()},_createVersionHistoryDoc:function(){var e=its.Templates.get("pages/dv14_software_page/doc_stack_template");
return e.replaceTokenUnescaped("elem",this._createVersionHistory()),its.sf14.Util.ensureDocumentType(e.composeAsElement())},_createVersionHistory:function(){var e=this.pageData.versionHistory,t=its.Templates.get("pages/dv14_software_page/version_history"),n=t.getBlock("loop");
for(var r=0;
r<e.length;
r++){var i=e[r],s={title:i.versionString,date:i.releaseDate,description:i.releaseNotes,showDivider:r!=e.length-1,maxLines:5},o=this.renderComponentStringWithData("description",s);
n.replaceTokenUnescaped("historyItem",o),n.next()}return t.compose()},_createInAppPurchasesExpand:function(){var e=its.Templates.get("pages/dv14_software_page/expand");
return e.replaceTokenUnescaped("elem",this._createInAppPurchases()),e.replaceToken("id","inapp"),e.compose()},_createInAppPurchasesDoc:function(){var e=its.Templates.get("pages/dv14_software_page/doc_stack_template");
return e.replaceTokenUnescaped("elem",this._createInAppPurchases()),its.sf14.Util.ensureDocumentType(e.composeAsElement())},_createInAppPurchases:function(){var e=this.pageData.addOns,t=its.Templates.get("pages/dv14_software_page/in_app_purchases"),n=t.getBlock("trackLoop");
for(var r=0;
r<e.length;
r++){var i=e[r];
n.replaceToken("number",r+1),n.replaceToken("name",i.name),n.replaceToken("price",i.price),its.sf.Platform.iPad()&&r==e.length-1&&n.replaceToken("class","divider-none"),n.next()}return t.compose()},_createDeveloperInfoDoc:function(){var e=its.Templates.get("pages/dv14_software_page/developer_info"),t=this.product.softwareInfo.developerInfo,n=t.person,r=t.address;
e.replaceToken("tradeNameLabel",its.loc("SF6.DeveloperInfo.TradeName")),e.replaceToken("tradeName",this.product.softwareInfo.seller),n&&(e.replaceToken("tradeRepLabel",its.loc("SF6.DeveloperInfo.TradeRep")),e.replaceToken("tradeRep",n.firstName+" "+n.lastName),e.keepBlock("tradeRepBlock"));
if(r){e.replaceToken("addressLabel",its.loc("SF6.DeveloperInfo.Address")),r.countryCode&&r.countryCode.toLowerCase()==="kr"?e.keepBlock("addressKoreanBlock"):e.keepBlock("addressBlock");
var i=r.addressLine1;
r.addressLine2&&(i+="\n"+r.addressLine2),r.addressLine3&&(i+="\n"+r.addressLine3),e.replaceToken("address123",i),e.replaceToken("city",r.city),e.replaceToken("state",r.state),e.replaceToken("zip",r.zipCode),e.replaceToken("country",r.country)}return n&&n.phoneNumber&&(e.replaceToken("phoneLabel",its.loc("SF6.DeveloperInfo.Phone")),e.replaceToken("phone",n.phoneNumber),e.keepBlock("phoneBlock")),n&&n.emailAddress&&(e.replaceToken("emailLabel",its.loc("SF6.DeveloperInfo.Email")),e.replaceToken("email",n.emailAddress),e.keepBlock("emailBlock")),t.eCommerceRegistrationId&&(e.replaceToken("ecommerceRegNumLabel",its.loc("SF6.DeveloperInfo.ECommerceRegNum")),e.replaceToken("ecommerceRegNum",t.eCommerceRegistrationId),e.keepBlock("ecommerceRegNumBlock")),t.businessRegistrationId&&(e.replaceToken("businessRegNumLabel",its.loc("SF6.DeveloperInfo.BusinessRegNum")),e.replaceToken("businessRegNum",t.businessRegistrationId),e.keepBlock("businessRegNumBlock")),its.sf14.Util.ensureDocumentType(e.composeAsElement())}}),its.dv14.MixPage=Class.createSubclass("its.dv14.MixPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments)},productLockup:function(){this._logger.debug(["---------- renderProductLockup: "]);
var e=null;
return this.pageData&&this.pageData.offers&&(e=this.pageData.offers),this.renderComponentWithData("mix_product_lockup",{content:this.product,offers:e})},panesToShow:function(){var e=[],t=function(e,t){this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.ITEM,ids:this.pageData.tracks,onOK:function(n){this._renderSongsTab(e,t,n)}.bind(this),suppressPersonalization:!0}])}.bind(this);
return e.push({title:its.loc("DV14.ProductPage.Tab.Songs"),callback:t,tabId:its.dv14.ProductPageUtil.Tabs.SONGS,preRenderTab:!0}),e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),e},_onCompleteDataFetched:function(e){this.product.id==e.id&&(this.base(e),this.product.isExplicit&&itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onContainerLoad",function(){}))},_renderSongsTab:function(e,t,n){var r=its.Templates.get("pages/dv14_mix_page/songs_tab"),i=this.pageData.blurbs;
if(i&&Object.keys(i).length>0){var s=i[this.pageData.weMixId];
if(s&&Object.keys(i).length>1||Object.keys(i).length>0){var o=this.pageData.tracks;
for(var u=0;
u<o.length;
u++){var a=o[u];
if(i[a]){var f=n[a];
f&&(s=s+"\n\n"+(u+1)+". "+f.name+": "+i[a])}}}var l={title:its.loc("iTunesNotes"),description:s,dontEscape:!0,maxLines:5,showDivider:its.sf.Platform.iPhone()};
r.replaceTokenWithElement("notes",this.renderComponentWithData("description",l))}var c=[];
c.push(new its.dv14.TrackList.Column.Ordinal),c.push(new its.dv14.TrackList.Column.Title(its.loc("DV14.TrackList.Column.Name"))),c.push(new its.dv14.TrackList.Column.Badge),c.push(new its.dv14.TrackList.Column.Duration(its.loc("DV14.TrackList.Column.Duration"))),its.dv14.Util.UI.shouldShowPopularity()&&c.push(new its.dv14.TrackList.Column.Popularity(its.loc("DV14.TrackList.Column.Popularity"),this.pageData.popularityMap.song)),its.App.ParentalRequestData||c.push(new its.dv14.TrackList.Column.BuyButton(its.loc("DV14.TrackList.Column.Price")));
var h={contentIds:this.pageData.tracks,columns:c,selectedTrackAdamId:its.url.queryParamValue("i",this.documentUrl()),overrideTrackNumbers:its.dv14.TrackList.orderedTrackNumbers(this.pageData.tracks),suppressPersonalization:!0},p=this.renderComponentWithData("track_list",h);
r.replaceTokenWithElement("trackList",p);
var d=r.composeAsElement();
t.appendChild(d)}}),its.dv14.MoviePage=Class.createSubclass("its.dv14.MoviePage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this.subscribe(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,this._handlePageStateChanged.bind(this))},productLockup:function(){var e={content:this.product,iTunesExtras:this.pageData&&this.pageData.iTunesExtras,isPurchasedModal:this.data.isPurchasedModal};
return!this._validPageStates&&!this._pageState&&this._determineValidPageStates(),e.validPageStates=this._validPageStates,e.pageState=this._pageState,this.renderComponentWithData("movie_product_lockup",e)},onAppear:function(e){this.base.apply(this,arguments),its.notifications.publish(its.sf14.Events.RENTAL_INFO_CHANGED,{})},_renderNavigationBar:function(e){if(!this._navigationBar||e){var t={navigationTitle:this.product.name,product:this.product,hasShareButton:!0,isPurchasedModal:this.data.isPurchasedModal};
this._navigationBar=this.renderComponentWithData("navigation_bar",t),this.pageElement.replaceTokenWithElement("navigationBar",this._navigationBar)}},panesToShow:function(){var e=[],t=function(e,t){var n=this.pageData.movieBundlesAsAdamIds;
n&&n.length>0?this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.CHARTS,ids:n,onOK:function(n){this._movieBundles=[];
for(var r=0;
r<n.orderedKeys.length;
r++)this._movieBundles.push(n[n.orderedKeys[r]]);
this._renderDetailsTab(e,t)}.bind(this),suppressPersonalization:!0}]):this._renderDetailsTab(e,t)};
return e.push({title:its.loc("DV14.ProductPage.Tab.Details"),callback:t.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}),this.data.isPurchasedModal||(e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED})),e},renderPageWithPartialData:function(){var e=this._offersForCurrentPageState(),t=its.sf.StorePlatformUtil.findRentOffers(e);
if(t.length&&t[0].isEVOD&&its.sf.Client.isVersion("11.0")){var n=its.sf14.LockupUtil.getArtworkDimensions("uber",null,this.documentSize()),r=its.sf.Platform.iPhone()?42:72,i=n.width,s={artworkUrls:{url:its.serverData.constants.resourceImagePathFrameworks+"evod/evod.png",width:i,height:r},size:{width:i,height:r},classes:["uber-banner"],disabled:!0},o=this.renderComponentWithData("artwork",s);
o.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.RUBBERBAND),o.setAttribute("pinGroup","before-top"),this.pageElement.replaceTokenWithElement("evodBanner",o),this.data.isEVOD=!0}this.base.apply(this,arguments)},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_movie_page/details_tab");
this.preorderOffers=its.sf.StorePlatformUtil.findPreorderOffers(this._offersForCurrentPageState());
if(this.preorderOffers.length>0){var r={description:its.loc("DV14.MoviePage.PreOrder.Disclaimer"),maxLines:3};
n.replaceTokenWithElement("preorderDisclaimer",this.renderComponentWithData("description",r))}this.pageData.isMovieRedownloadEnabledInStorefront&&its.sf.StorePlatformUtil.isAnyOfferIneligibleForReDownload(this.product.offers)&&(r={description:its.loc("SFMovie.JaliscoNotAvailable"),maxLines:3},n.replaceTokenWithElement("redownloadDisclaimer",this.renderComponentWithData("description",r))),n.replaceTokenWithElement("bundles",this._renderMovieBundles());
var i=this.product.itunesNotes;
if(i){var s={title:its.loc("SF.ITunesEditorsNotes"),description:i.standard,dontEscape:!0,maxLines:5};
n.replaceTokenWithElement("editorsNotes",this.renderComponentWithData("description",s))}this.product.movieClips&&this.product.movieClips.length>0&&(n.replaceTokenWithElement("trailers",this._renderTrailers()),n.keepBlock("hasTrailers",!0));
var o=this.product.description?this.product.description.standard:null;
if(o){var u={title:its.loc("DV14.MoviePage.PlotSummary"),description:o,maxLines:5};
n.replaceTokenWithElement("plotSummary",this.renderComponentWithData("description",u))}this.pageData.movieCredits&&this.pageData.movieCredits.length>0&&(n.replaceTokenWithElement("castAndCrew",this._renderCastAndCrew()),n.keepBlock("hasCastAndCrew",!0)),n.replaceTokenWithElement("information",this._renderInformation()),this.pageData.languages&&n.replaceTokenWithElement("languages",this._renderLanguages()),this._hasSDH=its.sf.StorePlatformUtil.doOffersHaveAnySDHAssets(this.product.offers),this._hasAD=its.sf.StorePlatformUtil.doOffersHaveAnyAudioDescriptionAssets(this.product.offers),this._hasCC=its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets(this.product.offers),(this._hasSDH||this._hasAD||this._hasCC)&&n.replaceTokenWithElement("accessibilityInfo",this._renderAccessibilityInfo()),this.pageData.iTunesExtras&&this._pageState==its.sf14.ProductPage.State.HD?(n.replaceTokenWithElement("bonusContent",this._renderBonusContent()),n.keepBlock("hasBonusContent",!0)):n.replaceTokenWithElement("bonusContent",document.createElement("placeholder"));
var a=its.sf.StorePlatformUtil.findRentOffers(this.product.offers),f;
if(this.data.isEVOD)f={title:its.loc("DV14.MoviePage.AboutEVOD"),description:its.loc("DV14.MoviePage.AboutEVOD.Description"),maxLines:99};
else if(a&&a.length&&its.sf.Client.isVersion("10.3")){var l=itms.storefront+""||"",c=l.split("-")[0]==="143441",h=c?"DV14.MoviePage.AboutRentals.Description":"DV14.MoviePage.AboutRentals.Description.International";
f={title:its.loc("DV14.MoviePage.AboutRentals"),description:its.loc(h),maxLines:99}}f&&n.replaceTokenWithElement("aboutRentals",this.renderComponentWithData("description",f)),this.product.copyright&&n.replaceToken("copyright",this.product.copyright);
var p=its.sf.Platform.iPhone()||its.property("DV14.Videos.isNewBadgeLayoutEnabled");
if(!its.App.ParentalRequestData&&p&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]&&!this.data.isPurchasedModal){this.product.copyright&&n.replaceTokenWithElement("divider",its.sf14.ComponentUtil.createDivider(this,!0));
var d=its.Templates.get("pages/dv14_product_page/hd_sd_toggle"),v=its.property("DV14.Videos.isNewBadgeLayoutEnabled")?"SF14.AlsoAvailableInBQ":"SF14.AlsoAvailableInHD",m=this._pageState==its.sf14.ProductPage.State.HD?its.loc("SF14.AlsoAvailableInSD"):its.loc(v);
d.replaceToken("hdSdText",m);
var g=d.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,this._handleHDSDToggleClicked.bind(this),g.itsId()),n.replaceTokenUnescaped("hdSdToggle",g)}var y=n.composeAsElement();
t.appendChild(y)},_renderTrailers:function(){var e=this.product.movieClips,t=[];
for(var n=0;
e&&n<e.length;
n++){var r=e[n],i=r.clipAssets[0];
i.contentRating=its.sf.ContentRatingsManager.legacyContentRating(this.product),i.kind=this.product.kind,i.contentId=this.product.id,its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0&&i.hlsUrl&&(i.url=i.hlsUrl);
var s=its.dv14.LockupUtil.getArtworkDimensions("trailer",null,this.size());
if(r.previewArtwork&&!Array.isArray(r.previewArtwork)){var o=s.width,u={width:r.previewArtwork.width,height:r.previewArtwork.height},a=Math.ceil(o*u.height/u.width);
s.width=o,s.height=a}var f={artworkData:{artworkUrls:r.previewArtwork,size:s,alt:r.title,classes:[its.dv14.LockupUtil.getArtworkClassName(its.sf.StorePlatform.Kind.Movie)]},videoData:i,title:r.title,type:its.dv14.Gallery.Type.VIDEO};
if(!f.artworkData.artworkUrls||f.artworkData.artworkUrls.length==0)f.artworkData.artworkUrls=[{url:"ignored.url.apple.com",size:its.dv14.LockupUtil.getArtworkDimensions("trailer",null,this.size())}],f.artworkData.isPlaceholder=!0;
t.push(f)}var l={title:its.loc("DV14.MoviePage.Trailers"),items:t};
return this.renderComponentWithData("gallery",l)},_renderMovieBundles:function(){var e;
if(this._movieBundles&&this._movieBundles.length>0&&!this.data.isPurchasedModal){var t=its.Templates.get("pages/dv14_movie_page/details_tab/bundles");
t.replaceToken("title",its.loc("SF.AlsoIncludedIn"));
var n={details:function(e){return[{value:e.name},{value:e.genres[0].name}]},suppressBuyButton:function(){return!1}},r=document.createDocumentFragment();
for(var i=0;
i<this._movieBundles.length;
i++){var s={content:this._movieBundles[i],type:its.dv14.SmallLockup.Type.LIST,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.CHARTS,detailsGenerator:n,"its.dv14.BuyButton":{showAsButtonless:!0,showActionTextAndPrice:!1}};
r.appendChild(this.renderComponentWithData("small_lockup",s))}t.replaceTokenWithElement("bundles",r),e=t.composeAsElement()}return e},_renderCastAndCrew:function(){var e=[];
for(var t=0;
t<this.pageData.movieCredits.length;
t++){var n=this.pageData.movieCredits[t],r=[];
for(var i=0;
i<n.credits.length;
i++){var s=n.credits[i].url;
s?r.push({value:n.credits[i].label,url:s}):r.push(n.credits[i].label)}var o={title:n.roleName,values:r};
e.push(o)}var u={title:its.loc("DV14.MoviePage.CastAndCrew"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_ABOVE};
return this.renderComponentWithData("info_list",u)},_renderInformation:function(){var e=[];
this.pageData.studioLink&&e.push({title:its.loc("DV14.MoviePage.Studio"),values:[this.pageData.studioLink.label]});
var t=this.product.genres[0];
t&&e.push({title:its.loc("Genre"),values:[t.name]});
if(this.product.releaseDate){var n=this.product.releaseDate.slice(0,4);
e.push({title:its.loc("Released"),values:[n],replaceUnescaped:!0})}var r=this._offersForCurrentPageState(),i=its.sf.StorePlatformUtil.bestAsset(r);
i.duration&&e.push({title:its.loc("DV14.MoviePage.RunTime"),values:[formatDuration(i.duration)],replaceUnescaped:!0});
var s=its.sf.StorePlatformUtil.orderedAssets(this._offersForCurrentPageState()),o=its.dv14.ProductPageUtil.fileSizesForVideo(s),u=its.dv14.ProductPageUtil.localizedFileSizeInformationForVideo(o);
u!=""&&e.push({title:its.loc("DV14.Size"),values:[u]});
if(!this.preorderOffers.length){var a=its.dv14.ProductPageUtil.isWideScreen(its.sf.StorePlatformUtil.bestAsset(this._offersForCurrentPageState())),f=a?its.loc("DV14.Widescreen"):its.loc("DV14.Fullscreen");
e.push({title:its.loc("DV14.Format"),values:[f]})}var l=its.sf.ContentRatingsManager.legacyContentRating(this.product);
if(l&&l.advisories&&l.advisories.length>0&&this._shouldShowContentRating()){var c=its.loc("DV14.RatingWithExplanation",{rating:l.name,explanation:l.advisories[0]});
e.push({title:its.loc("DV14.Rated"),values:[c]})}var h={title:its.loc("DV14.Information"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",h)},_shouldShowContentRating:function(){var e=itms.storefront;
return e&&e.indexOf("143465")===-1},_renderLanguages:function(){var e=[],t=this.pageData.languages;
if(t&&t.primary){var n=t.primary,r=n.name+" "+its.dv14.ProductPageUtil.languageDetailsText(n);
e.push({title:its.loc("DV14.Original"),values:[r]})}if(t&&t.additional&&t.additional.length>0){var i=[];
for(var s=0;
s<t.additional.length;
s++){var o=t.additional[s];
r=o.name+" "+its.dv14.ProductPageUtil.languageDetailsText(o),i.push(r)}e.push({title:its.loc("DV14.Additional"),values:i})}var u={title:its.loc("DV14.Languages"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",u)},_renderAccessibilityInfo:function(){var e=[];
this._hasSDH?e.push({title:"SDH",values:[{value:its.loc("DV14.Accessibility.InfoList.SDHCopy")},{value:its.loc("MZAccessibility.LearnMore"),url:its.serverData.constants.learnMoreCCandSDH}]}):this._hasCC&&e.push({title:"CC",values:[{value:its.loc("DV14.Accessibility.InfoList.CCCopy")},{value:its.loc("MZAccessibility.LearnMore"),url:its.serverData.constants.learnMoreCCandSDH}]}),this._hasAD&&e.push({title:"AD",values:[{value:its.loc("DV14.Accessibility.InfoList.ADCopy")},{value:its.loc("MZAccessibility.LearnMore"),url:its.serverData.constants.learnMoreAudioDescriptions}]});
var t={title:its.loc("DV14.Accessibility.InfoList.Heading"),infoItems:e,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",t)},_renderBonusContent:function(){var e=its.sf.Platform.iPhone()?its.Templates.get("pages/dv14_movie_page/bonus_content"):its.Templates.get("pages/dv14_movie_page/bonus_content_ipad");
e.replaceToken("title",its.loc("DV14.ProductPage.Tab.ITunesExtras"));
var t=this.pageData.iTunesExtras.description;
if(t){var n={description:t,dontEscape:!0,maxLines:3,showDivider:!1,classes:["extras-description"]};
e.replaceTokenUnescaped("aboutBonusContent",this.renderComponentStringWithData("description",n))}e.replaceToken("learnMoreText",its.loc("SF.ExtrasNoticeLink")),e.replaceToken("learnMoreUrl",its.serverData.constants.iTunesExtrasLearnMore);
var r={width:110,height:62},i={artworkUrls:this.pageData.iTunesExtras.previewArtworks,size:r},s=this.renderComponentStringWithData("artwork",i);
return e.replaceTokenUnescaped("bonusScreenshot",s),e.composeAsElement()},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_movie_page/related_tab"),i=n?"grid":"swoosh",s=function(){if(this.pageData.viewersAlsoBoughtMovies&&this.pageData.viewersAlsoBoughtMovies.length>0){var e=n?3:null,s={title:its.loc("DV14.ProductPage.ViewersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.viewersAlsoBoughtMovies,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("viewersAlsoBought",this.renderComponentWithData(i,s))}if(this.pageData.moreByActors&&this.pageData.moreByActors.length>0){e=n?3:null;
var o={title:its.loc("DV14.MoviePage.MoreByTheseActors"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreByActors,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByActors",this.renderComponentWithData(i,o))}if(this.pageData.moreByDirectors&&this.pageData.moreByDirectors.length>0){e=n?3:null;
var u={title:its.loc("DV14.MoviePage.MoreByThisDirector"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreByDirectors,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByDirectors",this.renderComponentWithData(i,u))}if(this.pageData.topInGenreAdamIds&&this.pageData.topInGenreAdamIds.length>0){var a=this.product.genres[0],f=a?a.name:null;
e=n?3:null;
var l={title:its.loc("DV14.MoviePage.TopMoviesInGenre",{genre:f}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.topInGenreAdamIds,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreInGenre",this.renderComponentWithData(i,l))}t.appendChild(r.composeAsElement());
if(t.lastElementChild){var c=t.lastElementChild.getElementsByTagName("divider").item(0);
c&&c.remove()}}.bind(this),o=[];
this.pageData.viewersAlsoBoughtMovies&&(o=o.concat(this.pageData.viewersAlsoBoughtMovies)),this.pageData.moreByActors&&(o=o.concat(this.pageData.moreByActors)),this.pageData.moreByDirectors&&(o=o.concat(this.pageData.moreByDirectors)),this.pageData.topInGenreAdamIds&&(o=o.concat(this.pageData.topInGenreAdamIds));
var u={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:o,onOKHasAllContent:s,onOKMissingContent:s,suppressPersonalization:!0};
this.storePlatform.fetchContent(u)},_determineValidPageStates:function(){this._validPageStates={},this._validPageStates[its.sf14.ProductPage.State.HD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this.product,its.sf14.ProductPage.State.HD),this._validPageStates[its.sf14.ProductPage.State.SD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this.product,its.sf14.ProductPage.State.SD);
if(!this._pageState){var e=its.url.queryParamsDict(this.documentUrl());
this._pageState=!e.showLC&&this._validPageStates[its.sf14.ProductPage.State.HD]?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD}},_offersForCurrentPageState:function(){return this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(this.product.offers):its.sf.StorePlatformUtil.findSDOffers(this.product.offers)},_handleHDSDToggleClicked:function(){var e={pageState:this._pageState==its.sf14.ProductPage.State.HD?its.sf14.ProductPage.State.SD:its.sf14.ProductPage.State.HD,contentId:this.product.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,e)},_handlePageStateChanged:function(e){this.product.id==e.contentId&&(this._document&&its.sf.Platform.iPhone()&&this._document.scrollToTop(),this._pageState=e.pageState,this._renderProductLockup(!0),this._tabbedPane&&this._tabbedPane.refreshTab(its.dv14.ProductPageUtil.Tabs.DETAILS))}}),its.dv14.MovieBundlePage=Class.createSubclass("its.dv14.MovieBundlePage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this.subscribe(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,this._handlePageStateChanged.bind(this))},productProfile:function(){return its.sf.StorePlatform.Profiles.MOVIE_BUNDLE_PRODUCT},productLockup:function(){var e={content:this.product};
return!this._validPageStates&&!this._pageState&&this._determineValidPageStates(),e.validPageStates=this._validPageStates,e.pageState=this._pageState,this.renderComponentWithData("movie_bundle_product_lockup",e)},panesToShow:function(){var e=[];
return e.push({title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}),e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),e},_renderDetailsTab:function(e,t){its.notifications.publish(its.dv14.MovieBundlePage.Events.CLOSED_CAPTION_AVAILABLE,{isCC:this._isBundleClosedCaptioned()});
var n=its.Templates.get("pages/dv14_movie_bundle_page/details_tab"),r={title:its.loc("SF.IncludedInThisBundle"),contentIds:this.product.childrenIds,"its.dv14.SmallLockup":{detailsGenerator:its.dv14.SmallLockup.MovieBundleContentsDetailsGenerator}};
n.replaceTokenWithElement("includedMovies",this.renderComponentWithData("swoosh",r)),this.product.copyright&&(n.keepBlock("hasCopyright",!0),n.replaceToken("copyright",this.product.copyright),n.replaceTokenWithElement("divider",its.sf14.ComponentUtil.createDivider(this,!0)));
if(its.sf.Platform.iPhone()&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]){var i=its.Templates.get("pages/dv14_product_page/hd_sd_toggle"),s=this._pageState==its.sf14.ProductPage.State.HD?its.loc("SF14.AlsoAvailableInSD"):its.loc("SF14.AlsoAvailableInHD");
i.replaceToken("hdSdText",s);
var o=i.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,this._handleHDSDToggleClicked.bind(this),o.itsId()),n.replaceTokenUnescaped("hdSdToggle",o)}var u=n.composeAsElement();
t.appendChild(u)},_moviesWithITunesExtras:function(){if(!this._moviesWithITunesExtrasArray){this._moviesWithITunesExtrasArray=[];
var e=this.product.childrenIds;
for(var t=0;
t<e.length;
t++){var n=e[t],r=this.product.children[n];
r&&r.mediaArchiveAdamId&&this._moviesWithITunesExtrasArray.push(r)}}return this._moviesWithITunesExtrasArray},_renderBonusContent:function(){var e=this._moviesWithITunesExtras();
if(e.length<1)return null;
var t=its.Templates.get("pages/dv14_movie_bundle_page/bonus_content");
t.replaceToken("bonusContentTitle",its.loc("SF.MovieBundlePage.BonusContent.Title")),t.replaceToken("bonusContentExplanation",its.loc("SF.MovieBundlePage.BonusContent.Explanation"));
var n=t.getBlock("bonusLoop");
for(var r=0;
r<e.length;
r++)n.replaceToken("bonusContentItem",its.loc("SF.MovieBundlePage.BonusContent.Item",{movieName:e[r].name})),n.next();
return t.composeAsElement()},_isBundleClosedCaptioned:function(){var e=!0,t=this.product.childrenIds;
for(var n=0;
n<t.length&&e;
n++){var r=this.product.children[t[n]],i=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(r.offers):its.sf.StorePlatformUtil.findSDOffers(r.offers);
e=its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets(i)}return e},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_movie_page/related_tab"),i=n?"grid":"swoosh",s=function(){if(this.pageData.viewersAlsoBoughtAdamIds&&this.pageData.viewersAlsoBoughtAdamIds.length>0){var e=n?3:null,s={title:its.loc("DV14.ProductPage.ViewersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.viewersAlsoBoughtAdamIds,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("viewersAlsoBought",this.renderComponentWithData(i,s))}if(this.pageData.moreByActorsAdamIds&&this.pageData.moreByActorsAdamIds.length>0){var e=n?3:null,o={title:its.loc("DV14.MoviePage.MoreByTheseActors"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreByActorsAdamIds,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByActors",this.renderComponentWithData(i,o))}if(this.pageData.moreByDirectorsAdamIds&&this.pageData.moreByDirectorsAdamIds.length>0){var e=n?3:null,u={title:its.loc("DV14.MoviePage.MoreByThisDirector"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreByDirectorsAdamIds,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByDirectors",this.renderComponentWithData(i,u))}t.appendChild(r.composeAsElement())}.bind(this),o=[];
this.pageData.viewersAlsoBoughtAdamIds&&(o=o.concat(this.pageData.viewersAlsoBoughtAdamIds)),this.pageData.moreByActorsAdamIds&&(o=o.concat(this.pageData.moreByActorsAdamIds)),this.pageData.moreByDirectorsAdamIds&&(o=o.concat(this.pageData.moreByDirectorsAdamIds));
var u={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:o,onOKHasAllContent:s,onOKMissingContent:s,suppressPersonalization:!0};
this.storePlatform.fetchContent(u)},_determineValidPageStates:function(){this._validPageStates={},this._validPageStates[its.sf14.ProductPage.State.HD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this.product,its.sf14.ProductPage.State.HD),this._validPageStates[its.sf14.ProductPage.State.SD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this.product,its.sf14.ProductPage.State.SD);
if(!this._pageState){var e=its.url.queryParamsDict(this.documentUrl());
this._pageState=!e.showLC&&this._validPageStates[its.sf14.ProductPage.State.HD]?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD}},_handleHDSDToggleClicked:function(){var e={pageState:this._pageState==its.sf14.ProductPage.State.HD?its.sf14.ProductPage.State.SD:its.sf14.ProductPage.State.HD,contentId:this.product.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,e)},_handlePageStateChanged:function(e){this.product.id==e.contentId&&(this._pageState=e.pageState,this._renderProductLockup(!0),this._tabbedPane.refreshTab(its.dv14.ProductPageUtil.Tabs.DETAILS))}}),its.dv14.MultiRoomPage=Class.createSubclass("its.dv14.MultiRoomPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.template=its.Templates.get("pages/dv14_multi_room_page");
if(this.pageData().uber&&this.pageData().uber.description){this.template.keepBlock("uberText");
var e=this.template.getBlock("uberText");
e.replaceTokenUnescaped("text",this.pageData().uber.description)}},pageData:function(){return this.data.pageData},isReadyForUser:function(){return!this._consumeNextDidUpdateEvent},onDidUpdate:function(){this._consumeNextDidUpdateEvent&&(this._consumeNextDidUpdateEvent=!1),this.base()},render:function(){this.storePlatform.beginContentBatch(),its.dv14.Util.UI.getShowIdsForEpisodeLockups.call(this),this._pageElement=this._pageElement||this.template.composeAsElement(),this._renderNavigationBar(),this.addDocumentStyles(this._pageElement,{uber:this.pageData().uber,blocks:this._blocks(),mt:this.pageData().mt,noFade:!0});
var e=this.pageData().typ;
e&&this._pageElement.replaceTokenWithElement("thankYouPlacard",this.renderComponentWithData("thank_you_placard",e));
var t=document.createDocumentFragment(),n=this._blocks();
if(its.isArray(n)){var r=document.createDocumentFragment();
its.dv14.BlockUtil.validateBlocks(n,function(){for(var e=0;
e<n.length;
e++){var t=this.renderComponentWithData(n[e].type,n[e]);
its.isElement(t)&&r.appendChild(t)}this._pageElement.replaceTokenWithElement("blocks",r)}.bind(this))}var i=this.pageData().segments,s=its.dv14.SmallLockup.DefaultDetailsGenerator.PriceText,o=parseInt(its.url.queryParamValue("fcId",this._documentUrl)),u=[1217968579,1172569304,1222177038,1219481230,1227115668,1224811195,1215266001,1142240079,1134226374,1134225701,1227112039,1108687857,1199276916,1234458298,926346922,875563650,577626955,577627479,577627791,1084304562];
u.includes(o)&&(s=its.dv14.SmallLockup.DefaultDetailsGenerator);
for(var a=0;
a<i.length;
a++){var f={title:i[a].title,doNotFilter:!0,contentIds:i[a].adamIds,scrollableCellControllerClass:its.sf14.ScrollableCellController.Multiroom,"its.dv14.SmallLockup":{detailsGenerator:s,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.GROUPING},link:{label:its.loc("See All"),url:i[a].seeAllUrl.url}};
i[a].listType&&(f.additionalCssClasses="shelf-with-rows",f.type=its.dv14.Swoosh.Type.LIST,f.scrollableCellControllerClass=its.sf14.ScrollableCellController.List.Chart,f["its.dv14.SmallLockup"]={detailsGenerator:its.dv14.SmallLockup.DefaultDetailsGenerator.List,artworkProfile:"_default"});
var l=this.renderComponentWithData("swoosh",f);
t.appendChild(l)}this._pageElement.replaceTokenWithElement("content",t);
if(its.property("MZStore.showEmailSupportLinkInFooter")){var c={"data-url":its.loc("MZStore.EmailSupportLink.url"),"data-page-target":its.sf14.PageController.PageTarget.EXTERNAL,"class":"email-support-link"},h=its.sf14.ComponentUtil.createButton(this,its.loc("MZStore.EmailSupportLink"),its.sf14.ComponentUtil.ButtonType.LINK,c,null,!0);
this._pageElement.replaceTokenWithElement("emailSupportLink",h)}return its.sf14.Metrics.Events.PageRender.isAvailable()?this.storePlatform.submitContentBatch()?this._consumeNextDidUpdateEvent=!0:setTimeout(this.tryReportRenderState.bind(this),1):this.storePlatform.submitContentBatch(),this._pageElement},_renderNavigationBar:function(){var e={title:this.pageData().pageTitle};
this._pageElement.replaceTokenWithElement("navigation",this.renderComponentWithData("navigation_bar",e))},onDocumentSizeChange:function(e){this.base(e),this.render()},_blocks:function(){var e=this.pageData().blocks,t;
return e&&!its.isArray(e)?t=its.dv14.Util.UI.isCompact(this.size())?e.iphone:e.ipad:t=e,t},element:function(){return this._pageElement},onOrientationChange:function(e){var t={page:this._pageElement,orientation:e.newOrientation};
its.notifications.publish("multiroom_page:orientationChange",t)}}),its.dv14.MusicVideoPage=Class.createSubclass("its.dv14.MusicVideoPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments)},productLockup:function(){var e={content:this._video()};
return this.renderComponentWithData("music_video_product_lockup",e)},panesToShow:function(){var e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0},{title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}];
return its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),e},_genre:function(){return this._video().genres[0]},_onCompleteDataFetched:function(e){this.product.id==e.id&&(this.base(e),this.product.isExplicit&&itms.restrictions&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType&&itms.restrictions.presentExplicitRestrictionAlertIfNeededOfType("onContainerLoad",function(){}))},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_music_video_page/details_tab"),r=this._video(),i=[];
this._genre()&&i.push({title:its.loc("DV14.ProductPage.Genre"),values:[this._genre().name]}),r.releaseDate&&i.push({title:its.loc("Released"),values:[its.locDate(r.releaseDate)],replaceUnescaped:!0});
var s=r.offers,o=its.sf.StorePlatformUtil.bestAsset(s);
o.duration&&i.push({title:its.loc("DV14.MoviePage.RunTime"),values:[formatDuration(o.duration)],replaceUnescaped:!0});
var u=its.sf.StorePlatformUtil.orderedAssets(s),a=its.dv14.ProductPageUtil.fileSizesForVideo(u),f=its.dv14.ProductPageUtil.localizedFileSizeInformationForVideo(a);
f!=""&&i.push({title:its.loc("DV14.Size"),values:[f]});
var l={infoItems:i,type:its.dv14.InfoList.Type.TITLE_LEFT};
n.replaceTokenWithElement("infoList",this.renderComponentWithData("info_list",l));
var c=n.composeAsElement();
t.appendChild(c)},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_music_video_page/related_tab"),i=this.pageData,s=this._video(),o=function(){var e=i.moreMusicVideosByArtist;
if(e&&e.length>0){var o=n?3:null,u={title:its.loc("DV14.ProductPage.MoreByArtist",{artistName:s.artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e,o),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByArtist",this.renderComponentWithData("swoosh",u))}e=i.viewersAlsoBoughtMusicVideos,e&&e.length>0&&(o=n?3:null,u={title:its.loc("DV14.ProductPage.CustomersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e,o),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1},r.replaceTokenWithElement("customersAlsoBought",this.renderComponentWithData("swoosh",u))),e=i.moreMusicVideosInGenre,e&&e.length>0&&(o=n?3:null,u={title:its.loc("DV14.MusicVideoPage.TopMusicVideosInGenre",{genre:this._genre().name}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e,o),suppressPersonalization:this.lookup("suppressPersonalization"),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1},r.replaceTokenWithElement("moreInGenre",this.renderComponentWithData("swoosh",u))),t.appendChild(r.composeAsElement())}.bind(this),u=[];
i.moreMusicVideosByArtist&&(u=u.concat(i.moreMusicVideosByArtist)),i.viewersAlsoBoughtMusicVideos&&(u=u.concat(i.viewersAlsoBoughtMusicVideos)),i.moreMusicVideosInGenre&&(u=u.concat(i.moreMusicVideosInGenre));
var a={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:u,onOKHasAllContent:o,onOKMissingContent:o,suppressPersonalization:!0};
this.storePlatform.fetchContent(a)},_video:function(){return this.product}}),its.dv14.NearbyAppsPage=Class.createSubclass("its.dv14.NearbyAppsPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"pages/dv14_nearby_apps_page"},render:function(){this.template.replaceToken("loadingText",its.sf14.Util.UI.loadingText()),this._pageElement=this.template.composeAsElement(),this.addDocumentStyles(this._pageElement,{mt:its.serverData.constants.MZMediaType.MobileSoftware.id,noFade:!0});
var e={title:its.loc("DV14.AppExplore.PopularNearMe")};
return this._navigationElement=this.renderComponentWithData("navigation_bar",e),this._pageElement.replaceTokenWithElement("navigation",this._navigationElement),this._nearbyAppsElement=this._pageElement.querySelector("nearByApps"),this._nearbyAppsElement&&this._nearbyAppsElement.addEventListener("dataavailable",this._handleNearByApps.bind(this)),this._activityIndicator=this._pageElement.querySelector("activityIndicator"),this._pageElement},_handleNearByApps:function(e){this._activityIndicator.remove();
var t;
try{var n=JSON.parse(e.nearMe);
t=its.reflect.keys(n.results)}catch(r){t=[]}if(t.length){var i=its.sf.StorePlatform.calculatedProfile(its.sf.StorePlatform.Profiles.NATIVE_SEARCH_LOCKUP,its.sf.StorePlatform.ArtworkProfiles.SEARCH),s={};
s[i]=n,this.storePlatform.cacheStorePlatformDataForProfiles(s);
var o={contentIds:t,"its.dv14.SmallLockup":{titleMaxLines:2},scrollableCellController:its.dv14.AppExplorePage.ListNearMeScrollableCellController};
this.documentElement().replaceTokenWithElement("content",this.renderComponentWithData("column_list",o))}else this._renderNoNearByAppsView()},_renderNoNearByAppsView:function(){var e=its.Templates.get("pages/dv14_nearby_apps_page/no_results");
e.replaceToken("imgSrc",its.dv14.ErrorPage.Types[its.serverData.constants.MZMediaType.MobileSoftware.name]),e.replaceToken("message",its.loc("DV14.NoNearbyApps")),this.documentElement().replaceTokenWithElement("content",e.composeAsElement())}}),its.dv14.NearbyAppsPage.pushNearbyAppsPage=function(){TabBar.selectedTab.navigationDocument.clear(),its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:its.sf14.BaseDocument.renderDocumentWithData("nearby_apps_page",{},its.dv14.PageController.getDocumentSize())})},its.notifications.subscribe(its.sf14.Events.NATIVE_PAGE_TRANSITION,its.dv14.NearbyAppsPage.pushNearbyAppsPage,null,null,function(e){return e.type=="nearby"}),its.dv14.PersonalizedRoomPage=Class.createSubclass("its.dv14.PersonalizedRoomPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("pages/dv14_personalized_room_page"),this.data.pageData.adamIds=this._pageData().ids,this._personalizedRoomType=this._pageData().personalizedRoomPageType,this._fcKindId=this._pageData().fcKindId,this.storePlatform.cacheStorePlatformDataForProfiles(this.data.storePlatformData)},render:function(){return this._pageElement=this._template.composeAsElement(),this._refreshContentView(),this._pageElement},_pageData:function(){return this.data.pageData},_refreshContentView:function(){!itms.DSID||this._pageData().signInRequired==1?this._pageElement.replaceTokenWithElement("content",this._renderSignInPageContents()):this._pageData().adamIds.length===0?this._pageElement.replaceTokenWithElement("content",this._renderNoPageContents()):this._pageElement.replaceTokenWithElement("content",this._renderPageContents())},_renderPageContents:function(){return this.renderComponentWithData("room_page",this.data)},_renderNoPageContents:function(){var e=its.Templates.get("pages/dv14_personalized_room_page/alert_view"),t="",n="";
this._personalizedRoomType=="NFA"?(t="DI6.NewFromArtistsPageTitle",n="DI6.NFANoOffersTitle"):this._personalizedRoomType=="RECOMMENDATIONS"?(t="DI6.RecommendationsPageTitle."+this._fcKindId,n="DI6.RecommendationsDescriptionBlurb"):this._personalizedRoomType=="CMA"?(t="DI6.CMC.CMANoOffersTitle",n="DI6.CMC.CMADescriptionBlurb"):this._personalizedRoomType=="CMS"&&(t="DI6.CMC.CMSNoOffersTitle",n="DI6.CMC.CMSDescriptionBlurb"),e.replaceToken("title",its.loc(t)),e.replaceToken("description",its.loc(n));
var r=e.composeAsElement();
return this.addDocumentStyles(r,{}),r},_renderSignInPageContents:function(){var e=its.Templates.get("pages/dv14_personalized_room_page/alert_view"),t=its.sf14.ComponentUtil.createButton(this,its.loc("SignIn"),null,{},this.signInButtonSelectHandler.bind(this),!0),n="",r="";
this._personalizedRoomType=="NFA"?(n="DI6.NewFromArtistsPageTitle",r="DI6.NFASignInTitle"):this._personalizedRoomType=="RECOMMENDATIONS"?(n="DI6.CMC.CompleteMyAlbum",r="DI6.RecommendationsSignInTitle"):this._personalizedRoomType=="CMA"?(n="DI6.CMC.CompleteMyAlbum",r="DI6.CMC.CMASignInTitle"):this._personalizedRoomType=="CMS"&&(n="DI6.CMC.CompleteMySeason",r="DI6.CMC.CMSSignInTitle"),e.replaceToken("title",its.loc(n)),e.replaceToken("description",its.loc(r)),e.replaceTokenWithElement("signInButton",t);
var i=e.composeAsElement();
return this.addDocumentStyles(i,{}),i},signInButtonSelectHandler:function(){itms.authenticate({},this._fetchOfferIds.bind(this))},_fetchOfferIds:function(){var e=function(e){this.data.pageData=e,this.data.pageData.adamIds=e.ids,this._refreshContentView()};
its.sf.Client.dsId()&&its.sf14.Util.getJSON(this._pageData().lookupUrl,e.bind(this),this.render.bind(this))}}),its.dv14.PersonalizedRoomPage.CMCDetailsGenerator={details:function(e){var t=e.kind,n=[],r={};
t==its.sf.StorePlatform.Kind.Album?r.value=e.name:t==its.sf.StorePlatform.Kind.TvSeason?r.value=e.artistName:r=null,r!=null&&(r.classNames=["title-line"],n.push(r));
var i={};
t==its.sf.StorePlatform.Kind.Album?i.value=e.artistName:t==its.sf.StorePlatform.Kind.TvSeason?i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName):i=null,i!=null&&n.push(i);
var s={},o=its.sf.StorePlatformUtil.findCMCOffers(e.offers)[0];
if(o){var u=o.priceFormatted;
its.sf.StorePlatformUtil.hasAnyPreorderOffers(e.offers)?(s.value=its.loc("CompleteMyPreorderOfferPrice",{price:u}),s.classNames=["preorder"]):(s.value=its.loc("DI6.CMC.CompleteMyOfferPrice",{price:u}),s.classNames=["cmc-price"])}else s=null;
s!=null&&n.push(s);
var a=its.sf.StorePlatformUtil.findBuyOffers(e.offers)[0],f={value:its.loc("DI6.CMC.RegularPrice",{price:a.priceFormatted})};
return n.push(f),n},suppressBuyButton:function(){return!0}},its.dv14.PodcastPage=Class.createSubclass("its.dv14.PodcastPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),its.notifications.unsubscribe(its.sf14.Events.PAGE_APPEAR,this._handleLoadEventRef),this._handleLoadEventRef=this._handleLoadEvent.bind(this),this.subscribe(its.sf14.Events.PAGE_APPEAR,this._handleLoadEventRef)},productLockup:function(){this._logger.debug(["---------- renderProductLockup: "]);
var e=null;
return this.pageData&&this.pageData.offers&&(e=this.pageData.offers),this.renderComponentWithData("podcast_product_lockup",{content:this.product,offers:e})},panesToShow:function(){var e=function(e,t){this.storePlatform.fetchContent([{profile:its.sf.StorePlatform.Profiles.ITEM,ids:this.product.childrenIds,onOK:function(n){this._renderDetailsTab(e,t,n)}.bind(this),suppressPersonalization:!0}])}.bind(this),t=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:e,tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0},{title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}];
return its.App.ParentalRequestData||t.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),t},_handleLoadEvent:function(e){var t=this.product,n=its.dv14.PodcastReportingUtil.reportBrowse({artistId:t.artistId,podcastId:t.id,podcastName:t.name,podcastType:1});
if(podcasts.isDiagnosticSubmissionAllowed&&podcasts.isDiagnosticSubmissionAllowed()){var r=its.sf14.Metrics.Events.Page._getMetricsEvent(e);
r.topic="xp_its_podcasts_main",r.fields=Class.extend(r.fields,n),r.fields.topic="xp_its_podcasts_main",r.fields.feedUrl=t.feedUrl,r.fields.eventType="reporting_event",r.fields.pageType="browse",its.sf.Metrics.recordEvent(r,"xp_its_podcasts_main")}},_renderDetailsTab:function(e,t,n){var r=its.Templates.get("pages/dv14_podcast_page/details_tab"),i=this.product.description;
if(i&&i.standard){var s=i.standard,o=its.loc("DV14.Podcasts.Description");
if(s&&o){var u={title:o,description:s,maxLines:3,showDivider:!1};
r.replaceTokenWithElement("description",this.renderComponentWithData("description",u))}}var a=[new its.dv14.TrackList.Column.Title(its.loc("DV14.TrackList.Column.Name")),new its.dv14.TrackList.Column.Badge,new its.dv14.TrackList.Column.Duration(its.loc("DV14.TrackList.Column.Duration"))];
its.App.ParentalRequestData||a.push(new its.dv14.TrackList.Column.BuyButton(its.loc("DV14.TrackList.Column.Price")));
var f=its.sf.ContentRatingsManager.legacyContentRating(this.product),l=its.sf.StorePlatformUtil.ContentRating.isExplicit(f);
l&&its.dv14.Util.Client.isPodcasts()&&podcasts.presentExplicitRestrictionAlertIfNeededOfType&&podcasts.presentExplicitRestrictionAlertIfNeededOfType("onContainerLoad",function(){});
var c={contentIds:this.product.childrenIds,columns:a,selectedTrackAdamId:its.url.queryParamValue("i",this.documentUrl()),selectedTrackEpisodeGuid:its.url.hashParamValue("episodeGuid",this.documentUrl()),overrideTrackNumbers:its.dv14.TrackList.orderedTrackNumbers(this.product.childrenIds),suppressPersonalization:!0,needsBadgeColumn:!0,useContainerExplicitRating:l},h=this.renderComponentWithData("track_list",c);
r.replaceTokenWithElement("trackList",h);
var p=this.product.itunesNotes&&this.product.itunesNotes.standard;
if(p){var d={title:its.loc("DV14.ProductPage.Podcasts.EditorsNotes"),description:p,dontEscape:!0,maxLines:3,showDivider:!1};
r.replaceTokenWithElement("notes",this.renderComponentWithData("description",d))}var v=r.composeAsElement();
t.appendChild(v)},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_podcast_page/related_tab"),i=this.product.itunesuType&&this.product.itunesuType=="collection",s=n?"grid":"swoosh",o=function(){if(this.pageData.moreByArtist&&this.pageData.moreByArtist.length>0){var e=i?its.loc("DV14.ProductPage.MoreFromProvider",{artistName:this.product.artistName}):its.loc("DV14.ProductPage.MoreByArtist",{artistName:this.product.artistName}),o=n?3:null,u={title:e,contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreByArtist,o),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreByArtist",this.renderComponentWithData(s,u))}if(this.pageData.listenersAlsoBought&&this.pageData.listenersAlsoBought.length>0&&!i){var o=n?3:null,a={title:its.loc("DV14.PodcastPage.ListenersAlsoSubscribedTo"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.listenersAlsoBought,o),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("listenersAlsoBought",this.renderComponentWithData(s,a))}if(this.pageData.topPodcastsInGenre&&this.pageData.topPodcastsInGenre.length>0){var f=this.product.genres[0],l=f?f.name:null,o=n?3:null,c={title:its.loc("DV14.PodcastPage.MoreInGenre",{genre:l}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.topPodcastsInGenre,o),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("topPodcastsInGenre",this.renderComponentWithData(s,c))}t.appendChild(r.composeAsElement())}.bind(this),u=[];
this.pageData.moreByArtist&&(u=u.concat(this.pageData.moreByArtist)),this.pageData.topPodcastsInGenre&&(u=u.concat(this.pageData.topPodcastsInGenre)),this.pageData.listenersAlsoBought&&(u=u.concat(this.pageData.listenersAlsoBought));
var a={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:u,onOKHasAllContent:o,onOKMissingContent:o,suppressPersonalization:!0};
this.storePlatform.fetchContent(a)}}),its.dv14.PurchasesContentPage=Class.createSubclass("its.dv14.PurchasesContentPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this._mediaType=this.pageData.mediaType,this._template=its.Templates.get("pages/dv14_purchases_content_page"),this._contentIds=this.pageData.contentIds,this._localContent={},this._adamIdsToRemove=[],this._isUpdates=this.pageData.isUpdates,this.data["its.dv14.RedownloadButton"]={allowPlayback:this._mediaType==its.dv14.PurchasesPage.MediaTypes.music},this.subscribe(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE,this._enterPurchasesEditModeCallback()),this.subscribe(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE,this._exitPurchasesEditModeCallback()),this.subscribe(its.dv14.SmallLockup.Events.SELECTION_CHANGED,this._editModeItemSelectionToggeledCallback()),this.subscribe(its.dv14.PurchasesContentPage.Events.UPDATE_EDIT_CLEAR_BUTTON,this._updateEditClearButtonCallback())},restoreData:function(){return{title:its.loc("Purchases")}},render:function(){its.notifications.publish(its.dv14.GlobalListsTab.Events.UPDATE_EDIT_CLEAR_BUTTON,{}),this.pageData.isUpdates?this._template.replaceToken("navigationTitle",its.loc("DV14.PurchasesPage.Updates")):this._template.replaceToken("navigationTitle",its.loc(this._mediaType.locKey)),this._element=this._template.composeAsElement(),this.addDocumentStyles(this._element,{}),this._stackTemplate=this.getStackTemplateFromElement(this._element);
var e=[],t=this.pageData.backingIdsMap?this.pageData.backingIdsMap:{};
for(var n=0;
n<this._contentIds.length;
n++){var r=this._contentIds[n],i=t[r];
i&&(e=e.concat(i))}return itms.findLibraryItems(e,function(e){this._updateLocalContent(e),this._createScrollableCellController(this._stackTemplate)}.bind(this)),this._element},_updateLocalContent:function(e){this._localContent=e,this.data["its.dv14.RedownloadButton"]?this.data["its.dv14.RedownloadButton"].localContent=this._localContent:this.data["its.dv14.RedownloadButton"]={localContent:this._localContent}},getStackTemplateFromElement:function(e){var t=e.querySelector("grid"),n=t.getAttribute("class");
return its.dv14.Util.UI.isLandscape()&&its.sf.Platform.iPad()?t.setAttribute("class",n+=" two-column"):t.setAttribute("class",n.replace(" two-column","")),t},_showCancelButton:function(){this._navBarElement.replaceTokenWithElement("doneButton",its.sf14.ComponentUtil.createButton(this,its.loc("Cancel"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left",id:"cancel-button"},this._handleCancelButtonClick.bind(this),!0))},_hideCancelButton:function(){this._navBarElement.replaceTokenWithElement("doneButton",its.sf14.ComponentUtil.createText(this,"",{},!0))},_createScrollableCellController:function(e){return new its.sf14.ScrollableCellController.BooksPurchasesPage(this,e,this._contentIds,{updates:this.pageData.updates})},_handleEditOrClearButtonClick:function(){this._isEditMode?(its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE),this._hidePurchases()):its.notifications.publish(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE)},_handleCancelButtonClick:function(){this._lockupsToRemove={},this._isEditMode&&its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE)},_enterPurchasesEditModeCallback:function(e){return this._enterPurchasesEditMode||(this._enterPurchasesEditMode=function(e){e=e||{},this._navBarDocument=e.navBar||this._document,this._navBarElement=e.navBarElement||this._element,this._lockupsToRemove={},this._adamIdsToRemove=[],this._itemsToHide=0,this._isEditMode=!0,this._editClearButton=this._navBarDocument.getElementById("edit-or-clear-button"),this._doneButton=this._navBarDocument.getElementById("cancel-button"),this._gridElements=this._document.getElementById("purchases-stack-grid"),this._gridElements.setAttribute("editMode",this._isEditMode),this._showCancelButton(),this._editClearButton.textContent=its.loc("DV14.PurchasesPage.Hide"),this._editClearButton.setAttribute("disabled","true")}.bind(this)),this._enterPurchasesEditMode},_hidePurchases:function(){var e=this.data.hideUrl;
if(this._adamIdsToRemove.length){var t=its.url.appendUrlParameter(e,"ids",this._adamIdsToRemove.join(",")),n=function(){for(var e in this._lockupsToRemove)this._lockupsToRemove.hasOwnProperty(e)&&this._lockupsToRemove[e]&&this._lockupsToRemove[e].remove()}.bind(this),r=function(){var e={type:"error",title:its.loc("DV14.PurchasesPage.Dialog.Error"),neutral:{text:its.loc("OK")}},t=its.sf14.BaseDocument.renderDocumentWithData("dialog_document",e,its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:t,options:{type:"error"},pageTarget:its.sf14.PageController.PageTarget.MODAL})}.bind(this);
its.sf14.Util.getJSON(t,n,r)}},_hidePurchasesEnabled:function(){return this._iTunesPurchasesDsid==its.sf.Client.dsId()},_exitPurchasesEditModeCallback:function(){return this._exitWishListEditMode||(this._exitWishListEditMode=function(){this._adamIdsToRemove=[];
for(var e in this._lockupsToRemove)this._lockupsToRemove.hasOwnProperty(e)&&this._adamIdsToRemove.push(e);
this._adamIdsToRemove.length&&this._hidePurchases(),this._editClearButton.textContent=its.loc("Edit"),this._editClearButton.setAttribute("disabled","false"),this._isEditMode=!1,this._gridElements.setAttribute("editMode",this._isEditMode),this._hideCancelButton()}.bind(this)),this._exitWishListEditMode},_editModeItemSelectionToggeledCallback:function(){return this._editModeItemSelectionToggeled||(this._editModeItemSelectionToggeled=function(e){var t=e.target,n=t.getAttribute("data-content-id"),r=t.querySelector("input"),i=r.getAttribute("selected");
i=="true"&&!this._lockupsToRemove[n]?(this._lockupsToRemove[n]=t,this._itemsToHide++):this._lockupsToRemove[n]&&(delete this._lockupsToRemove[n],this._itemsToHide--);
var s;
this._itemsToHide>0?s=its.loc("DV14.PurchasesPage.HideWithCount",{count:this._itemsToHide}):s=its.loc("DV14.PurchasesPage.Hide"),its.notifications.publish(its.dv14.PurchasesContentPage.Events.UPDATE_EDIT_CLEAR_BUTTON,{buttonLabel:s,isDisabled:this._itemsToHide==0})}.bind(this)),this._editModeItemSelectionToggeled},_updateEditClearButtonCallback:function(){return this._updateEditClearButton||(this._updateEditClearButton=function(e){var t=this._navBarDocument.getElementById("edit-or-clear-button");
e.buttonLabel&&(t.textContent=e.buttonLabel);
var n=e.isDisabled;
if(!its.isDefined(n)){var r=this._tabbedPane.selectedTabId();
n=!this._tabs[r].hasContent()}n?t.setAttribute("disabled","true"):t.setAttribute("disabled","false")}.bind(this)),this._updateEditClearButton},onOrientationChange:function(e){e.newOrientation=="landscape"&&its.notifications.publish(its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE)}}),its.dv14.PurchasesContentPage.Events={UPDATE_EDIT_CLEAR_BUTTON:"this.subscribe(its.dv14.PurchasesContentPage.Events.UPDATE_EDIT_CLEAR_BUTTON"},its.dv14.PurchasesContentPage.ArtistBased=Class.createSubclass("its.dv14.PurchasesContentPage.ArtistBased",its.dv14.PurchasesContentPage,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("pages/dv14_purchases_content_page/artist_based"),this._backingIdsMap=this.pageData.backingIdsMap},getStackTemplateFromElement:function(e){var t=e.querySelector("section");
return t},_createScrollableCellController:function(e){var t={suppressPersonalization:!1,showOrdinal:this._showOrdinal,primaryContentIdToBackingIds:this._backingIdsMap};
return new its.sf14.ScrollableCellController.PurchasesPlaylist(this,e,this._contentIds,t)}}),its.dv14.PurchasesMediaTypeNavigatorPage=Class.createSubclass("its.dv14.PurchasesMediaTypeNavigatorPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this._mediaTypeData=this.pageData.mediaTypeData,this._mediaType=this.pageData.mediaType,this._iTunesPurchasesDsid=this.pageData.dsid,this._navigationItemsMap=this._mediaTypeData.artists||this._mediaTypeData.genres,this._allContentIds=its.reflect.keys(this._mediaTypeData.content),this._localContent={},this._localContentIds=[],this._notOnDevice=[],this._shouldRefreshLocalContent=!0,this._selectedListItem=null,this._template=its.Templates.get("pages/dv14_purchases_media_type_navigator_page"),this.subscribe(its.sf14.Events.LIBRARY_CHANGE,function(){this._shouldRefreshLocalContent=!0}.bind(this))},restoreData:function(){return{title:its.loc("Purchases")}},render:function(){return this._template.replaceToken("navigationTitle",its.loc(this._mediaType.locKey)),!its.sf.Platform.iPad()&&!its.dv14.Util.UI.displayModeSplitView()&&this._template.keepBlock("showTitle",!0),this._element=this._template.composeAsElement(),this._element.replaceTokenWithElement("tabbedPane",this._renderTabbedPane()),this.addDocumentStyles(this._element,{}),this._element},_renderTabbedPane:function(){var e={panes:this.panesToShow(),alwaysForceRefeshTabs:!0,"its.dv14.Pills":{pinStyle:its.dv14.ProductPageUtil.PinStyle.ALONE,showDivider:!0,pillClass:"pills"}};
return this.renderComponentWithData("tabbed_pane",e)},panesToShow:function(){return[{title:its.loc("All"),callback:this._refreshLocalContentAndRenderListItems.bind(this),tabId:its.dv14.PurchasesMediaTypeNavigatorPage.Pills.ALL},{title:its.loc("DV14.PurchasesPage.Pills.NotOn."+Device.model.replace(/\s.+/,"")),callback:this._refreshLocalContentAndRenderListItems.bind(this),tabId:its.dv14.PurchasesMediaTypeNavigatorPage.Pills.NOT_ON_THIS_DEVICE}]},_refreshLocalContentAndRenderListItems:function(e,t){this._shouldRefreshLocalContent?itms.findLibraryItems(this._allContentIds,function(n){this._localContent=n,this._shouldRefreshLocalContent=!1,this._renderList(e,t),this._localContentIds=[];
for(var r in n)n.hasOwnProperty(r)&&this._localContentIds.push(r);
this._notOnDevice=this._allContentIds.filter(function(e){return this._localContentIds.indexOf(e)==-1},this)}.bind(this)):this._renderList(e,t)},_renderList:function(e,t){this._renderListItems(e,t)},_renderListItems:function(e,t){var n,r=this._mediaType.name=="audiobooks",i=this._mediaType==its.dv14.PurchasesPage.MediaTypes.music,s=its.Templates.get("pages/dv14_purchases_media_type_navigator_page/grid"),o=[];
this._localContentIds=[];
for(var u in this._localContent)this._localContent.hasOwnProperty(u)&&this._localContentIds.push(u);
var a;
if(r){var f={contentIds:e==its.dv14.PurchasesMediaTypeNavigatorPage.Pills.NOT_ON_THIS_DEVICE?this._notOnDevice:this._allContentIds,name:r?its.loc("DV14.PurchasesPage.AllAudiobooks"):its.loc("DV14.PurchasesPage.AllBooks")},l=this._composeListItem(f,!1);
o.push(l),a=f}this._navigationItemsMap?n=this._filterNavigationItemsForLocalContent(this._navigationItemsMap,e):n={orderedKeys:[]};
for(var c=0;
c<n.orderedKeys.length;
c++){var h=n.orderedKeys[c],p=n[h];
if(!p)continue;var d=this._selectedListItem==p.name;
d&&(a=p),o.push(this._composeListItem(p,d))}if(!n.orderedKeys.length){a&&this._publishListItemData(a);
var v="DV14.PurchasesPage.NoPurchasedMusic",m="DV14.PurchasesPage.NoPurchasedAudiobooks",g="DV14.PurchasesPage.NoPurchasedBooks",y=i?v:r?m:g,b=its.loc(y),w={contentIds:[],explanation:b};
if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView())this._publishListItemData(w),s.replaceTokenUnescaped("listItems",o.join(" ")),t.appendChild(s.composeAsElement())}else s.replaceTokenUnescaped("listItems",o.join(" ")),a&&this._publishListItemData(a),t.appendChild(s.composeAsElement())},_filterNavigationItemsForLocalContent:function(e,t){var n=JSON.parse(JSON.stringify(e)),r=this._mediaType==its.dv14.PurchasesPage.MediaTypes.music;
if(t==its.dv14.PurchasesMediaTypeNavigatorPage.Pills.NOT_ON_THIS_DEVICE){var i=function(e){return!its.isDefinedNonNull(this._localContent[e])},s=function(e){return a.playlists[e].length>0};
for(var o in n.orderedKeys){var u=n.orderedKeys[o],a=n[u];
if(a&&a.playlists){for(var f in a.playlists.orderedKeys){var l=a.playlists.orderedKeys[f];
a.playlists[l]=a.playlists[l].filter(i,this)}a.playlists.orderedKeys=a.playlists.orderedKeys.filter(s)}a.tracks&&(a.tracks=a.tracks.filter(i,this)),a.contentIds&&(a.contentIds=a.contentIds.filter(i,this))}}if(r){var c=function(e){return n[e]&&n[e].playlists&&n[e].playlists.orderedKeys.length>0};
n.orderedKeys=n.orderedKeys.filter(c)}return n},_composeListItem:function(e,t){var n=e.name;
n==its.dv14.PurchasesPage.ALL_CONTENT_ID?n=its.loc("DV14.PurchasesPage.AllContent."+this._mediaType.name):n==its.dv14.PurchasesPage.RECENT_CONTENT_ID&&(n=its.loc("DV14.PurchasesPage.RecentPurchases"));
var r=its.Templates.get("pages/dv14_purchases_media_type_navigator_page/list_item");
r.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,n,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":["pramary-color purchases-navigation-item"]}})),e.contentIds&&r.replaceToken("count",e.contentIds.length);
var i=r.compose();
return this.subscribeToTarget(its.sf14.Events.SELECT,function(t){this._onListItemSelected(e,t.target)}.bind(this),i.itsId()),i},_onListItemSelected:function(e,t){this._selectedListItem=e.name,this._publishListItemData(e,t)},_publishListItemData:function(e,t){its.notifications.publish(its.dv14.PurchasesMediaTypeSelectorPage.Events.NAVIGATION_ITEM_SELECTED,{data:e,mediaType:this._mediaType,dsid:this._iTunesPurchasesDsid},undefined,t)},onOrientationChange:function(e){e.newOrientation=="landscape"&&its.notifications.publish(its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE)}}),its.dv14.PurchasesMediaTypeNavigatorPage.Apps=Class.createSubclass("its.dv14.PurchasesMediaTypeNavigatorPage.Apps",its.dv14.PurchasesMediaTypeNavigatorPage,{_renderListItems:function(e,t){var n=its.Templates.get("pages/dv14_purchases_media_type_navigator_page/grid"),r=[],i=this._mediaTypeData.iphone.genres;
for(var s=0;
s<i.orderedKeys.length;
s++){var o=i[i.orderedKeys[s]];
r.push(this._composeListItem(o))}n.replaceTokenUnescaped("listItems",r.join(" ")),t.appendChild(n.composeAsElement())}}),its.dv14.PurchasesMediaTypeNavigatorPage.Events={ARTIST_NAVIGATION_ITEM_SELECTED:"its.dv14.PurchasesMediaTypeSelectorPage.Events.ARTIST_NAVIGATION_ITEM_SELECTED",NAVIGATION_ITEM_SELECTED:"its.dv14.PurchasesMediaTypeSelectorPage.Events.NAVIGATION_ITEM_SELECTED"},its.dv14.PurchasesMediaTypeNavigatorPage.Pills={ALL:"its.dv14.PurchasesMediaTypeNavigatorPage.Pills.ALL",NOT_ON_THIS_DEVICE:"its.dv14.PurchasesMediaTypeNavigatorPage.Pills.NOT_ON_THIS_DEVICE"},its.dv14.PurchasesMediaTypeSelectorPage=Class.createSubclass("its.dv14.PurchasesMediaTypeSelectorPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this._familyMembers=its.sf.PurchasesUtil.getSpMembersToDisplay(this.pageData.spMembers,!1),this._template=its.Templates.get("pages/dv14_purchases_media_type_selector_page"),this._iTunesPurchasesDsid=this.pageData.dsid},restoreData:function(){return{title:its.loc("Purchases")}},render:function(){var e=this.pageData.displayName?this.pageData.displayName:its.loc("Purchases");
return this._template.replaceToken("navigationTitle",e),!its.sf.Platform.iPad()&&!its.dv14.Util.UI.displayModeSplitView()&&this._template.keepBlock("showTitle",!0),this._renderFamilyMembersSelectors(),this._renderMediaTypeSelectors(),this._element=this._template.composeAsElement(),this.addDocumentStyles(this._element,{}),this._element},_renderMediaTypeSelectors:function(){this._familyMembers&&this._familyMembers.length&&(this._template.keepBlock("hasFamilyMembers",!0),this._template.replaceToken("yourPurchases",its.loc("DV14.PurchasesPage.YourPurchases")));
var e=this._template.getBlock("mediaTypeLockupLoop");
this.pageData.mediaTypesToShow.indexOf(its.dv14.PurchasesPage.MediaTypes.music.name)>=0&&(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.music)),e.next());
const t=its.dv14.PageController.shouldShowStopPageForPageTarget("movies");
this.pageData.mediaTypesToShow.indexOf(its.dv14.PurchasesPage.MediaTypes.movies.name)>=0&&!t&&(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.movies)),e.next());
const n=its.dv14.PageController.shouldShowStopPageForPageTarget("tv");
this.pageData.mediaTypesToShow.indexOf(its.dv14.PurchasesPage.MediaTypes.tv.name)>=0&&!n&&(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.tv)),e.next()),its.dv14.Util.Client.isAppStore()&&(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.apps)),e.next()),its.dv14.Util.Client.isIBooks()&&(this.pageData.displayName||(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.updates)),e.next()),e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.books)),e.next(),this.pageData.mediaTypesToShow.indexOf(its.dv14.PurchasesPage.MediaTypes.audiobooks.name)>=0&&(e.replaceTokenUnescaped("mediaTypeLockup",this._composeMediaTypeItem(its.dv14.PurchasesPage.MediaTypes.audiobooks)),e.next()))},_composeMediaTypeItem:function(e){var t=its.Templates.get("pages/dv14_purchases_media_type_selector_page/media_type_lockup");
t.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString({"data-mt":e.id})),t.replaceToken("glyphUrl",its.serverData.constants.resourceBaseUrl+"/images/purchases-page/"+e.name+(Device.pixelRatio>1?"@"+Device.pixelRatio+"x.png":".png")),t.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,its.loc(e.locKey),{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":["primary-color purchases-navigation-item"]}}));
var n=t.compose();
return this.subscribeToTarget(its.sf14.Events.SELECT,this._onMediaTypeSelected.bind(this),n.itsId()),n},_onMediaTypeSelected:function(e){var t=e.target,n=its.dv14.PurchasesPage.MediaTypes.mediaTypeForId(t.getAttribute("data-mt"));
if(!n){this._upDatesSelected(e);
return}var r=n===its.dv14.PurchasesPage.MediaTypes.music,i=r?null:this._dataForMediaType(n,this._iTunesPurchasesDsid),s=its.dv14.LoadingDocument.createLoadingDocument(null,null,null,!0);
if(i)its.notifications.publish(its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED_WITH_DATA,{data:i,mediaType:n,dsid:this._iTunesPurchasesDsid});
else{its.notifications.publish(its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED,{loadingDocument:s,mediaType:n});
var o=function(e){this._saveMediaTypeData(e,n,this._iTunesPurchasesDsid),its.notifications.publish(its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED_WITH_DATA,{data:this._dataForMediaType(n,this._iTunesPurchasesDsid),loadingDocument:s,mediaType:n,dsid:this._iTunesPurchasesDsid})}.bind(this);
this._fetchMediaTypeData(n,this._iTunesPurchasesDsid,o)}},_upDatesSelected:function(e){var t=iBooksContent.getLocalContent["local-books"],n=itms.getBag()["view-book-updates"],r=this._createLocalBooksXML(t),i=function(e,t){e.contentIds=[];
for(var n in e.updates)e.updates.hasOwnProperty(n)&&e.contentIds.push(n);
its.notifications.publish(its.dv14.PurchasesMediaTypeSelectorPage.Events.UPDATES_SELECTED_WITH_DATA,{data:e,mediaType:11})}.bind(this),s=function(){console.log("failure getting updates")}.bind(this);
its.sf14.Util.postJSON(n,r,i,s,!0)},_createLocalBooksXML:function(e){var t='<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>local-books</key><array>';
for(var n=0;
n<e.length;
n++)t+="<dict><key>adam-id</key><integer>"+e[n]["adam-id"]+"</integer><key>installed-version-identifier</key><integer>"+e[n]["installed-version-identifier"]+"</integer></dict>";
return t+="</array></dict></plist>",t},_dataForMediaType:function(e,t){var n,r=this.pageData[e.name];
if(r){var i=t;
n=r[i]}return n},_fetchMediaTypeData:function(e,t,n){var r={dataOnly:!0,mt:e.id,restoreMode:this._isRestoreMode};
t&&this._iTunesPurchasesDsid&&(r.spDsid=this._iTunesPurchasesDsid);
var i=its.url.appendUrlParameters(this.lookup("pageUrl"),r);
its.sf14.Util.fetchServerGetResponse(i,function(e){var t=its.string.evalJson(e.responseText);
n(t)})},_saveMediaTypeData:function(e,t,n){e.personalizedData&&this.storePlatform._cachePersonalizedData(e.personalizedData),this.pageData[t.name]||(this.pageData[t.name]={}),this.pageData[t.name][n]=e.lockerData},_renderFamilyMembersSelectors:function(){var e=this._familyMembers;
if(e&&e.length>0){this._template.keepBlock("hasFamilyMembers",!0),this._template.replaceToken("familyPurchases",its.loc("DV14.PurchasesPage.FamilyPurchases"));
var t=this._template.getBlock("familyMembersLockupLoop");
for(var n=0;
n<e.length;
++n){var r=e[n];
r.iTunesPreferredDsid!=itms.DSID&&(t.replaceTokenUnescaped("familyMemberLockup",this._composeFamilyMemberLockup(r)),t.next())}}},_composeFamilyMemberLockup:function(e){var t=its.Templates.get("pages/dv14_purchases_media_type_selector_page/family_member_lockup");
t.replaceTokenUnescaped("preferredDsid",e.iTunesPreferredDsid),t.replaceTokenUnescaped("title",its.sf14.ComponentUtil.createText(this,e.displayName,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":["purchases-navigation-item"]}})),t.replaceToken("avatarImage",e.imageUrl);
var n=t.compose();
return this.subscribeToTarget(its.sf14.Events.SELECT,this._onFamilyMemeberSelected.bind(this),n.itsId()),n},_onFamilyMemeberSelected:function(e){var t=e.target,n=JSON.parse(JSON.stringify(this.pageData));
delete n.spMembers,n.dsid=t.getAttribute("data-itunes-preferred-dsid"),n.displayName=t.querySelector("title").textContent;
if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()){this._leftNavigationDocument=getActiveDocument().getElementsByTagName("splitViewTemplate").item().getFeature("leftNavigationDocument");
var r=its.sf14.BaseDocument.renderDocumentWithData("purchases_media_type_selector_page",{pageData:n,pageUrl:this.data.pageUrl,storePlatform:this.storePlatform},its.dv14.PageController.getDocumentSize(null,null,this._leftNavigationDocument));
this._leftNavigationDocument.pushDocument(r,e)}else if(e.eventInfo.targetId){var r=its.sf14.BaseDocument.renderDocumentWithData("purchases_media_type_selector_page",{pageData:n,pageUrl:this.data.pageUrl,storePlatform:this.storePlatform},its.dv14.PageController.getDocumentSize(e.pageTarget,e.target));
its.dv14.PageController.pushDocument(r,e)}},onOrientationChange:function(e){e.newOrientation=="landscape"&&its.notifications.publish(its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE)}}),its.dv14.PurchasesMediaTypeSelectorPage.Events={MEDIA_TYPE_SELECTED:"its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED",MEDIA_TYPE_SELECTED_WITH_DATA:"its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED_WITH_DATA",NAVIGATION_ITEM_SELECTED:"its.dv14.PurchasesMediaTypeSelectorPage.Events.NAVIGATION_ITEM_SELECTED",UPDATES_SELECTED_WITH_DATA:"its.dv14.PurchasesMediaTypeSelectorPage.Events.UPDATES_SELECTED_WITH_DATA"},its.dv14.PurchasesPage=Class.createSubclass("its.dv14.PurchasesPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this._familyMembers=its.sf.PurchasesUtil.getSpMembersToDisplay(this.pageData.spMembers,!1),its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()?this._template=its.Templates.get("pages/dv14_purchases_page"):this._template=its.Templates.get("pages/dv14_purchases_media_type_selector_page"),this.subscribe(its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED,this._onMediaTypeSelect.bind(this)),this.subscribe(its.dv14.PurchasesMediaTypeSelectorPage.Events.MEDIA_TYPE_SELECTED_WITH_DATA,this._onMediaTypeSelectWithData.bind(this)),this.subscribe(its.dv14.PurchasesMediaTypeSelectorPage.Events.UPDATES_SELECTED_WITH_DATA,this._onUpdatesSelectWithData.bind(this)),this.subscribe(its.dv14.PurchasesMediaTypeSelectorPage.Events.NAVIGATION_ITEM_SELECTED,this._onNavigationItemSelected.bind(this)),this.subscribe(its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE,this._orientationChange.bind(this)),this.subscribe(its.sf14.Events.LIBRARY_CHANGE,this._handleLibraryChange.bind(this))},restoreData:function(){return{title:its.loc("Purchases")}},render:function(){return this._template.replaceToken("navigationTitle",its.loc("Purchases")),this._element=this._template.composeAsElement(),!its.sf.Platform.iPad()&&!its.dv14.Util.UI.displayModeSplitView()?this._mediaTypeSelectorPageCallback():(this._splitViewTemplate=this._element.querySelector("splitViewTemplate"),this._leftNavigationDocument=this._splitViewTemplate.getFeature("leftNavigationDocument"),this._rightNavigationDocument=this._splitViewTemplate.getFeature("rightNavigationDocument"),this._setupNavigationDocuments(),this.addDocumentStyles(this._element,{}),this._element)},_composeSearchField:function(){var e={placeholderText:its.loc("DV14.PurchasesPage.SearchPurchases")};
return this._searchFieldComponent=this.componentWithData("search_field",e),this._searchFieldComponent.renderAsString()},_setupNavigationDocuments:function(){this._leftNavigationDocument.pushDocument(this._mediaTypeSelectorPageCallback(this._leftNavigationDocument)),this._rightNavigationDocument.pushDocument(this._contentUnavailablePageCallback(its.loc("Purchases"),this._rightNavigationDocument))},_mediaTypeSelectorPageCallback:function(e){return this.__mediaTypeSelectorPage||(this.__mediaTypeSelectorPage=its.sf14.BaseDocument.renderDocumentWithData("purchases_media_type_selector_page",{pageData:this.pageData,pageUrl:this.documentUrl(),storePlatform:this.storePlatform},its.dv14.PageController.getDocumentSize(null,null,e))),this.__mediaTypeSelectorPage},_contentUnavailablePageCallback:function(e,t){return this._contentUnavailablePage=its.sf14.BaseDocument.renderDocumentWithData("error_page",{img:{url:its.serverData.constants.resourceBaseUrl+"/images/purchases-page/PurchasedUpdatesIcon"+(its.sf.Platform.iPad()?"iPad":"")+(Device.pixelRatio>1?"@"+Device.pixelRatio+"x.png":".png"),width:50,height:50},explanation:its.loc("DV14.PurchasesPage.ChooseMediaType"),hideSearch:!0,title:e},its.dv14.PageController.getDocumentSize(null,null,t)),this._contentUnavailablePage},_onMediaTypeSelect:function(e){this._logger.debug(["---------- _onMediaTypeSelect: ",e]),its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()?(this._leftNavigationDocument.pushDocument(e.loadingDocument),this.pageData.isUpdates||this._showEditButton()):its.dv14.PageController.pushDocument(e.loadingDocument,e)},_showEditButton:function(){},_hideEditButton:function(){this._element.replaceTokenWithElement("editOrClearButton",its.sf14.ComponentUtil.createText(this,"",{},!0))},_showCancelButton:function(){this._element.replaceTokenWithElement("doneButton",its.sf14.ComponentUtil.createButton(this,its.loc("Cancel"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"align-left",id:"cancel-button"},this._handleDoneButtonClick.bind(this),!0))},_hideCancelButton:function(){this._element.replaceTokenWithElement("doneButton",its.sf14.ComponentUtil.createText(this,"",{},!0))},_handleEditOrClearButtonClick:function(){if(!this._isEditMode){this._isEditMode=!0;
var e={};
if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView())e.document=this._rightNavigationDocument,e.navBar=this._document,e.navBarElement=this._element;
this._showEditButton(),its.notifications.publish(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE,e)}else this._isEditMode=!1,its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE)},_handleDoneButtonClick:function(){this._isEditMode&&its.notifications.publish(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE)},_onMediaTypeSelectWithData:function(e){this._logger.debug(["---------- _onMediaTypeSelectWithData: ",e]);
var t={mediaTypeData:e.data,mediaType:e.mediaType,dsid:e.dsid},n=e.mediaType==its.dv14.PurchasesPage.MediaTypes.apps?"purchases_media_type_navigator_page_apps":"purchases_media_type_navigator_page",r=its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()?its.dv14.PageController.getDocumentSize(null,null,this._leftNavigationDocument):its.dv14.PageController.getDocumentSize(e.pageTarget,e.target),i=its.sf14.BaseDocument.renderDocumentWithData(n,{pageData:t,storePlatform:this.storePlatform},r);
e.loadingDocument?e.loadingDocument.replace(i):its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()?(this._leftNavigationDocument.pushDocument(i,e),this._showEditButton()):its.dv14.PageController.pushDocument(i,e)},_onUpdatesSelectWithData:function(e){this._logger.debug(["---------- _onUpdatesSelectWithData: ",e]);
var t=its.dv14.PageController.getDocumentSize(e.pageTarget,e.target);
if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView())t=its.dv14.PageController.getDocumentSize(null,null,this._rightNavigationDocument);
var n,r={updates:e.data.updates,mediaType:e.mediaType};
r.contentIds=e.data.contentIds,r.isUpdates=!0;
if(r.contentIds.length){var i=e.mediaType==its.dv14.PurchasesPage.MediaTypes.tv||e.mediaType==its.dv14.PurchasesPage.MediaTypes.music?"purchases_artist_based_content_page":"purchases_content_page";
n=its.sf14.BaseDocument.renderDocumentWithData(i,{pageData:r,storePlatform:this.storePlatform},t)}else n=its.sf14.BaseDocument.renderDocumentWithData("error_page",{explanation:its.loc("DV14.PurchasesPage.NoUpdates"),hideSearch:!0},t);
if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView())if(this._rightNavigationDocument.documents.length>0){var s=this._rightNavigationDocument.documents[0];
this._rightNavigationDocument.replaceDocument(n,s,{animated:!1})}else this._rightNavigationDocument.pushDocument(n);
else its.dv14.PageController.pushDocument(n,e)},_onNavigationItemSelected:function(e){var t;
this._logger.debug(["---------- _onNavigationItemSelected: ",e]);
var n=its.dv14.PageController.getDocumentSize(e.pageTarget,e.target);
its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView()?n=its.dv14.PageController.getDocumentSize(null,null,this._rightNavigationDocument):e.eventInfo.targetId&&its.dv14.PageController.pushDocument(t,e);
var r={mediaType:e.mediaType};
e.data.playlists?(r.contentIds=e.data.playlists.orderedKeys,r.backingIdsMap=e.data.playlists):e.data.contentIds&&(r.contentIds=e.data.contentIds);
if(r.contentIds.length){var i=e.mediaType==its.dv14.PurchasesPage.MediaTypes.tv||e.mediaType==its.dv14.PurchasesPage.MediaTypes.music?"purchases_artist_based_content_page":"purchases_content_page";
t=its.sf14.BaseDocument.renderDocumentWithData(i,{pageData:r,storePlatform:this.storePlatform,hideUrl:this.pageData.hideUrl},n)}else{var s,o=e.mediaType.name=="audiobooks",u=e.mediaType.name=="music";
if(e.dsid&&e.dsid!==its.sf.Client.dsId()){var a="DV14.PurchasesPage.NoPurchasedMusic",f="DV14.PurchasesPage.NoFamilyPurchasedAudiobooks",l="DV14.PurchasesPage.NoFamilyPurchasedBooks",c=u?a:o?f:l,h=its.sf.PurchasesUtil.getSpmemberData(this._familyMembers,e.dsid);
s=its.locWithMarkupTokens(c,{FirstName:h.firstName,LastName:h.lastName})}else u?s=its.loc("DV14.PurchasesPage.NoPurchasedMusic"):s=o?its.loc("DV14.PurchasesPage.NoPurchasedAudiobooks"):its.loc("DV14.PurchasesPage.NoPurchasedBooks");
t=its.sf14.BaseDocument.renderDocumentWithData("error_page",{explanation:s},n)}if(its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView())if(this._rightNavigationDocument.documents.length>0){var p=this._rightNavigationDocument.documents[0];
this._rightNavigationDocument.replaceDocument(t,p,{animated:!1})}else this._rightNavigationDocument.pushDocument(t);
else e.eventInfo.targetId&&its.dv14.PageController.pushDocument(t,e)},_handleLibraryChange:function(e){console.log("library change"),its.sf14.PageController.hasLoadedPurchases=!1},_orientationChange:function(e){if(its.dv14.Util.UI.shouldToggleSplitView()){console.log("pub orient change");
var t=its.sf14.BaseDocument.documentWithData("purchases_page",this.data,its.dv14.PageController.getDocumentSize(null,null,getActiveDocument().navigationDocument)),n=getActiveDocument().navigationDocument.documents;
for(var r=1;
r<n.length;
r++)getActiveDocument().navigationDocument.removeDocument(n[r]);
getActiveDocument().navigationDocument.replaceDocument(t.renderDocument(),n[0],{animated:!1})}},onOrientationChange:function(e){its.notifications.publish(its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE)}}),its.dv14.PurchasesPage.Events={ORIENTATION_CHANGE:"its.dv14.PurchasesPage.Events.ORIENTATION_CHANGE"},its.dv14.PurchasesPage.MediaTypes={music:{id:its.serverData.constants.MZMediaType.Music.id,name:"music",locKey:"DT6.PurchasesPage.Pills.Music"},tv:{id:its.serverData.constants.MZMediaType.TVShows.id,name:"tv",locKey:"DT6.PurchasesPage.Pills.TvShows"},movies:{id:its.serverData.constants.MZMediaType.Movies.id,name:"movies",locKey:"DT6.PurchasesPage.Pills.Movies"},apps:{id:its.serverData.constants.MZMediaType.MobileSoftware.id,name:"apps",locKey:"DT6.PurchasesPage.Pills.Apps"},books:{id:its.serverData.constants.MZMediaType.EBooks.id,name:"books",locKey:"DT6.PurchasesPage.Pills.Books"},audiobooks:{id:its.serverData.constants.MZMediaType.Audiobooks.id,name:"audiobooks",locKey:"DV14.PurchasesPage.Audiobooks"},updates:{name:"updates",locKey:"DV14.PurchasesPage.Updates"},mediaTypeForId:function(e){var t=null;
for(var n in this){var r=this[n];
e==r.id&&(t=r)}return t}},its.dv14.PurchasesPage.ALL_CONTENT_ID="all",its.dv14.PurchasesPage.RECENT_CONTENT_ID="recent",its.dv14.RedeemPage=Class.createSubclass("its.dv14.RedeemPage",its.dv14.BaseDocument,{render:function(){var e=its.Templates.get("pages/dv14_redeem_template");
return this.data&&this.data.pageData&&this.data.pageData.code&&e.replaceToken("code",this.data.pageData.code),e.composeAsElement()}}),its.dv14.SearchPage=Class.createSubclass("its.dv14.SearchPage",its.dv14.BaseDocument,{initialize:function(){this.MAX_FETCH_COUNT=10,this.base.apply(this,arguments),this._template=its.Templates.get("pages/dv14_search_page"),this.data.pageData||(this.data.pageData={},this.data.pageData.metricsBase=its.sf14.Util.createMetricsBaseObject(its.sf.Metrics.bagMetricsBase(),"Search","Search")),this._setData(this.data),this._facets={},this._sponsoredSearch=this._sponsoredSearchAccess(),this._resultsRenderState=null,this._relatedSearchesStack=[],this._isSearchFromRelatedSearches=!1,this._isLoading=!1,this.subscribeToTarget(its.sf14.Events.SELECT,this._handleSelect.bind(this),"RelatedSearchesBackButton"),this.subscribe(its.dv14.SearchField.Events.SEARCH_SUBMITTED,this.fetchSearch.bind(this)),this.subscribe(its.dv14.SearchField.Events.TERM_CHANGED,this._handleSearchChanged.bind(this)),this.subscribe(its.sf14.Events.ON_APP_RESUME,this._handleOnAppResume.bind(this)),this.subscribe(its.sf14.Events.ACCOUNT_CHANGE,function(){this._sponsoredSearch=this._sponsoredSearchAccess()}.bind(this)),its.serverData.adsRendered={}},wantsRenderMetrics:function(){return!1},onDidUpdate:function(){this._submitPageRenderIfPossible()},onVisibleImagesLoaded:function(){this._resultsRenderState&&(this._resultsRenderState.hasLoadedImages=!0,this._submitPageRenderIfPossible())},_submitPageRenderIfPossible:function(){if(its.sf14.Metrics.isRenderStateComplete(this._resultsRenderState)){this._resultsRenderState.pageUserReadyTime=Date.now();
var e=this.pageInfo();
its.sf14.Util.transferXHRMetricsData(this._resultsRenderState,e),its.notifications.publish(its.sf14.BaseDocument.Events.TRACK_PAGE_RENDER,{pageInfo:e,target:this._document,renderState:this._resultsRenderState,clientCorrelationKey:this._pageMetricsCorrelationKey}),this._resultsRenderState=null}},render:function(){this._pageElement=this._template.composeAsElement(),this._renderNavigationBar();
var e;
return this._bubbles&&this._bubbles.length?e=this._renderSearchResults():this._term?e=this._renderNoResultsFound():e=this._renderTrendingSearch(),this._setElementForBody(e),this.addDocumentStyles(this._pageElement,{isDarkKind:this.lookup("isDarkKind")}),this.data.initUrl&&this.fetchSearch({url:this.data.initUrl}),this._pageElement},onAppear:function(e){this._sponsoredSearch&&this._metricsOnAppear();
var t=this.pageInfo(!0);
its.notifications.publish(its.sf14.Events.PAGE_APPEAR,{pageInfo:t,target:this._document,clientCorrelationKey:this._pageMetricsCorrelationKey}),this.setDocumentUrl(null)},onDisappear:function(){this.base(),itms.flushUnreportedEvents()},onDocumentSizeChange:function(e){this.base.apply(this,arguments);
var t=this._relatedSearchesStack.pop(),n=its.dv14.Util.UI.isCompact(e.oldSize),r=its.dv14.Util.UI.isCompact(e.newSize);
n!=r&&this._renderNavigationBar();
var i=its.sf14.LockupUtil.willArtworkDimesionsChange(e.oldSize,e.newSize,its.sf.StorePlatform.Kind.MobileApp)||its.sf.Platform.isIPhone6PlusScreenSize()||its.dv14.Util.UI.isCompact(e.oldSize)!=its.dv14.Util.UI.isCompact(e.newSize);
if(!this._isLoading&&i){var s;
this._bubbles&&this._bubbles.length?s=this._renderSearchResults():this._term?s=this._renderNoResultsFound():s=this._renderTrendingSearch(),this._setElementForBody(s)}},onOrientationChange:function(e){this._didRotate=!0;
var t=its.sf14.LockupUtil.willArtworkDimesionsChange(e.oldSize,e.newSize,its.sf.StorePlatform.Kind.MobileApp)||its.sf.Platform.isIPhone6PlusScreenSize()||its.dv14.Util.UI.isCompact(e.oldSize)!=its.dv14.Util.UI.isCompact(e.newSize);
!this._isLoading&&!its.sf.Client.isVersion("10.0")&&t&&(!this._searchFieldValue&&this._elementForTrendingSearch?this._setElementForBody(this._elementForTrendingSearch):this._setElementForBody(this._renderSearchResults()))},restoreData:function(){return{stackId:its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())||its.dv14.Util.Client.isVoyager()?its.sf14.PageController.PageTarget.TRANSIENT:its.sf14.PageController.PageTarget.SEARCH}},hasResults:function(){return this._bubbles&&this._bubbles.length>0},onBuyRequested:function(e){if(e.options.url==this.documentUrl()){var t=e.options.id;
this._handleAskToBuy(this._pageElement,t)}},_metricsOnAppear:function(){this.sendImpressions="";
var e=this,t=its.sf.Metrics.bagMetrics().postFrequencyLowLatency,n=t||5e3;
if(its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0){var r=e._document;
r.onImpressionsChange=function(t){e._lowLatencyImpressions.call(e,t,r),e.sendImpressions||(e.sendImpressions=setTimeout(function(){itms.flushUnreportedEvents(),e.sendImpressions=""},n))}}},_lowLatencyImpressions:function(e,t){var n=t.matchingImpressions("data-metrics-impressions-low-latency",!0),r=its.sf14.Metrics.Events.Impressions.processRecordedImpressions(n).impressionsArray;
if(r.length>0){var i={},s={impressions:r},o=!1,u=100,a=function(){o||(s.iAdId="-1",its.sf.Metrics.recordEvent(new its.sf14.Metrics.Events.Impressions(s,i)),o=!0)};
setTimeout(a,u),itms.getToroID(function(e){o||(s.iAdId=e,its.sf.Metrics.recordEvent(new its.sf14.Metrics.Events.Impressions(s,i)),o=!0)})}},_handleSelect:function(){if(this._relatedSearchesStack.length<2){this._logger.error("Related searches stack too small: "+this._relatedSearchesStack.length);
return}this._isSearchFromRelatedSearches=!0,this._relatedSearchesStack.pop();
var e=this._relatedSearchesStack.pop();
this.fetchSearch({term:e})},setMetricsData:function(e){e&&this._documentUrl&&this._documentUrl.indexOf("group")!=-1&&this._bubbles&&this._bubbles.length==1&&(e.searchFilter=this._bubbles[0].name),this._sponsoredSearch&&its.serverData.iAd&&(e.toroId=this._currentIAdData?this._currentIAdData.toroId:null,e.iAdAdamId=this._currentIAdData&&this._currentIAdData.iAd?this._currentIAdData.iAd.adamId:null),its.dv14.Util.UI.addSearchTermToPageInfo(e)},_sponsoredSearchAccess:function(){var e=itms.getBag().isSponsoredAdsEnabled;
return e!==undefined&&e&&!itms.accountInfo.managedAppleId&&its.dv14.Util.Client.isAppStore()&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0?!0:!1},_renderAllTab:function(e,t){var n=its.Templates.get("pages/dv14_search_page/all_tab");
if(this._bubbles){var r=this._bubbles,i=document.createDocumentFragment();
for(var s=0;
s<r.length;
s++){var o=r[s],u;
o.name==its.dv14.SearchPage.BubbleNames.STATION?u=this.renderComponentWithData("radio_swoosh",this._radioSwoosh):u=this._renderShelf(o),u&&i.appendChild(u)}n.replaceTokenWithElement("resultsStack",i)}var a=n.composeAsElement();
t.appendChild(a)},_renderBubbleAsGrid:function(e){var t=null,n=e.results;
if(n.length>0){var r=[];
for(var i=0;
i<n.length;
i++)r.push(n[i].id);
r=its.dv14.Util.UI.filterUnsupportedPreOrders(this.storePlatform,r);
if(r.length===0&&this._isSoftwareCard())return null;
if(this._sponsoredSearch&&r.length){var s=this.storePlatform.getAllCachedData(r[0]);
for(var i=0;
i<s.length;
i++){var o=s[i];
if(o.iad){var u=o.iad;
u.adamId=o.id,this.setCurrentIAd(u);
break}}}var a={contentIds:r,"its.dv14.SmallLockup":{kindOrName:this._isSoftwareCard()?"appCard":null,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.ROOM,detailsGenerator:this.lockupDetailsGenerator()}};
a["its.dv14.BuyButton"]=Class.extend(this.data["its.dv14.BuyButton"],{isProductDirectlyFromSearch:!0}),this._isCardStyleWhenInShelf(e)&&(a.scrollableCellControllerClass=its.sf14.ScrollableCellController.AppCard,a.classes=["grid divider-none"]),t=this.renderComponentWithData("grid",a)}return t},_renderBubbleTab:function(e,t){this._selectedTabId=e;
var n=this._bubbles[e],r=n.name,i=this._seeAllUrlForBubbleName(r),s=this._tabbedPane.selectedTabElement(),o={};
s&&(o=its.sf.Metrics.Events.Click.location(s)),its.notifications.publish(its.sf14.Events.SEARCH_SUBMITTED,{term:this._term,actionUrl:i,actionDetails:r,actionType:its.dv14.SearchPage.ActionTypes.FILTERS,targetType:"tab",location:o});
var u=this._renderBubbleAsGrid(n);
t.appendChild(u);
var a=function(){this._logger.error("Could not obtain result for "+i)}.bind(this),f=function(e,n){var i=e.pageData.bubbles[0];
this.data._storePlatform.cacheStorePlatformDataForProfiles(e.storePlatformData,!1),t.removeChild(u),t.appendChild(this._renderBubbleAsGrid(i)),this.setXHRMetricsData(n);
var s=this.pageInfo(!0);
s.searchFilter=r,its.notifications.publish(its.sf14.Events.PAGE_APPEAR,{pageInfo:s,target:this._document})}.bind(this);
its.sf14.Util.getJSON(i,f,a)},_onFacetSelected:function(e,t,n){this._facets[e]=t;
var r=[],i;
for(var s in this._facets)i={},i[s]=this._facets[s],r.push(i);
this.fetchSearch({term:this._term,actionDetails:r,location:n,actionType:its.dv14.SearchPage.ActionTypes.FILTERS,targetType:"listItem",shouldUpdateFacets:!1})},_renderLoading:function(){return its.sf14.ComponentUtil.createActivityIndicator(this,its.sf14.Util.UI.loadingText(),!0,!0)},_renderNavigationBar:function(){its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())&&!its.dv14.Util.Client.isVoyager()?this._navigationBarElement=this._renderNavigationBarForRegular():this._navigationBarElement=this._renderNavigationBarForCompact(),this._navigationBarElement.replaceTokenWithElement("relatedSearches",this._renderRelatedSearches()),this._pageElement.replaceTokenWithElement("navigationBar",this._navigationBarElement)},_renderNavigationBarForRegular:function(){var e={facets:this.data.pageData.facets,hideGenreButton:!0,onFacetSelected:this._onFacetSelected.bind(this),navigationTitle:this._labelForBackButton(),"its.dv14.SearchField":{initialSearchTerm:this._searchFieldValue}};
return this._hasTitle()&&(e.title=this._title()),this.renderComponentWithData("search_navigation_bar",e)},_renderNavigationBarForCompact:function(){var e=its.Templates.get("pages/dv14_search_page/navigation_bar"),t=this._labelForBackButton();
this._isSeeAllPage()?(e.replaceTokenWithElement("title",this._renderTitle()),t=this._title()):e.replaceTokenUnescaped("searchField",this._composeSearchField()),e.keepBlock("navigationTitleBlock");
var n=e.getBlock("navigationTitleBlock");
return n.replaceToken("navigationTitle",t),e.replaceTokenWithElement("relatedSearches",this._renderRelatedSearches()),e.composeAsElement()},_composeSearchField:function(){var e={clientApplication:its.dv14.Util.Client.getClientApplication()};
its.dv14.PageController.shouldShowStopPageForPageTarget("tv")&&(e.videos="false");
var t={placeholderText:its.loc("Search"),initialSearchTerm:this._searchFieldValue,isCompact:its.dv14.Util.UI.isCompact(this.size()),hintsUrl:its.url.appendUrlParameters(itms.getBag().searchHints,e)};
return this._searchFieldComponent=this.componentWithData("search_field",t),this._updateSearchFieldAccessoryText(),this._searchFieldComponent.renderAsString()},_updateSearchFieldAccessoryText:function(){(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size())||its.dv14.Util.Client.isVoyager())&&its.dv14.Util.Client.isAppStore()&&this._bubbles&&this._bubbles[0]&&this._searchFieldComponent.updateAccessoryText(its.locWithCount("SF.ResultsCount",this._bubbles[0].totalCount))},_renderNoResults:function(e){var t=its.Templates.get("pages/dv14_search_page/no_results"),n="resource://"+(its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())?"emptySearchLarge":"emptySearch");
t.replaceToken("imgSrc",n);
if(e.message){t.keepBlock("messageBlock");
var r=t.getBlock("messageBlock");
t.replaceToken("message",e.message)}if(e.explanation){t.keepBlock("explanationBlock");
var i=t.getBlock("explanationBlock");
t.replaceToken("explanation",e.explanation)}return t.composeAsElement()},_renderNoResultsFound:function(){return this._renderNoResults({explanation:its.loc("SF.NoResultsFoundForTerm",{searchTerm:this._term})})},_renderRelatedSearches:function(){var e=null,t=this.data.pageData.relatedQueries;
if(t&&t.length>0){var n=its.Templates.get("pages/dv14_search_page/relatedSearches");
if(this._relatedSearchesStack.length>0){n.keepBlock("BackButton");
var r=n.getBlock("BackButton");
r.replaceToken("backButtonText",this._relatedSearchesStack[this._relatedSearchesStack.length-1])}its.dv14.Util.Client.isVoyager()&&n.replaceToken("class","related-searches-messages"),n.replaceToken("relatedLabel",its.loc("SF.RelatedWithColon"));
var i=n.getBlock("searchesLoop");
for(var s=0;
s<t.length;
s++){var o=its.string.trim(t[s].term,""),u=its.sf14.ComponentUtil.createButton(this,o,"link",{"class":"align-center"},function(e){return function(t){this._isSearchFromRelatedSearches=!0;
var n=its.sf.Metrics.Events.Click.location(t.target);
this.fetchSearch({term:e,queryParams:{src:its.dv14.SearchPage.ActionTypes.RELATED},targetType:"button",location:n})}.bind(this)}.bind(this)(o),!0),a=this._getSearchUrl({term:o,queryParams:{src:its.dv14.SearchPage.ActionTypes.RELATED}});
its.sf.Metrics.setTargetInfo(u,null,"button",its.sf.Metrics.ActionType.SELECT,a,{term:o,actionType:its.dv14.SearchPage.ActionTypes.RELATED}),i.replaceTokenWithElement("relatedSearchItem",u),i.next()}e=n.composeAsElement()}else e=document.createElement("placeholder");
return e},_renderSearchResults:function(){(this._term||this._term=="")&&this._relatedSearchesStack.push(this._term),its.serverData.adsRendered={};
var e=this._bubbles;
if(e.length==0)return this._renderNoResultsFound();
var t=its.Templates.get("pages/dv14_search_page/results"),n;
if(e.length==1){n=this._renderBubbleAsGrid(e[0]);
if(!n)return this._renderNoResultsFound()}else n=this._renderTabbedPaneOfResults();
n&&t.replaceTokenWithElement("results",n);
var r=t.composeAsElement();
return its.sf14.Util.addViewableThresholdToTemplateElement(r),r},_renderTabbedPaneOfResults:function(){var e={panes:[],"its.dv14.Pills":{pinStyle:its.dv14.ProductPageUtil.PinStyle.ALONE,pillClass:"tabs",showDivider:!0},activeTabId:this._didRotate?this._selectedTabId:null};
this._didRotate=!1;
var t=this._bubbles;
e.panes.push({title:its.loc("SF6.SearchPage.all"),callback:this._renderAllTab.bind(this),tabId:"its.dv14.SearchPage.Tabs.ALL"});
for(var n=0;
n<t.length;
n++){var r=t[n].name;
r!=its.dv14.SearchPage.BubbleNames.STATION&&e.panes.push({title:its.loc("SF6.SearchPage."+r),callback:this._renderBubbleTab.bind(this),tabId:n,preRenderTab:!1})}return this._tabbedPane=this.componentWithData("tabbed_pane",e),this._tabbedPane.render()},_seeAllUrlForBubbleName:function(e){return this.data.pageData.seeAllUrl+"&group="+e},_renderShelf:function(e){var t=null,n=e.results;
if(n.length>0){var r=[];
for(var i=0;
i<n.length&&i<32;
i++)r.push(n[i].id);
var s={title:its.loc("SF6.SearchPage."+e.name),contentIds:r,type:its.dv14.Swoosh.Type.DEFAULT,suppressPersonalization:this.lookup("suppressPersonalization")};
n.length>4&&(s.link={label:its.loc("See All"),url:this._seeAllUrlForBubbleName(e.name)});
if(this._isCardStyleWhenInShelf(e)){s.scrollableCellControllerClass=its.sf14.ScrollableCellController.AppCard;
if(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size()))s.title=null,s.link=null}else this._isSongStyleWhenInShelf(e)&&(s.additionalCssClasses="shelf-with-rows",s.type=its.dv14.Swoosh.Type.LIST,s.scrollableCellControllerClass=its.sf14.ScrollableCellController.List.Chart,s["its.dv14.SmallLockup"]={titleMaxLines:1});
s["its.dv14.BuyButton"]=Class.extend(this.data["its.dv14.BuyButton"],{isProductDirectlyFromSearch:!0}),t=this.renderComponentWithData("swoosh",s)}return t},_renderTitle:function(){var e=its.Templates.get("pages/dv14_search_page/title");
return e.replaceToken("title",this._title()),e.composeAsElement()},_renderTrendingSearch:function(){this.renderedTrending=Date.now();
var e=its.sf.Platform.iPad()&&its.dv14.Util.Client.isPodcasts()&&its.string.compareNumerically(its.sf.Client.version(),"9.0")>=0;
if(its.sf.Platform.iPhone()||e||its.dv14.Util.UI.isCompact(this.size())||its.dv14.Util.Client.isVoyager()){this._fetchTrendingSearch();
var t=its.Templates.get("pages/dv14_search_page/trending_searches");
return t.composeAsElement()}var n=its.Templates.get("pages/dv14_search_page/results");
return n.composeAsElement()},lockupDetailsGenerator:function(){var e=null;
return this._isSoftwareCard()?e=its.dv14.LockupUtil.SoftwareCardDetailsGenerator:its.dv14.Util.Client.isIBooks()&&(e=its.dv14.LockupUtil.BookDetailsGenerator),e},_abortRunningSearchRequest:function(){its.dv14.SearchPage._runningSearchRequest&&(its.dv14.SearchPage._runningSearchRequest.abort(),its.dv14.SearchPage._runningSearchRequest=null)},_handleSearchChanged:function(e){if(e.term==="")this._abortRunningSearchRequest(),this._elementForTrendingSearch&&!e.refreshTrendingSearches&&its.dv14.Util.UI.isCompact(this.size())?this._setElementForBody(this._elementForTrendingSearch):this._renderTrendingSearch(),(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size())||its.dv14.Util.Client.isVoyager())&&!its.dv14.Util.Client.isPodcasts()&&this._relatedSearchesStack.length>0&&(this._navigationBarElement.replaceTokenWithElement("relatedSearches",document.createElement("placeholder")),this._relatedSearchesStack=[]);
else{var t={term:e.term,targetType:"key",actionUrl:its.dv14.SearchUtil.searchUrlForTerm(e.term)};
its.notifications.publish(its.sf14.Events.SEARCH_SUBMITTED,t)}this._searchFieldValue=e.term},_handleOnAppResume:function(){var e=Date.now();
e-this.renderedTrending>=18e5&&this._renderTrendingSearch()},_getSearchUrl:function(e){var t=its.dv14.SearchUtil.searchUrlForTerm(e.term);
return t=its.url.appendUrlParameters(t,this._facets),e.queryParams&&(t=its.url.appendUrlParameters(t,e.queryParams)),t},fetchSearch:function(e){its.dv14.Util.copyExtRefDataFromDict(e,this.data),this._isLoading=!0,e.url||(e.url=this._getSearchUrl(e)),its.sf14.Metrics.Events.PageRender.isAvailable()&&(its.sf14.Metrics.Events.PageRender.updateInteractionTime(),this._resultsRenderState=its.sf14.Metrics.createRenderState()),this._pageMetricsCorrelationKey=its.sf.Metrics.requestId(),this._shouldUpdateFacets=its.isDefinedNonNull(e.shouldUpdateFacets)?e.shouldUpdateFacets:!0;
if(its.serverData.adsRendered&&this.storePlatform._cache["native-search-lockup"])for(var t in its.serverData.adsRendered)delete this.storePlatform._cache["native-search-lockup"][t];
its.serverData.adsRendered={},its.serverData.iAd=null,this._currentIAdData=null,this._term=e.term||"",this._searchFieldValue=e.term||"",its.notifications.publish(its.dv14.SearchPage.Events.SEARCH_FETCHED,{term:this._term}),this._navigationBarElement.replaceTokenWithElement("relatedSearches",document.createElement("placeholder")),this._searchFieldComponent&&this._searchFieldComponent.updateAccessoryText(""),this._isSearchFromRelatedSearches||(this._relatedSearchesStack=[]),this._isSearchFromRelatedSearches=!1,this._setElementForBody(this._renderLoading());
var n=function(){this._isLoading=!1,this._logger.error("Could not obtain result for "+e.url);
var t="SF.NoResponse.iTunes";
its.dv14.Util.Client.isAppStore()?t="SF.NoResponse.AppStore":its.dv14.Util.Client.isIBooks()?t="SF.NoResponse.iBooks":its.dv14.Util.Client.isVoyager()&&(t="SF.NoResponse.iMessage"),this._setElementForBody(this._renderNoResults({explanation:its.loc(t)}))}.bind(this);
this._reportMetricsSearchEvent(e);
var r=its.url.appendUrlParameters(e.url,{clientApplication:its.dv14.Util.Client.getClientApplication()});
r=its.url.appendUrlParameters(r,{caller:"com.apple.AppStore",version:1});
if(this._sponsoredSearch){var i=itms.getBag().usePostForAppStoreSearch,s=this,o="",u={},a=[];
itms.getSponsoredSearchTargetingDataAndId(function(e){e&&(a.push({name:"X-Apple-iAd-Request-Data",value:e[0]}),u={"X-Apple-iAd-Request-Data":e[0]},this._currentIAdData||(this._currentIAdData={}),this._currentIAdData.toroId=e[1],its.serverData.iAdId=e[1]),i?its.dv14.SearchPage._runningSearchRequest=its.sf14.Util.postJSON(r,u,s._onSearchFetched.bind(s),n,!1,[]):its.dv14.SearchPage._runningSearchRequest=its.sf14.Util.getJSON(r,s._onSearchFetched.bind(s),n,a)}.bind(this))}else i?its.dv14.SearchPage._runningSearchRequest=its.sf14.Util.postJSON(r,{},this._onSearchFetched.bind(this),n,!1,[]):its.dv14.SearchPage._runningSearchRequest=its.sf14.Util.getJSON(r,this._onSearchFetched.bind(this),n)},setCurrentIAd:function(e){e&&(this._currentIAdData||(this._currentIAdData={}),this._currentIAdData.iAd=e)},_reportMetricsSearchEvent:function(e){var t={term:this._term,actionUrl:e.url};
e.searchHintIndex>=0?(t.actionType=its.dv14.SearchPage.ActionTypes.HINT,t.targetId=e.searchHintIndex,t.actionDetails=e.searchHintOriginalTerm,t.location=[{locationPosition:e.searchHintIndex,locationType:"listItem"},{locationPosition:0,locationType:"hintList"}],t.targetType="listItem",t.targetId=e.searchHintIndex):e.queryParams&&e.queryParams.src==its.dv14.SearchPage.ActionTypes.RELATED?t.actionType=its.dv14.SearchPage.ActionTypes.RELATED:e.url&&e.url.indexOf(its.dv14.SearchPage.ActionTypes.TRENDING)!=-1&&(t.actionType=its.dv14.SearchPage.ActionTypes.TRENDING),e.actionDetails&&(t.actionDetails=e.actionDetails,t.actionType=e.actionType),e.location&&(t.location=e.location),e.targetType&&(t.targetType=e.targetType),its.notifications.publish(its.sf14.Events.SEARCH_SUBMITTED,t)},_onSearchFetched:function(e,t){this._isLoading=!1,this._abortRunningSearchRequest(),this._resultsRenderState&&t&&t.metrics&&its.sf14.Util.transferXHRMetricsData(t.metrics,this._resultsRenderState),this._setData(e),this.setXHRMetricsData(t),its.notifications.publish(its.dv14.SearchPage.Events.SEARCH_FETCHED,{facets:this._shouldUpdateFacets?this.data.pageData.facets:null,term:this._term}),this._navigationBarElement&&(this._updateSearchFieldAccessoryText(),this._navigationBarElement.replaceTokenWithElement("relatedSearches",this._renderRelatedSearches())),this._selectedTabId=null,this._setElementForBody(this._renderSearchResults());
var n=this.pageInfo(!0);
this._sponsoredSearch&&its.serverData.iAd&&(n.iAd=its.serverData.iAd),its.notifications.publish(its.sf14.Events.PAGE_APPEAR,{pageInfo:n,target:this._document,clientCorrelationKey:this._pageMetricsCorrelationKey})},_fetchTrendingSearch:function(){var e=itms.getBag()["trending-searches"];
typeof e=="string"&&(e=its.url.appendUrlParameters(e,{maxCount:this.MAX_FETCH_COUNT}),this._sponsoredSearch&&(e=its.url.appendUrlParameters(e,{caller:"com.apple.AppStore",version:1})),its.sf14.Util.getJSON(e,this._onTrendingSearchesFetched.bind(this),this._onTrendingFailure.bind(this)))},_fetchSponsoredTrendingSearch:function(){if(this._sponsoredSearch){var e=this;
itms.getTrendingAdServerURL(function(t){var n=[],r=its.url.appendUrlParameters(t[0],{maxCount:this.MAX_FETCH_COUNT});
itms.getTrendingSearchTargetingData(function(t){n.push({name:"X-Apple-iAd-Request-Data",value:t[0]}),its.sf14.Util.getJSON(r,e._onSponsoredTrendingSearchesFetched.bind(e),e._onTrendingFailure.bind(e),n)})})}},_onTrendingSearchesFetched:function(e){var t=e.trendingSearches,n=its.Templates.get("pages/dv14_search_page/trending_searches");
if(t.length){n.keepBlock("trendingSearchesBlock");
var r=n.getBlock("trendingSearchesBlock");
r.replaceToken("title",its.loc("TrendingSearches.label"));
var i=r.getBlock("searchesLoop");
for(var s=0;
s<t.length;
s++){var o=t[s].label,u=t[s].url,a=its.sf14.ComponentUtil.createButton(this,o,null,{"class":"align-center"},function(e,t){return function(n){var r=its.sf.Metrics.Events.Click.location(n.target);
this.fetchSearch({url:e,term:t,targetType:"button",location:r})}.bind(this)}.bind(this)(u,o),!0);
its.sf.Metrics.setTargetInfo(a,null,"button",its.sf.Metrics.ActionType.SELECT,u,{term:o,actionType:its.dv14.SearchPage.ActionTypes.TRENDING}),i.replaceTokenWithElement("trendingSearchItem",a),i.next()}}this._elementForTrendingSearch=n.composeAsElement(),this._setElementForBody(this._elementForTrendingSearch)},_onSponsoredTrendingSearchesFetched:function(e){var t=e.results&&e.results.length?e.results[0]:"";
if(t){var n=its.Templates.get("pages/dv14_search_page/sponsored_search"),r=t[Object.keys(t)[0]],i=r.name,s=r.url,o=its.sf14.ComponentUtil.createButton(this,i,null,{"class":"align-center"},function(e){return function(e){var t=its.sf.Metrics.Events.Click.location(e.target)}.bind(this)}.bind(this)(s),!0);
n.replaceTokenWithElement("sponsoredSearchItem",o),this._elementForSponsoredSearch=n.composeAsElement(),this._setElementForBody(this._elementForSponsoredSearch)}},_onTrendingFailure:function(){this._logger.debug("Could not obtain result for "+url)},_isShowingRelatedSearches:function(){return its.dv14.Util.Client.isAppStore()&&this.data.pageData.relatedQueries&&this.data.pageData.relatedQueries.length},_hasTitle:function(){return its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())&&!its.dv14.Util.Client.isVoyager()&&!this.data.pageData.facets},_isSeeAllPage:function(){return this.data.pageData.group},_isSoftwareCard:function(){return its.dv14.Util.Client.isAppStore()||its.dv14.Util.Client.isBridge()||its.dv14.Util.Client.isVoyager()},_isSongStyleWhenInShelf:function(e){var t=e.name?e.name:e;
return t==its.dv14.SearchPage.BubbleNames.SONG||t==its.dv14.SearchPage.BubbleNames.TV_EPISODE||t==its.dv14.SearchPage.BubbleNames.PODCAST_EPISODE||t==its.dv14.SearchPage.BubbleNames.ITUNESU_PODCAST_EPISODE||t==its.dv14.SearchPage.BubbleNames.ITUNESU_MATERIAL||t==its.dv14.SearchPage.BubbleNames.STATION||t==its.dv14.SearchPage.BubbleNames.RINGTONE||t==its.dv14.SearchPage.BubbleNames.IOS_TONE},_isCardStyleWhenInShelf:function(e){var t=e.name?e.name:e;
return t==its.dv14.SearchPage.BubbleNames.SOFTWARE||t==its.dv14.SearchPage.BubbleNames.IPAD_SOFTWARE||t==its.dv14.SearchPage.BubbleNames.WATCH_SOFTWARE||t==its.dv14.SearchPage.BubbleNames.MESSAGES_SOFTWARE},_setData:function(e){this.storePlatform.cacheStorePlatformDataForProfiles(e.storePlatformData),this.data.pageData=e.pageData;
var t=e.pageData;
this._bubbles=t.bubbles||[],this._radioSwoosh=t.radioSwoosh,this._term=t.term,this._searchFieldValue=t.term},_labelForBackButton:function(){return its.loc("Search")},_setElementForBody:function(e){this._pageElement.replaceTokenWithElement("body",e)},_title:function(){return this.data.pageData.pageTitle?this.data.pageData.pageTitle:its.loc("Search")},term:function(){return this._term}}),its.dv14.SearchPage._runningSearchRequest=null,its.dv14.SearchPage.initializeSearchPage=function(){if(!this._initialized){var e=its.property("its.dv14.SearchPage.clearSearchTermInterval");
if(e){var t=e*6e4;
setInterval(function(){var e=(its.sf.Platform.iPad()||its.dv14.Util.Client.isVoyager())&&getActiveDocument()==its.App.SearchDocument||(its.sf.Platform.iPhone()||its.dv14.Util.UI.isWindowCompact())&&TabBar.selectedTab.identifier==its.sf14.PageController.PageTarget.SEARCH;
e||its.notifications.publish(its.dv14.SearchPage.Events.CLEAR_SEARCH_TERM)},t)}its.App.SearchDocument=its.sf14.BaseDocument.renderDocumentWithData("search_page",{isDarkKind:!1},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.TRANSIENT)),its.dv14.SearchPage.showSearchPage(!1),this._initialized=!0}},its.dv14.SearchPage.showSearchPage=function(e){var t=!0;
its.isDefinedNonNull(e)&&(t=e);
var n=its.dv14.SearchPage.shouldShowInTransient(),r=n?TabBar.transientTab:its.dv14.PageController.tabForPageTarget(its.sf14.PageController.PageTarget.SEARCH),i=its.dv14.SearchPage.findCurrentSearchTab();
modal&&modal.documents&&modal.documents.length&&its.sf.Platform.iPad()&&modal.clear();
if(r!=i||!its.sf.Client.isVersion("10.0")){i&&i.navigationDocument.clear(),r.navigationDocument.clear(),r.navigationDocument.pushDocument(its.App.SearchDocument);
if(its.dv14.Util.Client.isPodcasts()&&its.isDefinedNonNull(itms.documentSizeForNavigationDocument)){var s=itms.documentSizeForNavigationDocument(r.navigationDocument);
its.App.SearchDocument.componentRepresentation.onViewAttributesChange(s)}}else i==r&&i&&i.navigationDocument&&i.navigationDocument.popToRootDocument();
t&&(TabBar.selectedTab=r)},its.dv14.SearchPage.setSearchLaunchUrl=function(e){its.App.SearchDocument&&its.App.SearchDocument.componentRepresentation.setDocumentUrl(e)},its.dv14.SearchPage.setCurrentIAd=function(e){its.App.SearchDocument&&its.App.SearchDocument.componentRepresentation.setCurrentIAd(e)},its.dv14.SearchPage.fetchSearch=function(e,t){t&&its.dv14.SearchPage.showSearchPage(),its.App.SearchDocument&&its.App.SearchDocument.componentRepresentation.fetchSearch(e)},its.dv14.SearchPage.findCurrentSearchTab=function(){var e=its.App.SearchDocument;
if(e){var t=TabBar.transientTab;
if(t.navigationDocument.documents.indexOf(e)!=-1)return t;
var n=its.dv14.PageController.tabForPageTarget(its.sf14.PageController.PageTarget.SEARCH);
if(n&&n.navigationDocument&&n.navigationDocument.documents&&n.navigationDocument.documents.indexOf(e)!=-1)return n}return null},its.dv14.SearchPage.shouldShowInTransient=function(){return!its.dv14.Util.Client.isPodcasts()&&(its.sf.Platform.iPad()&&!its.dv14.Util.UI.isWindowCompact()||its.dv14.Util.Client.isVoyager()||its.sf.Platform.iPad()&&its.dv14.Util.Client.isIBooks())},its.dv14.SearchPage.onShowSearchPage=function(){its.dv14.Util.UI.isWindowCompact()||its.App.SearchDocument.componentRepresentation.hasResults()||its.dv14.Util.Client.isVoyager()?its.dv14.SearchPage.showSearchPage():TabBar.selectedTab=its.dv14.PageController.tabForPageTarget(its.dv14.PageController.PageTarget.FEATURED)},its.notifications.subscribe(its.sf14.Events.NATIVE_PAGE_TRANSITION,its.dv14.SearchPage.onShowSearchPage,null,null,function(e){var t=TabBar.selectedTab.identifier==its.dv14.PageController.PageTarget.TRANSIENT,n=e.type=="search",r=!0;
if(n){var i=its.dv14.Util.UI.isWindowCompact()&&(e.data.fromPopover||t&&TabBar.transientTab.navigationDocument.documents.length>0&&TabBar.transientTab.navigationDocument.documents[0]==its.App.SearchDocument);
r=i||its.dv14.SearchPage.shouldShowInTransient(),r||(TabBar.selectedTab=TabBar.transientTab)}return n&&r}),its.dv14.SearchPage.Tabs={ALL:"its.dv14.SearchPage.Tabs.ALL"},its.dv14.SearchPage.ActionTypes={FILTERS:"filter",HINT:"hint",RELATED:"related",TRENDING:"trending"},its.dv14.SearchPage.Events={CLEAR_SEARCH_TERM:"its.dv14.SearchPage.Events.CLEAR_SEARCH_TERM",SEARCH_FETCHED:"its.dv14.SearchPage.Events.SEARCH_FETCHED",SEARCH_SUBMITTED:"its.dv14.SearchPage.Events.SEARCH_SUBMITTED"},its.dv14.SearchPage.BubbleNames={IOS_TONE:"iOSTone",IPAD_SOFTWARE:"iPadSoftware",ITUNESU_MATERIAL:"iTunesUMaterial",ITUNESU_PODCAST_EPISODE:"iTunesUPodcastEpisode",PODCAST_EPISODE:"podcastEpisode",RINGTONE:"ringtone",SONG:"song",SOFTWARE:"software",STATION:"station",TV_EPISODE:"tvEpisode",WATCH_SOFTWARE:"watchSoftware",MESSAGES_SOFTWARE:"messagesSoftware"},its.dv14.SegmentedPage=Class.createSubclass("its.dv14.SegmentedPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.SegmentedPage"),this._segmentedControl=this.pageData().segmentedControl,this._selectedIndex=this._segmentedControl.selectedIndex,this.subscribe(its.dv14.SegmentedPage.events.NAVIGATION_BAR_RENDERED_EVENT,this._handleNavigationBarRenderedEvent.bind(this)),this.subscribe(its.dv14.SegmentedPage.events.UPDATE_SEGMENT_DATA,this._updateSegmentData.bind(this))},pageData:function(){return this.data.pageData},renderDocument:function(){this._pills=this._createSegmentPills(),this._pageTitle=this.pageData().pageTitle;
var e=this._segmentedControl.segments[this._selectedIndex];
this.data.storePlatformData&&Class.extend(e,{storePlatformData:this.data.storePlatformData});
var t=this._createPageForSegment(e);
return its.sf14.Util.transferXHRMetricsData(this,t),this._document=t.renderDocument(),this._document},_createSegmentPills:function(){var e=this._segmentedControl.segments,t=[];
for(var n=0;
n<e.length;
n++)t.push({label:e[n].title,id:n});
if(t.length>1){var r={pills:t,pillClass:"tabs",activeId:this._selectedIndex,clickListener:this._segmentClickedHandler.bind(this)};
return this.renderComponentWithData("pills",r)}return undefined},_handleNavigationBarRenderedEvent:function(e){this._currentNavigationBar=e.navigationBar},_updateSegmentData:function(e){this._segmentedControl.segments[this._selectedIndex].url=e.url,this._segmentedControl.segments[this._selectedIndex].pageTitle=e.pageTitle},_segmentClickedHandler:function(e){this._selectedIndex=e;
var t=this._segmentedControl.segments[this._selectedIndex];
this._document.replace(this._renderPageForSegment(t))},_renderPageForSegment:function(e){var t=null;
t=its.sf14.BaseDocument.renderDocumentWithData("loading_document",{navigationBarElement:this._currentNavigationBar},its.dv14.PageController.getDocumentSize());
var n=function(e,t){var n=this._createPageForSegment(e);
n.setXHRMetricsData(t),this._document.replace(n.renderDocument())}.bind(this),r=function(){this._logger.error("Failed to render the page for the selected segment"),this._document.replace(its.sf14.BaseDocument.renderDocumentWithData("error_page",{navigationBarElement:this._currentNavigationBar,message:its.loc("DI6.PageError")},its.dv14.PageController.getDocumentSize()))}.bind(this);
return this._fetchDataForSegment(e,n,r),t},_createPageForSegment:function(e){this._pills&&(e.pageData.pills=this._pills),e.pageTitle&&(e.pageData.pageTitle=e.pageTitle);
var t=e.pageData.componentName;
return its.sf14.BaseDocument.documentWithData(t,e,its.dv14.PageController.getDocumentSize())},_fetchDataForSegment:function(e,t,n){var r=function(n,r){Class.extend(e,n),t(e,r)},i=its.url.appendUrlParameter(e.url,"pageOnly","true");
its.sf14.Util.getJSON(i,r,n)}}),its.dv14.SegmentedPage.events={NAVIGATION_BAR_RENDERED_EVENT:"its.dv14.SegmentedPage.events.NAVIGATION_BAR_RENDERED_EVENT",UPDATE_SEGMENT_DATA:"its.dv14.SegmentedPage.events.UPDATE_SEGMENT_DATA"},its.dv14.SoftwarePage=Class.createSubclass("its.dv14.SoftwarePage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this._isNotifyMeContent=its.dv14.NotifyMeButton.isNotifyMeContent(this.contentId),this._refreshParentalRatingFlags(),this._screenshotsExpanded=!1},restrictionsChangeFilter:function(){var e=this._maxAppRating!=its.sf.ParentalRatingUtil.maxAppRating(),t=this._isAppInstallationAllowed!=its.sf.ParentalRatingUtil.isAppInstallationAllowed();
return this._refreshParentalRatingFlags(),e||t},_refreshParentalRatingFlags:function(){this._maxAppRating=its.sf.ParentalRatingUtil.maxAppRating(),this._isAppInstallationAllowed=its.sf.ParentalRatingUtil.isAppInstallationAllowed()},productLockup:function(){var e={content:this.product};
return this.renderComponentWithData("software_product_lockup",e)},panesToShow:function(){var e=[],t=!this.product.isFirstParty&&!this.product.isFirstPartyHideableApp&&!this._isNotifyMeContent&&!its.dv14.Util.UI.isTVOnlyApp(this.product),n=its.url.queryParamsDict(this._pageDataUrl),r=t&&(n.action=="reviews"||n.action=="write-review");
return e.push({title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._renderDetailsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!r}),t&&e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS,preRenderTab:r}),r&&(this._currentTabId=its.dv14.ProductPageUtil.Tabs.REVIEWS),this.product.kind===its.sf.StorePlatform.Kind.MobileApp&&!its.App.ParentalRequestData&&!this._isNotifyMeContent&&e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED}),e},setMetricsData:function(e){if(!e)return;this.base(e);
if(!e.metricsBase){var t={},n=this.product;
t.pageType="Software",t.pageId=n.id,t.page=t.pageType+its.sf.Metrics.config.compoundSeparator+t.pageId,n.artistName&&n.name&&(t.pageDetails=n.artistName+its.sf.Metrics.config.compoundSeparator+n.name),e.metricsBase=t}e.refUrl||(e.refUrl=this.data.refUrl)},_fetchATVScreenshotsIfNeeded:function(){var e=function(e){var t=e[this.product.id];
t&&(this.product.screenshotsByType=Class.extend(this.product.screenshotsByType,t.screenshotsByType)),this._renderScreenshotsExpand()}.bind(this);
if(its.dv14.Util.UI.hasTVApp(this.product)&&!its.dv14.Util.UI.isTVOnlyApp(this.product)&&!this.product.screenshotsByType.appleTV){var t={ids:[this.product.id],profile:its.sf.StorePlatform.Profiles.SCREENSHOTS_BY_TYPE,platform:its.sf.StorePlatform.Platform.ATV9,onOKHasAllContent:e,onOKMissingContent:e};
this.storePlatform.fetchContent(t)}},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_software_page/details_tab");
this._detailsTab=n;
var r,i,s,o,u,a;
if(this.product.itunesNotes&&this.product.itunesNotes.standard){var f=this.product.itunesNotes.standard;
f&&(o=this._createDescription(its.loc("SF.AppStoreEditorsNotes"),null,f),n.replaceTokenWithElement("notes",o))}if(this.product.kind===its.sf.StorePlatform.Kind.MobileApp){u=this.product.appBundleAdamIds;
if(u&&u.length>0)if(u.length==1&&its.sf.Platform.iPhone()){var l={ids:u,profile:its.sf.StorePlatform.Profiles.LOCKUP,onOKHasAllContent:function(e){this._renderAlsoInBundle(e[u[0]])}.bind(this)};
this.storePlatform.fetchContent(l)}else a={title:its.loc("SF.AlsoIncludedIn"),contentIds:u},n.replaceTokenWithElement("bundleRelated",this.renderComponentWithData("swoosh",a))}else u=this.product.childrenIds,u&&u.length>0&&(a={title:its.loc("SF.NumAppsInThisBundle",{count:u.length}),contentIds:u,"its.dv14.SmallLockup":{personalizePrice:!0},overrideBridgeFilter:!0},n.replaceTokenWithElement("bundleRelated",this.renderComponentWithData("swoosh",a)));
its.sf.ParentalRatingUtil.doesPass(this.product)&&(this._fetchATVScreenshotsIfNeeded(),this._renderScreenshots(),this._renderScreenshotsExpand());
if(this.product.description&&this.product.description.standard){var c=this.product.description.standard,h=this.product.promotionalText;
if(its.isDefinedNonNullNonEmpty(h)){var p=its.isDefinedNonNullNonEmpty(c)?"\n\n"+c:"";
c=h+p}c&&(o=this._createDescription(its.loc("Description"),null,c),n.replaceTokenWithElement("description",o))}this.pageData.addOns&&this.pageData.addOns.length>0&&!this._isNotifyMeContent&&(i=its.Templates.get("pages/dv14_software_page/grid_top"),its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())?(i.replaceTokenUnescaped("expand",this._createInAppPurchasesExpand()),r=its.Templates.get("pages/dv14_software_page/link_item_expand"),r.replaceToken("title",its.loc("MXSoftwarePage.TopInAppPurchases")),r.replaceTokenUnescaped("link",its.sf14.ComponentUtil.createButton(this,its.loc("SF.ShowInAppPurchases"),its.sf14.ComponentUtil.ButtonType.TEXT_ONLY,{"class":"expand-button"},function(e){e.target.parentNode.parentNode.setAttribute("class","grid-full no-padding"),this.pageElement.querySelector("#inapp").setAttribute("open","true"),e.target.parentNode.removeChild(e.target)}.bind(this))),s=r.compose()):(r=its.Templates.get("pages/dv14_software_page/link_item"),r.replaceToken("title",its.loc("MXSoftwarePage.TopInAppPurchases")),s=r.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createInAppPurchasesDoc()})}.bind(this),s.itsId())),i.replaceTokenUnescaped("item",s),n.replaceTokenUnescaped("inAppPurchases",i.compose()));
var d=this.pageData.versionHistory;
if(!this.product.isFirstPartyHideableApp&&d&&d.length>0&&!this._isNotifyMeContent){i=its.Templates.get("pages/dv14_software_page/grid_top"),its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())?(i.replaceTokenUnescaped("expand",this._createVersionHistoryExpand()),r=its.Templates.get("pages/dv14_software_page/link_item_expand"),r.replaceToken("title",its.loc("SF.VersionHistory")),r.replaceTokenUnescaped("link",its.sf14.ComponentUtil.createButton(this,its.loc("SF.ShowVersionHistory"),its.sf14.ComponentUtil.ButtonType.TEXT_ONLY,{"class":"expand-button"},function(e){var t=this.pageElement.querySelector("#version");
t.setAttribute("open","true"),e.target.parentNode.parentNode.setAttribute("class","grid-full"),e.target.parentNode.setAttribute("disabled",!0),e.target.remove()}.bind(this))),s=r.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(e){var t=this.pageElement.querySelector("#version"),n=e.target.querySelector("button");
n.remove(),t.setAttribute("open",!0),e.target.parentNode.setAttribute("class","grid-full"),e.target.setAttribute("disabled",!0)}.bind(this),s.itsId())):(r=its.Templates.get("pages/dv14_software_page/link_item"),r.replaceToken("title",its.loc("SF.VersionHistory")),s=r.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createVersionHistoryDoc()})}.bind(this),s.itsId())),i.replaceTokenUnescaped("item",s),n.replaceTokenUnescaped("versionHistory",i.compose());
if(d.length>1){var v=d[0],m=v.releaseNotes;
m&&m.length>0&&(o=this._createDescription(its.loc("WhatsNew"),v.releaseDate,m),n.replaceTokenWithElement("whatsNew",o))}}var g=this.product.supportsPassbook,y=this.product.isSiriSupported&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0,b=this.product.softwareInfo.isGameCenter;
if(g||y||b){r=its.Templates.get("pages/dv14_software_page/supports"),r.replaceToken("title",its.loc("SF.Supports"));
var w=r.getBlock("list");
if(g){if(its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0)w.replaceToken("source","resource://supportsWallet"),w.replaceToken("name",its.loc("SF.Wallet"));
else if(its.string.compareNumerically(its.sf.Client.version(),"9.0")>=0){var E=its.serverData.constants.resourceBaseUrl+"/images/wallet-badge."+Device.pixelRatio+"x.png";
w.replaceToken("source",E),w.replaceToken("name",its.loc("SF.Wallet")),w.replaceToken("width",29),w.replaceToken("height",29)}else w.replaceToken("source","resource://supportsPassbook"),w.replaceToken("name",its.loc("SF.Passbook"));
w.replaceToken("blurb",its.loc("SF.PassbookBlurb")),w.next()}y&&(w.replaceToken("source","resource://supportsSiri"),w.replaceToken("name",its.loc("SF.Siri")),w.replaceToken("blurb",its.loc("SF.SiriBlurb")),w.next()),b&&(w.replaceToken("source","resource://supportsGameCenter"),w.replaceToken("name",its.loc("SF.GameCenter")),w.replaceToken("blurb",its.loc("SF.GameCenterBlurb")),w.next()),n.replaceTokenWithElement("supports",r.composeAsElement())}n.replaceTokenWithElement("infoList",this._renderInformation());
var S=this.product.softwareInfo.websiteUrl||this.product.softwareInfo.supportUrl;
S&&(n.keepBlock("hasWebsite"),n.replaceToken("devWebsite",its.loc("SF.DeveloperWebsite")),n.replaceToken("devWebsiteUrl",S));
var x=this.product.softwareInfo.eulaUrl;
x&&(n.keepBlock("hasLicense"),n.replaceToken("licenseLabel",its.loc("SF.LicenseAgreement")),n.replaceToken("licenseUrl",x));
var T=this.product.softwareInfo.privacyPolicyUrl;
T&&(n.keepBlock("hasPrivacyPolicy"),n.replaceToken("privacyPolicy",its.loc("Privacy Policy")),n.replaceToken("privacyPolicyUrl",T)),n.keepBlock("hasDeveloperApps"),n.replaceToken("devApps",its.loc("SF.DeveloperApps")),n.replaceToken("artistUrl",this.product.artistUrl),this.product.softwareInfo.developerInfo&&(r=its.Templates.get("pages/dv14_software_page/link_item"),r.replaceToken("title",its.loc("SF6.DeveloperInfo.Label")),s=r.compose(),this.subscribeToTarget(its.sf14.Events.SELECT,function(){its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:this._createDeveloperInfoDoc()})}.bind(this),s.itsId()),n.replaceTokenUnescaped("developerInfo",s),n.keepBlock("hasDeveloperInfo",!0)),this.product.copyright&&n.replaceToken("copyright",this.product.copyright),this._detailsTab=n.composeAsElement(),t.appendChild(this._detailsTab)},_renderAlsoInBundle:function(e){var t=its.Templates.get("pages/dv14_software_page/also_in");
t.replaceToken("title",its.loc("SF.AlsoIncludedIn"));
var n={content:e,type:its.dv14.SmallLockup.Type.LIST,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.CHARTS,"its.dv14.BuyButton":{showAsButtonless:!0,showActionTextAndPrice:!1},showArrow:!0},r=this.renderComponentWithData("small_lockup",n);
t.replaceTokenWithElement("lockup",r),this._detailsTab.replaceTokenWithElement("bundleRelated",t.composeAsElement())},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_software_page/related_tab"),i=this.pageData,s=this.product,o=n?"grid":"swoosh",u=function(){var e=i.moreByThisDeveloper,u=0;
if(e&&e.length>0){var a=n?3:null,f={title:its.loc("DV14.ProductPage.MoreByArtist",{artistName:s.artistName}),link:{label:its.loc("See All"),url:this.product.artistUrl},contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e,a),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1,doNotFilter:!0};
r.replaceTokenWithElement("moreByArtist",this.renderComponentWithData(o,f)),u++}e=i.customersAlsoBoughtApps,e&&e.length>0&&!s.isFirstParty&&!s.isFirstPartyHideableApp&&(a=n?3:null,f={title:its.loc("DV14.ProductPage.CustomersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e,a),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1},r.replaceTokenWithElement("customersAlsoBought",this.renderComponentWithData(o,f)),u++);
var l=its.sf.Platform.iPad()?"ipad":"iphone",c=i.topApps[l];
e=c?c.ids:null,e&&e.length>0&&(f={title:c.title,contentIds:its.dv14.ProductPageUtil.trimSwooshIds(e),scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1},r.replaceTokenWithElement("topApps",this.renderComponentWithData(o,f)),u++);
if(u==0){var h=its.Templates.get("pages/dv14_software_page/content_unavailable");
h.replaceToken("message",its.loc("SF6.noRelatedContent")),r.replaceTokenWithElement("contentUnavailable",h.composeAsElement())}t.appendChild(r.composeAsElement());
if(t.lastElementChild){var p=t.lastElementChild.getElementsByTagName("divider").item(0);
p&&p.remove()}}.bind(this),a=[];
i.moreByThisDeveloper&&(a=a.concat(i.moreByThisDeveloper)),i.customersAlsoBoughtApps&&(a=a.concat(i.customersAlsoBoughtApps));
var f={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:a,onOKHasAllContent:u,onOKMissingContent:u,suppressPersonalization:!0};
this.storePlatform.fetchContent(f)},_availableScreenshots:function(){var e=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this.product.screenshotsByType).screenshots,t=this.product.screenshotsByType.appleWatch,n=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this.product.messagesScreenshots).screenshots,r=this.product.screenshotsByType.appleTV,i=!this.product.isHiddenFromSpringboard&&e&&e.length>0,s=t&&t.length>0&&this.product.isAppleWatchSupported&&its.string.compareNumerically(its.sf.Client.version(),"8.2")>=0&&!its.sf.Platform.iPad(),o=n&&n.length>0&&this.product.hasMessagesExtension&&its.string.compareNumerically(its.sf.Client.version(),"10.0")>=0,u=r&&r.length>0,a=[];
its.dv14.Util.Client.isBridge()&&s?a.push(its.dv14.SoftwarePage.Screenshots.Watch):its.dv14.Util.Client.isVoyager()&&o&&a.push(its.dv14.SoftwarePage.Screenshots.Messages);
for(var f=a.length;
f<4;
f++)i&&a.indexOf(its.dv14.SoftwarePage.Screenshots.iOS)<0?a.push(its.dv14.SoftwarePage.Screenshots.iOS):o&&a.indexOf(its.dv14.SoftwarePage.Screenshots.Messages)<0?a.push(its.dv14.SoftwarePage.Screenshots.Messages):s&&a.indexOf(its.dv14.SoftwarePage.Screenshots.Watch)<0?a.push(its.dv14.SoftwarePage.Screenshots.Watch):u&&a.indexOf(its.dv14.SoftwarePage.Screenshots.tvOS)<0&&a.push(its.dv14.SoftwarePage.Screenshots.tvOS);
return a},_screenshotGalleriesData:function(){var e=[],t=this._availableScreenshots();
for(var n=0;
n<t.length;
n++){var r=t[n],i;
switch(r){case its.dv14.SoftwarePage.Screenshots.iOS:i=this._createiOSScreenshotsGalleryData();
break;case its.dv14.SoftwarePage.Screenshots.Watch:var s=this.product.screenshotsByType.appleWatch;
i=this._createScreenshotsGalleryData(s,null,its.loc("DV14.Screenshots.AppleWatch"),!0);
break;case its.dv14.SoftwarePage.Screenshots.Messages:var o=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this.product.messagesScreenshots).screenshots;
this.product.videoPreviewByType&&(a=this.product.videoPreviewByType.appleTV),i=this._createScreenshotsGalleryData(o,null,its.loc("DV14.Screenshots.Messages"),!1);
break;case its.dv14.SoftwarePage.Screenshots.tvOS:var u=this.product.screenshotsByType.appleTV,a=null;
this.product.videoPreviewByType&&(a=this.product.videoPreviewByType.appleTV),i=this._createScreenshotsGalleryData(u,a,its.loc("DV14.Screenshots.TVOS"),!1)}if(!i)continue;e.push(i)}return e},_renderScreenshots:function(){var e=this._screenshotGalleriesData(),t=e[0],n=this.renderComponentWithData("gallery",t);
this._detailsTab.replaceTokenWithElement("screenshots",n)},_renderScreenshotsExpand:function(){var e=this._availableScreenshots(),t=this._screenshotGalleriesData();
if(e.length>1){if(!this._screenshotsExpanded){var n=[];
for(var r=1;
r<t.length;
r++){var i=t[r];
r>0&&n.push(i.title)}var s="",o=n.length;
for(var r=0;
r<o;
r++)r>0&&(r==o-1?o==2?s+=its.loc("DV14.Screenshots.ConjunctionTwo"):s+=its.loc("DV14.Screenshots.ConjunctionThreeOrMore"):s+=its.loc("DV14.Screenshots.Separator")),s+=n[r];
var u=its.Templates.get("pages/dv14_software_page/screenshot_expand");
u.replaceToken("title",its.loc("DV14.Screenshots.AdditionalScreenshots")),u.replaceToken("subtitle",s),this._screenshotsExpandElement=u.composeAsElement(),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleScreenshotsExpanded.bind(this),this._screenshotsExpandElement.itsId())}else{var a=its.Templates.get("pages/dv14_software_page/screenshots_loop"),f=a.getBlock("loop");
for(var r=1;
r<t.length;
r++){var i=t[r],l=this.renderComponentWithData("gallery",i);
f.replaceTokenWithElement("screenshot_row",l),f.next()}this._screenshotsExpandElement=a.composeAsElement()}this._detailsTab.replaceTokenWithElement("expandScreenshots",this._screenshotsExpandElement)}},_handleScreenshotsExpanded:function(){this._screenshotsExpanded=!0,this._renderScreenshotsExpand()},_createiOSScreenshotsGalleryData:function(){var e=[],t=its.dv14.ProductPageUtil.getBestTypeOfTrailer(this.product),n=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this.product.screenshotsByType),r=n.screenshots;
if(!r)return null;
var i=!1;
for(var s=0;
s<r.length;
s++){var o=r[s][0]!==undefined?r[s][0]:r[s];
if(o.height>o.width){i=!0;
break}}t&&t.previewFrame&&t.video&&e.push(this._createGalleryVideoItem(t.previewFrame,t.video,i));
for(var u=0;
u<r.length;
u++)e.push(this._createGalleryItem({artwork:r[u]},u+1,i));
return galleryData={items:e,title:n.title}},_createScreenshotsGalleryData:function(e,t,n,r){if(!e)return null;
var i=!1;
for(var s=0;
s<e.length;
s++){var o=e[s][0]!==undefined?e[s][0]:e[s];
if(o.height>o.width){i=!0;
break}}var u=[];
t&&t.previewFrame&&t.video&&u.push(this._createGalleryVideoItem(t.previewFrame,t.video,i));
for(var a=0;
a<e.length;
a++)u.push(this._createGalleryItem({artwork:e[a],watch:r},a+1),i);
return galleryData={items:u,title:n}},_artworkProfileForImage:function(e,t){var e=e[0]||e,n;
return e.width>e.height&&!t?n="card_landscape_product":n="default",n},_createGalleryItem:function(e,t,n){var r=e.artwork,i;
if(e.video)i=this._createGalleryVideoItem(r,e.video);
else{var s=e.watch?"watch":this._artworkProfileForImage(r,n),o=e.watch?"watch-screenshot":"screenshot",u=its.loc("DV14.ProductPage.ITunesExtras.PreviewArtwork",{index:t}),a={artworkUrls:r,size:its.dv14.LockupUtil.getArtworkDimensions("screenshot",s,this.size()),alt:u,classes:[its.dv14.LockupUtil.getArtworkClassName(o)]},f={artworkUrls:r,size:its.dv14.LockupUtil.getArtworkDimensions("fullscreen",null,this.size()),alt:u,classes:[its.dv14.LockupUtil.getArtworkClassName(o)]},l=r[0]!==undefined?r[0]:r;
l.width>l.height&&n&&(a.classes=["screenshot-landscape"]),i={artworkData:a,fullscreenArtworkData:f,type:its.dv14.Gallery.Type.IMAGE}}if(this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle){var c=this.product.children[e.adamId];
c&&(i.title=c.name)}return i},_createGalleryVideoItem:function(e,t,n){var r=this._artworkProfileForImage(e,n),i={artworkUrls:e,size:its.dv14.LockupUtil.getArtworkDimensions("screenshot",r,this.size()),alt:its.loc("SF.AppVideoPreview"),classes:[its.dv14.LockupUtil.getArtworkClassName("screenshot")]},s=e[0]!==undefined?e[0]:e;
(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size()))&&s.width>s.height&&!n?(i.size=its.dv14.LockupUtil.getArtworkDimensions("screenshot",r,this.size()),n&&(i.classes=["screenshot-landscape"])):(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size()))&&s.width>s.height&&n?(i.classes=["screenshot-landscape"],i.size=its.dv14.LockupUtil.getArtworkDimensions("screenshot",null,this.size())):(its.sf.Platform.iPhone()||its.dv14.Util.UI.isCompact(this.size()))&&s.width<s.height&&(i.size=its.dv14.LockupUtil.getArtworkDimensions("screenshot",null,this.size())),n&&s.width>s.height&&(i.classes=["screenshot-landscape"]);
var o={artworkData:i,videoData:{url:t,contentId:this.product.id},type:its.dv14.Gallery.Type.VIDEO};
return o},onOrientationChange:function(e){this.base(e),this._renderScreenshots(),this._renderScreenshotsExpand()},_renderInformation:function(){var e=[];
this.product.childrenIds&&this.product.childrenIds.length>0&&e.push({title:its.loc("AppCount"),values:[this.product.childrenIds.length]}),e.push({title:this.pageData.sellerLabel,values:[this.product.softwareInfo.seller]}),this.product.genreNames&&this.product.genreNames[0]&&e.push({title:its.loc("Category"),values:[this.product.genreNames[0]]});
if(!this.product.isFirstPartyHideableApp&&!this._isNotifyMeContent&&this.pageData.versionHistory&&this.pageData.versionHistory[0]){var t=this.pageData.versionHistory[0].releaseDate;
t&&e.push({title:its.loc("Updated"),values:[its.locDate(t)]});
var n=this.pageData.versionHistory[0].versionString;
n&&e.push({title:its.loc("Version"),values:[n]})}if(!this.product.isFirstPartyHideableApp){var r=this.product.offers,i=this.product.fileSizeByDevice,s;
if(i||r&&r[0]){if(i)s=i[Device.productType]||i.universal;
else{var o=r[0].assets;
o&&o[0]&&(s=o[0].size)}if(s){var u;
this._isNotifyMeContent?u=[its.loc("SF.NotApplicable")]:u=[{numberValue:its.sf.ProductPageUtil.formattedSize(s),value:" "+its.sf.ProductPageUtil.sizeScale(s)}],e.push({title:its.loc("DV14.Size"),values:u})}}}var a=this._ratingsAndAdvisories();
a&&e.push({title:its.loc("Rating"),values:a});
if(!this.product.isFirstPartyHideableApp&&!this._isNotifyMeContent){var f=this.product.familyShareEnabledDate,l=its.locDate(f);
e.push({title:its.loc("Purchases.FamilySharing"),values:[its.sf.ProductPageUtil.sharedPurchasesAvailableText(f,l)]}),e.push({title:its.loc("Compatibility"),values:[this.product.softwareInfo.requirementsString]})}if(its.dv14.Util.Client.isBridge()||its.property("DV14.Gizmo.showAppleWatchDetailsInAppStore")){var c=this._isNotifyMeContent?its.dv14.NotifyMeButton.isNotifyMeContentWithAppleWatchApp(this.product.id):this.product.isAppleWatchSupported;
its.string.compareNumerically(its.sf.Client.version(),"8.2")>=0&&c&&e.push({title:its.loc("DV14.AppleWatch"),values:[its.loc("DV14.AppleWatch.EnabledYes")]})}var h=this._isNotifyMeContent?its.dv14.NotifyMeButton.isNotifyMeContentWithTvApp(this.product.id):its.dv14.Util.UI.hasTVApp(this.product)&&!its.dv14.Util.UI.isTVOnlyApp(this.product);
h&&e.push({title:its.loc("SF.UniversalAppleTV"),values:[its.loc("Yes")]}),this.product.usesLocationBackgroundMode&&e.push({title:its.loc("SF.Location"),values:[its.loc("SF.batteryLifeDisclaimer")]}),e.push({title:its.loc("DV14.Languages"),values:[this.product.softwareInfo.languagesDisplayString]});
var p={title:its.loc("DV14.Information"),infoItems:e,showDivider:!1,type:its.dv14.InfoList.Type.TITLE_LEFT};
return this.renderComponentWithData("info_list",p)},_ratingsAndAdvisories:function(){var e=its.sf.ContentRatingsManager.create(this.product.contentRatingsBySystem),t=[],n=null;
e&&(t=e.ratingsOtherThanAppsApple(),n=e.advisoryInfo());
var r=[];
if(this.product.ageBand){var i=null,s=its.sf.ContentRatingsManager.legacyContentRating(this.product);
s&&(this.product.ageBand.maxAge<=5?i=its.loc("DT.MobileSoftware.AgeBandsRating.Under5",{rating:s.name}):i=its.loc("DT.MobileSoftware.AgeBandsRating",{rating:s.name,minAge:this.product.ageBand.minAge,maxAge:this.product.ageBand.maxAge})),r.push(i)}else if(n){var o=n.ratedForTheFollowingAdvisoriesText();
o&&r.push(o)}if(n){var u=n.advisories();
for(var a=0;
a<u.length;
a++)r.push(u[a])}return t.forEach(function(e){r.push({elementAsString:its.dv14.BadgeUtil.AppRatings.badge(e)})}),r},_createDescription:function(e,t,n,r){var i={title:e,date:t,description:n,dontEscape:r,maxLines:5};
return this.renderComponentWithData("description",i)},_createVersionHistoryExpand:function(){var e=its.Templates.get("pages/dv14_software_page/expand");
return e.replaceTokenUnescaped("elem",this._createVersionHistory()),e.replaceToken("id","version"),e.compose()},_createVersionHistoryDoc:function(){var e=its.Templates.get("pages/dv14_software_page/doc_stack_template");
return e.replaceTokenUnescaped("elem",this._createVersionHistory()),its.sf14.Util.ensureDocumentType(e.composeAsElement())},_createVersionHistory:function(){var e=this.pageData.versionHistory,t=its.Templates.get("pages/dv14_software_page/version_history"),n=t.getBlock("loop");
for(var r=0;
r<e.length;
r++){var i=e[r],s={title:i.versionString,date:i.releaseDate,description:i.releaseNotes,showDivider:r!=e.length-1,maxLines:5},o=this.renderComponentStringWithData("description",s);
n.replaceTokenUnescaped("historyItem",o),n.next()}return t.compose()},_createInAppPurchasesExpand:function(){var e=its.Templates.get("pages/dv14_software_page/expand");
return e.replaceTokenUnescaped("elem",this._createInAppPurchases()),e.replaceToken("id","inapp"),e.compose()},_createInAppPurchasesDoc:function(){var e=its.Templates.get("pages/dv14_software_page/doc_stack_template");
return e.replaceTokenUnescaped("elem",this._createInAppPurchases()),its.sf14.Util.ensureDocumentType(e.composeAsElement())},_createInAppPurchases:function(){var e=this.pageData.addOns,t=its.Templates.get("pages/dv14_software_page/in_app_purchases"),n=t.getBlock("trackLoop");
for(var r=0;
r<e.length;
r++){var i=e[r];
n.replaceToken("number",r+1),n.replaceToken("name",i.name),n.replaceToken("price",i.price),its.sf.Platform.iPad()&&!its.dv14.Util.UI.isCompact(this.size())&&r==e.length-1&&n.replaceToken("class","divider-none"),n.next()}return t.compose()},_createDeveloperInfoDoc:function(){var e=its.Templates.get("pages/dv14_software_page/developer_info"),t=this.product.softwareInfo.developerInfo,n=t.person,r=t.address;
e.replaceToken("tradeNameLabel",its.loc("SF6.DeveloperInfo.TradeName")),e.replaceToken("tradeName",this.product.softwareInfo.seller),n&&(e.replaceToken("tradeRepLabel",its.loc("SF6.DeveloperInfo.TradeRep")),e.replaceToken("tradeRep",n.firstName+" "+n.lastName),e.keepBlock("tradeRepBlock"));
if(r){e.replaceToken("addressLabel",its.loc("SF6.DeveloperInfo.Address")),r.countryCode&&r.countryCode.toLowerCase()==="kr"?e.keepBlock("addressKoreanBlock"):e.keepBlock("addressBlock");
var i=r.addressLine1;
r.addressLine2&&(i+="\n"+r.addressLine2),r.addressLine3&&(i+="\n"+r.addressLine3),e.replaceToken("address123",i),e.replaceToken("city",r.city),e.replaceToken("state",r.state),e.replaceToken("zip",r.zipCode),e.replaceToken("country",r.country)}return n&&n.phoneNumber&&(e.replaceToken("phoneLabel",its.loc("SF6.DeveloperInfo.Phone")),e.replaceToken("phone",n.phoneNumber),e.keepBlock("phoneBlock")),n&&n.emailAddress&&(e.replaceToken("emailLabel",its.loc("SF6.DeveloperInfo.Email")),e.replaceToken("email",n.emailAddress),e.keepBlock("emailBlock")),t.eCommerceRegistrationId&&(e.replaceToken("ecommerceRegNumLabel",its.loc("SF6.DeveloperInfo.ECommerceRegNum")),e.replaceToken("ecommerceRegNum",t.eCommerceRegistrationId),e.keepBlock("ecommerceRegNumBlock")),t.businessRegistrationId&&(e.replaceToken("businessRegNumLabel",its.loc("SF6.DeveloperInfo.BusinessRegNum")),e.replaceToken("businessRegNum",t.businessRegistrationId),e.keepBlock("businessRegNumBlock")),its.sf14.Util.ensureDocumentType(e.composeAsElement())},_updateRestrictions:function(){its.sf.ParentalRatingUtil.doesPass(this.product)?this._screenshotsElement()&&this._detailsTab.replaceTokenWithElement("screenshots",this._screenshotsElement()):this._detailsTab.replaceTokenWithElement("screenshots",document.createElement("placeholder"))},_playTrailer:function(){var e=its.dv14.ProductPageUtil.getBestTypeOfTrailer(this.product);
if(e&&e.previewFrame&&e.video){var t=its.sf.ContentRatingsManager.legacyContentRating(this.product),n={url:e.video,contentRating:t,contentId:this.product.id},r=its.sf14.BaseDocument.renderDocumentWithData("video_playlist",{videos:[n]},its.dv14.PageController.getDocumentSize(its.sf14.PageController.PageTarget.MODAL));
its.notifications.publish(its.sf14.PageController.Events.PUSH_DOCUMENT,{document:r,pageTarget:its.sf14.PageController.PageTarget.MODAL})}},onAppear:function(){this.base.apply(this,arguments),!this._hasAlreadyAutoplayed&&its.property("SFJ.isAppPreviewAutoplayEnabled")&&its.url.queryParamValue("ap",this.documentUrl())=="true"&&itms.networkConnectionType=="WiFi"&&(this._hasAlreadyAutoplayed=!0,this._playTrailer())}}),its.dv14.SoftwarePage.Screenshots={Watch:"Watch",Messages:"Messages",iOS:"iOS",tvOS:"tvOS"},its.dv14.SoftwareOnlyPage=Class.createSubclass("its.dv14.SoftwareOnlyPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},pageData:function(){return this.data.pageData},render:function(){var e=its.Templates.get("pages/dv14_software_only_page");
return e.replaceToken("targetUrl",this.pageData().targetUrl),e.replaceToken("openAppMessage",this.pageData().openAppMessage),this._pageElement=e.composeAsElement(),this._pageElement}}),its.dv14.SoftwareEulaPage=Class.createSubclass("its.dv14.SoftwareEulaPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},pageData:function(){return this.data.pageData},render:function(){var e=its.Templates.get("pages/dv14_software_eula_page");
e.replaceToken("title",this.pageData().title);
var t=e.getBlock("textLoop"),n=this.pageData().eula.split("\n");
for(var r=0;
r<n.length;
++r){var i=n[r];
t.replaceTokenUnescaped("text",i.trim()),t.next()}return this._pageElement=e.composeAsElement(),this._pageElement}}),its.dv14.TopAuthorsContent=Class.createSubclass("its.dv14.TopAuthorsContent",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.TopAuthorsContent"),this.loadingSpinner=its.sf14.ComponentUtil.createActivityIndicator(this,its.sf14.Util.UI.loadingText(),!1,!0),this._cachedArtistContentIds={paid:{},free:{}},this.subscribe("top_authors:select",this._handleSelect.bind(this))},restoreData:function(){return{title:"Top Authors"}},pageData:function(){return this.lookup("pageData")},render:function(){this._template=its.Templates.get("pages/dv14_top_authors_content"),this._template.replaceToken("contentUnavailableImgSrc",this._getTopAuthorsImageURL()),this._template.replaceToken("title",its.loc("K2.BrowsePage.Instructions1")),this._template.replaceToken("description",its.loc("K2.BrowsePage.Instructions2")),this._pageElement=this._template.composeAsElement(),this.addDocumentStyles(this._pageElement,{}),this._stackTemplate=this._pageElement.querySelector("stackTemplate");
var e=its.Templates.get("pages/dv14_top_authors_content/filter_bar");
e.keepBlock("sortBlock",!0);
var t=its.Templates.get("pages/dv14_top_authors_content/sort_select"),n=its.sf.ContentSorter.SortOrder.sortOrdersForIds(this.pageData().sorts);
e.replaceToken("sortBy",its.loc("Sort by:"));
var r=t.getBlock("optionLoop");
for(var i=0;
i<n.length;
i++){var s=its.Templates.get("pages/dv14_top_authors_content/sort_option");
s.replaceToken("value",n[i].value),s.replaceToken("label",n[i].name),this.pageData().defaultSort==n[i].value?s.replaceToken("selected","true"):s.replaceToken("selected","false");
var o=s.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,this._handlesortChanged.bind(this),o.itsId()),r.replaceTokenUnescaped("option",o),r.next()}var u=t.compose();
e.replaceTokenUnescaped("sortSelect",u),this.filterElement=e.composeAsElement();
var a={hideGenreButton:!0},f=this.renderComponentWithData("navigation_bar",a);
return this.filterElement&&f.appendChild(this.filterElement),this._pageElement.replaceTokenWithElement("navigation",f),this._pageElement},_handlesortChanged:function(e){var t=e.target.getAttribute("value"),n=e.target.parentNode.querySelectorAll("option");
for(var r=0;
r<n.length;
r++)n[r].setAttribute("selected",!1);
e.target.setAttribute("selected","true"),this._renderedSortContentForCurrentAuthor[t]?(this._stackTemplate.removeAllChildNodes(),this._sortedContentElement=this._renderedSortContentForCurrentAuthor[t],this._stackTemplate.appendChild(this._sortedContentElement)):this._fetchSortDataForSortId(t)},_handleSelect:function(e){this._renderedSortContentForCurrentAuthor=[];
var t=e.isFree,n=e.entry.id,r=t?this._cachedArtistContentIds.free[n]:this._cachedArtistContentIds.paid[n];
if(r)this._renderAuthorContent(n,e.entry.name,t);
else{this._stackTemplate.removeAllChildNodes(),this._stackTemplate.appendChild(this.loadingSpinner);
var i=its.url.appendUrlParameters(this.pageData().lookupUrl,{isFree:t,id:n});
its.sf14.Util.fetchServerGetResponse(i,function(r){var s=r.responseText?JSON.parse(r.responseText):null;
s?(this.storePlatform.cacheStorePlatformDataForProfiles(s.storePlatformData,!0),this._cachedArtistContentIds[n]=s.adamIds,t?this._cachedArtistContentIds.free[n]=s.adamIds:this._cachedArtistContentIds.paid[n]=s.adamIds,this._renderAuthorContent(n,e.entry.name,t),its.sf14.Util.publishPageAppearEventWithPageData(this.pageData(),i,r.metrics)):this._logger.error(["Error parsing JSON for: ",i])}.bind(this),function(e){this._logger.error(["No data fetched for artist: ",i])}.bind(this))}},_fetchSortDataForSortId:function(e){this._stackTemplate.removeAllChildNodes(),this._stackTemplate.appendChild(this.loadingSpinner);
var t=function(t){var n={contentIds:t,"its.dv14.SmallLockup":{titleMaxLines:2}},r=this.renderComponentWithData("grid",n);
this._renderedSortContentForCurrentAuthor[e]=r,this._sortedContentElement=this._renderedSortContentForCurrentAuthor[e],this._stackTemplate.removeAllChildNodes(),this._stackTemplate.appendChild(this._sortedContentElement)}.bind(this),n=its.sf.ContentSorter.SortOrder.sortOrderForId(e),r=its.sf.ContentSorter.defaultSortDirection(n),i={ids:this.pageData().adamIds,sortOrder:n,sortDirection:r,numIdsToPrewarm:30,profile:its.sf.StorePlatform.Profiles.LOCKUP,callback:t};
this._contentSorter.sort(i)},_renderAuthorContent:function(e,t,n){var r=its.url.appendUrlParameters(this.pageData().artistBaseUrl,{id:e}),i=n?this._cachedArtistContentIds.free[e]:this._cachedArtistContentIds.paid[e],s=its.sf14.ComponentUtil.createButton(this,t,its.sf14.ComponentUtil.ButtonType.LINK,{id:"authorPageButton","data-url":r},null,!0),o=this.filterElement.querySelector("#authorPageButton");
o.parentNode.replaceChild(s,o);
var u=this.filterElement.querySelectorAll("option");
for(var a=0;
a<u.length;
a++)u[a].setAttribute("selected",this.pageData().defaultSort==u[a].getAttribute("value"));
var f={isFree:n,entityType:its.sf.ContentSorter.EntityType.TOP_AUTHORS,id:e};
this._contentSorter=new its.sf.ContentSorter(this.storePlatform,i,f,null,null,null);
var l={contentIds:i,"its.dv14.SmallLockup":{titleMaxLines:2}},c=this.renderComponentWithData("grid",l);
this._renderedSortContentForCurrentAuthor[this.pageData().defaultSort]=c,this._sortedContentElement=c,this._stackTemplate.removeAllChildNodes(),this._stackTemplate.appendChild(c)},_getTopAuthorsImageURL:function(){return Device.pixelRatio>2?its.serverData.constants.resourceBaseUrl+"/images/content-unavailable/topAuthors.3x.png":its.serverData.constants.resourceBaseUrl+"/images/content-unavailable/topAuthors.2x.png"}}),its.dv14.TopAuthorsPage=Class.createSubclass("its.dv14.TopAuthorsPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._logger=its.Logger.named("its.dv14.TopAuthorsPage"),this._contentSection=this.lookup("contentSection"),this._tabbedPane=this.lookup("tabbedPane"),this._contentSection==null&&(this._contentSection=document.createElement("section")),this._tabbedPane==null&&(this._tabbedPane=this._renderTabbedPaneOfResults(this.pageData())),this.renderedContentForCategory={},this._currentCategoryKey=its.dv14.CategorySheet.createCategoryKey(this.pageData().categoryList.groupingId,this.pageData().categoryList.genreId),this.subscribe("top_authors:category_select",this._handleCategoryChange.bind(this)),this.subscribe("top_authors:select",this._handleSelectAuthor.bind(this))},restoreData:function(){return{title:its.loc("K2.BrowsePage.TopAuthors")}},pageData:function(){return this.lookup("pageData")},shouldRenderList:function(){return this.lookup("shouldRenderList")},render:function(){this._pills=this.pageData().pills;
var e=!this._isSplit()||this.shouldRenderList();
return this._isList=e,this._pageElement=e?this.renderList(this.pageData()):this.renderPage(this.pageData()),this._pageElement},renderPage:function(e){var t=its.Templates.get("pages/dv14_top_authors_page");
t.replaceTokenWithElement("navigation",this._fullNavigationBar(e.categoryList,!1));
var n=t.composeAsElement();
return this.addDocumentStyles(n,{}),this._splitViewElement=n.querySelector("splitViewTemplate"),this._leftNavDoc=this._splitViewElement.getFeature("leftNavigationDocument"),this._rightNavDoc=this._splitViewElement.getFeature("rightNavigationDocument"),this._leftBaseDoc=its.sf14.BaseDocument.documentWithData("top_authors_page",{pageData:e,shouldRenderList:!0,contentSection:this._contentSection,tabbedPane:this._tabbedPane},its.dv14.PageController.getDocumentSize(null,null,this._leftNavDoc)),this._leftNavDoc.pushDocument(this._leftBaseDoc.renderDocument(),{animated:!1}),this._rightBaseDoc=its.sf14.BaseDocument.documentWithData("top_authors_content",{pageData:e},its.dv14.PageController.getDocumentSize(null,null,this._rightNavDoc)),this._rightNavDoc.pushDocument(this._rightBaseDoc.renderDocument(),{animated:!1}),n},renderList:function(e){var t=its.Templates.get("pages/dv14_top_authors_page_list"),n=t.composeAsElement();
this.addDocumentStyles(n,{});
if(this._isSplit())if(e.paidAuthors){var r={hideGenreButton:!0,renderAlternateDisplay:!0},i=this.renderComponentWithData("extended_navigation_bar",r);
i.querySelector("palette").appendChild(this._tabbedPane),n.replaceTokenWithElement("navigation",i)}else this._contentSection=this._tabbedPane;
else n.replaceTokenWithElement("navigation",this._fullNavigationBar(e.categoryList,!0)),n.replaceTokenWithElement("wrapper",this._tabbedPane);
return n.replaceTokenWithElement("content",this._contentSection),n},_fullNavigationBar:function(e,t){var n={title:its.loc("K2.BrowsePage.TopAuthors"),categoryList:e,hideGenreButton:!1,navigationTitle:its.loc("K2.BrowsePage.TopAuthors"),onCategoryChangedEventType:"top_authors:category_select",groupingPageMetricsBase:this.pageData().metricsBase},r=this.renderComponentWithData("extended_navigation_bar",n);
if(this._pills)if(t){var i=document.createElement("palette");
r.appendChild(i),i.appendChild(this._pills),its.notifications.publish(its.dv14.SegmentedPage.events.NAVIGATION_BAR_RENDERED_EVENT,{navigationBar:r})}else r.replaceTokenWithElement("pills",this._pills);
return r},_handleCategoryChange:function(e){if(this._isSplit()){var t=function(e){var t=JSON.parse(e.responseText);
if(t&&this._leftNavDoc&&this._rightNavDoc){this._contentSection.removeAllChildNodes(),this._tabbedPane=this._renderTabbedPaneOfResults(t.pageData);
var n=its.sf14.BaseDocument.documentWithData("top_authors_page",{pageData:t.pageData,shouldRenderList:!0,contentSection:this._contentSection,tabbedPane:this._tabbedPane});
n.setXHRMetricsData(e),this._leftNavDoc.replaceDocument(n.renderDocument(),this._leftNavDoc.documents[0],{animated:!1});
var i=its.sf14.BaseDocument.documentWithData("top_authors_content",{pageData:t.pageData},its.dv14.PageController.getDocumentSize(null,null,this._rightNavDoc));
i.setXHRMetricsData(e),this._rightNavDoc.replaceDocument(i.renderDocument(),this._rightNavDoc.documents[0],{animated:!1}),its.sf14.Util.publishPageAppearEventWithPageData(t.pageData,r,e.metrics)}}.bind(this),n=function(e){}.bind(this),r=its.url.appendUrlParameters(this.pageData().lookupUrl,{genreId:e.genreId});
its.sf14.Util.fetchServerGetResponse(r,t,n)}else if(this._currentCategoryKey!=e.categoryKey){this._shouldPublishPageAppearEvent=!1;
var i=e.categoryKey;
this.renderedContentForCategory[i]&&(this._currentCategoryKey=i),this.renderedContentForCategory[i]=this.loadingTemplate;
var t=function(e){var t=JSON.parse(e.responseText);
if(t){this._currentCategoryKey=i,this._contentSection.removeAllChildNodes();
var n=this._renderTabbedPaneOfResults(t.pageData),s=this._tabbedPane;
s.parentNode.replaceChild(n,s),this._tabbedPane=n,its.sf14.Util.publishPageAppearEventWithPageData(t.pageData,r,e.metrics)}this._shouldPublishPageAppearEvent=!0}.bind(this),n=function(e){this._shouldPublishPageAppearEvent=!0}.bind(this),r=its.url.appendUrlParameters(this.pageData().lookupUrl,{genreId:e.genreId});
its.sf14.Util.fetchServerGetResponse(r,t,n)}},_isSplit:function(){var e=its.sf.Platform.iPad()||its.dv14.Util.UI.displayModeSplitView();
return e},_renderTabbedPaneOfResults:function(e){var t={panes:[],"its.dv14.Pills":{showDivider:!0,pinStyle:its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND,pillClass:"top-author-pills"}};
return e.paidAuthors&&(t.panes.push({title:its.loc("K2.BrowsePage.Paid"),callback:function(t,n){this._renderCollectionList(t,n,e)}.bind(this),tabId:1}),t.contentRegion=this._contentSection),e.freeAuthors&&t.panes.push({title:its.loc("K2.BrowsePage.Free"),callback:function(t,n){this._renderCollectionList(t,n,e)}.bind(this),tabId:2}),this.renderComponentWithData("tabbed_pane",t)},_renderCollectionList:function(e,t,n){var r={bucketedData:e==1?n.paidAuthors:n.freeAuthors,isFree:e!=1,selectEventName:"top_authors:select"},i=this.renderComponentWithData("collection_list",r);
t.appendChild(i)},_handleSelectAuthor:function(e){if(!this._isSplit()){var t=its.url.appendUrlParameters(this.pageData().lookupUrl,{isFree:e.isFree,id:e.entry.id,pageOnly:!0});
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,{url:t})}},onOrientationChange:function(e){if(!this.shouldRenderList()&&its.dv14.Util.UI.shouldToggleSplitView()){var t=!this._isSplit()||this.shouldRenderList();
if(t!=this._isList){this._leftBaseDoc&&this._rightBaseDoc&&(its.notifications.removeEventGroup(this._leftBaseDoc.itsId()),its.notifications.removeEventGroup(this._rightBaseDoc.itsId()));
var n=t?this.renderList(this.pageData()):this.renderPage(this.pageData());
this._pageElement.removeAllChildNodes();
while(n.childNodes.length>0)this._pageElement.appendChild(n.firstChild);
this._isList=t}}}}),its.dv14.TvSeasonPage=Class.createSubclass("its.dv14.TvSeasonPage",its.dv14.ProductPage,{initialize:function(){this.base.apply(this,arguments),this.subscribe(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,this._handlePageStateChanged.bind(this))},_season:function(){return this.product},productLockup:function(){var e={content:this._season(),isClosedCaptioned:this._isSeasonClosedCaptioned(),isPurchasedModal:this.data.isPurchasedModal};
return!this._validPageStates&&!this._pageState&&this._determineValidPageStates(),e.validPageStates=this._validPageStates,e.pageState=this._pageState,this.renderComponentWithData("tv_season_product_lockup",e)},_renderNavigationBar:function(e){if(!this._navigationBar||e){var t={navigationTitle:this.product.name,product:this.product,hasShareButton:!0,isPurchasedModal:this.data.isPurchasedModal};
this._navigationBar=this.renderComponentWithData("navigation_bar",t),this.pageElement.replaceTokenWithElement("navigationBar",this._navigationBar)}},panesToShow:function(){var e=[{title:its.loc("DV14.ProductPage.Tab.Details"),callback:this._fetchEpisodesAndRenderDetails.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.DETAILS,preRenderTab:!0}];
return this.data.isPurchasedModal||(e.push({title:its.loc("DV14.ProductPage.Tab.RatingsAndReviews"),callback:this._renderRatingsAndReviewsTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.REVIEWS}),its.App.ParentalRequestData||e.push({title:its.loc("DV14.ProductPage.Tab.Related"),callback:this._renderRelatedTab.bind(this),tabId:its.dv14.ProductPageUtil.Tabs.RELATED})),e},_fetchEpisodesAndRenderDetails:function(e,t){if(!this._episodes){var n=function(n){this._episodes=[];
for(var r=0;
r<n.orderedKeys.length;
r++){var i=n.orderedKeys[r];
this._episodes.push(n[i])}this._episodes=its.dv14.ProductPageUtil.sortChildrenByTrackNumber(this._episodes),its.notifications.publish(its.dv14.ProductPage.Events.CLOSED_CAPTION_AVAILABLE,{isCC:this._isSeasonClosedCaptioned(),id:this._season().id}),this._renderDetailsTab(e,t)}.bind(this);
this.storePlatform.fetchContent({profile:its.sf.StorePlatform.Profiles.ITEM,ids:this._season().childrenIds,onOK:n})}else this._renderDetailsTab(e,t)},_renderDetailsTab:function(e,t){var n=its.Templates.get("pages/dv14_tv_season_page/details_tab"),r=this.pageData.tuneIn;
if(r){var i=its.Templates.get("pages/dv14_tv_season_page/tune_in_lockup");
if(r.logoUrl){i.keepBlock("hasImage",!0),i.replaceToken("source",r.logoUrl);
var s=its.dv14.LockupUtil.getArtworkDimensions("tuneIn",null,this.size());
i.replaceToken("width",s.width),i.replaceToken("height",s.height)}i.replaceTokenUnescaped("title",r.blurb,!0),n.replaceTokenWithElement("tuneIn",i.composeAsElement())}var o=this.product.itunesNotes;
if(o&&o.standard){var u={title:its.loc("iTunesNotes"),description:o.standard,dontEscape:!0,maxLines:5};
n.replaceTokenWithElement("editorsNotes",this.renderComponentWithData("description",u))}if(this._season().description){var a=this._season().description.standard;
if(a){var f={title:its.loc("DV14.TvSeasonPage.AboutTheShow"),description:a,dontEscape:!0,maxLines:5};
n.replaceTokenWithElement("description",this.renderComponentWithData("description",f))}}var l=document.createDocumentFragment();
for(var c=0;
c<this._episodes.length;
c++){var h=this._episodes[c];
h.seasonId=this._season().id,c===0&&(h.isFirstEpisode=!0),l.appendChild(this._createEpisodeLockup(h))}n.replaceTokenWithElement("episodeList",l);
var p={title:its.loc("DV14.Information"),infoItems:[{title:its.loc("DV14.TvSeasonPage.Network"),values:[this.pageData.network]},{title:its.loc("Genre"),values:[this._season().genres[0].name]},{title:its.loc("Released"),values:[its.locDate(this._season().releaseDate)],replaceUnescaped:!0}]};
this.pageData.network||p.infoItems.splice(0,1),n.replaceTokenWithElement("infoList",this.renderComponentWithData("info_list",p));
if(this._season().passType=="season"||this._season().passType=="multi"){var d=this._season().passType=="season"?its.loc("DV14.TvSeasonPage.SeasonPass"):its.loc("DV14.TvSeasonPage.MultiPass"),v={title:d,description:this.pageData.passDescription,maxLines:0},m=this.renderComponentWithData("description",v);
n.replaceTokenWithElement("passInfo",m)}this._season().copyright&&n.replaceToken("copyright",this._season().copyright);
if(its.sf.Platform.iPhone()&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]){var g=its.Templates.get("pages/dv14_product_page/hd_sd_toggle"),y=this._pageState==its.sf14.ProductPage.State.HD?its.loc("SF14.AlsoAvailableInSD"):its.loc("SF14.AlsoAvailableInHD");
g.replaceToken("hdSdText",y);
var b=g.compose();
this.subscribeToTarget(its.sf14.Events.SELECT,this._handleHDSDToggleClicked.bind(this),b.itsId()),n.replaceTokenUnescaped("hdSdToggle",b),n.keepBlock("hasHdSdToggle",!0)}t.appendChild(n.composeAsElement())},_createEpisodeLockup:function(e){var t=its.dv14.Util.UI.shouldShowiPadTVEpisode()?its.Templates.get("pages/dv14_tv_season_page/episode_item_ipad"):its.Templates.get("pages/dv14_tv_season_page/episode_item_iphone"),n={number:formatNumber(e.trackNumber),title:e.name},r=e.description&&e.description.standard||null,i=its.sf.Client.isVersion("10.1")||itms.areVideosCloudPurchasesEnabled&&itms.areVideosCloudPurchasesEnabled();
t.replaceToken("title",its.loc("DV14.TvSeasonPage.TrackNumberAndTitle",n)),t.replaceToken("description",r);
if(its.dv14.Util.UI.shouldShowiPadTVEpisode()){its.sf.Platform.iPad()||t.replaceToken("titleClass","episode-title"),t.replaceToken("moreLabel",its.loc("more"));
var s=its.sf.StorePlatformUtil.bestPreview(e.offers),o=its.sf.ContentRatingsManager.legacyContentRating(e),u={artworkData:{artworkUrls:e.screenshots,size:{width:its.sf.Platform.iPad()?150:100,height:its.sf.Platform.iPad()?84:56},alt:e.name},url:s&&s.url,contentRating:o,kind:e.kind,contentId:e.id};
t.replaceTokenWithElement("videoPreview",this.renderComponentWithData("video",u));
var a=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(e.offers):its.sf.StorePlatformUtil.findSDOffers(e.offers),f=its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets([a[0]]),l={offer:a[0],content:e,isPurchasedModal:this.data.isPurchasedModal},c=[];
c.push(its.sf14.ComponentUtil.createDate(this,e.releaseDate,null,!0)),o&&c.push(its.dv14.BadgeUtil.VideoAgeRating.badge(this,o,!0)),f&&c.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0));
var h=t.getBlock("itemLoop");
for(var p=0;
p<c.length;
p++)h.replaceTokenWithElement("item",c[p]),h.next();
its.sf.Platform.iPad()||t.keepBlock("needsSpacer",!0),l.offer||(l.offer={}),t.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("buy_button",l))}if(its.sf.Platform.iPhone()){var d=this._pageState==its.sf14.ProductPage.State.SD?its.url.appendUrlParameter(e.url,"showLC",!0):e.url;
this.data.isPurchasedModal&&(its.sf.Platform.isIPhone4ScreenSize()||its.sf.Platform.isIPhone5ScreenSize())&&(d=its.url.appendUrlParameters(d,{isPurchasedModal:!0})),t.replaceToken("url",d),t.replaceToken("contentId",e.id),t.replaceToken("kind",e.kind)}var v=t.composeAsElement();
return v},_renderRelatedTab:function(e,t,n){var r=its.Templates.get("pages/dv14_tv_season_page/related_tab"),i=n?"grid":"swoosh",s=function(){var e;
if(this.pageData.moreSeasonsInSeries&&this.pageData.moreSeasonsInSeries.length>0){e=n?3:null;
var s={title:its.loc("DV14.TvSeasonPage.MoreSeasonsByArtist",{artistName:this._season().artistName}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreSeasonsInSeries,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreSeasons",this.renderComponentWithData(i,s))}if(this.pageData.viewersAlsoBought&&this.pageData.viewersAlsoBought.length>0){e=n?3:null;
var o={title:its.loc("DV14.ProductPage.ViewersAlsoBought"),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.viewersAlsoBought,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("viewersAlsoBought",this.renderComponentWithData(i,o))}if(this.pageData.moreInGenre&&this.pageData.moreInGenre.length>0){e=n?3:null;
var u=this._season().genres[0],a=u?u.name:null,f={title:its.loc("DV14.TvSeasonPage.TopTVShowsInGenre",{genre:a}),contentIds:its.dv14.ProductPageUtil.trimSwooshIds(this.pageData.moreInGenre,e),suppressPersonalization:!0,scrollableCellControllerClass:n?its.sf14.ScrollableCellController.RelatedGrid:its.sf14.ScrollableCellController.Basic,useAlternateTemplate:n?!0:!1};
r.replaceTokenWithElement("moreInGenre",this.renderComponentWithData(i,f))}t.appendChild(r.composeAsElement());
if(t.lastElementChild){var l=t.lastElementChild.getElementsByTagName("divider").item(0);
l&&l.remove()}}.bind(this),o=[];
this.pageData.moreSeasonsInSeries&&(o=o.concat(this.pageData.moreSeasonsInSeries)),this.pageData.viewersAlsoBought&&(o=o.concat(this.pageData.viewersAlsoBought)),this.pageData.moreInGenre&&(o=o.concat(this.pageData.moreInGenre));
var u={profile:its.sf.StorePlatform.Profiles.LOCKUP,artworkProfile:its.sf.StorePlatform.ArtworkProfiles.SWOOSH,ids:o,onOK:s.bind(this),suppressPersonalization:!0};
this.storePlatform.fetchContent(u)},_determineValidPageStates:function(){this._validPageStates={},this._validPageStates[its.sf14.ProductPage.State.HD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this._season(),its.sf14.ProductPage.State.HD),this._validPageStates[its.sf14.ProductPage.State.SD]=its.dv14.ProductPageUtil.shouldShowContentsForProductPageState(this._season(),its.sf14.ProductPage.State.SD);
if(!this._pageState){var e=its.url.queryParamsDict(this.documentUrl());
this._pageState=!e.showLC&&this._validPageStates[its.sf14.ProductPage.State.HD]?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD}var t={pageState:this._pageState,contentId:this._season().id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,t)},_handleHDSDToggleClicked:function(){var e={pageState:this._pageState==its.sf14.ProductPage.State.HD?its.sf14.ProductPage.State.SD:its.sf14.ProductPage.State.HD,contentId:this._season().id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,e)},_handlePageStateChanged:function(e){this._season().id==e.contentId&&this._pageState!=e.pageState&&(this._document&&its.sf.Platform.iPhone()&&this._document.scrollToTop(),this._pageState=e.pageState,this._renderProductLockup(!0),this._tabbedPane.refreshTab(its.dv14.ProductPageUtil.Tabs.DETAILS))},_isSeasonClosedCaptioned:function(){var e=its.reflect.keys(this._episodes),t=e.length,n=t>0;
for(var r=0;
r<t&&n;
r++){var i=this._episodes[e[r]],s=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(i.offers):its.sf.StorePlatformUtil.findSDOffers(i.offers);
n=its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets(s)}return n}}),its.dv14.TvSeasonPage.Events={WATCH_FIRST_EPISODE:"its.dv14.TvSeasonPage.Events.WATCH_FIRST_EPISODE"},its.dv14.UnsupportedProductPage=Class.createSubclass("its.dv14.UnsupportedProductPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this.pageData=this.data.pageData,this.contentId=this.pageData.id;
if(!this.contentId)throw console.log("No contentId. this:",this),"No contentId";
this.template=its.App.ParentalRequestData?its.Templates.get("pages/dv14_unsupported_atb_product_page"):its.Templates.get("pages/dv14_unsupported_product_page")},renderDocument:function(){return this._document=this.base(),this._document},render:function(){if(its.App.ParentalRequestData)return this.renderATBPage();
this.product=this.storePlatform.getCachedData(this.contentId);
var e={navigationTitle:this.product.name,product:this.product},t=this.renderComponentWithData("navigation_bar",e);
this.template.replaceTokenWithElement("navigationBar",t);
var n=this.renderComponentStringWithData("artwork",{artworkUrls:this.product.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.size()),alt:this.product.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this.product.kind)]});
this.template.replaceTokenUnescaped("artwork",n);
var r,i,s;
if(this.product.kind===its.sf.StorePlatform.Kind.MobileApp)this.product.deviceFamilies.indexOf("ipad")>=0?(r="SF.ItemIsOnlyAvailable.ipad",i="SF.YouCanDownloadAppStore.ipad"):(r="SF.ItemIsOnlyAvailable.iphone",i="SF.YouCanDownloadAppStore.iphone"),s="SF.LearnMoreAboutThisApp";
else if(this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle)this.product.designedForDeviceFamilies.indexOf("ipad")>=0?(r="SF.ItemIsOnlyAvailable.ipad",i="SF.YouCanDownloadAppStore.ipad"):(r="SF.ItemIsOnlyAvailable.iphone",i="SF.YouCanDownloadAppStore.iphone"),s="SF.LearnMoreAboutThisAppBundle";
else if(this.product.kind===its.sf.StorePlatform.Kind.MacApp)r="SF.ItemIsOnlyAvailable.mac",i="SF.YouCanDownloadAppStore.mac",s="SF.LearnMoreAboutThisApp";
else if(this.product.kind===its.sf.StorePlatform.Kind.EBook||this.product.kind===its.sf.StorePlatform.Kind.EBookApple||this.product.kind===its.sf.StorePlatform.Kind.EBookMeta||this.product.kind===its.sf.StorePlatform.Kind.EBookTextbook)r="SF.ItemIsOnlyAvailable.ipad",i="SF.YouCanDownloadBookStore.ipad";
this.template.replaceToken("message",its.loc(r,{name:this.product.name})),this.template.replaceToken("explanation",its.loc(i,{name:this.product.name}));
if(s&&this.product.softwareInfo&&this.product.softwareInfo.websiteUrl){var o={"data-url":this.product.softwareInfo.websiteUrl,"data-page-target":its.sf14.PageController.PageTarget.EXTERNAL},u=its.sf14.ComponentUtil.createButton(this,its.loc(s),its.sf14.ComponentUtil.ButtonType.DEFAULT,o);
this.template.replaceTokenUnescaped("learnMoreButton",u)}return this._pageElement=this.template.composeAsElement(),this.addDocumentStyles(this._pageElement),this._pageElement},renderATBPage:function(){this.product=this.storePlatform.getCachedData(this.contentId);
switch(this.product.kind){case its.sf.StorePlatform.Kind.MobileApp:this._pageElement=this.renderComponentWithData("software_page",this.data);
break;case its.sf.StorePlatform.Kind.MacApp:this._pageElement=this.renderComponentWithData("mac_app_page",this.data);
break;case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.ToneAlbum:case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:this._pageElement=this.renderComponentWithData("album_page",this.data);
break;default:var e={navigationTitle:this.product.name,product:this.product},t=this.renderComponentWithData("navigation_bar",e);
this.template.replaceTokenWithElement("navigationBar",t),this.template.replaceToken("prompt",its.App.ParentalRequestData.prompt);
var n=this.renderComponentWithData("artwork",{artworkUrls:this.product.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.size()),alt:this.product.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this.product.kind)]});
this.template.replaceTokenWithElement("artwork",n),this.template.replaceTokenWithElement("title",its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE},!0)),this.template.replaceTokenWithElement("subtitle",its.sf14.ComponentUtil.createText(this,this.product.artistName,{type:its.sf14.ComponentUtil.TextType.SUBTITLE},!0)),this._pageElement=this.template.composeAsElement()}return this.addDocumentStyles(this._pageElement),this._pageElement}}),its.dv14.VideoPlaylist=Class.createSubclass("its.dv14.VideoPlaylist",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("pages/dv14_video_playlist"),this._videos=this.lookup("videos")},render:function(){var e=this._template.getBlock("videoLoop"),t;
for(var n=0;
n<this._videos.length;
n++)t=this._videos[n],e.replaceTokenUnescaped("video",this.renderComponentStringWithData("video",t)),e.next();
return this._template.composeAsElement()}}),its.dv14.WatchVideoPage=Class.createSubclass("its.dv14.WatchVideoPage",its.dv14.BaseDocument,{initialize:function(){this.base.apply(this,arguments)},render:function(){var e=its.Templates.get("pages/watch_video_page");
this.pageElement=e.composeAsElement(),this.pageElement.replaceTokenWithElement("navigationBar",this.navigationBar()),this.addDocumentStyles(this.pageElement),this.countryCode=its.serverData.constants.countryCode.toUpperCase(),this.videoData=null,this.getVideosData();
var t=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.Gizmo.LearnMoreAboutAppleWatch"),its.sf14.ComponentUtil.ButtonType.LINK,{"class":"watch-video-learn-more",maxLines:1,"data-url":its.loc("DV14.Gizmo.curtainLearnMoreUrl"),"data-page-target":"external"},null,!0);
return this.pageElement.replaceTokenWithElement("learnMoreLink",t),this.pageElement},navigationBar:function(){var e=its.Templates.get("pages/watch_video_page/navigation_bar");
e.replaceToken("videoPageTitle",its.loc("DV14.Gizmo.VideoPageTitle"));
var t=e.composeAsElement();
return t},getVideosData:function(){var e="/images/watch/videoFeed_"+this.countryCode+".json";
its.sf14.Util.fetchServerGetResponse(its.serverData.constants.resourceBaseUrl+e,this.fetchSuccess.bind(this),this.fetchFailure.bind(this))},fetchSuccess:function(e){var t=e.responseText?JSON.parse(e.responseText):null;
t?(this.videoData=t,this.renderVideos(this.videoData)):this._logger.error("error")},fetchFailure:function(e){var t="/images/watch/videoFeed_USA.json";
its.sf14.Util.fetchServerGetResponse(its.serverData.constants.resourceBaseUrl+t,this.fetchSuccess.bind(this),function(e){this._logger.error(["Somehow this failed:",url])}.bind(this))},renderVideos:function(e){if(e&&e.videos){var t=document.createDocumentFragment();
for(i=0,len=e.videos.length;
i<len;
i++){var n=its.dv14.Util.UI.Orientation=="landscape"?its.Templates.get("pages/watch_video_page/video_lockup/n56_landscape"):its.Templates.get("pages/watch_video_page/video_lockup");
n.replaceToken("posterArtUrl",e.videos[i].posterImage),n.replaceToken("videoUrl",e.videos[i].url),n.replaceToken("title",e.videos[i].title),t.appendChild(n.composeAsElement())}this.pageElement.replaceTokenWithElement("lockups",t)}},onOrientationChange:function(e){this.videoData&&this.renderVideos(this.videoData)}}),its.dv14.CategoryLockup=Class.createSubclass("its.dv14.CategoryLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"lockups/dv14_category_lockup"},renderAsString:function(){var e=this.lookup("category");
this.template.replaceToken("category",e),this.lookup("isSelected")&&this.addClass("selected");
if(this.lookup("artwork")&&!its.dv14.Util.Client.isBridge()){var t=this.lookup("kind"),n=!t||t!==its.sf.StorePlatform.Kind.MobileApp&&t!==its.sf.StorePlatform.Kind.MobileAppBundle?["light-art"]:["app-art"],r="category_list_itunes";
its.dv14.Util.Client.isAppStore()?r="category_list_app_store":its.dv14.Util.Client.isIBooks()&&(r="category_list_ibooks");
var i={artworkUrls:this.lookup("artwork"),size:its.sf14.LockupUtil.getArtworkDimensions(r,null,this.documentSize()),alt:e,classes:n},s=this.renderComponentStringWithData("artwork",i);
this.template.replaceTokenUnescaped("artwork",s)}var o=this.lookup("hasChildren");
return o&&this.template.keepBlock("hasChildren",o),this.addClass("category-lockup-row"),this.setAttribute("type","list"),this._markup=this.template.compose(this.itsId()),this._markup},onElementCreated:function(){var e=this.lookup("checkbox");
this.lookup("isSelected")&&e&&this.element.appendChild(e),its.sf.Metrics.setTargetInfo(this.element,this.lookup("genreId"),"listitem",its.sf.Metrics.ActionType.NAVIGATE,this.lookup("url"),{categoryName:this.lookup("category"),categoryKind:this.lookup("kind")})}}),its.dv14.CustomLockup=Class.createSubclass("its.dv14.CustomLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=this.getTemplate()},getTemplate:function(){var e;
this.data.orientation=this.data.orientation||its.dv14.CustomLockup.DefaultOrientation;
switch(this.data.orientation){case its.dv14.CustomLockup.Orientation.V0:e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v0");
break;case its.dv14.CustomLockup.Orientation.V1:e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v1");
break;case its.dv14.CustomLockup.Orientation.V2:e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v2");
break;case its.dv14.CustomLockup.Orientation.V3:e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v3");
break;case its.dv14.CustomLockup.Orientation.V4:e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v4");
break;case its.dv14.CustomLockup.Orientation.V5:its.sf.Platform.iPhone()?e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v5_iphone"):its.sf.Platform.iPad()&&(e=its.Templates.get("lockups/dv14_custom_lockup/orientation_v5_ipad"))}return e},renderAsString:function(){if(!this.isValidBlockData())return!1;
switch(this.data.subType){case its.dv14.CustomLockup.SubType.IMAGE:this.renderImage();
break;case its.dv14.CustomLockup.SubType.VIDEO:this.renderVideo();
break;default:this.data.fields=this.data.fields||[],this.renderProductArtwork(),this.renderProductDetails(),this.renderProductOffer(),this.renderProductMediaButton(),this.setProductAttributes(),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this)),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this))}return this.renderEditorial(),this._template.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(this._attributes)),this._template.replaceToken("classes",this._classes.join(" ")),this.data.align&&this._template.replaceToken("align",this.data.align),this._template.compose()},isValidBlockData:function(){var e=!0;
return this.data||(e=!1),this.data&&this.data.subType&&this.data.subType==its.dv14.CustomLockup.SubType.PRODUCT&&(its.isDefined(this.data.product)||(e=!1)),e},renderVideo:function(){var e=this._artworkSize("horizontal_1"),t=this.renderComponentStringWithData("video",{url:this.data.url,artworkData:{artworkUrls:this.data.artwork,size:e,disabled:!1},classes:["editorial-lockup-image"]});
its.isString(t)&&this._template.replaceTokenUnescaped("artwork",t)},renderImage:function(){var e=!0,t=this._artworkSize("square_1"),n;
this.data.link&&(this.data.link.url&&this.setAttribute("data-url",this.data.link.url),this.data.link.target&&this.setAttribute("data-page-target",this.data.link.target),e=!1),n=this.renderComponentStringWithData("artwork",{artworkUrls:this.data.artwork,size:this._artworkSize(),disabled:e,classes:["editorial-lockup-image"]}),its.isString(n)&&this._template.replaceTokenUnescaped("artwork",n)},renderEditorial:function(){if(this.data.editorial){var e=its.dv14.BlockUtil.deepExtend({},this.data.editorial);
this.data.subType==its.dv14.CustomLockup.SubType.PRODUCT&&this.data.useLockupTitle&&!e.title&&this.data.product&&(e.title=this.data.product.name);
if(this.data.orientation==its.dv14.CustomLockup.Orientation.V0&&e.title){var t=this.renderComponentStringWithData("editorial_block",{title:e.title,titleColor:e.titleColor,titleWeight:e.titleWeight,align:e.align});
t&&this._template.replaceTokenUnescaped("editorialTitle",t),delete e.title}var n=this.renderComponentStringWithData("editorial_block",e);
n&&this._template.replaceTokenUnescaped("editorial",n)}},_artworkSize:function(e){var t,n=this.data.artworkProfile||e||"square_1";
if(this.data.artworkSize)t=this.data.artworkSize;
else{var r=this.data.product&&this.data.product.kind?this.data.product.kind:null;
t=its.dv14.BlockArtwork.getArtworkDimensions(n,r)}return t},renderProductArtwork:function(){var e=this.data.product,t=this._artworkSize("product_1");
if(this.data.fields.indexOf("artwork")<0)return;var n=its.dv14.LockupUtil.getAppArtworkStyle(e),r=its.dv14.LockupUtil.getArtworkUrlsForStyle(e,n),i={artworkUrls:r,size:t,effects:this.data.product.artworkEffects||its.sf14.Artwork.effects(this.data.product.kind),alt:this.data.product.name,disabled:!0,classes:[its.dv14.LockupUtil.getArtworkClassName(this.data.product.kind,n),"editorial-lockup-image"]},s=this.renderComponentStringWithData("artwork",i);
this._template.replaceTokenUnescaped("artwork",s)},renderProductOffer:function(){if(this.data.fields.indexOf("buyButton")<0)return;var e=its.Templates.get("lockups/dv14_custom_lockup/offer"),t=its.sf.StorePlatformUtil.orderedOffers(this.data.product.offers)[0],n=t.type==its.sf.StorePlatform.Offer.Type.PREORDER,r={content:this.data.product,offer:t};
n&&(r.buttonStyle=its.dv14.BuyButton.ButtonStyle.preorder),e.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("buy_button",r));
if(this._shouldShowInAppPurchasesNotice()){e.keepBlock("hasInAppPurchases");
var i=e.getBlock("hasInAppPurchases");
i.replaceToken("iapText",its.loc("InAppPurchases"));
var s=its.sf.Platform.iPhone()?"software-iap-label-iphone":"software-iap-label-ipad";
i.replaceToken("iapClass",s)}this._template.replaceTokenUnescaped("offer",e.compose())},renderProductDetails:function(){var e=its.dv14.CustomLockup.DetailsGenerator.details(this.data.fields,this.data.product,this.data.orientation),t="";
if(e){var n=its.Templates.get("lockups/dv14_custom_lockup/item_container"),r=n.getBlock("itemLoop"),i,s=null,o,u;
for(var a=0;
a<e.length;
a++){i=e[a];
if(i.markup)s=i.markup;
else if(i.value){var f=i.type&&i.type=="TITLE"?this._badges():null;
s=its.sf14.ComponentUtil.createText(this,i.value,{type:its.sf14.ComponentUtil.TextType[i.type],attributes:{maxLines:i.maxLines||null,"class":i.class||""},badges:f})}r.replaceTokenUnescaped("item",s),r.next()}t=n.compose()}this._template.replaceTokenUnescaped("details",'<section class="editorial-lockup-details">'+t+"</section>")},renderProductMediaButton:function(){if(this.data.media&&this.data.media.type&&this.data.media.url&&this.data.media.actionText){var e;
switch(this.data.media.type){case its.dv14.CustomLockup.Media.AUDIO:e=its.sf14.ComponentUtil.createButton(this,this.data.media.actionText,its.sf14.ComponentUtil.ButtonType.BUY,{"class":"uber-title-color"},this._playAudio.bind(this),!1);
break;case its.dv14.CustomLockup.Media.VIDEO:e=its.sf14.ComponentUtil.createButton(this,this.data.media.actionText,its.sf14.ComponentUtil.ButtonType.BUY,{"class":"uber-title-color"},this._playAudio.bind(this),!1)}this._template.replaceTokenUnescaped("mediaButton",e)}},setProductAttributes:function(){var e=this.data.product.kind,t=this.data.product.id,n=this.data.product.url;
if(e==its.sf.StorePlatform.Kind.Song||e==its.sf.StorePlatform.Kind.TvEpisode)t=this.data.product.collectionId;
this.setAttribute("data-content-id",t),this.setAttribute("data-preview-id",t),this.setAttribute("data-content-kind",e),this.setAttribute("data-url",n)},_playAudio:function(){var e={previewUrl:this.data.media.url,content:this.data.product};
itms.setPreviewOverlay(its.sf14.BaseDocument.renderDocumentWithData("preview_overlay",e),{playsImmediately:!0})},_playVideo:function(){},_shouldShowInAppPurchasesNotice:function(){var e=[],t=this.storePlatform.getCachedOffersArray(this.data.product.id);
return t.length>0&&(e=its.sf.StorePlatformUtil.findRedownloadOffers(t)),this.data.product.hasInAppPurchases&&e.length==0},_removeInAppPurchasesNotice:function(){if(this.element){var e=this.element.querySelector("notice");
e&&e.remove()}},_badges:function(e){var t=[],n=its.sf.ContentRatingsManager.legacyContentRating(this.data.product),r=its.sf.StorePlatformUtil.ContentRating.isClean(n),i=its.sf.StorePlatformUtil.ContentRating.isExplicit(n);
if(r||i)r&&its.dv14.BadgeUtil.shouldShowCleanExplicitBadgeForKind(this.data.product.kind)&&t.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CLEAN,!0)),i&&its.dv14.BadgeUtil.shouldShowCleanExplicitBadgeForKind(this.data.product.kind)&&t.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.EXPLICIT,!0));
return t},_updateRestrictions:function(){},_handlePersonalizationEvent:function(e){if(this.storePlatform==e.caller&&its.isDefined(e.data[this.data.product.id])){this.data.product.hasInAppPurchases&&!this._shouldShowInAppPurchasesNotice()&&this._removeInAppPurchasesNotice();
if(this._priceStringElement){var t=this.storePlatform.getCachedData(this.data.product.id),n=its.sf.StorePlatformUtil.findPersonalizedOffers(t.offers);
n.length>0&&(this._priceStringElement.innerXML=its.loc("DV14.BuyButton.Purchased"))}}}}),its.dv14.CustomLockup.hasValidBlockData=function(){},its.dv14.CustomLockup.DetailsGenerator={details:function(e,t,n){if(!its.isArray(e)||e.length<1)return;var r=t.kind,i=[],s={attributes:{"class":"price-string"}};
for(var o=0,u,a;
o<its.dv14.CustomLockup.DetailsGenerator.LineItems.order.length;
o++){u=its.dv14.CustomLockup.DetailsGenerator.LineItems.order[o];
if(e.indexOf(u)>-1)switch(u){case its.dv14.CustomLockup.DetailsGenerator.LineItems.NAME:a=t.name,r==its.sf.StorePlatform.Kind.PodcastEpisode?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:t.collectionName+" â "+t.artistName,type:"TITLE"})):r==its.sf.StorePlatform.Kind.TvSeason?(a=t.artistName,i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),a=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(t.name,t.artistName),i.push({value:a,type:"TITLE"})):r==its.sf.StorePlatform.Kind.TvEpisode?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:t.collectionName,type:"TITLE"})):r==its.sf.StorePlatform.Kind.MobileAppBundle?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:its.loc("SF.NumApps",{count:t.appCount}),type:"TITLE"})):a&&i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"});
break;case its.dv14.CustomLockup.DetailsGenerator.LineItems.ARTIST:a=t.artistName,a&&i.push({value:a});
break;case its.dv14.CustomLockup.DetailsGenerator.LineItems.GENRE:t.genres&&t.genres.length>0&&i.push({value:t.genres[0].name});
break;case its.dv14.CustomLockup.DetailsGenerator.LineItems.PRICE:var f=its.sf.StorePlatformUtil.orderedOffers(t.offers);
if(f.length>0){var l=f[0],c=l.priceFormatted;
if(!l.price)c=l.actionText.short;
else if(l.type==its.sf.StorePlatform.Offer.Type.PREORDER)c=c;
else if(r==its.sf.StorePlatform.Kind.Movie||r==its.sf.StorePlatform.Kind.TvSeason)c=its.loc(its.sf.StorePlatformUtil.isOfferHDVariant(l)?"DV6Lockup.priceText.video.hd":"DV6Lockup.priceText.video.sd",{price:c});
i.push({value:c})}}}return i}},its.dv14.CustomLockup.SubType={PRODUCT:"product",IMAGE:"image",VIDEO:"video"},its.dv14.CustomLockup.Orientation={V0:"v0",V1:"v1",V2:"v2",V3:"v3",V4:"v4",V5:"v5"},its.dv14.CustomLockup.DefaultOrientation=its.dv14.CustomLockup.Orientation.V0,its.dv14.CustomLockup.Media={AUDIO:"audio",VIDEO:"video"},its.dv14.CustomLockup.DetailsGenerator.LineItems={NAME:"name",ARTIST:"artistName",GENRE:"genreName",PRICE:"price",order:["name","artistName","genreName","price"]},its.dv14.SmallLockup=Class.createSubclass("its.dv14.SmallLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._type=this.lookup("type"),this._ordinal=this.lookup("ordinal"),this._titleOrdinal=this.lookup("titleOrdinal"),this._isEditable=this.lookup("isEditable"),this._stdQualityOverride=this.lookup("stdQuality"),this._titleMaxLines=this.lookup("titleMaxLines"),this._disableLockupOnSelect=this.lookup("disableLockupOnSelect"),this._doesPassParentalRating=its.sf.ParentalRatingUtil.doesPass(this._content),this._containsAd=this.lookup("containsAd"),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this)),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this._isEditable&&(this.subscribe(its.sf14.BaseDocument.Events.ENTER_EDIT_MODE,this._enterEditMode.bind(this)),this.subscribe(its.sf14.BaseDocument.Events.EXIT_EDIT_MODE,this._exitEditMode.bind(this)))},templateName:function(){return"lockups/dv14_small_lockup"},componentType:function(){return"lockup"},renderAsString:function(){var e=this._content.collectionId?this._content.collectionId:this._content.id,t=this._content.id;
e&&(!its.sf.Platform.iPhone()||this._content.kind!=its.sf.StorePlatform.Kind.TvEpisode)&&this._content.kind!=its.sf.StorePlatform.Kind.MusicVideo&&this.setAttribute("data-collection-id",e);
if(!this._disableLockupOnSelect){var n=this._content.kind,r=["song","podcastEpisode","tvEpisode","ringtone"];
n&&r.indexOf(n)<=-1&&this.setAttribute("data-preview-id",t),this.setAttribute("data-content-id",t),this.setAttribute("data-content-kind",n),this.setAttribute("data-url",this._content.url),this.addClass("clear")}else this.addClass("no-highlight");
if(this._isEditable){var i=its.Templates.get("lockups/dv14_small_lockup/input");
this._inputElementStr=i.compose(),this.template.replaceTokenUnescaped("input",this._inputElementStr),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleLockupSelection.bind(this),this.itsId())}this._ordinal&&!this._titleOrdinal&&(this.template.keepBlock("ordinalBlock"),this.template.replaceToken("ordinal",this._ordinal)),this._content.itunesuType&&this.setAttribute("data-itunesu-type",this._content.itunesuType);
var s=this._type==its.dv14.SmallLockup.Type.LIST&&this._detailsGenerator().suppressBuyButton(this._content)||this.lookup("showArrow");
this.template.keepBlock("decorationImageBlock",s),this._renderDetails();
var o=its.sf.StorePlatformUtil.bestPreview(this._content.offers);
this._shouldRenderTrackPreview()&&its.isDefinedNonNull(o)&&(this.template.keepBlock("previewBlock",!0),this.template.replaceToken("previewUrl",o.url),this.template.replaceToken("previewContentId",this._content.id),this._shouldRenderTrackPreview()&&this.template.replaceToken("disablePreviewControl",!this._doesPassParentalRating)),(!this._detailsGenerator().suppressArtwork||!this._detailsGenerator().suppressArtwork(this._content))&&this.template.replaceTokenUnescaped("artwork",this._artwork());
if(this._type==its.dv14.SmallLockup.Type.LIST||this._type==its.dv14.SmallLockup.Type.PURCHASES_PAGE_GRID)its.sf.Platform.iPad()&&this._classes.push("ipad-lockup-row"),this.setAttribute("type","list"),this._detailsGenerator().suppressBuyButton(this._content)||this.template.replaceTokenUnescaped("offer",this._renderOffer());
var u=this.lookup("actions");
u&&this.template.replaceTokenUnescaped("actions",this._renderActions(u));
var a=this.lookup("additionalAttributes");
if(a)for(var f in a)this.setAttribute(f,a[f]);
var l=its.dv14.Util.Client.isBridge()&&this._content.kind==its.sf.StorePlatform.Kind.MobileApp,c=its.dv14.Util.Client.isVoyager();
return(c||l)&&this.setAttribute("style","text-align:center"),this.template.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(this._attributes)),this.template.replaceToken("classes",this._classes.join(" ")),this._markup=this.template.compose(this.itsId()),this._markup},_badges:function(){var e=[];
if(its.dv14.BadgeUtil.shouldShowCleanExplicitBadgeForKind(this._content.kind)){var t=its.sf.ContentRatingsManager.legacyContentRating(this._content),n=its.sf.StorePlatformUtil.ContentRating.isExplicit(t),r=its.dv14.BadgeUtil.createCleanOrExplicitBadge(t,!0);
n||(r=!1),r&&e.push(r)}return e},_renderOffer:function(){var e=its.Templates.get("lockups/dv14_small_lockup/offer"),t;
if(!this._stdQualityOverride)t=its.sf.StorePlatformUtil.orderedOffers(this._content.offers)[0];
else{t=its.sf.StorePlatformUtil.findSDOffers(this._content.offers)[0];
if(this._content.kind==its.sf.StorePlatform.Kind.Movie||this._content.kind==its.sf.StorePlatform.Kind.MovieBundle||this._content.kind==its.sf.StorePlatform.Kind.TvEpisode||this._content.kind==its.sf.StorePlatform.Kind.TvSeason||this._content.kind==its.sf.StorePlatform.Kind.MusicVideo){var n=its.url.appendUrlParameter(this._content.url,"showLC","true");
this.setAttribute("data-url",n)}}var r={content:this._content,offer:t},i=its.sf.StorePlatformUtil.findPreorderOffers([t]).length>0;
i&&(r.buttonStyle=its.dv14.BuyButton.ButtonStyle.preorder),this._containsAd&&this._containsAd.format.icon==="small"&&its.dv14.Util.UI.Orientation!=="landscape"&&!its.sf.Platform.iPad()&&e.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString({compact:!0})),its.dv14.NotifyMeButton.isNotifyMeContent(this._content.id)?e.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("notify_me_button",r)):e.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("buy_button",r));
if(this._shouldShowInAppPurchasesNotice()){e.keepBlock("hasInAppPurchases");
var s=e.getBlock("hasInAppPurchases");
s.replaceToken("iapText",its.loc("InAppPurchases"));
var o=its.sf.Platform.iPhone()?"software-iap-label-iphone":"software-iap-label-ipad";
s.replaceToken("iapClass",o)}return e.compose()},_removeInAppPurchasesNotice:function(){if(this.element){var e=this.element.querySelector("notice");
e&&e.remove()}},_shouldShowInAppPurchasesNotice:function(){var e=[],t=this.storePlatform.getCachedOffersArray(this._content.id);
return t.length>0&&(e=its.sf.StorePlatformUtil.findRedownloadOffers(t)),this._content.hasInAppPurchases&&e.length==0},_detailsGenerator:function(){var e=this.lookup("detailsGenerator");
return e||(this._type==its.dv14.SmallLockup.Type.LIST?e=its.dv14.SmallLockup.DefaultDetailsGenerator.List:e=its.dv14.SmallLockup.DefaultDetailsGenerator),e},_renderDetails:function(){var e=this._detailsGenerator().details.call(this,this._content),t;
if(e){var n=its.Templates.get("lockups/dv14_small_lockup/item_container"),r=n.getBlock("itemLoop");
for(var i=0;
i<e.length;
i++){var s=e[i],o=null;
if(s.markup)o=s.markup;
else if(s.value)if(i==0){var u=this._titleMaxLines;
u||(u=2);
var a=s.value;
this._ordinal&&this._titleOrdinal&&(a=this._ordinal+" "+s.value),a.length>18&&e.length>3&&(u=1),o=its.sf14.ComponentUtil.createText(this,a,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":"lockup-title",maxLines:u},badges:this._badges()})}else if(i==1)o=its.sf14.ComponentUtil.createText(this,s.value,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{"class":"lockup-subtitle",maxLines:1}});
else{var f=null;
s.classNames&&(f={"class":s.classNames.join(" ")}),o=its.sf14.ComponentUtil.createText(this,s.value,{attributes:f})}r.replaceTokenUnescaped("item",o),r.next()}t=n.compose()}if(this.element){var l=this.element.querySelector(".details");
l&&(l.innerXML=t)}else this.template.replaceTokenUnescaped("details",t)},_artwork:function(){var e=!this._doesPassParentalRating,t=!this._shouldRenderTrackPreview(),n="";
this._containsAd&&this._containsAd.format.icon==="small"&&its.dv14.Util.UI.Orientation!=="landscape"&&!its.sf.Platform.iPad()?n="search_ad_compact":n=this.lookup("artworkProfile");
var r=its.dv14.LockupUtil.getArtworkData(this._content,this,n,e,t),i=this.renderComponentStringWithData("artwork",r);
return this._artworkItsId=i.itsId(),i},_updateRestrictions:function(){var e=this._doesPassParentalRating!=its.sf.ParentalRatingUtil.doesPass(this._content);
e&&(this._doesPassParentalRating=its.sf.ParentalRatingUtil.doesPass(this._content));
if(e&&(this._content.kind==its.sf.StorePlatform.Kind.Audiobook||this._content.kind==its.sf.StorePlatform.Kind.EBook))if(this.element){var t=its.element.createDocumentFragmentFromString(this._artwork());
this.element.replaceChild(t,this._artworkElement),this._artworkElement=this.element.querySelector('[itsId="'+this._artworkItsId+'"]')}else this.template.replaceTokenUnescaped("artwork",this._artwork())},_shouldRenderTrackPreview:function(){return this._type==its.dv14.SmallLockup.Type.LIST&&(this._content.kind==its.sf.StorePlatform.Kind.Song||this._content.kind==its.sf.StorePlatform.Kind.Ringtone||this._content.kind==its.sf.StorePlatform.Kind.Tone)},_disableTrackPreview:function(e){var t=this._lockupElement.querySelector("previewControl");
t&&t.setAttribute("disabled",e)},_renderActions:function(e){var t=its.Templates.get("lockups/dv14_small_lockup/actions"),n=t.getBlock("actionLoop");
for(var r=0;
r<e.length;
r++){var i=e[r],s="";
i==its.dv14.SmallLockup.Actions.DELETE&&(s=its.loc("Delete")),n.replaceTokenUnescaped("action",its.sf14.ComponentUtil.createButton(this,s,null,null,this.handleDeleteActionSelected.bind(this))),n.next()}return t.compose()},handleDeleteActionSelected:function(){its.notifications.publish(its.dv14.SmallLockup.Actions.Events.DELETE_SELECTED,{target:this.element})},onElementCreated:function(){this._buyButtonElement=this.element.querySelector("button"),this._inputElement=this.element.querySelector("input"),this._priceStringElement=this.element.querySelector(".price-string");
var e=this.element.querySelector("previewControl");
if(e){var t=e.getAttribute("preview-url");
its.sf.Metrics.setTargetInfo(e,this._content.id,"preview",its.sf.Metrics.ActionType.SELECT,t)}its.sf.Metrics.setTargetInfo(this.element,this._content.id,"lockup",its.sf.Metrics.ActionType.NAVIGATE,this._content.url)},_enterEditMode:function(){this._buyButtonElement&&this._buyButtonElement.setAttribute("disabled","true")},_exitEditMode:function(){this._buyButtonElement&&this._buyButtonElement.setAttribute("disabled","false"),this._inputElement&&this._inputElement.setAttribute("selected",!1)},_handleLockupSelection:function(){if(!its.sf14.BaseDocument.MODE.IS_IN_EDIT_MODE)return;if(this._inputElement){var e=this._inputElement.getAttribute("selected");
e=="true"?this._inputElement.setAttribute("selected",!1):this._inputElement.setAttribute("selected",!0)}its.notifications.publish(its.dv14.SmallLockup.Events.SELECTION_CHANGED,{target:this.element})},_handlePersonalizationEvent:function(e){if(this.storePlatform==e.caller&&its.isDefined(e.data[this._content.id])){this._content.hasInAppPurchases&&!this._shouldShowInAppPurchasesNotice()&&this._removeInAppPurchasesNotice();
var t=this.storePlatform.getCachedData(this._content.id),n=its.sf.StorePlatformUtil.findCMCOffers(t.offers)[0];
n&&this._renderDetails();
if(this._priceStringElement){var r=its.sf.StorePlatformUtil.findPersonalizedOffers(t.offers);
r.length>0&&(this._priceStringElement.innerXML=its.loc("DV14.BuyButton.Purchased"))}}}}),its.dv14.SmallLockup.Type={LIST:"its.dv14.SmallLockup.Type.LIST",PURCHASES_PAGE_GRID:"its.dv14.SmallLockup.Type.PURCHASES_PAGE_GRID"},its.dv14.SmallLockup.Events={SELECTION_CHANGED:"its.dv14.SmallLockup.Events.SELECTION_CHANGED"},its.dv14.SmallLockup.Actions={DELETE:"its.dv14.SmallLockup.Actions.DELETE",Events:{DELETE_SELECTED:"its.dv14.SmallLockup.Actions.Events.DELETE_SELECTED"}},its.dv14.SmallLockup.DefaultDetailsGenerator={details:function(e){var t=e.kind,n=[],r={},i={},s={},o={};
this.lookup("personalizePrice")&&(o={attributes:{"class":"price-string"}});
switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Album:case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.MusicVideo:case its.sf.StorePlatform.Kind.Podcast:case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.ToneAlbum:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name);
var u=its.sf.StorePlatformUtil.orderedOffers(e.offers);
if(u.length>0){var a=u[0].priceFormatted;
its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice[e.id]?a=null:u[0].price||(a=null),a&&(s.markup=its.sf14.ComponentUtil.createText(this,a,o))}break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,i.value=its.loc("SF.NumApps",{count:e.appCount});
var u=its.sf.StorePlatformUtil.orderedOffers(e.offers);
if(u.length>0){var a=u[0].priceFormatted;
u[0].price||(a=null),a&&(s.markup=its.sf14.ComponentUtil.createText(this,a,o))}break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:r.value=e.name,i.value=e.genres[0].name;
break;case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name;
break;default:r.value=e.name}return its.isDefinedNonNull(r.value)&&n.push(r),its.isDefinedNonNull(i.value)&&n.push(i),its.isDefinedNonNull(s.markup)&&n.push(s),n},generateAltTag:function(e){var t="",n=e.designLabel||"";
return e.link&&e.link.type=="link"?t=e.link.label+", "+n:e.content&&(t=this.getLabelFromLockupData(e.content,n)),t},getLabelFromLockupData:function(e,t){var n=this.getDetailsForAX(e),r=n.reverse().map(function(e){return e.value}).join(", ");
return t&&(r+=": "+t),r},getDetailsForAX:function(e){var t=e.kind,n=[],r={},i={},s={attributes:{"class":"price-string"}};
switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Album:case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.MusicVideo:case its.sf.StorePlatform.Kind.Podcast:case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.ToneAlbum:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:i.value=e.name,e.genres&&e.genres.length>0&&(r.value=e.genres[0].name);
break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,i.value=its.loc("SF.NumApps",{count:e.appCount});
break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:r.value=e.name,i.value=e.genres[0].name;
break;case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name;
break;default:r.value=e.name}return its.isDefinedNonNull(r.value)&&n.push(r),its.isDefinedNonNull(i.value)&&n.push(i),n},suppressBuyButton:function(e){var t=e.kind,n=!1;
switch(t){case its.sf.StorePlatform.Kind.Movie:case its.sf.StorePlatform.Kind.MovieBundle:case its.sf.StorePlatform.Kind.ShortFilm:case its.sf.StorePlatform.Kind.TvSeason:case its.sf.StorePlatform.Kind.Podcast:case its.sf.StorePlatform.Kind.Course:case its.sf.StorePlatform.Kind.Artist:n=!0}return n},suppressArtwork:function(e){var t=e.kind,n=!1;
switch(t){case its.sf.StorePlatform.Kind.MultipleSystemOperator:n=!0}return n}},its.dv14.SmallLockup.DefaultDetailsGenerator.PriceText={details:function(e){var t=e.kind,n=[],r={},i={},s={},o=null,u=its.sf.StorePlatformUtil.orderedOffers(e.offers);
if(u.length>0){var a=u[0],f=a.priceFormatted;
its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice[e.id]?f=null:a.price?its.sf.StorePlatformUtil.isPreorderOffer(a)&&(f=its.loc("DV6Lockup.priceText.preorder",{price:a.priceFormatted})):f=null,f&&(o=its.sf14.ComponentUtil.createText(this,f))}switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Album:case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.MusicVideo:case its.sf.StorePlatform.Kind.Podcast:case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.ToneAlbum:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name);
break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,i.value=its.loc("SF.NumApps",{count:e.appCount});
break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:r.value=e.name,i.value=e.genres[0].name;
break;case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name;
break;default:r.value=e.name}return s.markup=o,its.isDefinedNonNull(r.value)&&n.push(r),its.isDefinedNonNull(i.value)&&n.push(i),its.isDefinedNonNull(s.markup)&&n.push(s),n},suppressBuyButton:function(e){return!0},suppressArtwork:function(e){return its.dv14.SmallLockup.DefaultDetailsGenerator.suppressArtwork(e)}},its.dv14.SmallLockup.DefaultDetailsGenerator.List={details:function(e){var t=e.kind,n=[],r={},i={},s={},o={};
switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Album:r.value=e.name,i.value=e.artistName,its.sf.StorePlatformUtil.findPreorderOffers(e.offers).length?s.markup=its.sf14.ComponentUtil.createText(this,its.loc("Pre-Order"),{attributes:{"class":"preorder"}}):s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!1,!0);
break;case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.Podcast:r.value=e.name,i.value=e.artistName,s.markup=its.dv14.SmallLockup.DefaultDetailsGenerator.List._releaseDateText(e),o.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!1,!0);
break;case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.ToneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.MusicVideo:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName),s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!1,!0);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name);
var u=itms.getBag().enableUnifiedAppRating,a={value:u?e.userRating.value:e.userRating.valueCurrentVersion,ratingCount:u?e.userRating.ratingCount:e.userRating.ratingCountCurrentVersion};
s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(a,!1,!0);
break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,i.value=its.loc("SF.NumApps",{count:e.appCount});
var u=itms.getBag().enableUnifiedAppRating,a={value:u?e.userRating.value:e.userRating.valueCurrentVersion,ratingCount:u?e.userRating.ratingCount:e.userRating.ratingCountCurrentVersion};
s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(a,!1,!0);
break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name,s.markup=its.sf14.ComponentUtil.createText(this,its.locDate(its.sf.StorePlatformUtil.findEarliestReleaseDate(e))),o.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!1,!0);
break;default:r.value=e.name}return its.isDefinedNonNull(r.value)&&(r.classNames=["title-line"],n.push(r)),its.isDefinedNonNull(i.value)&&n.push(i),its.isDefinedNonNull(s.markup)&&n.push(s),its.isDefinedNonNull(o.markup)&&n.push(o),n},suppressBuyButton:function(e){var t=e.kind,n=!1;
switch(t){case its.sf.StorePlatform.Kind.Movie:case its.sf.StorePlatform.Kind.MovieBundle:case its.sf.StorePlatform.Kind.ShortFilm:case its.sf.StorePlatform.Kind.TvSeason:case its.sf.StorePlatform.Kind.Podcast:case its.sf.StorePlatform.Kind.Course:case its.sf.StorePlatform.Kind.MultipleSystemOperator:case its.sf.StorePlatform.Kind.Artist:n=!0}return n},_releaseDateText:function(e){var t={},n;
return its.sf.StorePlatformUtil.hasAnyPreorderOffers(e.offers)?(t.attributes={"class":"preorder"},n=its.loc("Preorder")):n=its.locDate(e.releaseDate),its.sf14.ComponentUtil.createText(this,n,t)},suppressArtwork:function(e){return its.dv14.SmallLockup.DefaultDetailsGenerator.suppressArtwork(e)}},its.dv14.SmallLockup.DefaultDetailsGenerator.List.GlobalList={details:function(e){var t=e.kind,n=[],r={},i={},s={},o={};
switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Album:case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.Podcast:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.ToneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.MusicVideo:case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name);
var u=itms.getBag().enableUnifiedAppRating,a={value:u?e.userRating.value:e.userRating.valueCurrentVersion,ratingCount:u?e.userRating.ratingCount:e.userRating.ratingCountCurrentVersion};
s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(a,!1,!0);
break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,i.value=its.loc("SF.NumApps",{count:e.appCount});
var u=itms.getBag().enableUnifiedAppRating,a={value:u?e.userRating.value:e.userRating.valueCurrentVersion,ratingCount:u?e.userRating.ratingCount:e.userRating.ratingCountCurrentVersion};
s.markup=its.dv14.UserRatingsUtil.createSmallStarRatings(a,!1,!0);
break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name;
break;default:r.value=e.name}return its.isDefinedNonNull(r.value)&&(r.classNames=["title-line"],n.push(r)),its.isDefinedNonNull(i.value)&&n.push(i),its.isDefinedNonNull(s.markup)&&n.push(s),its.isDefinedNonNull(o.markup)&&n.push(o),n},suppressBuyButton:function(e){return!1},suppressArtwork:function(e){return its.dv14.SmallLockup.DefaultDetailsGenerator.suppressArtwork(e)}},its.dv14.SmallLockup.DefaultDetailsGenerator.List.Related={details:function(e){var t=e.kind,n=[],r={},i={},s={},o={},u={attributes:{"class":"price-string"}};
switch(t){case its.sf.StorePlatform.Kind.PodcastEpisode:r.value=e.name,i.value=e.collectionName+" â "+e.artistName;
break;case its.sf.StorePlatform.Kind.Album:case its.sf.StorePlatform.Kind.Audiobook:case its.sf.StorePlatform.Kind.EBook:case its.sf.StorePlatform.Kind.EBookApple:case its.sf.StorePlatform.Kind.EBookMeta:case its.sf.StorePlatform.Kind.EBookTextbook:case its.sf.StorePlatform.Kind.Podcast:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Ringtone:case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.ToneAlbum:case its.sf.StorePlatform.Kind.Tone:case its.sf.StorePlatform.Kind.MusicVideo:case its.sf.StorePlatform.Kind.Song:r.value=e.name,e.collectionName?i.value=its.loc("DT6.Lockup.ArtistAndAlbum",{artist:e.artistName,album:e.collectionName}):i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.TvSeason:r.value=e.artistName,i.value=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(e.name,e.artistName);
break;case its.sf.StorePlatform.Kind.Course:r.value=e.name,i.value=e.artistName;
break;case its.sf.StorePlatform.Kind.Artist:case its.sf.StorePlatform.Kind.MacApp:case its.sf.StorePlatform.Kind.MobileApp:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name);
var a=its.sf.StorePlatformUtil.orderedOffers(e.offers);
if(a.length>0){var f="";
its.dv14.GratisAppUtil.gratisAppAdamIdsFreeForThisDevice[e.id]?f=its.loc("DV14.ActionText.FREE"):(f=a[0].priceFormatted,a[0].price||(f=a[0].actionText.short)),s.markup=its.sf14.ComponentUtil.createText(this,f,u)}break;case its.sf.StorePlatform.Kind.MobileAppBundle:r.value=e.name,e.genres&&e.genres.length>0&&(i.value=e.genres[0].name),a=its.sf.StorePlatformUtil.orderedOffers(e.offers),a.length>0&&(f=a[0].priceFormatted,a[0].price||(f=a[0].actionText.short),s.markup=its.sf14.ComponentUtil.createText(this,f,u));
break;case its.sf.StorePlatform.Kind.TvEpisode:r.value=e.name,i.value=e.collectionName;
break;case its.sf.StorePlatform.Kind.MovieBundle:case its.sf.StorePlatform.Kind.Movie:r.value=e.name,i.value=e.genres[0].name;
break;default:r.value=e.name}return its.isDefinedNonNull(r.value)&&(r.classNames=["title-line"],n.push(r)),its.isDefinedNonNull(i.value)&&n.push(i),its.isDefinedNonNull(s.markup)&&n.push(s),n},suppressBuyButton:function(e){return!0},suppressArtwork:function(e){return its.dv14.SmallLockup.DefaultDetailsGenerator.suppressArtwork(e)}},its.dv14.TrailerLockup=Class.createSubclass("its.dv14.TrailerLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content"),this._lockupType=this.lookup("lockupType")?this.lookup("lockupType"):null,this._artworkDimensionType=this._lockupType==its.dv14.SmallLockup.Type.LIST?"room":"swoosh"},templateName:function(){return"lockups/dv14_trailer_lockup"},render:function(){this.template.replaceToken("adamId",this._content.id),this.template.replaceToken("kind",this._content.kind),this.template.replaceToken("url",this._content.url),this._artworkDimensionType=="swoosh"&&(its.sf.Platform.iPad()?this.addClass("trailer-swoosh-ipad"):this.addClass("trailer-swoosh-iphone"));
var e={content:this._content,detailsGenerator:its.dv14.LockupUtil.AppTrailerLockupDetailsGenerator,type:this._lockupType,artworkProfile:"trailer_lockup"},t=this.renderComponentWithData("small_lockup",e),n=this._trailerElement();
return t&&n&&(this.template.replaceTokenWithElement("lockup",t),this.template.replaceTokenWithElement("trailer",n),this.element=this.template.composeAsElement(this.itsId())),this.element},_trailerElement:function(){var e=its.dv14.ProductPageUtil.getBestTypeOfTrailer(this._content);
if(!(e&&e.previewFrame&&e.video))return null;
var t={artworkUrls:e.previewFrame,size:its.dv14.LockupUtil.getArtworkDimensions("trailer",this._artworkDimensionType,this.documentSize()),alt:this._content.name,classes:[its.dv14.LockupUtil.getArtworkClassName("screenshot")]};
e.previewFrame.width<e.previewFrame.height&&(its.sf.Platform.iPad()||this._artworkDimensionType=="swoosh")&&(t.classes=["screenshot-landscape"]);
var n={artworkData:t,src:e.video,contentId:this._content.id};
return this.renderComponentWithData("video",n)},onElementCreated:function(){its.sf.Metrics.setTargetInfo(this.element,this._content.id,"mediaElement",its.sf.Metrics.ActionType.PLAY,this._content.url,"video")}}),its.dv14.Card=Class.createSubclass("its.dv14.Card",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content")},templateName:function(){return"lockups/dv14_card"},componentType:function(){return"card"},renderAsString:function(){var e=this._content.iad&&!its.serverData.adsRendered[this._content.id],t="",n={content:this._content,type:its.dv14.SmallLockup.Type.LIST,titleMaxLines:2,containsAd:!1};
e&&(n.containsAd=this._content.iad,this._content.iad.format.icon==="small"&&its.dv14.Util.UI.Orientation!=="landscape"&&!its.sf.Platform.iPad()&&(n.titleMaxLines=1));
var r=this.renderComponentStringWithData("small_lockup",n);
this.template.replaceTokenUnescaped("lockup",r);
var i=e&&this._content.iad.templateType=="duplicate";
!i&&its.dv14.AdditionalAppTypes.appHasAdditionalTypes(this._content)&&(t=this.renderComponentStringWithData("additional_app_types",{content:this._content,stackListClasses:["align-left"]}),this.template.replaceTokenUnescaped("additionalDetails",t)),this.template.replaceTokenUnescaped("body",this._bodyMarkup()),its.dv14.NotifyMeButton.isNotifyMeContent(this._content.id)&&this.template.replaceTokenUnescaped("notifyMeDescription",this._notifyMeDescription()),this.setAttribute("data-content-id",this._content.collectionId||this._content.id),this.setAttribute("data-content-kind",this._content.kind),this.setAttribute("data-url",this._content.url);
if(e){this.addClass("ad"),this.setAttribute("lineItem",this._content.iad.lineItem),this.setAttribute("isAdCard","true"),this.setAttribute("impressionId",this._content.iad.impressionId);
var s=this.impressionsData("custom.iAd"),o=Object.assign({},this.impressionsData()||{});
o=Object.assign(o,s),its.serverData.iAd=s;
var u=this._content.iad;
u.adamId=this._content.id,its.dv14.SearchPage.setCurrentIAd(u),this.setAttribute("data-metrics-impressions-low-latency",JSON.stringify(o)),this._content.iad.format.text!=="none"&&this.template.replaceTokenUnescaped("iAdText",this.renderiAdDescription()),its.serverData.adsRendered[this._content.id]={exists:!0,rendered:!1}}return this._markup=this.template.compose(this.itsId()),this._markup},onElementCreated:function(e){its.sf.Metrics.setTargetInfo(e,this._content.id,"card",its.sf.Metrics.ActionType.NAVIGATE,this._content.url);
if(this._content.iad&&!its.serverData.adsRendered[this._content.id].rendered){this.renderiAdButton();
var t=e.getElementsByTagName("offer").item(0).getElementsByTagName("button").item(0),n=e.getElementsByTagName("button").item(0);
its.sf.Metrics.setTargetInfo(n,this._content.id,"button",its.sf.Metrics.ActionType.AD_TRANSPARENCY,this._content.url),its.serverData.adsRendered[this._content.id].rendered=!0;
var r={iAdId:its.serverData.iAdId,iAdAlgoId:this._content.iad.algoId,iAdMetadata:this._content.iad.metadata,iAdImpressionId:this._content.iad.impressionId,iAdFormat:this._content.iad.format};
this.attachiAdMetricsDetails(e,r),this.attachiAdMetricsDetails(n,r),this.attachiAdMetricsDetails(t,r)}},renderiAdButton:function(){var e="",t=its.Templates.get("utils/sf14_component/ad_button"),n={"class":"align-right",privacy:this._content.iad.privacy,"big-hit":"true"};
t.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(n)),e=t.compose();
var r=this.element.getElementsByTagName("title").item(0),i=r.outerHTML;
r.outerHTML=i+e,this.subscribeToTarget(its.sf14.Events.SELECT,this.iAdSelectHandler,e.itsId())},renderiAdDescription:function(){var e=2,t=this._content.description.standard;
!this._content.iad.format.images&&its.sf.Platform.iPad()&&(e=10),!this._content.iad.format.images&&its.sf.Platform.iPhone()&&its.dv14.Util.UI.Orientation==="landscape"&&(e=20);
var n='<text style="text-align: left; itml-text-max-lines: '+e+';">';
return n+=its.sf14.ComponentUtil.createText(this,t,{unescaped:!1},!0).outerHTML,n+="</text>",n},attachiAdMetricsDetails:function(e,t){if(e){e.metrics||(e.metrics={});
for(var n in t)e.metrics[n]=t[n]}},iAdSelectHandler:function(){},_bodyMarkup:function(){if(this._content.kind==its.sf.StorePlatform.Kind.MobileAppBundle)return this._bundleMarkup();
if(this._content.iad&&!this._content.iad.format.images&&!its.serverData.adsRendered[this._content.id])return;var e=its.Templates.get("lockups/dv14_card/app_media");
return e.replaceTokenUnescaped("media",this._screenshotsForCard()),e.compose()},_notifyMeDescription:function(){return its.sf14.ComponentUtil.createText(this,its.loc("SF.NotifyMe.Description",{itemName:this._content.name}),{attributes:{"class":"text-left",maxLines:0}})},_screenshotsForCard:function(){var e=[];
this.showOneLandscape=!1,this.trailer=its.dv14.ProductPageUtil.getBestTypeOfTrailer(this._content),this.screenshots=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this._content.screenshotsByType).screenshots,its.dv14.Util.Client.isBridge()&&this._content.screenshotsByType.appleWatch&&(this.screenshots=this._content.screenshotsByType.appleWatch,this.trailer=null),this._content.hasMessagesExtension&&(this._content.isHiddenFromSpringboard||its.dv14.Util.Client.isVoyager())&&(this.screenshots=its.dv14.ProductPageUtil.getBestTypeOfScreenshot(this._content.messagesScreenshots).screenshots,this.trailer=null);
var t=this.trailer&&(its.isArray(this.trailer.previewFrame)&&this.trailer.previewFrame.length||its.isObject(this.trailer.previewFrame)&&its.isDefinedNonNullNonEmpty(this.trailer.previewFrame));
if(this.trailer&&t&&this.trailer.video){this.trailer.previewDimensions=its.isArray(this.trailer.previewFrame)?this.trailer.previewFrame[0]:this.trailer.previewFrame;
var n=its.sf14.ArtworkUtil.bestArtworkForSize(this.trailer.previewFrame,{width:700,height:400}),r=this.trailer.previewDimensions.width>this.trailer.previewDimensions.height;
r&&(this.showOneLandscape=!0);
var i=this._artworkDataForImage(n,this.showOneLandscape,!0);
e.push(this.renderComponentStringWithData("video",{artworkData:i,src:this.trailer.video}));
if(r)return e}if(this.trailer&&this.screenshots&&this.screenshots.length){var s=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[0],{width:600,height:600}),o=this._artworkDataForImage(s,this.showOneLandscape,!0),u=this.screenshots[0][0]||this.screenshots[0];
u.height>u.width&&e.push(this.renderComponentStringWithData("artwork",o));
if(this.screenshots.length>2&&this._content.iad&&its.sf.Platform.iPhone()&&!its.serverData.adsRendered[this._content.id]&&its.dv14.Util.UI.Orientation!=="landscape"){var a=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[1],{width:600,height:600}),f=this._artworkDataForImage(a,this.showOneLandscape,!0),l=this.screenshots[1][0]||this.screenshots[1];
l.height>l.width&&e.push(this.renderComponentStringWithData("artwork",f))}return e}if(!this.trailer&&this.screenshots&&this.screenshots.length){var s=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[0],{width:600,height:600}),u=this.screenshots[0][0]||this.screenshots[0];
if(u.width>=u.height){this.showOneLandscape=!0;
var o=this._artworkDataForImage(s,this.showOneLandscape,!0);
return e.push(this.renderComponentStringWithData("artwork",o)),e}if(this.screenshots.length>1){var s=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[0],{width:600,height:600}),o=this._artworkDataForImage(s,this.showOneLandscape,!0);
e.push(this.renderComponentStringWithData("artwork",o));
var a=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[1],{width:300,height:600}),f=this._artworkDataForImage(a,this.showOneLandscape,!0),l=this.screenshots[1][0]||this.screenshots[1];
l.width<l.height&&e.push(this.renderComponentStringWithData("artwork",f));
if(this.screenshots.length>2&&this._content.iad&&its.sf.Platform.iPhone()&&!its.serverData.adsRendered[this._content.id]&&its.dv14.Util.UI.Orientation!=="landscape"){var c=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[2],{width:600,height:600}),h=this._artworkDataForImage(c,this.showOneLandscape,!0),p=this.screenshots[2][0]||this.screenshots[2];
p.height>p.width&&e.push(this.renderComponentStringWithData("artwork",h))}return e}if(this.screenshots.length===1){var s=its.sf14.ArtworkUtil.bestArtworkForSize(this.screenshots[0],{width:600,height:600}),o=this._artworkDataForImage(s,!0,!0);
return e.push(this.renderComponentStringWithData("artwork",o)),e}}return e},_artworkProfileForImage:function(e,t){var n;
return e.width>=e.height&&t?n="card_landscape":this.screenshots.length>2&&this._content.iad&&its.sf.Platform.iPhone()&&!its.serverData.adsRendered[this._content.id]&&its.dv14.Util.UI.Orientation!=="landscape"?n="card_iad_triple":t?n="card_portrait_single":n="card_portrait_double",its.dv14.Util.Client.isBridge()&&(n="card_watch"),n},_artworkDataForImage:function(e,t,n){var r=its.dv14.Util.Client.isBridge()?"watch-screenshot":"screenshot";
return{artworkUrls:e,size:its.dv14.LockupUtil.getArtworkDimensions("screenshot",this._artworkProfileForImage(e,t),this.documentSize()),alt:this._content.name,classes:[its.dv14.LockupUtil.getArtworkClassName(r)],disabled:n}},_bundleArtworkColumnCount:function(){var e=this._content.childrenIds?this._content.childrenIds.length:0,t=4;
switch(e){case 2:case 4:t=2;
break;case 3:case 5:case 6:case 9:t=3}return t},_bundleMarkup:function(){var e=its.Templates.get("lockups/dv14_card/bundle");
e.replaceToken("title",its.loc("SF.AppsInThisBundle"));
var t=[],n=this._content.childrenIds,r=this._content.children,i=!1;
if(n.length>6&&its.sf.Platform.iPhone()||n.length>8&&its.sf.Platform.iPad())i=!0;
for(var s=0;
s<n.length;
s++){var o=r[n[s]];
t.push(this._childLockupMarkup(o,i));
if(its.sf.Platform.iPad()&&s===7)break}e.replaceTokenUnescaped("childLockups",t.join("\n"));
var u="app-bundle-artwork-list-"+this._bundleArtworkColumnCount();
return e.replaceToken("listClass",u),e.compose()},_childLockupMarkup:function(e,t){var n=its.Templates.get("lockups/dv14_card/bundle_lockup"),r={artworkUrls:e.artwork,size:its.sf14.LockupUtil.getArtworkDimensions(e.kind,"app_card_page",this.documentSize()),effects:its.sf14.Artwork.effects(e.kind),alt:e.name,classes:[its.dv14.LockupUtil.getArtworkClassName(e.kind)],disabled:!0},i=this.renderComponentStringWithData("artwork",r);
return t?n.replaceTokenUnescaped("artwork",i):(n.replaceToken("title",e.name),n.replaceTokenUnescaped("artwork",i)),n.compose()}}),its.dv14.EditorialCard=Class.createSubclass("its.dv14.EditorialCard",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._content=this.lookup("content")},templateName:function(){return"lockups/dv14_editorial_card"},componentType:function(){return"editorial_card"},renderAsString:function(){var e=this._content.searchItemInfo,t=e.image,n={artworkUrls:t,size:its.dv14.LockupUtil.getArtworkDimensions("editorialSearchItem",null,this.documentSize()),alt:this._content.name},r=this.renderComponentStringWithData("artwork",n);
return this.subscribeToTarget(its.sf14.Events.SELECT,this._openContentUrl.bind(this),r.itsId()),this.template.replaceTokenUnescaped("artwork",r),this.template.replaceToken("title",e.title),this.template.replaceToken("description",e.description),this.template.replaceObject("button",e.buttonAction),this.setAttribute("data-url",e.buttonAction.url),this.setAttribute("data-page-target",e.buttonAction.target),this.template.compose(this.itsId())},onElementCreated:function(){its.sf.Metrics.setTargetInfo(this.element,this._content.id,"card",its.sf.Metrics.ActionType.NAVIGATE,this._content.url)},_openContentUrl:function(){var e=this._content.searchItemInfo.buttonAction,t={pageTarget:e.target,url:e.url};
its.notifications.publish(its.sf14.PageController.Events.LOAD_PAGE,t)}}),its.dv14.EditorialProductLockup=Class.createSubclass("its.dv14.EditorialProductLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=this.getTemplate()},getTemplate:function(){var e;
switch(this.data.orientation){case its.dv14.EditorialProductLockup.Orientation.V1:e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v1");
break;case its.dv14.EditorialProductLockup.Orientation.V2:e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v2");
break;case its.dv14.EditorialProductLockup.Orientation.V3:e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v3");
break;case its.dv14.EditorialProductLockup.Orientation.V4:e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v4");
break;case its.dv14.EditorialProductLockup.Orientation.V5:its.sf.Platform.iPhone()?e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v5_iphone"):its.sf.Platform.iPad()&&(e=its.Templates.get("lockups/dv14_editorial_product_lockup/orientation_v5_ipad"))}return e},renderAsString:function(){return this.isValidBlockData()?(this.data.editorial=this.data.editorial||{},this.data.fields=this.data.fields||[],this._renderEditorial(),this._renderArtwork(),this._renderDetails(),this._renderOffer(),this._renderMediaButton(),this._setAttributes(),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this)),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this._template.compose()):!1},_setAttributes:function(){var e=this.data.product.kind,t=this.data.product.id,n=this.data.product.url;
if(e==its.sf.StorePlatform.Kind.Song||e==its.sf.StorePlatform.Kind.TvEpisode)t=this.data.product.collectionId;
this.setAttribute("data-content-id",t),this.setAttribute("data-content-kind",e),this.setAttribute("data-url",n),this._template.replaceTokenUnescaped("attributes",its.sf14.Util.createAttributeString(this._attributes)),this._template.replaceToken("classes",this._classes.join(" "))},isValidBlockData:function(){var e=!0;
if(!this.data||!its.isDefined(this.data.product))e=!1;
return e},_renderArtwork:function(){if(this.data.fields.indexOf("artwork")<0)return;var e=this.data.product.artwork,t=this.data.product.kind,n=this.data.artworkProfile||"product_1",r;
this.data.artworkSize?r=this.data.artworkSize:r=its.dv14.BlockArtwork.getArtworkDimensions(n,this.data.product.kind);
var i={artworkUrls:e,size:r,effects:this.data.product.artworkEffects||its.sf14.Artwork.effects(this.data.product.kind),alt:this.data.product.name,disabled:!0,classes:[its.dv14.LockupUtil.getArtworkClassName(this.data.product.kind),"editorial-lockup-image"]},s=this.renderComponentStringWithData("artwork",i);
this._template.replaceTokenUnescaped("artwork",s)},_renderEditorial:function(){if(this.data.editorial){this.data.editorial.title=this.title();
var e=this.renderComponentStringWithData("editorial_block",this.data.editorial);
e&&this._template.replaceTokenUnescaped("editorial",e)}},_renderOffer:function(){if(this.data.fields.indexOf("buyButton")<0)return;var e=its.Templates.get("lockups/dv14_editorial_product_lockup/offer"),t=its.sf.StorePlatformUtil.orderedOffers(this.data.product.offers)[0],n=t.type==its.sf.StorePlatform.Offer.Type.PREORDER,r={content:this.data.product,offer:t};
n&&(r.buttonStyle=its.dv14.BuyButton.ButtonStyle.preorder),e.replaceTokenUnescaped("buyButton",this.renderComponentStringWithData("buy_button",r));
if(this._shouldShowInAppPurchasesNotice()){e.keepBlock("hasInAppPurchases");
var i=e.getBlock("hasInAppPurchases");
i.replaceToken("iapText",its.loc("InAppPurchases"));
var s=its.sf.Platform.iPhone()?"software-iap-label-iphone":"software-iap-label-ipad";
i.replaceToken("iapClass",s)}this._template.replaceTokenUnescaped("offer",e.compose())},_renderMediaButton:function(){if(this.data.media&&this.data.media.type&&this.data.media.url&&this.data.media.actionText){var e;
switch(this.data.media.type){case its.dv14.EditorialProductLockup.Media.AUDIO:e=its.sf14.ComponentUtil.createButton(this,this.data.media.actionText,its.sf14.ComponentUtil.ButtonType.BUY,{"class":"uber-title-color"},this._playAudio.bind(this),!1);
break;case its.dv14.EditorialProductLockup.Media.VIDEO:e=its.sf14.ComponentUtil.createButton(this,this.data.media.actionText,its.sf14.ComponentUtil.ButtonType.BUY,{"class":"uber-title-color"},this._playAudio.bind(this),!1)}this._template.replaceTokenUnescaped("mediaButton",e)}},_playAudio:function(){var e={previewUrl:this.data.media.url,content:this.data.product};
itms.setPreviewOverlay(its.sf14.BaseDocument.renderDocumentWithData("preview_overlay",e),{playsImmediately:!0})},_playVideo:function(){},_shouldShowInAppPurchasesNotice:function(){var e=[],t=this.storePlatform.getCachedOffersArray(this.data.product.id);
return t.length>0&&(e=its.sf.StorePlatformUtil.findRedownloadOffers(t)),this.data.product.hasInAppPurchases&&e.length==0},_removeInAppPurchasesNotice:function(){if(this.element){var e=this.element.querySelector("notice");
e&&e.remove()}},title:function(){var e=this.data.editorial.title;
return this.data.product&&this.data.useLockupTitle&&(e=this.data.product.name),e},_renderDetails:function(){var e=its.dv14.EditorialProductLockup.DetailsGenerator.details(this.data.fields,this.data.product,this.data.orientation),t="";
if(e){var n=its.Templates.get("lockups/dv14_editorial_product_lockup/item_container"),r=n.getBlock("itemLoop"),i,s=null,o,u;
for(var a=0;
a<e.length;
a++){i=e[a];
if(i.markup)s=i.markup;
else if(i.value){var f=i.type&&i.type=="TITLE"?this._badges():null;
s=its.sf14.ComponentUtil.createText(this,i.value,{type:its.sf14.ComponentUtil.TextType[i.type],attributes:{maxLines:i.maxLines||null,"class":i.class||""},badges:f})}r.replaceTokenUnescaped("item",s),r.next()}t=n.compose()}this._template.replaceTokenUnescaped("details",'<section class="editorial-lockup-details">'+t+"</section>")},_badges:function(e){var t=[],n=its.sf.ContentRatingsManager.legacyContentRating(this.data.product),r=its.sf.StorePlatformUtil.ContentRating.isClean(n),i=its.sf.StorePlatformUtil.ContentRating.isExplicit(n);
if(r||i)r&&its.dv14.BadgeUtil.shouldShowCleanExplicitBadgeForKind(this.data.product.kind)&&t.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CLEAN,!0)),i&&its.dv14.BadgeUtil.shouldShowCleanExplicitBadgeForKind(this.data.product.kind)&&t.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.EXPLICIT,!0));
return t},_updateRestrictions:function(){},_handlePersonalizationEvent:function(e){if(this.storePlatform==e.caller&&its.isDefined(e.data[this.data.product.id])){this.data.product.hasInAppPurchases&&!this._shouldShowInAppPurchasesNotice()&&this._removeInAppPurchasesNotice();
if(this._priceStringElement){var t=this.storePlatform.getCachedData(this.data.product.id),n=its.sf.StorePlatformUtil.findPersonalizedOffers(t.offers);
n.length>0&&(this._priceStringElement.innerXML=its.loc("DV14.BuyButton.Purchased"))}}}}),its.dv14.EditorialProductLockup.hasValidBlockData=function(){},its.dv14.EditorialProductLockup.DetailsGenerator={details:function(e,t,n){if(!its.isArray(e)||e.length<1)return;var r=t.kind,i=[],s={attributes:{"class":"price-string"}};
for(var o=0,u,a;
o<its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.order.length;
o++){u=its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.order[o];
if(e.indexOf(u)>-1)switch(u){case its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.NAME:a=t.name,r==its.sf.StorePlatform.Kind.PodcastEpisode?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:t.collectionName+" â "+t.artistName,type:"TITLE"})):r==its.sf.StorePlatform.Kind.TvSeason?(a=t.artistName,i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),a=its.sf14.LockupUtil.tvSeasonNameWithoutShowName(t.name,t.artistName),i.push({value:a,type:"TITLE"})):r==its.sf.StorePlatform.Kind.TvEpisode?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:t.collectionName,type:"TITLE"})):r==its.sf.StorePlatform.Kind.MobileAppBundle?(i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"}),i.push({value:its.loc("SF.NumApps",{count:t.appCount}),type:"TITLE"})):a&&i.push({value:a,type:"TITLE",maxLines:2,"class":"uber-title-color"});
break;case its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.ARTIST:a=t.artistName,a&&i.push({value:a});
break;case its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.GENRE:t.genres&&t.genres.length>0&&i.push({value:t.genres[0].name});
break;case its.dv14.EditorialProductLockup.DetailsGenerator.LineItems.PRICE:var f=its.sf.StorePlatformUtil.orderedOffers(t.offers);
if(f.length>0){var l=f[0],c=l.priceFormatted;
if(!l.price)c=l.actionText.short;
else if(l.type==its.sf.StorePlatform.Offer.Type.PREORDER)c=c;
else if(r==its.sf.StorePlatform.Kind.Movie||r==its.sf.StorePlatform.Kind.TvSeason)c=its.loc(its.sf.StorePlatformUtil.isOfferHDVariant(l)?"DV6Lockup.priceText.video.hd":"DV6Lockup.priceText.video.sd",{price:c});
i.push({value:c})}}}return i}},its.dv14.EditorialProductLockup.Orientation={V1:"v1",V2:"v2",V3:"v3",V4:"v4",V5:"v5"},its.dv14.EditorialProductLockup.DefaultOrientation=its.dv14.EditorialProductLockup.Orientation.V1,its.dv14.EditorialProductLockup.Media={AUDIO:"audio",VIDEO:"video"},its.dv14.EditorialProductLockup.DetailsGenerator.LineItems={NAME:"name",ARTIST:"artistName",GENRE:"genreName",PRICE:"price",order:["name","artistName","genreName","price"]},its.dv14.ProductLockup=Class.createSubclass("its.dv14.ProductLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("lockups/dv14_product_lockup"),this.product=this.lookup("content"),this.product||this._logger.error(["---------- initialize: Product lockups must have content associated with them. "]),this.allProductOffers=this.product.offers,this.subscribe(its.dv14.ProductPage.Events.UPDATE_PRODUCT_DATA,this.updateProductData.bind(this))},render:function(){if(its.sf.Platform.iPad()){var e=this.renderComponentStringWithData("share_button",{content:this.product,pageState:this.lookup("pageState")});
this._template.replaceTokenUnescaped("shareButton",e)}this._lockupElement=this._template.composeAsElement(),this._renderTitle(),this._renderSubtitle(),this._renderNotice(),this._renderArtwork(),this._renderDetails(),this._renderBadges(),this._renderPills(),this._renderOffers(),this._renderPostLockupContent(),this.renderAdditionalComponents();
var t=its.sf.StorePlatformUtil.findPersonalizedOffers(this.allProductOffers);
t.length>0&&this._personalize(this.allProductOffers);
if(!its.dv14.Util.Client.isWinBackSupported(this.product)&&its.dv14.Util.UI.shouldPinProductLockup({isPurchasedModal:this.data.isPurchasedModal})){var n=this._lockupElement.querySelector(".product-lockup");
n.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND)}return this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this)),this._lockupElement},updateProductData:function(e){if(this.product.id==e.id){e.product&&(this.product=e.product);
if(this.product.artwork&&this._artworkElement){var t=!its.sf.ParentalRatingUtil.doesPass(this.product),n=its.dv14.LockupUtil.getArtworkData(this.product,this,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,t);
this.updateArtwork(n)}this._renderDetails()}},_renderTitle:function(){this._titleElement=this.title(),this._titleElement&&(this._lockupElement.replaceTokenWithElement("title",this._titleElement),this._titleElement.classList.add("product-title"),this._titleElement.setAttribute("maxLines",2))},_renderSubtitle:function(){this._subTitleElement=this.subtitle();
if(this._subTitleElement){this._subTitleElement.classList.add("subtitle"),this._lockupElement.replaceTokenWithElement("subtitle",this._subTitleElement);
var e=this.subtitleUrl();
e&&(this._subTitleElement.setAttribute("data-url",e),its.sf.Metrics.setTargetInfo(this._subTitleElement,this.product.id,"button",its.sf.Metrics.ActionType.NAVIGATE,e))}},_renderNotice:function(){this._noticeElement=this.notice(),this._noticeElement&&this._lockupElement.replaceTokenWithElement("notice",this._noticeElement)},_renderArtwork:function(){if(this.product.artwork||this.product.screenshots)this._artworkElement=this.artwork(),this._artworkElement&&this._lockupElement.replaceTokenWithElement("artwork",this._artworkElement)},updateArtwork:function(e){this._artworkElement?its.sf14.Artwork.updateArtworkSrc(this._artworkElement,e):this._renderArtwork()},_renderDetails:function(){var e=this.details();
if(e){var t=its.Templates.get("lockups/dv14_product_lockup/item_container"),n=t.getBlock("itemLoop");
for(var r=0;
r<e.length;
r++)n.replaceTokenWithElement("item",e[r]),n.next();
this._lockupElement.replaceTokenWithElement("details",t.composeAsElement())}},_renderBadges:function(){var e=this.badges(),t=this.badgePosition(),n=this.badgeClasses()||[];
if(e){var r=its.Templates.get("lockups/dv14_product_lockup/list");
t&&n.push(t),n.length>0&&r.replaceToken("listClass",n.join(" "));
var i=r.getBlock("itemLoop");
for(var s=0;
s<e.length;
s++)i.replaceTokenWithElement("item",e[s]),i.next();
this._lockupElement.replaceTokenWithElement("badges",r.composeAsElement())}},_renderPills:function(){var e=this.pills();
e&&this._lockupElement.replaceTokenWithElement("pills",e)},_renderOffers:function(){if(!this._offerElements&&!this._offersContainer&&(this.offers()||this.data.isPurchasedModal)){this._offerElements=this.offers();
var e=its.Templates.get("lockups/dv14_product_lockup/offers"),t=e.getBlock("offerLoop");
for(var n=0;
n<this._offerElements.length;
n++)t.replaceTokenWithElement("offer",this._offerElements[n]),t.next(),this._shouldPutDividersBetweenOffers&&(t.replaceTokenWithElement("offer",its.sf14.ComponentUtil.createDivider(null,!0)),t.next());
this._offersContainer=e.composeAsElement(),this._offersContainer.classList.add("offers")}this._shouldRenderOffersAfterLockup()?this._lockupElement.replaceTokenWithElement("postLockupOffers",this._offersContainer):this._lockupElement.replaceTokenWithElement("offers",this._offersContainer)},_shouldRenderOffersAfterLockup:function(){return its.sf.Platform.iPhone()&&(this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle||this._currentOfferIsPreorder())},_currentOfferIsPreorder:function(){var e=this.product.kind;
if(e===its.sf.StorePlatform.Kind.MobileApp||e===its.sf.StorePlatform.Kind.MobileAppBundle||e===its.sf.StorePlatform.Kind.MacApp)return!1;
var t;
return this._pageState==its.sf14.ProductPage.State.HD?t=its.sf.StorePlatformUtil.findHDOffers(this.allProductOffers):t=its.sf.StorePlatformUtil.findSDOffers(this.allProductOffers),its.sf.StorePlatformUtil.findPreorderOffers(t).length>0},_renderPostLockupContent:function(){var e=this.postLockupContent();
e&&this._lockupElement.replaceTokenWithElement("postLockupContent",e)},_handlePersonalizationEvent:function(e){if(this.storePlatform==e.caller&&its.isDefined(e.data[this.product.id])){var t=this.storePlatform.getCachedOffersArray(this.product.id);
t.length>0&&this._personalize(t)}},_personalize:function(e){this.allProductOffers=e,this.personalize()},artwork:function(){var e=!its.sf.ParentalRatingUtil.doesPass(this.product),t=its.dv14.LockupUtil.getArtworkData(this.product,this,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,e);
return this.renderComponentWithData("artwork",t)},title:function(){this._logger.warn(["---------- title: Not implemented by ProductLockup, Extending class must implement title()"])},subtitle:function(){this._logger.warn(["---------- subTitle: Not implemented by ProductLockup, Extending class must implement subTitle()"])},notice:function(){this._logger.warn(["---------- notice: Not implemented by ProductLockup, Extending class must implement notice()"])},subtitleUrl:function(){this._logger.warn(["---------- subtitleUrl: Not implemented by ProductLockup, Extending class must implement subtitleUrl()"])},offers:function(){return this._logger.warn(["---------- offers: Not implemented by ProductLockup, Extending class must implement offers()"]),[]},details:function(){this._logger.warn(["---------- details: Not implemented by ProductLockup, Extending class must implement details()"])},pills:function(){this._logger.debug(["---------- pills: Not implemented by ProductLockup, Extending class must implement pills()"])},badges:function(){this._logger.debug(["---------- badges: Not implemented by ProductLockup, Extending class must implement badges()"])},badgePosition:function(){this._logger.debug(["---------- badgePosition: Not implemented by ProductLockup, Extending class must implement badgePosition()"])},badgeClasses:function(){return[]},postLockupContent:function(){this._logger.debug(["---------- postLockupContent: Not implemented by ProductLockup, Extending class must implement postLockupContent()"])},renderAdditionalComponents:function(){this._logger.warn(["---------- renderAdditionalComponents: Not implemented by ProductLockup, Extending class must implement renderAdditionalComponents()"])},personalize:function(){this._logger.debug(["---------- personalize: Not implemented by ProductLockup, Extending class must implement personalize()"])}}),its.dv14.ProductLockup.Pills={HD:"its.dv14.ProductLockup.Pills.HD",SD:"its.dv14.ProductLockup.Pills.SD"},its.dv14.ProductLockup.BadgePosition={BOTTOM_RIGHT:"bottom-right"},its.dv14.ProductPage.Events={UPDATE_PRODUCT_DATA:"its.dv14.ProductPage.Events.UPDATE_PRODUCT_DATA",CLOSED_CAPTION_AVAILABLE:"its.dv14.ProductPage.Events.CLOSED_CAPTION_AVAILABLE"},its.dv14.AlbumProductLockup=Class.createSubclass("its.dv14.AlbumProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._preorderOffer=its.sf.StorePlatformUtil.findPreorderOffers(this.product.offers).length>0?its.sf.StorePlatformUtil.findPreorderOffers(this.product.offers)[0]:null},offers:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t={buttons:[this.renderComponentWithData("buy_button",{offer:e,content:this.product,buttonStyle:this._preorderOffer?its.dv14.BuyButton.ButtonStyle.filledPreorder:its.dv14.BuyButton.ButtonStyle.filled})],layout:its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT};
this._offer=this.componentWithData("offer",t);
if(this._preorderOffer){this._offer.updateTitle(its.sf14.ComponentUtil.createText(this,its.loc("Pre-Order"),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),"preorder");
var n=its.loc("PreorderExpectedDate",{date:its.locDate(this._preorderOffer.expectedReleaseDate)});
this._offer.updateSubtitle(its.sf14.ComponentUtil.createText(this,n,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{"class":"cmc-subtitle"}},!0))}return this._offerElement=this._offer.render(),this._offerElement?[this._offerElement]:null},updateProductData:function(e){this.product.id==e.id&&(this.base(),this.data.hasPrimaryArtist=e.hasPrimaryArtist,this._renderSubtitle(),this.data.radioPromo=e.radioSwoosh,this.renderAdditionalComponents())},details:function(){var e=[];
e.push(its.sf14.ComponentUtil.createText(this,this.product.genres[0].name,null,!0));
if(this.product.childrenIds){var t=!0,n=!0;
for(var r in this.product.children){var i=this.product.children[r];
i.kind&&(i.kind!=its.sf.StorePlatform.Kind.Song?n=!1:i.kind!=its.sf.StorePlatform.Kind.Ringtone&&(t=!1))}var s=null;
n?s="IXDisplayableKind.count.song":t?s="IXDisplayableKind.count.ringtone":s="SF.NumItems";
var o=its.locWithCount(s,this.product.childrenIds.length);
e.push(its.sf14.ComponentUtil.createText(this,o,null,!0))}else if(this.product.trackCount){var o=its.locWithCount("IXDisplayableKind.count.song",this.product.trackCount);
e.push(its.sf14.ComponentUtil.createText(this,o,null,!0))}return this.product.releaseDate&&!this._preorderOffer&&e.push(its.sf14.ComponentUtil.createText(this,its.loc("DV14.Released",{date:its.locDate(this.product.releaseDate)}),{},!0)),e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this.product.url,!0)),this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e},title:function(){var e=its.dv14.BadgeUtil.createCleanOrExplicitBadge(this._contentRating(),!0);
return its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e?[e]:[]},!0)},badges:function(){if(its.sf.Platform.iPhone())return;var e=[],t=its.sf.StorePlatformUtil.ContentRating.isExplicit(this._contentRating());
return t&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.PARENTAL_ADVISORY,!0)),this.product.isMasteredForItunes&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.APPLE_DIGITAL_MASTER_STACKED,!0)),e},badgePosition:function(){return its.dv14.ProductLockup.BadgePosition.BOTTOM_RIGHT},subtitle:function(){if(this.product.artistUrl){var e=this.lookup("hasPrimaryArtist"),t;
return e?t=its.sf14.ComponentUtil.createButton(this,this.product.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this.product.artistUrl},null,!0):t=its.sf14.ComponentUtil.createText(this,this.product.artistName,{type:its.sf14.ComponentUtil.TextType.SUBTITLE},!0),t}return its.sf14.ComponentUtil.createText(this,this.product.artistName,{"class":"secondary-color"},!0)},renderAdditionalComponents:function(){var e=this.lookup("radioPromo");
if(e){var t=this.renderComponentWithData("radio_promo",{radioPromoData:e[0]});
this._lockupElement.replaceTokenWithElement("radioPromo",t)}},isToneAlbum:function(){switch(this.product.kind){case its.sf.StorePlatform.Kind.RingtoneAlbum:case its.sf.StorePlatform.Kind.ToneAlbum:return!0}return this.product.childrenIds&&this.product.childrenIds.length>0&&this.product.children[this.product.childrenIds[0]]&&this.product.children[this.product.childrenIds[0]].kind==its.sf.StorePlatform.Kind.Tone?!0:!1},personalize:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t=e.type==its.sf.StorePlatform.Offer.Type.COMPLETE;
t?this._renderCMCInfo():this._cmcInfoElement&&(this._cmcInfoElement=null,this._removeCMCInfo())},_contentRating:function(){return its.sf.ContentRatingsManager.legacyContentRating(this.product)},_renderCMCInfo:function(){var e=this._preorderOffer?"CompleteMyPreOrder":"DV14.CompleteMyAlbum",t=this._preorderOffer?"preorder":"cmc";
this._offer.updateTitle(its.sf14.ComponentUtil.createText(this,its.loc(e),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),t);
var n=its.sf.StorePlatformUtil.findBuyOffers(this.allProductOffers)[0],r=its.loc("DV14.RegularPrice",{price:n.priceFormatted});
this._preorderOffer&&(r+=", "+its.loc("PreorderExpectedDate",{date:its.locDate(this._preorderOffer.expectedReleaseDate)})),this._offer.updateSubtitle(its.sf14.ComponentUtil.createText(this,r,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,unescaped:!0,attributes:{"class":"cmc-subtitle"}},!0)),its.sf.Platform.iPhone()&&this._lockupElement.replaceTokenWithElement("cmcInfo",this._offerElement)},_removeCMCInfo:function(){this._offer.removeTitle(),this._offer.removeSubtitle(),its.sf.Platform.iPhone()&&(this._renderOffers(),this._lockupElement.replaceTokenWithElement("cmcInfo",document.createElement("placeholer")))}}),its.dv14.AudiobookProductLockup=Class.createSubclass("its.dv14.AudiobookProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._audiobook=this.product,this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},offers:function(){var e;
its.sf.Client.isVersion("9.3")?e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0]:e=its.sf.StorePlatformUtil.findBuyOffers(this.allProductOffers)[0];
var t={buttons:[this.renderComponentWithData("buy_button",{offer:e,content:this._audiobook})]},n=[this.renderComponentWithData("offer",t)],r=its.sf.StorePlatformUtil.bestPreview(this._audiobook.offers);
if(r&&r.url&&its.sf.ParentalRatingUtil.doesPass(this.product)){var i=its.sf14.ComponentUtil.createButton(this,its.loc("DV14.ActionText.PREVIEW"),its.sf14.ComponentUtil.ButtonType.BUY,{"class":its.dv14.BuyButton.ButtonStyle.default},this._playPreview.bind(this),!0),t={buttons:[i]};
n.push(this.renderComponentWithData("offer",t))}return n},_playPreview:function(){var e=its.sf.StorePlatformUtil.bestPreview(this._audiobook.offers);
if(e&&e.url){var t={previewUrl:e.url,content:this._audiobook};
itms.setPreviewOverlay(its.sf14.BaseDocument.renderDocumentWithData("preview_overlay",t),{playsImmediately:!0})}},artwork:function(){var e={artworkUrls:its.sf.ParentalRatingUtil.doesPass(this._audiobook)?this.product.artwork:its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_AUDIOBOOK,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()),alt:this._audiobook.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this._audiobook.kind)]};
return this.renderComponentWithData("artwork",e)},updateArtwork:function(e){its.sf.ParentalRatingUtil.doesPass(this._audiobook)&&this.base(e)},details:function(){var e=this._audiobook,t=[];
t.push(its.sf14.ComponentUtil.createFacebookSmall(this,e.url,!0));
var n=its.loc("NarratorWithName",{name:this._audiobook.narrator});
t.push(its.sf14.ComponentUtil.createText(this,n,{unescaped:!0},!0));
var r=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0];
if(r&&r.assets&&r.assets[0]&&r.assets[0].duration){var i=its.sf14.Util.Duration.generateDurationString(r.assets[0].duration);
t.push(its.sf14.ComponentUtil.createText(this,i,{unescaped:!0},!0))}return e.userRating&&t.push(its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!0)),t},title:function(){var e=its.sf.ContentRatingsManager.legacyContentRating(this.product),t=its.dv14.BadgeUtil.createCleanOrExplicitBadge(e,!0);
return its.sf14.ComponentUtil.createText(this,this._audiobook.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:t?[t]:[]},!0)},subtitle:function(){return its.sf14.ComponentUtil.createButton(this,this._audiobook.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this._audiobook.artistUrl},null,!0)},_updateRestrictions:function(){this._lockupElement.replaceTokenWithElement("artwork",this.artwork())}}),its.dv14.CourseProductLockup=Class.createSubclass("its.dv14.CourseProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},offers:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t={buttons:[this.renderComponentWithData("buy_button",{offer:e,content:this.product,buttonStyle:its.dv14.BuyButton.ButtonStyle.filled})]},n=[this.renderComponentWithData("offer",t)];
return n},artwork:function(){var e={artworkUrls:this.product.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()),alt:this.product.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this.product.kind)],effects:["course3"]};
return this.renderComponentWithData("artwork",e)},details:function(){var e=[];
return this.data.primaryGenre&&e.push(its.sf14.ComponentUtil.createText(this,this.data.primaryGenre.name,null,!0)),this.data.language&&e.push(its.sf14.ComponentUtil.createText(this,this.data.language,null,!0)),this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e},title:function(){return its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE},!0)},subtitle:function(){return its.sf14.ComponentUtil.createButton(this,this.product.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this.product.artistUrl},null,!0)},_updateRestrictions:function(){this._lockupElement.replaceTokenWithElement("artwork",this.artwork())}}),its.dv14.EBookProductLockup=Class.createSubclass("its.dv14.EBookProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._book=this.product,this._preorderOffer=its.sf.StorePlatformUtil.findPreorderOffers(this.product.offers).length>0?its.sf.StorePlatformUtil.findPreorderOffers(this.product.offers)[0]:null,this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},renderAdditionalComponents:function(){var e=its.sf.ProductPageUtil.bookSeriesInfoString(this.product);
e&&this._lockupElement.replaceTokenWithElement("line2",its.sf14.ComponentUtil.createText(this,e,null,!0)),this._lockupElement.replaceTokenWithElement("line3",this.author())},offers:function(){var e=[],t,n=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers),r=its.sf.StorePlatformUtil.findPreorderOffers(this.allProductOffers),i=null;
if(this._book.bookSampleDownloadUrl){var s=its.sf.ParentalRatingUtil.doesPass(this._book)?its.dv14.BuyButton.ButtonStyle.default:its.dv14.BuyButton.ButtonStyle.disabled;
i={content:this._book,downloadDict:its.dv14.SampleButton.createDownloadDictForEbookSample(this._book),buttonStyle:s,artworkItsId:this._artworkElement.itsId()};
var o={buttons:[this.renderComponentWithData("sample_button",i)]};
r.length>0&&(o.title=its.sf14.ComponentUtil.createText(this,"",{type:its.sf14.ComponentUtil.TextType.TITLE},!0),o.subtitle=its.sf14.ComponentUtil.createText(this,"",{type:its.sf14.ComponentUtil.TextType.SUBTITLE},!0),o.layout=its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT)}if(r.length>0){t={buttons:[this.renderComponentWithData("buy_button",{offer:r[0],content:this._book,buttonStyle:its.dv14.BuyButton.ButtonStyle.preorder})],layout:its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT,title:its.sf14.ComponentUtil.createText(this,its.loc("Pre-Order"),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),styleType:"preorder"};
if(r[0].expectedReleaseDate){var u=its.loc("PreorderExpectedDate",{date:its.locDate(r[0].expectedReleaseDate)});
t.subtitle=its.sf14.ComponentUtil.createText(this,u,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,unescaped:!0,attributes:{"class":"cmc-subtitle"}},!0)}}else t={buttons:[this.renderComponentWithData("buy_button",{offer:n[0],content:this._book})]};
return e.push(this.renderComponentWithData("offer",t)),i&&!its.App.ParentalRequestData&&e.push(this.renderComponentWithData("offer",o)),e},artwork:function(){var e={artworkUrls:its.sf.ParentalRatingUtil.doesPass(this._book)?this._book.artwork:its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_BOOK,size:its.dv14.LockupUtil.getArtworkDimensions(this._book.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()),alt:this._book.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this._book.kind)]};
return this.renderComponentWithData("artwork",e)},updateArtwork:function(e){its.sf.ParentalRatingUtil.doesPass(this._book)&&this.base(e)},details:function(){var e=this._book,t=e.ebookInfo,n=[],r=t.languageDisplayString;
if(r&&t.isForeignLanguage){var i=its.loc("DV14.Language")+": "+r;
n.push(its.sf14.ComponentUtil.createText(this,i,{unescaped:!0},!0))}var s=null;
t&&(s=t.pageCount);
if(e.releaseDate&&s){var o=its.loc("PublishDateAndPageCount",{count:formatNumber(s),date:its.locDate(e.releaseDate)});
n.push(its.sf14.ComponentUtil.createText(this,o,{unescaped:!0},!0))}return e.userRating&&n.push(its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!0)),n},title:function(){return its.sf14.ComponentUtil.createText(this,this._book.name,{type:its.sf14.ComponentUtil.TextType.TITLE},!0)},subtitle:function(){var e=null;
return this._book.ebookInfo&&this._book.ebookInfo.subtitle&&(e=its.sf14.ComponentUtil.createText(this,this._book.ebookInfo.subtitle,{"data-url":this._book.artistUrl},!0)),e},author:function(){return its.sf14.ComponentUtil.createButton(this,this._book.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this._book.artistUrl},null,!0)},badges:function(){if(its.sf.Platform.iPhone())return;var e=[];
return this._book.ebookInfo.isiBook&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.MADE_IBOOKS,!0)),e},badgePosition:function(){return its.dv14.ProductLockup.BadgePosition.BOTTOM_RIGHT},_updateRestrictions:function(){this._lockupElement.replaceTokenWithElement("artwork",this.artwork())}}),its.dv14.MixProductLockup=Class.createSubclass("its.dv14.MixProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments)},offers:function(){var e=this.lookup("offers");
if(e){var t=its.sf.StorePlatformUtil.orderedOffers(e)[0],n={buttons:[this.renderComponentWithData("buy_button",{offer:t,content:this.product,buttonStyle:its.dv14.BuyButton.ButtonStyle.default})],layout:its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT};
this._offer=this.componentWithData("offer",n),this._offerElement=this._offer.render()}return this._offerElement?[this._offerElement]:null},updateProductData:function(e){this.product.id==e.id&&(this.data.offers=e.offers,this.data.tracks=e.tracks,this.base(),this._renderOffers())},details:function(){var e=[];
return this.data.tracks&&e.push(its.sf14.ComponentUtil.createText(this,its.locWithCount("IXDisplayableKind.count.song",this.data.tracks.length),null,!0)),this.product.releaseDate&&!this._preorderOffer&&e.push(its.sf14.ComponentUtil.createText(this,its.loc("DV14.Released",{date:its.locDate(this.product.releaseDate)}),{},!0)),e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this.product.url,!0)),this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e},title:function(){var e=its.sf.ContentRatingsManager.legacyContentRating(this.product),t=its.dv14.BadgeUtil.createCleanOrExplicitBadge(e,!0);
return its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:t?[t]:[]},!0)},badges:function(){if(its.sf.Platform.iPhone())return;var e=[],t=its.sf.ContentRatingsManager.legacyContentRating(this.product),n=its.sf.StorePlatformUtil.ContentRating.isExplicit(t);
return n&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.PARENTAL_ADVISORY,!0)),e},badgePosition:function(){return its.dv14.ProductLockup.BadgePosition.BOTTOM_RIGHT},subtitle:function(){return its.sf14.ComponentUtil.createText(this,this.product.artistName,null,!0)}}),its.dv14.PodcastProductLockup=Class.createSubclass("its.dv14.PodcastProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._podcast=this.product,this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this))},offers:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t={buttons:[this.renderComponentWithData("buy_button",{offer:e,content:this._podcast,buttonStyle:its.dv14.BuyButton.ButtonStyle.filled})]},n=[this.renderComponentWithData("offer",t)];
return n},artwork:function(){var e={artworkUrls:this.product.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this.product.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()),alt:this._podcast.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this._podcast.kind)]};
return this.renderComponentWithData("artwork",e)},updateArtwork:function(e){its.sf.ParentalRatingUtil.doesPass(this._podcast)&&this.base(e)},details:function(){var e=[];
e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this._podcast.url,!0));
var t=this._podcast.genres[0].name;
return e.push(its.sf14.ComponentUtil.createText(this,t,{unescaped:!1},!0)),t=this._podcast.podcastLanguageName,e.push(its.sf14.ComponentUtil.createText(this,t,{unescaped:!1},!0)),this._podcast.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this._podcast.userRating,!0)),e},title:function(){var e=its.sf.ContentRatingsManager.legacyContentRating(this._podcast),t=its.sf.StorePlatformUtil.ContentRating.isExplicit(e),n=t?its.dv14.BadgeUtil.createCleanOrExplicitBadge(e,!0):!1;
return its.sf14.ComponentUtil.createText(this,this._podcast.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:n?[n]:[]},!0)},subtitle:function(){if(this._podcast.artistUrl)return its.sf14.ComponentUtil.createButton(this,this._podcast.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this._podcast.artistUrl},null,!0);
var e=its.sf14.ComponentUtil.createText(this,this._podcast.artistName,null,!0);
return e.classList.add("podcasts-subtitle"),e},_updateRestrictions:function(){this._lockupElement.replaceTokenWithElement("artwork",this.artwork())}}),its.dv14.PurchasesLockup=Class.createSubclass("its.dv14.PurchasesLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments),this._primaryContent=this.lookup("primaryContent"),this._backingContent=this.lookup("backingContent")?this.lookup("backingContent"):{orderedKeys:[]},!this._primaryContent&&this._backingContent.orderedKeys.length>0&&(this._primaryContent=this._backingContent[this._backingContent.orderedKeys[0]]),this._idsToRedownload=this._backingContent&&this._backingContent.orderedKeys.length>0?this._backingContent.orderedKeys:[this._primaryContent.id],this._isRestoreMode=its.isDefinedNonNull(this.lookup("isRestoreMode"))?this.lookup("isRestoreMode"):!1;
if(this._backingContent.orderedKeys.length>0){this._content={orderedKeys:[]};
for(var e=0;
e<this._backingContent.orderedKeys.length;
e++){var t=this._backingContent.orderedKeys[e];
this._content[t]=this._backingContent[t],this._content.orderedKeys.push(t)}}else this._content={orderedKeys:[this._primaryContent.id]},this._content[this._primaryContent.id]=this._primaryContent;
this._offersMap=null,this._hideUnhideCallback=this.lookup("hideUnhideCallback");
var n={contentRating:this._primaryContent.contentRating,contentRatingBySystem:this._primaryContent.contentRatingBySystem,kind:this._content.kind};
this._doesPassParentalRating=its.sf.ParentalRatingUtil.doesPass(n),this.subscribe(its.sf.ParentalRatingUtil.Events.PARENTAL_RATING_CHANGE,this._updateRestrictions.bind(this)),this.subscribe(its.sf.StorePlatform.Events.PERSONALIZED_OFFERS_AVAILABLE,this._handlePersonalizationEvent.bind(this))},templateName:function(){return"lockups/dv14_small_lockup"},renderAsString:function(){var e=this._primaryContent.collectionId?this._primaryContent.collectionId:this._primaryContent.id,t=this._primaryContent.id;
e&&(!its.sf.Platform.iPhone()||this._primaryContent.kind!=its.sf.StorePlatform.Kind.TvEpisode)&&this._primaryContent.kind!=its.sf.StorePlatform.Kind.MusicVideo&&this.setAttribute("data-collection-id",e),this.setAttribute("data-content-id",t),this.setAttribute("data-content-kind",this._primaryContent.kind),this.setAttribute("data-url",this._primaryContent.url);
if(this._isEditable){var n=its.Templates.get("lockups/dv14_purchases_lockup/input");
this._inputElementStr=n.compose(),this.template.replaceTokenUnescaped("input",this._inputElementStr),this.subscribeToTarget(its.sf14.Events.SELECT,this._handleLockupSelection.bind(this),this.itsId())}this._shouldOpenProductExternally()&&this.setAttribute("data-page-target",its.sf14.PageController.PageTarget.EXTERNAL),this.template.replaceTokenUnescaped("details",this._renderDetails());
var r=its.sf.StorePlatformUtil.bestPreview(this._primaryContent.offers);
this._shouldRenderTrackPreview()&&its.isDefinedNonNull(r)&&(this.template.keepBlock("previewBlock",!0),this.template.replaceToken("previewUrl",r.url),this.template.replaceToken("previewContentId",this._primaryContent.id),this._shouldRenderTrackPreview()&&this.template.replaceToken("disablePreviewControl",!this._doesPassParentalRating)),this.template.replaceTokenUnescaped("artwork",this._artwork()),this.addClass("lockup-row"),this.setAttribute("type","list");
var i=this.lookup("actions");
i&&this.template.replaceTokenUnescaped("actions",this._renderActions(i));
var s=this.lookup("additionalAttributes");
if(s)for(var o in s)this.setAttribute(o,s[o]);
return this._markup=this.template.compose(this.itsId()),this._markup},_detailsGenerator:function(){var e=this.lookup("detailsGenerator");
return e||(e=its.dv14.SmallLockup.DefaultDetailsGenerator.List),e},_renderDetails:function(){var e=this._detailsGenerator().details(this._primaryContent),t;
if(e){var n=its.Templates.get("lockups/dv14_purchses_lockup/item_container"),r=n.getBlock("itemLoop");
for(var i=0;
i<e.length;
i++){var s=e[i],o=null;
if(s.markup)o=s.markup;
else if(s.value)if(i==0){var u=this.lookup("titleMaxLines"),a=this._type==its.dv14.SmallLockup.Type.LIST?1:2;
a=u?u:a;
var f=s.value;
this._ordinal&&this._titleOrdinal&&(f=this._ordinal+" "+s.value),o=its.sf14.ComponentUtil.createText(this,f,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":"lockup-title",maxLines:a},badges:this._badges()})}else i==1?o=its.sf14.ComponentUtil.createText(this,s.value,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{maxLines:1}}):o=s.value;
r.replaceTokenUnescaped("item",o),r.next()}t=n.compose()}return t},_artwork:function(){var e=this._primaryContent.artwork,t=this.lookup("kindOrName");
t||(t=this._primaryContent.kind),this._doesPassParentalRating||(this._primaryContent.kind==its.sf.StorePlatform.Kind.Audiobook?e=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_AUDIOBOOK:this._primaryContent.kind==its.sf.StorePlatform.Kind.EBook&&(e=its.dv14.Artwork.PlaceholderArtwork.EXPLICIT_BOOK));
var n=this.lookup("artworkEffects"),r={artworkUrls:e,size:its.dv14.LockupUtil.getArtworkDimensions(t,this.lookup("artworkProfile"),this.documentSize()),effects:n?n:its.sf14.Artwork.effects(this._primaryContent.kind),alt:this._primaryContent.name,classes:[its.dv14.LockupUtil.getArtworkClassName(this._primaryContent.kind)],disabled:!this._shouldRenderTrackPreview()};
return this.renderComponentStringWithData("artwork",r)},_updateRestrictions:function(){var e=this._doesPassParentalRating!=its.sf.ParentalRatingUtil.doesPass(this._primaryContent);
e&&(this._doesPassParentalRating=its.sf.ParentalRatingUtil.doesPass(this._primaryContent)),e&&(this._primaryContent.kind==its.sf.StorePlatform.Kind.Audiobook||this._primaryContent.kind==its.sf.StorePlatform.Kind.EBook)&&this._lockupElement.replaceTokenWithElement("artwork",this._artwork())},_shouldRenderTrackPreview:function(){return this._content.kind==its.sf.StorePlatform.Kind.Song||this._content.kind==its.sf.StorePlatform.Kind.Ringtone||this._content.kind==its.sf.StorePlatform.Kind.Tone||this._content.kind==its.sf.StorePlatform.Kind.PodcastEpisode},_renderPersonalizedComponents:function(){if(this._isCompletelyInitialized()&&this._redownloadButton&&!this._isRestoreMode){var e={content:this._content},t=this.renderComponentWithData("redownload_button",e);
this.element.replaceChild(t,this._redownloadButton),this._redownloadButton=t}},_isCompletelyInitialized:function(){return this._offers()&&this._content},_offers:function(e){if(!this._offersMap||e){this._offersMap={};
var t=!0;
for(var n=0;
n<this._idsToRedownload.length&&t;
n++){var r=this._idsToRedownload[n],i=this.storePlatform.getCachedOffersArray(r),s=its.sf.StorePlatformUtil.findRedownloadOffers(i);
s.length>0?this._offersMap[r]=s:t=!1}t||(this._offersMap=null)}return this._offersMap},onElementCreated:function(){this._redownloadButton=this.element.querySelector("[redownloadButton]"),this._renderPersonalizedComponents()},_isEventForMe:function(e){var t=!1;
for(var n=0;
n<this._idsToRedownload.length;
n++)if(e.data&&its.isDefinedNonNull(e.data[this._idsToRedownload[n]])){t=!0;
break}return t},_handlePersonalizationEvent:function(e){this.__isEventForMe(e)&&this._renderPersonalizedComponents()}}),its.dv14.MovieProductLockup=Class.createSubclass("its.dv14.MovieProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._pageState=this.lookup("pageState"),this._validPageStates=this.lookup("validPageStates"),its.notifications.subscribe(its.sf14.Events.RENTAL_INFO_CHANGED,this.checkForRentalExpirationData.bind(this))},offers:function(){var e=this._offersForBuyButtons(),t=[],n=its.sf.StorePlatformUtil.findNonRentalOffers(e),r=its.sf.StorePlatformUtil.findRentOffers(e),i=its.sf.StorePlatformUtil.findPreorderOffers(e),s=this.storePlatform.getCachedOffersArray(this.data.content.id);
this.orderedOffers=its.sf.StorePlatformUtil.orderedOffers(s);
var o=null;
r.length>0&&(this._rental_buy_button=this.renderComponentWithData("buy_button",{offer:r[0],content:this.product}),o={buttons:[this._rental_buy_button],layout:its.dv14.Offer.Layout.TEXT_ON_LEFT},i.length>0&&(o.title=its.sf14.ComponentUtil.createText(this,its.loc("Rent"),{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":"rent-button-text"}},!0)));
if(i.length>0){this.preorderOffers=i,o&&(this._shouldPutDividersBetweenOffers=!1,t.push(this.renderComponentWithData("offer",o)));
var u={buttons:[this.renderComponentWithData("buy_button",{offer:i[0],content:this.product,buttonStyle:its.dv14.BuyButton.ButtonStyle.preorder})],layout:its.sf.Platform.iPad()&&!o?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT,title:its.sf14.ComponentUtil.createText(this,its.loc("Pre-Order"),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),styleType:"preorder"};
if(i[0].expectedReleaseDate){var a=its.loc("PreorderExpectedDate",{date:its.locDate(i[0].expectedReleaseDate)});
u.subtitle=its.sf14.ComponentUtil.createText(this,a,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,unescaped:!0,attributes:{"class":"cmc-subtitle"}},!0)}t.push(this.renderComponentWithData("offer",u))}else{if(n.length>0){var f={buttons:[this.renderComponentWithData("buy_button",{offer:n[0],content:this.product,isPurchasedModal:this.data.isPurchasedModal})]};
t.push(this.renderComponentWithData("offer",f));
if(its.sf.Client.isVersion("10.3")){var l=this.orderedOffers[0].rentalExpirationDate;
l&&this.updateRentalExpiration(l)}}o&&t.push(this.renderComponentWithData("offer",o))}this.checkForRentalExpirationData();
if(this.data.isPurchasedModal){var c=its.sf.Client.isVersion("10.1")||itms.areVideosCloudPurchasesEnabled&&itms.areVideosCloudPurchasesEnabled();
if(!t.length){var h={buttons:[this.renderComponentWithData("buy_button",{offer:{},content:this.product,isPurchasedModal:this.data.isPurchasedModal})],attributes:{supportsPlayButton:c?"YES":""}};
t.push(this.renderComponentWithData("offer",h))}}return t},checkForRentalExpirationData:function(){itms.loadRental&&itms.loadRental(this.product.id,function(e){if(!e)return;this.rentalData=e,Array.isArray(e)&&(e=e[0]);
if(e){console.log("itms.loadRental data",e);
var t=e["expiration-date"];
if(t&&this._rental_buy_button){its.notifications.publishToTarget(its.dv14.MovieProductLockup.Events.RENTAL_INFO_CHANGED,e,this._rental_buy_button.itsId()),this.updateRentalExpiration(t);
var n,r=this._lockupElement.getElementsByTagName("offer");
if(!its.sf.Client.isVersion("10.3"))for(var i=r.length-1;
i>=0;
i--)n=r.item(i).getElementsByTagName("button").item(0),n&&n.parentNode&&n.getAttribute("data-type")==="buy"&&n.parentNode.remove()}}}.bind(this))},updateRentalExpiration:function(e){if(!e)return;console.log("updateRentalExpiration");
var t,n=its.sf14.Util.timeLeftForRental(e);
this.product.isRented=!0,n&&(t=its.sf14.ComponentUtil.createText(this,n,{attributes:{"class":"rental-expiration"}},!0)),this._lockupElement.replaceTokenWithElement("additionalInfo",t)},updateProductData:function(e){this.product.id==e.id&&(e.hide4kAndHdrBadges?(this.hide4kAndHdrBadges=e.hide4kAndHdrBadges,this.renderAdditionalComponents()):(this.base(),this.data.iTunesExtras=e.iTunesExtras,this.data.isRottenTomatoesEnabled=e.isRottenTomatoesEnabled,this.product.futureRentalAvailability=e.futureRentalAvailability,this.renderAdditionalComponents()))},renderAdditionalComponents:function(){var e=this.badgesNew(),t=this.badgePosition(),n=[];
if(e){var r=its.Templates.get("lockups/dv14_product_lockup/list");
t&&n.push(t),this.lookup("iTunesExtras")&&this._pageState==its.sf14.ProductPage.State.HD&&n.push("badge-row"),n.length>0&&r.replaceToken("listClass",n.join(" "));
var i=r.getBlock("itemLoop");
for(var s=0;
s<e.length;
s++)i.replaceTokenWithElement("item",e[s]),i.next();
var o=r.composeAsElement();
its.dv14.Util.UI.shouldPinProductLockup({isPurchasedModal:this.data.isPurchasedModal})&&o.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),this._lockupElement.replaceTokenWithElement("badgesNew",o)}this.lookup("iTunesExtras")&&this._pageState==its.sf14.ProductPage.State.HD?this._lockupElement.replaceTokenWithElement("extrasPromo",this._renderExtrasPromo()):this._lockupElement.replaceTokenWithElement("extrasPromo",document.createElement("placeholder"));
if(this.product.isRottenTomatoesEnabled||this.data.isRottenTomatoesEnabled&&this.product.rottenTomatoesScore){this.product.isRottenTomatoesEnabled=!0;
var u=this._lockupElement.querySelector("#rtPlaceholder");
u&&(u.outerHTML=its.sf14.ComponentUtil.createRottenTomatoes(this,this.product.rottenTomatoesScore,!0).outerHTML)}var a=this._lockupElement.getElementsByTagName("offer");
if(a.length===1&&!this.preorderOffers&&this.product.futureRentalAvailability){var f=a.item(0).getElementsByTagName("button").item(0).getAttribute("data-type")==="redownload";
if(!f&&!this.data.isPurchasedModal){var l=its.sf14.ComponentUtil.createText(this,its.loc("DV14.MoviePage.RentalAvailability",{date:its.locDate(this.product.futureRentalAvailability)}),{},!0);
its.sf.Platform.iPad()?(l.setAttribute("class","cmc-subtitle"),a.item(0).replaceTokenWithElement("additionalText",l)):(l.setAttribute("class","text-right"),its.dv14.Util.UI.shouldPinProductLockup({isPurchasedModal:this.data.isPurchasedModal})&&l.setAttribute("pin","group-rubberband"),this._lockupElement.replaceTokenWithElement("cmcInfo",l))}}},_renderExtrasPromo:function(){var e=its.Templates.get("components/dv14_product_lockup/extras_promo"),t=its.dv14.BadgeUtil.getAssetData(its.dv14.BadgeUtil.Badges.ITUNES_EXTRAS),n=its.loc("SF.ExtrasIncludedWithHDPurchase");
return this.product.has4K&&!this.hide4kAndHdrBadges&&(n=its.loc("SF.ExtrasIncludedWith4KPurchase")),e.replaceToken("glyph",t.url),e.replaceToken("width",t.width),e.replaceToken("height",t.height),e.replaceToken("bonusTitle",its.loc("DV14.ProductPage.Tab.ITunesExtras")),e.replaceToken("bonusText",n),this._extrasPromoElement=e.composeAsElement(),its.dv14.Util.UI.shouldPinProductLockup({isPurchasedModal:this.data.isPurchasedModal})&&this._extrasPromoElement.setAttribute("pin",its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),this._extrasPromoElement},details:function(){var e=[];
e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this.product.url,!0));
if(this.product.rottenTomatoesScore){var t=document.createElement("placeholder");
t.setAttribute("id","rtPlaceholder"),e.push(t)}if(its.sf.Platform.isReleaseDateInMovieLockup()&&this.product.releaseDate){var n=this.product.releaseDate.slice(0,4),r=its.loc("DV14.Released",{date:n});
e.push(its.sf14.ComponentUtil.createText(this,r,null,!0))}return this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e},title:function(){var e=[];
return!its.property("DV14.Videos.isNewBadgeLayoutEnabled")&&this._pageState==its.sf14.ProductPage.State.HD&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.HD,!0)),its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e},!0)},badges:function(){var e=[],t=this.product.contentRatingsBySystem,n;
for(var r in t)t.hasOwnProperty(r)&&(n=t[r],n.system=r);
return n&&this.shouldShowContentRating()&&e.push(its.dv14.BadgeUtil.VideoAgeRating.badge(this,n,!0)),its.property("DV14.Videos.isNewBadgeLayoutEnabled")||(its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets(this.product.offers)&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0)),its.sf.StorePlatformUtil.doOffersHaveAnySpecifiedProperty(this.product.offers,"hasSDH")&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.SDH,!0)),its.sf.StorePlatformUtil.doOffersHaveAnySpecifiedProperty(this.product.offers,"hasAudioDescription")&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.AD,!0))),e},badgesNew:function(){var e=[];
return its.property("DV14.Videos.isNewBadgeLayoutEnabled")&&(this._pageState==its.sf14.ProductPage.State.HD&&(this.hide4kAndHdrBadges=this.hide4kAndHdrBadges||this.orderedOffers[0].moviesAnywhereEntitlement===0,this.product.has4K&&!this.hide4kAndHdrBadges?e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.UHD,!0)):e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.HD,!0)),this.product.hasDolbyVision&&!this.hide4kAndHdrBadges?e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.DOVI,!0)):this.product.hasHDR&&!this.hide4kAndHdrBadges&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.HDR,!0)),this.product.hasDolbyAtmos&&!this.hide4kAndHdrBadges&&its.sf.Client.isVersion("12.0")&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.DA,!0))),its.sf.StorePlatformUtil.doOffersHaveAnyClosedCaptionedAssets(this.product.offers)&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0)),its.sf.StorePlatformUtil.doOffersHaveAnySpecifiedProperty(this.product.offers,"hasSDH")&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.SDH,!0)),its.sf.StorePlatformUtil.doOffersHaveAnySpecifiedProperty(this.product.offers,"hasAudioDescription")&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.AD,!0))),e},shouldShowContentRating:function(){var e=itms.storefront;
return e&&e.indexOf("143465")===-1},pills:function(){var e=its.sf.Platform.iPad()&&!its.property("DV14.Videos.isNewBadgeLayoutEnabled");
if(!its.App.ParentalRequestData&&e&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]&&!this.data.isPurchasedModal){var t={pills:[{label:its.loc("HD"),id:its.dv14.ProductLockup.Pills.HD},{label:its.loc("SD"),id:its.dv14.ProductLockup.Pills.SD}],activeId:this._pageState==its.sf14.ProductPage.State.HD?its.dv14.ProductLockup.Pills.HD:its.dv14.ProductLockup.Pills.SD,clickListener:this._handleHDSDToggleClicked.bind(this)};
this._pillComponent=this.componentWithData("pills",t)}return this._pillComponent?this._pillComponent.render():null},_offersForBuyButtons:function(){var e;
return this._validPageStates&&this._pageState&&(e=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(this.allProductOffers):its.sf.StorePlatformUtil.findSDOffers(this.allProductOffers)),e||(e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)),e},_handleHDSDToggleClicked:function(e){var t={pageState:e==its.dv14.ProductLockup.Pills.HD?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD,contentId:this.product.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,t)}}),its.dv14.MovieProductLockup.Events={RENTAL_INFO_CHANGED:"its.dv14.MovieProductLockup.Events.RENTAL_INFO_CHANGED"},its.dv14.MovieBundleProductLockup=Class.createSubclass("its.dv14.MovieBundleProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._pageState=this.lookup("pageState"),this._validPageStates=this.lookup("validPageStates"),this.subscribe(its.dv14.MovieBundlePage.Events.CLOSED_CAPTION_AVAILABLE,this._handleCCAvailable.bind(this)),this.subscribe(its.sf14.Events.DID_ROTATE,this._handleRotation.bind(this))},offers:function(){var e=this._offersForBuyButtons(),t=[],n={buttons:[this.renderComponentWithData("buy_button",{offer:e[0],content:this.product})]};
return t.push(this.renderComponentWithData("offer",n)),t},details:function(){var e=[];
return e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this.product.url,!0)),this.product.releaseDate&&e.push(its.sf14.ComponentUtil.createText(this,its.loc("DV14.Released",{date:its.locDate(this.product.releaseDate)}),{},!0)),this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e},title:function(){var e=[];
return this._pageState==its.sf14.ProductPage.State.HD&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.HD,!0)),its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e},!0)},badges:function(){if(!this._badges){this._badges=[];
var e=its.sf.ContentRatingsManager.legacyContentRating(this.product);
e&&this._badges.push(its.dv14.BadgeUtil.VideoAgeRating.badge(this,e,!0)),this.isCCrendered||(this.badges().push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0)),this.isCCrendered=!0)}return this._badges},pills:function(){if(its.sf.Platform.iPad()&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]){var e={pills:[{label:its.loc("HD"),id:its.dv14.ProductLockup.Pills.HD},{label:its.loc("SD"),id:its.dv14.ProductLockup.Pills.SD}],activeId:this._pageState==its.sf14.ProductPage.State.HD?its.dv14.ProductLockup.Pills.HD:its.dv14.ProductLockup.Pills.SD,clickListener:this._handleHDSDToggleClicked.bind(this)};
this._pillComponent=this.componentWithData("pills",e)}return this._pillComponent?this._pillComponent.render():null},_offersForBuyButtons:function(){var e;
return this._validPageStates&&this._pageState&&(e=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(this.allProductOffers):its.sf.StorePlatformUtil.findSDOffers(this.allProductOffers)),e||(e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)),e},_handleHDSDToggleClicked:function(e){var t={pageState:e==its.dv14.ProductLockup.Pills.HD?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD,contentId:this.product.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,t)},_handleCCAvailable:function(e){e.isCC&&!this.isCCrendered&&(this.badges().push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0)),this.isCCrendered=!0,this._renderBadges(),its.notifications.unsubscribe(its.dv14.MovieBundlePage.Events.CLOSED_CAPTION_AVAILABLE,this._handleCCAvailable))},_handleRotation:function(){this.isCCrendered=!1}}),its.dv14.MovieBundlePage.Events={CLOSED_CAPTION_AVAILABLE:"its.dv14.MovieBundlePage.Events.CLOSED_CAPTION_AVAILABLE"},its.dv14.MusicVideoProductLockup=Class.createSubclass("its.dv14.MusicVideoProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._video=this.product},offers:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t={buttons:[this.renderComponentWithData("buy_button",{offer:e,content:this._video})]};
return[this.renderComponentWithData("offer",t)]},details:function(){var e=this._video,t=[];
return t.push(its.sf14.ComponentUtil.createFacebookSmall(this,e.url,!0)),e.userRating&&t.push(its.dv14.UserRatingsUtil.createSmallStarRatings(e.userRating,!0)),t},updateProductData:function(e){this.product.id==e.id&&(e.product&&(this.product=e.product),this._renderDetails())},artwork:function(){var e=this._video.offers.filter(function(e){return e.type!=="preorder"}),t=its.sf.StorePlatformUtil.bestPreview(e),n={artworkData:{artworkUrls:this._video.artwork,size:its.dv14.LockupUtil.getArtworkDimensions(this._video.kind,its.sf.StorePlatform.ArtworkProfiles.PRODUCT,this.documentSize()),alt:this._video.name},url:t.url,contentRating:its.sf.ContentRatingsManager.legacyContentRating(this._video),kind:this._video.kind,contentId:this.product.id};
return this._videoPreviewElement=this.renderComponentWithData("video",n),this._videoPreviewElement},title:function(){var e=its.sf.ContentRatingsManager.legacyContentRating(this._video),t=its.dv14.BadgeUtil.createCleanOrExplicitBadge(e,!0);
return its.sf14.ComponentUtil.createText(this,this._video.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:t?[t]:[]},!0)},subtitle:function(){return its.sf14.ComponentUtil.createButton(this,this._video.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this._video.artistUrl},null,!0)}}),its.dv14.RadioStationLockup=Class.createSubclass("its.dv14.RadioStationLockup",its.sf14.BaseComponent,{initialize:function(){this.base.apply(this,arguments)},templateName:function(){return"lockups/dv14_small_lockup"},componentType:function(){return"lockup"},renderAsString:function(){return this.addClass(this.lookup("class")),this._content=this.data.content,this.setAttribute("data-content-id",this._content.id),this.setAttribute("data-url",this._content.radioUrl),this.setAttribute("data-page-target",its.sf14.PageController.PageTarget.EXTERNAL),this.template.replaceTokenUnescaped("artwork",this._artwork()),this.data.type==its.dv14.RadioStationLockup.Type.LIST?(this.template.keepBlock("decorationImageBlock"),this.template.replaceTokenUnescaped("details",this._renderDetails()),this.setAttribute("type","list")):this.data.type==its.dv14.RadioStationLockup.Type.RADIO_PACK&&this.setAttribute("type","list"),this.template.replaceTokenUnescaped("details",this._renderDetails()),this._markup=this.template.compose(this.itsId()),this._markup},onElementCreated:function(){its.sf.Metrics.setTargetInfo(this.element,this._content.id,"lockup",its.sf.Metrics.ActionType.NAVIGATE,this._content.url)},_artwork:function(){var e=this.data.content,t=e.artwork,n;
this.data.type==its.dv14.RadioStationLockup.Type.LIST?n="room":this.data.type==its.dv14.RadioStationLockup.Type.RADIO_PACK?n="radio_pack_page":n="swoosh";
var r={artworkUrls:t,size:its.dv14.LockupUtil.getArtworkDimensions(e.kind,n,this.documentSize()),alt:e.name,classes:[its.dv14.LockupUtil.getArtworkClassName(e.kind)]};
return this.renderComponentStringWithData("artwork",r)},_renderDetails:function(){var e,t=[{value:this.data.content.name}],n=this.data.type==its.dv14.RadioStationLockup.Type.LIST;
n&&t.push({value:its.loc("Radio.PromoWidgetString")});
if(t){var r=its.Templates.get("lockups/dv14_small_lockup/item_container"),i=r.getBlock("itemLoop");
for(var s=0;
s<t.length;
s++){var o=t[s],u=o.value;
if(its.isString(o.value))if(s==0){var a=this.lookup("titleMaxLines"),f=n?1:3;
f=a?a:f;
var l=o.value;
u=its.sf14.ComponentUtil.createText(this,l,{type:its.sf14.ComponentUtil.TextType.TITLE,attributes:{"class":"lockup-title",maxLines:f}})}else s==1?u=its.sf14.ComponentUtil.createText(this,o.value,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{maxLines:1}}):u=its.sf14.ComponentUtil.createText(this,o.value);
i.replaceTokenUnescaped("item",u),i.next()}e=r.compose()}return e}}),its.dv14.RadioStationLockup.Type={LIST:"list",SHELF:"shelf",RADIO_PACK:"radio_pack"},its.dv14.SoftwareProductLockup=Class.createSubclass("its.dv14.SoftwareProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._isNotifyMeContent=its.dv14.NotifyMeButton.isNotifyMeContent(this.product.id)},offers:function(){var e,t=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],n={offer:t,content:this.product};
this._isNotifyMeContent?e=this.renderComponentWithData("notify_me_button",n):e=this.renderComponentWithData("buy_button",n);
var r={buttons:[e],layout:its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT};
this._offer=this.componentWithData("offer",r);
if(this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle){var i=its.locWithCount("IXDisplayableKind."+this.product.kind,1);
this._offer.updateTitle(its.sf14.ComponentUtil.createText(this,i,{type:its.sf14.ComponentUtil.TextType.TITLE},!0));
var s=its.loc("SF.SoftwareBundles.RegularPrice",{price:this.product.regularPriceFormatted});
this._offer.updateSubtitle(its.sf14.ComponentUtil.createText(this,s,{type:its.sf14.ComponentUtil.TextType.SUBTITLE},!0))}return this._offerElement=this._offer.render(),[this._offerElement]},details:function(){var e=[];
if(this.product.ageBand){var t=null;
this.product.ageBand.maxAge<=5?t=its.loc("SF.MobileSoftware.AgeBandCategory.Under5"):t=its.loc("SF.MobileSoftware.AgeBandCategory",{minAge:this.product.ageBand.minAge,maxAge:this.product.ageBand.maxAge});
var n=its.sf14.ComponentUtil.createText(this,t,null,!0);
e.push(n)}if(this.product.userRating&&!this.product.isFirstParty){var r=itms.getBag().enableUnifiedAppRating,i=this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle||r?this.product.userRating.value:this.product.userRating.valueCurrentVersion,s=this.product.kind===its.sf.StorePlatform.Kind.MobileAppBundle||r?this.product.userRating.ratingCount:this.product.userRating.ratingCountCurrentVersion,o={value:i,ratingCount:s};
e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(o,!0))}return e},title:function(){var e=[],t=its.sf.ContentRatingsManager.create(this.product.contentRatingsBySystem);
if(t){var n=t.ratingForAppsApple();
n&&e.push(its.dv14.BadgeUtil.createBadge({name:n.rating.name,classname:"badge-for-app-rating",textOnly:!0},!0));
var r=t.ratingsOtherThanAppsApple();
r.forEach(function(t){e.push(its.dv14.BadgeUtil.AppRatings.badge(t,!0))})}return its.sf14.ComponentUtil.createText(this,this.product.name,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e},!0)},subtitle:function(){return its.sf14.ComponentUtil.createButton(this,this.product.artistName,its.sf14.ComponentUtil.ButtonType.LINK,{"data-url":this.product.artistUrl},null,!0)},badges:function(){var e=[];
return this.product.editorialBadgeInfo?e.push(its.dv14.BadgeUtil.createEditorialBadge(this.product.editorialBadgeInfo.nameForDisplay,!0)):this.product.isFirstParty&&e.push(its.sf14.ComponentUtil.createText(this,its.loc("DV14.IncludedWithLatestIos"),null,!0)),e},badgeClasses:function(){return this.product.hasInAppPurchases?["editorial-padding-with-iap"]:[]},notice:function(){if(this.product.hasInAppPurchases)return its.sf14.ComponentUtil.createText(this,its.loc("Software.HasAddOns"),{attributes:{"class":"offers-iap"}},!0)},personalize:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t=e.type==its.sf.StorePlatform.Offer.Type.COMPLETE;
t?this._renderCMCInfo():this._cmcInfoElement&&(this._cmcInfoElement=null,this._removeCMCInfo())},renderAdditionalComponents:function(){if(its.dv14.AdditionalAppTypes.appHasAdditionalTypes(this.product)){var e=its.sf.Platform.isIPhone6PlusScreenSize()&&its.dv14.Util.UI.isLandscape(),t=[];
!e&&!its.dv14.Util.UI.isCompact(this.documentSize())&&(t=["bottom-right","align-right"]),this._additionalAppTypes=this.renderComponentWithData("additional_app_types",{content:this.product,shouldPin:its.dv14.Util.UI.shouldPinProductLockup(),stackListClasses:t}),its.sf.Client.isVersion("10.0")&&!e&&!its.dv14.Util.UI.isCompact(this.documentSize())?this._lockupElement.replaceTokenWithElement("additionalAppTypesInLockup",this._additionalAppTypes):this._lockupElement.replaceTokenWithElement("additionalAppTypes",this._additionalAppTypes)}},postLockupContent:function(){if(!this._isNotifyMeContent)return null;
var e={attributes:{maxLines:0}};
return its.dv14.Util.UI.shouldPinProductLockup()&&(e.attributes.pin=its.dv14.ProductPageUtil.PinStyle.GROUP_RUBBERBAND),its.sf14.ComponentUtil.createText(this,its.loc("SF.NotifyMe.Description",{itemName:this.product.name}),e,!0)},_renderCMCInfo:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)[0],t=0;
for(var n=0;
n<this.product.childrenIds.length;
++n){var r=this.product.childrenIds[n],i=this.product.children[r],s=its.sf.StorePlatformUtil.findBuyOffers(i.offers)[0];
if(!e.cmcCredits||!e.cmcCredits[r])t+=s.price}if(e.price>t){this._removeCMCInfo(),this._offerElement&&this._offerElement.parentNode&&this._offerElement.parentNode.removeChild(this._offerElement);
return}this._offer.updateTitle(its.sf14.ComponentUtil.createText(this,its.loc("DV14.CompleteMyBundle"),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),"cmc");
var o=its.sf.StorePlatformUtil.findBuyOffers(this.allProductOffers)[0],u=its.loc("DV14.RegularPrice",{price:o.priceFormatted});
this._offer.updateSubtitle(its.sf14.ComponentUtil.createText(this,u,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,unescaped:!0,attributes:{"class":"cmc-subtitle"}},!0)),its.sf.Platform.iPhone()&&this._lockupElement.replaceTokenWithElement("cmcInfo",this._offerElement)},_removeCMCInfo:function(){this._offer.removeTitle(),this._offer.removeSubtitle(),its.sf.Platform.iPhone()&&(this._renderOffers(),this._lockupElement.replaceTokenWithElement("cmcInfo",document.createElement("placeholder")))}}),its.dv14.ToneAlbumProductLockup=Class.createSubclass("its.dv14.ToneAlbumProductLockup",its.dv14.AlbumProductLockup,{offers:function(){return[]},details:function(){var e=[];
return e.push(its.sf14.ComponentUtil.createText(this,this.product.genres[0].name,null,!0)),this.product.releaseDate&&!this._preorderOffer&&e.push(its.sf14.ComponentUtil.createText(this,its.loc("DV14.Released",{date:its.locDate(this.product.releaseDate)}),{},!0)),e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this.product.url,!0)),this.product.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this.product.userRating,!0)),e}}),its.dv14.TvSeasonProductLockup=Class.createSubclass("its.dv14.TvSeasonProductLockup",its.dv14.ProductLockup,{initialize:function(){this.base.apply(this,arguments),this._season=this.product,this._pageState=this.lookup("pageState"),this._validPageStates=this.lookup("validPageStates"),this.subscribe(its.dv14.ProductPage.Events.CLOSED_CAPTION_AVAILABLE,this._handleCCAvailable.bind(this))},offers:function(){var e={buttons:[this.renderComponentWithData("buy_button",{offer:this._offersForBuyButtons()[0]||{},content:this._season,buttonStyle:its.dv14.BuyButton.ButtonStyle.filled})],isPurchasedModal:this.data.isPurchasedModal,layout:its.sf.Platform.iPad()?its.dv14.Offer.Layout.TEXT_ON_RIGHT:its.dv14.Offer.Layout.TEXT_ON_LEFT};
return this.data.isPurchasedModal&&(e.buttons=[]),this._offer=this.componentWithData("offer",e),this._offerElement=this._offer.render(),[this._offerElement]},details:function(){var e=[];
return e.push(its.sf14.ComponentUtil.createFacebookSmall(this,this._season.url,!0)),this._season.userRating&&e.push(its.dv14.UserRatingsUtil.createSmallStarRatings(this._season.userRating,!0)),e},title:function(){var e=[];
return this._pageState==its.sf14.ProductPage.State.HD&&e.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.HD,!0)),its.sf14.ComponentUtil.createText(this,this._season.artistName,{type:its.sf14.ComponentUtil.TextType.TITLE,badges:e},!0)},subtitle:function(){return its.sf14.ComponentUtil.createText(this,its.sf14.LockupUtil.tvSeasonNameWithoutShowName(this._season.name,this._season.artistName),{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{maxLines:1}},!0)},badges:function(){if(!this._badges){var e=its.sf.ContentRatingsManager.legacyContentRating(this._season);
this._badges=e?[its.dv14.BadgeUtil.VideoAgeRating.badge(this,e,!0)]:[],this.data.isClosedCaptioned&&this._badges.push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0))}return this._badges},pills:function(){if(its.sf.Platform.iPad()&&this._validPageStates&&this._validPageStates[its.sf14.ProductPage.State.HD]&&this._validPageStates[its.sf14.ProductPage.State.SD]){var e={pills:[{label:its.loc("HD"),id:its.dv14.ProductLockup.Pills.HD},{label:its.loc("SD"),id:its.dv14.ProductLockup.Pills.SD}],activeId:this._pageState==its.sf14.ProductPage.State.HD?its.dv14.ProductLockup.Pills.HD:its.dv14.ProductLockup.Pills.SD,clickListener:this._handleHDSDToggleClicked.bind(this)};
this._pillComponent=this.componentWithData("pills",e)}return this._pillComponent?this._pillComponent.render():null},_offersForBuyButtons:function(){var e;
return this._validPageStates&&this._pageState&&(e=this._pageState==its.sf14.ProductPage.State.HD?its.sf.StorePlatformUtil.findHDOffers(this.allProductOffers):its.sf.StorePlatformUtil.findSDOffers(this.allProductOffers)),e||(e=its.sf.StorePlatformUtil.orderedOffers(this.allProductOffers)),e},_handleHDSDToggleClicked:function(e){var t={pageState:e==its.dv14.ProductLockup.Pills.HD?its.sf14.ProductPage.State.HD:its.sf14.ProductPage.State.SD,contentId:this._season.id};
its.notifications.publish(its.sf14.ProductPage.Events.PAGE_STATE_CHANGED,t)},_handleCCAvailable:function(e){this._season.id==e.id&&e.isCC&&(this.data.isClosedCaptioned||(this.badges().push(its.dv14.BadgeUtil.createBadge(its.dv14.BadgeUtil.Badges.CC,!0)),this._renderBadges()),its.notifications.unsubscribe(its.dv14.ProductPage.Events.CLOSED_CAPTION_AVAILABLE))},personalize:function(){var e=its.sf.StorePlatformUtil.orderedOffers(this._offersForBuyButtons())[0],t=e.type==its.sf.StorePlatform.Offer.Type.COMPLETE;
t&&!this.data.isPurchasedModal?this._renderCMCInfo():this._cmcInfoElement&&(this._cmcInfoElement=null,this._removeCMCInfo())},_renderCMCInfo:function(){this._offer.updateTitle(its.sf14.ComponentUtil.createText(this,its.loc("DV14.CompleteMySeason"),{type:its.sf14.ComponentUtil.TextType.TITLE},!0),"cmc");
var e=its.sf.StorePlatformUtil.findBuyOffers(this._offersForBuyButtons())[0],t=its.loc("DV14.RegularPrice",{price:e.priceFormatted});
this._offer.updateSubtitle(its.sf14.ComponentUtil.createText(this,t,{type:its.sf14.ComponentUtil.TextType.SUBTITLE,attributes:{"class":"cmc-subtitle"}},!0)),this._cmcInfoElement=this._offerElement,its.sf.Platform.iPhone()&&this._lockupElement.replaceTokenWithElement("cmcInfo",this._offerElement)},_removeCMCInfo:function(){this._offer.removeTitle(),this._offer.removeSubtitle(),its.sf.Platform.iPhone()&&(this._offersContainer=null,this._offerElements=null,this._renderOffers(),this._lockupElement.replaceTokenWithElement("cmcInfo",document.createElement("placeholer")))},renderAdditionalComponents:function(){this._lockupElement.replaceTokenWithElement("line3",its.sf14.ComponentUtil.createText(this,"<br/>",{unescaped:!0,attributes:{"class":"spacer"}},!0))}}),its.dv14.BaseBlock=Class.createSubclass("its.dv14.BaseBlock",its.sf14.BaseComponent,{}),its.dv14.BlockUtil=function(){function e(e,t,n){n=typeof n=="boolean"?n:!0;
for(var r in t)if(t[r]&&t[r].constructor==Object)e[r]||(e[r]=t[r]||{}),its.dv14.BlockUtil.deepExtend(e[r],t[r],n);
else if(e[r]&&n||!e[r])e[r]=t[r];
return e}function t(e,t){var n=!0,r=e.type,i=Date.now(),s=its.serverData.constants.countryCode;
if(!e.type||!its.Components._getComponent(r))console.warn("No block component found for defined type: "+r),n=!1;
e.type=="swoosh"&&(n=!1);
if(e.validation){if(n&&e.validation.startTime){var o=new Date(e.validation.startTime);
its.dv14.BlockUtil.isValidDate(o)&&i<o.valueOf()&&(n=!1)}if(n&&e.validation.endTime){var u=new Date(e.validation.endTime);
its.dv14.BlockUtil.isValidDate(u)&&i>u.valueOf()&&(n=!1)}n&&its.isArray(e.validation.includedStorefronts)&&e.validation.includedStorefronts.indexOf(s)<0&&(n=!1),n&&its.isArray(e.validation.excludedStorefronts)&&e.validation.excludedStorefronts.indexOf(s)>-1&&(n=!1);
if(n&&its.isArray(e.validation.includedPlatforms)){var a=!1;
for(var f=0;
f<e.validation.includedPlatforms.length;
f++){var l=e.validation.includedPlatforms[f];
typeof its.sf.Platform[l]=="function"&&its.sf.Platform[l]()&&(a=!0)}n=a}if(n&&e.validation.contentIsPreorder&&its.isDefinedNonNull(e.validation.contentIsPreorder.adamId)&&its.isDefinedNonNull(e.validation.contentIsPreorder.showBlock)){var c=null,h=e.validation.contentIsPreorder.adamId,p=e.validation.contentIsPreorder.showBlock;
its.isNumber(h)?c=h:its.isObject(h)&&(its.isNumber(h[s])?c=h[s]:h["default"]&&(c=h["default"]));
if(t&&t[c]){var d=its.sf.StorePlatformUtil.hasAnyPreorderOffers(t[c].offers);
if(d&&!p||!d&&p)n=!1}}}return n}function n(e){return e&&toString.call(e)=="[object Date]"&&!isNaN(e.valueOf())}function r(e,n){var r={},i=[],s=its.serverData.constants.countryCode,o=function(){var i=e.length;
while(i--)t(e[i],r)||e.splice(i,1);
n.call()};
for(var u=0;
u<e.length;
u++){var a=e[u],f;
if(a.validation&&a.validation.contentIsPreorder&&a.validation.contentIsPreorder.adamId){f=a.validation.contentIsPreorder.adamId;
if(its.isNumber(f))i.push(f);
else if(its.isObject(f)){var l=f[s]||f["default"];
l&&i.push(l)}}}if(i.length>0){var c=new its.sf.StorePlatform;
c.fetchContent({profile:its.sf.StorePlatform.Profiles.LOCKUP,ids:i,onOK:function(e){r=e,o.call()}})}else o.call()}return{deepExtend:e,isValidDate:n,validateBlocks:r}}(),its.dv14.BlockArtwork=function(){function n(n,r){var i=null;
if(n){r&&t[r]&&(n=n.replace("product",t[r]));
if(e[n]){var s=0;
its.sf.Platform.isIPhone6ScreenSize()?s=1:its.sf.Platform.isIPhone6PlusScreenSize()?its.dv14.Util.UI.Orientation=="portrait"?s=2:s=3:its.sf.Platform.iPad()&&(its.dv14.Util.UI.Orientation=="portrait"?s=4:s=5),i=e[n][s]}}return i}var e={square_0:[{width:80,height:80},{width:80,height:80},{width:80,height:80},{width:80,height:80},{width:80,height:80},{width:80,height:80}],square_1:[{width:80,height:80},{width:110,height:110},{width:110,height:110},{width:136,height:136},{width:136,height:136},{width:136,height:136}],square_2:[{width:130,height:130},{width:156,height:156},{width:176,height:176},{width:156,height:156},{width:162,height:162},{width:162,height:162}],square_3:[{width:156,height:156},{width:200,height:200},{width:220,height:220},{width:220,height:220},{width:220,height:220},{width:220,height:220}],square_4:[{width:240,height:240},{width:280,height:280},{width:280,height:280},{width:280,height:280},{width:300,height:300},{width:300,height:300}],vertical_0:[{width:80,height:135},{width:80,height:135},{width:80,height:135},{width:80,height:135},{width:80,height:135},{width:80,height:135}],vertical_1:[{width:80,height:120},{width:110,height:165},{width:110,height:165},{width:110,height:165},{width:136,height:204},{width:136,height:204}],vertical_2:[{width:130,height:195},{width:150,height:225},{width:157,height:236},{width:157,height:236},{width:150,height:300},{width:150,height:300}],vertical_3:[{width:150,height:150},{width:150,height:150},{width:150,height:150},{width:150,height:150},{width:190,height:285},{width:190,height:285}],vertical_4:[{width:240,height:240},{width:240,height:240},{width:240,height:240},{width:240,height:240},{width:240,height:240},{width:240,height:240}],horizontal_0:[{width:80,height:45},{width:80,height:45},{width:80,height:45},{width:80,height:45},{width:80,height:45},{width:80,height:45}],horizontal_1:[{width:80,height:45},{width:110,height:62},{width:110,height:62},{width:136,height:77},{width:136,height:77},{width:136,height:77}],horizontal_2:[{width:130,height:73},{width:156,height:88},{width:176,height:100},{width:156,height:88},{width:162,height:91},{width:162,height:91}],horizontal_3:[{width:170,height:96},{width:196,height:110},{width:220,height:124},{width:220,height:124},{width:226,height:127},{width:298,height:168}],horizontal_4:[{width:290,height:163},{width:345,height:194},{width:384,height:216},{width:384,height:216},{width:352,height:198},{width:352,height:198}]},t={album:"square",book:"square",course:"vertical",desktopApp:"square",epubBook:"vertical",epubEbookSeries:"vertical",ibook:"vertical",ibookTextbook:"vertical",iosSoftware:"square",metaEbook:"vertical",mix:"square",mobileSoftwareBundle:"square",movie:"vertical",movieBundle:"vertical",musicVideo:"square",newsstand:"vertical",podcast:"square",podcastEpisode:"square",radioStation:"square",song:"square",tvEpisode:"square",tvSeason:"square"};
return{getArtworkDimensions:n}}(),its.dv14.EditorialBlock=Class.createSubclass("its.dv14.EditorialBlock",its.dv14.BaseBlock,{render:function(){this._contentTemplate=its.Templates.get("blocks/dv14_editorial_block/content"),this._applyDefaultValues();
var e=this.renderAsString(),t;
return this._hasTruncatedBody()?t=its.Templates.get("blocks/dv14_editorial_block/wrapper_truncated"):t=its.Templates.get("blocks/dv14_editorial_block/wrapper_lockup"),this.data.align&&t.replaceToken("align",this.data.align),t.replaceTokenWithElement("content",its.element.createDocumentFragmentFromString(e)),t.composeAsElement()},_hasTruncatedBody:function(){return its.isNumber(this.data.bodyMaxLines)&&this.data.bodyMaxLines>0},renderAsString:function(){return this._contentTemplate=its.Templates.get("blocks/dv14_editorial_block/content"),this._applyDefaultValues(),this.data.image&&this._renderImage(),this.data.title&&(this._contentTemplate.keepBlock("titleBlock",!0),this.data.titleColor&&this._contentTemplate.replaceToken("titleColor","color:"+this.data.titleColor+";")),this.data.body&&(this._contentTemplate.keepBlock("bodyBlock",!0),this.data.bodyColor&&this._contentTemplate.replaceToken("bodyColor","color:"+this.data.bodyColor+";")),its.isArray(this.data.links)&&this.data.links.length>0&&this._renderLinks(),this.data.moreLabel=this.data.moreLabel||its.loc("More"),this._contentTemplate.replaceObjectUnescaped("editorial",this.data),this._contentTemplate.compose()},_applyDefaultValues:function(){its.dv14.BlockUtil.deepExtend(this.data,{align:"left",titleSize:"m",titleWeight:"normal",bodySize:"m",bodyWeight:"normal",bodyMaxLines:0},!1)},_renderImage:function(){var e=["badge"];
its.isDefined(this.data.image.useColorTint)&&!this.data.image.useColorTint&&(e=[]);
var t;
this.data.image.artworkSize?t=this.data.image.artworkSize:this.data.image.artworkProfile&&(t=its.dv14.BlockArtwork.getArtworkDimensions(this.data.image.artworkProfile));
if(t){var n=this.renderComponentStringWithData("artwork",{artworkUrls:this.data.image.artwork,classes:e,size:t,alt:this.data.image.alt||""});
n&&this._contentTemplate.replaceTokenUnescaped("artwork",n)}},_renderLinks:function(){var e;
switch(this.data.linkOrientation){case its.dv14.EditorialBlock.linkOrientation.VERTICAL:e=its.Templates.get("blocks/dv14_editorial_block/links_vertical");
break;default:e=its.Templates.get("blocks/dv14_editorial_block/links_horizontal")}var t,n,r,i=!1,s=[];
s.push("body-size-"+this.data.bodySize),this.data.linkWeight?s.push("body-weight-"+this.data.linkWeight):s.push("body-weight-"+this.data.bodyWeight),e.replaceToken("listClasses",s.join(" ")),this.data.linkColor&&(i=!0,e.replaceToken("linkColor","color:"+this.data.linkColor));
var o=e.getBlock("linkItem");
for(var u=0;
u<this.data.links.length;
u++){t=this.data.links[u];
if(t.label&&t.url){r={"data-url":t.url},i||(r["class"]="link-color");
if(t.target){var a=this._processLinkTarget(t.target);
r["data-page-target"]=a}n=its.sf14.ComponentUtil.createButton(this,t.label,its.sf14.ComponentUtil.ButtonType.LINK,r),o.replaceTokenUnescaped("link",n)}o.next()}this._contentTemplate.replaceTokenUnescaped("links",e.compose())},_processLinkTarget:function(e){switch(e){case its.dv14.EditorialBlock.LinkTarget.EXTERNAL:e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL;
break;case its.dv14.EditorialBlock.LinkTarget.ITUNES:its.dv14.Util.Client.isITunes()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;case its.dv14.EditorialBlock.LinkTarget.APPSTORE:its.dv14.Util.Client.isAppStore()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;case its.dv14.EditorialBlock.LinkTarget.IBOOKS:its.dv14.Util.Client.isIBooks()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;default:e=its.dv14.EditorialBlock.LinkTarget.SELF}return e}}),its.dv14.EditorialBlock.LinkTarget={SELF:"self",EXTERNAL:"external",ITUNES:"itunes",APPSTORE:"appstore",IBOOKS:"ibooks"},its.dv14.EditorialBlock.linkOrientation={HORIZONTAL:"horizontal",VERTICAL:"vertical"},its.dv14.GridBlock=Class.createSubclass("its.dv14.GridBlock",its.dv14.BaseBlock,{initialize:function(){this.base.apply(this,arguments),this._template=this.template(),this._gridItemWidth=null},render:function(){this._classes.push("no-borders-grid"),this._template.replaceToken("classes",this._classes.join(" ")),this._element=this._template.composeAsElement();
var e=[];
for(var t=0,n;
t<this.data.children.length;
t++)n=this.data.children[t].adamId,n&&e.push(n);
if(e.length>0){var r={profile:its.sf.StorePlatform.Profiles.LOCKUP,ids:e,onOK:function(e){this._onFetchComplete(e)}.bind(this)};
this.storePlatform.fetchContent(r)}else this._render();
return this.subscribe("multiroom_page:orientationChange",this._render.bind(this)),this.subscribe("artist_page:orientationChange",this._render.bind(this)),this.subscribe("custom_page:orientationChange",this._render.bind(this)),this._element},template:function(){return its.Templates.get("blocks/dv14_grid_block")},_onFetchComplete:function(e){this._contentMap=e,this._render()},_render:function(){this._clientOrientation=its.dv14.Util.UI.Orientation;
var e;
switch(this.data.subType){case its.dv14.GridBlock.SubType.PRODUCT:case its.dv14.GridBlock.SubType.CUSTOM_LOCKUP:e=this._renderLockupGrid();
break;case its.dv14.GridBlock.SubType.BANNER:e=this._renderBannerGrid()}this.data.maxColumns&&its.isNumber(this.data.maxColumns)&&this.data.maxColumns>0&&this.data.maxColumns<5&&this._setColumnCount(),its.isElement(e)?this._element=e:its.isString(e)&&this._element.replaceTokenWithElement("content",its.element.createDocumentFragmentFromString(e))},_setColumnCount:function(){switch(this.data.maxColumns){case 1:this._element.setAttribute("style","column-count:0;");
break;case 2:its.sf.Platform.iPhone()?this._element.setAttribute("style","column-count:2;"):this._element.setAttribute("style","column-count:1;");
break;case 3:its.sf.Platform.iPhone()&&this._clientOrientation=="portrait"?this._element.setAttribute("style","column-count:2;"):this._element.setAttribute("style","column-count:3;");
break;case 4:its.sf.Platform.iPhone()&&this._clientOrientation=="portrait"?this._element.setAttribute("style","column-count:2;"):its.sf.Platform.iPad()&&this._clientOrientation=="landscape"?this._element.setAttribute("style","column-count:4;"):this._element.setAttribute("style","column-count:3;")}},_renderLockupGrid:function(){this.data.lockupStyle=this.data.lockupStyle||{},this.data.lockupStyle.orientation=this.data.lockupStyle.orientation||its.dv14.CustomLockup.DefaultOrientation,this._element.classList.add("grid-lockup-orientation-"+this.data.lockupStyle.orientation);
var e="",t,n,r;
if(this.data.lockupStyle.orientation==its.dv14.CustomLockup.Orientation.V5)return e=this.renderComponentWithData("grid",{contentIds:this.data.children}),e;
for(var i=0;
i<this.data.children.length;
i++){n=this.data.children[i],n.subType=n.subType||this.data.childSubType;
if(!n.subType)continue;if(n.subType==its.dv14.CustomLockup.SubType.PRODUCT){if(!n.adamId)continue;t=this._contentMap[n.adamId];
if(!t)continue;n.product=t}its.isObject(this.data.lockupStyle)&&its.dv14.BlockUtil.deepExtend(n,this.data.lockupStyle,!1),its.isObject(this.data.editorialStyle)&&its.isObject(n.editorial)&&its.dv14.BlockUtil.deepExtend(n.editorial,this.data.editorialStyle,!1);
var s=this.renderComponentStringWithData("custom_lockup",n);
its.isString(s)&&(e+=s)}return e},_renderBannerGrid:function(){var e=this.data.children||[],t=its.Templates.get("blocks/dv14_grid_block/banner");
for(var n=0;
n<e.length;
n++){var r=e[n],i=this.renderComponentStringWithData("artwork",{artworkUrls:r.artwork,size:this.data.artworkSize||its.sf14.LockupUtil.getArtworkDimensions("banner",null,this.documentSize()),alt:r.altText||"",classes:["brick-art"]});
t.replaceTokenUnescaped("artwork",i),t.replaceTokenUnescaped("url",r.url),t.replaceTokenUnescaped("pageTarget",r.target);
if(r.editorial){its.isObject(this.data.editorialStyle)&&Class.extend(r.editorial,this.data.editorialStyle);
var s=this.renderComponentStringWithData("editorial_block",r.editorial);
s&&(t.keepBlock("editorialBlock",!0),t.replaceTokenUnescaped("editorial",s))}t.next()}return its.sf.Platform.iPhone()?this._element.classList.add("banner-grid-iphone"):its.sf.Platform.iPad()&&this._element.classList.add("banner-grid-ipad"),its.isString(this.data.align)&&this._element.classList.add("grid-align-"+this.data.align),t.compose()}}),its.dv14.GridBlock.SubType={PRODUCT:"product",CUSTOM_LOCKUP:"custom_lockup",BANNER:"banner"},its.dv14.MediaBlock=Class.createSubclass("its.dv14.MediaBlock",its.dv14.BaseBlock,{renderAsString:function(){this._template=this.template(),this.data.artworkSize=this._artworkSize();
var e="";
switch(this.data.subType){case its.dv14.MediaBlock.Kind.VIDEO:e=this._renderVideo();
break;case its.dv14.MediaBlock.Kind.IMAGE:e=this._renderImage()}return this._template.replaceTokenUnescaped("media",e),this._renderEditorial(),this.data.align&&this._template.replaceToken("alignment",this.data.align||"left"),this._template.compose()},_renderEditorial:function(){if(this.data.editorial){var e=its.dv14.BlockUtil.deepExtend({},this.data.editorial);
if(this.data.orientation==its.dv14.MediaBlock.Orientation.V0&&e.title){var t=this.renderComponentStringWithData("editorial_block",{title:e.title,titleColor:e.titleColor,titleWeight:e.titleWeight,align:e.align});
t&&this._template.replaceTokenUnescaped("editorialTitle",t),delete e.title}var n=this.renderComponentStringWithData("editorial_block",e);
n&&this._template.replaceTokenUnescaped("editorial",n)}},template:function(){this.data.orientation=this.data.orientation||its.dv14.MediaBlock.DefaultOrientation;
var e;
switch(this.data.orientation){case its.dv14.MediaBlock.Orientation.V0:e=its.Templates.get("blocks/dv14_media_block/orientation_v0");
break;case its.dv14.MediaBlock.Orientation.V1:e=its.Templates.get("blocks/dv14_media_block/orientation_v1");
break;case its.dv14.MediaBlock.Orientation.V2:e=its.Templates.get("blocks/dv14_media_block/orientation_v2");
break;case its.dv14.MediaBlock.Orientation.V3:e=its.Templates.get("blocks/dv14_media_block/orientation_v3");
break;case its.dv14.MediaBlock.Orientation.V4:e=its.Templates.get("blocks/dv14_media_block/orientation_v4")}return e},_artworkSize:function(){var e,t=this.data.artworkProfile||"square_1";
return this.data.artworkSize?e=this.data.artworkSize:e=its.dv14.BlockArtwork.getArtworkDimensions(t),e},_renderVideo:function(){return this._template.replaceToken("isDisabled","false"),this.renderComponentStringWithData("video",{url:this.data.url,artworkData:{artworkUrls:this.data.artwork,size:this.data.artworkSize},classes:["editorial-lockup-image"]})},_renderImage:function(){var e=!0;
return this.data.link&&(this.data.link.url&&this._template.replaceToken("url",this.data.link.url),this.data.link.target&&this._template.replaceToken("pageTarget",this.data.link.target),e=!1),this.renderComponentStringWithData("artwork",{artworkUrls:this.data.artwork,size:this.data.artworkSize,disabled:e,classes:["editorial-lockup-image"]})}}),its.dv14.MediaBlock.Orientation={V0:"v0",V1:"v1",V2:"v2",V3:"v3",V4:"v4"},its.dv14.MediaBlock.DefaultOrientation=its.dv14.MediaBlock.Orientation.V3,its.dv14.MediaBlock.Kind={VIDEO:"video",IMAGE:"image"},its.dv14.RowBlock=Class.createSubclass("its.dv14.RowBlock",its.dv14.BaseBlock,{initialize:function(){this.base.apply(this,arguments),this._template=its.Templates.get("blocks/dv14_row_block")},render:function(){return this._element=this._template.composeAsElement(),this._fetchContent(),its.sf.Platform.iPad()&&(this.subscribe("multiroom_page:orientationChange",this._render.bind(this)),this.subscribe("artist_page:orientationChange",this._render.bind(this)),this.subscribe("custom_page:orientationChange",this._render.bind(this))),this._element},_render:function(){var e="",t=its.Templates.get("blocks/dv14_row_block/column");
for(var n=0;
n<this.data.children.length;
n++){var r=this.data.children[n];
r.adamId&&(r.product=this._contentMap[r.adamId]);
var i=this.renderComponentStringWithData(r.type,r);
i&&(t.replaceToken("span",r.span||1),r.type==its.dv14.RowBlock.ChildComponent.EDITORIAL&&(i='<lockup type="shelf">'+i+"</lockup>"),t.replaceTokenUnescaped("content",i)),e+=t.compose()}this._element.replaceTokenWithElement("columns",its.element.createDocumentFragmentFromString(e))},_fetchContent:function(){var e=[];
for(var t=0,n;
t<this.data.children.length;
t++)n=this.data.children[t].adamId,n&&e.push(n);
e.length>0?this.storePlatform.fetchContent({profile:its.sf.StorePlatform.Profiles.LOCKUP,ids:e,onOK:function(e){this._contentMap=e,this._render()}.bind(this)}):this._render()}}),its.dv14.RowBlock.ChildComponent={EDITORIAL:"editorial_block",CUSTOM_LOCKUP:"custom_lockup"},its.dv14.ShelfBlock=Class.createSubclass("its.dv14.ShelfBlock",its.dv14.BaseBlock,{render:function(){var e=this._swooshType(),t=this.renderComponentWithData("swoosh",{contentIds:this.data.contentIds||[],link:this.data.link||null,rows:this.data.rows||1,scrollableCellControllerClass:e.controller,showDivider:this.data.showDivider||!1,showOrdinal:this.data.showOrdinal||!1,additionalCssClasses:["uber-title-color"],type:e.type,title:this.data.title||null});
return t},_swooshType:function(){var e=this.data.subType,t={type:its.dv14.Swoosh.Type.DEFAULT,controller:its.sf14.ScrollableCellController.Basic};
switch(e){case its.dv14.ShelfBlock.Type.LIST:t.type=its.dv14.Swoosh.Type.LIST,t.controller=its.sf14.ScrollableCellController.List;
break;case its.dv14.ShelfBlock.Type.ROOM:t.controller=its.sf14.ScrollableCellController.List.Room;
break;case its.dv14.ShelfBlock.Type.TRACK_SWOOSH:t.type=its.dv14.Swoosh.Type.LIST,t.controller=its.sf14.ScrollableCellController.List.Chart.TrackSwoosh;
break;case its.dv14.ShelfBlock.Type.APP_TRAILER:t.controller=its.sf14.ScrollableCellController.AppTrailerSwoosh}return t}}),its.dv14.ShelfBlock.Type={APP_TRAILER:"appTrailer",BASIC:"basic",LIST:"list",ROOM:"room",TRACK_SWOOSH:"trackSwoosh"},its.dv14.SpacerBlock=Class.createSubclass("its.dv14.SpacerBlock",its.dv14.BaseBlock,{render:function(){this._element=document.createElement("section");
var e=this.lookup("size")||"s";
if(its.dv14.SpacerBlock.Sizes.hasOwnProperty(e)){e=its.dv14.SpacerBlock.Sizes[e],this._renderSpacerSet(e);
var t=document.createElement("divider");
if(!this.lookup("showDivider"))t.classList.add("divider-no-border");
else{t.setAttribute("class","divider");
var n=this.lookup("dividerColor");
n&&t.setAttribute("style","border-color: "+n)}this._element.appendChild(t),this._renderSpacerSet(e)}return this._element},renderAsString:function(){var e='<divider class="divider-no-border" />';
return e},_renderSpacerSet:function(e){var t;
for(var n=0;
n<e;
n++)t=document.createElement("divider"),t.classList.add("divider-no-border"),this._element.appendChild(t)}}),its.dv14.SpacerBlock.Sizes={s:0,m:1,l:2,xl:3},its.dv14.ButtonListBlock=Class.createSubclass("its.dv14.ButtonListBlock",its.dv14.BaseBlock,{render:function(){var e,t=its.Templates.get("blocks/dv14_button_list_block/wrapper");
return this._contentTemplate=its.Templates.get("blocks/dv14_button_list_block/content"),this._applyDefaultValues(),this.data.align&&t.replaceToken("align",this.data.align),its.isArray(this.data.children)&&this.data.children.length>0&&this._renderButtonList(),e=this._contentTemplate.compose(),t.replaceTokenWithElement("content",its.element.createDocumentFragmentFromString(e)),t.composeAsElement()},_applyDefaultValues:function(){its.dv14.BlockUtil.deepExtend(this.data,{align:"left",labelSize:"m",labelWeight:"normal",orientation:"horizontal"},!1),its.sf.Platform.iPhone()&&(this.data.orientation="vertical")},_renderButtonList:function(){var e,t,n,r,i;
switch(this.data.orientation){case its.dv14.EditorialBlock.linkOrientation.VERTICAL:e=its.Templates.get("blocks/dv14_button_list_block/links_vertical");
break;default:e=its.Templates.get("blocks/dv14_button_list_block/links_horizontal")}r=e.getBlock("linkItem");
for(var s=0;
s<this.data.children.length;
s++)t=this.data.children[s],t.label&&t.url&&(i={"data-url":t.url,"class":"button-list-link caption2 bottom"},i["class"]+=" body-size-"+this.data.labelSize,this.data.tintColor?i.style="color:"+this._hex2rgba(this.data.tintColor)+";border-color:"+this._hex2rgba(this.data.tintColor):i["class"]+=" link-color",this.data.labelWeight&&(i["class"]+=" body-weight-"+this.data.labelWeight),t.target&&(i["data-page-target"]=this._processLinkTarget(t.target)),n=its.sf14.ComponentUtil.createButton(this,t.label,"buttonlist",i),r.replaceTokenUnescaped("link",n)),r.next();
this._contentTemplate.replaceTokenUnescaped("links",e.compose())},_processLinkTarget:function(e){switch(e){case its.dv14.EditorialBlock.LinkTarget.EXTERNAL:e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL;
break;case its.dv14.EditorialBlock.LinkTarget.ITUNES:its.dv14.Util.Client.isITunes()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;case its.dv14.EditorialBlock.LinkTarget.APPSTORE:its.dv14.Util.Client.isAppStore()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;case its.dv14.EditorialBlock.LinkTarget.IBOOKS:its.dv14.Util.Client.isIBooks()||(e=its.dv14.EditorialBlock.LinkTarget.EXTERNAL);
break;default:e=its.dv14.EditorialBlock.LinkTarget.SELF}return e},_hex2rgba:function(e,t){var n=t||1,r=parseInt(e,16),i=(r&16711680)>>16,s=(r&65280)>>8,o=r&255;
return"rgba("+i+","+s+","+o+", "+n+")"}}),its.dv14.ButtonListBlock.LinkTarget={SELF:"self",EXTERNAL:"external",ITUNES:"itunes",APPSTORE:"appstore",IBOOKS:"ibooks"},its.dv14.ButtonListBlock.linkOrientation={HORIZONTAL:"horizontal",VERTICAL:"vertical"},its.dv14.PodcastReportingUtil={init:function(){if(!this.didInit&&window.itms&&typeof itms.getBag=="function"){var e=itms.getBag();
this.reportBrowseUrl=e["podcast-dzc-browse-url"],this.reportDownloadUrl=e["podcast-dzc-download-url"],this.didInit=!0}},reportBrowse:function(e,t,n){return this.init(),e=typeof e=="object"?e:{},e.v=e.v||3,typeof this.reportBrowseUrl=="string"?this.request(this.reportBrowseUrl,e,t,n):console.error("its.dv14.PodcastReportingUtil.reportBrowse - Could not find `podcast-dzc-browse-url` in the bag."),e},reportDownload:function(e,t,n){return this.init(),e=typeof e=="object"?e:{},e.pageLocation=e.pageLocation||"epdl",e.v=e.v||3,typeof this.reportDownloadUrl=="string"?this.request(this.reportDownloadUrl,e,t,n):console.error("its.dv14.PodcastReportingUtil.reportDownload - Could not find `podcast-dzc-download-url` in the bag."),e},request:function(e,t,n,r){var i=window.itms&&itms.makeStoreXMLHttpRequest();
i?(i.onreadystatechange=function(){i.readyState===4&&(i.status===200?typeof n=="function"&&n(i):typeof r=="function"&&r(i))},e=its.url.appendUrlParameters(e,t),i.open("GET",e,!0),i.send(null)):console.error("its.dv14.PodcastReportingUtil.request - `itms` is not defined")}},its.dv14.PodcastTrackUtil={getTrack:function(e){var t=3e3,n=3e3,r="jpg",i=JSON.parse(JSON.stringify(e));
i.artwork instanceof Array||(i.artwork=[i.artwork]);
var s=i.artwork[0];
return s&&/\{[whf]\}/.test(s.url)&&(s.url=s.url.replace("{w}",t).replace("{h}",n).replace("{f}",r)),i}}