!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){var r,i;if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;if(r=Object.create(null),t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,n){"use strict";(function(e){function r(){return 0===d.nameStack.length?["<empty stack>"]:d.nameStack.slice(0)}function i(e){(function(e){return e&&e.hasOwnProperty("$incidents")})(e)&&(e.$incidents=d.incidents),d.incidents=[],d.nameStack=[],d.suppressedIncidentPaths=[]}function o(){for(const t of Object.keys(e.services)){const n=e.services[t];for(const e of Object.keys(n)){const t=n[e];t instanceof Function&&(n[e]=function(...e){const n=t.apply(this,e);return n instanceof Promise?n.then(e=>(i(e),e)):(i(n),n)})}}}function a(e,t,n){let r=null;n&&(r=e,d.suppressedIncidentPaths.push(n));let i=null;try{!function(e){d.nameStack.push(e)}(e),i=t()}catch(e){throw e.hasThrown||(u("defaultValue","no exception",e.message),e.hasThrown=!0),e}finally{e===r&&d.suppressedIncidentPaths.pop(),0===d.nameStack.length&&console.warn("endContext() called without active validation context, ignoring"),d.nameStack.pop()}return i}function s(e,t,n){let r=null;try{r=a(e,t)}catch(e){r=null,n&&(r=n(e))}return r}function l(e){-1===d.suppressedIncidentPaths.indexOf(e.objectPath)&&d.incidents.push(e)}function c(e,t,n){l({type:"nullValue",expected:t,actual:"null",objectPath:n||"<this>",contextNames:r(),recoveryAction:e})}function u(e,t,n,i){var o;l({type:"badType",expected:t,actual:`${o=n,Array.isArray(o)?"array":null===o?"null":typeof o} (${n})`,objectPath:i||"<this>",contextNames:r(),recoveryAction:e})}n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return u}));const d={nameStack:[],incidents:[],suppressedIncidentPaths:[]}}).call(this,n(9))},,function(e,t,n){e.exports=n(4),e.exports.hbsHelper=n(7)},,function(e,t,n){e.exports.its={},n(5)(e.exports),n(6)(e.exports)},function(e,t){e.exports=function(e){var t=e.its;t.isDefined=function(e){return void 0!==e},void 0===t.string&&(t.string={}),t.string.replace=function(e,t,n){return e?("string"!=typeof e&&(e+=""),e.split(t).join(n)):e}}},function(e,t){e.exports=function(e){var t=e.its,n=e.iTSLocalization={};n._strings={},n.hasLocalizedValue=function(e){var r=n._strings[e];return t.isDefined(r)},n.isLocalized=function(e){var r=n._strings[e];return!(!t.isDefined(r)||-1!==e.indexOf(".")&&(r===e||0===r.indexOf("**")&&r.lastIndexOf("**")===r.length-2)&&(console.error("unlocalized key in keys dictionary",e),1))},t.loc=function(e,t){var r=n._strings[e];return void 0===r&&(r=e),t&&(r=n.replaceTokens(r,t)),"undefined"==typeof itms&&(r=n.replaceMarkupTokens(r,t)),r},t.locDate=function(e){var t,n,r,i,o;return e?((t=e.length)>10?n=new Date(e):(r=t>=4?e.slice(0,4):0,i=t>=7?e.slice(5,7):1,o=t>=10?e.slice(8,10):1,n=new Date(r,i-1,o)),formatDate(n)):""},t.locWithMarkupTokens=function(e,r){return n.replaceMarkupTokens(t.loc(e,r),r)},n._strings._showLocKeys&&(t.loc=function(e){return"+"+e+"+"}),t.locWithCount=function(e,r,i){var o,a,s=null;return 0==r&&(o=e+".zero",n.isLocalized(o)&&(s=o)),null===s&&(s=e,"other"!==(a=n.pluralCategory(r))&&(o=e+"."+a,n.isLocalized(o)&&(s=o))),i||(i={}),t.isDefined(i.count)||(i.count=t.formatNumber(r)),t.isDefined(i.number)||(i.number=t.formatNumber(r)),t.loc(s,i)},n.replaceTokens=function(e,n){var r,i;if(n)for(r in n)n.hasOwnProperty(r)&&(i="@@"+r+"@@",e=t.string.replace(e,i,n[r]));return e},n.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"?"},n.replaceMarkupTokens=function(e,t){var r,i,o;if(e.indexOf("##")>-1){if(t)for(r in t)n.markupParams[r.toString()]=t[r];for(i in n.markupParams)o="##"+i+"##",e=e.replace(new RegExp(o,"gi"),n.markupParams[i]);e=e.replace(/##([^##]+)##/gi,"<$1>")}return e},n.localizedResourceUrlForPathKey=function(e,n){return void 0===n&&(n=/https:/.test(window.location.protocol)),(n?"https://s.mzstatic.com":"http://r.mzstatic.com")+t.loc(e)},"undefined"!=typeof itms&&"undefined"!=typeof formatNumber?t.formatNumber=function(e){return formatNumber(Number(e))}:t.formatNumber=function(e){var t,r,i,o,a;for(void 0===n.decimalSeparator&&(void 0===(t=n._strings._decimalSeparator)&&(t="."),n.decimalSeparator=t,void 0===(t=n._strings._thousandsSeparator)&&(t=","),n.thousandsSeparator=t),r=parseFloat(e).toString().split("."),i=n.thousandsSeparator,a=(o=r[0].split("")).length-3;a>0;a-=3)o.splice(a,0,i);return r[0]=o.join(""),r.join(n.decimalSeparator)},n._pluralCategoryDefault=function(e){return"other"},n._pluralCategoryOne=function(e){return 1==e?"one":"other"},n._pluralCategoryArabic=function(e){var t,n=e>>0;return n!=e?"other":0===n?"zero":1===n?"one":2===n?"two":(t=n%100)>=11?"many":t>=3?"few":"other"},n._pluralCategoryFrench=function(e){return e<2&&e>=0?"one":"other"},n._pluralCategoryHebrew=function(e){var t=e>>0;return t!=e?"other":1===t?"one":2===t?"two":0==t%10&&t>10?"many":"other"},n._pluralCategoryPolish=function(e){var t,n,r=e>>0;return r!=e?"other":1===r?"one":(t=r%10)<=4&&t>=2&&((n=r%100)>14||n<12)?"few":"many"},n._pluralCategoryRomanian=function(e){var t,n=e>>0;return n!=e?"few":0===n?"few":1===n?"one":(t=e%100)<=19&&t>=1?"few":"other"},n._pluralCategoryRussian=function(e){var t,n,r=e>>0;return r!=e?"other":(t=r%10)>=5||0==t?"many":(n=r%100)<=14&&n>=11?"many":1==t?"one":"few"},n._pluralCategoryFnByLanguage={zh:n._pluralCategoryDefault,id:n._pluralCategoryDefault,ja:n._pluralCategoryDefault,ko:n._pluralCategoryDefault,ms:n._pluralCategoryDefault,th:n._pluralCategoryDefault,vi:n._pluralCategoryDefault,en:n._pluralCategoryOne,ca:n._pluralCategoryOne,da:n._pluralCategoryOne,nl:n._pluralCategoryOne,de:n._pluralCategoryOne,el:n._pluralCategoryOne,fi:n._pluralCategoryOne,hu:n._pluralCategoryOne,it:n._pluralCategoryOne,nb:n._pluralCategoryOne,no:n._pluralCategoryOne,pt:n._pluralCategoryOne,es:n._pluralCategoryOne,sv:n._pluralCategoryOne,tr:n._pluralCategoryOne,ar:n._pluralCategoryArabic,fr:n._pluralCategoryFrench,iw:n._pluralCategoryHebrew,pl:n._pluralCategoryPolish,ro:n._pluralCategoryRomanian,ru:n._pluralCategoryRussian},n.pluralCategory=function(e){var r,i,o;return t.serverData&&t.serverData.constants?r=t.serverData.constants.languageCode:"undefined"!=typeof itms&&itms.getBag&&(r=(r=(i=itms.getBag())&&i.language||"en").slice(0,2)),(o=n._pluralCategoryFnByLanguage[r])?o(e):(console.warn("missing plural category function for: "+r),"other")},t.updateLocale=function(e){n._strings=e}}},function(e,t,n){e.exports=function(e,t){return n(8).its.loc(e,t)},"undefined"!=typeof Handlebars&&Handlebars.registerHelper("loc",helper)},function(e,t){window.iTSLocalization||(iTSLocalization={}),window.iTSLocalization._strings||(iTSLocalization._strings={}),iTSLocalization.hasLocalizedValue=function(e){var t=iTSLocalization._strings[e];return its.isDefined(t)},its.loc=function(e,t){var n=iTSLocalization._strings[e];return void 0===n&&(n=e),t&&(n=iTSLocalization.replaceTokens(n,t)),"undefined"==typeof itms&&(n=iTSLocalization.replaceMarkupTokens(n,t)),n},its.locDate=function(e){var t,n,r,i,o;return e?((t=e.length)>10?n=new Date(e):(r=t>=4?e.slice(0,4):0,i=t>=7?e.slice(5,7):1,o=t>=10?e.slice(8,10):1,n=new Date(r,i-1,o)),formatDate(n)):""},its.locWithMarkupTokens=function(e,t){return iTSLocalization.replaceMarkupTokens(its.loc(e,t),t)},iTSLocalization._strings._showLocKeys&&(its.loc=function(e){return"+"+e+"+"}),its.locWithCount=function(e,t,n){var r,i,o=null;return 0==t&&(r=e+".zero",iTSLocalization.hasLocalizedValue(r)&&(o=r)),null===o&&(o=e,"other"!==(i=iTSLocalization.pluralCategory(t))&&(r=e+"."+i,iTSLocalization.hasLocalizedValue(r)&&(o=r))),n||(n={}),its.isDefined(n.count)||(n.count=its.formatNumber(t)),its.loc(o,n)},iTSLocalization.replaceTokens=function(e,t){var n,r;if(t)for(n in t)t.hasOwnProperty(n)&&(r="@@"+n+"@@",e=its.string.replace(e,r,t[n]));return e},iTSLocalization.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"?"},iTSLocalization.replaceMarkupTokens=function(e,t){var n,r,i;if(e.indexOf("##")>-1){if(t)for(n in t)iTSLocalization.markupParams[n.toString()]=t[n];for(r in iTSLocalization.markupParams)i="##"+r+"##",e=e.replace(new RegExp(i,"gi"),iTSLocalization.markupParams[r]);e=e.replace(/##([^##]+)##/gi,"<$1>")}return e},iTSLocalization.localizedResourceUrlForPathKey=function(e,t){return void 0===t&&(t=/https:/.test(window.location.protocol)),(t?"https://s.mzstatic.com":"http://r.mzstatic.com")+its.loc(e)},"undefined"!=typeof itms&&"undefined"!=typeof formatNumber?its.formatNumber=function(e){return formatNumber(Number(e))}:its.formatNumber=function(e){var t,n,r,i,o;for(void 0===iTSLocalization.decimalSeparator&&(void 0===(t=iTSLocalization._strings._decimalSeparator)&&(t="."),iTSLocalization.decimalSeparator=t,void 0===(t=iTSLocalization._strings._thousandsSeparator)&&(t=","),iTSLocalization.thousandsSeparator=t),n=parseFloat(e).toString().split("."),r=iTSLocalization.thousandsSeparator,o=(i=n[0].split("")).length-3;o>0;o-=3)i.splice(o,0,r);return n[0]=i.join(""),n.join(iTSLocalization.decimalSeparator)},iTSLocalization._pluralCategoryDefault=function(e){return"other"},iTSLocalization._pluralCategoryOne=function(e){return 1==e?"one":"other"},iTSLocalization._pluralCategoryArabic=function(e){var t,n=e>>0;return n!=e?"other":0===n?"zero":1===n?"one":2===n?"two":(t=n%100)>=11?"many":t>=3?"few":"other"},iTSLocalization._pluralCategoryFrench=function(e){return e<2&&e>=0?"one":"other"},iTSLocalization._pluralCategoryHebrew=function(e){var t=e>>0;return t!=e?"other":1===t?"one":2===t?"two":0==t%10&&t>10?"many":"other"},iTSLocalization._pluralCategoryPolish=function(e){var t,n,r=e>>0;return r!=e?"other":1===r?"one":(t=r%10)<=4&&t>=2&&((n=r%100)>14||n<12)?"few":"many"},iTSLocalization._pluralCategoryRomanian=function(e){var t,n=e>>0;return n!=e?"few":0===n?"few":1===n?"one":(t=e%100)<=19&&t>=1?"few":"other"},iTSLocalization._pluralCategoryRussian=function(e){var t,n,r=e>>0;return r!=e?"other":(t=r%10)>=5||0==t?"many":(n=r%100)<=14&&n>=11?"many":1==t?"one":"few"},iTSLocalization._pluralCategoryFnByLanguage={zh:iTSLocalization._pluralCategoryDefault,id:iTSLocalization._pluralCategoryDefault,ja:iTSLocalization._pluralCategoryDefault,ko:iTSLocalization._pluralCategoryDefault,ms:iTSLocalization._pluralCategoryDefault,th:iTSLocalization._pluralCategoryDefault,vi:iTSLocalization._pluralCategoryDefault,en:iTSLocalization._pluralCategoryOne,ca:iTSLocalization._pluralCategoryOne,da:iTSLocalization._pluralCategoryOne,nl:iTSLocalization._pluralCategoryOne,de:iTSLocalization._pluralCategoryOne,el:iTSLocalization._pluralCategoryOne,fi:iTSLocalization._pluralCategoryOne,hu:iTSLocalization._pluralCategoryOne,it:iTSLocalization._pluralCategoryOne,nb:iTSLocalization._pluralCategoryOne,no:iTSLocalization._pluralCategoryOne,pt:iTSLocalization._pluralCategoryOne,es:iTSLocalization._pluralCategoryOne,sv:iTSLocalization._pluralCategoryOne,tr:iTSLocalization._pluralCategoryOne,ar:iTSLocalization._pluralCategoryArabic,fr:iTSLocalization._pluralCategoryFrench,iw:iTSLocalization._pluralCategoryHebrew,pl:iTSLocalization._pluralCategoryPolish,ro:iTSLocalization._pluralCategoryRomanian,ru:iTSLocalization._pluralCategoryRussian},iTSLocalization.pluralCategory=function(e){var t;if(its.serverData&&its.serverData.constants){if(t=iTSLocalization._pluralCategoryFnByLanguage[its.serverData.constants.languageCode])return t(e);its.Logger&&its.Logger.named("its-base-util").error("missing plural category function for: "+its.serverData.constants.languageCode,!0)}return"other"}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){return o(e)?null:Array.isArray(e)?e.join("."):e}function i(e,t,n){if(null==e)return n;if(!t)return e;let r;if("string"==typeof t){if(r=_s[t],!r){if(!t.includes(".")){const r=e[t];return null!=r?r:n}r=t.split("."),_s[t]=r}}else r=t;let i=e;for(const e of r)if(i=i[e],null==i)return n;return i}function o(e){return null==e}function a(e){return o(e)||0===Object.keys(e).length}function s(e){return null!=e}function l(e){return s(e)&&0!==Object.keys(e).length}function c(e){if(o(e))return!1;let t;return t="string"==typeof e?parseInt(e):e,!Number.isNaN(t)}function u(e,t){const n=i(e,t,null);return Array.isArray(n)?n:(o(n)||Is.c("asArrayOrEmpty",()=>{Is.e("defaultValue","array",n,r(t))}),[])}function d(e,t){const n=i(e,t,null);return"boolean"==typeof n?n:(o(n)||Is.c("asBooleanOrFalse",()=>{Is.e("defaultValue","boolean",n,r(t))}),!1)}function p(e,t,n="coercible"){const a=i(e,t,null);if(o(a)||"string"==typeof a)return a;{const e="object"==typeof a?null:String(a);switch(n){case"strict":Is.c("asString",()=>{Is.e("coercedValue","string",a,r(t))});break;case"coercible":o(e)&&Is.c("asString",()=>{Is.e("coercedValue","string",a,r(t))})}return e}}function f(e,t,n="coercible"){const a=i(e,t,null);if(o(a)||"number"==typeof a)return a;{const e=Number(a);switch(n){case"strict":Is.c("asNumber",()=>{Is.e("coercedValue","number",a,r(t))});break;case"coercible":if(isNaN(e))return Is.c("asNumber",()=>{Is.e("coercedValue","number",a,r(t))}),null}return e}}function h(e,t,n){const a=i(e,t,null);return a instanceof Object&&!Array.isArray(a)?a:(o(a)||Is.c("asDictionary",()=>{Is.e("defaultValue","object",a,r(t))}),s(n)?n:null)}function m(e,t,n){return h(e,t,n)}function g(e,t,n="coercible"){const a=i(e,t,null);if(o(a))return null;if("boolean"==typeof a)return a;if("string"==typeof a){if("true"===a)return!0;if("false"===a)return!1}const s=Boolean(a);switch(n){case"strict":Is.c("asBoolean",()=>{Is.e("coercedValue","number",a,r(t))});break;case"coercible":if(o(s))return Is.c("asBoolean",()=>{Is.e("coercedValue","number",a,r(t))}),null}return s}function y(e){const t=i(Ds,e);return void 0!==t?Boolean(t):"undefined"!=typeof ask&&Boolean(Ds.clientFeatures[e])}function w(e){return h(Ds,e)}function T(e){return p(Ds,e)}function A(e){return Js.deviceHasCapabilities(e)}function I(e,t,n){return!!Js.isActivePairedWatchSystemVersionAtLeastMajorVersionMinorVersionPatchVersion&&Js.isActivePairedWatchSystemVersionAtLeastMajorVersionMinorVersionPatchVersion(e,t,n)}function b(e){return!Js.isPairedSystemVersionAtLeast||Js.isPairedSystemVersionAtLeast(e)}function k(e){if(!S()||!Js.isActivePairedWatchSystemVersionAtLeastMajorVersionMinorVersionPatchVersion)return!1;const t=e.split(".");return!I(f(t[0])||0,f(t[1])||0,f(t[2])||0)}function S(){return"watch"!==ol&&void 0!==yl}function P(e,t){let n=Sl[e];if(!n)if(n=Al.string(e),n&&n!==e)Sl[e]=n;else{const r=As.its.loc(e);n=r!==e?r:t||e}return n}function C(e,t,n){let r=Al.stringWithCount(e,t);if(!r||r===e){const i=As.its.locWithCount(e,t,n);i&&(r=i)}return r}function v(e,t,n){return Al.stringWithCounts?Al.stringWithCounts(e,t):null}function E(e,t){let n=Al.decimal(e,t);return n||(n="number"==typeof e?`* ${e.toString()} *`:"* null *"),n}function O(e){let t=Al.fileSize(e);return t||(t="* null *"),t}function R(e){let t=Al.formattedCount?Al.formattedCount(e):null;return t||(t="* null *"),t}function _(e){let t=Al.timeAgo(e);return t||(t="* null *"),t}function D(e,t){let n=Al.formatDate(e,t);return n||(n="* null *"),n}function L(e,t,n){let r=Al.formatDateInSentence(e,t,n);return r||(r="* null *"),r}function F(e,t){x(e)||(wl=e,As.its.updateLocale(t))}function x(e){return wl===e}function N(e){return function(){if(Tl)return console.log("Same Promise"),Tl;if(void 0===bs.language||null===bs.language)return Promise.reject(new Error("Bag language is not available. Unable to load localizations."));{const e=function(e,t){if(null==e)return null;switch(e=e.toLocaleLowerCase()){case"yue-hant":{const e=T("macauStorefrontIdentifier");return"string"==typeof t&&-1!==t.indexOf(e)?"zh-ma":"zh-hk"}default:return e}}(bs.language,ul),t=`local/${e}`;if(!x(t)){const n=w(`localizations.${e}`);if(null!=n)F(t,n);else{const e=w("localizations.en-us");null!=e&&F(t,e)}}return new Promise((e,t)=>{e()})}}().then(t=>e())}function U(e,t,n){const r=e.indexOf(t);let i,o=e;if(-1!==r){const a=e.slice(0,r),s=e.slice(r+t.length,e.length);"prefix"===n?(i=a,o=s):(i=s,o=a)}return{result:i,remainder:o}}function M(e){const t=l(e.href)?e.href:function(e){switch(e){case"personalization-data":case"reviews":return`/v1/${B(e)}/`;default:return`/v1/${B(e)}/${bs.mediaCountryCode}/`}}(e.resourceType),n=new xl(t);if(l(e.resourceType))for(const t of function(e){switch(e.resourceType){case"eula":return[e.resourceType,e.targetResourceType];case"landing":return["search",e.resourceType,e.targetResourceType];case"user-reviews":return["apps"];case"reviews":return["reviews","apps"];case"multiplex":return["multiplex"];case"upsell":return[e.resourceType,"editorial-items"];case"upsellMarketingItem":return["upsell","marketing-items"];case"trending-contents":return["search",e.resourceType];default:return[e.resourceType]}}(e))n.append("pathname",t);if(e.ids.size>1)n.param("ids",Array.from(e.ids).join(","));else if(1===e.ids.size){const t=e.ids.values().next().value;n.append("pathname",t)}const r=function(e){switch(e){case"user-reviews":return"reviews";default:return null}}(e.resourceType);if(l(r)&&n.append("pathname",r),n.param("platform",e.platform),e.additionalPlatforms.size>0&&n.param("additionalPlatforms",Array.from(e.additionalPlatforms).sort().join(",")),e.attributeIncludes.size>0&&n.param("extend",Array.from(e.attributeIncludes).sort().join(",")),e.relationshipIncludes.size>0&&n.param("include",Array.from(e.relationshipIncludes).sort().join(",")),s(e.scopedRelationshipIncludes))for(const t of e.scopedRelationshipIncludes.keys()){const r=e.scopedRelationshipIncludes.get(t);n.param(`include[${t}]`,Array.from(r).sort().join(","))}if(s(e.metaIncludes))for(const t of e.metaIncludes.keys()){const r=e.metaIncludes.get(t);n.param(`meta[${t}]`,Array.from(r).sort().join(","))}l(e.fields)&&(e.fields.sort(),n.param("fields",e.fields.join(","))),s(e.limit)&&e.limit>0&&n.param("limit",`${e.limit}`),s(e.sparseLimit)&&e.sparseLimit>0&&n.param("sparseLimit",`${e.sparseLimit}`);for(const t of Object.keys(e.relationshipLimits).sort()){const r=e.relationshipLimits[t];n.param(`limit[${t}]`,`${r}`)}l(e.additionalQuery)&&n.append("query",e.additionalQuery),l(e.searchTerm)&&(n.append("pathname","search"),n.param("bubble[search]",e.searchTypes.join(",")),n.param("term",e.searchTerm)),l(e.context)&&n.param("contexts",e.context),l(e.filterType)&&l(e.filterValue)&&n.param(`filter[${e.filterType}]`,e.filterValue);const i=bs.mediaApiLanguage;return o(i)||n.param("l",i),n.host=function(e,t){const n=e.pathname;let r=null;return r=t.isStorePreviewRequest?bs.mediaPreviewHost:n.includes("search/landing")?-1!==bs.edgeEndpoints.indexOf("landing")?bs.mediaEdgeHost:bs.mediaHost:bs.edgeEndpoints.map(e=>n.includes(e)).reduce(Nl,!1)?n.includes("search")?bs.mediaEdgeSearchHost:bs.mediaEdgeHost:bs.mediaHost,o(r)&&(r="api.apps.apple.com"),r}(n,e),n.protocol="https",n}function B(e){switch(e){case"apps":case"arcade-apps":case"app-bundles":case"charts":case"contents":case"developers":case"eula":case"in-apps":case"multiple-system-operators":case"user-reviews":return"catalog";case"categories":case"editorial-items":case"editorial-elements":case"groupings":case"multiplex":case"multirooms":case"rooms":case"today":return"editorial";case"ratings":return"ratings";case"personalization-data":case"reviews":return"me";case"upsell":case"upsellMarketingItem":case"landing":return"engagement";default:return"catalog"}}function $(e,t){const n=M(e).toString();return mediaToken.refreshToken().then(e=>(function e(t,n,r={},i=!1){const o=new xl(t),a=V(o);for(const e of a)o.removeParam(e);let c=r.headers;return c||(c={}),c.Authorization="Bearer "+n,net.fetch({url:t,headers:c,method:r.method,body:r.requestBodyString,timeout:r.timeout}).then(n=>{try{if(401===n.status||403===n.status){if(i)throw Error("We refreshed the token but we still get 401 from the API");return mediaToken.resetToken(),mediaToken.refreshToken().then(n=>e(t,n,r,!0))}if(404===n.status)q();else if(!n.ok){const e=new Ul(`Bad Status code ${n.status} for ${t}`);throw e.statusCode=n.status,e}const o=Date.now(),a=JSON.parse(n.body),c=Date.now();if(a){if(a[ks.pageInformation]=function(e){const t=ul;let n=null;if(l(t)){const e=t.split("-");l(e)&&(n=e[0])}return{serverInstance:e.headers[Ml],storeFrontHeader:t,language:bs.language,storeFront:n,environmentDataCenter:e.headers[Bl]}}(n),n.metrics.length>0){const e=n.metrics[0];e.parseStartTime=o,e.parseEndTime=c,a[ks.timingValues]=e}else{const e={pageURL:n.url,parseStartTime:o,parseEndTime:c};a[ks.timingValues]=e}Array.isArray(a.data)&&function(e){return s(e)&&0===e.length}(a.data)&&q()}return a[ks.requestedUrl]=t,a}catch(e){if(e instanceof Ul)throw e;throw new Error(`Error Fetching: ${t}, ${e.name}, ${e.message}`)}})})(n,e,t)).then(t=>(e.canonicalUrl&&(t[ks.requestedUrl]=e.canonicalUrl),t))}function V(e){return bs.redirectUrlWhitelistedQueryParams.filter(t=>s(e.query[t]))}function q(){const e=new Ul("No content");throw e.statusCode=204,e}function G(e,t,n=!0){const r=H(e,t);return!!r&&!(!r.data||n&&0===r.data.length)}function H(e,t){return m(e.relationships,t)}function j(e,t){const n=u(e.relationships,[t,"data"]);return 0===n.length?null:(n.length>1&&(console.warn(`there was an array of relationships when only the first was asked for in relationship ${t}`),console.log(JSON.stringify(e))),n[0])}function W(e,t){return u(e.relationships,[t,"data"])}function z(e){if(!e)return null;const t=$l.exec(e);return null===t||4!==t.length?null:{red:parseInt(t[1],16)/255,green:parseInt(t[2],16)/255,blue:parseInt(t[3],16)/255,type:"rgb"}}function Y(e,t=84){switch(e.type){case"rgb":return 100*(.2126*(n=e).red+.7152*n.green+.0722*n.blue)<t;case"named":return function(e){switch(e.name){case"black":return!0;default:return!1}}(e);default:return!1}var n}function K(e){return{name:e,type:"named"}}function Q(e,t){return{lightColor:e,darkColor:t,type:"dynamic"}}function J(e,t,n){return e?Is.c(t,()=>{let r=e[Vl],o=null;return r?(o=i(r,t),o||(o=X(r,t,n))):(r={},e[Vl]=r,o=X(r,t,n)),o}):null}function X(e,t,n){const r=n();return e[t]=r,r}function Z(e){return s(ql.cookieForUrlWithName)?function(e,t){return Is.c("currentExperimentGroup",()=>{if(!t||!t.value||0===t.value.length)return null;const n=t.value.replace(/^\d+#/,"").split("#").map(e=>e.replace(/^(.*\+)/,"")).filter(t=>{const n=t.slice(0,-1);return e.identifer===n});if(0===n.length)return null;n.length>1&&Is.e("ignoredValue","string",n,`${t.name} cookie`);const r=n[0].match(/\d$/);if(null===r||0===r.length)return Is.e("ignoredValue",e.treatments.join("|"),r[0],`${t.name} cookie, ${n}, treatment id`),null;const i=Number(r[0]),o=e.treatments.find(e=>e===i)||null;return o||Is.e("ignoredValue",e.treatments.join("|"),i,`${t.name} cookie, ${n}, treatment id`),o})}(e,ql.cookieForUrlWithName("https://apple.com","xp_ab")):null}function ee(e,t,n){return o(e)?null:h(e.attributes,t,n)}function te(e,t){return o(e)?[]:u(e.attributes,t)}function ne(e,t,n="coercible"){return o(e)?null:p(e.attributes,t,n)}function re(e,t,n="coercible"){return o(e)?null:g(e.attributes,t,n)}function ie(e,t){return!o(e)&&d(e.attributes,t)}function oe(e,t,n="coercible"){return o(e)?null:f(e.attributes,t,n)}function ae(e){return!o(h(e,"attributes"))}function se(e,t){return i(ee(e,"platformAttributes"),t)}function le(e,t){return l(se(e,t))}function ce(e,t,n){const r=se(e,t);return o(r)?null:h(r,n)}function ue(e,t,n,r="coercible"){const i=se(e,t);return o(i)?null:p(i,n,r)}function de(e,t,n=!1){return J(e,`dataHasDeviceFamily.${t}`,()=>!(!e||!t)&&-1!==he(e,n).indexOf(t))}function pe(e,t,n=!1){return de(e,t,n)&&1===he(e,n).length}function fe(e,t,n=!1){const r=new Set(he(e,n));return t.length===r.size&&t.every(e=>r.has(e))}function he(e,t=!1){const n=te(e,"deviceFamilies");if(0===n.length&&t){const n=W(e,"apps");for(const e of n){const n=he(e,t);if(l(n))return n}}return n}function me(e,t,n,r){n||(n=Ae(e));let i=ce(e,n,t);return i||(i=ee(e,t,r)),i}function ge(e,t){let n=function(e,t,n){const r=se(e,t);return o(r)?[]:u(r,n)}(e,Ae(e),t);return a(n)&&(n=te(e,t)),n}function ye(e,t,n="coercible"){let r=ue(e,Ae(e),t,n);return r||(r=ne(e,t,n)),r}function we(e,t,n){n||(n=Ae(e));let r=function(e,t,n){const r=se(e,t);return!o(r)&&d(r,n)}(e,n,t);return r||(r=ie(e,t)),r}function Te(e,t,n="coercible"){let r=function(e,t,n,r="coercible"){const i=se(e,t);return o(i)?null:f(i,n,r)}(e,Ae(e),t,n);return o(r)&&(r=oe(e,t)),r}function Ae(e){return J(e,"bestAttributePlatformFromData",()=>{const t=fe(e,["iphone","ipad","ipod"],!0),n=pe(e,"tvos"),r=pe(e,"mac"),i=pe(e,"watch");let a=null;if(n?a="appletvos":r?a="osx":t?a="ios":i&&(a="watch"),!o(a))return a;const s=function(){const e=Ie();switch(e){case"ios":return["ios","appletvos","osx"];case"osx":return["osx","ios","appletvos"];case"appletvos":return["appletvos","ios","osx"];case"watch":return["ios","watch","osx"];default:return[e]}}();for(const t of s)if(le(e,t))return t;return Ie()})}function Ie(){switch(ol){case"phone":case"pad":return"ios";case"tv":return"appletvos";case"mac":return"osx";case"watch":return"watch";default:return null}}function be(e,t,n){const r={};return Object.assign(r,n),r.eventType="click",r.targetType=t,r.targetId=e,new Wl(r,["impressionsSnapshot","pageFields"])}function ke(e,t,n,r,i){const o={};return Object.assign(o,i),o.term=e,o.targetType=t,o.actionType=n,o.actionUrl=r,o.eventType="search",new Wl(o,["pageReferrer"])}function Se(e,t){const n={};let r;return Object.assign(n,e),n.eventType="impressions",n.impressionQueue="data-metrics",n.eventVersion=4,r=t?["impressions","pageFields","pageReferrer","advertRotation"]:["impressions","pageFields","pageReferrer"],new Wl(n,r)}function Pe(e){switch(e){case"arcadeGroupingLockup":case"arcadeProductPage":case"productPage":case"groupingLockup":return!0;default:return!1}}function Ce(e){return a(e)?null:(-1!==e.indexOf("T")&&(e=e.split("T")[0]),new Date(e.replace(/-/g,"/")))}function ve(e){const t=function(e){return o(e)?null:new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}(e);return o(t)?null:t.getTime()}function Ee(e){if(null==e)return e;const t=Object.create(Object.getPrototypeOf(e));return Object.assign(t,e),t}function Oe(e,t){return e instanceof t}function Re(e,t=null){switch(e){case"mac":return function(e){let t="x-apple.systempreferences:com.apple.preferences.softwareupdate?client=AppStore&variant=CUSTOMER";return e&&(t+=`&installMajorOSBundle=${e}`),t}(t);default:return null}}function _e(e,t=14334){let n=!1;return 2&t&&(n=n||function(e){return"watch"!==ol&&(we(e,"is32bitOnly")||we(e,"requires32bit"))}(e)),4&t&&(n=n||function(e){return J(e,"shouldFilterDeletableSystemApp",()=>{switch(ye(e,"bundleId")){case"com.apple.NanoSleep":case"com.apple.findmy":return!0}if(!Ss.isDeletableSystemAppFromData(e))return!1;const t=Ss.bundleIdFromData(e),n=host.deviceModel,r=n.startsWith("iPhone"),i=n.startsWith("iPad");let o;switch(o=!!pa("12.3")||bs.isTVAppEnabled,t){case"com.apple.compass":case"com.apple.Bridge":return!r;case"com.apple.calculator":case"com.apple.weather":return i;case"com.apple.Photo-Booth":return!i;case"com.apple.tv":return!o;case"com.apple.videos":return o;case"com.apple.iCloudDriveApp":return!0;case"com.apple.facetime":return!A(["any-telephony"])||!A(["venice"]);case"com.apple.Fitness":return"pad"===ol||!fl;case"com.apple.measure":return!A(["arkit"]);case"com.apple.Jellyfish":return!A(["front-depth-camera"]);case"is.workflow.my.app":case"com.apple.mobileme.fmf1":return!0;case"com.apple.NanoHeartRhythm":return!!y("ECG")&&!hl;case"com.apple.NanoCompass.watchkitapp":return A(["magnetometer"]);case"com.apple.Translate":return!0}return!1})}(e)),8&t&&(n=n||function(e){return J(e,"shouldFilterUnsupportedWatchAppOnWatchClient",()=>{const t=we(e,"isAppleWatchSupported"),n="app-bundles"===e.type;return host.clientIdentifier===Zs&&!t&&!n})}(e)),16&t&&(n=n||function(e){return"in-apps"===e.type&&!ie(e,"isMerchandisedEnabled")}(e)),32&t&&(n=n||function(e){return J(e,"shouldFilterLegacyApps",()=>{const t=ye(e,"bundleId");if("phone"===ol||"pad"===ol)switch(t){case"com.apple.mobileme.fmip1":case"is.workflow.my.app":return!0}if("watch"===ol)switch(t){case"com.apple.mobileme.fmf1":return!0}if("mac"===ol)switch(t){case"com.apple.FaceTime":return!0;case"com.apple.InstallAssistant.Seed.macOS1013Seed1":case"com.apple.InstallAssistant.OSX12PublicSeed2":case"com.apple.InstallAssistant.OSX12CustomerSeed1":case"com.apple.InstallAssistant.OSX12Seed2":return!0;case"com.apple.Server.v3":case"com.apple.Server.v2":case"com.apple.Server.v1":return!0}return!1})}(e)),64&t&&(n=n||function(e){return J(e,"isLegacyMacOSInstaller",()=>{const t=ye(e,"bundleId");if("mac"!==ol)return!1;switch(t){case"com.apple.InstallAssistant.ElCapitan2":case"com.apple.InstallAssistant.ElCapitan":case"com.apple.InstallAssistant.Yosemite":case"com.apple.InstallAssistant.Mavericks":case"com.apple.InstallAssistant.MountainLion":case"com.apple.InstallAssistant.Lion":case"com.apple.InstallAssistant.Sierra":case"com.apple.InstallAssistant.HighSierra":case"com.apple.InstallAssistant.Mojave":return!0}return!1})}(e)),128&t&&(n=n||function(e){return J(e,"shouldFilterUnsupportedPlatform",()=>("apps"===e.type||"app-bundles"===e.type)&&!Yo(jo(e),ol))}(e)),256&t&&(n=n||function(e){return J(e,"shouldFilterUnsupportedPreordersOnPlatform",()=>!!yo(e)&&"apps"===e.type&&!Ko(jo(e),ol))}(e)),512&t&&(n=n||function(e){return!("phone"!==ol||!we(e,"isStandaloneForWatchOS")||function(e){if(o(e)||0===e.length)return!0;const t=e.split(".");return I(f(t[0])||0,f(t[1])||0,f(t[2])||0)}(ye(e,"minimumWatchOSVersion")))||("watch"===ol?!pa(ye(e,"minimumWatchOSVersion")):!pa(ue(e,Ae(e),"minimumOSVersion")))}(e)),1024&t&&(n=n||function(e){return!(!bs.isArcadeComingSoonEnabled||!re(e,"supportsArcade"))}(e)),2048&t&&(n=n||function(e){if("watch"===ol)return!1;const t=ie(e,"isFirstPartyHideableApp"),n=!we(e,"isDeliveredInIOSAppForWatchOS")&&we(e,"isStandaloneForWatchOS");return t&&n}(e)),4096&t&&(n=n||function(e){if("watch"!==ol)return!1;if(we(e,"isStandaloneForWatchOS")||we(e,"isStandaloneWithCompanionForWatchOS"))return!1;return!(o(t=ue(e,Ae(e),"minimumOSVersion"))||0===t.length||b(t));var t}(e)),8192&t&&(n=n||function(e){return re(e,"isPreorder")&&sa(e)}(e)),n}function De(e){return-1!==bu.indexOf(e.protocol)}function Le(e){return e.startsWith("{")&&e.endsWith("}")}function Fe(e,t,n,r){const i=t(e,r);if(!i)return Promise.resolve({originalData:e,additionalData:null});const a=Array.from(i),s=[];for(const e of a){const t=n(e);if(o(t)){const t=a.indexOf(e);a.splice(t,1)}else s.push(t)}return Promise.all(s).then(t=>{const n=new Map;for(const[e,r]of a.entries()){const i=t[e];n.set(r,i)}return{originalData:e,additionalData:n}})}function xe(e){const t=e.host;if(o(t))return!1;for(const e of _u)if(!o(e)&&-1!==t.indexOf(e))return!0;return!1}function Ne(e){return M(new fh(e)).toString()}function Ue(e){let t=e.query.id;const n=e.pathname;if(o(t)&&l(n)){const e=Lu.exec(n);e&&e.length>1&&(t=e[1])}if(!c(t)){const n=e.pathComponents();l(n)&&(t=n[n.length-1])}return t}function Me(e){let t=Ue(e);if(!c(t))throw new Error(`Unable to map ${e.build()} to a media api url`);t in Fu&&(t=Fu[t]);let n="apps",r=Du,i=["customers-also-bought-apps","developer-other-apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items","alternate-apps"];-1!==e.pathname.indexOf("app-bundle")&&(n="app-bundles",r=["screenshotsByType","videoPreviewsByType","minimumOSVersion"],i=["developer-other-apps","apps","reviews","related-editorial-items"]);const o=g(e.query[El.isArcade]);return(null===o||o)&&(r.push("minPlayers","maxPlayers","editorialVideo"),i.push("developer")),(new fh).forType(n).withIds([t]).includingAdditionalPlatforms(Za()).includingRelationships(i).includingAttributes(r).addingRelationshipLimit("reviews",es()).attributingTo(e.build())}function Be(){const e=["editorialArtwork","editorialVideo","requiredCapabilities","minimumOSVersion"];return"mac"===ol?e.push("screenshotsByType"):e.push("isAppleWatchSupported"),e}function $e(){let e=[];switch(ol){case"mac":e.push(Nu);break;case"watch":e.push(Uu);break;default:e=e.concat(xu)}return e}function Ve(e,t,n){const r=new Xl(e,t);return n&&(r.presentationContext="push"),r}function qe(e){const t=[],n=new Cu,r={};r[P("ACCOUNT_SETTINGS")]=new Xl("finance","account"),n.footer=new ru(P("PERSONALIZATION_DESCRIPTION_FOOTER_OPTED_IN").replace("{account_settings}",P("ACCOUNT_SETTINGS")),r);const o=new Ys(P("PERSONALIZATION_DESCRIPTION_OPTED_IN"));n.addContentItem(new Ru(o)),t.push(n);const a=new Cu(P("PERSONALIZATION_INTERACTIONS"));a.footer=new ru(P("PERSONALIZATION_INTERACTIONS_FOOTER")),a.addContentItem(new Eu(P("PERSONALIZATION_PURCHASES"),Ve("purchases",null,!0),"navigation")),a.addContentItem(new Eu(P("PERSONALIZATION_SUBSCRIPTIONS"),Ve("finance",qu,!1),"navigation")),a.addContentItem(new Eu(P("PERSONALIZATION_PREORDERS"),Ve("finance",Gu,!0),"navigation")),a.addContentItem(new Eu(P("PERSONALIZATION_RATINGS"),Ve("finance",Vu,!0),"navigation")),t.push(a);const s=new Cu(P("PERSONALIZATION_ADDITIONAL_INFO")),c=[P("PERSONALIZATION_ADDITIONAL_INFO_ITEM_1"),P("PERSONALIZATION_ADDITIONAL_INFO_ITEM_2"),P("PERSONALIZATION_ADDITIONAL_INFO_ITEM_3"),P("PERSONALIZATION_ADDITIONAL_INFO_ITEM_4"),P("PERSONALIZATION_ADDITIONAL_INFO_ITEM_5")].join("\n"),u=new Ys(c);s.addContentItem(new Ru(u)),t.push(s);const d=i(e,"results.derived-user-info");if(l(d)){const e=new Cu(P("ACCOUNT_INFO")),n=["gender","birthyear"];for(const t of n){const n=p(d,`${t}.label`),r=p(d,`${t}.value`);l(n)&&l(r)&&e.addContentItem(new Ou(n,r))}e.footer=new ru(P("PERSONALIZATION_ACCOUNT_INFO_FOOTER")),t.push(e)}return new Pu(P("RECOMMENDATIONS"),t)}function Ge(e){const t=u(e,"data");return t.length>1&&(console.warn("tried to extract data from container but more than one member present"),console.log(JSON.stringify(e))),1!==t.length?null:t[0]}function He(e){return u(e,"data")}function je(e){return s(e.attributes)}function We(e){return u(e,"results.contents")}function ze(e){return h(e,"meta.metrics")}function Ye(e){const t={};return e?(Object.assign(t,e.baseFields),e.pageUrl?t.pageUrl=e.pageUrl:e.timingMetrics&&e.timingMetrics.pageURL&&(t.pageUrl=e.timingMetrics.pageURL),e.recoMetricsData&&Object.assign(t,e.recoMetricsData),e.mercuryMetricsData&&Object.assign(t,e.mercuryMetricsData),Ta(t)):t}function Ke(e,t,n,r){const i=m(n,ks.pageInformation,{}),o=m(n,ks.timingValues),a=p(n,ks.requestedUrl),s=i;if(s.pageType=e,s.pageId=t,r&&(s.pageDetails=r),"Software"===e){const e=Ge(n),t=ne(e,"name"),r=ne(e,"artistName");s.pageDetails=`${r}_${t}`,sa(e)&&(s.softwareType="Arcade")}else"Genre"===e?s.pageDetails=`${e}_${t}`:"Search"===e&&(s.pageDetails="Apps");const l=new Yu(Ta(s));l.timingMetrics=o,l.pageUrl=a;const c=p(n,ju);if(c){const e=JSON.parse(c);l.iAdInfo=new zu(p(e,"iAdId")),l.iAdInfo.applyClickFieldsFromPageRequest(t,e)}return l.recoMetricsData=ze(n),l}function Qe(e,t,n,r){const i=new Yu({pageType:e,pageId:t,page:`${e}_${t}`,pageDetails:n});return r&&(i.iAdInfo=new zu(p(r,"iAdId")),i.iAdInfo.applyClickFieldsFromPageRequest(t,r)),i}function Je(e,t,n){o(t)||(e.pageMetrics.pageFields=Ye(t),e.pageMetrics.addManyInstructions(function(e,t){const n=tt(e,t);e.searchTerm&&(n.searchTerm=e.searchTerm);const r=Ee(n);e.iAdInfo&&Object.assign(r,e.iAdInfo.impressionsFields);const i=s(e.iAdInfo),o=Se(r,i),a=[new Yl(o,["appExit","pageExit"])];if(i){const t=Ee(n);Object.assign(t,e.iAdInfo.impressionsFields);const i=function(e){const t=Se(e,!0);return t.fields.impressionQueue="data-metrics-impressions-low-latency",new Wl(t.fields,["fastImpressions","pageFields","pageReferrer","advertRotation"])}(r);i.fields.eventVersion=3,a.push(new Yl(i,["appExit","pageExit","timer"]))}return a}(t,n)),e.pageMetrics.addData(function(e,t){const n=tt(e,t);e.iAdInfo&&Object.assign(n,e.iAdInfo.pageFields),s(e.offerReleaseDate)&&(n.offerReleaseDate=ve(e.offerReleaseDate)),e.searchTerm&&(n.searchTerm=e.searchTerm);const r=function(e,t,n){const r={};Object.assign(r,n),r.eventType="page",t&&(r.clientCorrelationKey=t.clientCorrelationKey,r.requestStartTime=t.requestStartTime,r.responseStartTime=t.responseStartTime,r.responseEndTime=t.responseEndTime);return new Wl(r,["pageFields","pageReferrer"])}(0,e.timingMetrics,n);return l(e.iAdInfo)&&r.includingFields.push("advertRotation"),r}(t,n),["pageEnter"]),e.pageMetrics.pageRenderFields=function(e,t){const n=tt(e,t);return e.searchTerm&&(n.searchTerm=e.searchTerm),function(e,t){const n={};return Object.assign(n,t),n.eventType="pageRender",e&&(n.pageUrl||(n.pageUrl=e.pageURL),n.clientCorrelationKey=e.clientCorrelationKey,n.platformRequestStartTime=e.requestStartTime,n.platformResponseStartTime=e.responseStartTime,n.platformResponseEndTime=e.responseEndTime,n.platformResponseWasCached=e.responseWasCached,n.platformJsonParseStartTime=e.parseStartTime,n.platformJsonParseEndTime=e.parseEndTime),n}(e.timingMetrics,n)}(t,n),e instanceof Ku||e.pageMetrics.addData(et(t,n),["backButton"]))}function Xe(e,t){return new Yu({pageId:e||"",pageType:t})}function Ze(e){if(o(e)||o(e.pageMetrics))return;const t=e.pageMetrics.instructions;if(!o(t))for(const e of t)"page"===e.data.fields.eventType&&e.data.includingFields.push("crossfireReferral");if(e instanceof cd){const t=[];if(e.buttonAction instanceof nc)t.push(e.buttonAction);else if(e.buttonAction instanceof rc&&e.buttonAction.buyAction instanceof nc)t.push(e.buttonAction.buyAction);else if(e.buttonAction instanceof ic&&e.buttonAction.completionAction instanceof nc)t.push(e.buttonAction.completionAction);else if(e.buttonAction instanceof ac){if(e.buttonAction.buyAction instanceof nc&&t.push(e.buttonAction.buyAction),e.buttonAction.defaultAction instanceof nc&&t.push(e.buttonAction.defaultAction),e.buttonAction.openAction instanceof nc&&t.push(e.buttonAction.openAction),e.buttonAction.subscribePageAction instanceof Xl&&"arcadeSubscribe"===e.buttonAction.subscribePageAction.page&&l(e.buttonAction.subscribePageAction.pageUrl)){const t=xl.from(e.buttonAction.subscribePageAction.pageUrl);t.param(El.includePostSubscribeAttribution,"true"),e.buttonAction.subscribePageAction.pageUrl=t.build()}e.buttonAction.subscribePageAction instanceof Xl&&e.buttonAction.subscribePageAction.pageData instanceof Sc&&e.buttonAction.subscribePageAction.pageData.postSubscribeAction instanceof nc&&t.push(e.buttonAction.subscribePageAction.pageData.postSubscribeAction)}for(const e of t)e.purchaseConfiguration&&(e.purchaseConfiguration.excludeAttribution=!1)}}function et(e,t){return function(e){const t={};return Object.assign(t,e),t.actionType="back",be("back","button",t)}(tt(e,t))}function tt(e,t){const n={};return s(e.offerType)&&(n.offerType=e.offerType),n&&t&&t(n),n}function nt(e=!1,t=!1,n=0,r=fs){return rt(function(e,t){let n;switch(host.clientIdentifier){case"com.apple.TVAppStore.AppStoreTopShelfExtension":case"com.apple.Arcade.ArcadeTopShelfExtension":n=!1;break;default:n=t.supportsHEIF}return e?n?"heic":"png":n?"heic":"jpeg"}(e,r),t,n,r)}function rt(e,t=!1,n=0,r=fs){const i=function(e,t,n){switch(e){case"heic":return"tv"===n.deviceType&&20===t?70:60;default:return 70}}(e,n,r);return new Ms(e,i,t)}function it(e,t=0,n=0,r=null,i=null,o=fs){const a=new Bs(e,t,n,[nt(!1,!1,0,o)]);return a.backgroundColor=r,a.checksum=i,a}function ot(e){switch(ne(e,"editorialContext")){case"Watch":return"com.apple.AppStore.BridgeStoreExtension";case"Messages":return"com.apple.MobileSMS";default:return null}}function at(e,t){if(!e)return null;const n=e.length,r=n%t;return n>=t?e.slice(0,n-r):e}function st(e){return e&&e.remainingContent?e.remainingContent.slice(0,e.maxPerPage):[]}function lt(e){const t=Object.assign({},e);if(e&&e.ids){const n=ct(e.ids,e.maxPerPage);t.ids=n}if(e&&e.remainingContent){const n=ct(e.remainingContent,e.maxPerPage);t.remainingContent=n}return t}function ct(e,t){return e.slice(t,e.length)}function ut(e,t){return e.slice(t,e.length)}function dt(e,t,n=null,r,i){return{remainingContent:e,maxPerPage:Id,highestOrdinal:0,url:t,metricsPageInformation:r,metricsLocationTracker:i}}function pt(e){return s(e)?ne(e,"customUrl"):null}function ft(e,t,n,r){if(!l(n)&&"mac"!==ol)return e;const i=new ac(t,e),o=new ec(n);return Na(o,{actionType:"open",actionDetails:{actionUrl:n},id:t,pageInformation:r.pageInformation,locationTracker:r.locationTracker}),i.openAction=o,i}function ht(e,t){const n=Ye(t.pageInformation);n.id=ya(t.id),n.idType=ga(t),n.type="video",n.typeDetails="iTunesStoreContent",n.location=ka(t,null),t.actionDetails&&(n.actionDetails=t.actionDetails),e.templateMediaEvent=function(e){const t={};return Object.assign(t,e),t.eventType="media",new Wl(t)}(n);const r=Ee(n);r.actionUrl=e.videoUrl,e.templateClickEvent=function(e,t,n){const r={};return Object.assign(r,n),r.eventType="click",r.targetType="button",r.targetId=null,new Wl(r,["pageFields"])}(0,0,r)}function mt(e){if(!e)return null;const t=e.match(/P(\d+)([A-Z]+)/);if(!t||3!==t.length)return null;let n=f(t[1]),r=t[2];return n&&r?("D"===r&&n>0&&n%Xd==0&&(r="W",n/=Xd),new Jd(n,r)):null}function gt(e){if(!s(e))return!1;const t=wt(e);for(const e of t)switch(e.key){case"AppleArcade.Subscribe.FreeTrial.DurationAndTerms":case"AppleArcade.Subscribe.NoTrial.Pricing":return!0;default:return!1}return!1}function yt(e,t,n=null){let r;return r=s(n)?{appName:ne(n,"name")}:null,function(e,t,n=null){if(!s(e))return null;if(e===tp)return"";let r=e;const i=wt(e);for(const e of i){const i=Tt(fo(t),e.key,n);if(o(i))return null;r=r.replace(e.matchedString,i)}return r}(e,t,r)}function*wt(e){const t=new RegExp("@(.*?)@","g");let n=null;do{n=t.exec(e),null!=n&&(yield{matchedString:n[0],key:n[1]})}while(null!=n)}function Tt(e,t,n){switch(t){case"AppleArcade.Subscribe.AppName":return function(e){return o(e)||o(e.appName)?null:e.appName}(n);case"AppleArcade.Subscribe.FreeTrial.Duration":case"AppleArcade.Subscribe.FreeTrial.DurationAndTerms":return function(e,t){const n=u(e,"discounts")[0];if(!n)return null;const r=p(n,"recurringSubscriptionPeriod"),i=p(e,"recurringSubscriptionPeriod");if(!r||!i)return null;if("FreeTrial"!==p(n,"modeType"))return null;const a=mt(r),l=mt(i),c=Zd[a.type],d=Zd[l.type],h=p(e,"priceFormatted"),m=f(n,"numOfPeriods"),g=a.period*m;switch(t){case"AppleArcade.Subscribe.FreeTrial.Duration":return function(e,t){return o(e)?null:C(`ARCADE_SUBSCRIBE_FREE_TRIAL_DURATION_${e}`,t)}(c,g);case"AppleArcade.Subscribe.FreeTrial.DurationAndTerms":return function(e,t,n,r,i){if(o(e)||o(t)||o(r)||o(i))return null;const a=v(`ARCADE_SUBSCRIBE_FREE_TRIAL_${e}_POST_TRIAL_${t}`,[n,r]);return s(a)?a.replace("{postTrialPrice}",i):null}(c,d,g,l.period,h);default:return null}}(e,t);case"AppleArcade.Subscribe.NoTrial.Pricing":return function(e,t){const n=p(e,"recurringSubscriptionPeriod");if(!n)return null;const r=mt(n),i=Zd[r.type];if(o(i))return null;const a=p(e,"priceFormatted");switch(t){case"AppleArcade.Subscribe.NoTrial.Pricing":return C(`ARCADE_SUBSCRIBE_NO_TRIAL_TERMS_${i}`,r.period).replace("{price}",a);default:return null}}(e,t);default:return null}}function At(e){const t=u(e,"discounts")[0];if(!t)return null;const n=p(t,"recurringSubscriptionPeriod"),r=p(e,"recurringSubscriptionPeriod");if(!n||!r)return null;const i=p(t,"modeType"),a=mt(n),s=mt(r),l=function(e,t,n){if(o(e)||o(t))return null;const r=Zd[e.type],i=Zd[t.type],a=ep[n];return r&&i&&a?`IN_APP_OFFER_PAGE_DESCRIPTION_${a}_${r}_POST_TRIAL_${i}`:null}(a,s,i);if(!l)return null;const c=p(t,"priceFormatted"),d=p(e,"priceFormatted"),h=f(t,"numOfPeriods"),m=a.period*h;switch(i){case"FreeTrial":const e=v(l,[m,s.period]);if(e)return e.replace("{postTrialPrice}",d);break;case"PayUpFront":const t=v(l,[m,s.period]);if(t)return t.replace("{trialPrice}",c).replace("{postTrialPrice}",d);break;case"PayAsYouGo":const n=v(l,[a.period,m,s.period]);if(n)return n.replace("{trialPrice}",c).replace("{postTrialPrice}",d);break;default:return null}return null}function It(e,t){const n={internalContentType:"shelf",shelf:t};e.push(n)}function bt(e,t){const n={internalContentType:"contentPool",contentPool:new rp(t)};e.push(n)}function kt(e,t,n){if(a(e))return null;const r=e.shift();if("shelf"===r.internalContentType)return{contentType:"shelf",shelf:r.shelf};const i=r.contentPool,o=i.numberOfItemsProcessed,s=o>0;let l;l="greedy"===t&&i.isFullyHydrated?function(e){const t={label:e.label,title:e.title,meta:e.meta,date:e.date,contents:e.remainingContents};return e.numberOfItemsProcessed=e.remainingContents.length,e.remainingContents=[],t}(i):function(e,t){const n=e.remainingContents.length,r=e.remainingContents.slice(0,t),i=e.remainingContents.slice(t,n),o={label:e.label,title:e.title,meta:e.meta,date:e.date,contents:r};return e.numberOfItemsProcessed+=r.length,e.remainingContents=i,o}(i,n);const c=a(i.remainingContents),u={todayModule:l,isContinuationModule:s,isLastOfModule:c,contentOffsetWithinSourceModule:o};return c||e.unshift(r),{contentType:"moduleSlice",moduleSlice:u}}function St(e){const t=[],n=[];for(const r of e.todayModule.contents)je(r)?t.push(r):n.push(r);return 0===n.length?Promise.resolve(e):$(new fh(n).includingAdditionalPlatforms(Za()).includingAttributes(ap).includingRelationshipsForUpsell(!0)).then(n=>{const r=He(n),i=t.concat(r);return e.todayModule.contents=i,e}).catch(()=>(e.todayModule.contents=[],e))}function Pt(e,t){const n=e.todayModule,r=t.todayModule;return{todayModule:{label:n.label,title:n.title,meta:n.meta,contents:n.contents.concat(r.contents)},isContinuationModule:e.isContinuationModule,isLastOfModule:t.isLastOfModule,contentOffsetWithinSourceModule:e.contentOffsetWithinSourceModule}}function Ct(e,t,n){let r=!1,i=[],o=[];for(let a=e.length-1;a>=0;a--){const s=e[a];je(s)?1===t[s.id]?(n&&0===i.length&&i.unshift(...o),o=[],i.unshift(s),r=!0):(o.unshift(s),t[s.id]-=1):o.unshift(s)}return n&&0===i.length&&(i=o),{contents:i,contentsContainsHydratedData:r}}function vt(e,t,n=null,r){const i=P("PAGE_TITLE_TODAY"),o=new Qd(e,n,r||i,i);return s(t)&&l(t.queue)&&(o.nextPage=t),o}function Et(e,t,n=!1){const r=kt(e,"greedy",6);if(o(r))return null;let i,a=null;if("shelf"===r.contentType&&(a=r.shelf,i=!0),"moduleSlice"===r.contentType){const e=r.moduleSlice,o={contentOffsetWithinModule:e.contentOffsetWithinSourceModule,hideTitle:e.isContinuationModule,setTitleToDateForTodaySection:n};a=Ot(e.todayModule,o,t),i=e.isLastOfModule}return s(a)&&i&&Ea(t.locationTracker),a}function Ot(e,t,n,r=!1){const c=ze(e),d={id:null,kind:null,softwareType:null,targetType:"swoosh",title:e.title,pageInformation:n.pageInformation,locationTracker:n.locationTracker,idType:"its_contentId",recoMetricsData:c};n.currentShelfRecoMetricsData=c;const f=new Tu("todayCard");f.isHorizontal=!1,Oo(f,d),Pa(d,e.title),function(e,t){const n=Da(e);n?n.position=t:e.rootPosition=t}(d.locationTracker,t.contentOffsetWithinModule);const h={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0};h.useThreeLineOverlayForBranded=!function(e){const t=i(e,"date");return"TodayForApps"===e.label||s(t)}(e)||r;const m=[],g=u(e.contents);let y=0;for(const e of g){if(!je(e))break;const t=Nt(e,h,n);s(t)&&(m.push(t),Ea(n.locationTracker)),y++}const w=g.slice(y);e.contents=w,f.items=m;const T=p(e,"date");if("TodayForApps"===e.label&&t.setTitleToDateForTodaySection){const e=new Date;f.title=D("EEEE, MMMM d",e)}else if(l(T)){const e=Ce(T);f.title=D("EEEE",e),f.subtitle=D("MMMM d",e)}else f.title=e.title;if(t.hideTitle&&(f.title=void 0),Ca(n.locationTracker),l(e.contents)){const r=t.contentOffsetWithinModule+y,i=new lp(e,r,n.pageInformation,n.locationTracker);f.url=o((A=i).todayModule)||a(A.todayModule.contents)?null:`${Pl.internal}:/${Cl.today}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(A))}var A;return f}function Rt(e,t){switch(t){case"smallStoryCard":return"iOS"===host.platform?pp.has(e):cp.has(e);case"mediumStoryCard":return up.has(e);case"largeStoryCard":return dp.has(e);case"todayCard":return"watch"===ol;default:return!1}}function _t(e,t,n,r,i){const o={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker};null==i&&(i={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0}),i.prevailingCropCode=function(e){switch(e){case"smallStoryCard":return"iOS"===host.platform||"tvOS"===host.platform?"fo":"em";case"mediumStoryCard":return"el";case"largeStoryCard":return"ek";default:return null}}(t),"watch"!==ol&&(i.coercedGeneralCardSubType="Grid");const a=[];for(const l of e){if(!s(l.attributes)){r&&r(l);continue}const e=Nt(l,i,o,n.augmentingData);if(e){if("phone"===ol||"pad"===ol){e.collapsedHeading=Lt(e),e.inlineDescription=Ft(e,l),y("smallStoryCards")&&e.inlineDescription===e.collapsedHeading&&(e.inlineDescription=null);const t=e.media;t&&"brandedSingleApp"===t.kind&&(e.title=null)}if("largeStoryCard"===t){const t=e.heroMedia;if(!s(t)||!s(t.art)&&!s(t.video))continue}if(Rt(e.media.kind,t)){if(s(n.filterOutMediaCardKinds)&&n.filterOutMediaCardKinds.has(e.media.kind))continue;a.push(e)}en(e,l)}}return a}function Dt(e,t,n,r,i,o){if(!s(t))return null;const a=new Tu(t);switch(n&&(a.title=n),a.subtitle=r,t){case"todayBrick":a.items=[xt(e,i.metricsPageInformation,i.metricsLocationTracker,()=>!0,o)];break;default:a.items=_t(e,t,i,o)}return a}function Lt(e){return s(e.heading)?e.heading.replace(/\n/g," "):null}function Ft(e,t){if(y("smallStoryCards"))switch(e.media.kind){case"brandedSingleApp":return e.overlay instanceof qd&&s(e.overlay.lockup)?e.overlay.lockup.title:null;default:const n=ca(t,"name");return s(n)?n.replace(/\n/g," "):null}switch(e.media.kind){case"brandedSingleApp":return e.overlay instanceof Wd?e.overlay.heading:s(e.title)?e.title.replace(/\n/g," "):null;default:const t=P("TODAY_BRICK_STANDARD_DESCRIPTION");let n,r;return e.overlay instanceof Wd?(n=e.overlay.heading,r=e.overlay.title):(n=e.heading,r=e.title),t&&n&&r?t.replace("{heading}",n).replace("{title}",r):null}}function xt(e,t,n,r,i){return Is.c("todayCardsFromPlatformData",()=>{if(!e)return null;const o={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!1,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0,coercedGeneralCardSubType:"Grid",prevailingCropCode:"fo"},a={pageInformation:t,locationTracker:n},l=[];for(const t of e){if(!s(t.attributes)){i&&i(t);continue}const e=Nt(t,o,a);if(e&&r(e)){e.collapsedHeading=Lt(e),e.inlineDescription=Ft(e,t),y("smallStoryCards")&&e.inlineDescription===e.collapsedHeading&&(e.inlineDescription=null);const n=e.media;n&&"brandedSingleApp"===n.kind&&(e.title=null),l.push(e)}}return l.length?new Kd(l):null})}function Nt(e,t,n,r){return Is.b("todayCardFromData",()=>{const i=ne(e,"displayStyle"),c=ot(e);!function(e,t,n){const r=Jt(e);let i=ne(e,"displaySubStyle");if(i&&n.coercedGeneralCardSubType&&(i=n.coercedGeneralCardSubType),"Content"!==ne(e,"displayStyle"))return!1;if(r.length>=6&&"Grid"===i)return!1;const o=Bt("Content");return!(!ie(e,"ignoreEditorialArt")&&zt(ee(e,o),n.prevailingCropCode)||$t(r))}(e,0,t)?t.clientIdentifierOverride=null:t.clientIdentifierOverride=c;let u=null;switch(i){case"Branded":u=function(e,t,n){return Is.c("brandedCard",()=>{let r;s(t)&&(r=t.clientIdentifierOverride);const i=jt(e,n,r),c=t.useThreeLineOverlayForBranded;Ht(e,i,n);try{const r=Bt("Branded"),u=ee(e,r),d=zt(u,t.prevailingCropCode),p=Yt(e,r);d?i.style=Kt(u):(i.backgroundColor=Ld.noArtBackgroundColor,i.style="dark");const f=ne(e,"displayStyle"),h=Qt(i.style,f),m=Xt(e,t,n,!0,h,"grey");if(!m||1!==m.length)return null;const g=m[0];switch(ne(e,"displaySubStyle")){case"AppOfDay":case"GameOfDay":{let t=!0,n=null;if(s(d)&&(t=!1,n=d.backgroundColor),c){const t=function(e){const t=ne(e,"displaySubStyle");let n=ne(e,"alternateLabel");return o(n)&&"AppOfDay"===t?n=ip:o(n)&&"GameOfDay"===t&&(n=op),n}(e);let n=ca(e,"name");a(n)&&(n=g.title);let r=ca(e,"short");if(a(r)){const t=W(e,"card-contents");0!==t.length&&(r=ca(t[0],"tagline")),o(r)&&!o(g.subtitle)&&(r=g.subtitle)}i.overlay=new Wd(t,n,r),i.style="white",i.title=null,s(d)&&"watch"!==ol&&(d.crop="fo")}else{const r=ca(e,"short");let o=null;l(r)&&(o=new Ys(r,"text/plain","todayCardOverlay")),i.overlay=new qd(g,o,t,n)}break}default:{const e=new Vd(g);e.displaysIcon=!1,i.overlay=e;break}}return c||(i.title=ne(e,"label")),i.media=new Ld(g.icon,d,p),i.media.impressionMetrics=g.impressionMetrics,i}finally{Ca(n.locationTracker)}})}(e,t,n);break;case"Content":u=function(e,t,n){return Is.c("contentCard",()=>{let r;s(t)&&(r=t.clientIdentifierOverride);const i=jt(e,n,r);Ht(e,i,n);try{const r=Jt(e),o=$t(r);if(o){const e=Qi(o,{offerStyle:"colored",metricsOptions:{pageInformation:n.pageInformation,locationTracker:n.locationTracker},artworkUseCase:1});return e?(e.theme="infer",i.media=new Nd(e),i.media.impressionMetrics=e.impressionMetrics,i.media.impressionMetrics.fields.parentId=i.impressionMetrics.fields.id,i.style="white",i):null}{const o=Bt("Content"),a=qt(e,i,o,t.prevailingCropCode);if(a){const r=ne(e,"displayStyle"),o=Qt(a.style,r),s=Xt(e,t,n,!0,o);return Vt(e,a,s),null!==i.overlay&&i.overlay instanceof Hd&&(i.overlay.style="white"),i}if(1===r.length){const r=Xt(e,t,n,!0);if(1!==r.length)return null;const o=r[0];return i.media=new Dd(o.icon),Vt(e,i,r),null!==i.overlay&&i.overlay instanceof Vd&&(i.overlay.displaysIcon=!1),i}{const o=r.filter(e=>{const t=ia(e);return!na(e)||!t});let a,s,l=ne(e,"displaySubStyle");switch(l&&t.coercedGeneralCardSubType&&(l=t.coercedGeneralCardSubType),ol){case"tv":a=3,s=2;break;default:a=4,s=5}switch("watch"===ol&&Vt(e,i,[]),l){case"List":case"NumberedList":{const r=Xt(e,t,n,!1);if(r.length<a&&t.enableListCardToMultiAppFallback)return Wt(e,r,i),i;if("NumberedList"===l){let e=1;for(const t of r)t.ordinal=`${e}`,e++}return i.style="white",i.media=new Fd(r,null),i}case"River":{t.canDisplayArcadeOfferButton=!1;const r=Zt(o,t,n,!0);return 0===r.length?null:r.length<s?(Wt(e,r,i),i):(i.style="white",i.media=new Ud(r),i)}case"Grid":{t.canDisplayArcadeOfferButton=!1;const r=Zt(o,t,n,!0);if(0===r.length)return null;if(r.length<=s)return Wt(e,r,i),i;const a=r.length%2!=0;let l;r.length<=9&&a&&"tv"!==ol&&r.pop(),i.style="white";const c=r.length;return l=c<=13?"large":c<=25?"mixed":"small",i.media=new Md(r,l),i}default:return null}}}}finally{Ca(n.locationTracker)}})}(e,t,n);break;case"Media":u=function(e,t,n){return Is.c("mediaCard",()=>{let r;s(t)&&(r=t.clientIdentifierOverride);const i=jt(e,n,r);Ht(e,i,n);try{switch(ne(e,"cardDisplayStyle")){case"Video":return function(e,t,n,r){const i=Gt(e);if(!i)return null;const o=Lo(h(i,"previewFrame"),{withJoeColorPlaceholder:!0,useCase:15});if(!o)return null;const a=p(i,"video");if(!a)return null;let s=yd;l(n.videoPlaybackControls)&&(s=n.videoPlaybackControls);let c=wd;l(n.videoPlaybackControls)&&(c=n.videoAutoplayPlaybackControls);const u=la(e,"short"),d=new Mc(a,o,{playbackControls:s,autoPlayPlaybackControls:c,canPlayFullScreen:n.enableFullScreenVideo});return"mac"===ol&&(d.playbackControls.scrubber=!0,d.autoPlayPlaybackControls.scrubber=!0),ht(d,{pageInformation:r.pageInformation,locationTracker:r.locationTracker,id:e.id}),t.style="white",t.media=new Bd(d,u),t.overlay=new Wd(t.heading,t.title,u),t.title=null,t.heading=null,t}(e,i,t,n);case"FullBleedImage":const r=Bt("Media"),o=qt(e,i,r,t.prevailingCropCode);return Vt(e,o,[]),o;default:return null}}finally{Ca(n.locationTracker)}})}(e,t,n);break;default:u=null}if(o(u))return null;u.inlineDescription=la(e,"short"),ie(e,"isAcquisition")&&(u=function(e,t,n,r){let i=Qa(t);!i&&n&&(i=Ja(n.arcadeUpsellEditorialResponse));const o=function(e,t){if(!function(){if(!y("arcadeLockupOverlay"))return!1;const e=host.platform;return"iOS"===e||"macOS"===e}())return null;const n=to(e,t,"arcadeTodayCard","infer","light");return new zd(n)}(i,r);return o&&(e.overlay=o,e.impressionMetrics.fields.displaysArcadeUpsell=!0),e.title=yt(e.title,i.inAppData),e.inlineDescription=yt(e.inlineDescription,i.inAppData),e}(u,e,r,n));const d=new Rd,f=Ut(e,t.heroDisplayContext,i,t.prevailingCropCode);if(s(f)&&(d.art=f),s(u.media)&&u.media instanceof Bd&&(d.video=u.media.video),("mac"===ol||"tv"===ol)&&d.isValid()){u.heroMedia=d;let n=Kt(ee(e,Mt(t.heroDisplayContext,i)));s(n)||(n=Kt(h(Gt(e),"previewFrame"))),u.style=n}return o(u)?(console.log(`Unknown style: ${i}`),null):u})}function Ut(e,t,n,r){return zt(ee(e,Mt(t,n)),function(e,t){return"article"===e&&"mac"===ol?"fn":t}(t,r))}function Mt(e,t){return"article"===e&&"mac"===ol?Bt(t):"editorialArtwork.crossoverCard"}function Bt(e){if("watch"===ol)return"editorialArtwork.subscriptionHero";switch(e){case"Branded":return"editorialArtwork.dayCard";case"Content":return"editorialArtwork.generalCard";case"Media":return"editorialArtwork.mediaCard";default:return null}}function $t(e){if(1===e.length){const t=e[0];if("in-apps"===t.type)return t}return null}function Vt(e,t,n){if(!t)return;const r=la(e,"short"),i=ie(e,"ignoreITunesShortNotes");if(r&&!i)t.overlay=new Hd(new Ys(r,"text/plain","todayCardOverlay"));else if(n&&0!==n.length)if(1===n.length)t.overlay=new Vd(n[0]);else{const e=new Gd(n);e.displaysTitle=!1,t.overlay=e}}function qt(e,t,n,r){return Is.c("cardWithArtwork",()=>{if(ie(e,"ignoreEditorialArt"))return null;const i=ee(e,n),o=zt(i,r);return o?(t.media=new _d(o,Yt(e,n)),t.style=Kt(i),t.clickAction instanceof ec&&(t.overlay=new jd(t.clickAction),t.style="white"),t):null})}function Gt(e){let t;const n=ee(e,"editorialVideo.storeFrontVideo4x3"),r=ee(e,"editorialVideo.storeFrontVideo");return t="pad"===ol?n||r:r||n,t}function Ht(e,t,n){Pa({pageInformation:n.pageInformation,locationTracker:n.locationTracker,targetType:"todayCard",idType:"its_id",id:e.id},t.title)}function jt(e,t,n){return Is.c("basicCard",()=>{const r=new Yd,i=ne(e,"label"),a=ne(e,"displayStyle"),l=ne(e,"displaySubStyle");r.heading=i;let c=la(e,"name");o(c)&&"Branded"===a&&(c=ne(e,"label")),r.title=c;const u=function(e){return d(e,np)}(e),p={cardType:a,franchise:i};s(l)&&(p.cardSubType=l),u&&(p.isOnboardingCard=u);const f=_o(e,c,{targetType:"todayCard",pageInformation:t.pageInformation,locationTracker:t.locationTracker}),h=f;return h.actionDetails=p,r.clickAction=ao(e,h,n,t.currentShelfRecoMetricsData),function(e,t,n,r,i,o){if(!e)return;const a=Eo(e,t);a.franchise=ya(n),a.cardType=ya(r),o&&(a.cardSubType=ya(o)),i&&(a.isOnboardingCard=i),e.impressionMetrics=new Ql(a)}(r,f,i,a,u,l),r})}function Wt(e,t,n){const r=la(e,"short");if(n.media=new xd(t,r),n.clickAction instanceof Xl){const e=xl.from(n.clickAction.pageUrl);e.param(El.showingFallbackMedia,"true"),n.clickAction.pageUrl=e.build()}}function zt(e,t){if(e){const n=Lo(e,{withJoeColorPlaceholder:!0,useCase:15});return n.crop=t||("mac"===ol||"tv"===ol?"fn":"sr"),n}return null}function Yt(e,t){const n=ee(e,t);return s(n)?p(n,"bgGradient"):null}function Kt(e){if(a(e))return null;const t=z(p(e,"bgColor")),n=u(e,"textGradient").map(e=>z(e)),r=2===n.length;return t||r?r?Y(n[0])?"light":"dark":Y(t)?"dark":"light":null}function Qt(e,t){if("Branded"!==t)return null;switch(e){case"dark":return"dark";default:return null}}function Jt(e){return W(e,"card-contents")}function Xt(e,t,n,r,i,o){return Zt(W(e,"card-contents"),t,n,r,i,o,pt(e))}function Zt(e,t,n,r,i,o,s){return a(e)?[]:ro(e.filter(e=>!l(e.attributes)||"in-apps"!==e.type),{lockupOptions:{metricsOptions:{pageInformation:n.pageInformation,locationTracker:n.locationTracker},offerEnvironment:i,offerStyle:o,clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:s,artworkUseCase:1,canDisplayArcadeOfferButton:t.canDisplayArcadeOfferButton},shouldIgnoreLocationIncrement:r,filter:14206})}function en(e,t){if("tv"!==ol||!ie(t,"isAcquisition"))return;const n=Ha();e.clickAction=n}function tn(e,t){const n=oe(e,"editorialElementKind");Is.b(`walkFeaturedContent: ${n}`,()=>{const r=j(e,"tabs");if(s(r))return void tn(r,t);const i={featuredContentId:n,metricsPageInformation:t.metricsPageInformation,metricsLocationTracker:t.metricsLocationTracker,pageGenreId:t.pageGenreId,featuredContentData:e,id:p(e,"id"),title:ne(e,"name"),subtitle:ne(e,"tagline"),shouldFilter:!1,remainingItems:[],isFirstRender:!0,isDeferring:!1,showOrdinals:!1,hasExistingContent:!1,ordinalIndex:1,isSearchGrouping:t.isSearchGrouping,isArcadePage:t.isArcadePage,shouldReduceSmallLockupShelfHeightToContent:t.shouldReduceSmallLockupShelfHeightToContent},a={id:i.id,kind:null,softwareType:null,targetType:"swoosh",title:i.title,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"its_contentId",fcKind:n,recoMetricsData:rn(e)};let c,u=!0,d=!1;switch(n){case 413:case 414:case 254:case 255:case 256:case 266:case 271:nn(e,t);break;case 424:{const n=W(e,"children");t.topChartIdentifiers=[];for(const e of n)if(An(oe(e,"editorialElementKind"))){const n=ne(e,"chart");l(n)&&t.topChartIdentifiers.push(n)}nn(e,t),t.topChartIdentifiers=[];break}case 425:{const n=j(e,"children");if(n){const e=W(n,"children");e.length&&(Pa(a,i.title),c=an(e,i),Ca(t.metricsLocationTracker),d=!0)}break}case 415:case 416:case 417:case 258:Pa(a,i.title),i.clientIdentifierOverride=ot(e),c=sn(W(e,"children"),i),Ca(t.metricsLocationTracker),d=!0;break;case 421:case 422:case 423:case 261:{Pa(a,i.title);let n=re(e,"suppressText");o(n)&&(n=!0);const r=!n;i.clientIdentifierOverride=ot(e),c=on(W(e,"children"),i,r),Ca(t.metricsLocationTracker),d=!0;break}case 437:case 265:Pa(a,i.title),c=pn(e,i),Ca(t.metricsLocationTracker),d=!0;break;case 436:nn(e,t);break;case 475:{Pa(a,i.title);const n=function(e){switch(e){case"small":return"smallStoryCard";case"medium":return"mediumStoryCard";case"large":return"largeStoryCard";case"card":return"phone"===ol||"pad"===ol?"editorialStoryCard":null;default:return null}}(ne(e,"displayStyle")),r=W(e,"contents"),o={metricsLocationTracker:i.metricsLocationTracker,metricsPageInformation:i.metricsPageInformation};c="editorialStoryCard"===n?un(r,i,o):cn(r,n,i,o),i.shelfStyle=n,kn(c,i),Ca(t.metricsLocationTracker),d=!0;break}case 480:c=function(e,t,n){const r=ne(e,"displayStyle"),i=W(e,"contents");switch(r){case"small":return mn(i,t);case"hero":return dn(i,!0,t,n);case"large":return dn(i,!1,t,n);default:return null}}(e,i,t),0===t.shelves.length&&(c.presentationHints={isFirstShelf:!0}),u=!1;break;case 500:if(s(t.recentlyPlayedGamesData)){const n="tv"===ol,r=t.shouldReduceSmallLockupShelfHeightToContent;t.shouldReduceSmallLockupShelfHeightToContent=!n,tn({id:e.id,type:"editorial-elements",attributes:{editorialElementKind:418,displayStyle:n?"large":"small",name:P("CONTINUE_PLAYING"),doNotFilter:!0},relationships:{contents:t.recentlyPlayedGamesData}},t),t.shouldReduceSmallLockupShelfHeightToContent=r}break;default:if(yn(n)){const r=!ie(e,"doNotFilter"),s=ne(e,"chartHref"),u=ne(e,"chart"),p=j(e,"room"),f=H(e,"contents");let h=f?f.data:null;if(wn(n)){if(!t.hasAuthenticatedUser&&!i.isSearchGrouping){console.log(`Skipping recommendations shelf with fcID ${n}: No user logged-in`);break}if(o(h)&&(i.recommendationsHref=e.href),ie(e,"noPersonalizationAvailable"))break}if(h&&0!==h.length||(h=W(e,"children")),l(s)){const e=function(e,t=host.clientIdentifier){const n=new fh(e).includingAttributes(["isAppleWatchSupported","requiredCapabilities","minimumOSVersion"]);return t===Zs?n.addingContext("watch"):t===el&&n.addingContext("messages"),n}(new xl(s).param(El.chartIdentifier,u).toString());if(l(t.topChartIdentifiers)){const n=t.topChartIdentifiers.join(",");e.addingQuery(El.chartIdentifiers,n)}i.seeAllUrl=M(e).toString()}else l(p)&&(i.seeAllUrl=Ne(p.href));i.shouldFilter=r,i.shelfStyle=function(e,t,n){if(418===e||wn(e)){let t=ne(n,"displayStyle");return t||(t=311===e||312===e?"large":"small"),`${t}Lockup`}if(431===e)return"inAppPurchaseTiledLockup";if(429===e)return"screenshotsLockup";if(304===e||305===e||430===e||420===e)return"appTrailerLockup";if(Tn(e))return"smallLockup";switch(t.shelves.length%3){case 0:return"smallLockup";case 1:return"mediumLockup";default:return"largeLockup"}}(i.featuredContentId,t,e),a.displayStyle=i.shelfStyle,Tn(n)&&(i.showOrdinals=!0,i.shouldFilter=!1),i.clientIdentifierOverride=ot(e),Pa(a,i.title),c=fn(h,i),Ca(t.metricsLocationTracker),d=!0;break}console.warn("Unknown featured content ID:",n)}const f=l(i.remainingItems),h=s(i.recommendationsHref),m=f||h;c&&(l(c.items)||m)&&(u&&Oo(c,a),t.isSearchGrouping&&(c.seeAllAction=null),l(c.url)&&l(t.additionalShelfParameters)&&(c.url=xl.from(c.url).append("query",t.additionalShelfParameters).build()),t.shelves.push(c)),d&&Ea(t.metricsLocationTracker)})}function nn(e,t){const n=W(e,"children");for(const e of n)tn(e,t)}function rn(e){const t=oe(e,"editorialElementKind");switch(t){case 425:case 415:case 416:case 417:case 258:case 421:case 422:case 423:case 261:return ze(H(e,"children"));case 437:case 265:{const t=H(e,"children"),n=te(e,"links");return l(t)?ze(t):l(n)?ze(e):null}default:if(yn(t)){let t=H(e,"contents");if(o(t))return null;const n=t.data;return n&&0!==n.length||(t=H(e,"children")),ze(t)}return console.warn("Unknown featured content ID:",t),null}}function on(e,t,n){const r=[],o=[],a=new Tu("brick");a.isHorizontal=!0;for(const n of e){const e={targetType:"brick",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(n)},i=Pn(n,t,e);if(!i){o.push(n);continue}const a=new tu;if(i.artwork&&261!==t.featuredContentId){let e=h(i.artwork,"subscriptionHero");e||(e=h(i.artwork,"originalFlowcaseBrick")),a.artwork=In(e,17)}else a.artwork=bn(n,1060,520,17);a.accessibilityLabel=i.title,a.shortEditorialDescription=i.title,a.clickAction=i.action,435===oe(n,"editorialElementKind")&&(a.personalizationStyle="mso"),Oo(a,_o(n,i.title,e)),a.isValid()&&(r.push(a),Ea(e.locationTracker))}return s(n)&&(a.presentationHints={showSupplementaryText:n}),delete t.maxItemCount,s(i(t.featuredContentData,"relationships.children.data"))&&(t.featuredContentData.relationships.children.data=o),a.title=t.title,a.subtitle=t.subtitle,a.items=r,kn(a,t),a}function an(e,t){const n=[];for(const r of e){const e=j(r,"grouping");if(o(e))continue;const i=En(e);if(o(r.attributes)||o(e.attributes)||On(t)){t.isDeferring=!0,t.remainingItems.push(e);continue}const a={targetType:"listItem",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(r)},s=io(e,Object.assign(Object.assign({},a),{id:i}),t.clientIdentifierOverride);Oo(s,Object.assign(Object.assign({},a),{kind:"link",softwareType:null,title:s.title,id:i}));const c=ee(e,"artwork");l(c)&&(s.artwork=Lo(c,{allowingTransparency:!0,useCase:19})),n.push(s),Ea(t.metricsLocationTracker)}"mac"===ol&&Cn(n);const r=function(e,t){const n=new Tu("action");let r;switch(ol){case"tv":n.isHorizontal=!0,r=7;break;case"mac":n.isHorizontal=!1,r=null;break;default:n.isHorizontal=!1,r=6}if(null!==r&&e.length>r){n.items=e.slice(0,r);const i=new Xl("page");i.title=P("ACTION_SEE_ALL"),Ua(i,null,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker}),n.seeAllAction=i;const o=new Tu("action");o.isHorizontal=!1,Cn(e),o.items=e;const a=new ud([o]);a.title=P("PAGE_TITLE_CATEGORIES"),i.pageData=a}else n.items=e;return n}(n,t);return r.title=t.title,r.subtitle=t.subtitle,kn(r,t),r}function sn(e,t){const n=new Tu("editorialCard");n.isHorizontal=!0,t.relationshipDataToFetch="contents";const r=[];for(const n of e){const e={targetType:"hero",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(n),id:n.id,idType:"editorial_id"},i=Pn(n,t,e,()=>{t.remainingItems.push(n)});if(!i)continue;l(i.content)&&(e.adamId=i.content.id);const o=new eu;let a=ne(n,"designBadge");a||(a=i.caption),o.caption=a;let s=ne(n,"title");s||(s=i.title),o.title=s;let c=_n(ne(n,"designTag"));if(c||(c=i.subtitle),o.subtitle=c,i.artwork&&258!==t.featuredContentId){const e=h(i.artwork,"subscriptionHero");o.artwork=In(e,18)}else o.artwork=bn(n,416,204,18);o.clickAction=i.action,Oo(o,_o(n,i.title,e)),o.isValid()&&(r.push(o),Ea(t.metricsLocationTracker))}return delete t.maxItemCount,n.items=r,kn(n,t),n}function ln(){if(ql&&ql.isManagedAppleID)return null;if("watch"===ol){const e=new Tu("action"),t=[],n=new Xl("account");return n.title=P("ACCOUNT","Account"),n.artwork=it("systemimage://person.crop.circle"),t.push(n),e.items=t,e}{const e=new Tu("titledButtonStack"),t=[],n=P("FOOTER_REDEEM","Redeem"),r=new Xl("finance");r.pageUrl="redeem";const i=new su(n,r);if(t.push(i),bs.isMonetaryGiftingEnabled){const e=P("FOOTER_SEND_GIFT","Send Gift"),n=new Xl("finance");n.pageUrl="gift";const r=new su(e,n);t.push(r)}const o=bs.accountTopUpURL;if(o){const e=P("FOOTER_ADD_MONEY"),n=new Xl("finance");n.pageUrl=o;const r=new su(e,n);t.push(r)}const a=new au(t);return a.compactLineBreaks=a.buttons.map((e,t)=>t),e.items=[a],e}}function cn(e,t,n,r){let i;if(y("smallStoryCards")&&"smallStoryCard"===t)i=t;else switch(ol){case"mac":case"tv":i=t;break;case"watch":i="todayCard";break;default:i="todayBrick"}return Dt(e,i,n.title,n.subtitle,r,(function(e){return n.remainingItems.push(e),!1}))}function un(e,t,n){const r=[];let i=!1;for(const a of e){if(!ae(a)||i){t.remainingItems.push(a),i=!0;continue}const e=Lo(ee(a,"editorialArtwork.mediaCard"),{cropCode:"fn",withJoeColorPlaceholder:!0,useCase:16});if(o(e))continue;const l=ne(a,"editorialNotes.name"),c=ne(a,"label"),u=ne(a,"editorialNotes.short"),d=new Au(l,e,c,u),p=jt(a,{pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},null);s(p)&&(d.clickAction=p.clickAction);const f=Y(e.backgroundColor)?"dark":"light";d.shelfBackground={type:"artwork",artwork:e,style:f},r.push(d),Ea(n.metricsLocationTracker)}const a=new Tu("editorialStoryCard");return a.title=t.title,a.items=r,a.background={type:"interactive"},a}function dn(e,t,n,r){const i=new Tu("largeHeroBreakout");i.isHorizontal=!1;const s=l(r)&&a(r.pageTitleEffect)&&0===r.shelves.length,c=l(e)?[e[0]]:[],u=[];for(const e of c){if(o(e.attributes)||On(n)){n.isDeferring=!0,n.remainingItems.push(e);continue}const i=j(e,"primary-content");if(Di(e)&&!ae(i)){n.isDeferring=!0,n.remainingItems.push(e),n.relationshipDataToFetch="primary-content";continue}const c={targetType:t?"heroBreakout":"largeBreakout",pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker,recoMetricsData:ze(e)},d=_i(e),p=Ri(e);if(a(d.video)&&a(p.artwork))continue;const f=d.artworkData||p.artworkData,h=d.backgroundColor||p.backgroundColor,m=t?null:ne(e,"breakoutBadge"),g=ne(e,"label");let y={type:"none"};l(g)&&(y={type:"text",title:g});const w=ca(e,"name")||ye(i,"name"),T=ca(e,"short")||ye(i,"tagline"),A=ki(e,!0,s,!1),I=Pi(e,s,!1),b=new mu(w,T,y,null,A,Ci(I,e)),k=new gu(b,{position:I||"leading"},m,p.artwork,d.video,h),S=_o(e,k.details.title,c);Oo(k,S),Pa(S,k.details.title);const P=Li(e);Na(P,{pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker,recoMetricsData:ze(e),targetType:"button",id:e.id}),k.details.callToActionButtonAction=P,k.clickAction=P,Ca(c.locationTracker),u.push(k),s&&(r.pageTitleEffect=Rn(f))}return i.items=u,kn(i,n),Ea(n.metricsLocationTracker),i}function pn(e,t){if(ie(e,"hide"))return null;const n=[],r=new Tu("action");r.isHorizontal=!1;const i=W(e,"children"),s=l(i),c=te(e,"links");let u=[];s?u=i:l(c)&&(u=c);for(let e=0;e<u.length;e++){const r=u[e];if(o(r))continue;const i={targetType:"link",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker};s&&(i.recoMetricsData=ze(r));let l=null;if(t.isSearchGrouping){const n=vn(r,t.metricsLocationTracker);Oo(n.action,Object.assign(Object.assign({},i),{kind:"link",softwareType:null,title:n.action.title,id:`${e}`,idType:"sequential"})),l=n}else{const e=Pn(r,t,i);if(a(e)||a(e.action.title))continue;l=e.action;const n=En(r);n&&Oo(l,Object.assign(Object.assign({},i),{kind:"link",softwareType:null,title:l.title,id:n}))}a(l)||(n.push(l),Ea(t.metricsLocationTracker))}return r.items=n,r.title=t.title,r.subtitle=t.subtitle,r.presentationHints={isWidthConstrained:!0},kn(r,t),a(r.items)?null:r}function fn(e,t){let n=[];const r=new Tu(t.shelfStyle);let i,a;r.isHorizontal=!0,l(t)&&(i=t.clientIdentifierOverride);for(const r of e){if(o(r.attributes)||On(t)){t.isDeferring=!0,t.remainingItems.push(r);continue}if(_e(r))continue;let e;t.showOrdinals&&(e=E(t.ordinalIndex));let a=null;!s(t.shelfBackground)||"color"!==t.shelfBackground.type&&"interactive"!==t.shelfBackground.type||(a="white");const l={ordinal:e,metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(r)},clientIdentifierOverride:i,artworkUseCase:Do(t.shelfStyle),offerStyle:a,canDisplayArcadeOfferButton:ha(t.shelfStyle)};let c;c="appTrailerLockup"===t.shelfStyle?Xi(r,l,Td):"screenshotsLockup"===t.shelfStyle?Ji(r,l):Ki(r,l),c&&c.isValid()&&(n.push(c),Ea(t.metricsLocationTracker),t.ordinalIndex++)}if(Tn(t.featuredContentId)&&(n=at(n,3)),delete t.maxItemCount,Tn(t.featuredContentId))a=new Xl("topCharts");else{a=new Xl("page");const e=function(e){if(!e)return null;switch(e){case"inAppPurchaseLockup":case"inAppPurchaseTiledLockup":return e;default:return null}}(t.shelfStyle);a.pageData=Pd.seeAllPage(t.title,e)}a.pageUrl=t.seeAllUrl,a.title=P("ACTION_SEE_ALL"),a.referrerUrl=t.metricsPageInformation.pageUrl,Ua(a,t.seeAllUrl,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker}),function(e,t,n){return"tv"!==n||!l(t.remainingItems)&&!(!Tn(t.featuredContentId)||!l(e))}(n,t,ol)&&(r.seeAllAction=a),r.title=t.title,r.subtitle=t.subtitle,r.items=n,r.shouldFilterApps=t.shouldFilter,kn(r,t),"screenshotsLockup"!==t.shelfStyle&&"appTrailerLockup"!==t.shelfStyle||(o(r.presentationHints)?r.presentationHints={showSupplementaryText:!0}:r.presentationHints=Object.assign(Object.assign({},r.presentationHints),{showSupplementaryText:!0}));const c=r.items.length+t.remainingItems.length;return t.shouldReduceSmallLockupShelfHeightToContent&&!t.shouldFilter&&"smallLockup"===t.shelfStyle&&c<3&&(r.rowsPerColumn=c),r}function hn(e,t){t.isFirstRender=!1,t.isDeferring=!1,t.remainingItems=[];let n=new Tu("mediumLockup");const r=t.featuredContentId;switch(r){case 415:case 416:case 417:case 258:n=sn(e.data,t);break;case 425:{const r=j(t.featuredContentData,"children");r&&(n=an(Sn(e.data,W(r,"children")),t));break}case 421:case 422:case 423:case 261:n=on(Sn(e.data,W(t.featuredContentData,"children")),t);break;case 437:case 265:n=pn(t.featuredContentData,t);break;case 475:{const r={metricsLocationTracker:t.metricsLocationTracker,metricsPageInformation:t.metricsPageInformation};n="editorialStoryCard"===t.shelfStyle?un(e.data,t,r):cn(e.data,t.shelfStyle,t,r);break}case 480:switch(ne(t.featuredContentData,"displayStyle")){case"small":n=mn(e.data,t);break;case"hero":n=dn(e.data,!0,t,null);break;case"large":n=dn(e.data,!1,t,null)}break;default:if(yn(r)){n=fn(e.data,t);break}console.warn("Unknown featured content ID:",t.featuredContentId)}if(t.remainingItems.length){const e=t.remainingItems.map(e=>e.id);console.warn("Could not load items for: "+e.join(","))}return n&&(n.mergeWhenFetched=!0,n.networkTimingMetrics=e[ks.timingValues]),t.hasExistingContent||0!==n.items.length||(n.isHidden=!0),t.isSearchGrouping&&(n.seeAllAction=null),n}function mn(e,t){const n=new Tu("smallBreakout");n.isHorizontal=!1;const r=[];for(const n of e){if(o(n.attributes)||On(t)){t.isDeferring=!0,t.remainingItems.push(n);continue}const e=j(n,"primary-content");if(Di(n)&&!ae(e)){t.isDeferring=!0,t.remainingItems.push(n),t.relationshipDataToFetch="primary-content";continue}const i={targetType:"smallBreakout",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(n)},a=ne(n,"label");let s={type:"none"};l(a)&&(s={type:"text",title:a});const c=ca(n,"name")||ye(e,"name"),u=ca(n,"short")||ye(e,"tagline"),d=No(e,{useCase:5,withJoeColorPlaceholder:!0}),f=z(p(ce(e,Ae(n),"artwork"),"textColor4"))||d.backgroundColor,h=new mu(c,u,s,null,Si(f),null),m=new yu(h,d,f),g=_o(n,m.details.title,i);Oo(m,g),Pa(g,m.details.title);const y=Li(n);Na(y,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(n),targetType:"button",id:n.id}),m.details.callToActionButtonAction=y,m.clickAction=y,Ca(i.locationTracker),r.push(m)}return n.items=r,kn(n,t),Ea(t.metricsLocationTracker),n}function gn(e,t=!0){const n=new ec(e),r=P("TERMS_AND_CONDITIONS_TITLE"),i=new Gc(r);i.clickAction=n,i.presentationStyle=["hasChevron","textLightensOnHighlight"],t&&i.presentationStyle.push("hasSeparator");const o=new Tu("footnote");if(o.items=[i],bs.emailSupportLinkURL){const e=new ec(bs.emailSupportLinkURL),n=new Gc("Email Support");n.clickAction=e,n.presentationStyle=["hasChevron","textLightensOnHighlight"],t&&n.presentationStyle.push("hasSeparator"),o.items.push(n)}return o}function yn(e){return Tn(e)||wn(e)||418===e||431===e||429===e||430===e||420===e||304===e||305===e||260===e}function wn(e){return 311===e||312===e||476===e}function Tn(e){switch(e){case 117:case 122:case 118:case 195:case 194:case 197:case 369:case 370:case 371:case 372:case 373:case 374:case 375:case 376:case 377:case 378:case 379:case 380:case 395:case 396:case 397:case 398:case 399:case 400:case 491:case 492:case 493:case 504:case 505:case 506:return!0;default:return!1}}function An(e){switch(e){case 504:case 505:case 506:return!0;default:return!1}}function In(e,t){const n=Lo(e,{useCase:t});return n&&(n.crop="sr"),n}function bn(e,t,n,r){const i=ee(e,"artwork");if(i instanceof Array){const e=function(e,t,n){const r=t/n;let i=0,o=null;for(const n of e){const e=f(n,"width"),a=e/f(n,"height");(a===r||Math.abs(r-a)<=Math.abs(r-i))&&(!o||e<=t&&e>o.width||o.width>t&&e<o.width&&e>o.width)&&(o=n,i=a)}return o?it(p(o,"url"),f(o,"width"),f(o,"height"),null,p(o,"checksum")):null}(i,t,n);return e.crop="bb",e}return null!=i?In(i,r):null}function kn(e,t){t.hasExistingContent=t.hasExistingContent||l(e.items)&&t.isFirstRender,(t.remainingItems.length||t.recommendationsHref)&&t.isFirstRender&&(e.url=`${Pl.internal}:/${Cl.grouping}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(t)))}function Sn(e,t){const n={};for(const t of e)n[t.id]=t;const r=["contents","grouping"],i=[];for(const e of t){let t=!0;for(const i of r){const r=W(e,i);if(s(r)){const o=[];for(const e of r){const t=n[e.id];l(t)&&o.push(t)}o.length===r.length?e.relationships[i]={data:o}:t=!1}}t&&i.push(e)}return i}function Pn(e,t,n,r){const i=l(p(e,"url")),a=l(ne(e,"link.url")),c=G(e,"contents",!1);if(a||i)return function(e,t,n,r){const i=s(p(e,"url"))?e:ee(e,"link");if(o(i)||On(t))return a=e,r?r():t.remainingItems.push(a),null;var a;const l=p(i,"target"),c=p(i,"url"),u=p(i,"label"),d=_n(ne(e,"designTag"))||u;let f=null;if("external"===l)f=new ec(c),f.title=d;else{const e=Ti(c),t=new Xl(e);t.pageUrl=c,t.title=d,f=t}return f.presentationStyle=["textFollowsTintColor"],Na(f,Object.assign(Object.assign({},n),{id:""})),{action:f,caption:null,title:d,subtitle:null,artwork:null,shortEditorialDescription:null}}(e,t,n,r);if(c){const i=j(e,"contents");if(o(i))return null;if(o(i.attributes)||On(t))return t.isDeferring=!0,function(e){r?r():t.remainingItems.push(e)}(i),null;let a=la(i,"tagline")||Wi(i);const s=io(i,La(e,n),t.clientIdentifierOverride);s.presentationStyle=["textFollowsTintColor"];const l=_n(ne(e,"designTag"));s.title=l||s.title;let c=null,u=null;const d=ne(i,"itunesNotes.short");switch(i.type){case"groupings":c=ee(i,"artwork");break;case"editorial-items":{u=ne(i,"label"),u&&(u=u.replace(/\n/g," "));const e=j(i,"contents"),t=p(i,"editorialNotes.tagline");t?a=t:e&&(a=la(e,"short")),s.title=s.title||a||u}default:c=me(i,"editorialArtwork")||ee(i,"editorialArtwork")}return{action:s,caption:u,title:s.title,subtitle:a,artwork:c,shortEditorialDescription:d,content:i}}return null}function Cn(e){e.sort((e,t)=>{try{return e.title.localeCompare(t.title,kl,{usage:"sort"})}catch(e){return 0}})}function vn(e,t){const n=p(e,"label");if(a(n))return null;const r=new nd(n,null,"suggested");return Ma(r,n,t),Ea(t),new bc(r)}function En(e){let t=ne(e,"adamId");return t||(t=ne(e,"contentId")),t||(t=ne(e,"id")),t}function On(e){return e.isDeferring&&e.isFirstRender}function Rn(e,t=!1){if(a(e))return null;let n=null;const r=K("white"),i=K("black"),o=z(p(e,"bgColor")),s=u(e,"textGradient").map(e=>z(e)),l=Si(o);if(2===s.length){n=new Qs("horizontalGradient");const e=s[0],r=s[1];n.gradientStartColor=Q(e,e),n.gradientEndColor=Q(r,r),n.filter="plusLight",t||(n.accessoryColor=n.gradientEndColor)}else n=new Qs("color"),n.color="dark"===l?r:i,t||(n.accessoryColor=n.color),n.isFallbackStyle=!0;return"tv"===ol&&(n.accessoryColor=r),n}function _n(e){if(o(e))return null;const t=e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`").replace(/\r\n/g," ").replace(/&nbsp;/g," ").replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<br>/g," ").replace(/\u23ce/g,"").replace(/<i>/g,"").replace(/<\/i>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");return t.match(/^\s*$/)?null:t}function Dn(e){const t=new Zl("arcade");t.popToRoot=!0;const n=new tc([t]);return n.title=e,n}function Ln(e){return Is.c("developerPageFromResponse",()=>{const t=e.data.length?e.data[0]:null;if(!t)return null;const n=Ke("Artist",t.id,e),r=function(e,t,n){switch(ol){case"mac":return xn("screenshotsLockup",e,Nu,Nu,t,n);case"watch":return xn("smallLockup",e,Uu,P("DEVELOPER_WATCH"),t,n);default:return function(e,t,n){let r,i;switch(function(e){const t=["ios-apps","atv-apps"];if("iOS"!==host.platform)return;const n=H(e,"arcade-apps");if(o(n))return;const r=He(n);if(o(r))return;const i=r.map(e=>e.id);for(const n of t){const t=H(e,n);if(o(t))continue;const r=He(t);o(t)||(e.relationships[n].data=r.filter(e=>!i.includes(e.id)))}}(e),ol){case"tv":r="mediumLockup",i=2;break;default:r="smallLockup",i=1}let l=0;const c=[];for(const o of Ap){const p=H(e,o),f=u(p,"data"),h=f.length;if(0===h)continue;let m,g=!1;"imessage-apps"===o?m=el:"watch-apps"===o?m=Zs:"atv-apps"===o?(m=nl,"tv"!==ol&&(g=!0)):m=Xs;const y=Fn(o,e);Pa({pageInformation:t,locationTracker:n,idType:"sequential",id:`${l}`,targetType:"swoosh"},y);const w={excludeIconInSidepacksIfNotTvOnly:g,lockupOptions:{metricsOptions:{pageInformation:t,locationTracker:n},clientIdentifierOverride:m,artworkUseCase:i},filter:14068},T=Nn(f,r,w);if(T.title=y,p.next){const r=new Xl("page"),i=new Tp;i.title=y,i.href=p.href,i.developerId=e.id,i.relationshipId=o,r.pageUrl=s(d=i)?`${Pl.internal}:/${Cl.developer}/${Cl.room}/`+encodeURIComponent(JSON.stringify(d)):null,r.title=P("ACTION_SEE_ALL"),T.seeAllAction=r,Ua(r,r.pageUrl,{pageInformation:t,locationTracker:n}),r.pageData=Pd.seeAllPage(y)}if("latest-release-app"===o&&0===h)continue;const A=f.filter(e=>a(e.attributes)),I=T.items.length+A.length;I<3&&(T.rowsPerColumn=I);const b={id:null,kind:null,softwareType:null,targetType:"swoosh",title:T.title,pageInformation:t,locationTracker:n,idType:null};if(Ca(n),Oo(T,b),Ea(n),A.length){const e=new wp;e.contentType="smallLockup",e.remainingData=A,e.lockupListOptions=w,T.url=`${Pl.internal}:/${Cl.developer}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(e))}T.items.length>0&&(c.push(T),l++)}var d;return c}(e,t,n)}}(t,n,{rootPosition:0,locationStack:[]});1===r.length&&(r[0].isHorizontal=!1);const i=la(t,"standard");if(i){const e=new Ys(i,"text/x-apple-as3-nqml"),t=new Tu("paragraph");t.items=[e],r.unshift(t)}const l=new ud(r);l.title=ne(t,"name"),"watch"!==ol&&(l.presentationOptions=["prefersLargeTitle"]),Je(l,n);const c=ee(t,"editorialArtwork.bannerUber");return c&&(l.uber=Lo(c,{cropCode:"sr",useCase:20})),l})}function Fn(e,t){switch(e){case"latest-release-app":return P("DEVELOPER_LATEST_RELEASE");case"system-apps":return P("DEVELOPER_SYSTEM_APPS");case"imessage-apps":return P("DEVELOPER_IMESSAGE");case"watch-apps":return P("DEVELOPER_WATCH");case"atv-apps":return P("DEVELOPER_TV");case"app-bundles":return P("DEVELOPER_BUNDLES");case"ios-apps":const e=ie(t,"hasApps"),n=ie(t,"hasGames");return P(e&&n?"DEVELOPER_APPS_AND_GAMES":n?"DEVELOPER_GAMES":"DEVELOPER_APPS");case"arcade-apps":return P("ARCADE_LOCKUP_TITLE");default:return null}}function xn(e,t,n,r,i,o){const s=W(t,n),l={lockupOptions:{metricsOptions:{pageInformation:i,locationTracker:o},artworkUseCase:1},filter:14068};Pa({pageInformation:i,locationTracker:o,idType:"sequential",id:"0",targetType:"swoosh"},r);const c=Nn(s,e,l),u=s.filter(e=>a(e.attributes)),d={id:null,kind:null,softwareType:null,targetType:"swoosh",title:r,pageInformation:i,locationTracker:o,idType:null};if(Ca(o),Oo(c,d),Ea(o),u.length){const t=new wp;t.contentType=e,t.remainingData=u,t.lockupListOptions=l,c.url=`${Pl.internal}:/${Cl.developer}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(t))}return[c]}function Nn(e,t,n){const r=new Tu(t);switch(t){case"screenshotsLockup":r.items=function(e,t){return Is.c("screenshotsLockupsFromData",()=>{if(!e)return[];const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(o(i.attributes)){t.contentUnavailable&&t.contentUnavailable(i.id,r);continue}const a=t.lockupOptions;let s=14334;if(null!==t.filter&&(s=t.filter),_e(i,s))continue;const l=Ji(i,a);l.isValid()&&(n.push(l),Ea(t.lockupOptions.metricsOptions.locationTracker))}return n})}(e,n),r.isHorizontal=!1,r.presentationHints={showSupplementaryText:!1};break;case"smallLockup":default:r.items=ro(e,n),r.isHorizontal="watch"!==ol}return r}function Un(e){return Is.c("shareSheetDataForProductFromProductData",()=>{if(o(e)||"watch"===ol)return null;let t=ne(e,"url");const n=ne(e,"name"),r=ne(e,"artistName"),i=e.id,a=ul;if(!(t&&n&&r&&i))return null;let l=ne(e,"shortUrl"),c=null,u=null;const d=Vo(e,4),p=$o(e),f=ye(e,"subtitle")||r;s(e)&&ne(e,"url")&&(c=No(e,{useCase:1}),u=function(e){return Is.c("notesMetadataFromProductData",()=>{if(o(e))return null;const t=ne(e,"name");if(!t||0===t.length)return null;const n=ne(e,"url"),r=ne(e,"artistName"),i=ne(e,"genreNames.0"),a=Xo(e);let s;switch(e.type){case"apps":s="app";break;case"app-bundles":s="bundle";break;case"in-apps":s="iap";break;default:s=null}return new Gs(t,n,r,i,a,s)})}(e));let h=null;switch(host.clientIdentifier){case el:h="messages";break;case Zs:h="watch"}if(h){const e=new xl(t);if(e.param(_l.clientSpecifier,h),t=e.toString(),l){const e=new xl(l);e.param(_l.clientSpecifier,h),l=e.toString()}}const m=new js(i,a,n,"iOS",c,d,p,!1,f,null,null,u);return new Ws(m,t,l)})}function Mn(e){const t=new Set,n=Ge(e),r=W(n,"canvas");for(const e of r){let r;if(r=$n(e,n),l(r))for(const e of r)t.add(e)}return t}function Bn(e){let t;return"upsellForNonacquisitionCanvas"===e&&(t=za("arcadeStoryCanvas")),"arcadeIcons"===e&&(t=Wa(10)),o(t)?null:$(t).catch(()=>null)}function $n(e,t){if("AppMarker"!==ne(e,"displayType"))return null;const n=ne(e,"appMarkerType"),r=o(Qa(t)),i=[];return"Acquisition"===n&&("iOS"===host.platform&&i.push("arcadeIcons"),r&&i.push("upsellForNonacquisitionCanvas")),i}function Vn(e,t,n){return Is.b(`module: ${n.module}`,()=>{let r;switch(n.module){case"Header":n.titleForNextShelf=ne(e,"editorialCopy"),r=null;break;case"TextBlock":r=function(e,t){const n=ne(e,"editorialCopy");if(!n)return null;const r=new Ys(n,"text/x-apple-as3-nqml","article");jn(r,t);const i=new Tu("paragraph");return i.items=[r],i}(e,n);break;case"CollectionLockup":r=function(e,t){const n=ie(e,"showOrdinals"),r="OrdinalDesc"===ne(e,"collectionLockupDisplayType")?"descending":"ascending",i=ne(e,"collectionLockupSize");let o;if(t.subStyle=i,i)switch(i){case"Large":o="largeLockup";break;case"Medium":o="mediumLockup";break;case"Small":default:o="smallLockup"}const a={metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,artworkUseCase:Do(o),canDisplayArcadeOfferButton:ha(o)},s=ro(W(e,"contents"),{includeOrdinals:n,ordinalDirection:r,lockupOptions:a});if(!s||0===s.length)return null;const l=new Tu(o);return l.items=s,l}(e,n);break;case"InlineImage":r=function(e,t){const n=ne(e,"inlineImageDisplayType"),r=Lo(ee(e,"artwork"),{useCase:13,allowingTransparency:"FullWidth"===n});if(!r)return null;const i=new lu(r,!1,"text/x-apple-as3-nqml");if(i.caption=ne(e,"editorialCopy"),t.subStyle=n,n)switch(n){case"BoundingBox":i.isFullWidth=!1,i.hasRoundedCorners=!0;break;case"FullWidth":default:i.isFullWidth=!0,i.hasRoundedCorners=!1}jn(i,t);const o=new Tu("framedArtwork");return o.items=[i],o}(e,n);break;case"AppLockup":r=function(e,t){const n=Hn(e);if(!n)return null;const r=ne(e,"appLockupSize");let i;t.subStyle=r;let o=!1;if(r)switch(r){case"Small":i="smallLockup",o=!0;break;case"Medium":i="mediumLockup",o=!0;break;case"Large":default:"watch"===ol||"tv"===ol?(i="smallLockup",o=!0):i="appShowcase"}let a=null;const s=pt(e);if(o){const e=new Tu(i),r=Ki(n,{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:s,artworkUseCase:Do(i)});e.items=[r],a=e}else a=function(e,t){const n=new Tu("appShowcase"),r="tv"===ol,i="tv"!==ol,o=Hn(e),a=pt(e),s=Ki(o,{offerStyle:"colored",metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:a,artworkUseCase:1}),l=new xc("large",s);l.description=Wi(o);let c=null;switch(ne(e,"appLockupVideo")){case"AppTrailer":{const e=$o(o);e&&e.length>0&&(c=e[0]);break}}return c&&(ht(c,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId}),l.video=c),r&&(l.screenshots=Vo(o,14,[ol])),i&&(n.background={type:"color",color:xc.backgroundColor}),n.items=[l],n}(e,t);return a}(e,n);break;case"TipBlock":r=function(e,t){const n=Lo(ee(e,"artwork"),{useCase:13});if(!n)return null;const r=ne(e,"editorialCopy"),i=ne(e,"tipNumber"),o=new lu(n,!1,"text/x-apple-as3-nqml");o.isFullWidth=!1,o.hasRoundedCorners=!0,o.caption=r,o.ordinal=i,jn(o,t);const a=new Tu("framedArtwork");return a.items=[o],a}(e,n);break;case"PullQuote":r=function(e,t){const n=ne(e,"quote"),r=ne(e,"quoteAttribution"),i=Lo(ee(e,"artwork"),{useCase:13}),o="FullWidth"===ne(e,"pullQuoteDisplayType"),a=new du(n,r,i,o);jn(a,t);const s=new Tu("quote");return s.items=[a],s}(e,n);break;case"HorizontalRule":r=function(e,t){let n=K("defaultLine");const r=ee(e,"customColor"),i=z(p(r,"lightMode")),o=z(p(r,"darkMode"));a(i)||a(o)||(n=Q(i,o));const s=ne(e,"lineStyle"),l="FullWidth"===ne(e,"displayStyle"),c=new fu(s,n,l),u=new Tu("horizontalRule");return u.items=[c],u}(e);break;case"InlineVideo":r=function(e,t){const n=Lo(ee(e,"video.previewFrame"),{useCase:13});if(!n)return null;const r=ne(e,"video.video");if(!r)return null;const i="FullWidth"===ne(e,"inlineVideoDisplayType"),o=new Mc(r,n,Td);ht(o,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId});const a=new cu(o,i,"text/x-apple-as3-nqml");a.caption=ne(e,"editorialCopy"),jn(a,t);const s=new Tu("framedVideo");return s.items=[a],s}(e,n);break;case"AppMedia":r=function(e,t){const n=Hn(e);if(!n)return null;const r=ne(e,"appMediaOption"),i=ne(e,"appMediaPlatform");switch(t.subStyle=r,r){case"Screenshots":{let e=null;if("mac"===ol){e=new Tu("productMedia");const t=qo(n,14);s(t)&&t.length&&(e.items=t)}else if(e=new Tu("screenshots"),o(i)){const t=Vo(n,14);t&&t.length>0&&(e.items=[t[0]])}else{const t=function(e){switch(e){case"Watch":return"watch";case"iOS":return"pad"===ol?"pad":"phone";case"tvOS":return"tv";case"Messages":return"messages";default:return null}}(i);if(t){const r=Vo(n,14,[t]);r&&r.length&&(e.items=[r[0]])}}return s(e)&&0===e.items.length?null:e}case"AppTrailers":const e=new Tu("framedVideo"),r=$o(n);if(r&&r.length>0){const n=r[0];ht(n,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId});const i=new cu(n,!1,"text/plain",null,null,!0);return e.items=[i],e}return null;default:return null}}(e,n);break;case"LinkBlock":r=function(e,t){const n=ne(e,"url");if(!n)return null;const r=new xl(n),i=ne(e,"urlTitle");let o=ne(e,"editorialCopy");o||(o=r.host);const a=["itunes.apple.com","apps.apple.com","music.apple.com","books.apple.com","podcasts.apple.com"];let s=!1;for(const e of a)r.host.endsWith(e)&&(s=!0);const l=new ec(n);Na(l,{targetType:"link",pageInformation:t.metricsPageInformation,id:`${t.index}`,locationTracker:t.metricsLocationTracker});const c=new nu(i,o,l,s);jn(c,t);const u=new Tu("link");return u.items=[c],u}(e,n);break;case"TextList":r=function(e,t){const n=te(e,"editorialCopy");if(!n.length)return null;const r=ne(e,"textListDisplayType");t.subStyle=r;let i,o=!1;switch(r){case"Bulleted":o=!0;break;default:o=!1}i=o?"<ul>":"<ol>";for(const e of n)i=`${i}<li>${e}</li>`;i=o?`${i}</ul>`:`${i}</ol>`;const a=new Ys(i,"text/x-apple-as3-nqml","article");jn(a,t);const s=new Tu("paragraph");return s.items=[a],s}(e,n);break;case"IAPLockup":r=function(e,t){const n=Hn(e);if(!n)return null;const r=Qi(n,{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,artworkUseCase:1});if(!r)return null;const i=new Uc(r),o=new Tu("inAppPurchaseShowcase");return o.background={type:"color",color:Uc.backgroundColor},o.items=[i],o}(e,n);break;case"AppMarker":r=function(e,t,n){const r=ne(e,"appMarkerType");n.subStyle=r;let i=null;switch(r){case"OSUpgrade":i=function(e,t){if("mac"!==ol)return null;const n=Re(ol);if(null===n)return null;const r=new ec(n);Na(r,{targetType:"link",pageInformation:t.metricsPageInformation,id:`${t.index}`,locationTracker:t.metricsLocationTracker});const i=P("CLIENT_CONTROL_OS_UPGRADE_TITLE","CHECK FOR UPDATE"),o=new hu(i,r);jn(o,t);const a=new Tu("clientControlButton");return a.items=[o],a}(0,n);break;case"Acquisition":i=function(e,t,n){if(!y("arcadeShowcase"))return null;if("iOS"!==host.platform&&"macOS"!==host.platform)return null;let r=Qa(t);if(!r&&n.additionalData&&(r=Ja(n.additionalData.get("upsellForNonacquisitionCanvas"))),!s(r))return null;const i={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},a=Ga(n.metricsPageInformation,n.metricsLocationTracker);a.title=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE");const c=Ui(r.marketingItemData||r.editorialData),u=yt(c,r.inAppData);let d;const p=Oi(r.marketingItemData||r.editorialData);if(l(p)){const t=gt(c),o=s(r.marketingItemData);d=y("arcadeLockupInNavBar")&&(!o&&t||o)?Bi(r.marketingItemData||r.editorialData,r.inAppData,"arcadeStoryCanvas",i):Va("arcadeStoryCanvas",null,{id:e.id,pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker}),s(d)&&(d.title=p)}else d=Ga(n.metricsPageInformation,n.metricsLocationTracker),d.title=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE");const f=new wu(d,a);f.unsubscribedDescription=u;const h=new Ns("arcade",bs.arcadeAppAdamId,"colored",null,"dark",null,null,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId);if(h.titles.subscribed=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE"),f.offerDisplayProperties=h,Oo(f,Object.assign(Object.assign({},i),{targetType:"arcadeShowcase",title:p,id:e.id,kind:"arcadeShowcase",softwareType:null,displaysArcadeUpsell:!0})),"iOS"===host.platform){if(o(n.additionalData))return null;const e=n.additionalData.get("arcadeIcons");if(l(e)){const t={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},r=We(e);f.iconArtworks=xo(r,t,{useCase:2})}}const m=new Tu("arcadeShowcase");return m.items=[f],"iOS"===host.platform&&(m.background={type:"color",color:wu.shelfBackgroundColor}),m}(e,t,n)}return i}(e,t,n);break;case"StoryList":r=function(e,t){const n=W(e,"contents");if(!n)return null;const r=ne(e,"name"),i=ne(e,"tagline");return Dt(n,"mac"===ol||y("smallStoryCards")?"smallStoryCard":"todayBrick",r,i,t,null)}(e,n);break;default:console.log(`Unknown module: ${n.module}`),r=null}return r})}function qn(e){const t=W(e,"card-contents");if(1!==t.length)return null;const n=t[0];if(!n)return null;switch(n.type){case"apps":case"app-bundles":return n;default:return null}}function Gn(){switch(ol){case"mac":return"white";default:return"infer"}}function Hn(e,t){return j(e,"contents")||null}function jn(e,t){if(!e)return;let n=t.module;t.subStyle&&(n=n+"_"+t.subStyle);const r={id:`${t.index}`,impressionIndex:t.index,idType:"sequential",impressionType:n,kind:"iosModule"};e.impressionMetrics=new Ql(Ta(r))}function Wn(e){return(new fh).forType("multiple-system-operators").withIds([e]).includingRelationships(["apps","channel-apps"]).addingQuery("limit[channel-apps]","100")}function zn(e,t){return Is.c("msoRoomPageWithResponse",()=>{const n=Ge(e),r=Ke("Room",n.id,e),i=W(n,"apps"),o=W(n,"channel-apps");for(const e of o){const t=j(e,"app");l(t)&&i.push(t)}const a=new kd;a.ids=i.map(e=>e.id),a.shouldFilter=!1,a.metricsPageInformation=r;const s=function(e,t,n,r=[]){return Is.c("msoRoomPageWithContext",()=>{const i=[],o=[];for(const n of e)-1!==t.indexOf(n.id)?i.push(n):o.push(n);const a={rootPosition:0,locationStack:[]},s={lockupOptions:{metricsOptions:{pageInformation:n.metricsPageInformation,locationTracker:a},artworkUseCase:2}},l=[],c={pageInformation:n.metricsPageInformation,locationTracker:a,targetType:"swoosh",idType:"sequential",id:"0"};if(i.length>0){const e=P("MSO_INCLUDED_IN_SUBSCRIPTION"),t=new kd;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=a,t.preferredShelfContentType="mediumLockup",c.id="0",Pa(c,e),s.contentUnavailable=function(e,n){return t.remainingContent.push(i[n]),!1};const r=new Tu("mediumLockup");r.title=e,r.shouldFilterApps=n.shouldFilter,r.items=ro(i,s),r.url=Yn(t),Ca(a),r.items.length>0&&(Ea(a),l.push(r))}if(i.length>0&&o.length>0){const e=P("MSO_AVAILABLE_WITH_UPGRADED_SUBSCRIPTION"),t=new kd;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=a,t.preferredShelfContentType="mediumLockup",c.id="1",Pa(c,e),s.contentUnavailable=function(e,n){return t.remainingContent.push(o[n]),!1};const r=new Tu("mediumLockup");r.title=e,r.shouldFilterApps=n.shouldFilter,r.items=ro(o,s),r.url=Yn(t),Ca(a),r.items.length>0&&(Ea(a),l.push(r))}if(0===l.length){const t=new kd;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=a,t.preferredShelfContentType="smallLockup",c.id="0",Pa(c,null),s.contentUnavailable=function(n,r){return t.remainingContent.push(e[r]),!1};const r=new Tu("mediumLockup");r.shouldFilterApps=n.shouldFilter,r.items=ro(e,s),r.url=Yn(t),Ca(a),Ea(a),l.push(r)}for(const e of l)e.isHorizontal=l.length>1;const u=r.concat(l);return new ud(u)})}(i,t,a);return s.title=ne(n,"name"),s.isIncomplete=!1,Je(s,r),s})}function Yn(e){return e.remainingContent.length?`${Pl.internal}:/${Cl.mso}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(e)):null}function Kn(e,t){return`${Pl.internal}:/${Cl.reviews}/${Cl.shelf}/${e}/${t}`}function Qn(e){return!(!s(e)||!ie(e,"isFirstPartyHideableApp")&&!ie(e,"reviewsRestricted"))}function Jn(e,t){const n=xl.from(e),r=p(n.query,"displayable-kind");return t&&l(r)&&(n.query["displayable-kind"]=Np[r]||r),n}function Xn(e,t,n){const r=bs.voteUrl,i=p(n,"id","coercible"),o=new xl(r).param("userReviewId",i),a=new lc(o.build()),s=new hc("toast");return t?(a.title=P("ACTION_REVIEW_HELPFUL"),s.title=P("TOAST_HELPFUL_TITLE"),s.message=P("TOAST_HELPFUL_DESCRIPTION"),y("systemImages")?(a.artwork=it("systemimage://hand.thumbsup"),s.artwork=it("systemimage://hand.thumbsup")):(a.artwork=it("resource://ContextActionThumbsUp",28,28),s.artwork=it("resource://ToastThumbsUp.png",90,90))):(a.title=P("ACTION_REVIEW_NOT_HELPFUL"),s.title=P("TOAST_NOT_HELPFUL_TITLE"),s.message=P("TOAST_NOT_HELPFUL_DESCRIPTION"),y("systemImages")?(a.artwork=it("systemimage://hand.thumbsdown"),s.artwork=it("systemimage://hand.thumbsdown")):(a.artwork=it("resource://ContextActionThumbsDown",28,28),s.artwork=it("resource://ToastThumbsDown.png",90,90))),a.method="POST",a.isStoreRequest=!0,a.disableCache=!0,a.headers={"Content-Type":vp.contentType},a.body=(new vp).param("vote",t?"1":"0").param("guid",e).build(),a.successAction=s,a}function Zn(e,t,n,r=!1,i=!0){return Is.c("createReviewItems",()=>{const o=function(e,t){return t?1e3*((new Date).getTime()-e.getTime())<3600?P("TIME_AGO_EDITED_JUST_NOW"):P("TIME_AGO_EDITED_TIME").replace("{time}",_(e)):_(e)};return n.map(n=>{const s=new _p;s.id=p(n,"id","coercible"),s.title=ne(n,"title");const c=ne(n,"date");c&&(s.date=new Date(c),s.dateText=o(s.date,ie(n,"isEdited"))),s.contents=ne(n,"review"),s.rating=oe(n,"rating"),s.reviewerName=ne(n,"userName");const u=ne(n,"developerResponse.id");if(l(u)){const e=new Dp;e.id=u,e.contents=ne(n,"developerResponse.body");const t=ne(n,"developerResponse.modified");t&&(e.date=new Date(t),e.dateText=o(e.date,!1)),s.response=e}return r&&(s.moreAction=function(e,t,n){return n?Is.c("singleReviewActionFromReviewData",()=>{const r=tr(e,t,[n]),i=new Op;i.adamId=p(t,"adamId"),i.targetReviewId=p(n,"id","coercible"),i.shelves=[r];const o=new Xl("reviews");return o.pageData=i,o.title=lr(),o}):null}(e,t,n)),i&&(p(t,"adamId"),s.topLevelAction=function(e,t,n){if(!n)return null;const r=[Xn(e,!0,n),Xn(e,!1,n)];l(bs.reportConcernUrl)&&r.push(function(e,t){return Is.c("reportConcernActionFromApiRow",()=>{const n=p(t,"id","coercible"),r=bs.reportConcernUrl,i=new uc(r);i.method="POST",i.isStoreRequest=!0,i.disableCache=!0,i.needsAuthentication=!0,i.headers={"Content-Type":vp.contentType},i.body=(new vp).param("userReviewId",n).param("guid",e).build();const o=new cc("selectedReason","formBody","decimalPad"),s=new cc("explanation","formBody","text");i.parameters=[o,s];const l=new hc("toast");l.title=P("TOAST_CONCERN_REPORTED_TITLE"),l.message=P("TOAST_CONCERN_REPORTED_DESCRIPTION"),y("systemImages")?l.artwork=it("systemimage://exclamationmark.circle"):l.artwork=it("resource://ToastExclamation.png",90,90),i.successAction=l;let c=bs.reportConcernReasons;a(c)&&(c=[{reasonId:"1",name:"It contains offensive material",upperCaseName:"IT CONTAINS OFFENSIVE MATERIAL"},{reasonId:"8",name:"It's off-topic",upperCaseName:"IT?S OFF-TOPIC"},{reasonId:"111003",name:"It looks like spam",upperCaseName:"IT LOOKS LIKE SPAM"},{reasonId:"7",name:"Something else",upperCaseName:"SOMETHING ELSE"}]);const u=c.map(e=>new zs(p(e,"reasonId"),p(e,"name"),p(e,"upperCaseName"))),d=new yc(u);return d.title=P("ACTION_REVIEW_REPORT"),d.explanation=bs.reportConcernExplanation,a(d.explanation)&&(d.explanation="Tell us a little more (Optional)"),y("systemImages")?d.artwork=it("systemimage://exclamationmark.circle"):d.artwork=it("resource://ContextActionExclamation",28,28),d.sendAction=i,d})}(e,n));const i=new fc(r);return i.isCancelable=!0,i}(e,0,n)),s})})}function er(e,t,n,r=!1){return Is.c("createWriteReviewAction",()=>{const i=P(r?"EDIT_REVIEW":"WRITE_A_REVIEW"),o=function(e,t){return Jn(bs.writeReviewURL,t).param("id",e).build()}(e,t);let a;switch(ol){case"mac":{const t=new pc(e,o);t.title=i,t.appIcon=n,a=t;break}default:{const t=new Xl("writeReview");t.title=i,t.pageUrl=o,t.pageData=e,t.presentationContext="presentModal",a=t;break}}return a})}function tr(e,t,n,r=!1,i=!0){return Is.c("reviewsShelfForReviewsData",()=>{const o=new Tu("reviews");return o.items=Zn(e,t,n,r,i),o})}function nr(e,t,n,r,i,a,c,h=!1,m=!0,g=null,y=!1){return Is.c("reviewsContainerShelfForReviewsData",()=>{const m=function(e,t,n,r,i,a,c=null,h=!1){return Is.c("reviewsContainerForReviewsData",()=>{const m=new xp,g=p(t,"adamId"),y=d(t,"isBundle");if(m.adamId=g,m.ratings=function(e,t){return t?Is.c("ratingsFromApiResponses",()=>{const e=new Rp;e.productId=p(t,"adamId","coercible"),e.ratingAverage=f(t,"ratingAverage"),e.totalNumberOfRatings=f(t,"ratingCount"),e.totalNumberOfReviews=f(t,"totalNumberOfReviews");const n=u(t,"ratingCountList").slice().reverse(),r=n.reduce((e,t)=>e+t,0);if(e.ratingCounts=r>0?n.map(t=>t/r*e.totalNumberOfRatings):n,!(e.ratingAverage>0&&e.ratingCounts)){const n=d(t,"wasReset");e.status=P(n?"RATINGS_STATUS_DEVELOPER_RESET":"RATINGS_STATUS_NOT_ENOUGH_RATINGS")}return e}):null}(0,t),h&&"tv"!==ol||(m.tapToRate=function(e,t,n=null,r=null){const i=new Lp;switch(ol){case"tv":i.title=P("TV_SELECT_TO_RATE");break;case"mac":i.title=P("CLICK_TO_RATE");break;default:i.title=P("TAP_TO_RATE")}return i.rating=r,i.rateAction=function(e,t,n=null){const r=new hc("toast");r.title=P("TOAST_TAP_TO_RATE_TITLE"),r.message=P("TOAST_TAP_TO_RATE_DESCRIPTION"),r.artwork=it("resource://ToastStar.png",95,90);const i=new dc(function(e,t){return Jn(bs.userRateURL,t).param("id",e).build()}(e,t));i.adamId=e,i.method="POST",i.isStoreRequest=!0,i.disableCache=!0,i.successAction=r;const o=new cc("rating","urlQuery","decimalPad"),a=new cc("version-to-review","urlQuery","decimalPad");return i.parameters=[o,a],"tv"===ol&&l(n)&&(i.title=P("TV_RATE_PRODUCT").replace("{title}",n)),i}(e,t,n),i}(g,y,r,c)),s(n)&&n.length>0){const r="watch"===ol,i=!r,o=r?n.slice(0,1):n;m.reviews=Zn(e,t,o,i,i)}if(o(m.reviews)||0===m.reviews.length){const e=m.ratings.ratingAverage>0&&m.ratings.ratingCounts,n=d(t,"wasReset");e||n||(m.ratings.status=P("RATINGS_STATUS_NOT_ENOUGH_RATINGS_OR_REVIEWS"))}if(o(a)||(m.editorsChoice=a),!h||"tv"===ol){const e=s(c)&&c>0;m.writeReviewAction=er(g,y,i,e)}const w=p(t,"supportUrl");if(w){const e=new ec(w,!1);e.title=P("APP_SUPPORT"),m.supportAction=e}return m})}(e,t,n,r,i,a,g,y),w=new Tu("reviewsContainer");return w.title=lr(),w.items=[m],h&&s(m.reviews)&&m.reviews.length>0&&(w.seeAllAction=sr(e,t,n,c,r,i)),w})}function rr(e,t,n){return Is.c("personalizedReviewsContainerShelf",()=>{const r=oe(Ge(n),"rating");return nr(e,t.ratingsData,t.reviewItems,t.appName,t.appIcon,t.editorsChoice,t.nextPageHref,t.includeSeeAllAction,!1,r)})}function ir(e,t,n,r){const i=function(e,t){return`${Pl.internal}:/${Cl.reviews}/${e}/${t}`}(e,t);return new Ep(t,n,r,i)}function or(e,t,n,r,i=null,a=null,s=null,c=null,u=Up){const d=new Op;return d.shelves=[],Is.c("reviewsPageForReviewsData",()=>{let f,h;if(l(i)&&l(n)&&n.length%2>0){const r=n.slice(0,n.length-1);h=n.slice(n.length-1),f=tr(e,t,r,!1)}else f=tr(e,t,n,!1),h=[];const m=o(a)?p(t,"adamId"):a;if(r&&!o(t)){d.adamId=m;const n=nr(e,t,[],s,c);d.shelves.push(n)}return f.items.length>0&&(r&&(f.presentationHints={isSortable:!0},o(t)||(d.initialSortOptionIdentifier=u,d.sortActionSheetTitle=P("REVIEWS_SORT_BY"),d.sortOptions=[ir(m,"helpful",P("REVIEWS_MOST_HELPFUL"),P("REVIEWS_SORT_BY_MOST_HELPFUL")),ir(m,"favorable",P("REVIEWS_MOST_FAVORABLE"),P("REVIEWS_SORT_BY_MOST_FAVORABLE")),ir(m,"critical",P("REVIEWS_MOST_CRITICAL"),P("REVIEWS_SORT_BY_MOST_CRITICAL")),ir(m,"recent",P("REVIEWS_MOST_RECENT"),P("REVIEWS_SORT_BY_MOST_RECENT"))])),d.shelves.push(f),l(i)&&(d.nextPage=function(e,t,n,r){return{url:Kn(e,n),remainingContent:r,nextHref:t,profile:"lockup",maxPerPage:Id,highestOrdinal:0,metricsPageInformation:null,metricsLocationTracker:null}}(m,i,u,h))),d})}function ar(e,t,n,r,i,o){return Is.c("reviewsPageForReviewsMediaContainer",()=>{let a;return a=l(r.data)?n.concat(r.data):n,or(e,null,a,i,r.next,t,null,null,o)})}function sr(e,t,n,r=null,i=null,o=null){return t?Is.c("reviewsPageActionFromReviewsData",()=>{const a=or(e,t,n,!0,r,null,i,o);a.title="watch"===ol?P("PRODUCT_SECTION_REVIEWS"):null;const s=new Xl("reviews");return s.pageData=a,s.title=P("ACTION_SEE_ALL"),s}):null}function lr(){switch(ol){case"tv":return P("TV_PRODUCT_SECTION_RATINGS");case"watch":return null;default:return P("PRODUCT_SECTION_REVIEWS")}}function cr(e){if(!l(e))return null;const t=Lo(e,{useCase:12});return a(t)?null:(t.crop="sr",t)}function ur(e,t,n){let r=0;for(const i of e){const e=t[i.type];if(e){const t=new wc(e.section,!0);t.index=e.index,i.compactAction=t,i.regularAction=t}let o;switch(i.type){case"contentRating":case"editorsChoice":case"rating":o="select";break;default:o="navigate"}i.compactAction&&Na(i.compactAction,{targetType:"badge",id:i.type,actionType:o,actionDetails:{position:r},pageInformation:n.metricsPageInformation,locationTracker:n.locationTracker}),r+=1}}function dr(e,t,n){const r=zi(e);if(a(r))return null;const i=P("BADGE_CATEGORY_HEADING"),s="tv"===ol?"custom":"artwork",l=new od(s,{},"tv"===ol?"annotation":"standard",i,r,null,r,i,"infer");if(new Xl("page").title=ne(e,"artistName"),t&&"tv"!==ol){const t=me(e,"editorialArtwork.brandLogo");if("artwork"===s&&o(t))return null;l.artwork=cr(t)}return l}function pr(e,t,n){const r=me(e,"chartPositions");if(r){const e=function(e){switch(host.clientIdentifier){case Xs:return"appStore";case Zs:return"watch";case el:return"messages";case nl:return"appletv";default:return null}}();if(e){const t=h(r,e);if(t){const e=f(t,"position"),n=p(t,"genreName"),r=p(t,"genre"),i=p(t,"chart"),o=P("BADGE_CHART_POSITION_HEADING"),a=P("PRODUCT_ACCESSIBILITY_BADGE_CHART_POSITION_TITLE").replace("{chartPosition}",e.toString()),s=new od("chartPosition",{position:E(e)},"standard",o,n,null,a,n,"view"),l=function(e,t){return M((new fh).forType("charts").addingQuery("types","apps").addingQuery("chart",t).addingQuery("genre",e)).toString()}(r,i);if(l){const e=new Xl("topCharts");e.pageUrl=l,s.compactAction=e,s.regularAction=e}return s}}}return null}function fr(e,t,n){const r=ne(e,"contentRatingsBySystem.appsApple.name");if(r){const n={contentRating:r},i=function(e){if(!e)return null;switch(e){case 6:return"AgeRatingL";case 7:return"AgeRating10";case 8:return"AgeRating12";case 9:return"AgeRating14";case 10:return"AgeRating16";case 11:return"AgeRating18";default:return null}}(oe(e,"contentRatingsBySystem.appsBrazil.rank"));let o;i&&(n.contentRatingResource=i),o=P(t?"BADGE_AGE_RATING_YEARS":"BADGE_AGE_RATING");const a=P("BADGE_AGE_RATING_HEADING"),s=P("PRODUCT_ACCESSIBILITY_BADGE_AGE_RATING_TITLE");return new od("contentRating",n,"tv"===ol?"annotation":"standard",a,o,null,r,s,"view")}return null}function hr(e,t,n){if(y("tvRequiresControllerString")&&we(e,"requiresGameController")){const e=P("BADGE_MFI_REQUIRED_HEADING"),t=P("BADGE_MFI_SUPPORTED");return new od("controller",{},"standard",e,t,null,null,t,"view")}if(we(e,"supportsGameController")){const e=P("BADGE_MFI_HEADING"),t=P("BADGE_MFI_SUPPORTED");return new od("controller",{},"standard",e,t,null,null,t,"view")}return null}function mr(e,t,n){const r=j(e,"developer"),i=P("BADGE_DEVELOPER_HEADING"),a=ne(e,"artistName"),l="tv"===ol?"custom":"artwork",c=new od(l,{},"tv"===ol?"annotation":"standard",i,a,null,a,i,"infer");if(t&&"tv"!==ol){const e=ee(r,"editorialArtwork.brandLogo");if("artwork"===l&&o(e))return null;c.artwork=cr(e)}const u=ta(r);if(s(u)){const t=new Xl("page");t.title=ne(e,"artistName"),t.pageUrl=u,Na(t,{targetType:"informationRibbon",id:r.id,actionType:"navigate",pageInformation:n.pageInformation,locationTracker:n.locationTracker}),c.compactAction=t,c.regularAction=t}return c}function gr(e,t,n){const r=me(e,"editorialBadgeInfo");if(r){const t=p(r,"editorialBadgeType");if(t&&"editorialPriority"===t){let t;t="Games"===te(e,"genreNames")[0]?P("EDITORIAL_BADGE_GAMES"):P("EDITORIAL_BADGE_APPS");const n=P("EDITORS_CHOICE_SINGLE_LINE"),r=P("PRODUCT_ACCESSIBILITY_BADGE_EDITORS_CHOICE"),i=new od("editorsChoice",{},"standard",n,t,null,r,t),o=new sd("shelf","reviews");return i.compactAction=new wc(o),i.regularAction=i.compactAction,i}}return null}function yr(e,t,n){if(!y("multiplayerBadge"))return null;const r=Te(e,"minPlayers"),i=Te(e,"maxPlayers");if(!s(r)||!s(i))return null;if(r<=0||i<=0||r>i)return null;const o=P("BADGE_PLAYERS_HEADING"),a=Tr(r,i,!1),l=Tr(r,i,!0),c=P("BADGE_PLAYERS_HEADING"),u={paragraphText:wr(r,i)};return new od("paragraph",u,"tv"===ol?"annotation":"standard",o,a,null,l,c,"view")}function wr(e,t){return e===t?e<=32?R(e):P("BADGE_PLAYERS_CAPTION_MULTIPLAYER_INDEFINITE_MIN_AND_MAX_LIMIT").replace("{minPlayers}",R(32)):t<=32?P("BADGE_PLAYERS_CAPTION_MULTIPLAYER_DEFINITE_LIMIT").replace("{minPlayers}",R(e)).replace("{maxPlayers}",R(t)):P("BADGE_PLAYERS_CAPTION_MULTIPLAYER_INDEFINITE_MAX_LIMIT").replace("{minPlayers}",R(e)).replace("{maxPlayers}",R(32))}function Tr(e,t,n){return P(1===e&&1===t?"BADGE_PLAYERS_CAPTION_SINGLE":1===e||n?"BADGE_PLAYERS_CAPTION_MULTIPLAYER":"BADGE_PLAYERS_CAPTION_REQUIRED")}function Ar(e,t,n){if(t&&!y("ribbonReviewBadge")&&"tv"!==ol)return null;const r=ee(e,"userRating");let i=null;const o=Qn(e);if(!o&&r&&r.value&&r.ratingCount){const e=f(r,"value"),t=Math.round(10*e)/10,n=E(t,1),o=f(r,"ratingCount"),a=C("BADGE_RATING_CAPTION_SHORT_TEMPLATE",o).replace("{count}",R(o)),s=C("BADGE_RATING_CAPTION_LONG_TEMPLATE",o).replace("{count}",R(o)).replace("{rating}",n),l=P("PRODUCT_ACCESSIBILITY_BADGE_STAR_RATING").replace("{starCount}",n);i=new od("rating",{rating:t,ratingFormatted:n},"standard",a,a,s,l,a)}else{if(t)return null;const e=P("BADGE_NO_RATINGS_CAPTION");if(o&&"BADGE_NO_RATINGS_CAPTION"!==e)i=new od("rating",{},"standard",null,e,null,e);else if(!o){const e=P("BADGE_NOT_ENOUGH_RATINGS_CAPTION");i=new od("rating",{},"standard",null,e,null,e)}}if(i){const e=new sd("shelf","reviews");return i.compactAction=new wc(e),i.regularAction=i.compactAction,i}return null}function Ir(e,t,n){return e?Is.c("badgesFromLookupResponse",()=>{let r;return r=yo(e)?Bp:"tv"===ol?qp:t?Vp:$p,function(e,t,n,r){const i=[];for(const o of e){const e=o(t,n,r);e&&i.push(e)}return i}(r,e,t,n)}):null}function br(e,t,n,r){const i=function(e,t){switch(e){case"tvOS":return t?ws:ys;case"watchOS":return Ts;case"iOS":return t?hs:y("productLockupBanners")?gs:ms;case"macOS":return t&&y("inlineProductBanner")?hs:ms;default:return ms}}(t,n),o=e?i.purchasedOrdering.slice():i.notPurchasedOrdering.slice(),a=e?i.purchasedSpotlightIndex:i.notPurchasedSpotlightIndex;if(r&&r.spotlightSection){const e=function(e,t){let n=0;for(const r of t){if(r.type===e.type){if("shelf"!==r.type)return n;if(r.shelfId===e.shelfId)return n}n+=1}return-1}(r.spotlightSection,o);-1!==e&&(o.splice(e,1),o.splice(a,0,r.spotlightSection))}return o}function kr(e){return new sd("shelf",e?"subscriptions":"inAppPurchases")}function Sr(e,t,n){const r=e.ids;return r&&r.length?(e.sourcePageInformation=t.metricsPageInformation,e.sourceLocationTracker=t.locationTracker,e.destinationPageInformation=n,`${Pl.internal}:/${Cl.product}/${Cl.shelf}/`+encodeURIComponent(JSON.stringify(e))):null}function Pr(e,t,n,r,i,a){if(!e.data||0===e.data.length)return null;const s=[],l={metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker},artworkUseCase:n,canDisplayArcadeOfferButton:ha(r)},c=o(i)?{}:{offerStyle:i},u=no(e,{lockupOptions:Object.assign(Object.assign({},l),c),shouldConsiderDataPastLastAvailable:!0,contentUnavailable:(e,t)=>(s.push(e),!1),filter:a});if("watch"===ol){const e=u.slice(0,3);return{items:e,unavailableIds:e.length<3?s.slice(0,3-e.length):[]}}return{items:u,unavailableIds:s}}function Cr(e,t){if(!t)return;let n=-1,r=null;t.forEach((t,i)=>{const o=t,a=o,s=o&&o.adamId===e,l=a&&a.productIdentifier===e;(s||l)&&(n=i,r=o,a&&(a.theme="spotlight",a.offerDisplayProperties=a.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"colored","ad","blue")))}),-1!==n&&(t.splice(n,1),t.splice(0,0,r))}function vr(e){if(-1===Af.indexOf(e.media.kind))return!1;const t=e.clickAction;if(!t)return!0;const n=t.pageUrl;if(!n)return!0;const r=new xl(n),i=mf.allPageRoutes();for(const e of i)if(new ku(e).matches(r))return!1;return!0}function Er(e,t,n,r){if(n)return null;const i=zi(e);if(a(i))return null;const o=new Dc(i),s=r?"":P("INFO_LIST_CATEGORY_TITLE");return new _c(s,[o])}function Or(e,t,n,r){const i=ye(e,"requirementsString");if(!s(i))return null;let o=null;if(co(e)){const t=jo(e),n=t&&-1!==t.indexOf(ol),r=function(e){if(host.deviceLocalizedModel)return host.deviceLocalizedModel;switch(e){case"phone":const e=P("IPHONE_BRAND_NAME");return"IPHONE_BRAND_NAME"===e?"iPhone":e;case"pad":const t=P("IPAD_BRAND_NAME");return"IPAD_BRAND_NAME"===t?"iPad":t;case"tv":const n=P("APPLE_TV_BRAND_NAME");return"APPLE_TV_BRAND_NAME"===n?"Apple?TV":n;case"watch":const r=P("APPLE_WATCH_BRAND_NAME");return"APPLE_WATCH_BRAND_NAME"===r?"Apple?Watch":r;case"mac":const i=P("MAC_BRAND_NAME");return"MAC_BRAND_NAME"===i?"Mac":i;case"unknown":default:return null}}(ol);n&&r&&(o=P("INFO_LIST_REQUIREMENTS_SUMMARY").replace("{deviceName}",r))}const a=new Dc(i),l=r?"":P("REQUIREMENTS");return new _c(l,[a],o)}function Rr(e,t,n,r){const i=ee(e,"contentRatingsBySystem.appsApple");if(i){const t=p(i,"name");if(t){const n=u(i,"advisories");let o=null;const a=ce(e,Ae(e),"ageBand"),c=f(a,"minAge"),d=f(a,"maxAge");o=s(c)&&s(d)?P("INFO_LIST_AGE_RATING_SUMMARY").replace("{ageRating}",t).replace("{minAgeRating}",c.toString()).replace("{maxAgeRating}",d.toString()):t;const h=[];if(bs.requireAgeVerification&&function(e,t){let n;return n=4,e>=4}(f(i,"rank"))&&function(e){const t=W(e,"genres");for(const e of t)if(p(e,"id")===6014..toString())return!0;return!1}(e)){let t=null;const n="app-bundles"===e.type;if(n){const n=H(e,"apps");if(s(n))for(const e of n.data)if(s(ne(e,"gracRegistrationNumber"))){t="AppStore.AgeVerification.ProductPage.Rating.BundleUnsuitableForJuveniles";break}}else s(ne(e,"gracRegistrationNumber"))&&(t="AppStore.AgeVerification.ProductPage.Rating.UnsuitableForJuveniles");let r;null!=t&&h.push(new Dc(P(t))),r=n?"AppStore.AgeVerification.ProductPage.Rating.BundleRequiredAge":"AppStore.AgeVerification.ProductPage.Rating.RequiredAge",h.push(new Dc(P(r)+"\n"))}if(o&&h.push(new Dc(o)),n.length>0)for(const e of n)h.push(new Dc(e));let m=null;h.length>1&&(m=o);const g=r?"":P("INFO_LIST_AGE_RATING_TITLE");let y;return l(bs.ageRatingLearnMoreEditorialItemId)&&(y=new Xl("article"),y.title=P("INFO_LIST_AGE_RATING_LEARN_MORE"),y.pageUrl=`https://apps.apple.com/story/id${bs.ageRatingLearnMoreEditorialItemId}`),new _c(g,h,m,y)}}return null}function _r(e,t,n,r){const i=ye(e,"copyright");if(!o(i)){const e=new Dc(i),t=r?"":P("INFO_LIST_COPYRIGHT");return new _c(t,[e])}return null}function Dr(e,t,n,r){const i=ge(e,"languageList");if(a(i))return null;const o=i.length;if(o<1)return null;let l=null,c=null;switch(o){case 0:break;case 1:c=i[0];break;case 2:c=P("INFO_LIST_TWO_LANGUAGES_SUMMARY").replace("{first}",i[0]).replace("{second}",i[1]);break;default:const e=o-1;l=P("INFO_LIST_MORE_LANGUAGES_SUMMARY").replace("{language}",i[0]).replace("{count}",R(e)),c=function(e,t){if(null===e||null===t)return null;if(0===e.length)return"";let n=e.length,r="";return e.forEach((e,i)=>{null===e?n-=1:(r+=e,i<n-1&&(r+=t))}),r}(i,P("CONJUNCTION_SEPARATOR"))}if(!s(c))return null;const u=new Dc(c),d=r?"":P("SUPPORTED_LANGUAGES");return new _c(d,[u],l)}function Lr(e){return Is.c("productCapabilitiesAsAnnotations",()=>{const t=Jo(e),n=[];for(const e of t){let t;switch(e.type){case"gameCenter":t=P("CAPABILITY_GAME_CENTER_TITLE");break;case"siri":t=P("CAPABILITY_SIRI_TITLE");break;case"wallet":t=P("CAPABILITY_WALLET_TITLE");break;case"familySharing":case"familySharingExceptIAP":t=P("CAPABILITY_FAMILY_SHARING_TITLE");break;case"controllers":t=P("CAPABILITY_MFI_CONTROLLERS_TITLE");break;default:t=null}t&&n.push(new Dc(t))}const r=new _c("",n);return r.shouldAlwaysPresentExpanded=!0,r})}function Fr(e,t,n,r){const i=ye(e,"seller"),o=ye(e,"sellerLabel")||P("SELLER");if(!s(i))return null;const a=new Dc(i),l=new _c(r?"":o,[a]);return l&&!n?l:null}function xr(e,t,n,r){const i=Xo(e);if(!t&&s(i)&&!n){const e=O(i),t=new Dc(e),n=r?"":P("FILE_SIZE");return new _c(n,[t])}return null}function Nr(e,t,n,r){const i=W(e,"top-in-apps");if(i.length>0){const e=[];for(const t of i){const n=ne(t,"name"),r=p(fo(t),"priceFormatted");e.push(new Dc(n,r))}const t=r?"":P("INFO_LIST_IN_APP_PURCHASES");return new _c(t,e,P("YES"))}return null}function Ur(e,t,n,r,i,o){const a=[];for(const s of e){const e=s(t,n,r,i);e&&(a.push(e),o&&o(s,a.length-1))}return a}function Mr(e,t,n,r,i,a){return Is.c("create",()=>{let s;switch(ol){case"watch":s=function(e,t,n){return Is.c("standardInformationShelf",()=>{let r;const i=Ur(bf,e,t,!1,!1,null);return i.length>0&&(r=new Tu("annotation"),r.items=i,o(n)||n.addImpressionsToShelf(r,"information")),r})}(e,t,n);break;case"tv":s=function(e,t,n,r){return Is.c("tvInformationShelf",()=>{let i;const a=Ur(kf,e,t,!1,!1,null),s=[Lr(e)].concat(Ur(Sf,e,t,!1,!1,null)),l=Ur(Pf,e,t,!1,!0,null),c=[];if(a.length>0){const e=new Rc(P("PRODUCT_SECTION_INFORMATION"),a,r);c.push(e)}if(s.length>0){const e=new Rc(P("PRODUCT_SECTION_SUPPORTS"),s,r);c.push(e)}if(l.length>0){const e=new Rc(P("PRODUCT_SECTION_TOP_IN_APP_PURCHASES"),l,!0);c.push(e)}return c.length>0&&(i=new Tu("informationContainer"),i.items=[new Lc(c)],o(n)||n.addImpressionsToShelf(i,"information")),i})}(e,t,n,a);break;default:s=function(e,t,n,r,i){return Is.c("standardInformationShelf",()=>{let a;const s=Ur(bf,e,t,r,!1,i);return s.length>0&&(a=new Tu("annotation"),a.title=P("PRODUCT_SECTION_INFORMATION"),a.items=s,o(n)||n.addImpressionsToShelf(a,"information")),a})}(e,t,n,i,r)}return s})}function Br(e,t){return Is.c("versionHistoryPageAction",()=>{const n=$r(e);let r;if(n.length>0){const e=new Tu("titledParagraph");e.items=n;const i=new ud([e]);i.title=P("VERSION_HISTORY_PAGE_TITLE","Version History"),"watch"!==ol&&(i.presentationOptions=["prefersLargeTitle"]),Je(i,Qe("VersionHistory",t,""));const o=new Xl("versionHistory");o.title=P("ACTION_VERSION_HISTORY_SEE_ALL"),o.pageData=i,r=o}return r})}function $r(e){return e?e.map(e=>Vr(e,"detail")):[]}function Vr(e,t){return Is.c("titledParagraphFromVersionHistoryEntry",()=>{const n=p(e,"releaseNotes"),r=new Zc(n,t),i=p(e,"versionDisplay"),o=P("VERSION_STRING_TEMPLATE");switch(t){case"detail":r.primarySubtitle=i;break;default:r.primarySubtitle=o.replace("{version}",i)}const a=p(e,"releaseDate");if(a){const e=new Date(a);r.secondarySubtitle=function(e){let t=Al.relativeDate(e);return t||(t="* null *"),t}(e)}return r})}function qr(e,t){return{targetType:"button",actionType:"navigate",id:e,pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}}function Gr(e){return Is.c("descriptionFromData",()=>{let t=ye(e,"promotionalText");t||(t="");let n=ye(e,"description.standard");n||(n="");let r="";t.length>0&&n.length>0&&(r="\n\n");const i=t+r+n;if(i.length>0){const e=new Ys(i);return e.isCollapsed=!0,e}return null})}function Hr(e,t,n){return Is.c("inAppPurchasesShelf",()=>{if(!function(e){return"macOS"!==host.platform}())return null;if(a(e))return null;const r=H(e,"merchandised-in-apps");if(!r||!r.data.length)return null;if(!r.data.filter((function(e){return ie(e,"isSubscription")===n.isForSubscriptions})).length)return null;const i={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"};let s="infer";yo(e)&&(s="disabled");const l=new Tu("inAppPurchaseLockup");let c=null;n.options&&(c=n.options.spotlightInAppProductIdentifier),function(e,t){for(const n of t.data){let t=H(n,"app");t||(t={data:[e]}),o(n.relationships)&&(n.relationships={}),n.relationships.app=t}}(e,r);const u=[];if(l.items=function(e,t,n,r,i){const o=no(e,{lockupOptions:{metricsOptions:n,offerStyle:t,skipDefaultClickAction:!0,artworkUseCase:1},contentUnavailable:function(e){return u.push(e),!1}});return r&&Cr(r,o),o}(r,s,i,c).filter((function(e){return e.productIdentifier===c&&(n.options.spotlightSection=new sd("shelf",n.isForSubscriptions?"subscriptions":"inAppPurchases")),e.isSubscription===n.isForSubscriptions})),u.length){const r=new Tf(u,l.title,!1,"inAppPurchaseLockup",s,null);r.appBundleId=ye(e,"bundleId"),n.isForSubscriptions?r.inAppShelfId="subscriptions":r.inAppShelfId="inAppPurchases",l.url=Sr(r,t)}let d;return n.isForSubscriptions?(l.title=P("PRODUCT_SECTION_SUBSCRIPTIONS","Subscriptions"),d="subscription"):(l.title=P("PRODUCT_SECTION_IN_APP_PURCHASES"),d="iAP"),Pa(i,l.title),Ca(t.locationTracker),Ea(t.locationTracker),l.isHorizontal=!0,t.addImpressionsToShelf(l,d),l})}function jr(e,t,n,r,i){const o=new ad(e,t,n,r),a=new Ys(r);return a.wantsCollapsedNewlines=!1,o.regularAction=new mc(i,a),o}function Wr(e,t){return Is.c("productPageFromResponse",()=>{const n=Ge(e);if(a(n))return null;s(t)&&(t.iAdClickFields&&(e[ju]=JSON.stringify(t.iAdClickFields)),t.iAdLineItem&&(e[Wu]=t.iAdLineItem));const r="app-bundles"===n.type;if("watch"===ol&&r)throw new Cp("Bundles are not supported on watchOS");const i=ie(n,"isFirstPartyHideableApp"),o=Qn(n),c=Ke(r?"SoftwareBundle":"Software",n.id,e),u={rootPosition:0,locationStack:[]},d=new If(c,u),h=Kr(n,d,t),m=Ia(n,h.icon);c.baseFields.platformDisplayStyle=m;const g=jo(n);Je(h,d.metricsPageInformation,e=>{const t=g&&(Yo(g,ol)||Ko(g,ol)),r=function(e,t){if(!co(e))return!1;if(_e(e,646))return!1;const n=Wo(t),r=jo(e);return n.some(e=>zo(r,e))}(n,ol);e.deviceCompatibility=t&&r?"runnable":t?"purchasable":"none"});const w=sa(n),T=Qr(w),A=fo(n),I={pageInformation:d.metricsPageInformation,locationTracker:d.locationTracker,id:n.id,isAdvert:!!c.iAdInfo&&c.iAdInfo.iAdIsPresent},b=mo(A,n,m,I);let k;if(l(b)){let r;s(t)&&(r=t.clientIdentifierOverride),b.lineItem=p(e,Wu),k=ko(b,n,I,"productPage",!1,r)}if(s(t)&&l(t.externalDeepLinkUrl)&&l(k)){const e={pageInformation:c,locationTracker:u};k=ft(k,b.adamId,t.externalDeepLinkUrl,e)}h.buttonAction=k;const S=wo(b);let v;r&&(v=function(e,t){return e?Is.c("bundleChildrenShelf",()=>{let n;n=new Tu("smallLockup"),n.isHorizontal=!0;const r=e.data.length;if(!r)return null;n.title=C("APPS_IN_BUNDLE",r);const i=Pr(e,t,1,"smallLockup",null,13822);if(i.unavailableIds.length){const e=new Tf(i.unavailableIds,n.title,!1,"smallLockup","infer",null);e.isBundleShelf=!0,n.url=Sr(e,t)}return Pa({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},n.title),n.items=i.items,Ca(t.locationTracker),Ea(t.locationTracker),n.rowsPerColumn=r<2||"tv"===ol?1:2,t.addImpressionsToShelf(n,"bundleChildren"),n}):null}(H(n,"apps"),d)),v&&(h.shelfMapping.bundleChildren=v);const E=function(e,t){return e?Is.c("bundleParentsShelf",()=>{let n;const r=e.data.length;if(!r)return null;n=new Tu("smallLockup"),n.isHorizontal=!0,n.title=P("INCLUDED_IN_BUNDLES").replace("{count}",r.toString());const i=Pr(e,t,1,"smallLockup");if(0===i.unavailableIds.length&&0===i.items.length)return null;if(n.items=i.items,i.unavailableIds.length){const e=new Tf(i.unavailableIds,n.title,!1,"smallLockup","infer",null);e.isBundleShelf=!0,n.url=Sr(e,t)}return n.rowsPerColumn=r<2||"tv"===ol?1:2,t.addImpressionsToShelf(n,"bundleParent"),n}):null}(H(n,"app-bundles"),d);E&&(h.shelfMapping.bundleParents=E);const O=!(1===g.length&&"mac"===g[0]&&"mac"!==ol||S||o),R={productTitle:h.title,shouldShowRatingsAndReviews:O,isFirstPartyHideableApp:i,isBundle:r,isPreorder:S},_=function(e,t,n){return Is.c("create",()=>"watch"===ol?null:a(e)?null:function(e,t,n,r,i,o,a){return Is.c("standardReviewsShelf",()=>{let n=null;const r=jo(e);let s;if(sa(e)||(s=function(e){return Is.c("editorsChoiceItem",()=>{const t=p(me(e,"editorialNotes"),"standard");if(t){const n=new Fp(t),r=me(e,"editorialBadgeInfo");if(r){const e=p(r,"editorialBadgeType");n.showsBadge=e&&"editorialPriority"===e}return n.showsBadge||(n.title=P("APP_STORE_EDITORS_NOTES")),n}return null})}(e)),s&&!o){const t=new xp;return t.adamId=e.id,t.editorsChoice=s,n=new Tu("reviewsContainer"),n.items=[t],n}if(o){const n=H(e,"reviews"),o=ee(e,"userRating");o.ratingAverage=f(o,"value"),o.adamId=e.id,o.isBundle=i,o.supportUrl=ye(e,"supportURLForLanguage");const l=No(e,{useCase:2}),c=1===r.length&&"tv"===r[0];return function(e,t,n,r,i,o,a,s){return Is.c("reviewsContainerShelf",()=>{const l={pageInformation:s.metricsPageInformation,locationTracker:s.locationTracker},c=lr();Pa({pageInformation:s.metricsPageInformation,locationTracker:s.locationTracker,targetType:"swoosh",id:`${s.getSequenceId()}`,idType:"sequential"},c);const u=He(t),d=nr(ll,e,u,n,r,i,t.next,o,!1,null,a);return d.title=c,s.addImpressionsToShelf(d,"ratings"),d.seeAllAction&&Ua(d.seeAllAction,null,l),Ca(s.locationTracker),Ea(s.locationTracker),d})}(o,n,t,l,s,!c,c,a)}return null})}(e,n.productTitle,0,0,n.isBundle,n.shouldShowRatingsAndReviews,t))}(n,d,R);_&&(h.shelfMapping.reviews=_);const D=function(e,t,n){return Is.c("create",()=>(function(e,t,n,r,i){return Is.c("standardMostRecentVersionShelf",()=>{if(!t&&!n&&!r){const t=ge(e,"versionHistory");if(t.length>1&&$r(t).length>0){const n=new Tu("titledParagraph");n.title=P("PRODUCT_SECTION_MOST_RECENT_VERSION");const r=Vr(t[0],"overview");if(n.items=[r],i.addImpressionsToShelf(n,"versionHistory"),n)return"watch"!==ol&&(n.seeAllAction=function(e,t,n){return Is.c("versionHistorySeeAllAction",()=>{const r=Br(e,t);return Ua(r,null,{pageInformation:n.metricsPageInformation,locationTracker:n.locationTracker}),r})}(t,e.id,i)),n}}return null})})(e,n.isFirstPartyHideableApp,n.isBundle,n.isPreorder,t))}(n,d,{isFirstPartyHideableApp:i,isBundle:r,isPreorder:S});D&&(h.shelfMapping.mostRecentVersion=D),h.shelfMapping.textCards=function(e,t){return Is.c("textCardShelfFromResponse",()=>{if(a(e))return null;let n;if("tv"!==ol)return null;n=Cf;const r=new Tu("textCard");return r.title=P("PRODUCT_SECTION_TEXT_CARDS"),r.items=function(e,t){const n=[];for(const r of e){const e=r(t);e&&n.push(e)}return n}(n,e),r.isHorizontal=!0,t.addImpressionsToShelf(r,"links"),r})}(n,d);const L=new Mp,F=Mr(n,i,d,(e,t)=>{e===Rr&&(L.index=t,L.section=new sd("shelf","information"))},T,!1);if(F&&(h.shelfMapping.information=F),w){const e=function(e,t){if(a(e))return null;const n=p(me(e,"editorialNotes"),"standard");if(n){const e=P("APP_STORE_EDITORS_ATTRIBUTION"),r=new pu(n,e),i=new Tu("editorialQuote");return i.items=[r],t.addImpressionsToShelf(i,"editorialQuote"),"phone"!==ol&&"pad"!==ol||(i.background={type:"color",color:K("componentBackgroundStandout")}),i}return null}(n,d);e&&(h.shelfMapping.editorialQuote=e)}h.shelfMapping.links=function(e,t){return Is.c("create",()=>a(e)?null:"tv"===ol?function(e,t){return Is.c("tvLinksShelf",()=>{const n=new Tu("titledButtonStack"),r=[],i=Mr(e,!1,t,null,!1,!0),o=new ud([i]);o.title=ne(e,"name"),"tv"===ol&&o.presentationOptions.push("prefersIndirectTouch");const a=new Xl("page");a.presentationContext="presentModalBlur",a.pageData=o;const l=new su(P("MORE_INFORMATION"),a);if(r.push(l),ye(e,"hasPrivacyPolicyText")){const t=function(e){const t=e.id;return s(e)&&s(t)?`${Pl.internal}:/${Cl.privacyPolicy}?resourceId=${t}`:null}(e);if(t){const e=P("PRIVACY_POLICY"),n=new Xl("unknown");n.pageUrl=t;const i=new su(e,n);r.push(i)}}if(re(e,"hasEula")){const t=function(e){const t=e.id,n=e.type;return s(e)&&s(t)&&s(n)?`${Pl.internal}:/${Cl.tvEula}?resourceType=${n}&resourceId=${t}`:null}(e);if(t){const e=P("LICENSE_AGREEMENT"),n=new Xl("unknown");n.pageUrl=t;const i=new su(e,n);r.push(i)}}const c=new au(r);return c.compactLineBreaks=c.buttons.map((e,t)=>t),n.items=[c],t.addImpressionsToShelf(n,"links"),n})}(e,t):function(e,t){return Is.c("standardLinksShelf",()=>{const n=new Tu("productPageLink"),r=[];if("mac"!==ol){const t=ye(e,"websiteUrl");if(t){const e=new ec(t,!1),n=P("DEVELOPER_WEBSITE");r.push(new iu(n,e,"developer"))}}const i=ye(e,"privacyPolicyUrl");if(i){const e=new ec(i,!1),t=P("PRIVACY_POLICY");r.push(new iu(t,e,"privacy"))}if(re(e,"hasEula")){const t=function(e){const t=e.id,n=e.type;return s(e)&&s(t)&&s(n)?`${Pl.internal}:/${Cl.eula}?resourceType=${n}&resourceId=${t}`:null}(e);if(t){const e=new Xl("page");e.pageUrl=t;const n=P("LICENSE_AGREEMENT");r.push(new iu(n,e,"eula"))}}const o=bs.reportProblemUrl;if(s(o)){const t=new xl(o);t.query.a=e.id,t.query.o="",t.query.s="mac"===ol?"10":"9";const n=new ec(t.build(),!1),i=P("REPORT_A_PROBLEM"),a=bs.reportProblemUrlDaysToDisplay;r.push(new ou(i,n,a))}return r&&r.length>0&&(n.items=r),t.addImpressionsToShelf(n,"links"),n})}(e,t))}(n,d),h.shelfMapping.textLinksShelf=function(e,t){return Is.c("create",()=>{if("tv"!==ol)return null;if(a(e))return null;const n=new Tu("paragraph");n.isHorizontal=!1;const r=function(e){return e?Is.c("externalProductLinksAsParagraphsFromData",()=>{const t=[],n=ye(e,"websiteUrl");if(n){const e=P("DEVELOPER_WEBSITE_WITH_URL").replace("{URL}",n),r=new Ys(e);r.alignment="center",t.push(r)}return t}):null}(e);return r&&r.length>0&&(n.items=r),t.addImpressionsToShelf(n,"links"),n})}(n,d);const x=function(e,t){return Is.c("capabilitiesShelf",()=>{if(a(e))return null;let n;const r=Jo(e);return r.length>0&&(n=new Tu("productCapability"),n.title=P("PRODUCT_SECTION_SUPPORTS"),n.items=r,t.addImpressionsToShelf(n,"supports")),n})}(n,d);x&&(h.shelfMapping.capabilities=x);const N=H(n,"related-editorial-items"),U="mac"===ol||y("smallStoryCards")?function(e,t){return Is.c("smallStoryShelf",()=>{if(!e||!e.data.length)return null;const n={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},r=P("PRODUCT_SECTION_FEATURED_IN");Pa(n,r);const i=[],o={metricsLocationTracker:n.locationTracker,metricsPageInformation:n.pageInformation,filterOutMediaCardKinds:new Set(["appIcon"])},a=Dt(e.data,"smallStoryCard",r,null,o,(function(e){return i.push(e.id),!1}));if(a.isHorizontal=!0,i.length){const e=new Tf(i,a.title,!1,"smallStoryCard");a.url=Sr(e,t)}return Ca(t.locationTracker),t.addImpressionsToShelf(a,"featuredIn"),Ea(t.locationTracker),a})}(N,d):function(e,t){function n(e,t,n){return xt(e.data,t.pageInformation,t.locationTracker,vr,n)}return Is.c("featuredInShelf",()=>{if(a(Ge(e)))return null;const r={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},i=new Tu("todayBrick"),o=P("PRODUCT_SECTION_FEATURED_IN");i.title=o,i.isHorizontal=!1;const s=[];if(i.items=[n(e,r,(function(e){return s.push(e.id),!1}))],s.length){const e=new Tf(s,i.title,!1,"todayBrick");i.url=Sr(e,t)}return Pa(r,o),t.addImpressionsToShelf(i,"featuredIn"),Ca(t.locationTracker),Ea(t.locationTracker),i})}(N,d);U&&(h.shelfMapping.featuredIn=U);const M=function(e,t){return Is.c("moreByDeveloperShelf",()=>{if(a(e))return null;let n;const r=ta(j(e,"developer")),i=ne(e,"artistName"),o=H(e,"developer-other-apps");if(!o||0===o.data.length)return null;const s=P("MORE_BY_DEVELOPER_TEMPLATE").replace("{developer}",i);let l;switch(Pa({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},s),ol){case"mac":case"tv":l="mediumLockup";break;default:l="smallLockup"}n=new Tu(l),n.title=s;const c=Pr(o,t,Do(l),l,"white");if(!c)return null;if(n.items=c.items,c.unavailableIds&&c.unavailableIds.length){const e=new Tf(c.unavailableIds,n.title,!1,l,"white",null);n.url=Sr(e,t)}if("tv"!==ol){const e=new Xl("page");e.pageUrl=r,e.title=P("ACTION_SEE_ALL"),Ua(e,e.pageUrl,{pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),n.seeAllAction=e}return n.isHorizontal=!0,o.data.length<2||"tv"===ol?n.rowsPerColumn=1:n.rowsPerColumn=2,n.background={type:"color",color:wf},t.addImpressionsToShelf(n,"developer"),Ca(t.locationTracker),Ea(t.locationTracker),n})}(n,d);M&&(h.shelfMapping.moreByDeveloper=M);const B=function(e,t){return Is.c("similarItemsShelf",()=>{if(a(e))return null;let n;const r=H(e,"customers-also-bought-apps");if(!r||!r.data.length)return null;const i=P("SIMILAR_ITEMS_TITLE");let o,s;switch(Pa({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"similarItems",id:If.similarItemsShelfId,idType:"relationship"},i),ol){case"tv":o="mediumLockup",s=!1;break;case"mac":o="mediumLockup",s=!0;break;default:o="smallLockup",s=!0}n=new Tu(o),n.title=i;const l=Pr(r,t,Do(o),o,"white");if(n.items=l.items,l.unavailableIds.length){const r=new Tf(l.unavailableIds,n.title,s,o,"white",null),i=Qe("SimilarItems",e.id,"");n.url=Sr(r,t,i)}return n.isHorizontal=!0,r.data.length<2||"tv"===ol?n.rowsPerColumn=1:n.rowsPerColumn=2,n.background={type:"color",color:wf},t.addImpressionsFieldsToSimilarItemsShelf(n,"similarItems","relationship"),Ca(t.locationTracker),Ea(t.locationTracker),n})}(n,d);if(B&&(h.shelfMapping.similarItems=B),!S){const e=Hr(n,d,{isForSubscriptions:!0,options:t});e&&(h.shelfMapping.subscriptions=e);const r=Hr(n,d,{isForSubscriptions:!1,options:t});r&&(h.shelfMapping.inAppPurchases=r)}const $={productTitle:h.title,shouldShowRatingsAndReviews:O,isFirstPartyHideableApp:i,isBundle:r,isPreorder:S,useInlineUberStyle:T},V=function(e,t,n){return Is.c("createActionLinks",()=>a(e)?null:"watch"===ol?function(e,t,n,r,i,o,a,s){return Is.c("actionLinkShelf",()=>{const l=new Tu("action"),c=[];if(r){const n=H(e,"reviews"),r=ee(e,"userRating");r.ratingAverage=f(r,"value"),r.adamId=e.id,r.isBundle=o,r.supportUrl=ye(e,"supportURLForLanguage");const i=He(n),a=No(e,{useCase:2}),s=sr(ll,r,i,n.next,t,a);s.title=P("PRODUCT_SECTION_REVIEWS"),c.push(s)}const u=ge(e,"versionHistory");if(u.length>0&&!i&&!o&&!a){const t=Br(u,e.id);Na(t,qr(e.id,n)),c.push(t)}const d=Mr(e,i,null,null,s,!1),p=new ud([d]),h=new Xl("page");h.title=P("PRODUCT_SECTION_INFORMATION"),p.title=h.title,n.addImpressionsToShelf(l,"information"),Je(p,Xe(e.id,"info")),Na(h,qr(e.id,n)),h.pageData=p,c.push(h);const m=Jo(e);if(m.length>0){const t=new Tu("productCapability");t.items=m;const r=new ud([t]),i=new Xl("page");i.title=P("PRODUCT_SECTION_SUPPORTS"),r.title=i.title,n.addImpressionsToShelf(l,"supports"),Je(r,Xe(e.id,"supports")),Na(i,qr(e.id,n)),i.pageData=r,c.push(i)}const g=ye(e,"privacyPolicyUrl");if(g){const t=new ec(g,!1);Na(t,qr(e.id,n)),t.title=P("PRIVACY_POLICY"),c.push(t)}return l.items=c,n.addImpressionsToShelf(l,"actionLinks"),c.length>0?l:null})}(e,n.productTitle,t,n.shouldShowRatingsAndReviews,n.isFirstPartyHideableApp,n.isBundle,n.isPreorder,n.useInlineUberStyle):null)}(n,d,$);V&&(h.shelfMapping.actionLinks=V),h.pageTopBackgroundColor=null,h.pageBottomBackgroundColor=wf,h.purchasedOrdering=br(!0,host.platform,w,t),h.notPurchasedOrdering=br(!1,host.platform,w,t),zr(t,h);const q={};return q.contentRating=L,h.badges&&ur(h.badges,q,d),null!=h.shelfMapping.informationRibbon&&ur(h.shelfMapping.informationRibbon.items,q,d),h.isComplete=!0,h})}function zr(e,t){if(e&&e.spotlightSection){const n=e.spotlightInAppProductIdentifier;if(n&&"shelf"===e.spotlightSection.type){const r=t.shelfMapping[e.spotlightSection.shelfId];if(!r)return;if(r.presentationHints={isInProductPageSpotlight:!0},Cr(n,r.items),r.url){const e=new xl(r.url);e&&(r.url=e.param(El.offerName,n).build())}}}}function Yr(e,t,n){if(!ml)return null;const r=ne(e,"url"),i=ne(e,"name"),o=ne(e,"artistName");let a=null;t&&(a=t.iAdClickFields);const s=Qe("Software",e.id,`${o}_${i}`,a);return s.pageUrl=r,Kr(e,new If(s,{rootPosition:0,locationStack:[]}),t,n)}function Kr(e,t,n,r){return Is.c("productPageSidePackLockup",()=>{const i=new cd,c=yo(e);c&&s(t)&&s(t.metricsPageInformation)&&(t.metricsPageInformation.offerType="preorder",t.metricsPageInformation.offerReleaseDate=Ao(e)),function(e,t){o(t)||e.pageMetrics.addData(et(t,null),["backButton"])}(i,t.metricsPageInformation);const u=e.id,d=ne(e,"name"),h=ie(e,"isFirstPartyHideableApp"),m=Qn(e);i.adamId=u,i.bundleId=p(e,"bundleId");const g=sa(e);i.uberArtwork=Zo(e,{supportsArcade:g}),"pad"!==ol&&"phone"!==ol||(i.uberArtworkForCompactDisplay=Zo(e,{supportsArcade:g,prefersCompactVariant:!0})),i.uberVideo=ea(e,20),i.logoArtwork=function(e,t){let n,r=null,i=null;switch(ol){case"tv":r="editorialArtwork.contentLogoTrimmed",i="bb";break;default:return null}return n=me(e,r),s(n)&&s(i)?Lo(n,{cropCode:i,useCase:0,withJoeColorPlaceholder:!0}):null}(e);const w=Qr(g);let T;if(s(n)&&(T=n.clientIdentifierOverride),r||(i.icon=No(e,{useCase:10},T)),i.title=d,i.isComplete=!1,i.subtitle=Wi(e),i.developerTagline=ye(e,"subtitle"),i.regularPriceFormatted=ne(e,"regularPriceFormatted"),m||(i.rating=oe(e,"userRating.value")),"tv"===ol){let t;t=null!==i.uberVideo&&null!==i.uberVideo.preview?i.uberVideo.preview.backgroundColor:null!==i.uberArtwork?i.uberArtwork.backgroundColor:No(e,{useCase:10,allowingTransparency:!1,withJoeColorPlaceholder:!0},T).backgroundColor,i.hasDarkUserInterfaceStyle=Y(t,50)}const A=function(e){return y("triforce")?null:"tv"===ol?["tv"]:null}(),I=function(e){return"tv"===ol||"watch"===ol?[ol]:null}(),b=qo(e,11,A,T),k=Bo(e,Td,I);let S=null;if(k)for(const e of b)if(e.mediaPlatform.isEqualTo(k.mediaPlatform)){S=e;break}let C=null;if(S){const e=S.mediaPlatform.appPlatform;if("phone"===e||"messages"===e)for(const e of S.items){const t=e.screenshot;if(C=t.width/t.height,C<1)break}}const v={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,id:u,isAdvert:!!t.metricsPageInformation.iAdInfo&&t.metricsPageInformation.iAdInfo.iAdIsPresent};i.children=Hi(e,{metricsOptions:v,artworkUseCase:1});const E=[],O=[];if(S&&k&&k.videos)for(const e of k.videos){const t=new Bc;t.video=e;const n=e.preview.width/e.preview.height,r=null===C||Math.abs(n-C)<.01,i=S.mediaPlatform.isEqualTo(k.mediaPlatform);r&&i?E.push(t):O.push(e),ht(e,v)}S&&(S.items=E.concat(S.items));let R=null;if(O.length>0&&(R=function(e,t){return Is.c("videoShelf",()=>{if(!e||0===e.length)return null;const n=new Tu("framedVideo");return n.title=P("PRODUCT_SECTION_VIDEOS"),n.items=e.map(e=>new cu(e,!0,"text/plain",null,null,!0)),n.isHorizontal=!0,t.addImpressionsToShelf(n,"videos"),n})}(O,t)),i.media=b,i.mediaSectionTitle="tv"===ol?null:P("PRODUCT_SECTION_SCREENSHOTS_PREVIEW"),g&&null===i.uberVideo&&null===i.uberArtwork&&i.media.length>0&&i.media[0].items.length>0){const e=i.media[0].items[0];i.uberVideo=e.video,i.uberArtwork=e.screenshot}i.appPlatforms=jo(e);const _=fo(e),L=Ia(e,i.icon),F=mo(_,e,L,v);let x,N,U;if(l(F)&&(s(n)&&(F.lineItem=n.iAdLineItem),x=ko(F,e,v,"productPage",!1,T),s(n)&&l(n.externalDeepLinkUrl)&&l(x)&&(x=ft(x,F.adamId,n.externalDeepLinkUrl,v))),i.buttonAction=x,c){i.theme="blue";const e=P("PREORDER_EXPANDED_OFFER_TITLE");let t=null;if(s(F.expectedReleaseDate)){const e=D(P("PREORDER_EXPANDED_OFFER_DATE_FORMAT","MMM d, yyyy"),F.expectedReleaseDate);t=P("PREORDER_EXPANDED_OFFER_SUBTITLE").replace("{releaseDate}",e)}i.expandedOfferDetails=new ld(e,t)}w?(N="white",U="arcadeProductPage"):(N="colored",U="productPage");const M=g?"arcadeApp":"app";let B;i.offerDisplayProperties=vo(F,M,e,N,U,null,null,"productPage"),i.titleOfferDisplayProperties=vo(F,M,e,"colored","productPage",null,null,"productPage");const $=j(e,"developer"),V=ta($);switch(s(V)&&(B=new Xl("page"),B.title=ne(e,"artistName"),B.pageUrl=V,Na(B,{targetType:"button",id:$.id,actionType:"navigate",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker})),i.developerAction=B,ol){case"mac":{const n=Un(e);if(n){const e=new gc(n,[]);Na(e,{targetType:"button",id:u,actionType:"share",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),i.shareAction=e}break}case"phone":case"pad":{const n=Un(e),r=[],a=function(e){if(!bs.isContentGiftingEnabled)return null;if(o(e))return null;const t=fo(e);return o(t)?null:yo(e)?null:f(t,"price")>0?e.id:null}(e);if(a){const e=new Xl("finance");e.presentationContext="presentModal",e.title=P("SHARE_GIFT_APP"),y("systemImages")?e.artwork=it("systemimage://app.gift"):e.artwork=it("resource://action_gift",28,28),e.pageUrl=`gift/${a}`,Na(e,{targetType:"button",id:u,actionType:"gift",actionContext:"shareSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),r.push(e)}if(n){const e=y("expandedShareSheet")?"expanded":"collapsed",o=new gc(n,r,e);o.title=P("SHARE_APP"),y("systemImages")?o.artwork=it("systemimage://square.and.arrow.up"):o.artwork=it("resource://action_share",28,28),Na(o,{targetType:"button",id:u,actionType:"share",actionContext:"shareSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),i.shareAction=o}else if(r.length>0){const e=new fc(r);e.isCancelable=!0,Na(e,{targetType:"button",id:u,actionType:"actionSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),i.shareAction=e}break}}i.shelfMapping={};const q={appPlatforms:i.appPlatforms,clientIdentifierOverride:T,offerButtonShouldBeDisabled:!1,productTitle:i.title},G=function(e,t,n){let r=null,i=null;const o=we(e,"is32bitOnly"),a=we(e,"requires32bit");if((o||a)&&(i=new Tu("banner"),r=P("mac"===ol?"APP_UPDATE_REQUIRED_MACOS":"APP_UPDATE_REQUIRED_IOS"),i.items=[new Nc(r)],n.offerButtonShouldBeDisabled=!0),null===i&&_e(e,2048)&&(i=new Tu("banner"),r=P("OFFER_WATCH_ONLY_BANNER"),i.items=[new Nc(r)],n.offerButtonShouldBeDisabled=!0),null!==i||co(e)||(i=new Tu("banner"),r=P("UNSUPPORTED_CAPABILITIES"),i.items=[new Nc(r)]),null===i&&_e(e,36)&&(i=new Tu("banner"),r=P("UNSUPPORTED_CAPABILITIES"),i.items=[new Nc(r)],n.offerButtonShouldBeDisabled=!0),null===i&&_e(e,8192)){switch(ol){case"mac":r=P("AppStore.Filter.ArcadeComingSoon.macOS");break;case"pad":case"phone":r=P("AppStore.Filter.ArcadeComingSoon.iOS");break;case"tv":r=P("AppStore.Filter.ArcadeComingSoon.tvOS");break;default:r=null}null!==r&&(i=new Tu("banner"),i.items=[new Nc(r)],n.offerButtonShouldBeDisabled=!0)}if(_e(e,512)){const t=ue(e,Ae(e),"minimumOSVersion");switch(ol){case"mac":r=P("UNSUPPORTED_MACOS_VERSION").replace("{osVersion}",t);break;case"phone":case"pad":r=P("UNSUPPORTED_IOS_VERSION").replace("{osVersion}",t);break;case"tv":r=P("UNSUPPORTED_TVOS_VERSION").replace("{osVersion}",t);break;case"watch":const n=ye(e,"minimumWatchOSVersion");r=P("UNSUPPORTED_WATCHOS_VERSION").replace("{osVersion}",n);break;default:r=P("UNSUPPORTED_CAPABILITIES")}i=new Tu("banner"),i.items=[new Nc(r)]}if("watch"===ol&&_e(e,4096)){const t=ue(e,Ae(e),"minimumOSVersion");r=P("UNSUPPORTED_IOS_VERSION").replace("{osVersion}",t),i=new Tu("banner"),i.items=[new Nc(r)]}if(_e(e,128)){n.offerButtonShouldBeDisabled=!0;const e=zo(n.appPlatforms,"phone"),t=zo(n.appPlatforms,"pad"),o=e||t,a=zo(n.appPlatforms,"tv"),s=zo(n.appPlatforms,"mac"),c=zo(n.appPlatforms,"watch");if(y("triforce")){const i=["UNSUPPORTED"];t&&!e?i.push("PAD"):o&&i.push("IOS"),s&&i.push("MACOS"),a&&i.push("TVOS"),c&&i.push("WATCHOS"),i.length>1&&(i.push("ONLY"),r=P(i.join("_")).replace("{appName}",n.productTitle))}else r=s?P("UNSUPPORTED_MACOS_ONLY").replace("{appName}",n.productTitle):a?o?P("UNSUPPORTED_IOS_TVOS_ONLY").replace("{appName}",n.productTitle):P("UNSUPPORTED_TVOS_ONLY").replace("{appName}",n.productTitle):t&&!e?P("UNSUPPORTED_PAD_ONLY").replace("{appName}",n.productTitle):P("UNSUPPORTED_IOS_ONLY").replace("{appName}",n.productTitle);l(r)&&(i=new Tu("banner"),i.items=[new Nc(r)])}da(e)&&(i=new Tu("banner"),r=P("UNSUPPORTED_COMPANION_CONFIGURATION","Requires iPhone"),i.items=[new Nc(r)],n.offerButtonShouldBeDisabled=!0);const s=ye(e,"minimumWatchOSVersion");return null===i&&n.clientIdentifierOverride===Zs&&fa(s)&&(r=P("AppStore.ProductPage.Banner.PairedWatchOSVersionBelowMinimum").replace("{osVersion}",s),i=new Tu("banner"),i.items=[new Nc(r)]),i}(e,0,q);if(G){if("watch"!==ol&&G.items.length>0){const e=G.items[0];null!=e&&(i.bannerText=e.message)}i.shelfMapping.banner=G;const e=i.offerDisplayProperties;q.offerButtonShouldBeDisabled&&l(e)&&(i.offerDisplayProperties=e.newOfferDisplayPropertiesChangingAppearance(!1,"disabled"))}const H=!_e(e,512);if(!h&&!q.offerButtonShouldBeDisabled&&H){const t=function(e){return Is.c("updateOfferDataFromData",()=>{const t=ge(e,"offers");if(0===t.length)return null;for(const e of t)if("update"===p(e,"type"))return e;return null})}(e);i.updateBuyParams=p(t,"buyParams"),i.externalVersionIdentifier=Te(e,"externalVersionId")}if("tv"===ol&&(i.developerTagline?i.descriptionHeader=P("PRODUCT_DESCRIPTION_HEADER").replace("{title}",i.title).replace("{subtitle}",i.developerTagline):i.descriptionHeader=i.title),"tv"===ol)i.description=Gr(e);else{const n={developerAction:B};i.shelfMapping.description=function(e,t,n){return Is.c("descriptionShelf",()=>{if(a(e))return null;const r=new Tu("productDescription"),i=function(e){return e?Is.c("productDescriptionLinksFromData",()=>{const t=[],n=ye(e,"websiteUrl");if(n){const e=new ec(n,!1),r=P("PRODUCT_DEVELOPER_WEBSITE");t.push(new iu(r,e,"developer"))}const r=ye(e,"supportURLForLanguage");if(r){const e=new ec(r,!1),n=P("DEVELOPER_SUPPORT");t.push(new iu(n,e,"support"))}return t}):null}(e),o=Gr(e);if(null===o)return null;const s=new qc(o,i,n.developerAction);return r.items=[s],"watch"===ol&&(r.title=P("PRODUCT_DESCRIPTION")),t.addImpressionsToShelf(r,"description"),r})}(e,t,n)}return R&&(i.shelfMapping.videos=R),i.purchasedOrdering=br(!0,host.platform,g,n),i.notPurchasedOrdering=br(!1,host.platform,g,n),zr(n,i),g&&(i.editorialTagline=P("APPLE_ARCADE")),w?(i.shelfMapping.informationRibbon=function(e,t){const n=new Tu("badge");return n.items=Ir(e,!0,{locationTracker:t.locationTracker,pageInformation:t.metricsPageInformation}),n.isHorizontal=!0,t.addImpressionsToShelf(n,"informationRibbon"),n}(e,t),"tv"!==ol&&(i.badges=[]),i.uberStyle="inline",i.theme="white"):(i.badges=Ir(e,!1,{locationTracker:t.locationTracker,pageInformation:t.metricsPageInformation}),i.uberStyle="above"),i})}function Qr(e){return e&&("phone"===ol||"pad"===ol||"mac"===ol)}function Jr(e,t,n,r){return Is.c("topChartsPageFromApiResponse",()=>{const i=function(e){return u(e,"results.apps").filter(e=>!o(e.data))}(e),a=i.map(n=>(function(e,t,n){return Is.c("segmentFromData",()=>{const r=p(t.query,"genre");let i=p(e,"shortName");const a=p(e,"name"),s=p(e,"chart"),l=Ke("TopChartsPage",r,n,`${s} ${a}`),c={rootPosition:0,locationStack:[]},u=[];let d=0;const f=[];for(const t of e.data){const e=ei(d,t,l,c);if(e){if(_e(t))continue;u.push(e),Ea(c),d++}else f.push(t)}const h=[],m=new Tu("smallLockup");m.items=u,h.push(m),o(i)&&(i=a);const g=new Of(i,a,s,h),y=dt(f,null,e.next,l,c);return y.metricsPageInformation=l,y.metricsLocationTracker=c,y.highestOrdinal=d,g.nextPage=y,Je(g,l),g})})(n,t,e)).sort((e,t)=>e.chart.localeCompare(t.chart)),s=p(i,"0.href"),l=new xl(s),c=l.query.genre,d=l.query.ages,f=P("PAGE_TITLE_TOP_CHARTS"),h=[];if(null!=n)for(const e of n.categories)e.genreId&&h.push(Xr(e));const m=function e(t,n,r){for(const i of r){if(n&&i.ageBandId===n||!n&&!i.ageBandId&&i.genreId===t)return i;const r=e(t,n,i.children);if(r)return r}return null}(c,d,h);let g;g=null!=m?new _f(c,m.ageBandId,f,a,m.name,h):new _f(c,null,f,a,null,h);const y=a.findIndex(e=>e.chart===r);return y>=0&&(g.initialSegmentIndex=y),g})}function Xr(e){const t=function(e,t=null){let n=(new fh).forType("charts").addingQuery("types","apps").addingQuery("genre",e);return t&&(n=n.addingQuery("ages",t)),n}(e.genreId,e.ageBandId),n=e.children.map(e=>Xr(e));return new Rf(e,M(t).toString(),n)}function Zr(e,t,n){return Is.c("topChartSegmentFromLookupResponse",()=>{const r=[];let i=t.highestOrdinal;const o=He(e);for(const e of o)_e(e)||(r.push(ei(i,e,t.metricsPageInformation,t.metricsLocationTracker)),Ea(t.metricsLocationTracker),i++);const a=[];if(r.length>0){const e=new Tu("smallLockup");e.items=r,a.push(e),n.highestOrdinal=i}const s=new Of(null,null,null,a);return s.nextPage=n,s})}function ei(e,t,n,r){return Is.c("lockupFromApiChartItem",()=>Ki(t,{ordinal:E(e+1),metricsOptions:{pageInformation:n,locationTracker:r},artworkUseCase:1}))}function ti(e,t,n){if(e&&e.mediaPlatform&&t&&t.mediaPlatform&&!e.mediaPlatform.isEqualTo(t.mediaPlatform))return ci(`SearchAd [${n}] filtered because media is derived from: ${t.mediaPlatform.mediaType}, but first ad media is derived from: ${e.mediaPlatform.mediaType}`),!1;let r=!0;switch(e.style){case"TEXT":r="TEXT"===t.style;break;case"LV1":case"LI1":r="LV1"===t.style||"LI1"===t.style;break;case"PI3":case"PI2":case"PI1":case"PV3":case"PV2":case"PV1":r="PI3"===t.style||"PI2"===t.style||"PI1"===t.style||"PV3"===t.style||"PV2"===t.style||"PV1"===t.style;break;default:r=!1}return r||ci(`SearchAd [${n}] filtered because style: ${li(t)} is not compatible with the display style of: ${li(e)}`),r}function ni(e,t){let n=null;const r=p(ee(e,"iads"),t);return r&&r.length&&(n=JSON.parse(r)),n}function ri(e,t){return a(t)?"NOORGANIC":t.id===e.id?"DUP":"NORMAL"}function ii(e,t){return Is.c("searchResultContainerFromData",()=>{const n=eo(e,t,Lf),r=Ia(e,n.icon),i=Ro(e,n,r,t.metricsOptions,!0);return n.clickAction.actionMetrics.clearAll(),function(e,t){if(!o(e.searchAd)&&(e.clickAction&&Na(e.clickAction,t,!0),e.searchAd.transparencyAction)){const n=t.pageInformation,r={actionType:"ad_transparency"};n.iAdInfo&&Object.assign(r,n.iAdInfo.clickFields);const i=be(e.adamId,"button",r);i.includingFields.push("advertRotation"),e.searchAd.transparencyAction.actionMetrics.addMetricsData(i)}}(n,i),function(e,t,n){if(!e||!n)return;Oo(e,t);const r=Ta(n.fastImpressionFields);Object.assign(e.impressionMetrics.fields,r),e.impressionMetrics.isFast=!0,e.impressionMetrics.fields.parentId="ad_container"}(n,i,t.metricsOptions.pageInformation.iAdInfo),n})}function oi(e,t,n,r){const i=d(me(e,"iad"),"format.images"),o=a(r);if(!i)return ci(`SearchAd [${e.id}] is not allowed to display media because of iAd configuration.`),{style:"TEXT"};let s=null;const c=eo(e,n,Lf),u=c.trailers[0];let p=null;l(u)&&(u.videos.sort((e,t)=>Ff(e.preview,t.preview)),p=u.videos,s=u.mediaPlatform);const f=c.screenshots[0];let h=null;l(f)&&(f.artwork.sort(Ff),h=f.artwork,s=f.mediaPlatform);const m=function(){let e=null;l(p)&&(e=p.shift().preview);const t={style:null,mediaPlatform:s};switch(l(e)&&e.isLandscape()?t.style="LV1":l(e)&&e.isPortrait()?h&&h.length>=2?t.style="PV3":h&&h.length>=1?t.style="PV2":t.style="PV1":l(h)&&h[0].isLandscape()?t.style="LI1":l(h)&&h[0].isPortrait()?h.length>=3?t.style="PI3":h.length>=2?t.style="PI2":t.style="PI1":t.style="TEXT",2===si()&&"PI3"===t.style?t.style="PI2":2===si()&&"PV3"===t.style&&(t.style="PV2"),t.style){case"PI3":h.splice(0,3);break;case"PV3":case"PI2":h.splice(0,2);break;case"LI1":case"PI1":h.splice(0,1)}return t},g=m();if(ci(`SearchAd [${e.id}] tentatively resolved to: ${li(g)}`),"DUP"===t){const t=m();switch(t.style){case"PV3":case"PI3":case"LI1":case"LV1":return o?(ci(`SearchAd [${e.id}] Organic Dupe would be full creative as ${t.style} so choosing tentative style for ad`),g):(ci(`SearchAd [${e.id}] Organic Dupe wold be a full creative, but is not the first so returning ${t.style}`),t);case"PV2":case"PI2":return 2===si()?o?(ci(`SearchAd [${e.id}] Organic Dupe would be full creative as ${t.style} so choosing tentative style for ad`),g):(ci(`SearchAd [${e.id}] Organic Dupe would be a full creative, but is not the first ad so returning first result display style: ${li(t)}`),t):(ci(`SearchAd [${e.id}] tentative style would not yield full creative for organic result so returning TEXT`),{style:"TEXT"});default:return ci(`SearchAd [${e.id}] tentative style would not yield full creative for organic result so returning TEXT`),{style:"TEXT"}}}else if(r&&"TEXT"===r.style)return ci(`SearchAd [${e.id}] tentative style would be filtered since the first ad has style: ${li(r)}, so returning TEXT`),{style:"TEXT"};return g}function ai(e,t,n,r){const i=n&&!r;if(l(e.trailers)){const t=e.trailers.shift();t.videos.sort((e,t)=>Ff(e.preview,t.preview)),e.trailers.unshift(t)}if(l(e.screenshots)){const t=e.screenshots.shift();t.artwork.sort(Ff),e.screenshots.unshift(t)}switch(t.style){case"PI3":e.trailers=null,i?e.screenshots[0].artwork.splice(0,3):e.screenshots[0].artwork.splice(3);break;case"PI2":e.trailers=null,i?e.screenshots[0].artwork.splice(0,2):e.screenshots[0].artwork.splice(2);break;case"LI1":case"PI1":e.trailers=null,i?e.screenshots[0].artwork.splice(0,1):e.screenshots[0].artwork.splice(1);break;case"PV3":i?(e.trailers[0].videos.splice(0,1),e.screenshots[0].artwork.splice(0,2)):(e.trailers[0].videos.splice(1),e.screenshots[0].artwork.splice(2));break;case"PV2":i?(e.trailers[0].videos.splice(0,1),e.screenshots[0].artwork.splice(0,1)):(e.trailers[0].videos.splice(1),e.screenshots[0].artwork.splice(1));break;case"LV1":case"PV1":i?e.trailers[0].videos.splice(0,1):e.trailers[0].videos.splice(1),e.screenshots=null;break;case"TEXT":e.trailers=null,e.screenshots=null}if(l(e.trailers)){const t=e.trailers.shift();e.trailers=[t]}if(l(e.screenshots)){const t=e.screenshots.shift();e.screenshots=[t]}return e}function si(){return"phone"===ol?3:2}function li(e){if(a(e))return"";let t="";return e&&e.mediaPlatform&&(t=` derived from ${e.mediaPlatform.mediaType} media`),`${e.style}${t}`}function ci(e){console.log(e)}function ui(e,t){if(!(t.resultModel instanceof zc))return;const n=t.resultModel,r=e.resultModel;if(r.adamId!==n.adamId)return;const i=new Set;if(l(r.screenshots))for(const e of r.screenshots[0].artwork)i.add(e.template);if(l(r.trailers))for(const e of r.trailers[0].videos)i.add(e.preview.template);if(l(n.screenshots)){const e=n.screenshots[0].artwork.filter(e=>!i.has(e.template));n.screenshots[0]=new $s(e,n.screenshots[0].mediaPlatform)}if(l(n.trailers)){const e=n.trailers[0].videos.filter(e=>!i.has(e.preview.template));n.trailers[0]=new Kc(e,n.trailers[0].mediaPlatform)}}function di(e,t,n=null,r=null,i=host.clientIdentifier){let o=["apps","top-apps"],a=["screenshotsByType","messagesScreenshots","videoPreviewsByType","requiredCapabilities","editorialBadgeInfo","supportsFunCamera","minimumOSVersion"];y("refreshRibbon")||"pad"!==ol||(o=o.concat(["developer"]),a=a.concat(["minPlayers","maxPlayers","fileSizeByDevice","requiresGameController","supportsGameController","languageList","supportedLocales"]));let s=(new fh).withSearchTerm(e).includingAdditionalPlatforms(pi(fs)).includingRelationships(o).includingAttributes(a).includingRelationshipsForUpsell(!0);s="story"===n?s.searchingOverTypes(["editorial-items"]):"developer"===n?s.searchingOverTypes(["developers"]):"watch"===n||"arcade"===n?s.searchingOverTypes(["apps"]).withFilter("contexts",n):"tv"===ol?s.searchingOverTypes(["apps","developers","groupings","editorial-items"]):s.searchingOverTypes(["apps","developers","groupings","editorial-items","app-bundles","in-apps"]);for(const e of Object.keys(t))s.addingQuery(e,t[e]);switch("hints"===r?s.addingQuery("src","hint"):"trending"===r&&s.addingQuery("src","trending"),i){case Zs:s.addingContext("watch");break;case el:s.addingContext("messages");break;case tl:s.addingContext("arcade")}return y("rotatingAdverts")&&s.addingQuery("limit[ads-result]",bs.mediaAdvertRequestLimit.toString()),s}function pi(e=fs){switch(e.deviceType){case"pad":return["iphone"];default:return[]}}function fi(e,t){const n=new Ku;return s(e)&&(n.facets=hi(e,t)),n.results=[],n}function hi(e,t){const n=[];if("mac"!==ol&&n.push(new Qu("targetPlatform",[new Ju(P("SEARCH_FACET_IPAD_ONLY"),null,e.targetPlatform),new Ju(P("SEARCH_FACET_IPHONE_ONLY"),"iphone",e.targetPlatform)])),n.push(new Qu("price",[new Ju(P("SEARCH_FACET_ANY_PRICE","Any"),null,e.price),new Ju(P("SEARCH_FACET_FREE","Any"),"free",e.price)])),t){const r=t.categories;if(r.length){const t=r.filter(e=>s(e.genreId)).map(t=>new Ju(t.name,t.genreId,e.genre));t.unshift(new Ju(P("SEARCH_FACET_ANY_CATEGORY","Any"),null,e.genre)),n.push(new Qu("genre",t))}}const r=bs.searchSortOptions,i=[];i.push(new Ju(P("SEARCH_FACET_RELEVANCE"),null,e.sort));for(const t of r)i.push(new Ju(P("SEARCH_FACET_"+t),t,e.sort));i.length>1&&n.push(new Qu("sort",i));const o=bs.ageBands.map(t=>new Ju(p(t,"name"),p(t,"ageBandId"),e.ages));return o.length>0&&"mac"!==ol&&n.push(new Qu("ages",o)),n}function mi(e){return"watch"===e?Zs:null}function gi(e,t,n,r,i){return Is.c("searchResultContainerFromData",()=>{let a;const c=e.type,u={metricsOptions:{pageInformation:t,locationTracker:n,targetType:"card"},hideZeroRatings:!0,artworkUseCase:8,isNetworkConstrained:r,canDisplayArcadeOfferButton:ha("mixedMediaLockup"),clientIdentifierOverride:mi(i)};switch(c){case"rooms":case"multirooms":case"developers":case"editorial-items":case"groupings":const t={pageInformation:u.metricsOptions.pageInformation,locationTracker:u.metricsOptions.locationTracker},n=Nt(e,{useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0},t);if(n&&n.media&&"inAppPurchase"===n.media.kind){const e=n.media.lockup;e.theme="dark",a=new Xu("inAppPurchase",e)}else{const t=function(e,t){return Is.c("editorialSerachResultFromData",()=>{let n=new td;n.title=ne(e,"name");const r={pageInformation:t.pageInformation,locationTracker:t.locationTracker};switch(e.type){case"groupings":const t=te(e,"contentIds");if(l(t))n.collectionAdamIds=t;else{const t=Lo(ee(e,"artwork"),{useCase:9,allowingTransparency:!0});n.iconArtwork=t}n.type="category";break;case"rooms":case"multirooms":n.artwork=Lo(ee(e,"artwork"),{useCase:9,cropCode:"sr"}),n.collectionAdamIds=te(e,"contentIds"),n.type="collection";break;case"editorial-items":n=function(e,t){const n=Nt(e,{useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0,prevailingCropCode:"fo"},t);if(!n)return null;const r=new td;r.type="story",r.title=n.title,r.clickAction=n.clickAction;let i=null;if(n.media)switch(n.media.kind){case"brandedSingleApp":const t=n.media;switch(r.artwork=t.art,o(r.artwork)&&(r.iconArtwork=t.icon),ne(e,"displaySubStyle")){case"GameOfDay":case"AppOfDay":const t=j(e,"card-contents");t&&(r.title=ne(t,"name")||r.title)}break;case"list":case"river":i=n.media.lockups;break;case"artwork":const a=n.media;r.artwork=a.art;break;case"grid":case"multiApp":i=n.media.lockups;break;case"video":const s=n.media;if(r.artwork=s.video.preview,r.video=s.video,n.overlay instanceof Wd){const e=n.overlay;r.title=e.title,r.subtitle=e.description}else r.subtitle=s.description}if(n.overlay)switch(n.overlay.kind){case"lockup":const e=n.overlay;r.artwork||(i=[e.lockup]);break;case"lockupList":i=n.overlay.lockups;break;case"paragraph":const t=n.overlay;r.subtitle=t.paragraph.text}if(s(i)){r.collectionAdamIds=[],r.collectionAppIcons=[];for(const e of i)r.collectionAdamIds.push(e.adamId),r.collectionAppIcons.push(e.icon)}const a=ne(e,"alternateLabel");l(a)&&a!==r.title&&(r.tagline=a);const c=n.heroMedia;return l(c)&&(l(c.art)?(r.artwork=c.art,r.artwork.crop="em"):l(c.video)&&(r.video=c.video)),r.video&&(r.video.showPlaybackControls=!1,r.video.canPlayFullScreen=!1,r.video.playbackControls={}),r.collectionAdamIds||r.artwork||r.iconArtwork?r:null}(e,r);break;case"developers":if(n.artwork=Lo(ee(e,"editorialArtwork.bannerUber"),{useCase:9,cropCode:"sr"}),!n.artwork){let t=W(e,"top-apps");t=t.filter(e=>!_e(e,14068));const r=[],i=[];t.forEach(e=>{r.push(e.id);const t=No(e,{useCase:9});s(t)&&i.push(t)}),n.collectionAdamIds=r,n.collectionAppIcons=i}n.type="developer"}if(n){if(null!=n.collectionAdamIds&&n.collectionAdamIds.length){const e=n.collectionAdamIds.length;n.artworkGridType=e<=8?"large":e<=16?"mixed":"small"}const r=_o(e,n.title,t);n.clickAction=io(e,r,null),Oo(n,r)}return n})}(e,u.metricsOptions);if(!t)return null;t.title&&(t.title=t.title.replace(/\n/g," ")),t.subtitle&&(t.subtitle=t.subtitle.replace(/\n/g," ")),a=new Xu("editorial",t)}break;case"in-apps":const r=Qi(e,u);r.theme="dark",a=new Xu("inAppPurchase",r);break;case"apps":case"app-bundles":default:if(delete e.attributes.iad,"app-bundles"===c){const t=function(e,t){return Is.c("bundleLockupFromData",()=>{const n=new Xc;return function(e,t,n){e&&Is.c("copyDataIntoBundleLockup",()=>{Gi(e,t,n);const r=H(e,"apps");if(r){const e={lockupOptions:n};t.children=no(r,e)}})}(e,n,t),n})}(e,u);a=new Xu("bundle",t)}else{const t=Zi(e,u,xf);a=new Xu("content",t)}}return a})}function yi(e){return JSON.stringify(e)}function wi(e){if(Uf.has(e.builderClass))throw new Error(`routing: Registering duplicate builderClass ${e.builderClass}`);Uf.add(e.builderClass),Mf.associate(e.pageRoute,e),Bf.associate(e.shelfRoute,e),$f.associate(e.paginationRoute,e)}function Ti(e){const t=Mf.routedObjectForUrl(e);if(!t.object)return"unknown";const n=t.object;return"ProductAdapterBuilder"===n.builderClass&&t.parameters[El.action]!==yf&&t.parameters[El.action]!==gf?"product":n.pageType()}function Ai(e,t){return Ii(e).then(n=>new Promise((r,i)=>{if(!n)throw new Error(`Promise resolved to null action for: ${e}`);if("FlowAction"===n.actionClass){const e=n.pageData;return Oe(e,t)?void r(e):void i(new Error(`${e} is not expected type ${t.name}`))}if("TabChangeAction"===n.actionClass){const e=n;if(1===e.actions.length&&"FlowAction"===e.actions[0].actionClass){const n=e.actions[0].pageData;return Oe(n,t)?void r(n):void i(new Error(`${n} is not expected type ${t.name}`))}}i(new Error("Action is not a flowAction or a tabChangeAction that contains a single flowAction."))}))}function Ii(e){return new Promise((t,n)=>{const r=Mf.routedObjectForUrl(e);r.object?r.object.handlePage(r.normalizedUrl,r.parameters,r.matchedRuleIdentifier,t,n):function(e,t,n){net.fetch({url:e.toString(),method:"GET"}).then(r=>{200===r.status&&r.redirected&&r.url?Ii(r.url).then(t,n):n(new Error(`redirectAndRefetchActionIfPossible: Unhandled page url: ${e}`))})}(r.normalizedUrl,t,n)})}function bi(e){return new Promise((t,n)=>{const r=e.url;if(!r)return void n(new Error("Page token missing required `url` property"));const i=$f.routedObjectForUrl(r);i.object?i.object.handlePagination(i.normalizedUrl,i.parameters,i.matchedRuleIdentifier,e,t,n):n(new Error(`fetchMoreOfPage: Unhandled pagination url: ${r}`))})}function ki(e,t=!0,n,r){const i=_i(e),o=Ri(e),a=i.backgroundColor||o.backgroundColor,s=Pi(e,n,r);return(("marketing-items"===e.type?d(vi(e),"displayMaterial"):ie(e,"displayBreakoutMaterial"))||"tv"===ol&&"center"===s)&&t?"material":Si(a)}function Si(e){return e?Y(e,50)?"dark":"light":"dark"}function Pi(e,t,n){if("phone"===ol||n)return"center";if("tv"===ol)return t?"center":"leading";const r="marketing-items"===e.type?p(vi(e),"textPosition"):ne(e,"breakoutTextAlignment");if(!l(r))return"mac"===ol?"center":"leading";switch(r.toLowerCase()){case"left":return"leading";case"center":return"center";case"right":return"trailing";default:return"leading"}}function Ci(e,t,n=!1){const r="tv"===ol;switch(e){case"leading":case"trailing":return r?"center":"leading";case"center":return n&&!r?"center":r?"leading":"marketing-items"===t.type?"center":function(e){var t;switch((null!==(t=ne(e,"breakoutTextAlignment"))&&void 0!==t?t:"").toLowerCase()){case"left":return"leading";case"center":return"center";case"right":return"trailing";default:return"mac"===ol?"center":"leading"}}(t);default:return"leading"}}function vi(e){return"marketing-items"!==e.type?null:ee(e,"display.templateParameters")}function Ei(e){return"editorial-items"===e.type?ee(e,"editorialArtwork"):ee(e,"marketingArtwork")}function Oi(e){switch(e.type){case"marketing-items":return p(ho(e),"callToActionLabel");default:return ne(e,"breakoutCallToActionLabel")}}function Ri(e,t=!1){const n=Ei(e),r="phone"===ol,i="tv"===ol;let o=r?"breakoutTall":"breakoutFullScreen";t&&(o="topShelf");const a=h(n,o);let s=null,c=null;return l(a)&&(s=Lo(a,{withJoeColorPlaceholder:!0,useCase:6}),l(s)&&(s.crop=r?"oa":t?"ta":i?"od":"ob",c=s.backgroundColor)),{artwork:s,artworkData:a,backgroundColor:c}}function _i(e,t=!1){const n=function(e){return"editorial-items"===e.type?ee(e,"editorialVideo"):ee(e,"marketingVideo")}(e),r="phone"===ol?"breakoutVideo9x16":"breakoutVideo16x9",i=h(n,"phone"===ol?"sizzleVideo9x16":"sizzleVideo16x9")||h(n,r);let o=null,a=null,s=null;if(l(i)){s=h(i,"previewFrame");const e=Lo(s,{withJoeColorPlaceholder:!0,useCase:6});l(e)&&(e.crop="sr",a=e.backgroundColor);const n=p(i,"video");l(e)&&l(n)&&(o=new Mc(n,e,{canPlayFullScreen:!1,showPlaybackControls:!1,allowsAutoPlay:!0,looping:!0,playbackControls:{prominentPlay:t},autoPlayPlaybackControls:{}}))}return{video:o,artworkData:s,backgroundColor:a}}function Di(e){const t=l(ee(e,"link")),n=ie(e,"isCanvasAvailable");return!t&&!n}function Li(e){const t=ee(e,"link"),n=l(t),r=ie(e,"isCanvasAvailable"),i=j(e,"primary-content");if(!n&&!r&&!ae(i))return null;let a=null;if(a=n?p(t,"url"):ne(r?e:i,"url"),o(a))return null;let s=null;if(n&&"external"===p(t,"target"))s=new ec(a);else{const e=Ti(a),t=new Xl(e);t.pageUrl=a,"product"===e&&(t.pageData=Yr(i)),s=t}return s.title=Oi(e),s}function Fi(e,t,n,r="white"){if(a(e)||a(e.attributes))return null;const i={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker,mercuryMetricsData:ba(e)},o=_i(e,!0),c=Ri(e),u=o.backgroundColor||c.backgroundColor,d=Pi(e,!0,!0),f="tv"===ol,h="material"!==ki(e,f,!0,!0)&&!0,m=Mi(e,t,null,f,h,"wordmark");let g=null;"tv"!==ol&&(g=m.description,m.description=null);const y=Rn(o.artworkData||c.artworkData,!0),w="marketing-items"===e.type?function(e){if("marketing-items"!==e.type)return{type:"blue",fillColor:null,textColor:null};const t=vi(e),n=p(t,"ctaButtonBackgroundColor"),r=p(t,"ctaButtonTextColor");return s(n)&&s(r)?{type:"custom",fillColor:z(n),textColor:z(r)}:{type:"blue",fillColor:null,textColor:null}}(e):function(e){if(!s(e))return{type:"blue",fillColor:null,textColor:null};let t=null,n=null;switch(e.type){case"color":n=e.color;break;case"horizontalGradient":case"verticalGradient":n=e.gradientStartColor}const r=s(qf.find(e=>(function e(t,n){if(null===t&&null===n)return!0;if(null===t&&null!==n||null!==t&&null===n)return!1;const r=t.type,i=n.type;if("named"===r&&"named"===i){const e=n;return t.name===e.name}if("rgb"===r&&"rgb"===i){const e=t,r=n;return e.red===r.red&&e.green===r.green&&e.blue===r.blue}return"dynamic"===r&&"dynamic"===i&&e(t,n)})(e,n)));return t=!e.isFallbackStyle&&r?{type:"custom",fillColor:n,textColor:K(n===Vf?"white":"systemBlue")}:{type:"custom",fillColor:K("systemBlue"),textColor:K("white")},t}(y),T=new Ns("arcade",bs.arcadeAppAdamId,r,null,"arcade",null,w,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId),A=new Oc(m,T,{backgroundColor:u,wantsMaterialDetailBackground:!1,wantsBlur:h,badgeColor:null,titleColor:null,descriptionColor:null,callToActionColor:null,textAlignment:null,detailsPosition:d},null,g,c.artwork,o.video),I=_o(e,A.details.title,Object.assign(Object.assign({},i),{targetType:"upsellBreakout"}));I.displaysArcadeUpsell=!bs.isArcadeComingSoonEnabled,Oo(A,I),Pa(I,A.details.title);const b=Bi(e,t,"arcadeTabHeader",i);return A.offerButtonAction=b,Ca(i.locationTracker),l(n)&&a(n.pageTitleEffect)&&0===n.shelves.length&&(n.pageTitleEffect=y),Ea(n.metricsLocationTracker),A}function xi(e){return Oi(e)}function Ni(e){switch(e.type){case"editorial-items":return ne(e,"editorialNotes.name");default:return ne(e,"title")}}function Ui(e){switch(e.type){case"editorial-items":return ne(e,"editorialNotes.short");default:return ne(e,"subtitle")}}function Mi(e,t,n,r,i,o){let a=null;switch(o){case"wordmark":a={type:"wordmark"};break;case"text":const t="marketing-items"===e.type?ne(e,"badge"):ne(e,"label");a=l(t)?{type:"text",title:t}:{type:"none"};break;default:a={type:"none"}}let c=Ni(e),u=Ui(e),d=ki(e,r,!0,!0);const p=Pi(e,!0,!0);return i&&(d="dark"),s(t)&&(c=yt(c,t,n),u=yt(u,t,n)),new mu(c,u,a,null,d,Ci(p,e,!0))}function Bi(e,t,n,r){let i=null;if(bs.isArcadeComingSoonEnabled)i=new ec("https://www.apple.com/apple-arcade/#notify-me"),i.title=xi(e);else{const o=qa(n),a={inAppData:t,editorialData:null,marketingItemData:null};"marketing-items"===e.type?a.marketingItemData=e:a.editorialData=e,i=$i(a,xi(e),r,o)}return i}function $i(e,t,n,r){const i=e.marketingItemData;if(s(i)){const e=ho(i),o=p(e,"offerName"),a=p(e,"buyParams");if(!s(o)||!s(a))return Vi(t,r);const l=bs.arcadeAppAdamId,c=new Tc(o,l,{buyParams:a,productIdentifier:o},r),u=Object.assign({id:l,actionType:"buy",targetType:"button",subscriptionSKU:o,actionContext:"Arcade",actionDetails:{buyParams:a},offerType:"subscribe",mercuryMetricsData:ba(i)},n);return c.title=t,Na(c,u),c}{const o=Vi(t,r),a=p(fo(e.inAppData),"buyParams");return Na(o,Object.assign({id:bs.arcadeAppAdamId,actionType:"buy",targetType:"button",subscriptionSKU:bs.arcadeProductId,actionContext:"Arcade",actionDetails:{buyParams:a},offerType:"subscribe",mercuryMetricsData:ba(i)},n)),o}}function Vi(e,t){const n=new Tc(bs.arcadeProductId,bs.arcadeAppAdamId,null,t);return n.title=e,n}function qi(e){throw new Error("This method should never be called with value: ${value}")}function Gi(e,t,n){e&&Is.c("copyDataIntoLockup",()=>{t.adamId=e.id,t.bundleId=ye(e,"bundleId");let r=null;n&&n.clientIdentifierOverride&&(r=n.clientIdentifierOverride),t.icon=No(e,{useCase:n.artworkUseCase},r),n&&n.titleObjectPath?t.title=ye(e,n.titleObjectPath):t.title=ne(e,"name");const i=sa(e);!i||"tv"===ol&&"com.apple.Arcade"===host.clientIdentifier||(t.decorations=["arcade"]),t.subtitle=Wi(e),t.developerTagline=ye(e,"subtitle"),t.editorialTagline=la(e,"tagline"),t.editorialDescription=la(e,"standard"),t.shortEditorialDescription=la(e,"short"),t.ageRating=ne(e,"contentRatingsBySystem.appsApple.name"),Qn(e)||(oe(e,"userRating.ratingCount")>0||!n||!n.hideZeroRatings)&&(t.rating=oe(e,"userRating.value"),t.ratingCount=R(oe(e,"userRating.ratingCount")));const o=La(e,n.metricsOptions),a=fo(e),c=Ia(e,t.icon),d=mo(a,e,c,o),f=u(a,"discounts");let h=ko(d,e,o,"default",n.ignoreIconInSidepack,r);s(n)&&l(n.externalDeepLinkUrl)&&(h=ft(h,d.adamId,n.externalDeepLinkUrl,n.metricsOptions)),t.buttonAction=h;const m=Un(e);if(m){const e=new Ic,n=Ee(o);n.actionType="share",n.targetType="lockup",Na(e,n);const r=new Hc;r.shareAction=e,r.shareSheetData=m,t.contextMenuData=r}const g=uo(e);let y=!1;g&&(y=!(Io(fo(g))>0));const w=function(e,t){switch(e){case"in-apps":return t?"arcade":"inAppPurchase";default:return t?"arcadeApp":"app"}}(e.type,i);if(t.offerDisplayProperties=n?vo(d,w,e,n.offerStyle,n.offerEnvironment,f[0],y):vo(d,w,e,null,null,f[0],y),!n||!n.skipDefaultClickAction){const i=s(n)?n.externalDeepLinkUrl:null;t.clickAction=so(e,o,r,n.ignoreIconInSidepack,i)}n&&n.ordinal&&(t.ordinal=n.ordinal);const T=me(e,"editorialBadgeInfo");if(T){const e=p(T,"editorialBadgeType");t.isEditorsChoice=e&&"editorialPriority"===e}t.children=Hi(e,n);const A=Ro(e,t,c,n.metricsOptions,n.canDisplayArcadeOfferButton);Oo(t,A)})}function Hi(e,t){const n=H(e,"apps");return n?no(n,{lockupOptions:t,filter:0}):null}function ji(e,t,n,r){e&&(r.isNetworkConstrained||Is.c("copyMediaIntoMixedMediaLockup",()=>{t.screenshots=Vo(e,4,null,r.clientIdentifierOverride);const i=t.screenshots[0];t.trailers=[];const o=Mo(e,n,r.metricsOptions,t.adamId);s(o)&&(a(i)||o.mediaPlatform.isEqualTo(i.mediaPlatform))&&t.trailers.push(o)}))}function Wi(e){return Is.c("subtitleFromData",()=>{let t=!1;const n=sa(e),r=Z(Gf);if(s(r)&&n)switch(r){case 0:break;case 1:t=!0;break;default:qi()}const i=ye(e,"subtitle");return i&&!t?i:zi(e)})}function zi(e){return Is.c("categoryFromData",()=>{const t=ye(e,"genreDisplayName");if(l(t))return t;const n=W(e,"genres");if(n.length>0){let e=n[0];const t=6014..toString();if(e.id===t)for(const r of n){const n=ne(r,"parentId");if(r.id!==t&&n===t){e=r;break}}return ne(e,"name")}{const t=te(e,"genreNames");return t.length>0?t[0]:null}})}function Yi(e,t){const n=(new vp).param(El.id,t).param(Ol.inAppPurchaseId,e).build();return`${Pl.internal}:/${Cl.product}/${Cl.install}/?${n}`}function Ki(e,t){return Is.c("lockupFromData",()=>{if(!e)return Is.d("ignoredValue","data"),null;if(!ae(e))return null;switch(e.type){case"in-apps":return Qi(e,t);default:const n=new jc;return Gi(e,n,t),n}})}function Qi(e,t){return Is.c("inAppPurchaseLockupFromData",()=>{const n=new Qc;return function(e,t,n){e&&Is.c("copyDataIntoInAppPurchaseLockup",()=>{Gi(e,t,n);const r=uo(e);if(!r)return;t.productIdentifier=ne(e,"offerName"),t.parent=Ki(r,n),t.description=ne(e,"description.standard"),t.isVisibleByDefault=ie(e,"isMerchandisedVisibleByDefault"),t.isSubscription=ie(e,"isSubscription");const i=fo(e),o=u(i,"discounts");t.offerDisplayProperties.hasDiscount=o.length>0,t.offerDisplayProperties.subscriptionFamilyId=ne(e,"subscriptionFamilyId");const a=new Xl("inAppPurchaseInstall");a.presentationContext="presentModalFormSheet";const s=Yi(t.adamId,r.id);a.pageUrl=s;const l=new dd;l.parentLockup=Ee(t.parent),l.lockup=Ee(t),l.preInstallOfferDescription=At(i),a.pageData=l;const c=ne(e,"offerName"),d=ye(r,"bundleId"),p=ne(r,"firstVersionSupportingInAppPurchaseApi");if(p){const e=new oc(c,r.id,d,a,p);t.parent&&(e.appTitle=t.parent.title),e.productTitle=t.title,Na(e,Object.assign(Object.assign({},n.metricsOptions),{id:t.adamId,idType:"its_id",actionDetails:{parentAdamId:r.id}})),t.buttonAction=e}else{const e=new hc("default");e.title=P("SEED_IN_APP_UNSUPPORTED_MESSAGE_OPTION_1"),e.message="",e.isCancelable=!0,t.buttonAction=e}const f=Ro(e,t,"iap",n.metricsOptions,n.canDisplayArcadeOfferButton);if(!n||!n.skipDefaultClickAction){const n=oo(e,f);t.clickAction=n,t.productAction=n}!function(e,t){e&&(e.impressionMetrics||Oo(e,t),e.parent&&e.parent.adamId&&(e.impressionMetrics.fields.parentAdamId=ya(e.parent.adamId)))}(t,f)},"item.offer.buyParams")}(e,n,t),n})}function Ji(e,t){return Is.c("screenshotsLockupFromData",()=>{const n=new Wc;return function(e,t,n){e&&Is.c("copyDataIntoScreenshotsLockup",()=>{Gi(e,t,n),t.screenshots=Vo(e,4,null,n.clientIdentifierOverride)})}(e,n,t),n})}function Xi(e,t,n){return Is.c("trailersLockupFromData",()=>{const r=new Yc;return function(e,t,n,r){e&&Is.c("copyDataIntoTrailersLockup",()=>{Gi(e,t,r),t.trailers=Mo(e,n,r.metricsOptions,t.adamId)})}(e,r,n,t),r})}function Zi(e,t,n){return Is.c("mixedMediaLockupFromData",()=>{const r=new zc;return Gi(e,r,t),ji(e,r,n,t),r})}function eo(e,t,n){return Is.c("adLockupFromData",()=>{const r=new zc;if(ie(e,"iad.format.images")){ji(e,r,n,t);const i=te(e,"iad.assetOverride");if(i.length){const e=function(e,t){const n=new Set(t),r=[],i=[],o=function(e,r){if(0===n.size)return!1;for(const i of t)if(i===r||-1!==e.indexOf(i))return n.delete(i),!0;return!1};if(t.length&&(e.screenshots.length||e.trailers.length)){if(e.trailers.length)for(const t of e.trailers[0].videos)o(t.videoUrl,t.preview.checksum)&&r.push(t);if(e.screenshots.length)for(const t of e.screenshots[0].artwork)o(t.template,t.checksum)&&i.push(t)}return!(0!==n.size||!r.length&&!i.length||(e.trailers.length&&(e.trailers[0].videos=r),e.screenshots.length&&(e.screenshots[0]=new $s(i,e.screenshots[0].mediaPlatform)),0))}(r,i);t.metricsOptions.pageInformation.iAdInfo&&t.metricsOptions.pageInformation.iAdInfo.iAdIsPresent&&t.metricsOptions.pageInformation.iAdInfo.setSpecifiedCreativeUsed(e)}Gi(e,r,t)}else Gi(e,r,t),r.screenshots=null;r.offerDisplayProperties&&(r.offerDisplayProperties=r.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"colored","ad")),ie(e,"iad.format.userRating")||(r.rating=null,r.ratingCount=null);const i=ee(e,"iad"),o=ne(e,"iad.impressionId"),a=ne(e,"iad.privacy"),s={};t.metricsOptions.pageInformation.iAdInfo.iAdClickEventFields&&Object.assign(s,t.metricsOptions.pageInformation.iAdInfo.iAdClickEventFields);const l=new kc(o,s),c=new ed(a),u=new tc([c,l]);u.title=P("IAD_PRIVACY_MARKER_BUTTON_TITLE");const d=new Zu(i,o,u);"regular"===ne(e,"iad.format.icon")?d.iconStyle="regular":d.iconStyle="small",r.searchAd=d;const p=new tc([r.clickAction,l]);return r.clickAction=p,Oe(r.buttonAction,ac)?r.buttonAction=r.buttonAction.newOfferStateActionAddingActionToExistingActions(l):r.buttonAction=new tc([r.buttonAction,l]),r})}function to(e,t,n,r,i){return Is.c("arcadeLockupFromData",()=>{const o=e.marketingItemData||e.editorialData,a=new Jc;a.title=P("ARCADE_LOCKUP_TITLE","Apple Arcade");const s=e.marketingItemData;t=Object.assign(Object.assign({},t),{mercuryMetricsData:ba(s)});let c,u=Ui(o);l(u)&&(u="iOS"===host.platform?u.replace(/\n/g," "):u,a.subtitle=yt(u,e.inAppData),a.nonsubscribedSubtitle=a.subtitle),a.subscribedSubtitle=P("ARCADE_STORY_LOCKUP_SUBSCRIBED_TITLE","100+ Extraordinary Games");const d=xi(o),p=gt(u),f="marketing-items"===o.type;y("arcadeLockupInNavBar")&&(!f&&p||f)?(c=Bi(e.marketingItemData||e.editorialData,e.inAppData,n,t),c.title=d):l(d)?(c=Va("arcadeStoryCanvas",null,Object.assign(Object.assign({},t),{id:o.id})),c.title=d):(c=Ga(t.pageInformation,t.locationTracker),c.title=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE")),a.unsubscribedButtonAction=c;const h=Ga(t.pageInformation,t.locationTracker);h.title=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE"),a.subscribedButtonAction=h;const m=_o(e.marketingItemData||e.editorialData,a.title,t);m.displaysArcadeUpsell=!0,Oo(a,m);const g=new Ns("arcade",bs.arcadeAppAdamId,r,null,i,null,null,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId);return g.titles.subscribed=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE"),a.offerDisplayProperties=g,a})}function no(e,t){return o(e)?[]:ro(e.data,t)}function ro(e,t){return Is.c("lockupsFromData",()=>{if(!e)return[];const n=[];let r=!1;for(let i=0;i<e.length&&!r;i++){const a=e[i];if(o(a.attributes)){t.contentUnavailable&&(r=t.contentUnavailable(a.id,i));continue}const s=t.lockupOptions;let l=14334;if(t.includeOrdinals){const n="descending"===t.ordinalDirection?e.length-i:i+1;s.ordinal=E(n).toString()}if(null!==t.filter&&(l=t.filter),_e(a,l))continue;t.excludeIconInSidepacksIfNotTvOnly&&(pe(a,"tvos")||(s.ignoreIconInSidepack=!0));const c=Ki(a,s);c.isValid()&&(n.push(c),Ea(t.lockupOptions.metricsOptions.locationTracker))}return n})}function io(e,t,n,r=!1,i=null){return Is.c(`actionFromData: ${e.type}`,()=>{switch(e.type){case"apps":case"app-bundles":return so(e,t,n,r,i);case"in-apps":return oo(e,t);case"editorial-items":return ao(e,t,n);case"multiple-system-operators":return function(e,t){return e?Is.c("msoActionFromPlatformData",()=>{const n=ne(e,"url");if(!n)return Is.d("ignoredValue","string","url"),null;const r=new Xl("mso");return r.pageUrl=n,r.title=ne(e,"name"),Na(r,t),r}):null}(e,t);case"groupings":return function(e,t){return e?Is.c("groupingActionFromData",()=>{if(!e.href)return Is.d("ignoredValue","string","href"),null;const n=new Xl("page");return n.pageUrl=M(function(e){const t=new fh(e).includingAttributes(["editorialArtwork","editorialVideo","isAppleWatchSupported","requiredCapabilities","minimumOSVersion"]),n=ts();return s(n)&&t.addingQuery("contexts",n),t}(e.href)).toString(),n.title=lo(e),Na(n,t),n}):null}(e,t);case"developers":default:return function(e,t){return e?Is.c("genericActionFromData",()=>{const n=p(e,"type"),r=ne(e,"url");if(!r)return Is.d("ignoredValue","string","url"),null;const i=new Xl("page");return i.pageUrl=r,i.title="groupings"===n?lo(e):ne(e,"name"),Na(i,t),i}):null}(e,t)}})}function oo(e,t){return Is.c("iAPActionFromData",()=>{const n=uo(e);if(!n)return null;const r=new Xl("product"),i=ne(n,"url"),o=ne(e,"offerName"),a=ie(e,"isSubscription");return r.pageUrl=function(e,t,n){const r=(new vp).param(Rl.url,e).param(El.offerName,t).param(Rl.isSubscription,n.toString()).build();return`${Pl.internal}:/${Cl.product}/${Cl.lookup}/?${r}`}(i,o,a),r.title=ne(e,"name"),Na(r,t),r})}function ao(e,t,n,r){return e?Is.c("editorialItemActionFromData",()=>{const i=ne(e,"displaySubStyle"),a=ee(e,"link"),c="List"===i||"NumberedList"===i,u=ie(e,"isCanvasAvailable")||c,d=W(e,"card-contents"),f=l(d)&&1===d.length;if(function(e){const t=p(e,"target");return t&&"external"===t}(a))return function(e,t){return Is.c("editorialItemExternalLinkActionFromData",()=>{const n=p(ee(e,"link"),"url"),r=new ec(n),i=la(e,"short");if(i)r.title=i;else{const e=new xl(n);r.title=e.host}return Na(r,t),r})}(e,t);let h,m;if(u){h="article";const t=xl.from(ne(e,"url"));s(r)&&t.param(El.recoMetrics,JSON.stringify(r)),m=t.build()}else{if(f)return io(d[0],t,n);h="unknown",m=p(a,"url")}const g=new Xl(h);g.pageUrl=m;let y=la(e,"name");return o(y)&&(y=p(e,"label")),g.title=y,Na(g,t),g}):null}function so(e,t,n,r=!1,i=null){return e?Is.c("productActionFromData",()=>{let o=ne(e,"url");if(!o)return Is.d("ignoredValue","string","url"),null;let a={};const c=new xl(o);if(t.isAdvert){const n=p(e,"iad.lineItem");null!==n&&n.length>0&&c.param(Wu,n);const r=t.pageInformation.iAdInfo.clickFields;c.param(ju,JSON.stringify(r)),a={iAdClickFields:r,iAdLineItem:n}}a.externalDeepLinkUrl=i,s(i)&&c.param(Ed,i),a.clientIdentifierOverride=n,l(n)&&c.param("clientIdentifierOverride",n),o=c.toString();const u=new Xl("product");return u.pageUrl=o,u.pageData=Yr(e,a,r),u.title=ne(e,"name"),t&&t.pageInformation&&(u.referrerUrl=t.pageInformation.pageUrl),yo(e)?Na(u,Object.assign(Object.assign({},t),{offerType:"preorder",offerReleaseDate:Ao(e)})):Na(u,t),u}):null}function lo(e){const t=te(e,"genreNames");return l(t)?t[0]:ne(e,"name")}function co(e){if(!e)return!1;if("watch"===ol)return!0;const t=ye(e,"requiredCapabilities");return!t||A(t.split(" "))}function uo(e){return e?j(e,"app"):null}function po(e,t,n,r,i,o){return Is.c("purchaseConfigurationFromProduct",()=>{const a=ne(e,"name");let s=ne(e,"artistName");s||(s="test");const l=Ss.bundleIdFromData(e),c=jo(e),u=ne(e,"iad.lineItem"),d=ye(e,"preflightPackageUrl"),p=sa(e),f=new xs(t,s,a,l,c,n,r,o,u,!1,d,p);return f.pageInformation=i,f})}function fo(e){return Is.c("offerDataFromData",()=>{const t=ge(e,"offers");return 0===t.length?null:t[0]})}function ho(e){if("marketing-items"!==e.type)return null;const t=te(e,"offers");return 0===t.length?null:t[0]}function mo(e,t,n,r){return Is.c(`media_offerActionFromOfferData: ${t.id}`,()=>{let i=p(e,"buyParams");if(o(i))return Is.d("ignoredValue","string","item.offer.buyParams"),null;"app-bundles"===t.type&&(i.indexOf("rebuy")>=0?i=i.replace("rebuy=false","rebuy=true"):(i.length>0&&(i+="&"),i+="rebuy=true"));const a=t.id;if(o(a))return Is.d("ignoredValue","string","item.offer.id"),null;const s=go(e),l=po(t,i,s,r.excludeAttribution,r.pageInformation,n),c=bo(e,a,l);return function(e,t){Fa(e,t.pageInformation,ka(t,e.title),t.isAdvert)}(c,r),c})}function go(e){return Is.c("isPreorderFromOfferData",()=>"preorder"===p(e,"type"))}function yo(e){return Is.c("isPreorderFromData",()=>{const t=ge(e,"offers");return 0!==t.length&&go(t[0])})}function wo(e){return!o(e)&&!o(e.purchaseConfiguration)&&e.purchaseConfiguration.isPreorder}function To(e){return o(e)||o(e.price)||0===e.price}function Ao(e){return Is.c("expectedReleaseDateFromData",()=>Ce(ne(e,"offers.0.expectedReleaseDate")))}function Io(e){const t=p(e,"type");return"buy"===t||"complete"===t||"preorder"===t?f(e,"price"):null}function bo(e,t,n){return Is.c("offerActionFromOfferData",()=>{const r=p(e,"type");let i;switch(r){case"get":case"preorder":i=P("OFFER_BUTTON_TITLE_GET","GET");break;default:i=r}let o=null,a=null;const s=Io(e);s>0&&(o=s,a=p(e,"priceFormatted"));const l=Ce(p(e,"expectedReleaseDate")),c=new nc(i,t,n);return c.price=o,c.priceFormatted=a,c.expectedReleaseDate=l,c})}function ko(e,t,n,r="default",i=!1,a=null){if(ua(t)){if("default"===r)return io(t,n,null,i);const o=ye(t,"bundleId");if(l(o)){const t=Re("mac",o),n=new ec(t);return new ac(e.adamId,n)}}const c=wo(e);if("default"===r){if("app-bundles"===t.type||da(t))return io(t,n,null,i);if(c&&"tv"!==ol)return function(e,t,n,r=!1){if(o(e))return null;const i=io(t,n,null,r);if(!i)return e;const a=new ac(e.adamId,i);return a.buyAction=e,a}(e,t,n)}if(pe(t,"tvos")&&"tv"!==ol)return function(e,t){const n=new hc("default");n.title=P("BUY_TV_ONLY_ALERT_TITLE"),n.message=P("BUY_TV_ONLY_ALERT_MESSAGE"),n.isCancelable=!0,n.buttonActions=t?[Co(e)]:[e],n.buttonTitles=[P("BUY_TV_ONLY_ALERT_BUTTON_TITLE")];const r=new ac(e.adamId,n);return r.title=e.title,r}(e,we(t,"requiresGameController"));if(!we(t,"isDeliveredInIOSAppForWatchOS")&&we(t,"isStandaloneForWatchOS")&&"watch"!==ol)return function(e){const t=new hc("default");t.title=P("BUY_WATCH_ONLY_ALERT_TITLE"),t.message=P("BUY_WATCH_ONLY_ALERT_MESSAGE"),t.isCancelable=!0,t.buttonActions=[e],t.buttonTitles=[P("BUY_WATCH_ONLY_ALERT_BUTTON_TITLE")];const n=new ac(e.adamId,t);return n.title=e.title,n}(e);const u=ye(t,"minimumWatchOSVersion");return l(a)&&a===Zs&&fa(u)?function(e,t){const n=new hc("default");n.title=P("AppStore.ProductPage.WatchOSUpdateRequired.Title").replace("{osVersion}",t),n.message=P("AppStore.ProductPage.WatchOSUpdateRequired.Message").replace("{osVersion}",t),n.buttonActions=[e],n.buttonTitles=[P("ACTION_OK")];const r=new ac(e.adamId,e);return r.buyAction=n,r}(e,u):sa(t)||"tv"===ol?function(e,t,n,r){if(!sa(t))return e;let i=null;if(y("amsUpsellSheets")&&Ba()){const e=new Ec("arcade",n,{contentId:t.id}),r=new Xl("upsellMarketingItem");r.pageData=e,i=r}else{const o=`${Pl.internal}://${vl.arcadeSubscribePage}`,a=new xl(o).param(El.appId,t.id).param(El.context,n);i=new Xl("arcadeSubscribe",a.build());const s=new Sc(null,null,null,null);s.primaryIcon=Fo(t,r,{useCase:3});const l=La(t,r);s.postSubscribeAction=So(t,n,l),i.pageData=s,r&&r.pageInformation&&(i.referrerUrl=r.pageInformation.pageUrl),e instanceof nc&&(r.actionDetails=Object.assign({buyParams:e.purchaseConfiguration.buyParams},r.actionDetails)),xa(i,r)}const o=new ac(t.id,e);return o.subscribePageAction=i,o}(function(e,t,n,r){if(o(e))return null;if("tv"!==ol)return e;const i=new ic,a=To(e),l=e.purchaseConfiguration.appName;i.shouldCheckForAvailableDiskSpace=!n,i.shouldCheckForGameController=we(t,"requiresGameController"),i.shouldPromptForConfirmation=!0;const c=oe(t,"contentRatingsBySystem.appsApple.value");if(s(c)&&(i.checkRestrictionsForContentRating=c),a){const e=P(n?"TV_OFFER_ALERT_TITLE_PREORDER_FREE":"TV_OFFER_ALERT_TITLE_FREE");i.title=e.replace("{title}",l)}else{const t=P(n?"TV_OFFER_ALERT_TITLE_PREORDER_PAID":"TV_OFFER_ALERT_TITLE_PAID");i.title=t.replace("{title}",l).replace("{price}",e.priceFormatted)}const u=Ee(e);u.title=P(n?"OFFER_BUTTON_TITLE_PREORDER":a?"OFFER_BUTTON_TITLE_GET":"OFFER_BUTTON_TITLE_BUY"),i.completionAction=u,i.shouldIncludeActiveAccountInFooterMessage=!0;const d=[];n&&(y("preorderTerms")?d.push(P(a?"PREORDER_TERMS_FREE":"PREORDER_TERMS_PAID")):d.push(P("TV_PREORDER_TERMS"))),we(t,"hasInAppPurchases")&&d.push(P("OFFERS_IN_APP_PURCHASES","Offers In-App Purchases")),d.length>0&&(i.footerMessage=d.join(P("TV_OFFER_ALERT_FOOTER_LINE_BREAK"))),i.impressionMetrics=u.impressionMetrics;const p=Ee(r);o(p)||(p.actionType="buyInitiate",p.targetType="button",Na(i,r));const f=Ee(i);f.shouldPromptForConfirmation=!1,f.title=null,f.footerMessage=null;const h=new ac(e.adamId,f);return sa(t)||(h.buyAction=i),h.openAction=e,h}(e,t,c,n),t,function(e){switch(e){case"productPage":return"arcadeProductPage";case"default":return"arcadeGroupingLockup";default:return"arcadeGeneric"}}(r),n):Po(e,c,n)}function So(e,t,n){switch(t){case"arcadeProductPage":case"arcadeGroupingLockup":const t=No(e,{useCase:3}),r=La(e,n);return mo(fo(e),e,Ia(e,t),r);default:return null}}function Po(e,t,n){if(o(e))return null;if(dl||t)return e;const r=new Ic;r.impressionMetrics=e.impressionMetrics;const i=Ee(n);o(i)||(i.actionType="buyInitiate",i.targetType="button",Na(r,i));const a=new rc(e,r);return a.confirmationAccessibilityAction=function(e){if(o(e))return null;const t=new hc("default");o(e.priceFormatted)?(t.title=P("GET"),t.message="Are you sure you want to get "+e.purchaseConfiguration.appName):(t.title="Buy App",t.message=`Are you sure you want to buy ${e.purchaseConfiguration.appName} for ${e.priceFormatted}`),t.isCancelable=!0,t.buttonActions=[e];const n=new ac(e.adamId,e);return n.buyAction=t,n}(e),a}function Co(e){const t=new hc("default");return t.title=P("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_TITLE"),t.message=P("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_MESSAGE"),t.buttonTitles=[P("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_BUTTON_TITLE")],t.isCancelable=!0,t.buttonActions=[e],t}function vo(e,t,n,r,i,a,l,c="default"){return o(e)?null:Is.c("displayPropertiesFromOfferAction",()=>{let o=r;_e(n,15798)&&(o="disabled");const u=wo(e);co(n)||(o="disabled");const d=uo(n);let f=null;d&&(f=d.id);let h="none";u&&(sa(n)?o="disabled":h="preorder");let m=new Ns(t,e.adamId,o,f,i);m.offerLabelStyle=h;const g=To(e);m.isFree=g;let y=null;if(y="default"!==c||"app-bundles"!==n.type&&!ua(n)?"productPage"!==c&&da(n)?P("OFFER_BUTTON_TITLE_VIEW"):g?!u||"tv"!==ol||"productPage"!==i&&"arcadeProductPage"!==i?e.title:P("OFFER_BUTTON_TITLE_PREORDER"):"tv"!==ol||"productPage"!==i&&"arcadeProductPage"!==i?e.priceFormatted:u?P("OFFER_BUTTON_TITLE_PREORDER_WITH_PRICE").replace("{price}",e.priceFormatted):P("OFFER_BUTTON_TITLE_BUY_WITH_PRICE").replace("{price}",e.priceFormatted):P("OFFER_BUTTON_TITLE_VIEW"),m.titles.standard=y,dl||(m.titles.confirmation=P(g?"ACTION_GET_CONFIRM":"ACTION_BUY_CONFIRM")),sa(n)&&(m.titles.standard=P("OFFER_BUTTON_TITLE_ARCADE_STANDARD"),m.titles.trial=P("OFFER_BUTTON_TITLE_ARCADE_TRY"),m.titles.open=P("OFFER_BUTTON_TITLE_ARCADE_OPEN"),m.titles.notSubscribed=P("OFFER_BUTTON_TITLE_ARCADE_NOT_SUBSCRIBED")),a){const e=p(a,"modeType"),t=p(a,"priceFormatted");if(s(t)&&s(e)){let n=null,r=null;switch(e){case"FreeTrial":l?(n=P("INTRO_PRICE_OFFER_FREE_TRIAL"),r=P("INTRO_PRICE_OFFER_FREE_TRIAL")):(n=P("INTRO_PRICE_OFFER_FREE_TRIAL"),r=P("INTRO_PRICE_OFFER_TRIAL"));break;case"PayUpFront":const e=P("INTRO_PRICE_OFFER_PAID_UPFRONT_TRIAL").replace("{price}",t);l?(n=e,r=e):(n=e,r=P("INTRO_PRICE_OFFER_TRIAL"));break;case"PayAsYouGo":n=P("INTRO_PRICE_OFFER_TRIAL"),r=P("INTRO_PRICE_OFFER_TRIAL")}m.titles.discountOwnedParent=n,m.titles.discountUnownedParent=r,m.subtitles.discountOwnedParent=P("INTRO_PRICE_OFFER_SUBTITLE"),m.subtitles.discountUnownedParent=P("INTRO_PRICE_OFFER_SUBTITLE");const i=10;let o=!1;for(const e of Object.keys(m.titles))if(m.titles[e].length>i){o=!0;break}o&&(m=m.newOfferDisplayPropertiesChangingAppearance(!1,null,"widthConstrainedLockup"))}}const w=we(n,"hasInAppPurchases");if(m.hasInAppPurchases=w,w){const e=P("INLINE_IN_APP_PURCHASES");m.subtitles.standard=e,dl||(m.subtitles.confirmation=e)}m.isDeletableSystemApp=Ss.isDeletableSystemAppFromData(n);const T=oe(n,"contentRatingsBySystem.appsApple.value");return m.contentRating=T,"app-bundles"===n.type&&(m.offerToken={offerAction:e,offerDisplayProperties:Ee(m)}),m})}function Eo(e,t){const n=o(e.title)?t.title:e.title,r={id:ya(t.id),idType:ga(t),impressionType:ma(t),name:ya(n)};if(t&&t.kind&&(r.kind=t.kind),t&&t.softwareType&&(r.softwareType=t.softwareType),t&&t.recoMetricsData&&Object.assign(r,t.recoMetricsData),t&&t.mercuryMetricsData&&Object.assign(r,t.mercuryMetricsData),t&&t.lockupDisplayStyle&&(r.platformDisplayStyle=t.lockupDisplayStyle),t&&t.locationTracker){const e=va(t.locationTracker);r.impressionIndex=e,""===r.id&&(r.id=e.toString(),r.idType="sequential")}return s(t.offerType)&&(r.offerType=t.offerType),t&&s(t.displaysArcadeUpsell)&&(r.displaysArcadeUpsell=t.displaysArcadeUpsell),s(t.adamId)&&(r.adamId=t.adamId),""===r.id&&console.log(`impressionId missing. Tracking broken for ${r.name} of ${r.impressionType}`),r}function Oo(e,t){e&&(e.impressionMetrics=new Ql(Eo(e,t)))}function Ro(e,t,n,r,i){const o=_o(e,t.title,r);return o.lockupDisplayStyle=n,i&&sa(e)&&(o.displaysArcadeUpsell=!0),o}function _o(e,t,n){return Is.c("impressionOptions",()=>{const r=function(e){const t=p(e,"type"),n=de(e,"mac",!0),r=pe(e,"mac",!0),i=function(e,t,n=!1){const r=new Set(he(e,n));for(const e of t)if(r.has(e))return!0;return!1}(e,["iphone","ipad","ipod","tvos","watch"],!0),o=fe(e,["iphone","ipad","ipod","tvos","watch"],!0),a="phone"===ol||"pad"===ol||"tv"===ol||"watch"===ol;if(r||n&&"mac"===ol)switch(t){case"apps":return"macSoftware";case"app-bundles":return"macSoftwareBundle"}if(o||i&&a)switch(t){case"apps":return"iosSoftware";case"app-bundles":return"mobileSoftwareBundle"}switch(t){case"in-apps":return"softwareAddOn";case"groupings":return"grouping";case"editorial-elements":case"editorial-items":return"editorialItem";default:return null}}(e),i=function(e){return sa(e)?"Arcade":null}(e),o=Object.assign(Object.assign({},n),{kind:r,softwareType:i,title:t,id:e.id});return yo(e)&&(o.offerType="preorder"),o})}function Do(e){switch(e){case"inAppPurchaseLockup":case"appShowcase":case"smallLockup":return 1;case"mediumLockup":return 2;case"largeLockup":return 3;default:return 0}}function Lo(e,t){return Is.c("artworkFromApiArtwork",()=>{const n=!!s(t.allowingTransparency)&&t.allowingTransparency,r=!!s(t.withJoeColorPlaceholder)&&t.withJoeColorPlaceholder,i=p(e,"url");if(o(i))return null;const a=d(e,"hasP3"),l=[nt(n,a,t.useCase)];let c;if(d(e,"supportsLayeredImage")&&"tv"===ol&&l.push(rt("lcr",a,t.useCase)),n)c=K("clear");else if(r){const t=z(p(e,"bgColor"));o(t)||(c=t)}o(c)&&(c=K("placeholderBackground"));const u=new Bs(i,t.overrideWidth||f(e,"width"),t.overrideHeight||f(e,"height"),l);return u.backgroundColor=c,u.checksum=p(e,"checksum"),s(t.style)&&(u.style=t.style),s(t.cropCode)&&(u.crop=t.cropCode),u})}function Fo(e,t,n){return Is.c("impressionableAppIconFromData",()=>{const r=No(e,n);if(!s(r))return null;const i=new Fc(r),o=ne(e,"name");return Oo(i,_o(e,o,t)),i})}function xo(e,t,n){return Is.c("impressionableAppIconFromData",()=>{const r=[];a(t.targetType)&&(t.targetType="artwork");for(const i of e){const e=Fo(i,t,n);e&&(r.push(e),Ea(t.locationTracker))}return r})}function No(e,t,n){return Is.c("iconFromData",()=>{if(!e)return Is.d("ignoredValue","data"),null;const r=e.type;let i;switch(n){case Zs:case el:i="ios";break;case nl:i="appletvos";break;default:i=Ae(e)}const o=n||host.clientIdentifier,a=ce(e,i,"circularArtwork");if((o===Zs||"watch"===ol||we(e,"isStandaloneForWatchOS"))&&s(a))return Lo(a,Object.assign(Object.assign({},t),{style:"round"}));const l=ia(e),c=na(e)&&(o===el||l),u=ce(e,i,"ovalArtwork");if(c&&s(u))return Lo(u,Object.assign(Object.assign({},t),{style:"pill"}));let d;return"in-apps"===r?(d=ee(e,"artwork"),Lo(d,Object.assign(Object.assign({},t),{style:"iap"}))):"app-bundles"===r?(d=ee(e,"artwork"),Lo(d,Object.assign(Object.assign({},t),{style:"roundedRect",allowingTransparency:!0}))):(d=ce(e,i,"artwork"),Lo(d,pe(e,"tvos")||n===nl?Object.assign(Object.assign({},t),{style:"tvRect"}):"osx"===i?Object.assign(Object.assign({},t),{style:"unadorned",allowingTransparency:!0}):Object.assign(Object.assign({},t),{style:"roundedRect"})))})}function Uo(e,t,n){if(!e)return null;const r=function(e){switch(e){case"ipadPro_2018":return nh/Zf.width;case"ipad_11":return rh/Jf.width;case"iphone_6_5":return ih/jf.width;case"iphone_5_8":return oh/Wf.width;case"appleWatch_2018":return ah/eh.width;default:return null}}(t);return new Vs(e,t,n,r)}function Mo(e,t,n,r){const i=Bo(e,t);if(!i)return null;const o=i.videos,a=[];if(o&&o.length>0)for(const e of o)ht(e,Object.assign(Object.assign({},n),{id:r})),a.push(e);let s=null;return a.length>0&&(s=new Kc,s.videos=a,s.mediaPlatform=i.mediaPlatform),s}function Bo(e,t,n=null){return Is.c("platformVideoPreviewFromData",()=>{const r=function(e,t){return me(e,"videoPreviewsByType",void 0)}(e),i={};if(!r)return null;let o=Ho(e,host.clientIdentifier,ol);if(s(n)){const e=[];for(const t of o)n.includes(t)&&e.push(t);o=e}if(0===o.length)return null;for(const e of o){const n=Qo(e,al);for(const e of Object.keys(r)){const n=u(r,e),o=[];for(const r of n){const n=h(r,"previewFrame");if(!n){Is.d("ignoredValue","object",`videoPreviewsByType.${e}.previewFrame`);continue}const i=p(r,"video");if(!i){Is.d("ignoredValue","string",`videoPreviewsByType.${e}.video`);continue}const a=it(p(n,"url"),f(n,"width"),f(n,"height"),null,p(n,"checksum"));o.push(new Mc(i,a,t))}i[e]=o}for(const t of n)if(i[t])return new Hf(i[t],Uo(e,t))}return null})}function $o(e){return Is.c("videoPreviewsFromApiPlatformData",()=>{const t=Bo(e,Td);return t?t.videos:[]})}function Vo(e,t,n=null,r){return Is.c("screenshotsFromData",()=>{const i=[];let o=n;if(!o||0===o.length){const t=r||host.clientIdentifier;let n=ol;t===Zs&&(n="watch"),o=Ho(e,t,n)}for(const n of o){const r=[];let o;if(y("triforce")?"messages"===n?(o=oa(e,"ios"),ra(e,"ios")&&r.push("faceTime")):o="tv"===n&&"tvOS"!==host.platform?aa(e,"appletvos"):"mac"===n&&"macOS"!==host.platform?aa(e,"osx"):"phone"!==n&&"pad"!==n&&"watch"!==n||"iOS"===host.platform||"watchOS"===host.platform?aa(e):aa(e,"ios"):"messages"===n?(o=oa(e),ra(e)&&r.push("faceTime")):o="tv"===n&&"iOS"===host.platform?aa(e,"appletvos"):aa(e),!o)continue;const a=Go(o,n,t,r);a&&i.push(a)}return i})}function qo(e,t,n=null,r){return function(e){const t=[];if(e&&e.length>0)for(const n of e){const e=[];for(const t of n.artwork){const n=new Bc;n.screenshot=t,e.push(n)}const r=n.mediaPlatform,i=new $c(e,r);t.push(i)}return t}(Vo(e,t,n,r))}function Go(e,t,n,r){const i=Qo(function(e){if("messages"===e)switch(ol){case"pad":return"pad";default:return"phone"}return e}(t),al);let o,a=null;for(let t=0;t<i.length&&!l(a);t++)a=u(e,i[t]),o=i[t];if(l(a)){const e=a.map((function(e){return Lo(e,{useCase:n})})),i=Uo(t,o,r);return new $s(e,i)}return null}function Ho(e,t,n){return J(e,`sortedAppPlatformsFromData.${t}.${n}`,()=>{const r=jo(e),i=[];let o=[];if(!y("triforce")&&r.length>1)switch(n){case"phone":case"pad":case"watch":i.push("mac")}const a=function(e,t){-1===o.indexOf(e)&&-1===i.indexOf(e)&&-1!==r.indexOf(e)&&(o.push(e),t&&i.push(t))};switch(t){case Zs:a("watch");break;case el:a("messages")}switch(n){case"phone":a("phone");break;case"pad":a("pad");break;case"tv":a("tv");break;case"watch":a("watch");break;case"mac":y("triforce")?a("mac"):a("pad")}return y("triforce")?(a("phone"),a("pad"),a("mac"),a("tv"),a("watch"),a("messages")):(a("phone"),a("pad"),a("messages"),a("watch"),a("tv"),a("mac")),o=o.filter((function(e){return-1===i.indexOf(e)})),o})}function jo(e){return e?J(e,"supportedAppPlatformsFromData",()=>{let t;t=y("triforce")?na(e,"ios"):na(e);const n=ia(e),r=function(e){return we(e,"isAppleWatchSupported")}(e),i=te(e,"deviceFamilies"),o=[];for(const e of i)switch(e){case"iphone":n||o.push("phone");break;case"ipad":n||o.push("pad");break;case"tvos":o.push("tv");break;case"watch":o.push("watch")}return t&&o.push("messages"),r&&o.push("watch"),de(e,"mac")&&o.push("mac"),o}):null}function Wo(e){switch(e){case"phone":return["phone","messages"];case"pad":return["phone","pad","messages"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}function zo(e,t){return-1!==e.indexOf(t)}function Yo(e,t){return function(e){switch(e){case"phone":return["phone","watch","messages","tv"];case"pad":return["phone","pad","messages","tv"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}(t).some(t=>zo(e,t))}function Ko(e,t){return function(e){switch(e){case"phone":return["phone","watch","messages"];case"pad":return["phone","pad","messages"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}(t).some(t=>zo(e,t))}function Qo(e,t){switch(e){case"mac":return["mac"];case"watch":return["appleWatch_2018","appleWatch"];case"tv":return["appleTV"];case"pad":{const e=[];return t.isEqualTo(Zf)&&sl>0?(e.push("ipadPro_2018"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(Xf)?(e.push("ipadPro"),e.push("ipadPro_2018"),e.push("ipad_11"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(Jf)?(e.push("ipad_11"),e.push("ipadPro_2018"),e.push("ipadPro"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(Qf)?(e.push("ipad_10_5"),e.push("ipad"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipadPro_2018")):(e.push("ipad"),e.push("ipad_10_5"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipadPro_2018")),e}case"phone":{let e;e=t.isEqualTo(jf)?"iphone_6_5":t.isEqualTo(Wf)?"iphone_5_8":t.isEqualTo(Kf)?"iphone":t.isEqualTo(Yf)?"iphone5":t.isEqualTo(zf)?"iphone6":"iphone6+";const n=th.indexOf(e),r=th.slice(0,n);r.reverse();const i=th.slice(n+1);return[e].concat(r,i)}default:return[]}}function Jo(e){return Is.c("capabilitiesFromData",()=>{const t=[];we(e,"isGameCenterEnabled")&&t.push(new Vc("gameCenter")),we(e,"isSiriSupported")&&t.push(new Vc("siri")),we(e,"supportsPassbook")&&t.push(new Vc("wallet")),we(e,"supportsGameController")&&t.push(new Vc("controllers"));const n=ne(e,"familyShareEnabledDate");if(n&&!ie(e,"isFirstPartyHideableApp")){const r=new Date(n),i=new Date;if(r&&r<=i){let n=null;const r=sa(e)||!we(e,"hasInAppPurchases");n=y("familySharingCapability")?r?"familySharing":"familySharingExceptIAP":r?null:"familySharing",null!==n&&t.push(new Vc(n))}}return t})}function Xo(e){if(o(e))return null;if("mac"===ol)return function(e){const t=fo(e);if(o(t))return null;const n=u(t,"assets");if(!n.length)return null;for(const e of n)if("macSoftware"===p(e,"flavor"))return f(e,"size");return null}(e);{const t=ee(e,"fileSizeByDevice");if(t){let e=[];cl&&(e=cl.split(" ")),e=e.concat([host.deviceModel,"universal"]);for(const n of e){const e=f(t[n]);if(e)return e}}}return null}function Zo(e,t){let n,r=null,i=null,o=null,l=null,c=null,u=null;const d=Z(Gl);if(s(d))switch(d){case 0:break;case 1:if(!t.supportsArcade&&!t.presentedInTopShelf)return null;break;default:qi()}switch(ol){case"mac":t.supportsArcade?(r="editorialArtwork.splashFullScreen",o="sr"):(r="editorialArtwork.centeredFullscreenBackground",o="ep");break;case"tv":t.presentedInTopShelf?(r="editorialArtwork.topShelf",o="sr"):(r="editorialArtwork.splashFullScreen",o="ta",i="editorialArtwork.fullscreenBackground",l="sr"),y("dontOverrideTvUberDimensions")||(c=1080,u=1920);break;default:t.supportsArcade?t.prefersCompactVariant||"phone"===ol?(r="editorialArtwork.splashTall",o="oc"):(r="editorialArtwork.splashFullScreen",o="oh"):(r="editorialArtwork.bannerUber",o="sr")}return n=me(e,r),null!==i&&a(n)&&(n=me(e,i),null!==l&&(o=l)),s(n)&&s(o)?Lo(n,{cropCode:o,useCase:20,withJoeColorPlaceholder:!0,overrideHeight:c,overrideWidth:u}):null}function ea(e,t,n){let r=[];if(l(n))r=n;else switch(ol){case"mac":case"tv":r=["splashVideo16x9"];break;case"pad":r=["splashVideo4x3"];break;default:r=["splashVideo3x4"]}let i=null,a=null;for(const t of r)if(i=me(e,["editorialVideo",t]),a=me(e,["editorialVideo",t,"previewFrame"]),l(i))break;const c=Lo(a,{useCase:t,withJoeColorPlaceholder:!0,cropCode:"sr"});if(s(i)){const e=p(i,"video");if(o(e))return null;let t,n;return y("productVideoUberControls")?(t=yd,n={muteUnmute:!0}):(t={},n={}),new Mc(e,c,{allowsAutoPlay:!0,looping:!0,canPlayFullScreen:!1,showPlaybackControls:!1,playbackControls:t,autoPlayPlaybackControls:n})}return null}function ta(e){return s(e)?`${Pl.internal}:/${Cl.developer}/${Cl.href}?${El.href}=${e.href}`:null}function na(e,t){return we(e,"hasMessagesExtension",t)}function ra(e,t){return we(e,"supportsFunCamera",t)}function ia(e){return we(e,"isHiddenFromSpringboard")}function oa(e,t){return me(e,"messagesScreenshots",t)}function aa(e,t){return me(e,"screenshotsByType",t)}function sa(e){return we(e,"supportsArcade")}function la(e,t){return ca(e,t)||ye(e,["itunesNotes",t])}function ca(e,t){return ye(e,["editorialNotes",t])}function ua(e){return J(e,"isMacOSInstaller",()=>{if("mac"!==ol)return!1;const t=ye(e,"bundleId");return!!s(t)&&t.startsWith("com.apple.InstallAssistant")})}function da(e){return"watch"===ol&&Ss.isDeletableSystemAppFromData(e)&&!we(e,"isStandaloneForWatchOS")}function pa(e){if(o(e)||0===e.length)return!0;const t=e.split("."),n=f(t[0])||0,r=f(t[1])||0,i=f(t[2])||0;return host.isOSAtLeast(n,r,i)}function fa(e){return!o(e)&&0!==e.length&&k(e)}function ha(e){if("tv"===ol)switch(e){case"upsellBreakout":return!0;default:return!1}else switch(e){case"smallLockup":case"mediumLockup":case"appTrailerLockup":case"screenshotsLockup":case"mixedMediaLockup":case"upsellBreakout":case"arcadeShowcase":return!0;default:return!1}}function ma(e){let t=e.targetType;return t||(t="lockup"),t}function ga(e){let t=e.idType;return t||(t="its_id"),t}function ya(e){return null==e?"":e}function wa(e){if(!e)return null;const t=new xl(e);let n=null;for(const e of Object.keys(t.query))if("referrer"===e){"siri"===t.query[e]&&(n="com.apple.siri");break}return n}function Ta(e){return function e(t){if(o(t))return null;if(t instanceof Array){const n=[];for(const r of t){const t=e(r);s(t)&&n.push(t)}return n}if(t instanceof Object){const n={};return Object.keys(t).forEach((r,i,o)=>{const a=t[r],l=e(a);s(l)&&(n[r]=l)}),n}return t}(e)}function Aa(e){if(!e)return null;const t=new xl(e),n=t.query.term,r=t.pathname;return o(n)||o(r)?null:r.endsWith("/search")?n:null}function Ia(e,t){if(!e||!t)return"unknown";if("app-bundles"===e.type)return"bundle";switch(t.style){case"roundedRect":return"ios";case"unadorned":return"mac";case"tvRect":return"tv";case"round":return"watch";case"pill":return"messages";case"iap":return"iap";default:return qi(),"unknown"}}function ba(e){return s(e)&&"marketing-items"===e.type?{marketing:{marketingItemId:e.id,offerDecisionId:p(e,"meta.metrics.decisionId")}}:null}function ka(e,t){const n=_a(e.locationTracker);return n.push(Oa(e,t)),n}function Sa(e,t){const n=_a(e.locationTracker);return n.push(Ra(e,t)),n}function Pa(e,t){const n=new sh;n.location=Oa(e,t),e.locationTracker.locationStack.push(n)}function Ca(e){0!==e.locationStack.length?e.locationStack.pop():Is.e("ignoredValue","non-empty location stack","empty location stack")}function va(e){const t=Da(e);return t?t.position:e.rootPosition}function Ea(e){const t=Da(e);t?t.position++:e.rootPosition++}function Oa(e,t){const n=Ra(e,t);return!e.id&&e.locationTracker?(n.idType="sequential",n.id=va(e.locationTracker).toString()):(n.idType=ga(e),n.id=ya(e.id)),e.fcKind&&(n.fcKind=e.fcKind),e.displayStyle&&(n.displayStyle=e.displayStyle),n}function Ra(e,t){const n={locationPosition:va(e.locationTracker),locationType:ma(e),name:ya(t)};return e.recoMetricsData&&Object.assign(n,e.recoMetricsData),n}function _a(e){return e.locationStack.map(e=>e.location)}function Da(e){const t=e.locationStack.length;return 0===t?null:e.locationStack[t-1]}function La(e,t){return Is.c("clickOptionsForLockup",()=>{const n=Object.assign(Object.assign({},t),{id:e.id});return yo(e)&&(n.offerType="preorder"),n})}function Fa(e,t,n,r){const i={};t&&t instanceof Yu&&r&&t.iAdInfo&&t.iAdInfo.iAdAdamId===e.adamId&&Object.assign(i,t.iAdInfo.clickFields),i.actionDetails={buyParams:e.purchaseConfiguration.buyParams},i.location=n,i.targetId=e.adamId,wo(e)&&(i.offerType="preorder",s(e.expectedReleaseDate)&&(i.offerReleaseDate=ve(e.expectedReleaseDate)));const o=be(e.adamId,"button",i);o.includingFields.push("appState"),e.purchaseConfiguration.isArcadeApp&&o.includingFields.push("buttonName"),r&&o.includingFields.push("advertRotation"),e.actionMetrics.addMetricsData(o)}function xa(e,t){Na(e,Object.assign(Object.assign({},t),{actionType:"buyInitiate",subscriptionSKU:bs.arcadeProductId,actionContext:"Arcade",targetType:"button"}))}function Na(e,t,n=!1){let r=t.actionType;r||(r="navigate");const i={actionType:r};if(e instanceof Xl){const t=e;i.actionUrl=t.pageUrl}else if(e instanceof ec){const t=e;i.actionUrl=t.url}t.actionDetails&&(i.actionDetails=t.actionDetails),t.actionContext&&(i.actionContext=t.actionContext),s(t.offerType)&&(i.offerType=t.offerType),s(t.offerReleaseDate)&&(i.offerReleaseDate=ve(t.offerReleaseDate)),i.location=ka(t,e.title),t.isAdvert&&n&&t.pageInformation.iAdInfo&&Object.assign(i,t.pageInformation.iAdInfo.clickFields),t.mercuryMetricsData&&Object.assign(i,t.mercuryMetricsData);const o=be(t.id,ma(t),i);"Arcade"===t.actionContext&&("buy"===t.actionType||"buyInitiate"===t.actionType)&&o.includingFields.push("buttonName"),t.isAdvert&&o.includingFields.push("advertRotation"),e.actionMetrics.addMetricsData(o)}function Ua(e,t,n){const r={};s(t)&&(r.actionUrl=t),n.targetType||(n.targetType="button"),r.location=Sa(n,e.title),r.actionType="navigate",r.target="button_See All";const i=be("See All","button",r);e.actionMetrics.addMetricsData(i)}function Ma(e,t,n){if("trending"===e.origin||"suggested"===e.origin){const r="button",i="suggested"===e.origin?"suggested":"trending",o=be("",r,{actionType:i,actionUrl:ya(e.url),location:Sa({pageInformation:null,locationTracker:n,targetType:r},e.term),page:"Search",pageDetails:"Apps",pageType:"Search",actionDetails:{term:t,actionType:i}});e.actionMetrics.addMetricsData(o)}let r="listItem",i="trending";const o={targetId:va(n)};switch(e.origin){case"trending":r="button",i="trending";break;case"suggested":r="button",i="suggested";break;case"hints":r="listItem",i="hint";const n={searchPrefix:t};l(e.entity)&&(n.hintsEntity=e.entity),o.actionDetails=n}const a=ke(e.term,r,i,e.url,o);e.actionMetrics.addMetricsData(a)}function Ba(){const e=bs.marketingItemRolloutRate;if(!bs.isMarketingItemSupported||!e)return!1;if(1===e)return!0;const t=ql.dsid;if(!l(t))return!1;const n=100*e,r=t.slice(-2);return parseInt(r)<n}function $a(e="releaseDate",t,n){const r=xl.fromComponents(Pl.internal,null,`/${Cl.arcadeSeeAllGames}`,{sort:e}),i=new Xl("arcadeSeeAllGames",r.build());return i.title=P("SEE_ALL_GAMES"),Na(i,{id:"arcade-see-all-games-button",targetType:"button",actionType:"navigate",actionContext:"Arcade",pageInformation:t,locationTracker:n}),i}function Va(e,t,n){let r;if(y("amsUpsellSheets")&&Ba()){const n=new Ec("arcade",e,{contentId:t});r=new Xl("upsellMarketingItem"),r.pageData=n}else{const n=`${Pl.internal}://${vl.arcadeSubscribePage}`,i=new xl(n).param(El.context,e);s(t)&&i.param(El.appId,t),r=new Xl("arcadeSubscribe",i.build())}return s(n)&&xa(r,n),r}function qa(e){if(y("arcadeFamilyWelcomePage")){const t=`${Pl.internal}://${vl.arcadeWelcomePage}`,n=new xl(t).param(El.context,e);return new Xl("arcadeWelcome",n.build())}return null}function Ga(e,t){if("tv"===ol)return Ha();{const n=new Zl("arcade");return"macOS"!==host.platform||y("tabChangeWillDismissesModal")?new tc([n]):$a("releaseDate",e,t)}}function Ha(){return new ec("com.apple.Arcade://")}function ja(e=!1){const t=(new fh).forType("arcade-apps");return e?t.addingQuery("with","comingSoonApps"):t}function Wa(e){return ja().withSparseLimit(e).asPartialResponseLimitedToFields(["artwork"])}function za(e,t,n){return Ba()&&!s(n)?function(e,t){a(e)&&(e="arcadeGeneric");const n=(new fh).forType("upsellMarketingItem").addingQuery("serviceType","arcade").addingQuery("placement",e).includingMetaKeys("marketing-items",["metrics"]).includingRelationships(["contents"]).includingAttributes(["marketingArtwork","marketingVideo"]);return s(t)&&n.addingQuery("seed",t),n}(e,t):Ya(function(e){switch(e){case"arcadeAskToBuy":return"askToBuy";case"arcadeGroupingLockup":return"groupingLockup";case"arcadeLaunchRepair":return"launchRepair";case"arcadeProductPage":return"productPage";case"arcadeTopShelfATV":return"topShelfATV";case"arcadeTopShelfATVClickThrough":return"topShelfATVClickThrough";case"arcadeTodayCard":return"editorialItem";case"arcadeStoryCanvas":return"editorialItemCanvas";case"arcadeComingSoon":return"arcadeComingSoon";case"arcadeTabHeader":return"arcadeTabHeader";case"arcadeTabNavBar":return"arcadeTabNavBar";case"arcadeGeneric":case"arcadeAppClip":case"arcadeAppStoreComponents":default:return"generic"}}(e),t,n)}function Ya(e,t,n){a(e)&&(e="generic");const r=(new fh).forType("upsell").addingContext("arcade").addingQuery("action",e);return s(t)&&r.addingQuery("app",t),s(n)&&r.addingQuery("editorialItem",n),r}function Ka(e=null,t=!1,n=null){return new Promise((r,i)=>{if(!y("recentlyPlayedGames"))return void r(null);let a;a=y("getRecentlyPlayedGamesWithTimeout")?uh(n):ch(),a.then(n=>{if(o(n)||0===n.length)r(null);else if(c(e)&&n.length>e&&(n=n.slice(0,e)),t)$((new fh).forType("apps").withIds(n).includingAttributes(["editorialArtwork","editorialVideo","description","minimumOSVersion"])).then(e=>r(e));else{const e={data:[]};n.forEach(t=>{e.data.push({id:t,type:"apps"})}),r(e)}}).catch(e=>{console.log(`getRecentlyPlayedGames() failed with: ${e}`),r(null)})})}function Qa(e){let t=null,n=null,r=null;const i=H(e,"upsell")||H(e,"marketing-items");if(a(i)||a(i.data))return null;for(const e of i.data)switch(e.type){case"marketing-items":t=e;continue;case"editorial-items":n=e;continue;case"in-apps":r=e;continue}return o(t)&&(o(n)||o(r))?null:{editorialData:n,inAppData:r,marketingItemData:t}}function Ja(e){if(!e)return null;let t=null;const n=u(e,"results.data");n.length>0&&(t=n[0]);const r=h(e,"results.content"),i=h(e,"results.offer");return s(t)||!o(r)&&!o(i)?{editorialData:r,inAppData:i,marketingItemData:t}:null}function Xa(){switch(ol){case"phone":return"iphone";case"pad":return"ipad";case"tv":return"appletv";case"mac":return"mac";case"watch":return"watch";default:return null}}function Za(){switch(host.clientIdentifier){case"com.apple.TVAppStore.AppStoreTopShelfExtension":case"com.apple.Arcade.ArcadeTopShelfExtension":return[];default:{const e=Xa();return function(e){const t=new Set;if(t.add("iphone"),t.add("ipad"),t.add("appletv"),t.add("mac"),t.add("watch"),null!==e)for(const n of e)t.delete(n);return Array.from(t)}(new Set([e]))}}}function es(){switch(ol){case"phone":return 6;case"pad":return 10;case"mac":return 12;default:return 8}}function ts(){let e=null;return host.clientIdentifier===el?e="messages":host.clientIdentifier===Zs&&(e="watch"),e}function ns(e,t=host.clientIdentifier,n=[],r=fs){e||(e="mac"===r.deviceType?39:36);const i=(new fh).forType("categories").includingAdditionalPlatforms(n).addingQuery("genre",`${e}`);return t===Zs?i.addingContext("watch"):t===el&&i.addingContext("messages"),i}function rs(e,t=!0){return Is.c("categoryListFromApiResponse",()=>{const n=function e(t,n=!0){return Is.c("categoryFromApiResponse",()=>{if(!t)return null;const r=p(t,"name"),i=p(t,"genre"),o=p(t,"ages"),a=Lo(h(t,"artwork"),{allowingTransparency:!0,useCase:19}),l=function(e){return e.sort((e,t)=>{try{return e.name.localeCompare(t.name,kl,{usage:"sort"})}catch(e){return 0}})}(u(t,"children").map(t=>e(h(t),n)).filter(e=>s(e))),c=p(t,"label");return c&&n&&l.unshift(new vf(c,i,a,o,[])),new vf(r,i,a,o,l)})}(h(u(e,"results.categories"),"0"),t);return n?new Ef(n.children):null})}function is(e,t){return Is.b("topShelfInsetItemFromEditorialItem",()=>{const n=new wh(`${e.type}_${e.id}`);if(n.image=function(e,t,n){const r=me(e,"editorialArtwork.crossoverCard");if(!s(r))return null;const i=Lo(r,{withJoeColorPlaceholder:!0,useCase:21});return i.crop="ek",i}(e),!s(n.image))return console.log(`Missing crossover artwork for: ${e.id}`),null;n.tintStyle=Y(n.image.backgroundColor)?"light":"dark";const r=ne(e,"displayStyle");let i=la(e,"name");o(i)&&"Branded"===r&&(i=ne(e,"label")),n.title=i,n.heading=ne(e,"label"),n.subheading=la(e,"short"),n.accessibilityLabel=i;const a=_o(e,i,{targetType:"button",pageInformation:t.pageInformation,locationTracker:t.locationTracker}),l=ao(e,a,host.clientIdentifier);return l instanceof Xl?(n.displayAction=new mh("url"),n.displayAction.url=ss(l.pageUrl),n):(console.error(`No action to map for top shelf item: ${e.id}`),null)})}function os(e,t,n,r,i,o){const a=[];for(const l of e){if(!s(l.id)||!s(l.attributes))continue;if(c(o)&&i.size>=o)break;const e=l.id;if(i.has(e)){console.log("Skipping existing app.");continue}const u=as(l,t,n,r);u&&(a.push(u),i.add(e))}return a}function as(e,t,n,r){return Is.b("topShelfItemFromAppData",()=>{const i=e.id,c=new Th(`${e.type}_${i}`),u=ye(e,"bundleId");if(!s(u))return console.log(`Missing bundleId for app: ${i}`),null;if(c.isAppleArcadeGame=sa(e),c.image=Zo(e,{supportsArcade:c.isAppleArcadeGame,presentedInTopShelf:!0}),a(c.image))return console.log(`Missing full screen artwork for app: ${i}`),null;const d=ea(e,21);s(d)&&s(d.videoUrl)&&(c.previewVideoUrl=d.videoUrl),c.title=ne(e,"name"),c.accessibilityLabel=c.title;const f=ye(e,"description.standard");if(l(f)&&(c.summary=f.replace(/([\n]+)/g,"\n")),c.isGameControllerRequired=we(e,"requiresGameController"),t)c.playAction=function(e){const t=new mh("openApplication");return t.bundleIdentifier=e,t.title=P("OFFER_BUTTON_TITLE_ARCADE_OPEN"),t.accessibilityLabel=t.title,t}(u),c.installAction=function(e,t,n,r){const i=fo(n),a=go(i),s=p(i,"buyParams");if(o(s))throw new Error(`Missing buyParams when creating install action for: ${e}`);const l=po(n,s,a,!1,r.pageInformation,"unknown"),c=new mh("installApplication");return c.bundleIdentifier=t,c.title=P("OFFER_BUTTON_TITLE_ARCADE_STANDARD"),c.accessibilityLabel=c.title,c.userInfo={adamId:e,token:l},c}(i,u,e,r);else{const e=P(n?"OFFER_BUTTON_TITLE_ARCADE_TRY":"OFFER_BUTTON_TITLE_ARCADE_NOT_SUBSCRIBED");c.playAction=ls(e,i)}const h={pageInformation:r.pageInformation,locationTracker:r.locationTracker};c.namedAttributes=function(e,t){return Is.b("namedAttributesFromAppData",()=>{const n=[],r=Ir(e,!1,t);for(const e of r){if(n.length>=4)break;if("annotation"!==e.style||a(e.accessibilityCaption)||a(e.accessibilityTitle))continue;const t=new gh(e.accessibilityCaption);t.values=[e.accessibilityTitle],n.push(t)}return n})}(e,h);const m=_o(e,c.title,{targetType:"button",pageInformation:r.pageInformation,locationTracker:r.locationTracker}),g=io(e,m,host.clientIdentifier);return g instanceof Xl?(c.displayAction=new mh("url"),c.displayAction.url=ss(g.pageUrl),c):(console.error(`No action to map for top shelf more info of app: ${i}`),null)})}function ss(e){if(!l(e))return null;let t=null;switch(host.clientIdentifier){case"com.apple.Arcade.ArcadeTopShelfExtension":t=tl}if(!l(t))return e;const n=new xl(e);return n.protocol=t,n.build()}function ls(e,t=null){const n=new xl(`${tl}://${vl.arcadeSubscribePage}`);l(t)&&n.param(El.appId,t),n.param(El.context,"arcadeTopShelfATVClickThrough");const r=new mh("url");return r.url=n.build(),r.title=e,r}function cs(e,t,n,r,i,o,a){kh.useNativeValues(o);let l=t;const c=Ye(n);l=us("pageId",c,l),l=us("pageType",c,l),l=us("pageContext",o,l),l=ps("topic",Sh.defaultTopic,l);const u=kh.params;for(const e of Object.keys(u))l=us(e,u,l);if(a)for(const e of Object.keys(a))l=us(e,a,l),l=us(e,a,l,null);if(!o)return l;if(!r){const e=p(o,"extRefUrl2"),t=wa(e);e&&t&&(o.refApp=t),l=us("extRefApp2",o,l,null),l=us("extRefUrl2",o,l,null)}const d=p(c,"pageId"),f=d&&d===e;if("Software"!==p(c,"pageType")||f){const e=Aa(p(o,"refUrl"));s(e)?l=us("searchTerm",{searchTerm:e},l):s(n)&&(l=ds("searchTerm",n.searchTerm,l))}return i&&(l=ps("platformDisplayStyle",i,l)),l}function us(e,t,n,r){return ds(e,p(t,e),n,r)}function ds(e,t,n,r="mt"){return o(e)?n:o(t)?n:ps(e,t,n,r)}function ps(e,t,n,r="mt"){let i=e;return r&&(i="mt"+e.charAt(0).toUpperCase()+e.slice(1)),n+"&"+i+"="+encodeURIComponent(t)}var fs,hs,ms,gs,ys,ws,Ts,As,Is,bs,ks,Ss,Ps,Cs,vs,Es,Os,Rs;n.r(t),fs={},n.r(fs),n.d(fs,"appStoreIdentifier",(function(){return Xs})),n.d(fs,"watchIdentifier",(function(){return Zs})),n.d(fs,"messagesIdentifier",(function(){return el})),n.d(fs,"arcadeIdentifier",(function(){return tl})),n.d(fs,"tvIdentifier",(function(){return nl})),n.d(fs,"productPageExtensionIdentifier",(function(){return rl})),n.d(fs,"subscribePageExtensionIdentifier",(function(){return il})),n.d(fs,"deviceType",(function(){return ol})),n.d(fs,"screenSize",(function(){return al})),n.d(fs,"screenCornerRadius",(function(){return sl})),n.d(fs,"guid",(function(){return ll})),n.d(fs,"thinnedApplicationVariantIdentifier",(function(){return cl})),n.d(fs,"storefrontIdentifier",(function(){return ul})),n.d(fs,"newPaymentMethodEnabled",(function(){return dl})),n.d(fs,"buildType",(function(){return pl})),n.d(fs,"isActivityAvailable",(function(){return fl})),n.d(fs,"isElectrocardiogramInstallationAllowed",(function(){return hl})),n.d(fs,"isSidepackingEnabled",(function(){return ml})),n.d(fs,"supportsHEIF",(function(){return gl})),n.d(fs,"activePairedWatchSystemVersion",(function(){return yl})),n.d(fs,"deviceHasCapabilities",(function(){return A})),n.d(fs,"isActivePairedWatchSystemVersionAtLeastMajorVersionMinorVersionPatchVersion",(function(){return I})),n.d(fs,"isPairedSystemVersionAtLeast",(function(){return b})),n.d(fs,"isActivePairedWatchSystemVersionBelow",(function(){return k})),n.d(fs,"hasActivePairedWatch",(function(){return S})),hs={},n.r(hs),n.d(hs,"purchasedSpotlightIndex",(function(){return Hp})),n.d(hs,"notPurchasedSpotlightIndex",(function(){return jp})),n.d(hs,"purchasedOrdering",(function(){return Wp})),n.d(hs,"notPurchasedOrdering",(function(){return zp})),ms={},n.r(ms),n.d(ms,"purchasedSpotlightIndex",(function(){return Yp})),n.d(ms,"notPurchasedSpotlightIndex",(function(){return Kp})),n.d(ms,"purchasedOrdering",(function(){return Qp})),n.d(ms,"notPurchasedOrdering",(function(){return Jp})),gs={},n.r(gs),n.d(gs,"purchasedSpotlightIndex",(function(){return Xp})),n.d(gs,"notPurchasedSpotlightIndex",(function(){return Zp})),n.d(gs,"purchasedOrdering",(function(){return ef})),n.d(gs,"notPurchasedOrdering",(function(){return tf})),ys={},n.r(ys),n.d(ys,"purchasedSpotlightIndex",(function(){return nf})),n.d(ys,"notPurchasedSpotlightIndex",(function(){return rf})),n.d(ys,"purchasedOrdering",(function(){return of})),n.d(ys,"notPurchasedOrdering",(function(){return af})),ws={},n.r(ws),n.d(ws,"purchasedSpotlightIndex",(function(){return sf})),n.d(ws,"notPurchasedSpotlightIndex",(function(){return lf})),n.d(ws,"purchasedOrdering",(function(){return cf})),n.d(ws,"notPurchasedOrdering",(function(){return uf})),Ts={},n.r(Ts),n.d(Ts,"purchasedSpotlightIndex",(function(){return df})),n.d(Ts,"notPurchasedSpotlightIndex",(function(){return pf})),n.d(Ts,"purchasedOrdering",(function(){return ff})),n.d(Ts,"notPurchasedOrdering",(function(){return hf})),As=n(2),Is=n(0);const _s={},Ds="undefined"!=typeof ask?ask.props:{tvAppEnabledStorefronts:["143441","143455","143460"],spamBlockingExtensionsEditorialItemID:"1490737895",clientFeatures:{}};bag.registerBagKeys([{key:"trending-searches",type:"url"},{key:"search",type:"url"},{key:"searchHints",type:"url"},{key:"personalizedUserReviewUrl",type:"url"},{key:"personalizedUserReviewEnabled",type:"boolean"},{key:"p2-application-user-rate-content",type:"url"},{key:"p2-application-user-write-review",type:"url"},{key:"p2-accessory-room",type:"url"},{key:"passbook",type:"url"},{key:"library-link",type:"url"},{key:"metrics",type:"dictionary"},{key:"language-tag",type:"string"},{key:"language",type:"string"},{key:"p2-service-terms-url",type:"url"},{key:"usePostForAppStoreSearch",type:"boolean"},{key:"isBuyingScheduledGiftCertificateEnabled",type:"boolean"},{key:"isScheduledGiftingEnabled",type:"boolean"},{key:"AddFundsUrl",type:"url"},{key:"personalized-buy-buttons/software",type:"url"},{key:"uvSearch/nowplaying-enabled",type:"boolean"},{key:"supportLinkUrl",type:"url"},{key:"voteUrl",type:"url"},{key:"reportConcernUrl",type:"url"},{key:"reportConcernExplanation",type:"string"},{key:"reportConcernReasons",type:"array"},{key:"reportProblemUrl",type:"url"},{key:"reportProblemUrlDaysToDisplay",type:"number"},{key:"createAccountUrl",type:"url"},{key:"apps-media-api-host",type:"string"},{key:"apps-media-api-edge-host",type:"string"},{key:"apps-media-api-preview-host",type:"string"},{key:"apps-media-api-search-edge-host",type:"string"},{key:"apps-media-api-edge-end-points",type:"array"},{key:"apps-media-api-search-ads-limit",type:"number"},{key:"countryCode",type:"string"},{key:"searchSortOptions",type:"array"},{key:"ageBands",type:"array"},{key:"processRedirectUrl/whitelistedQueryParams",type:"array"},{key:"processRedirectUrl/endpoint",type:"string"},{key:"app-store-app-id",type:"string"},{key:"arcade-iap-family-id",type:"string"},{key:"ocelot-iap-family-id",type:"string"},{key:"arcade-iap-offer-name",type:"string"},{key:"ocelot-iap-offer-name",type:"string"},{key:"transparencyLawEditorialItemId",type:"string"},{key:"hideableSystemApps",type:"array"},{key:"tabs/standard",type:"array"},{key:"isInternalArcadeComingSoon",type:"boolean"},{key:"watchAppsGrouping",type:"url"},{key:"requireAgeVerification",type:"boolean"},{key:"ageRatingLearnMoreEditorialItemId",type:"string"},{key:"isMarketingItemSupported",type:"boolean"},{key:"marketingItemRolloutRate",type:"number"},{key:"shouldUseEditorialItemUpsellFallback",type:"boolean"},{key:"safariExtensionsGrouping",type:"url"},{key:"arcadeOfferEditorialItemId",type:"string"}]),bs={get trendingSearchesURL(){return bag.url("trending-searches")},get searchHintsURL(){return bag.url("searchHints")},get personalizedUserReviewURL(){return bag.url("personalizedUserReviewUrl")},get personalizedUserReviewEnabled(){return bag.boolean("personalizedUserReviewEnabled")},get userRateURL(){return bag.url("p2-application-user-rate-content")},get writeReviewURL(){return bag.url("p2-application-user-write-review")},get accessoryRoomURL(){return bag.url("p2-accessory-room")},get passbookMainURL(){return bag.url("passbook")},get libraryLinkURL(){return bag.url("library-link")},get metricsConfiguration(){return bag.dictionary("metrics")},get language(){return bag.string("language")},get mediaApiLanguage(){return bag.string("language-tag")||bag.string("language")},get termsAndConditionsURL(){return bag.url("p2-service-terms-url")},get usePostForAppStoreSearch(){return bag.boolean("usePostForAppStoreSearch")},get isMonetaryGiftingEnabled(){return bag.boolean("isBuyingScheduledGiftCertificateEnabled")},get accountTopUpURL(){return bag.url("AddFundsUrl")},get isContentGiftingEnabled(){return bag.boolean("isScheduledGiftingEnabled")},get buyButtonMetadataURL(){return bag.url("personalized-buy-buttons/software")},get isTVAppEnabled(){return bag.boolean("uvSearch/nowplaying-enabled")},get emailSupportLinkURL(){return bag.url("supportLinkUrl")},get voteUrl(){return bag.url("voteUrl")},get reportConcernUrl(){return bag.url("reportConcernUrl")},get reportConcernExplanation(){return bag.string("reportConcernExplanation")},get reportConcernReasons(){return bag.array("reportConcernReasons")},get reportProblemUrl(){return bag.url("reportProblemUrl")},get reportProblemUrlDaysToDisplay(){return bag.double("reportProblemUrlDaysToDisplay")||90},get createAccountUrl(){return bag.url("createAccountUrl")},get mediaCountryCode(){return bag.string("countryCode")},get mediaHost(){return bag.string("apps-media-api-host")},get mediaEdgeHost(){return bag.string("apps-media-api-edge-host")},get mediaEdgeSearchHost(){return bag.string("apps-media-api-search-edge-host")},get mediaPreviewHost(){return bag.string("apps-media-api-preview-host")},get edgeEndpoints(){const e=bag.array("apps-media-api-edge-end-points");return void 0===e?[]:e},get mediaAdvertRequestLimit(){return bag.double("apps-media-api-search-ads-limit")||4},get searchSortOptions(){return bag.array("searchSortOptions")||[]},get ageBands(){return bag.array("ageBands")||[]},get redirectUrlWhitelistedQueryParams(){return bag.array("processRedirectUrl/whitelistedQueryParams")||["affC","adId","advp","at","ct","itsct","itscg","itscc","itcCt","its_qt","ls","partnerId","pt","qtkid","uo"]},get redirectUrlEndpoint(){return bag.string("processRedirectUrl/endpoint")||"https://itunes.apple.com/WebObjects/MZStoreServices.woa/wa/processRedirectUrl"},get arcadeAppAdamId(){return bag.string("app-store-app-id")},get arcadeProductFamilyId(){return bag.string("arcade-iap-family-id")||bag.string("ocelot-iap-family-id")},get arcadeProductId(){return bag.string("arcade-iap-offer-name")||bag.string("ocelot-iap-offer-name")},get searchTransparencyAdamId(){return bag.string("transparencyLawEditorialItemId")},get hideableSystemApps(){return bag.array("hideableSystemApps")||[]},get tabsStandard(){return bag.array("tabs/standard")||[]},get isArcadeComingSoonEnabled(){return bag.boolean("isInternalArcadeComingSoon")},get watchAppsGroupingURL(){return bag.url("watchAppsGrouping")||"https://apps.apple.com/WebObjects/MZStore.woa/wa/viewFeature?id=1472048385"},get requireAgeVerification(){return bag.boolean("requireAgeVerification")},get ageRatingLearnMoreEditorialItemId(){return bag.string("ageRatingLearnMoreEditorialItemId")},get isMarketingItemSupported(){return bag.boolean("isMarketingItemSupported")},get marketingItemRolloutRate(){return bag.double("marketingItemRolloutRate")||0},get shouldUseEditorialItemUpsellFallback(){return bag.boolean("shouldUseEditorialItemUpsellFallback")},get safariExtensionsGroupingURL(){return bag.url("safariExtensionsGrouping")},get arcadeOfferEditorialItemId(){return bag.string("arcadeOfferEditorialItemId")}};class Ls{constructor(){this.$incidents=void 0}isValid(){return!0}}class Fs extends Ls{constructor(){super()}}class xs extends Ls{constructor(e,t,n,r,i,o,a,s,l,c,u,d,p){super(),this.buyParams=e,this.vendor=t,this.appName=n,this.bundleId=r,this.appPlatforms=i,this.isPreorder=null!=o&&o,this.excludeAttribution=null==a||a,this.metricsPlatformDisplayStyle=s,this.isRedownload=null!=c&&c,this.lineItem=l,this.preflightPackageUrl=void 0===u?null:u,this.isArcadeApp=d,this.additionalHeaders=p}}class Ns extends Ls{constructor(e,t,n,r,i,o,a,s,l,c,u,d,p,f,h,m){super(),this.offerType=e,this.adamId=t,this.parentAdamId=r,this.style=null==n?"infer":n,this.environment=null==i?"light":i,this.tint=null==o?"blue":o,this.offerTint=null==a?{type:"blue"}:a,this.titles=null==s?{}:s,this.subtitles=null==l?{}:l,this.hasInAppPurchases=c,this.isDeletableSystemApp=u,this.isFree=d,this.offerLabelStyle=null==p?"none":p,this.hasDiscount=f,this.contentRating=h,this.subscriptionFamilyId=m}newOfferDisplayPropertiesChangingAppearance(e,t,n,r,i){return new Ns(this.offerType,this.adamId,null==t||!e&&"disabled"===this.style?this.style:t,this.parentAdamId,null==n?this.environment:n,null==r?this.tint:r,null==i?this.offerTint:i,this.titles,this.subtitles,this.hasInAppPurchases,this.isDeletableSystemApp,this.isFree,this.offerLabelStyle,this.hasDiscount,this.contentRating,this.subscriptionFamilyId)}}class Us extends Ls{constructor(e,t,n){super(),this.offerAction=t,this.offerDisplayProperties=n,this.personalizedOfferType=e}}class Ms extends Ls{constructor(e,t,n){super(),this.format=e,this.quality=t,this.supportsWideGamut=n}isValid(){return this.format&&void 0!==this.supportsWideGamut}}class Bs extends Ls{constructor(e,t,n,r){super(),this.checksum=null,this.backgroundColor=null,this.style=null,this.crop="bb",this.template=e,this.width=t,this.height=n,this.variants=r}isPortrait(){return this.height>=this.width}isLandscape(){return!this.isPortrait()}isValid(){return this.template&&this.width>0&&this.height>0&&this.variants.length>0}}class $s extends Ls{constructor(e,t){super(),this.artwork=e,this.mediaPlatform=t}}class Vs extends Ls{constructor(e,t,n,r){super(),this.appPlatform=e,this.supplementaryAppPlatforms=n||[],this.deviceCornerRadiusFactor=r,this.mediaType=t}isEqualTo(e){this.supplementaryAppPlatforms.sort(),e.supplementaryAppPlatforms.sort();const t=this.supplementaryAppPlatforms.join(",")===e.supplementaryAppPlatforms.join(",");return e.appPlatform===this.appPlatform&&e.mediaType===this.mediaType&&t&&e.deviceCornerRadiusFactor===this.deviceCornerRadiusFactor}}class qs{constructor(e,t){this.width=e,this.height=t}static fromNativeSize(e){return new qs(e.width,e.height)}isEqualTo(e){return e.width===this.width&&e.height===this.height}}class Gs extends Ls{constructor(e,t,n,r,i,o){super(),this.itemName=e,this.url=t,this.developer=n,this.category=r,this.fileSize=i,this.mediaType=o}}class Hs extends Ls{constructor(e,t,n){super(),this.context="article",this.text=e,this.subtitle=t,this.artwork=n}}class js extends Ls{constructor(e,t,n,r,i,o,a,s,l,c,u,d){super(),this.context="product",this.adamId=e,this.storeFrontIdentifier=t,this.name=n,this.platform=r,this.icon=i,this.screenshots=o,this.videos=a,this.isMessagesOnlyApp=s,this.subtitle=l,this.genreName=c,this.messagesAppIcon=u,this.notesMetadata=d}}class Ws extends Ls{constructor(e,t,n){super(),this.metadata=e,this.url=t,this.shortUrl=n}}class zs extends Ls{constructor(e,t,n){super(),this.reasonId=e,this.name=t,this.uppercaseName=n}}class Ys extends Fs{constructor(e,t,n){super(),this.text=e,this.mediaType=t||"text/plain",this.style=n||"standard",this.alignment="localized",this.isCollapsed=!1,this.suppressVerticalMargins=!1,this.wantsCollapsedNewlines=!0}}class Ks extends Fs{}class Qs extends Ls{constructor(e){super(),this.isFallbackStyle=!1,this.type=e}}const Js="undefined"!=typeof ask?ask.client:{deviceType:"phone",screenSize:{width:0,height:0},screenCornerRadius:0,guid:"",deviceHasCapabilities:e=>!1,thinnedApplicationVariantIdentifier:null,storefrontIdentifier:"",newPaymentMethodEnabled:!1,buildType:"production",isActivityAvailable:!1,isElectrocardiogramInstallationAllowed:!1,isSidepackingEnabled:!0,supportsHEIF:!0,isActivePairedWatchSystemVersionAtLeastMajorVersionMinorVersionPatchVersion:(e,t,n)=>!1},Xs="com.apple.AppStore",Zs="com.apple.AppStore.BridgeStoreExtension",el="com.apple.MobileSMS",tl="com.apple.Arcade",nl="com.apple.TVAppStore",rl="com.apple.AppStore.ProductPageExtension",il="com.apple.AppStore.SubscribePageExtension",ol=Js.deviceType,al=qs.fromNativeSize(Js.screenSize),sl=Js.screenCornerRadius,ll=Js.guid,cl=Js.thinnedApplicationVariantIdentifier,ul=Js.storefrontIdentifier,dl=Js.newPaymentMethodEnabled,pl=Js.buildType,fl=Js.isActivityAvailable,hl=Js.isElectrocardiogramInstallationAllowed,ml=Js.isSidepackingEnabled,gl=Js.supportsHEIF,yl=Js.activePairedWatchSystemVersion;let wl=null;const Tl=null,Al="undefined"!=typeof ask?ask.loc:{identifier:"en",arcadeWordmarkAssetName:"arcade-wordmark-en",decimal:e=>null!=e?String(e):null,string:e=>e,stringWithCount:(e,t)=>e,stringWithCounts:(e,t)=>e,uppercased:e=>e,fileSize:e=>null!=e?`${e} bytes`:null,formattedCount:e=>null!=e?`${e}`:null,timeAgo:e=>null!=e?e.toString():null,formatDate:(e,t)=>null!=t?t.toString():null,formatDateInSentence:(e,t,n)=>null!=n?n.toString():null,relativeDate:e=>null!=e?e.toString():null},Il=Al.identifier,bl=Al.arcadeWordmarkAssetName,kl=Il.split("_")[0],Sl={},Pl={internal:"x-as3-internal",http:"http",https:"https",itms:"itms",itmss:"itmss",itmsAppss:"itms-appss",itmsApps:"itms-apps",itmsMessagess:"itms-messagess",itmsMessages:"itms-messages",itmsWatchs:"itms-watchs",itmsWatch:"itms-watch",file:"file",resource:"resource",macappstore:"macappstore",macappstores:"macappstores",tvappstoreLegacy:"com.apple.tvappstore",tvappstore:"com.apple.TVAppStore",arcade:"com.apple.Arcade"},Cl={shelf:"shelf",store:"WebObjects/MZStore.woa/wa",storeElements:"WebObjects/MZStoreElements.woa/wa",lookup:"lookup",docTypeLookup:"docTypeLookup",install:"install",grouping:"viewGrouping",viewArtist:"viewArtist",viewSoftware:"viewSoftware",today:"today",arcade:"arcade",arcadeUpsellPreview:"arcadeUpsellPreview",arcadeSeeAllGames:"arcadeSeeAllGames",arcadeSeeAllGamesLoadMore:"arcadeSeeAllGamesLoadMore",genre:"genre",viewGenre:"viewGenre",recommendationsSeeAll:"recommendationsSeeAll",screenshots:"screenshots",room:"viewRoom",multiRoom:"viewMultiRoom",topCharts:"viewTop",mediaCharts:"charts",product:"app",siri:"siri",productBundle:"app-bundle",developer:"developer",artist:"artist",ratings:"ratings",reviews:"reviews",viewReviews:"viewContentsUserReviews",personalizedReviews:"personalizedReviews",article:"article",story:"story",editorialItem:"editorialItem",viewEditorialItem:"viewEditorialItem",todayCardPreview:"todayCardPreview",mso:"mso",resetAndRedirect:"resetAndRedirect",account:"account",personalizationTransparency:"personalizationTransparency",href:"href",eula:"eula",tvEula:"tv-eula",privacyPolicy:"privacyPolicy",appsForYou:"apps-for-you",storeFront:"storeFront",searchLandingPage:"searchLandingPage",searchTrendingApps:"searchTrendingApps",test:"test",builtIn:"builtIn",shelfTextTest:"shelfText",shelfLockupsTest:"shelfLockups",shelfMiscTest:"shelfMisc",lockupTest:"lockupTest",articleTestArtwork:"articleArtworkTest",articleTestSingleAppIcon:"articleSingleAppIconTest",articleTestSingleAppIconHeroArt:"articleSingleAppIconHeroArtTest",articleTestBrandedApp:"articleBrandedAppTest",articleTestMultiAppTwo:"articleMultiAppTwoTest",articleTestMultiAppThree:"articleMultiAppThreeTest",articleTestGrid:"articleGridTest",articleTestInAppPurchase:"articleInAppPurchaseTest"},vl={showUpdatesPage:"showUpdatesPage",showAccountPage:"showAccountPage",showPurchasesPage:"showPurchasesPage",showSubscriptionsPage:"showSubscriptionsPage",searchExtensions:"searchExtensions",searchItunes:"search.itunes.apple.com",storePreview:"storepreview.apple.com",product:"product",arcadeSubscribePage:"arcadeSubscribePage",arcadeWelcomePage:"arcadeWelcomePage",arcadeSeeAllPage:"arcadeSeeAllGames",familyCircle:"familyCircle",spamBlockingExtensions:"spamBlockingExtensions",safariExtensions:"safariExtensions"},El={id:"id",ids:"ids",countryCode:"cc",featuredContentId:"fcId",fetchData:"fetchData",isTodaySection:"isTodaySection",popId:"popId",genreId:"genreId",genre:"genre",bundleIdentifier:"bundleIdentifier",offerName:"offerName",chartIdentifier:"chartIdentifier",chartIdentifiers:"charts",v0:"v0",action:"action",type:"type",context:"context",isArcade:"isArcade",isSubscribed:"isSubscribed",isTrialAvailable:"isTrialAvailable",isArcadeSeeAllGamesShelf:"isArcadeSeeAllGamesShelf",isPurchasesApp:"isPurchasesApp",enabled:"enabled",href:"href",recoMetrics:"recoMetrics",showingFallbackMedia:"showingFallbackMedia",path:"path",useReleaseId:"useReleaseId",clientIdentifierOverride:"clientIdentifierOverride",subscribePageMessage:"message",editorialItem:"editorialItem",askToBuyId:"askToBuyId",appId:"appId",isPPT:"isPPT",sort:"sort",grouping:"grouping",code:"code",includePostSubscribeAttribution:"includePostSubscribeAttribution"},Ol={inAppPurchaseId:"inAppPurchaseId"},Rl={url:"productUrl",isSubscription:"isSubscription"},_l={clientSpecifier:"app"},Dl=/^([a-z][a-z0-9.+-]*:)(\/\/)?([\S\s]*)/i,Ll=/([^=?&]+)=?([^&]*)/g,Fl=["hash","query","pathname","host"];class xl{constructor(e){if(this.query={},!e)return;let t=e;const n=Dl.exec(e);if(n){let e=n[1];e&&(e=e.split(":")[0]),this.protocol=e,t=n[3]}let r={remainder:t,result:null};for(const e of Fl){if(!r.remainder)break;switch(e){case"hash":r=U(r.remainder,"#","suffix"),this.hash=r.result;break;case"query":r=U(r.remainder,"?","suffix"),r.result&&(this.query=xl.queryFromString(r.result));break;case"pathname":r=U(r.remainder,"/","suffix"),r.result&&(this.pathname="/"+r.result);break;case"host":if(r.remainder){const e=U(r.remainder,"@","prefix"),t=e.result,n=e.remainder;if(t){const e=t.split(":");this.username=decodeURIComponent(e[0]),this.password=decodeURIComponent(e[1])}if(n){const e=n.split(":");this.host=e[0],this.port=e[1]}}break;default:throw new Error("Unhandled case!")}}}set(e,t){if(!t)return this;switch("query"===e&&"string"==typeof t&&(t=xl.queryFromString(t)),e){case"query":this.query=t;break;default:this[e]=t}return this}append(e,t){const n=this[e];let r;if("query"===e)"string"==typeof t&&(t=xl.queryFromString(t)),r="string"==typeof n?Object.assign({existingValue:n},t):Object.assign(Object.assign({},n),t);else{let i=n;i||(i="");let o=i;if("pathname"===e){const e=i.length;e&&"/"===n[e-1]||(o+="/")}o+=t,r=o}return this.set(e,r)}param(e,t){return e?(this.query||(this.query={}),this.query[e]=t,this):this}removeParam(e){return e&&this.query?(void 0!==this.query[e]&&delete this.query[e],this):this}path(e){return this.append("pathname",e)}pathExtension(){if(void 0===this.pathname)return null;const e=this.pathname.split("/").filter(e=>e.length>0).pop().split(".");return e.filter((function(e){return""!==e})).length<2?null:e.pop()}pathComponents(){return this.pathname?this.pathname.split("/").filter(e=>e.length>0):[]}build(){return this.toString()}toString(){let e="";return this.protocol&&(e+=this.protocol+"://"),this.username&&(e+=encodeURIComponent(this.username),this.password&&(e+=":"+encodeURIComponent(this.password)),e+="@"),this.host&&(e+=this.host,this.port&&(e+=":"+this.port)),this.pathname&&(e+=this.pathname),this.query&&Object.keys(this.query).length&&(e+="?"+xl.toQueryString(this.query)),this.hash&&(e+="#"+this.hash),e}static queryFromString(e){const t={};let n=Ll.exec(e);for(;n;){const r=decodeURIComponent(n[1]),i=decodeURIComponent(n[2]);t[r]=i,n=Ll.exec(e)}return t}static toQueryString(e){let t="",n=!0;for(const r of Object.keys(e)){n||(t+="&"),n=!1,t+=encodeURIComponent(r);const i=e[r];i&&i.length&&(t+="="+encodeURIComponent(i))}return t}static from(e){return new xl(e)}static fromComponents(e,t,n,r,i){const o=new xl;return o.protocol=e,o.host=t,o.pathname=n,o.query=r,o.hash=i,o}}!function(e){e.requestedUrl="_jet-internal:metricsHelpers_requestedUrl",e.timingValues="_jet-internal:metricsHelpers_timingValues",e.pageInformation="_jet-internal:metricsHelpers_pageInformation"}(ks||(ks={}));const Nl=(e,t)=>e||t;class Ul extends Error{}const Ml="x-apple-application-instance",Bl="x-apple-application-site",$l=new RegExp("#?([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])"),Vl="_jet-internal:derived-data".toString(),ql="undefined"!=typeof ask?ask.user:{firstName:"Jonny",lastName:"Appleseed",accountIdentifier:"appleseed@apple.com",dsid:"123456",isManagedAppleID:!1,isUnderThirteen:!1,userAgeIfAvailable:null,cookiesForUrl:e=>[],cookieForUrlWithName:(e,t)=>null},Gl={identifer:"2Tp1_Sa",treatments:[0,1]},Hl={identifer:"3NepyQj",treatments:[0,1]};Ss=function(){if("watch"===ol){const e=new Map;for(const t of bs.hideableSystemApps){const n=p(t,"bundle-id","coercible"),r=p(t,"id","coercible");e.set(r,n)}return{bundleIdFromData(t){const n=e.get(t.id);return o(n)?ye(t,"bundleId"):n},isDeletableSystemAppFromData:t=>e.has(t.id)}}return{bundleIdFromData:e=>ye(e,"bundleId"),isDeletableSystemAppFromData:e=>ie(e,"isFirstPartyHideableApp")}}();class jl extends Ls{constructor(e,t,n={}){super(),this.fields=e,this.topic=t,this.shouldFlush=n.shouldFlush}}class Wl extends Ls{constructor(e,t,n){super(),this.fields=e,this.includingFields=t||[],this.excludingFields=n||[]}}class zl extends Ls{constructor(e){super(),this.data=e||[]}addMetricsData(e){this.data.push(e)}addManyMetricsData(e){for(const t of e)this.addMetricsData(t)}clearAll(){this.data.length=0}}class Yl extends Ls{constructor(e,t){super(),this.data=e,this.invocationPoints=t}}class Kl extends Ls{constructor(){super(),this.instructions=[]}addInstruction(e){this.instructions.push(e)}addManyInstructions(e){for(const t of e)this.addInstruction(t)}addData(e,t){const n=new Yl(e,t);this.instructions.push(n)}addManyData(e,t){for(const n of e)this.addData(n,t)}}class Ql{constructor(e){this.fields=e}}class Jl extends Fs{constructor(e){super(),this.title=null,this.artwork=null,this.presentationStyle=[],this.actionClass=e,this.actionMetrics=new zl}}class Xl extends Jl{constructor(e,t){super("FlowAction"),this.page=e,this.pageUrl=t,this.pageData=null,this.presentationContext="infer",this.animationBehavior="infer",this.origin="inapp"}}class Zl extends Jl{constructor(e){super("TabChangeAction"),this.navigationTab=e,this.actions=[],this.popToRoot=!1}}class ec extends Jl{constructor(e,t=!0){super("ExternalUrlAction"),this.url=e,this.isSensitive=t}}class tc extends Jl{constructor(e){super("CompoundAction");const t=[];for(const n of e)this.actionMetrics.addManyMetricsData(n.actionMetrics.data),n.actionMetrics.clearAll(),t.push(n);this.actions=t}}class nc extends Jl{constructor(e,t,n){super("OfferAction"),this.title=e,this.adamId=t,this.purchaseConfiguration=n,n&&(this.bundleId=n.bundleId,this.lineItem=n.lineItem)}}class rc extends Jl{constructor(e,t){super("OfferConfirmationAction"),this.buyAction=e,this.confirmationInitiationAction=t}}class ic extends Jl{constructor(){super("OfferAlertAction"),this.title=null,this.message=null,this.footerMessage=null,this.isCancelable=!0,this.shouldCheckForAvailableDiskSpace=!1,this.checkRestrictionsForContentRating=null,this.shouldCheckForGameController=!1,this.shouldIncludeActiveAccountInFooterMessage=!1,this.shouldPromptForConfirmation=!1,this.completionAction=null}}class oc extends Jl{constructor(e,t,n,r,i){super("InAppPurchaseAction"),this.productIdentifier=e,this.appAdamId=t,this.appBundleId=n,this.installRequiredAction=r,this.minimumShortVersionSupportingInAppPurchaseFlow=i}}class ac extends Jl{constructor(e,t){super("OfferStateAction"),this.title=t.title,this.adamId=e,this.defaultAction=t}newOfferStateActionAddingActionToExistingActions(e){const t=new tc([this.defaultAction,e]);t.title=this.defaultAction.title;const n=new ac(this.adamId,t);return void 0!==this.buyAction&&null!==this.buyAction&&(n.buyAction=new tc([this.buyAction,e])),void 0!==this.openAction&&null!==this.openAction&&(n.openAction=new tc([this.openAction,e])),void 0!==this.subscribePageAction&&null!==this.subscribePageAction&&(n.subscribePageAction=new tc([this.subscribePageAction,e])),n}}class sc extends Jl{constructor(e,t="app"){super("OpenAppAction"),this.adamId=e,this.destination=t}}class lc extends Jl{constructor(e){super("HttpAction"),this.url=e,this.method="GET",this.headers={},this.body=null,this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}}class cc{constructor(e,t,n,r){this.key=e,this.target=t,this.inputType=n,this.title=r,this.isRequired=!0,this.maximumLength=null}}class uc extends Jl{constructor(e){super("HttpTemplateAction"),this.message=null,this.url=e,this.method="GET",this.headers={},this.body=null,this.parameters=[],this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}}class dc extends uc{}class pc extends Jl{constructor(e,t){super("WriteReviewAction"),this.adamId=e,this.url=t}}class fc extends Jl{constructor(e){super("SheetAction"),this.actions=e,this.isCancelable=!1,this.message=null,this.style="default"}}class hc extends Jl{constructor(e){super("AlertAction"),this.style=e,this.title=null,this.message=null,this.isCancelable=!1,this.buttonActions=[],this.buttonTitles=[]}}class mc extends Jl{constructor(e,t){super("ScrollingAlertAction"),this.title=e,this.message=t}}class gc extends Jl{constructor(e,t,n="expanded"){super("ShareSheetAction"),this.data=e,this.actions=t,this.shareSheetStyle=n}}class yc extends Jl{constructor(e){super("ReportConcernAction"),this.reasons=e}}class wc extends Jl{constructor(e,t){super("ProductPageScrollAction"),this.section=e,this.clicksOnScroll=t}}class Tc extends Jl{constructor(e,t,n,r){super("ArcadeAction"),this.productIdentifier=e,this.appAdamId=t,this.postSubscribeAction=r,this.subscriptionToken=n}}class Ac extends Jl{constructor(){super("FamilyCircleAction")}}class Ic extends Jl{constructor(){super("BlankAction")}}class bc extends Jl{constructor(e,t){super("SearchAdAction"),this.action=e,this.searchAd=t}}class kc extends Jl{constructor(e,t){super("SearchAdClickTrackingAction"),this.impressionId=e,this.iAd=t}}class Sc extends Fs{constructor(e,t,n,r){super(),this.details=e,this.dismissButtonTitle=t,this.offerButtonAction=n,this.offerDisplayProperties=r,this.pageMetrics=new Kl}}class Pc extends Ls{constructor(e,t,n){super(),this.headline=e,this.body=t,this.artwork=n}}class Cc extends Ls{constructor(e,t,n,r,i){super(),this.title=e,this.subtitle=t,this.items=n,this.continueAction=r,this.familyAction=i}}class vc extends Fs{constructor(e,t){super(),this.individualContent=e,this.familyMemberContent=t,this.pageMetrics=new Kl}}class Ec extends Ls{constructor(e,t,n,r){super(),this.serviceType=e,this.placement=t,this.contextInfo=n,this.metricsOverlay=r}}class Oc extends Fs{constructor(e,t,n,r,i,o,a){super(),this.details=e,this.displayProperties=n,this.offerButtonAction=r,this.buttonCallToAction=i,this.offerDisplayProperties=t,this.artwork=o,this.video=a,this.detailsDisplayProperties={wantsBlur:n.wantsBlur,position:n.detailsPosition},this.backgroundColor=n.backgroundColor}}class Rc extends Ls{constructor(e,t,n){super(),this.title=e,this.annotations=t,this.forceExpanded=n}}class _c extends Ls{constructor(e,t,n,r){super(),this.title=e,this.summary=n,this.items=t,this.shouldAlwaysPresentExpanded=!1,this.linkAction=r}}class Dc extends Ls{constructor(e,t){super(),this.text=e,this.subText=t}}class Lc extends Ls{constructor(e){super(),this.annotationGroups=e}}class Fc extends Fs{constructor(e){super(),this.art=e}}class xc extends Ls{constructor(e,t){super(),this.allowsAutoPlay=!0,this.type=e,this.lockup=t}}xc.backgroundColor=Q(z("F1F4F6"),z("303031"));class Nc extends Ls{constructor(e){super(),this.message=e}}class Uc extends Ls{constructor(e){super(),this.lockup=e}}Uc.backgroundColor=Q(z("F1F4F6"),z("303031"));class Mc extends Ls{constructor(e,t,n){super(),this.videoUrl=e,this.preview=t,this.allowsAutoPlay=n.allowsAutoPlay,this.looping=n.looping,this.canPlayFullScreen=n.canPlayFullScreen,this.showPlaybackControls=n.showPlaybackControls,this.playbackControls=Object.assign({},n.playbackControls),this.autoPlayPlaybackControls=Object.assign({},n.autoPlayPlaybackControls),this.templateMediaEvent=null}}class Bc extends Ls{}class $c extends Ls{constructor(e,t){super(),this.items=e,this.mediaPlatform=t}}class Vc extends Ls{constructor(e){super(),this.type=e}}class qc extends Ls{constructor(e,t,n){super(),this.paragraph=e,this.developerAction=n,this.developerLinks=t}}class Gc extends Ls{constructor(e){super(),this.text=e,this.presentationStyle=[],this.clickAction=null}}class Hc extends Ls{}class jc extends Fs{isValid(){return!!this.title&&!(!this.icon||!this.icon.isValid())&&super.isValid()}}class Wc extends jc{isValid(){return!(!this.screenshots||!this.screenshots.length)&&super.isValid()}}class zc extends jc{}class Yc extends jc{isValid(){return!(!this.trailers||!this.trailers.isValid())&&!(!this.editorialTagline||0===this.editorialTagline.length)&&super.isValid()}}class Kc extends Ls{constructor(e,t){super(),this.allowsAutoPlay=!0,this.looping=!0,e&&(this.videos=e),t&&(this.mediaPlatform=t)}isValid(){return this.videos&&this.videos.length>0&&super.isValid()}}class Qc extends jc{}class Jc extends Fs{}class Xc extends jc{isValid(){if(this.children)for(const e of this.children)if(!e.isValid())return!1;return super.isValid()}}class Zc extends Ls{constructor(e,t,n){super(),this.text=e,this.style=t,this.mediaType=n,this.wantsCollapsedNewlines=!0}}class eu extends Fs{constructor(){super(),this.caption=null,this.title=null,this.subtitle=null,this.artwork=null,this.shelfBackground=null,this.clickAction=null}isValid(){return!!this.clickAction&&!(!this.artwork||!this.artwork.isValid())&&!(!this.caption||!this.title)&&super.isValid()}}class tu extends Fs{constructor(){super(),this.artwork=null,this.accessibilityLabel=null,this.shortEditorialDescription=null,this.clickAction=null,this.personalizationStyle="none",this.shelfBackground=null}isValid(){return this.clickAction&&this.artwork&&this.artwork.isValid()&&super.isValid()}}class nu extends Fs{constructor(e,t,n,r=!0){super(),this.descriptionText=e,this.summaryText=t,this.clickAction=n,this.linkPresentationEnabled=r}}class ru extends Ls{constructor(e,t){super(),this.text=e,this.linkedSubstrings=t}}class iu extends Ls{constructor(e,t,n){super(),this.text=e,this.clickAction=t,this.type=n}}class ou extends iu{constructor(e,t,n){super(e,t,"reportProblem"),this.numberOfDaysToDisplayLinkPostPurchase=n,this.isHiddenByDefault=!0}}class au extends Ls{constructor(e){super(),this.buttons=e}}class su extends Ls{constructor(e,t){super(),this.title=e,this.action=t}}class lu extends Fs{constructor(e,t,n="text/plain",r=null,i=null,o=null){super(),this.artwork=e,this.isFullWidth=t,this.hasRoundedCorners="boolean"==typeof o?o:!this.isFullWidth,this.ordinal=i,this.caption=r,this.captionMediaType=n}}class cu extends Fs{constructor(e,t,n="text/plain",r=null,i=null,o=null){super(),this.canPlayFullScreen=!0,this.allowsAutoPlay=!0,this.looping=!0,this.showAudioControl=!0,this.video=e,this.isFullWidth=t,this.hasRoundedCorners="boolean"==typeof o?o:!this.isFullWidth,this.ordinal=i,this.caption=r,this.captionMediaType=n}}class uu extends Ls{constructor(e,t,n,r){super(),this.type=e,this.title=t,this.hasDivider=n,this.action=r}}class du extends Fs{constructor(e,t,n,r){super(),this.text=e,this.credit=t,this.artwork=n,this.isFullWidthArtwork=r||!1}}class pu extends Fs{constructor(e,t){super(),this.text=e,this.attribution=t}}class fu extends Ls{constructor(e,t,n){super(),this.style=e,this.color=t,this.isFullWidth=n}}class hu extends Fs{constructor(e,t){super(),this.title=e,this.buttonAction=t}}class mu extends Ls{constructor(e,t,n,r,i,o){super(),this.badgeType=n,this.badge=n.title,this.title=e,this.description=t,this.callToActionButtonAction=r,this.backgroundStyle=i,this.textAlignment=o}}class gu extends Fs{constructor(e,t,n,r,i,o){super(),this.details=e,this.detailsDisplayProperties=t,this.heading=n,this.artwork=r,this.video=i,this.backgroundColor=o}}class yu extends Fs{constructor(e,t,n){super(),this.details=e,this.iconArtwork=t,this.backgroundColor=n}}class wu extends Fs{constructor(e,t){super(),this.unsubscribedAction=e,this.subscribedAction=t}}wu.shelfBackgroundColor=Q(z("F1F4F6"),z("303031"));class Tu extends Fs{constructor(e){super(),this.contentType=e,this.items=[],this.url=null,this.mergeWhenFetched=!1,this.seeAllAction=null,this.title=null,this.subtitle=null,this.isHorizontal=!1,this.isHidden=!1,this.backgroundColor=null,this.rowsPerColumn=null,this.background={type:"none"},this.isPersonalized=!1,this.shouldFilterApps=!1}}class Au extends Fs{constructor(e,t,n,r,i){super(),this.title=e,this.artwork=t,this.heading=n,this.description=r,this.clickAction=i,this.shelfBackground=null}}class Iu{constructor(e){this._count=e,this._triggers=[]}countDown(){if(0!==this._count&&(this._count--,0===this._count)){for(const e of this._triggers)e();this._triggers.splice(0)}}then(e){0===this._count?e():this._triggers.push(e)}}const bu=[Pl.https,Pl.itmsApps,Pl.itmsAppss,Pl.itmsMessages,Pl.itmsMessagess,Pl.itmsWatch,Pl.itmsWatchs,Pl.macappstore,Pl.macappstores,Pl.tvappstoreLegacy,Pl.tvappstore,Pl.arcade];class ku{constructor(e){var t;this.identifier=e.identifier,this._protocol=null==(t=e.protocol)?null:t,this._hostName=e.hostName,e.path?(this._pathComponents=e.path.split("/").filter(e=>e.length>0),this._pathParameterMap=function(e){const t={};return e.forEach((e,n)=>{Le(e)&&(t[e]=n)}),t}(this._pathComponents)):(this._pathComponents=null,this._pathParameterMap=null),this._pathExtension=e.pathExtension,this._query=function(e){const t=[];if(!e)return t;for(const n of e){const e=n.split("=");let r=e[0];const i=-1!==r.indexOf("?");r=r.replace("?","");let o=null;e.length>1&&(o=decodeURIComponent(e[1])),t.push({key:r,value:o,optional:i})}return t}(e.query),this._hash=e.hash,e.exclusions?this._exclusions=e.exclusions.map((function(e){return new ku(e)})):this._exclusions=null}matches(e){if(this._protocol&&e.protocol!==this._protocol)return!1;if(this._hostName&&e.host!==this._hostName)return!1;if(this._pathComponents){const t=this._pathComponents,n=e.pathComponents();if(t.length!==n.length)return!1;const r=t.length;for(let e=0;e<r;e++){const r=t[e];if(!Le(r)&&r!==n[e])return!1}}if(this._pathExtension&&e.pathExtension()!==this._pathExtension)return!1;if(this._query)for(const t of this._query){const n=e.query[t.key];if(!n&&!t.optional)return!1;if(t.value&&t.value!==n)return!1}if(this._hash&&e.hash!==this._hash)return!1;if(this._exclusions)for(const t of this._exclusions){if(t._exclusions)throw Error("Matching exclusion rules with further exclusion rules may introduce significant code-complexity and/or reduce the ease with which developers are able to reason about your desired goals. Are there any simpler options?");if(t.matches(e))return!1}return!0}extractParameters(e){const t={};if(this._pathComponents){const n=e.pathComponents();for(const e of Object.keys(this._pathParameterMap)){const r=e.replace("{","").replace("}",""),i=this._pathParameterMap[e];t[r]=decodeURIComponent(n[i])}}if(this._query)for(const n of this._query)t[n.key]=e.query[n.key];return t}}class Su{constructor(){this._routeMappings=[]}associate(e,t){const n=[];for(const t of e)n.push(new ku(t));this._routeMappings.push({route:n,object:t})}routedObjectForUrl(e){let t="string"==typeof e?new xl(e):e;t=function(e){let t="string"==typeof e?new xl(e):e;if(!De(t))return t;const n=t.query,r=n.url;return(!t.host||0===t.host.length)&&null!=r&&(t=new xl(r),n.dsid&&(t=t.append("query",{dsid:n.dsid}))),xl.fromComponents(Pl.https,t.host,t.pathname,t.query,t.hash)}(t),t=function(e){const t="string"==typeof e?new xl(e):e;if(!De(t))return t;const n=t.build();let r,i=Ee(t.query);const o={"finance-app.itunes.apple.com":"account"},a=[{key:"MZSearch.woa",action:"search"},{key:"search",action:"search"},{key:"freeProductCodeWizard",action:"redeem"},{key:"redeemLandingPage",action:"redeem"},{key:"showDialogForRedeem",action:"redeem"},{key:"redeem",action:"redeem"},{key:"buyLandingPage",action:"gift"},{key:"buyCharityGiftWizard",action:"donate"},{key:"longUrlHandler",action:"checkForLongUrl"},{key:"checkForPreorders",action:"checkForPreorders"},{key:"MZFinance.woa",action:"account"}],s={"accessory-lookup":"accessoryLookup",showDialogForRedeem:"redeem","finance-app":"account",viewEula:"eula",software:"apps"};let l=!1;for(const e of Object.keys(o))if(t.host&&-1!==t.host.indexOf(e)){l=!0,r=o[e];break}let c=!1;for(const e of a){const n=e.key;if(t.pathname&&-1!==t.pathComponents().indexOf(n)){c=!0,r=e.action,void 0!==i[n]&&delete i[n];break}}for(const e of Object.keys(s)){const n=void 0!==t.query[e]&&null!==t.query[e],o=t.query.action&&-1!==t.query.action.indexOf(e);if(n||o){r=s[e],void 0!==i[e]&&delete i[e];break}}if("account"===r&&-1!==n.indexOf("getPass")&&(r="addToPassbook",delete i.getPass),r){const e=null,n=null,o={action:r};return"redeem"===r&&(i.code||i.certId)?o.code=i.code||i.certId:"account"!==r&&"checkForPreorders"!==r&&"checkForLongUrl"!==r||!c&&!l||(o.originalUrl=t.toString()),i=Object.assign(Object.assign({},i),o),xl.fromComponents(t.protocol,n,e,i,t.hash)}return t}(t);for(const e of this._routeMappings)for(const n of e.route)if(n.matches(t))return{normalizedUrl:t,parameters:n.extractParameters(t),object:e.object,matchedRuleIdentifier:n.identifier};return{normalizedUrl:t,parameters:null,object:null,matchedRuleIdentifier:null}}}class Pu extends Ls{constructor(e,t){super(),this.title=e,this.sections=t||[],this.pageMetrics=new Kl}}class Cu extends Ls{constructor(e,t){super(),this.title=e,this.footer=t,this.contents=[]}addContentItem(e){this.contents.push(e)}}class vu extends Ls{constructor(e){super(),this.type=e}}class Eu extends vu{constructor(e,t,n){super("link"),this.title=e,this.action=t,this.displayType=n||"action"}}class Ou extends vu{constructor(e,t){super("infoListItem"),this.title=e,this.value=t}}class Ru extends vu{constructor(e){super("text"),this.text=e}}const _u=[bs.mediaHost,bs.mediaEdgeHost,bs.mediaEdgeSearchHost],Du=["description","fileSizeByDevice","messagesScreenshots","minimumOSVersion","privacyPolicyUrl","promotionalText","screenshotsByType","supportsFunCamera","supportURLForLanguage","versionHistory","videoPreviewsByType","websiteUrl"],Lu=/id([0-9]+)\/?$/i,Fu={915249334:"1462947752"},xu=["latest-release-app","system-apps","arcade-apps","app-bundles","ios-apps","imessage-apps","watch-apps","atv-apps"],Nu="mac-apps",Uu="watch-apps",Mu="Apple-AUD";class Bu{constructor(e){this.builderClass=e}handleShelf(e,t,n,r,i){i(new Error(`${this.builderClass} does not implement handleShelf`))}handlePagination(e,t,n,r,i,o){o(new Error(`${this.builderClass} does not implement handlePagination`))}get shelfRoute(){return[{protocol:Pl.internal,path:`${this.shelfPath}{data}`}]}get paginationRoute(){return[{protocol:Pl.internal,path:`${this.paginationPath}`}]}shelfUrl(e){return`${Pl.internal}:${this.shelfPath}${encodeURIComponent(JSON.stringify(e))}`}get shelfPath(){return`/${this.builderClass}/${Cl.shelf}/`}get paginationUrl(){return`${Pl.internal}:${this.paginationPath}`}get paginationPath(){return`/${this.builderClass}/${Cl.lookup}/`}static createFlowAction(e,t,n){const r=new Xl(t);return r.pageUrl=n.build(),r.pageData=e,r}}class $u extends Bu{defaultAttributes(){return[]}defaultTab(e){return null}prepareRequest(e,t,n){e.includingAdditionalPlatforms(this.defaultPlatforms()),e.includingAttributes(this.defaultAttributes())}defaultAction(e,t,n){return $u.createFlowAction(e,this.pageType(),n)}handlePage(e,t,n,r,i){Is.c(`${this.builderClass}.handlePage`,()=>{let n;const o=e.build();n=xe(e)?new fh(o):this.generatePageRequest(e,t),n||i(new Error(`Could not construct media API request for: ${e}`)),this.prepareRequest(n,e,t),n.attributingTo(o);const a=this.createFetchOptions(null),s=this.generateAdditionalPageRequirements(e,t),l=Object.keys(s),c=l.map(e=>s[e]),u=[$(n,a),...c];Promise.all(u).then(n=>{const r=n[0],i=n.slice(1),o={};for(let e=0;e<i.length;e++){const t=l[e];o[t]=i[e]}return this.supportsDataAugmenting()?this.augmentData(e,t,r).then(e=>this.renderPage(e.originalData,t,o,e.additionalData)):this.renderPage(r,t,o,null)}).then(n=>{const r=this.defaultTab(n),i=this.defaultAction(n,t,e),o=t[El.isPPT];if(e.removeParam(El.isPPT),null===r||o)return i;{const e=new Zl(r);return e.actions=[i],e}}).then(r,n=>{this.handlePageError(n,r,i,e,t)})})}handlePageError(e,t,n,r,i){n(e)}handleShelf(e,t,n,r,i){Is.c(`${this.builderClass}.handleShelf`,()=>{let n;const o=e.build();n=xe(e)?new fh(o):this.generateShelfRequest(e,t),n?(this.prepareRequest(n,e,t),n.attributingTo(e.build()),$(n).then(e=>{const n=this.renderShelf(e,t);return this.shelfRequiresAdditionalModification(n,t)?this.performAdditionalShelfModifications(n,t):n}).then(r,e=>{this.handleShelfError(e,r,i,t)})):i(new Error(`Could not construct media API request for: ${e}`))})}performAdditionalShelfModifications(e,t){return Promise.resolve(e)}shelfRequiresAdditionalModification(e,t){return!1}handleShelfError(e,t,n,r){n(e)}handlePagination(e,t,n,r,i,o){Is.c(`${this.builderClass}.handlePagination`,()=>{let n;const a=e.build();n=xe(e)?new fh(a):this.generatePaginationRequest(e,t,r),n?(this.prepareRequest(n,e,t),n.attributingTo(e.build()),$(n).then(e=>this.renderPaginatedPage(e,r)).then(i,e=>{this.handlePaginationError(e,i,o,t,r)})):o(new Error(`Could not construct media API request for: ${e}`))})}handlePaginationError(e,t,n,r,i){n(e)}generateAdditionalPageRequirements(e,t){return{}}generateShelfRequest(e,t){throw new Error(`generateShelfRequest is not supported on: ${this.builderClass}`)}generatePaginationRequest(e,t,n){throw new Error(`generatePaginationRequest is not supported on: ${this.builderClass}`)}supportsDataAugmenting(){return!1}augmentData(e,t,n){const r={url:e,parameters:t};return Fe(n,this.additionalDataKeysNeededForData,this.fetchAdditionalDataForKey,r)}additionalDataKeysNeededForData(e,t){return null}fetchAdditionalDataForKey(e){return null}renderShelf(e,t){throw new Error(`renderShelf is not supported on: ${this.builderClass}`)}renderPaginatedPage(e,t){throw new Error(`renderPaginatedPage is not supported on: ${this.builderClass}`)}createFetchOptions(e){const t={};if(l(e)){const n={};n[Mu]=e,t.headers=n}return t}}const Vu="https://itunes.apple.com/WebObjects/MZStore.woa/wa/genericPageTemplate?pageComponent=finance_internet_eraser_page&additionalResources=p7financebootstrap",qu="https://finance-app.itunes.apple.com/subscriptions/manage?context=deeplink",Gu="https://finance-app.itunes.apple.com/preorders";class Hu{constructor(e){this._dispatchedFastpipeImpressionIds=new Set,this._options=Object.freeze(e)}get defaultTopic(){return this._options.defaultTopic}_filterFastpipeImpression(e){if(g(e,Hu.hasIAdData)){const t=u(e,"impressions");if(1!==t.length)return!1;const n=t[0];if("data-metrics-impressions-low-latency"!==p(n,"impressionQueueTag"))return!1;const r=p(n,"iAdImpressionId");return this._dispatchedFastpipeImpressionIds.has(r)?(this._options.isLoggingEnabled&&console.log("fastpipe impressions filtered for iAdImpressionId"+r),!0):(this._dispatchedFastpipeImpressionIds.add(r),!1)}return!1}_reduceFieldAccuracy(e,t){for(const n of t){const t=p(n,"fieldName");if(o(t))continue;const r=f(e,t);if(o(r))continue;let i=f(n,"magnitude");o(i)&&(i=1048576);let a=f(n,"significantDigits");if(o(a)&&(a=2),i<=0||a<0){e[t]=Number.NaN;continue}const s=Math.pow(10,a),l=(r>0?Math.floor:Math.ceil)(r/i/s)*s;e[t]=l}}_decorateAll(e,t){const n=this._options.bagProvider,r=n("metricsBase",t);o(r)||"object"!=typeof r||Object.assign(e,r),e.clientBuildType=this._options.buildType,e.resourceRevNum=this._options.jsVersion,e.xpSendMethod="jet-js",this._options.buyDecorator.useApp(p(e,"app"));const i=function*(e){if(o(e))return;const t=e.split(";");for(const e of t){const t=e.indexOf("=");if(-1===t){const t=decodeURIComponent(e).trim();yield{key:t,value:""}}else{const n=decodeURIComponent(e.substring(0,t)).trim(),r=decodeURIComponent(e.substring(t+1)).trim();yield{key:n,value:r}}}}(p(e,"cookie"));for(const t of i)if("xp_ci"===t.key){this._options.buyDecorator.useClientId(t.value),e.clientId=t.value;break}delete e.cookie;const a=p(e,"pageType"),s=p(e,"pageId");if(!o(a)&&!o(s)){const r=p(n("compoundSeparator",t))||"_";e.page=`${a}${r}${s}`}const l=u(n("deResFields",t));this._reduceFieldAccuracy(e,l)}_decorateImpressions(e){if(a(e.impressions))throw new Error("Empty impressions event filtered");if(!y("rotatingAdverts")&&this._filterFastpipeImpression(e))throw new Error("Fast pipeline impressions event filtered");const t=p(e,"refUrl");t&&(e.searchTerm=Aa(t)),delete e.refUrl}_decorateMedia(e){const t=f(e,"position");o(t)||(e.position=Math.round(t))}_decoratePage(e){const t=p(e,"refUrl");o(t)||(e.refApp=wa(t),e.searchTerm=Aa(t));const n=p(e,"page");o(n)||(e.pageHistory=this._options.buyDecorator.getPageHistoryFor(n))}_decorateSearch(e){e.eventVersion=3}makeEvent(e){const t=p(e,"eventType");this._options.isLoggingEnabled&&console.log(`Building event for topic: ${t}`);const n=p(e,"topic")||this._options.defaultTopic;this._decorateAll(e,n);const r=e.extRefUrl;r&&""===r&&delete e.extRefUrl;const i={shouldFlush:!1};switch(t){case"click":i.shouldFlush=d(e,Hu.hasIAdData);break;case"exit":i.shouldFlush=!0;break;case"impressions":this._decorateImpressions(e),i.shouldFlush=d(e,Hu.hasIAdData);break;case"media":this._decorateMedia(e);break;case"page":this._decoratePage(e);break;case"search":this._decorateSearch(e)}return host.clientIdentifier!==il||y("subscribePageExtensionEnterExitEvents")||(i.shouldFlush=!0),new jl(e,n,i)}}Hu.hasIAdData="hasiAdData";const ju="X-AppStore-iAdClickToken",Wu="X-AppStore-iAdLineItem";class zu{constructor(e,t){this.pageFields={},this.clickFields={},this.impressionsFields={},this.fastImpressionFields={},this.iAdClickEventFields={},this._iAdApplied=!1,this._iAdId=e,this._iAdAdamId=null,this.pageFields[Hu.hasIAdData]=!0,this.pageFields.iAdAppStoreClientRequestId=t,this.pageFields.iAdId=ya(e)}get iAdIsPresent(){return this._iAdApplied}get iAdAdamId(){return this._iAdAdamId}apply(e,t){if(this._iAdAdamId=e,t){this.impressionsFields[Hu.hasIAdData]=!0,this.impressionsFields.iAdId=ya(this._iAdId),this.fastImpressionFields.iAdImpressionId=ya(t.impressionId),this.fastImpressionFields.iAdMetadata=ya(t.metadata);const n={iAdFormat:Ta(m(t,"format")),iAdAlgoId:ya(t.algoId),iAdImpressionId:ya(t.impressionId),iAdMetadata:ya(t.metadata)};this.pageFields.iAd=n,this.pageFields.adamId=e,this.clickFields[Hu.hasIAdData]=!0,this.clickFields.iAdId=ya(this._iAdId),this.clickFields.iAdImpressionId=ya(t.impressionId),this.clickFields.iAdMetadata=ya(t.metadata),Object.assign(this.iAdClickEventFields,t),this._iAdApplied=!0}}applyClickFieldsFromPageRequest(e,t){this._iAdApplied=!0,this._iAdAdamId=e,Object.assign(this.clickFields,t)}setSpecifiedCreativeUsed(e){this.fastImpressionFields.iAdIsSpecifiedCreativeUsed=e,this.clickFields.iAdIsSpecifiedCreativeUsed=e}}class Yu{constructor(e={}){this.baseFields=e}}class Ku extends Ls{constructor(){super(),this.pageMetrics=new Kl}}class Qu extends Ls{constructor(e,t){super(),this.type=e,this.values=t}}class Ju extends Ls{constructor(e,t,n=null){super(),this.name=e,this.value=t,this.isSelected=t===n}}class Xu extends Ls{constructor(e,t){super(),this.type=e,this.resultModel=t}}class Zu extends Ls{constructor(e,t,n){super(),this.iAd=e,this.impressionId=t,this.transparencyAction=n}}class ed extends Jl{constructor(e){super("AdTransparencyAction"),this.adTransparencyData=e}}class td extends Fs{}class nd extends Jl{constructor(e,t,n,r){super("SearchAction"),this.title=e,this.term=e,this.url=t,this.origin=n,this.entity=r,this.presentationStyle=["textFollowsTintColor"]}}class rd extends Ls{constructor(e){super(),this.hints=e,this.pageMetrics=new Kl}}class id extends Ls{constructor(e,t){super(),this.title=e,this.searches=t}}class od extends Ls{constructor(e,t,n,r,i,o,a,s,l="infer"){super(),this.type=e,this.content=t,this.heading=r,this.caption=i,this.longCaption=o,this.leadingValue=l,this.accessibilityTitle=a,this.accessibilityCaption=s,this.style=n}}class ad extends Ls{constructor(e,t,n,r){super(),this.titleStyle=e,this.title=t,this.subtitle=n,this.body=r}}class sd extends Ls{constructor(e,t){super(),this.type=e,this.shelfId=t}}class ld extends Ls{constructor(e,t){super(),this.title=e,this.subtitle=t}}class cd extends jc{constructor(){super(),this.pageMetrics=new Kl}}class ud extends Ls{constructor(e){super(),this.shelves=e,this.title=null,this.presentationOptions=[],this.isIncomplete=!1,this.pageMetrics=new Kl}}class dd extends Ls{constructor(){super(),this.pageMetrics=new Kl}}class pd extends ud{}class fd extends ud{}class hd extends ud{constructor(e,t,n){super(e),this.sort=t,this.displayStyles=n}}const md=":";class gd extends $u{constructor(){super("ArcadeUpsellViewerBuilder")}defaultPlatforms(){return Za()}defaultAttributes(){return["editorialArtwork","isAppleWatchSupported","requiredCapabilities"]}pageType(){return"page"}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.arcadeUpsellPreview}`,query:[El.ids]}]}generatePageRequest(e,t){const n=p(e.query[El.ids]);if(!l(n))return null;const r=this.createUpsellToInAppPairs(n),i=[];for(const e of r)i.push(e.upsellId);return(new fh).forType("editorial-items").withIds(i)}generateAdditionalPageRequirements(e,t){const n=super.generateAdditionalPageRequirements(e,t),r=p(e.query[El.ids]);if(!l(r))return null;const i=this.createUpsellToInAppPairs(r),o=[];for(const e of i)s(e.inAppId)&&o.push(e.inAppId);if(a(o))return n;const c=(new fh).forType("in-apps").withIds(o);return n[gd.inAppDataKey]=$(c,this.createFetchOptions(null)),n}renderPage(e,t,n,r){return Is.c("renderPage",()=>{const r=He(e);if(a(r))return null;const i=p(t[El.ids]),o=this.createUpsellToInAppPairs(i),c={};for(const e of r)c[e.id]=e;const u={};if(s(n)&&l(n[gd.inAppDataKey])){const e=He(n[gd.inAppDataKey]);for(const t of e)u[t.id]=t}const d=[],f={shelves:[],metricsPageInformation:Ke("Genre","upsellPreview",e),metricsLocationTracker:{rootPosition:0,locationStack:[]},groupingData:null,pageGenreAdamId:null,pageGenreId:null,hasAuthenticatedUser:s(ql.dsid),additionalShelfParameters:null,isArcadePage:!0};for(const e of o){const t=Fi(c[e.upsellId],u[e.inAppId],f);if(s(t)){const e=new Tu("upsellBreakout");e.isHorizontal=!0,e.items=[t],d.push(e)}}return new ud(d)})}createUpsellToInAppPairs(e){const t=[],n=e.split(",");for(const e of n){const n=e.split(md);t.push({upsellId:n[0],inAppId:n[1]})}return t}}gd.inAppDataKey="inAppData";const yd={prominentPlay:!0,fullScreenToggle:!0,inlinePlayPause:!0,muteUnmute:!0},wd={prominentPlay:!0,fullScreenToggle:!1,inlinePlayPause:"mac"===ol,muteUnmute:!0},Td={playbackControls:yd,autoPlayPlaybackControls:wd},Ad={prominentPlay:!1,fullScreenToggle:!1,inlinePlayPause:!1,muteUnmute:!1},Id=20,bd="mediumLockup";class kd{constructor(){this.profile="lockup",this.maxPerPage=Id}}class Sd extends $u{defaultAttributes(){return["editorialArtwork","editorialVideo","isAppleWatchSupported","requiredCapabilities"]}defaultPlatforms(){return Za()}pageType(){return"page"}generatePaginationRequest(e,t,n){return new fh(n.remainingContent)}renderPaginatedPage(e,t){const n=t;return this.pageWithContent(e,n)}handlePaginationError(e,t,n,r,i){t(this.renderPaginatedPage({data:[]},i))}pageWithContent(e,t){return Is.c("pageWithContent",()=>{const n=t.preferredShelfContentType||bd,r=new Tu(n),i={id:null,kind:null,softwareType:null,targetType:"swoosh",title:t.title,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"its_contentId",recoMetricsData:ze(e)};Oo(r,i),Pa(i,t.title),r.isHorizontal=!1,r.shouldFilterApps=t.shouldFilter;const o=He(e);t.remainingContent=[],r.items=ro(o,{contentUnavailable:(e,n)=>(t.remainingContent=ut(o,n),!0),lockupOptions:{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,artworkUseCase:Do(n)}});const a=new ud([r]);return t.remainingContent.length&&(a.nextPage=t),a})}}class Pd extends Sd{constructor(){super("RoomBuilder")}generatePageRequest(e,t){let n=e.query[El.featuredContentId];if(this.isValidRoomId(n)||(n=t.id),!this.isValidRoomId(n))throw new Error(`Unable to map ${e.build()} to a media api url`);return(new fh).forType("rooms").withIds([n])}renderPage(e,t,n){return Is.c("renderPage",()=>{const t=Ge(e),n=H(t,"contents"),r=Ke("Room",t.id,e),i=new kd;i.remainingContent=n.data,i.url=this.paginationUrl,i.shouldFilter=!ie(t,"doNotFilter"),i.metricsPageInformation=r,i.metricsLocationTracker={rootPosition:0,locationStack:[]};const o=ne(t,"editorialElementKind");i.preferredShelfContentType=this.preferredShelfStyleForFcKind(Number(o)),i.clientIdentifierOverride=ot(t),i.title=ne(t,"title");const a=this.pageWithContent(n,i);return a.title=i.title,Pd.platformPrefersLargeTitles()&&(a.presentationOptions=["prefersLargeTitle"]),Je(a,r),a})}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.store}/${Cl.room}`,query:[El.featuredContentId]},{protocol:Pl.https,path:`/${Cl.storeElements}/${Cl.recommendationsSeeAll}`},{protocol:Pl.https,path:"{apiVersion}/editorial/{countryCode}/rooms/{id}"},{protocol:Pl.https,path:"/{countryCode}/collection/today-view-widgets",query:[El.featuredContentId]}]}isValidRoomId(e){return c(e)}preferredShelfStyleForFcKind(e){if(null==e)return null;switch(e){case 431:return"inAppPurchaseTiledLockup";default:return null}}static seeAllPage(e,t){const n=new Tu(t||bd);n.isHorizontal=!1,n.items="parentShelfItems";const r=new ud([n]);return r.isIncomplete=!0,r.title=e,Pd.platformPrefersLargeTitles()&&(r.presentationOptions=["prefersLargeTitle"]),r}static platformPrefersLargeTitles(){return"watch"===ol||"mac"===ol}}class Cd extends Sd{requestWithFilter(e,t){return(new fh).forType("apps").withFilter(e,t)}renderPage(e,t,n){return Is.c("renderPage",()=>{const t=new kd;return t.url=this.paginationUrl,t.shouldFilter=!1,t.metricsLocationTracker={rootPosition:0,locationStack:[]},this.pageWithContent(e,t)})}}class vd extends Sd{handlePage(e,t,n,r,i){r(this.action())}generatePageRequest(e,t){throw new Error(`generatePageRequest is not supported on: ${this.builderClass}`)}renderPage(e,t,n){throw new Error(`renderPage is not supported on: ${this.builderClass}`)}}const Ed="externalDeepLinkUrl";class Od extends Fs{constructor(e){super(),this.kind=e}}class Rd extends Od{constructor(){super("hero"),this.allowsAutoPlay=!0,this.looping=!0}isValid(){const e=this.art&&this.art.isValid(),t=this.video&&this.video.isValid();return(e||t)&&super.isValid()}}class _d extends Od{constructor(e,t){super("artwork"),this.art=e,this.titleBackingGradient=t}}class Dd extends Od{constructor(e){super("appIcon"),this.icon=e}}class Ld extends Od{constructor(e,t,n){super("brandedSingleApp"),this.icon=e,this.art=t,this.titleBackingGradient=n}}Ld.noArtBackgroundColor=z("BBBBBB");class Fd extends Od{constructor(e,t){super("list"),this.lockups=e,this.marketingText=t}}class xd extends Od{constructor(e,t){super("multiApp"),this.lockups=e,this.additionalText=t}}class Nd extends Od{constructor(e){super("inAppPurchase"),this.lockup=e}}class Ud extends Od{constructor(e){super("river"),this.lockups=e,this.lockupImpressionLimit=10}}class Md extends Od{constructor(e,t){super("grid"),this.lockups=e,this.artworkGridType=t,this.lockupImpressionLimit=3}}class Bd extends Od{constructor(e,t){super("video"),this.allowsAutoPlay=!0,this.looping=!0,this.video=e,this.description=t}}class $d extends Ls{constructor(e){super(),this.kind=e}}class Vd extends $d{constructor(e){super("lockup"),this.lockup=e,this.displaysIcon=!0}}class qd extends $d{constructor(e,t,n,r){super("marketingLockup"),this.marketingText=null,this.lockup=e,this.paragraph=t,this.hideBackground=n,this.artworkBackgroundColor=r}}class Gd extends $d{constructor(e){super("lockupList"),this.lockups=e}}class Hd extends $d{constructor(e,t){super("paragraph"),this.paragraph=e,this.style=t}}class jd extends $d{constructor(e){super("action"),this.action=e}}class Wd extends $d{constructor(e,t,n){super("threeLine"),this.heading=e,this.title=t,this.description=n}}class zd extends $d{constructor(e){super("arcadeLockup"),this.arcadeLockup=e}}class Yd extends Fs{constructor(){super(),this.heading=null,this.title=null,this.media=null,this.heroMedia=null,this.overlay=null,this.style=null,this.clickAction=null,this.backgroundColor=null,this.inlineDescription=null,this.collapsedHeading=null}}class Kd extends Fs{constructor(e){super(),this.cards=e}}class Qd extends Ls{constructor(e,t,n,r){super(),this.shelves=e,this.title=n,this.tabTitle=r,this.nextPage=null,this.onboardingCardIds=t||[],this.pageMetrics=new Kl}}class Jd{constructor(e,t){this.period=e,this.type=t}isEqualTo(e){return e.period===this.period&&e.type===this.type}}const Xd=7,Zd={D:"DAYS",W:"WEEKS",M:"MONTHS",Y:"YEARS"},ep={FreeTrial:"FREE_TRIAL",PayUpFront:"PAID_UPFRONT",PayAsYouGo:"PAID_TRIAL"},tp="NULL",np="isOnBoardingCard";class rp{constructor(e){this.label=e.label,this.title=e.title,this.meta=e.meta,this.date=p(e,"date"),this.remainingContents=u(e,"contents"),this.numberOfItemsProcessed=0,this.isFullyHydrated=function(e){for(let t=e.length-1;t>=0;t--)if(!je(e[t]))return!1;return!0}(this.remainingContents)}}const ip="FEATURED APP",op="FEATURED GAME",ap=["editorialArtwork","editorialVideo","minimumOSVersion"];class sp{constructor(){this.locationTracker={rootPosition:0,locationStack:[]}}}class lp{constructor(e,t,n,r){this.todayModule=e,this.metricsPageInformation=n,this.contentOffsetWithinModule=t,this.metricsLocationTracker=r}}const cp=new Set(["brandedSingleApp","artwork","appIcon","grid","multiApp","video"]),up=new Set(["brandedSingleApp","artwork","appIcon","grid","multiApp","video"]),dp=new Set(["brandedSingleApp","artwork","appIcon","grid","multiApp","video"]),pp=new Set(["brandedSingleApp","artwork","grid","video"]);class fp extends $u{constructor(){super("ArcadePageBuilder")}static get comingSoonGroupingID(){return"mac"===ol?"177564":"175443"}defaultPlatforms(){return Za()}defaultAttributes(){return["editorialArtwork","isAppleWatchSupported","requiredCapabilities"]}pageType(){return"arcade"}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.store}/${Cl.grouping}`,query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`,El.id]},{hostName:vl.storePreview,path:`/WebObjects/{storePreviewInstance}/wa/${Cl.grouping}`,query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`,El.id,`${El.useReleaseId}?`]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}",query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`]},{protocol:Pl.https,path:"{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}",query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`]},{protocol:Pl.https,path:"{apiVersion}/editorial/{countryCode}/groupings/{id}",query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`]}]}get shelfRoute(){return[{protocol:Pl.internal,path:`/${Cl.grouping}/${Cl.shelf}/{token}`,query:[El.isArcade,`${El.isTrialAvailable}?`,`${El.isSubscribed}?`]},{protocol:Pl.internal,path:`/${Cl.arcade}/${Cl.shelf}/{token}`,query:[El.isArcadeSeeAllGamesShelf]}]}generatePageRequest(e,t){let n=null;n=bs.isArcadeComingSoonEnabled?fp.comingSoonGroupingID:t[El.id];const r=g(t[El.isSubscribed]);if(!c(n))throw new Error(`Unable to map ${e.build()} to a media api url`);let i=(new fh).forType("groupings").includingAttributes(["editorialArtwork","editorialVideo","isAppleWatchSupported","requiredCapabilities"]);const o=ts();s(o)&&i.addingQuery("contexts",o);const a="mac"===ol;bs.isArcadeComingSoonEnabled?a||i.addingQuery("tabs","subscriber"):r?i.addingQuery("tabs","subscriber"):(i.addingQuery("tabs","nonsubscriber"),i.includingRelationshipsForUpsell(!1)),i.withIds([n]);const u=e.query[El.useReleaseId];return e.host===vl.storePreview&&l(u)&&(i=i.addingQuery("release",u),i.isStorePreviewRequest=!0),i.attributingTo(e.build())}generateAdditionalPageRequirements(e,t){const n=super.generateAdditionalPageRequirements(e,t);if(bs.isArcadeComingSoonEnabled){const e=(new fh).forType("editorial-items").withIds([dh]);return n[fp.comingSoonEIRequirementKey]=$(e,this.createFetchOptions(null)).catch(()=>null),n}if(fp.footerShowsIconsForPlatform(host.platform)&&!bs.isArcadeComingSoonEnabled&&!y("inlineArcadeFooter")){const e=Wa(this.numberOfIconsForArcadeAppGrid(ol));n[fp.footerIconsRequirementsKey]=$(e,this.createFetchOptions(null)).catch(()=>null)}return g(t[El.isSubscribed])&&(n[fp.recentlyPlayedGamesRequirementKey]=Ka(null,!1,ph)),n}isArcadeLockupInNavBarSupportedFromUpsellData(e){return"mac"===ol||!!y("arcadeLockupInNavBar")&&("editorial-items"!==e.type||("phone"===ol||"pad"===ol)&&gt(ca(e,"short")))}renderPage(e,t,n,r){return Is.c("renderPage",()=>{const i=Ge(e);if(a(i))return null;const o=H(i,"tabs"),c=ne(i,"id");if(a(o))return null;const u=g(t[El.isSubscribed]),d=g(t[El.isTrialAvailable]),p="tv"===ol,f="mac"===ol,h={};h[El.isArcade]="true",h[El.isSubscribed]=`${u}`,h[El.isTrialAvailable]=`${d}`;const m=n[fp.recentlyPlayedGamesRequirementKey],w={shelves:[],metricsPageInformation:Ke("Genre",i.id,e),metricsLocationTracker:{rootPosition:0,locationStack:[]},groupingData:o,pageGenreAdamId:c,pageGenreId:null,hasAuthenticatedUser:s(ql.dsid),additionalShelfParameters:h,isArcadePage:!0,recentlyPlayedGamesData:m};let T=null,A=null,I=null;if(bs.isArcadeComingSoonEnabled)T=Ge(n[fp.comingSoonEIRequirementKey]),I=Fi(T,null,w);else if(!u){const e=Qa(i);if(e)T=e.marketingItemData||e.editorialData,A=e.inAppData;else if(r){Is.d("defaultValue","nonnull","relationships.upsell");const e=Ja(r.get("upsellRecovery"));e&&(T=e.marketingItemData||e.editorialData,A=e.inAppData)}I=Fi(T,A,w)}const b=fp.insertShelfForUpsellBreakoutIfNecessary(I,w);tn(i,w);const k=new fd(w.shelves);Je(k,w.metricsPageInformation),k.tabTitle=ne(i,"name");const S=host.clientIdentifier===tl;(u&&!p||S||!b)&&(k.title=ne(i,"name"));const P=new Qs("color");P.color=K("primaryText"),P.isFallbackStyle=!0,k.titleEffect=w.pageTitleEffect||P,k.presentationOptions=f?["prefersLargeTitleWhenRoot"]:[];let C=!1;if(w.shelves.length>0){const e="largeHeroBreakout"===w.shelves[0].contentType,t="upsellBreakout"===w.shelves[0].contentType;C=e||t}if(C&&k.presentationOptions.push("prefersOverlayedPageHeader"),!u&&l(I))if(k.subscriptionOfferAction=fp.createSubscribeAction(I,{id:null,pageInformation:w.metricsPageInformation,locationTracker:w.metricsLocationTracker,targetType:"button"}),this.isArcadeLockupInNavBarSupportedFromUpsellData(T)){k.subscriptionOfferDisplayProperties=new Ns("arcade",bs.arcadeAppAdamId,"colored",null,"arcade",null,null,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId),k.subscriptionOfferTitle=I.details.title,k.subscriptionOfferSubtitle=I.buttonCallToAction||I.details.description;const e={pageInformation:w.metricsPageInformation,locationTracker:w.metricsLocationTracker},t="marketing-items"===T.type,n={inAppData:A,editorialData:t?null:T,marketingItemData:t?T:null};k.subscriptionLockup=to(n,e,"arcadeTabHeader","colored","mac"===ol?"arcade":"navigationBar")}else k.subscriptionOfferAction.title=function(e){return e?kl?e.toLocaleUpperCase(kl):e:null}(I.offerButtonAction.title),k.subscriptionOfferDisplayProperties=new Ns("arcade",bs.arcadeAppAdamId,"colored",null,"navigationBar",null,null,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId);if(!bs.isArcadeComingSoonEnabled){const e={featuredContentId:null,featuredContentData:null,metricsPageInformation:w.metricsPageInformation,metricsLocationTracker:w.metricsLocationTracker,pageGenreId:w.pageGenreId,id:"arcade-see-all-games-footer",title:null,shouldFilter:!1,remainingItems:[],isFirstRender:!0,isDeferring:!1,showOrdinals:!1,hasExistingContent:!1,ordinalIndex:1,isSearchGrouping:w.isSearchGrouping,isArcadePage:w.isArcadePage};if(y("inlineArcadeFooter")){if(k.shelves.push(this.createFooterShelf(null,!0,e)),"mac"===ol||"tv"===ol){const e=this.createTermsAndConditionsShelf();s(e)&&k.shelves.push(e)}}else this.addFooterToPage(k,n[fp.footerIconsRequirementsKey],e)}return k.autoUpsellAction=Va("arcadeGeneric",null),k})}static insertShelfForUpsellBreakoutIfNecessary(e,t){return Is.c("insertShelfForUpsellBreakoutIfNecessary",()=>{if(a(e))return Is.d("ignoredValue","nonnull","upsellBreakout"),!1;const n=new Tu("upsellBreakout");return n.isHorizontal=!0,n.items=[e],n.presentationHints={isFirstShelf:!0},t.shelves.push(n),!0})}static createSubscribeAction(e,t){if(a(e))return null;if(bs.isArcadeComingSoonEnabled)return e.offerButtonAction;if("mac"===ol)return e.offerButtonAction;{const n=Va("arcadeTabNavBar",null,t);return n.title=e.offerButtonAction.title,n}}static footerShowsIconsForPlatform(e){switch(e){case"iOS":case"macOS":return!0;default:return!1}}createFooterShelf(e,t,n){const r=new Ks,i=new Tu("arcadeFooter");i.items=[r];const a={targetType:"arcadeSeeAllGamesFooter",pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker,title:P("SEE_ALL_GAMES"),id:n.id,kind:"footer",softwareType:null};Oo(r,a),Pa(a,a.title),r.buttonAction=$a("releaseDate",n.metricsPageInformation,n.metricsLocationTracker);const l={targetType:"button",pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker,title:r.buttonAction.title,id:"arcade-see-all-games-button",kind:"button",softwareType:null};Oo(r.buttonAction,l),Ca(a.locationTracker);const c="phone"===ol||"pad"===ol,u=bs.termsAndConditionsURL,d=!o(u)&&"tv"!==ol;if(c){if(d){const e=P("TERMS_AND_CONDITIONS_TITLE"),t=new ec(u),n=new Gc(e);n.clickAction=t,n.presentationStyle=["hasChevron","textLightensOnHighlight","hasSeparator"],r.footnote=n}i.background={type:"color",color:K("placeholderBackground")}}if(s(e)){const t={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},i=We(e);if(y("seeAllGamesFooterArtworkImpressions"))r.icons=xo(i,t,{useCase:2});else{const e=[];for(const t of i)e.push(No(t,{useCase:2}));r.icons=e}}else r.icons=[];return t&&(i.url=`${Pl.internal}:/${Cl.arcade}/${Cl.shelf}/${encodeURIComponent(JSON.stringify(n))}?${El.isArcadeSeeAllGamesShelf}=true`),i}createTermsAndConditionsShelf(){const e=bs.termsAndConditionsURL,t=!o(e)&&"tv"!==ol;return"mac"!==ol&&"tv"!==ol||!t?null:gn(e,!1)}addFooterToPage(e,t,n){const r=[],i=fp.footerShowsIconsForPlatform(host.platform);if(r.push(this.createFooterShelf(i?t:null,!1,n)),"mac"===ol||"tv"===ol){const e=this.createTermsAndConditionsShelf();s(e)&&r.push(e)}return r}generateShelfRequest(e,t){return t[El.isArcadeSeeAllGamesShelf]?this.generateSeeAllGamesShelfRequest():this.generateStandardShelfRequest(e,t)}generateSeeAllGamesShelfRequest(){return Wa(this.numberOfIconsForArcadeAppGrid(ol))}generateStandardShelfRequest(e,t){const n=t.token,r=JSON.parse(n),i=l(r.remainingItems),o=l(r.recommendationsHref);let a=[],s=["editorialArtwork","editorialVideo","minimumOSVersion","screenshotsByType","videoPreviewsByType"];if(y("refreshRibbon")||"pad"!==ol||(a=a.concat(["developer"]),s=s.concat(["minPlayers","maxPlayers","fileSizeByDevice"])),i){let e=r.remainingItems;l(r.relationshipDataToFetch)&&(e=r.remainingItems.map(e=>j(e,r.relationshipDataToFetch)));let t=["editorialArtwork","editorialVideo","minimumOSVersion"],n=[];const i=new fh(e);return"apps"===i.resourceType&&(t=s,n=a),i.includingAdditionalPlatforms(Za()).includingAttributes(t).includingRelationships(n)}if(o){let e=["editorialArtwork","editorialVideo","minimumOSVersion"],t=[];const n=new fh(r.recommendationsHref);return"apps"===n.resourceType&&(e=s,t=a),n.includingAdditionalPlatforms(Za()).includingAttributes(e).includingRelationships(t)}return null}renderShelf(e,t){if(t[El.isArcadeSeeAllGamesShelf]){const n=t.token,r=JSON.parse(n);return this.renderSeeAllGamesShelf(e,r)}return this.renderStandardShelf(e,t)}handleShelfError(e,t,n,r){const i=r.token,o=JSON.parse(i);if(o&&!o.hasExistingContent){const e=new Tu(o.shelfStyle);e.isHidden=!0,t(e)}else super.handleShelfError(e,t,n,r)}renderSeeAllGamesShelf(e,t){return this.createFooterShelf(e,!1,t)}renderStandardShelf(e,t){const n=t.token,r=JSON.parse(n),i=l(r.remainingItems),o=l(r.recommendationsHref);if(i){let t=e;if(l(r.relationshipDataToFetch)){const n={};for(const t of e.data)n[t.id]=t;t={data:[]};for(const e of r.remainingItems){const i=j(e,r.relationshipDataToFetch);l(i)&&(e.relationships[r.relationshipDataToFetch].data=[n[i.id]]),t.data.push(e)}}return hn(t,r)}if(o){const t=Ge(e);return a(r.title)&&(r.title=ne(t,"name")),hn(H(t,"contents"),r)}return null}numberOfIconsForArcadeAppGrid(e){switch(e){case"phone":return 9;default:return 20}}supportsDataAugmenting(){return!0}additionalDataKeysNeededForData(e,t){if(o(t))return null;const n=Ge(e),r=g(t.parameters[El.isSubscribed]),i=Qa(n);return!r&&o(i)?new Set(["upsellRecovery"]):null}fetchAdditionalDataForKey(e){return Is.c("fetchAdditionalDataForKey",()=>{let t;if("upsellRecovery"===e){const e=Ba();e&&bs.shouldUseEditorialItemUpsellFallback?(t=Ya("arcadeTabHeader"),Is.d("ignoredValue","marketing-items","upsellRecovery.marketingItem.editorialItemFallback")):(t=za("arcadeTabHeader"),e?Is.d("ignoredValue","marketing-items","upsellRecovery.marketingItem"):Is.d("ignoredValue","editorial-items","upsellRecovery.editorialItem"))}return o(t)?null:$(t).catch(()=>null)})}}fp.footerIconsRequirementsKey="footerIconsRequirements",fp.comingSoonEIRequirementKey="comingSoonEIRequirementKey",fp.recentlyPlayedGamesRequirementKey="recentlyPlayedRequirementKey";class hp extends $u{constructor(){super("ArcadeSeeAllGamesPageBuilder"),this.pageSize=20,this.fakeVideoURL="x-as3-internal:/today/test"}defaultPlatforms(){return Za()}defaultAttributes(){return["editorialArtwork","editorialVideo","isAppleWatchSupported","requiredCapabilities","videoPreviewsByType","screenshotsByType"]}defaultTab(e){return"arcade"}pageType(){return"arcade"}get pageRoute(){return[{identifier:"arcadeSeeAllGames",path:`/${Cl.arcadeSeeAllGames}`,query:[`${El.sort}?`]},{identifier:"arcadeSeeAllGames",hostName:`${vl.arcadeSeeAllPage}`,query:[`${El.sort}?`]}]}get paginationRoute(){return[{identifier:"arcadeSeeAllGames",protocol:Pl.internal,path:`/${Cl.arcadeSeeAllGames}/${Cl.arcadeSeeAllGamesLoadMore}`}]}generatePageRequest(e,t){let n=[];return y("refreshRibbon")||"pad"!==ol||(n=n.concat(["developer"])),ja(!0).includingAdditionalPlatforms(Za()).includingRelationships(n).attributingTo(e.build())}renderPage(e,t,n){return Is.c("renderPage",()=>{const n=t[El.sort]||"releaseDate",r=Ke("Room","arcadeSeeAllGames",e),i=this.createSeeAllGamesToken([],null,r,{rootPosition:0,locationStack:[]},n),o=We(e).sort(hp.seeAllGamesSort);if(a(o))return null;const s="phone"===ol||"pad"===ol,c={};c.large=s?"appTrailerLockup":"mixedMediaLockup",c.compact="smallLockup";const u=new hd(this.createShelvesForGames(o,i,(function(e){i.remainingContent.push(e)})),n,c);return l(i.remainingContent)&&(u.nextPage=i),u.title=P("ALL_GAMES"),Je(u,r),u})}createSeeAllGamesToken(e,t=null,n,r,i){const o=dt([],xl.fromComponents(Pl.internal,null,`/${Cl.arcadeSeeAllGames}/${Cl.arcadeSeeAllGamesLoadMore}`).build(),null,n,r);return o.sort=i,o.maxPerPage=this.pageSize,o}createShelvesForGames(e,t,n){const r=[];let i=null,a=null,s=!1;for(const c of e){if(this.shouldDefer(c,s)){o(n)||n(c),s=!0;continue}const e={metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:ze(c)},artworkUseCase:1,canDisplayArcadeOfferButton:ha("mixedMediaLockup")},u=re(c,"isPreorder");if(sa(c)&&u)continue;const d=Zi(c,e,Td);let p=!0;if(!l(d.trailers)){p=!1;let e=null;switch(ol){case"mac":case"tv":case"phone":e=["splashVideo16x9","splashVideo4x3","splashVideo3x4"];break;default:e=["splashVideo4x3","splashVideo16x9","splashVideo3x4"]}const t=ea(c,20,e);if(l(t)){const e=new Kc;t.playbackControls=yd,t.autoPlayPlaybackControls=wd,t.canPlayFullScreen=!0,e.videos=[t],d.trailers=[e],p=!0}}d.editorialTagline=null,d.developerTagline=null,p||this.addFakeVideoToMixedMediaLockup(d);const f=this.shelfTitleForSortFromData(c,t.sort),h=o(i)||a!==f;if(o(i)||h){0!==t.metricsLocationTracker.locationStack.length&&(Ca(t.metricsLocationTracker),Ea(t.metricsLocationTracker)),i=new Tu("phone"===ol||"pad"===ol?"appTrailerLockup":"mixedMediaLockup"),i.title=f,a=f,i.presentationHints={showSupplementaryText:!1};const e={id:`${r.length}`,kind:null,softwareType:null,targetType:"swoosh",title:f,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"sequential"};Oo(i,e),Pa(e,f),r.push(i)}i.items.push(d),Ea(e.metricsOptions.locationTracker)}return r}shelfTitleForSortFromData(e,t){switch(t){case"releaseDate":const t=Ce(ue(e,Ae(e),"releaseDate"));if(y("allGamesDaySentenceFormatting"))return L(P("ALL_GAMES_SECTION_TITLE_RELEASE_DATE_SENTENCE"),P("ALL_GAMES_SECTION_TITLE_RELEASE_DATE_DAY_FORMAT"),t);if(y("allGamesSentenceFormatting"))return L(P("ALL_GAMES_SECTION_TITLE_RELEASE_DATE_SENTENCE"),"MMMM d, y",t);{const e=D("MMMM d, y",t);return P("ALL_GAMES_SECTION_TITLE_RELEASE_DATE").replace("{releaseDate}",e)}case"name":return ne(e,"name");default:return null}}shouldDefer(e,t){return!ae(e)||t}generatePaginationRequest(e,t,n){return new fh(st(n))}renderPaginatedPage(e,t){const n=lt(t),r=new hd(this.createShelvesForGames(He(e),n),n.sort);return l(n.remainingContent)&&(r.nextPage=n),r}addFakeVideoToMixedMediaLockup(e){const t=e.screenshots[0].artwork[0],n=new Mc(this.fakeVideoURL,t,{allowsAutoPlay:!1,looping:!1,canPlayFullScreen:!1,showPlaybackControls:!1,autoPlayPlaybackControls:{},playbackControls:{}}),r=new Kc;r.videos=[n],e.trailers=[r]}static seeAllGamesSort(e,t){const n=ue(e,Ae(e),"releaseDate"),r=ue(t,Ae(t),"releaseDate"),i=ne(e,"name"),a=ne(t,"name");return n===r?i===a?0:s(i)&&s(a)?i.toLowerCase()<a.toLowerCase()?-1:1:o(i)?1:-1:Ce(n)>Ce(r)?-1:1}}class mp extends $u{constructor(){super("ArcadeSubscribeBuilder")}defaultPlatforms(){return Za()}defaultTab(e){return"arcade"}defaultAttributes(){return["editorialArtwork","isAppleWatchSupported","requiredCapabilities"]}pageType(){return"arcadeSubscribe"}get pageRoute(){return[{hostName:`${vl.arcadeSubscribePage}`,query:[`${El.appId}?`,`${El.context}?`,`${El.subscribePageMessage}?`,`${El.askToBuyId}?`,`${El.editorialItem}?`,`${El.includePostSubscribeAttribution}?`]},{path:"arcade/subscribe",query:[`${El.appId}?`,`${El.context}?`,`${El.subscribePageMessage}?`,`${El.askToBuyId}?`,`${El.editorialItem}?`,`${El.includePostSubscribeAttribution}?`]},{path:"{countryCode}/arcade/subscribe",query:[`${El.appId}?`,`${El.context}?`,`${El.subscribePageMessage}?`,`${El.askToBuyId}?`,`${El.editorialItem}?`,`${El.includePostSubscribeAttribution}?`]}]}generatePageRequest(e,t){return za(this.marketingItemContextFromContextString(p(t,El.context)),p(t,El.appId),p(t,El.editorialItem)).attributingTo(e.build())}generateAdditionalPageRequirements(e,t){const n=super.generateAdditionalPageRequirements(e,t);if(Ba())return n;const r=p(t,El.appId);if(s(r)){const e=this.marketingItemContextFromContextString(p(t,El.context)),i=this.numberOfIconsForContextualUpsellOnPlatform(ol,e);if(i>0){const e=Wa(i);n[mp.contextualIconsRequirementKey]=$(e,this.createFetchOptions(null)).catch(()=>null)}const o=(new fh).withIds([r]).forType("apps").includingAdditionalPlatforms(Za());n[mp.contextualAppRequirementKey]=$(o,this.createFetchOptions(null)).catch(()=>null)}return n}renderPage(e,t,n){const r=n[mp.contextualAppRequirementKey];let i=null;l(r)&&(i=Ge(r));const a=u(e,"results.data")[0],c=h(e,"results.content",{}),d=a||c,f=h(e,"results.offer",{}),m=Mi(d,f,i,!1,!1,"wordmark"),w=new Ns("arcade",bs.arcadeAppAdamId,"colored",null,"arcadeSubscribePage",null,null,null,null,null,null,null,null,null,null,bs.arcadeProductFamilyId);w.titles.subscribed=P("ARCADE_ACTION_TITLE_EXPLORE","EXPLORE");const T=p(t,El.appId),A=this.marketingItemContextFromContextString(p(t,El.context));let I;"arcadeLaunchRepair"!==A&&(I=qa(A));const b=function(e,t,n){const r=Ke("Upsell",t,n);return s(n)&&"marketing-items"===n.type&&(r.mercuryMetricsData=ba(n)),r}(0,d.id,d);b.offerType="subscribe",b.baseFields.upsellType=this.metricsUpsellType(A),b.baseFields.subscriptionSKU=bs.arcadeProductId;const k={pageInformation:b,locationTracker:{rootPosition:0,locationStack:[]}},S=$i({marketingItemData:a,editorialData:c,inAppData:f},xi(d),k),C=new Sc(m,P("ARCADE_SUBSCRIBE_PAGE_NOT_NOW"),S,w);let v;C.askToBuyMessage=p(t,El.subscribePageMessage),C.askToBuyId=p(t,El.askToBuyId),Je(C,b);let E=!1;if(l(i)){C.primaryIcon=Fo(i,k,{useCase:3});const e=La(i,k);e.excludeAttribution=!g(t[El.includePostSubscribeAttribution]),v=So(i,A,e),C.postSubscribeAction=v,E=!0}if(!g(t[El.includePostSubscribeAttribution])){const e=C.pageMetrics.instructions;if(!o(e))for(const t of e)t.data.includingFields.push("crossfireReferral")}let O=[];const R=n[mp.contextualIconsRequirementKey];if(l(R)&&(O=We(R)),s(a)&&(O=W(a,"contents")),l(O)){const e=[];for(const t of O)t.id===T?E||(C.primaryIcon=Fo(t,k,{useCase:3}),v=So(t,A,La(t,k)),C.postSubscribeAction=v):e.push(Fo(t,k,{useCase:2}));C.icons=e}return s(v)&&(S.postSubscribeAction=v),"arcadeLaunchRepair"===A&&s(T)&&y("postSubscribeAppOpenAction")&&(y("subscribePageOpenAppAction")?C.openAppAction=new sc(T):C.postSubscribeAction=new sc(T)),l(C.icons)||s(C.primaryIcon)||(C.artwork=this.genericArtworkFromData(d)),"arcadeLaunchRepair"===A?C.singleIcon=C.primaryIcon:C.dismissingPostSubscribeAction=I,C.subscribedOfferButtonAction=new Zl("arcade"),C}genericArtworkFromData(e){if(!s(e))return null;const t="phone"===ol,n="tv"===ol,r=function(e,t){return h(function(e){return Ei(e)}(e),t)}(e,t?"breakoutTall":"breakoutFullScreen");if(!l(r))return null;let i=null;return i=t?"of":n&&!y("adjustedTVGenericUpsell")?"eq":"og",Lo(r,{cropCode:i,allowingTransparency:!0,useCase:7})}metricsUpsellType(e){return s(e)?e:"arcadeGeneric"}numberOfIconsForContextualUpsellOnPlatform(e,t){switch(e){case"tv":return 18;case"phone":return"arcadeLaunchRepair"===t?y("launchRepairSingleIconUpsell")?0:15:11;default:return 15}}marketingItemContextFromContextString(e){switch(e){case"launchRepair":return"arcadeLaunchRepair";case"askToBuy":return"arcadeAskToBuy";default:return e}}}mp.contextualIconsRequirementKey="contextualIconsRequirement",mp.contextualAppRequirementKey="contextualPrimaryIconRequirement";const gp={width:1680,height:3636,url:"https://is3-ssl.mzstatic.com/image/thumb/Features123/v4/9a/d4/48/9ad448b5-ddbb-f295-fae3-2a2e69bf5604/source/{w}x{h}{c}.{f}",bgColor:"000000",textColor1:"f7c981",textColor2:"f8a710",textColor3:"c6a067",textColor4:"c6850d"},yp={width:4320,height:3240,url:"https://is3-ssl.mzstatic.com/image/thumb/Features124/v4/57/71/7f/57717f8b-c486-4faf-7558-a4f88186855d/source/{w}x{h}{c}.{f}",bgColor:"000000",textColor1:"fdc97a",textColor2:"f73a03",textColor3:"caa161",textColor4:"c52e02"};class wp{}class Tp{}const Ap=["latest-release-app","arcade-apps","system-apps","app-bundles","ios-apps","imessage-apps","watch-apps","atv-apps"];Ps={product:[{protocol:Pl.internal,path:`/${Cl.product}/${Cl.lookup}`,query:[El.ids]}],reviews:[{protocol:Pl.internal,path:`/${Cl.reviews}/${Cl.shelf}/{adamId}/{sort}`}],topCharts:[{protocol:Pl.internal,path:`/${Cl.topCharts}/{genre}/{pop}`}],grouping:[{protocol:Pl.internal,path:`/${Cl.grouping}/${Cl.shelf}/{shelfToken}`}]};class Ip extends Ls{constructor(e,t,n){super(),this.card=e,this.shelves=t,this.shareAction=n,this.isIncomplete=!1,this.pageMetrics=new Kl}}class bp{constructor(){this.index=0,this.todayShelfRecoMetricsData={}}}const kp=["AppLockup","InlineImage","InlineVideo","AppMarker"];class Sp{constructor(e,t,n,r){this.name=e,this.url=t,this.artwork=n,this.roomUber=r}}class Pp extends Ls{constructor(e,t){super(),this.apps=e,this.appsToAlwaysShow=t}}class Cp extends Error{}class vp{constructor(){this._params=""}static get contentType(){return"application/x-www-form-urlencoded"}param(e,t){if(e&&t){const n=this._params.length>0?"&":"";this._params+=`${n}${encodeURIComponent(e)}=${encodeURIComponent(t)}`}return this}build(){return this._params}}class Ep extends Ls{constructor(e,t,n,r){super(),this.id=e,this.title=t,this.selectedActionTitle=n,this.url=r}}class Op extends ud{constructor(){super([])}}class Rp extends Ls{}class _p extends Ls{}class Dp extends Ls{}class Lp extends Ls{}class Fp extends Ls{constructor(e){super(),this.showsBadge=!1,this.title=null,this.notes=e,this.isCollapsed=!0}}class xp extends Ls{}const Np={11:"43",30:"44"},Up="helpful";class Mp{}const Bp=[function(e,t,n){if(t)return null;const r=P("BADGE_PREORDER_TERMS");return new od("paragraph",{paragraphText:r},"standard",null,null,null,r)},fr],$p=[Ar,gr,pr,fr],Vp=[Ar,fr,dr,yr,mr,hr,function(e,t,n){const r=ge(e,"supportedLocales"),o=r.length;if(o<=0)return null;const a={tag:p(i(r,"0.tag")).split("-")[0].toUpperCase(),name:p(i(r,"0.name"))},s={paragraphText:a.tag};let l;l=o>1?P("BADGE_LANGUAGE_CAPTION").replace("{number_other_languages}",R(o-1)):a.name;const c=P("BADGE_LANGUAGE_HEADING");return new od("paragraph",s,"standard",c,l,null,null,l,"view")},function(e,t,n){const r=Xo(e);if(!s(r))return null;const i=O(r).trim().split(/\s+/);if(2!==i.length)return null;const o={paragraphText:i[0]},a=i[1],l=P("BADGE_SIZE_HEADING");return new od("paragraph",o,"standard",l,a,null,null,a,"view")}],qp=[Ar,gr,hr,pr,fr,dr,yr,mr],Gp="undefined"!=typeof ask&&void 0!==ask.clientOrdering?ask.clientOrdering:{orderedVisibleIAPs(e,t,n,r,i){const o=[];-1!==t.findIndex((function(e,t,n){return e===r}))&&o.push(r);for(const e of n)e!==r&&o.push(e);i(o,null)},visibilityForIAPs(e,t){t({},null)}},Hp=5,jp=5,Wp=[new sd("header"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("shelf","mostRecentVersion"),new sd("shelf","videos"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","featuredIn"),new sd("shelf","reviews"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","similarItems"),new sd("shelf","moreByDeveloper")],zp=[new sd("header"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","videos"),new sd("shelf","mostRecentVersion"),new sd("shelf","featuredIn"),new sd("shelf","reviews"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","similarItems"),new sd("shelf","moreByDeveloper")],Yp=5,Kp=5,Qp=[new sd("header"),new sd("askToBuyRequest"),new sd("shelf","banner"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("shelf","bundleChildren"),new sd("shelf","bundleParents"),new sd("shelf","mostRecentVersion"),new sd("shelf","subscriptions"),new sd("shelf","inAppPurchases"),new sd("shelf","videos"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","reviews"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","featuredIn"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems")],Jp=[new sd("header"),new sd("askToBuyRequest"),new sd("shelf","banner"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("shelf","bundleChildren"),new sd("shelf","bundleParents"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","videos"),new sd("shelf","reviews"),new sd("shelf","mostRecentVersion"),new sd("shelf","subscriptions"),new sd("shelf","inAppPurchases"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","featuredIn"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems")],Xp=5,Zp=5,ef=[new sd("header"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("shelf","bundleChildren"),new sd("shelf","bundleParents"),new sd("shelf","mostRecentVersion"),new sd("shelf","subscriptions"),new sd("shelf","inAppPurchases"),new sd("shelf","videos"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","reviews"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","featuredIn"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems")],tf=[new sd("header"),new sd("topLockup"),new sd("shelf","informationRibbon"),new sd("shelf","bundleChildren"),new sd("shelf","bundleParents"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","editorialQuote"),new sd("shelf","videos"),new sd("shelf","reviews"),new sd("shelf","mostRecentVersion"),new sd("shelf","subscriptions"),new sd("shelf","inAppPurchases"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","capabilities"),new sd("shelf","featuredIn"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems")],nf=5,rf=5,of=[new sd("header"),new sd("topLockup"),new sd("shelf","videos"),new sd("screenshots"),new sd("shelf","textCards"),new sd("shelf","reviews"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","textLinksShelf")],af=[new sd("header"),new sd("topLockup"),new sd("screenshots"),new sd("shelf","textCards"),new sd("shelf","videos"),new sd("shelf","reviews"),new sd("shelf","moreByDeveloper"),new sd("shelf","similarItems"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","textLinksShelf")],sf=5,lf=5,cf=[new sd("header"),new sd("topLockup"),new sd("shelf","videos"),new sd("screenshots"),new sd("shelf","textCards"),new sd("shelf","reviews"),new sd("shelf","similarItems"),new sd("shelf","moreByDeveloper"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","textLinksShelf")],uf=[new sd("header"),new sd("topLockup"),new sd("screenshots"),new sd("shelf","textCards"),new sd("shelf","videos"),new sd("shelf","reviews"),new sd("shelf","similarItems"),new sd("shelf","moreByDeveloper"),new sd("shelf","information"),new sd("shelf","links"),new sd("shelf","textLinksShelf")],df=3,pf=3,ff=[new sd("header"),new sd("askToBuyRequest"),new sd("shelf","banner"),new sd("topLockup"),new sd("shelf","mostRecentVersion"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","actionLinks")],hf=[new sd("header"),new sd("askToBuyRequest"),new sd("shelf","banner"),new sd("topLockup"),new sd("screenshots"),new sd("shelf","description"),new sd("shelf","mostRecentVersion"),new sd("shelf","actionLinks")];class mf extends $u{constructor(){super("ProductBuilder")}defaultPlatforms(){return Za()}pageType(){return"product"}defaultTab(e){return mf.representsArcadeApp(e)?"arcade":super.defaultTab(e)}defaultAction(e,t,n){if(e instanceof Xl)return e;const r=super.defaultAction(e,t,n);if(!(e instanceof cd))return r;const i=1===e.appPlatforms.length&&"tv"===e.appPlatforms[0];if(t[El.action]!==gf||i){if(t[El.action]!==yf||i)return r;{const t=e.shelfMapping.reviews;let n=null;return t&&t.seeAllAction&&(n=t.seeAllAction,n.animationBehavior="never"),r.animationBehavior="never",new tc([r,n])}}{const t=mf.representsBundle(e),n=er(e.adamId,t,e.icon);return r.animationBehavior="never",new tc([r,n])}}static allPageRoutes(){return[{protocol:Pl.https,path:`/{countryCode}/${Cl.product}/{appName}/{id}`,query:[`${El.action}?`,`${El.offerName}?`,`${El.isPPT}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.productBundle}/{appName}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.product}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.productBundle}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/${Cl.product}/{appName}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/${Cl.productBundle}/{appName}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/${Cl.product}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,path:`/${Cl.product}/{id}`,query:[`${El.v0}?`]},{protocol:Pl.https,path:`/${Cl.productBundle}/{id}`,query:[`${El.action}?`,`${El.offerName}?`]},{protocol:Pl.https,query:[El.bundleIdentifier]},{protocol:Pl.https,query:[El.action,El.ids,`${El.isPurchasesApp}?`]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/catalog/{countryCode}/apps/{id}",query:[]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/catalog/{countryCode}/app-bundles/{id}",query:[]},{protocol:Pl.https,path:"{apiVersion}/catalog/{countryCode}/apps/{id}",query:[]},{protocol:Pl.https,path:"{apiVersion}/catalog/{countryCode}/app-bundles/{id}",query:[]},{protocol:Pl.https,hostName:`${vl.product}`,path:`/${Cl.siri}/{id}`,query:[]},{protocol:Pl.https,path:`/${Cl.store}/${Cl.viewSoftware}`,query:[El.id,`${El.v0}?`]}]}static generateProductPageOptions(e,t){const n={clientIdentifierOverride:t.query[El.clientIdentifierOverride]},r=e[El.offerName];if(r){const t="true"===e[Rl.isSubscription];n.spotlightSection=kr(t),n.spotlightInAppProductIdentifier=r}const i=t.query[ju];i&&(n.iAdClickFields=JSON.parse(i));const o=t.query[Wu];o&&(n.iAdLineItem=o);const a=t.query[Ed];return s(a)&&(n.externalDeepLinkUrl=a),n}get pageRoute(){return mf.allPageRoutes()}generatePageRequest(e,t){const n=t[El.bundleIdentifier],r=t[El.ids];let i=null;var a;if(n?(a=n,i=(new fh).forType("apps").withFilter("bundleId",a).includingAdditionalPlatforms(Za()).includingRelationships(["developer","customers-also-bought-apps","developer-other-apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items","alternate-apps"]).includingAttributes(Du).addingRelationshipLimit("reviews",es())):i="lookup"===t[El.action]&&r?function(e,t){const n=(new fh).forType("apps").addingQuery("ids",e).includingAdditionalPlatforms(Za()).includingAttributes(Du).includingRelationships(["developer","customers-also-bought-apps","developer-other-apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items","alternate-apps"]).addingRelationshipLimit("reviews",es());return t&&n.addingQuery("availability","redownload"),n}(r,g(t,El.isPurchasesApp)):Me(e),o(i))throw new Error(`Unable to map ${e.build()} to a media api url`);return i}renderPage(e,t,n){return Is.c("renderPage",()=>{const n=Ke("Software","",e),r=mf.generateProductPageOptions(t,new xl(n.pageUrl)),i=Ge(e),o=mf.alternativeAppForPlatform(i,Ie());return null===o||"mac"===ol&&!y("alternateAppRedirect")?Wr(e,r):o})}get shelfRoute(){return[{protocol:Pl.internal,path:`/${Cl.product}/${Cl.shelf}/{token}`}]}generateShelfRequest(e,t){const n=t.token,r=JSON.parse(n);let i;if(r.isBundleShelf)i="app-bundles";else switch(r.contentType){case"smallStoryCard":case"todayBrick":i="editorial-items";break;case"inAppPurchaseLockup":i="in-apps";break;default:i="apps"}return(new fh).forType(i).withIds(r.ids).includingAdditionalPlatforms(Za()).includingAttributes("in-apps"===i?[]:["editorialArtwork","editorialVideo","minimumOSVersion"])}renderShelf(e,t){const n=t.token,r=JSON.parse(n),i=mf.shelfFromDataContainer(e,r);if(i.mergeWhenFetched=!0,r.shouldInferSeeAllFromFetchesItems){const e=new Xl("page");e.title=P("ACTION_SEE_ALL");const t=new Tu(i.contentType);t.items=function(e,t){if(!e)return null;const n=[];for(const t of e){const e=Ee(t);e.offerDisplayProperties&&(e.offerDisplayProperties=e.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"infer")),n.push(e)}return n}(i.items);const n=new ud([t]);Je(n,r.destinationPageInformation),n.title=r.title,e.pageData=n,Ua(e,null,{pageInformation:r.sourcePageInformation,locationTracker:r.sourceLocationTracker}),i.seeAllAction=e}return i}shelfRequiresAdditionalModification(e,t){return!0}performAdditionalShelfModifications(e,t){return new Promise(n=>{const r=t.token,i=JSON.parse(r),o=e.items;if("inAppPurchaseLockup"===i.contentType&&o){const t=[],r=[];for(const e of o){const n=e.productIdentifier;kr(e.isSubscription).shelfId===i.inAppShelfId&&(t.push(n),e.isVisibleByDefault&&r.push(n))}(function(e,t,n,r){return new Promise((i,o)=>{const a=t.filter(e=>null!=e),s=n.filter(e=>null!=e);Gp.orderedVisibleIAPs(e,a,s,r,(e,t)=>{t?o(t):i(e)})})})(i.appBundleId,t,r,i.spotlightInAppProductIdentifier).then(t=>{e.items=mf.filteredInAppLockupsUsingOrdering(o,t),n(e)})}else new Set(["smallStoryCard","todayBrick"]).has(e.contentType)&&0===e.items.length&&(e.isHidden=!0),n(e)})}static alternativeAppForPlatform(e,t){if(!le(e,t)){const n=W(e,"alternate-apps");if(l(n))for(const e of n){const n=ye(e,"url");if(le(e,t)&&l(n))return new Xl("unknown",n)}}return null}static representsBundle(e){return!!(e.pageMetrics&&e.pageMetrics.pageFields&&"pageType"in e.pageMetrics.pageFields)&&"SoftwareBundle"===e.pageMetrics.pageFields.pageType}static representsArcadeApp(e){return!!(e.pageMetrics&&e.pageMetrics.pageFields&&"pageType"in e.pageMetrics.pageFields)&&"Arcade"===e.pageMetrics.pageFields.softwareType}static filteredInAppLockupsUsingOrdering(e,t){const n={};for(const t of e)n[t.productIdentifier]=t;const r=[];for(const e of t){const t=n[e];if(t){const e=Ee(t);r.push(e)}}return r}static shelfFromDataContainer(e,t){return Is.c("shelfFromLookupResponse",()=>{const n=new Tu(t.contentType),r={pageInformation:t.sourcePageInformation,locationTracker:t.sourceLocationTracker,excludeAttribution:!0};let i;switch(t.contentType){case"todayBrick":const n=xt(e.data,r.pageInformation,r.locationTracker,vr);s(n)&&(i=[n]);break;case"smallStoryCard":const o={metricsLocationTracker:r.locationTracker,metricsPageInformation:r.pageInformation,filterOutMediaCardKinds:mf.filteredMediaCardKindsForSmallStoryCardOnPlatform(host.platform)},a={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,canDisplayArcadeOfferButton:!0};a.videoPlaybackControls=Ad,a.videoAutoplayPlaybackControls=Ad,i=_t(e.data,t.contentType,o,null,a);break;default:const l={metricsOptions:r,offerStyle:t.offerStyle,artworkUseCase:Do(t.contentType),canDisplayArcadeOfferButton:ha(t.contentType)};"inAppPurchaseLockup"===t.contentType&&(l.skipDefaultClickAction=!0);const c={lockupOptions:l};t.isBundleShelf&&(c.filter=0);const u=no(e,c),d={[Zs]:"round",[el]:"pill"}[host.clientIdentifier];d&&u.sort((e,t)=>{const n=e.icon.style===d,r=t.icon.style===d;return n&&r?0:n&&!r?-1:1});const p=t.spotlightInAppProductIdentifier;p&&Cr(p,u),i=u}return n.items=i,n})}static filteredMediaCardKindsForSmallStoryCardOnPlatform(e){const t=new Set(["appIcon"]);return"macOS"===e&&(t.add("brandedSingleApp"),t.add("list"),t.add("inAppPurchase"),t.add("river")),t}}const gf="write-review",yf="reviews",wf=Q(z("F0F0F8"),z("303031"));class Tf{constructor(e,t,n,r,i,o){this.isBundleShelf=!1,this.ids=e,this.title=t,this.shouldInferSeeAllFromFetchesItems=n,this.contentType=r,this.offerStyle=i,this.spotlightInAppProductIdentifier=o}}const Af=["brandedSingleApp","grid","artwork","video"];class If{constructor(e,t){this.sequenceId=0,this.metricsPageInformation=e,this.locationTracker=t}addImpressionsToShelf(e,t){Oo(e,{id:`${this.sequenceId}`,kind:null,softwareType:null,targetType:t,title:e.title,pageInformation:this.metricsPageInformation,locationTracker:this.locationTracker}),this.sequenceId++}getSequenceId(){return this.sequenceId}addImpressionsFieldsToSimilarItemsShelf(e,t,n){e&&(Oo(e,{id:If.similarItemsShelfId,kind:null,softwareType:null,targetType:t,title:e.title,pageInformation:this.metricsPageInformation,locationTracker:this.locationTracker,idType:n}),this.sequenceId++)}}If.similarItemsShelfId="customers-also-bought-apps";const bf=[Fr,xr,Er,Or,function(e,t,n,r){if(ie(e,"usesLocationBackgroundMode")){const e=r?"":P("INFO_LIST_LOCATION_TITLE"),t=P("INFO_LIST_LOCATION_DESCRIPTION"),n=new Dc(t);return new _c(e,[n])}return null},Dr,Rr,Nr,_r],kf=[Fr,Er,function(e,t,n,r){const i=ge(e,"versionHistory");if(0===i.length)return null;const o=i[0];let a=null;const s=p(o,"releaseDate");s&&(a=D("d MMM YYYY",new Date(s)));const l=p(o,"versionDisplay");if(0===i.length)return null;let c;if(l&&a)c=P("VERSION_STRING_WITH_RELEASE_DATE").replace("{version}",l).replace("{date}",a);else{if(!l)return null;c=l}const u=new Dc(c),d=r?"":P("VERSION_STRING"),f=new _c(d,[u]);return f&&!n?f:null},xr,_r],Sf=[Or,Dr,Rr],Pf=[Nr],Cf=[function(e){const t=ne(e,"name");return jr("text",t,Wi(e),Gr(e).text,t)},function(e){const t=p(me(e,"editorialNotes"),"standard");if(t){let n=null,r=null,i="text";const o=me(e,"editorialBadgeInfo");if(o){const e=p(o,"editorialBadgeType");e&&"editorialPriority"===e&&(i="editorsChoice"),r=p(o,"nameForDisplay")||P("APP_STORE_EDITORS_NOTES")}else n=P("APP_STORE_EDITORS_NOTES"),r=P("APP_STORE_EDITORS_NOTES");return jr(i,n,"",t,r)}return null},function(e){const t="app-bundles"===e.type,n=function(e,t,n,r){if(!t&&!n&&!r){const t=ge(e,"versionHistory");if(t.length>1&&$r(t).length>0)return Vr(t[0],"overview")}return null}(e,ie(e,"isFirstPartyHideableApp"),t,go(fo(e)));if(n){const e=n.primarySubtitle,t=n.text,r=P("PRODUCT_SECTION_MOST_RECENT_VERSION");return jr("text",r,e,t,r)}return null}];class vf extends Ls{constructor(e,t,n,r,i){super(),this.name=e,this.genreId=t,this.artwork=n,this.ageBandId=r,this.children=i}}class Ef extends Ls{constructor(e){super(),this.categories=e}}class Of extends Ls{constructor(e,t,n,r){super(),this.shortName=e,this.longName=t,this.chart=n,this.shelves=r,this.nextPage=null,this.pageMetrics=new Kl}}class Rf extends vf{constructor(e,t,n){super(e.name,e.genreId,e.artwork,e.ageBandId,n),this.shortName=this.name,this.longName=this.name,this.url=t}}class _f extends Ls{constructor(e,t,n,r,i,o){super(),this.genreId=e,this.ageBandId=t,this.title=n,this.segments=r,this.categoriesButtonTitle=i,this.categories=o,this.initialSegmentIndex=0}}class Df{constructor(e,t){e&&(this.appStoreClientRequestId=t,this.targetingData=e.dataBlob,this.iAdId=e.iAdId,this.iAdRoutingInfo=e.iAdRoutingInfo,this.canary=e.canary)}validAdRequest(){const e=this.targetingData&&this.targetingData.length>0,t=this.iAdRoutingInfo&&this.iAdRoutingInfo.length>0;return e&&t}}const Lf={showPlaybackControls:!1,canPlayFullScreen:!1,playbackControls:{}},Ff=(e,t)=>{const n=e.isLandscape();return n===t.isLandscape()?0:n?-1:1},xf={showPlaybackControls:!1,canPlayFullScreen:!1,playbackControls:{}};Cs={search(e,t,n){o(p(t,El.path))?n.reject(new Error(`Unhandled search url: ${e}`)):net.fetch({url:e.build(),method:"GET"}).then(t=>{s(t.url)?Ii(t.url).then(n.resolve,n.reject):n.reject(new Error(`Unhandled search url: ${e}`))})},topCharts(e,t,n){const r=t[El.isPPT];e.removeParam(El.isPPT),$(new fh(e.build())).then(t=>{const n=Jr(t,e);if(r&&l(n.segments)){const e=n.segments[0],t=e.nextPage,r=st(t);if(l(r))return $(new fh(r)).then(r=>{const i=lt(t);i.ids=[],i.remainingContent=[],i.maxPerPage=0;const o=Zr(r,t,i),a=e.shelves.concat(o.shelves),s=new Of(e.shortName,e.longName,e.chart,a);return s.pageMetrics=e.pageMetrics,s.nextPage=null,n.segments[0]=s,n})}return n}).then(t=>Bu.createFlowAction(t,"topCharts",e)).then(n.resolve,n.reject)},sortedReviews(e,t,n){const r=t.adamId,i=t.sort;$((new fh).forType("user-reviews").withIds([r]).includingAdditionalPlatforms(Za()).addingQuery("sort",i),{}).then(e=>ar(ll,r,[],e,!0,i)).then(t=>Bu.createFlowAction(t,"reviews",e)).then(n.resolve,n.reject)},reviews(e,t,n){$(Me(e)).then(t=>{const n=Wr(t),r=Bu.createFlowAction(n,"product",e);let i=null;const o=n.shelfMapping.reviews,a=1===n.appPlatforms.length&&"tv"===n.appPlatforms[0];return o&&o.seeAllAction&&!a&&(i=o.seeAllAction,i.animationBehavior="never"),i?(r.animationBehavior="never",new tc([r,i])):r}).then(n.resolve,n.reject)},productInAppPurchase(e,t,n){const r=t[Rl.url],i=Me(new xl(r)),o={},a="true"===t[Rl.isSubscription];o.spotlightSection=kr(a),o.spotlightInAppProductIdentifier=t[El.offerName],$(i).then(t=>{const n=Wr(t,o);return Bu.createFlowAction(n,"product",e)}).then(n.resolve,n.reject)},inAppPurchaseInstall(e,t,n){const r=t[El.id],i=t[Ol.inAppPurchaseId];$((new fh).forType("in-apps").withIds([i]),{}).then(e=>{const t=function(e,t){const n={pageId:t||"",pageType:"IAPInstallPage",parentId:ya(e)};return new Yu(n)}(r,i),n=Ge(e);let o;const a={metricsOptions:{pageInformation:t,locationTracker:{rootPosition:0,locationStack:[]}},artworkUseCase:1};i&&n&&(o=Qi(n,a),o.theme="dark");const s=j(n,"app");let l;r&&s&&(l=Ki(s,a));const c=new dd;c.isComplete=!0,c.lockup=o,c.parentLockup=l;const u=fo(n);return c.preInstallOfferDescription=At(u),function(e,t){Je(e,t)}(c,t),c}).then(t=>Bu.createFlowAction(t,"inAppPurchaseInstall",e)).then(n.resolve,n.reject)},developer(e,t,n){$(function(e){const t=Ue(e);if(!c(t))throw new Error(`Unable to map ${e.build()} to a media api url`);return(new fh).forType("developers").withIds([t]).includingAdditionalPlatforms(Za()).includingRelationships($e()).includingAttributes(Be()).attributingTo(e.build())}(e)).then(e=>Ln(e)).then(t=>Bu.createFlowAction(t,"page",e)).then(n.resolve,n.reject)},developerHref(e,t,n){var r;$((r=t[El.href],new fh(r).includingAdditionalPlatforms(Za()).includingAttributes(Be()).includingRelationships($e()))).then(e=>Ln(e)).then(t=>Bu.createFlowAction(t,"page",e)).then(n.resolve,n.reject)},article(e,t,n){const r=JSON.parse(p(e.query,El.recoMetrics));$(function(e){const t=e.pathComponents();if(t.indexOf("story")<0&&t.indexOf("editorialItem")<0&&t.indexOf("viewEditorialItem")<0&&e.host!==vl.spamBlockingExtensions)throw new Error(`Unable to map ${e.build()} to a media api url`);let n;if(n=e.host===vl.spamBlockingExtensions?T("spamBlockingExtensionsEditorialItemID"):Ue(e),!c(n))throw new Error(`Unable to map ${e.build()} to a media api url`);if(!c(n))throw new Error(`Unable to map ${e} to a media api url`);return(new fh).forType("editorial-items").withIds([n]).includingAdditionalPlatforms(Za()).includingAttributes(["screenshotsByType","videoPreviewsByType","requiredCapabilities","minimumOSVersion","editorialArtwork","editorialVideo"]).includingRelationships(["canvas"]).includingRelationshipsForUpsell(!0).attributingTo(e.build())}(e)).then(e=>(function(e){return Fe(e,Mn,Bn)})(e)).then(e=>{const n=new bp;return n.todayShelfRecoMetricsData=r,n.showingFallbackMediaInline=Boolean(t[El.showingFallbackMedia]),n.additionalData=e.additionalData,function(e,t){return Is.c("articlePageWithResponse",()=>{const n=Ge(e);t.metricsPageInformation=Ke("editorialItem",n.id,e),t.metricsLocationTracker={rootPosition:0,locationStack:[]},t.pageId=n.id;const r={pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},i=function(e){if(!s(e))return null;const t={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!1,canDisplayArcadeOfferButton:!0};switch(t.clientIdentifierOverride=e.clientIdentifierOverride,ol){case"mac":t.prevailingCropCode="en",t.coercedGeneralCardSubType="Grid",t.heroDisplayContext="article";break;case"tv":t.prevailingCropCode="ek",t.coercedGeneralCardSubType="Grid",t.heroDisplayContext="article"}return t}(t),o=Nt(n,i,r);t.clientIdentifierOverride=i.clientIdentifierOverride,Pa({pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,targetType:"article",id:t.pageId,idType:"its_id"},o.title);const a=function(e,t,n){return Is.c("renderArticle",()=>{const r=[],i=W(e,"canvas");for(const t of i){n.module=ne(t,"displayType"),n.subStyle=null;const i=Vn(t,e,n);i&&(i.title=n.titleForNextShelf,r.push(i),n.titleForNextShelf=null),n.index++,Ea(n.metricsLocationTracker)}if((n.showingFallbackMediaInline||"watch"===ol)&&0===r.length){const e=function(e){if(e.media instanceof Fd){const t=e.media,n=new Tu("smallLockup");return n.items=t.lockups,n}return null}(t);s(e)&&r.push(e)}return r})}(n,o,t),l=a[a.length-1],c="tv"===ol?null:function(e){const t=qn(e);let n=null;const r=la(e,"name"),i=la(e,"short");if(r&&i&&(n=P("SHARE_SHEET_TITLE_SUBTITLE_FORMAT","{title}: {subtitle}").replace("{title}",r).replace("{subtitle}",i)),!n&&r&&(n=r),!n&&i&&(n=i),!n&&t){const r=ne(t,"name"),i=ne(e,"displaySubStyle");switch(i){case"GameOfDay":n=P("SHARE_SHEET_GAME_OF_DAY_TITLE_FORMAT").replace("{title}",r);break;case"AppOfDay":n=P("SHARE_SHEET_APP_OF_DAY_TITLE_FORMAT").replace("{title}",r);break;default:console.log(`No title for article with unknown substyle: ${i}`)}}const o=ne(e,"url");let a;switch(ne(e,"cardDisplayStyle")){case"Grid":case"List":case"River":a=it("resource://ShareCollectionThumbnail",40,40);break;default:a=null}const l=function(e,t,n,r,i){return Is.c("shareSheetDataForArticle",()=>{let n=r;!n&&i&&(n=function(e){const t=ne(e,"displayStyle"),n=Ut(e,"article",t);return s(n)?n:zt(ee(e,Bt(t)))}(i));const o=P("SHARE_STORY_SUBTITLE"),a=new Hs(e,o,n);return new Ws(a,t,null)})}(n,o,0,a,e);return s(l)?new gc(l,[]):null}(n);if(c){const e=function(e,t){if(e&&t){const n=e.items.length;if(n>0&&-1!==kp.indexOf(t)){const t=e.items[n-1];switch(e.contentType){case"framedArtwork":{const e=t;return e&&e.isFullWidth}case"framedVideo":{const e=t;return e&&e.isFullWidth}default:return!0}}}return!1}(l,t.module),n=function(e,t,n){if(!s(e))return null;Na(e,{targetType:"button",id:t.pageId,actionType:"share",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker});const r=new uu("share",P("SHARE_STORY"),!n,e),i=new Tu("roundedButton");return i.items=[r],i}(c,t,e);n&&a.push(n)}const u=new Ip(o,a,c);return function(e,t,n){const r=qn(t);if(r){const i=pt(t);return void(e.footerLockup=function(e,t,n){return Ki(e,{offerStyle:Gn(),metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:n,artworkUseCase:0,canDisplayArcadeOfferButton:ha("smallLockup")})}(r,n,i))}const i=ie(t,"isAcquisition"),o="iOS"===host.platform||"macOS"===host.platform;if(s(n.additionalData)&&i&&o&&y("arcadeFooterLockup")){const r=Qa(t);e.arcadeFooterLockup=function(e,t){return to(e,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},"arcadeTodayCard","infer",null)}(r,n)}}(u,n,t),Je(u,t.metricsPageInformation,e=>{let t=o.title;if(o.media instanceof Ld&&o.overlay instanceof Vd&&(t=o.overlay.lockup.title),!t)return;let n=p(e,"pageDetails","coercible");n=n||p(e,"pageId"),e.pageDetails=n?`${n}_${t}`:`unknown_${t}`}),u})}(e.originalData,n)}).then(t=>Bu.createFlowAction(t,"article",e)).then(n.resolve,n.reject)},resetAndRedirect(e,t,n){const r={url:e.toString(),signingStyle:"platform"};net.fetch(r).then(e=>{n.resolve(null)},n.reject)},msoRoom(e,t,n){const r=function(e){const t=e.availableAdamIds;return t?t.split(","):[]}(t);$(function(e){return Wn(Ue(e))}(e.removeParam("availableAdamIds"))).then(e=>zn(e,r)).then(t=>Bu.createFlowAction(t,"mso",e)).then(n.resolve,n.reject)},actionHandler(e,t,n){(function(e,t){const n=e.query.action;switch(n){case"account":const t=new Xl("finance");t.presentationContext="presentModalFormSheet",t.animationBehavior="always";const r=e.query.originalUrl;return r?t.pageUrl=r:e.query.continuation?t.pageUrl=xl.fromComponents(null,n,null,{continuation:e.query.continuation}).toString():t.pageUrl=n,Promise.resolve(t);case"signup":const i=new Xl("finance");return i.presentationContext="presentModalFormSheet",i.animationBehavior="always",i.pageUrl=function(){let e=bs.createAccountUrl;return(o(e)||"string"!=typeof e)&&(e="https://buy.itunes.apple.com/WebObjects/MZFinance.woa/wa/signupWizard"),new xl(e)}().build(),Promise.resolve(i);case"purchased":let s,l=[];if("mac"===ol)s="account";else{s="updates";const e=new Xl("account");e.presentationContext="presentModalFormSheet",e.animationBehavior="never";const t=new Xl("purchases");t.animationBehavior="never",l=[e,t]}const c=new Zl(s);return c.actions=l,Promise.resolve(c);case"checkForPreorders":const u=e.query.originalUrl;if(u.length>0){const e={url:u,signingStyle:"platform"};return net.fetch(e),Promise.resolve(new Ic)}return Promise.reject(new Error("Original url is missing when creating action for checkForPreorders."));case"redeem":const d=new Xl("finance");d.presentationContext="presentModalFormSheet",d.animationBehavior="always";const p=new xl(n);return e.query.code&&e.query.code.length>0&&p.param(El.code,e.query.code),d.pageUrl=p.build(),Promise.resolve(d);case"gift":const f=new Xl("finance");return f.presentationContext="presentModalFormSheet",f.animationBehavior="always",f.pageUrl=n,Promise.resolve(f);case"donate":const h=new Xl("finance");return h.presentationContext="presentModalFormSheet",h.animationBehavior="always",h.pageUrl="charity",Promise.resolve(h);case"search":let m=e.query.term;if(m||(m=e.query.q),m&&m.length>0){if(m=m.replace(/\+/g," ").trim(),a(m))return Promise.reject(new Error("Empty search term."));const e=M(di(m,{})).toString(),t=new nd(m,e,"externalUrl"),n=new Xl("search");return n.pageData=t,Promise.resolve(n)}{const e=new Zl("search");return Promise.resolve(e)}}return Promise.reject(new Error(`FlowAction was not able to be created for this action URL: ${e}`))})(e).then(n.resolve,n.reject)},showUpdatesPageHandler(e,t,n){const r=new Zl("updates");n.resolve(r)},personalizationTransparency(e,t,n){g(t[El.enabled])?$((new fh).forType("personalization-data")).then(e=>qe(e),()=>qe()).then(t=>Bu.createFlowAction(t,"account",e)).then(n.resolve,n.reject):n.resolve(Bu.createFlowAction(function(){const e=[],t=new Cu,n=new Ys(P("PERSONALIZATION_DESCRIPTION_OPTED_OUT"));t.addContentItem(new Ru(n)),e.push(t);const r=new Cu;return r.addContentItem(new Eu(P("ACCOUNT_SETTINGS"),Ve("finance","account",!1),"navigation")),e.push(r),new Pu(P("RECOMMENDATIONS"),e)}(),"account",e))}},vs={reviews(e,t,n){const r=n.pageToken,i=t.adamId,o=t.sort,a=u(r.remainingContent);$(new fh(r.nextHref).includingAdditionalPlatforms(Za()).addingQuery("sort",o),{}).then(e=>ar(ll,i,a,e,!1,o)).then(n.resolve,n.reject)}},Es={developer(e,t,n){const r=t.token,i=JSON.parse(r);$(new fh(i.remainingData).includingAdditionalPlatforms(Za()).includingAttributes(Be())).then(e=>(function(e,t){const n=Nn(e.data,t.contentType,t.lockupListOptions);return n.mergeWhenFetched=!0,n})(e,i)).then(n.resolve,n.reject)},today(e,t,n){const r=t.token,i=JSON.parse(r);o(i.todayModule)?n.reject(new Error("Not a today module")):$(new fh(i.todayModule.contents).includingAdditionalPlatforms(Za()).includingAttributes(ap).includingRelationshipsForUpsell(!0)).then(e=>(function(e,t){if(o(e.todayModule))return null;const n=e.todayModule;n.contents=He(t);const r=new sp;r.locationTracker=e.metricsLocationTracker,r.pageInformation=e.metricsPageInformation;const i=Ot(n,{contentOffsetWithinModule:e.contentOffsetWithinModule,hideTitle:!0,setTitleToDateForTodaySection:!1},r);return i.mergeWhenFetched=!0,i})(i,e)).then(n.resolve,n.reject)},personalizedReviews(e,t,n){const r=t.token,i=JSON.parse(r);$((new fh).forType("reviews").withIds([i.adamId])).then(e=>rr(ll,i,e)).catch(()=>rr(ll,i)).then(n.resolve,n.reject)},mso(e,t,n){const r=t.token,i=JSON.parse(r);$(new fh(i.remainingContent).includingAdditionalPlatforms(Za()).includingAttributes(["editorialArtwork","editorialVideo","minimumOSVersion"])).then(e=>(function(e,t){const n=He(e),r=t;r.remainingContent=[];const i={lockupOptions:{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},artworkUseCase:Do(t.preferredShelfContentType)},contentUnavailable:function(e,t){return r.remainingContent=ut(r.remainingContent,t),r.remainingContent.push(n[t]),!1}},o=new Tu(t.preferredShelfContentType);return o.shouldFilterApps=t.shouldFilter,o.items=ro(n,i),o.mergeWhenFetched=!0,o.url=Yn(r),o})(e,i)).then(n.resolve,n.reject)}},Os={reviews:[{protocol:Pl.https,path:`/{countryCode}/${Cl.product}/{appName}/{id}`,hash:"reviews"},{protocol:Pl.https,path:`/${Cl.store}/${Cl.viewReviews}`,query:[El.id]}],sortedReviews:[{protocol:Pl.internal,path:`/${Cl.reviews}/{adamId}/{sort}`}],productInAppPurchase:[{protocol:Pl.internal,path:`/${Cl.product}/${Cl.lookup}`,query:[Rl.url,El.offerName,Rl.isSubscription]}],inAppPurchaseInstall:[{protocol:Pl.internal,path:`/${Cl.product}/${Cl.install}`,query:[`${El.id}`,`${Ol.inAppPurchaseId}?`]}],topCharts:[{protocol:Pl.https,path:`/${Cl.store}/${Cl.topCharts}`,query:[El.genreId,El.popId]},{protocol:Pl.https,path:`/{apiVersion}/catalog/{countryCode}/${Cl.mediaCharts}`,query:[`${El.genre}?`,`${El.isPPT}?`]}],developer:[{protocol:Pl.https,path:`/${Cl.developer}/{id}`},{protocol:Pl.https,path:`/${Cl.developer}/{developerName}/{id}`},{protocol:Pl.https,path:`/{countryCode}/${Cl.developer}/{developerName}/{id}`},{protocol:Pl.https,path:`/{countryCode}/${Cl.artist}/{developerName}/{id}`},{protocol:Pl.https,path:`/${Cl.store}/${Cl.viewArtist}`,query:[El.id,`${El.v0}?`]}],developerHref:[{protocol:Pl.internal,path:`/${Cl.developer}/${Cl.href}`,query:[El.href]}],search:[{hostName:vl.searchItunes,path:"WebObjects/MZContentLink.woa/wa/link",query:[El.path]}],article:[{protocol:Pl.https,path:`/{countryCode}/${Cl.editorialItem}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.editorialItem}/{seoSlug}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.story}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.story}/{seoSlug}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/${Cl.story}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/${Cl.story}/{seoSlug}/{id}`,query:[`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:`/${Cl.store}/${Cl.viewEditorialItem}`,query:[El.id,`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/editorial-items/{id}",query:[El.id,`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/editorial-items/{seoSlug}/{id}",query:[El.id,`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:"{apiVersion}/editorial/{countryCode}/editorial-items/{id}",query:[El.id,`${El.showingFallbackMedia}?`]},{protocol:Pl.https,path:"{apiVersion}/editorial/{countryCode}/editorial-items/{seoSlug}/{id}",query:[El.id,`${El.showingFallbackMedia}?`]},{protocol:Pl.https,hostName:`${vl.spamBlockingExtensions}`}],msoRoom:[{protocol:Pl.https,path:`/{countryCode}/${Cl.mso}/{appName}/{id}`,query:["availableAdamIds?"]},{protocol:Pl.https,path:`/${Cl.mso}/{providerName}/{id}`,query:["availableAdamIds?"]},{protocol:Pl.https,path:`/{countryCode}/${Cl.mso}/{id}`,query:["availableAdamIds?"]},{protocol:Pl.https,path:`/${Cl.mso}/{id}`,query:["availableAdamIds?"]},{protocol:Pl.https,path:`/${Cl.mso}`,query:[El.id,"availableAdamIds?"]},{protocol:Pl.https,path:`{countryCode}/${Cl.mso}`,query:[El.id,"availableAdamIds?"]}],resetAndRedirect:[{protocol:Pl.https,path:`/${Cl.store}/${Cl.resetAndRedirect}`}],action:[{query:[El.action]}],personalizationTransparency:[{protocol:Pl.internal,path:`/${Cl.account}/${Cl.personalizationTransparency}`,query:[El.enabled]}]},Rs={grouping:[{protocol:Pl.internal,path:`/${Cl.grouping}/${Cl.shelf}/{token}`}],today:[{protocol:Pl.internal,path:`/${Cl.today}/${Cl.shelf}/{token}`}],topCharts:[{protocol:Pl.internal,path:`/${Cl.topCharts}/{genre}/${Cl.shelf}/{pop}`}],developer:[{protocol:Pl.internal,path:`/${Cl.developer}/${Cl.shelf}/{token}`}],personalizedReviews:[{protocol:Pl.internal,path:`/${Cl.personalizedReviews}/${Cl.shelf}/{token}`}],mso:[{protocol:Pl.internal,path:`/${Cl.mso}/${Cl.shelf}/{token}`}]};class Nf extends Bu{constructor(e,t,n=[],r=null,i=[],o=null,a=[],s=null){super(e),this._pageType=t,this._pageRoute=n,this._pageHandler=r,this._shelfRoute=i,this._shelfHandler=o,this._paginationRoute=a,this._paginationHandler=s}pageType(){return this._pageType}handlePage(e,t,n,r,i){this._pageHandler||i(new Error(`${this.builderClass} does not implement handlePage`)),this._pageHandler(e,t,{resolve:r,reject:i})}handleShelf(e,t,n,r,i){this._shelfHandler||i(new Error(`${this.builderClass} does not implement handleShelf`)),this._shelfHandler(e,t,{resolve:r,reject:i})}handlePagination(e,t,n,r,i,o){this._paginationHandler||o(new Error(`${this.builderClass} does not implement handlePagination`)),this._paginationHandler(e,t,{resolve:i,reject:o,pageToken:r})}get pageRoute(){return this._pageRoute}get shelfRoute(){return this._shelfRoute}get paginationRoute(){return this._paginationRoute}}const Uf=new Set,Mf=new Su,Bf=new Su,$f=new Su;wi(new class extends vd{constructor(){super("StoreFrontRoomBuilder")}get pageRoute(){return[{protocol:Pl.https,path:`${Cl.store}/${Cl.storeFront}`}]}action(){return new Zl("discover")}}),wi(new class extends $u{constructor(){super("EulaBuilder")}defaultPlatforms(){return Za()}generatePageRequest(e,t){const n=e.query.resourceId,r=e.query.resourceType;if(o(n)||o(r))throw new Error(`Unable to map ${e.build()} to a media api url`);const i=(new fh).forType("eula").withIds([n]);return i.targetResourceType=r,i}get pageRoute(){return[{protocol:Pl.internal,path:`${Cl.eula}`}]}pageType(){return"page"}renderPage(e,t,n){return Is.c("renderPage",()=>{const t=p(e,"results.eula.text").split(/\n{1,2}/),n=[];for(const e of t){const t=new Ys(e);t.wantsCollapsedNewlines=!1,t.suppressVerticalMargins=!0,n.push(t)}const r=new Tu("paragraph");r.isHorizontal=!1,r.items=n;const i=new ud([r]);return i.title=P("LICENSE_AGREEMENT"),i})}}),wi(new mf),wi(new class extends Bu{constructor(){super("PrivacyPolicyBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const a=e.query.resourceId;o(a)?i(Error(`Unable to map ${e.build()} to a media api url`)):$((new fh).forType("apps").withIds([a]).addingQuery("fields","privacyPolicyText"),{}).then(e=>Is.c("handlePage",()=>{const t=ye(Ge(e),"privacyPolicyText"),n=new Ys(t);return n.wantsCollapsedNewlines=!1,new mc(P("PRIVACY_POLICY"),n)})).then(r,i)}get pageRoute(){return[{protocol:Pl.internal,path:`${Cl.privacyPolicy}`}]}}),wi(new class extends Bu{constructor(){super("TVEulaBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const a=e.query.resourceId,s=e.query.resourceType;if(o(a)||o(s))return void i(Error(`Unable to map ${e.build()} to a media api url`));const l=(new fh).forType("eula").withIds([a]);l.targetResourceType=s,$(l,{}).then(e=>Is.c("handlePage",()=>{const t=p(e,"results.eula.text"),n=new Ys(t);return n.wantsCollapsedNewlines=!1,new mc(P("LICENSE_AGREEMENT"),n)})).then(r,i)}get pageRoute(){return[{protocol:Pl.internal,path:`${Cl.tvEula}`}]}}),wi(new Pd),wi(new class extends Sd{constructor(){super("RecommendationRoomBuilder")}generatePageRequest(e,t){const n=Ue(e),r=t[El.grouping];if(!this.isValidId(n))throw new Error(`Unable to map ${e.build()} to a media api url. Missing id.`);if(!this.isValidId(r))throw new Error(`Unable to map ${e.build()} to a media api url. Missing grouping.`);return(new fh).forType("editorial-elements").withIds([n]).addingQuery("grouping",r)}renderPage(e,t){return Is.c("renderPage",()=>{const n=Ge(e),r=H(n,"contents"),i=t[El.grouping],o=Ke("Room",`${n.id}-${i}`,e),a=new kd;a.remainingContent=r.data,a.url=this.paginationUrl,a.shouldFilter=!ie(n,"doNotFilter"),a.metricsPageInformation=o,a.metricsLocationTracker={rootPosition:0,locationStack:[]},a.title=ne(n,"name");const s=this.pageWithContent(r,a);return s.title=a.title,Je(s,o),s})}get pageRoute(){return[{protocol:Pl.https,path:`/{countryCode}/${Cl.appsForYou}/{title}/{id}`,query:[El.grouping]},{protocol:Pl.https,path:`/{countryCode}/${Cl.appsForYou}/{id}`,query:[El.grouping]},{protocol:Pl.https,path:`/${Cl.appsForYou}/{title}/{id}`,query:[El.grouping]},{protocol:Pl.https,path:`/${Cl.appsForYou}/{id}`,query:[El.grouping]}]}isValidId(e){return!(o(e)||isNaN(e))}}),wi(new class extends Cd{constructor(){super("DocTypeRoomBuilder")}generatePageRequest(e,t){const n=e.query.uti;return this.requestWithFilter("uti",n)}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.store}/${Cl.docTypeLookup}`}]}}),wi(new class extends vd{constructor(){super("AppDownloadFileHandlerRoomBuilder")}get pageRoute(){return[{protocol:Pl.file,pathExtension:"appdownload"}]}action(){return new Zl("account")}}),wi(new class extends Cd{constructor(){super("GenericFileHandlerRoomBuilder")}generatePageRequest(e,t){const n=e.pathExtension();return null==n?null:this.requestWithFilter("extension",n)}get pageRoute(){return[{protocol:Pl.file}]}}),wi(new class extends Cd{constructor(){super("SearchExtensionRoomBuilder")}generatePageRequest(e,t){const n=t[El.type];return this.requestWithFilter("appex",n)}get pageRoute(){return[{hostName:`${vl.searchExtensions}`,query:[El.type]}]}}),wi(new class extends Sd{constructor(){super("DeveloperRoomBuilder")}get pageRoute(){return[{protocol:Pl.internal,path:`/${Cl.developer}/${Cl.room}/{token}`}]}get paginationRoute(){return[{protocol:Pl.internal,path:`${this.paginationPath}`,query:[`${El.href}`]}]}generatePageRequest(e,t){const n=t.token,r=JSON.parse(n);if(o(r))throw new Error(`Unable to map ${e.build()} to a media api url`);return new fh(r.href)}renderPage(e,t,n){return Is.c("renderPage",()=>{const n=t.token,r=JSON.parse(n),i=Ke("Room",`${r.developerId}_${r.relationshipId}`,e),o=new kd;o.title=r.title,o.metricsPageInformation=i,o.metricsLocationTracker={rootPosition:0,locationStack:[]};const a=this.pageWithContent(e,o);return a.title=o.title,this.configurePaginationForPage(a,o,e.next),Je(a,i),a})}generatePaginationRequest(e,t,n){const r=t[El.href];return new fh(r)}renderPaginatedPage(e,t){const n=t,r=this.pageWithContent(e,n);return this.configurePaginationForPage(r,n,e.next),r}configurePaginationForPage(e,t,n){l(n)?(t.url=`${this.paginationUrl}?${El.href}=${encodeURIComponent(n)}`,e.nextPage=t):e.nextPage=null}}),wi(new class extends Cd{constructor(){super("SchemeTypeRoomBuilder")}generatePageRequest(e,t){return this.requestWithFilter("scheme",e.protocol)}get pageRoute(){const e={exclusions:[]};for(const t of Object.keys(Pl)){const n=Pl[t];if("string"==typeof n){const t={protocol:n};e.exclusions.push(t)}}return[e]}}),wi(new fp),wi(new hp),wi(new class extends $u{constructor(){super("GroupingPageBuilder")}defaultPlatforms(){return Za()}defaultAttributes(){return["editorialArtwork","isAppleWatchSupported","requiredCapabilities"]}prepareRequest(e,t,n){super.prepareRequest(e,t,n),"watch"===ol&&e.addingRelationshipLimit("contents",3)}pageType(){return"page"}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.store}/${Cl.grouping}`,query:[El.id,`${El.context}?`]},{hostName:vl.storePreview,path:`/WebObjects/{storePreviewInstance}/wa/${Cl.grouping}`,query:[El.id,`${El.useReleaseId}?`]},{protocol:Pl.https,path:`/{countryCode}/${Cl.genre}/{genreName}/{id}`},{protocol:Pl.https,path:`/${Cl.store}/${Cl.viewGenre}`,query:[El.id]},{hostName:vl.storePreview,path:`/WebObjects/{storePreviewInstance}/wa/${Cl.viewGenre}`,query:[El.id,`${El.useReleaseId}?`]},{protocol:Pl.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}"},{protocol:Pl.https,path:"{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}"},{protocol:Pl.https,path:"{apiVersion}/editorial/{countryCode}/groupings/{id}"},{protocol:Pl.https,hostName:`${vl.safariExtensions}`}]}get shelfRoute(){return[{protocol:Pl.internal,path:`/${Cl.grouping}/${Cl.shelf}/{token}`}]}generatePageRequest(e,t){let n,r,i=e.query.id;if(e.host===vl.safariExtensions&&l(bs.safariExtensionsGroupingURL)){const e=xl.from(bs.safariExtensionsGroupingURL);s(e)&&(i=Ue(e))}const o=e.pathComponents();if(-1!==o.indexOf("viewGenre")?n=i:-1!==o.indexOf("genre")?n=Ue(e):r=i,!c(r)&&!c(n))throw new Error(`Unable to map ${e.build()} to a media api url`);let a=(new fh).forType("groupings").includingAttributes(["editorialArtwork","editorialVideo","isAppleWatchSupported","requiredCapabilities"]).includingRelationshipsForUpsell(!0);const u=e.query[El.context]||ts();s(u)&&a.addingQuery("contexts",u),c(r)?a=a.withIds([r]):c(n)&&(a=a.addingQuery("genre",n));const d=e.query[El.useReleaseId];return e.host===vl.storePreview&&l(d)&&(a.isStorePreviewRequest=!0,a=a.addingQuery("release",d)),a.attributingTo(e.build())}renderPage(e,t,n,r){return Is.c("renderGroupingPage",()=>{const t=Ge(e);if(!t)return null;if(!G(t,"tabs"))return null;const n={shelves:[],metricsPageInformation:Ke("Genre",t.id,e),metricsLocationTracker:{rootPosition:0,locationStack:[]},groupingData:H(t,"tabs"),pageGenreAdamId:ne(t,"id"),pageGenreId:oe(t,"genre")||function(e){return o(e)?null:f(xl.from(e).query,"genre")}(ne(t,"chartUrl")),hasAuthenticatedUser:s(ql.dsid)};if(tn(Ge(n.groupingData),n),"watch"===ol){n.shelves.length>0&&"todayCard"===n.shelves[0].contentType&&(n.shelves[0].title=void 0);const e=this.shelfForHeaderButtons();n.shelves.unshift(e)}if("tv"!==ol){const e=ln();e&&n.shelves.push(e)}if("watch"!==ol&&"tv"!==ol){const e=bs.termsAndConditionsURL;if(!o(e)){const t=gn(e);n.shelves.push(t)}}const r=this.groupingPageTitleForData(t,n.pageGenreId),i=new ud(n.shelves);switch(ol){case"tv":case"watch":i.title=r;break;default:i.title=r,39===n.pageGenreId||36===n.pageGenreId&&"mac"===ol?i.presentationOptions=["prefersRevealNavigationBarOnMouseOver"]:i.presentationOptions=["prefersLargeTitleWhenRoot"]}return Je(i,n.metricsPageInformation),i})}groupingPageTitleForData(e,t){let n=null;switch(t){case 36:n=host.clientIdentifier===Xs&&"watch"!==ol?"mac"===ol?this.macDiscoverPageTitleForData(e):P("GROUPING_APPS"):P("GROUPING_APP_STORE","App Store");break;case 39:n=P("GROUPING_DISCOVER");break;default:n=lo(e)}return n}macDiscoverPageTitleForData(e){const t=H(e,"tabs");if(s(t)&&s(t.data))for(const e of t.data){const t=ne(e,"name"),n=oe(e,"editorialElementKind"),r=ne(e,"token");if(l(t)&&s(n)&&l(r)&&"macOS"===r&&414===n)return t}return P("GROUPING_DISCOVER")}shelfForHeaderButtons(){const e=new Tu("action"),t=[],n=new Xl("search");return n.title=P("SEARCH","Search"),n.artwork=it("resource://TabSearch.png"),t.push(n),e.items=t,e}generateShelfRequest(e,t){const n=t.token,r=JSON.parse(n),i=l(r.remainingItems),o=l(r.recommendationsHref);if(i){let e=r.remainingItems;l(r.relationshipDataToFetch)&&(e=r.remainingItems.map(e=>j(e,r.relationshipDataToFetch)));let t=new fh(e).includingAdditionalPlatforms(Za()).includingRelationshipsForUpsell(!0),n=["editorialArtwork","editorialVideo","minimumOSVersion"];return"apps"===t.resourceType&&(n=["editorialArtwork","minimumOSVersion","screenshotsByType","videoPreviewsByType"]),t=t.includingAttributes(n),t}if(o){let e=new fh(r.recommendationsHref).includingAdditionalPlatforms(Za()).includingRelationshipsForUpsell(!0),t=["editorialArtwork","editorialVideo","minimumOSVersion"];return"apps"===e.resourceType&&(t=["editorialArtwork","minimumOSVersion","screenshotsByType","videoPreviewsByType"]),e=e.includingAttributes(t),e}return null}renderShelf(e,t){const n=t.token,r=JSON.parse(n),i=l(r.remainingItems),o=l(r.recommendationsHref);if(i){let t=e;if(l(r.relationshipDataToFetch)){const n={};for(const t of e.data)n[t.id]=t;t={data:[]};for(const e of r.remainingItems){const i=j(e,r.relationshipDataToFetch);l(i)&&(e.relationships[r.relationshipDataToFetch].data=[n[i.id]]),t.data.push(e)}}return hn(t,r)}return o?function(e,t){const n=Ge(e);a(t.title)&&(t.title=ne(n,"name"));const r=function(e){const t=Da(e);return t?t.location:null}(t.metricsLocationTracker);r&&r.fcKind===t.featuredContentId&&Ca(t.metricsLocationTracker);const i={id:t.id,kind:null,softwareType:null,targetType:"swoosh",title:t.title,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"its_contentId",fcKind:t.featuredContentId,recoMetricsData:rn(n),displayStyle:t.shelfStyle};Pa(i,t.title);const o=hn(H(n,"contents"),t);return Ca(t.metricsLocationTracker),Oo(o,i),o}(e,r):null}handleShelfError(e,t,n,r){const i=r.token,o=JSON.parse(i);if(o&&!o.hasExistingContent){const e=new Tu(o.shelfStyle);e.isHidden=!0,t(e)}else super.handleShelfError(e,t,n,r)}}),wi(new class extends Bu{constructor(){super("TodayCardPreviewBuilder")}pageType(){return"today"}handlePage(e,t,n,r,i){Is.c(`${this.builderClass}.pageHandler`,()=>{const n=e.build();if(g(t[El.fetchData])){const o=this.generatePageRequest(e,t);if(!o)return void i(new Error(`Could not construct media API request for: ${e}`));o.attributingTo(n),$(o,{}).then(e=>this.renderPage(e,t)).then(t=>Bu.createFlowAction(t,this.pageType(),e)).then(r,i)}else{const n=this.renderPage({data:[]},t),i=Bu.createFlowAction(n,this.pageType(),e);r(i)}})}get pageRoute(){return[{protocol:Pl.https,path:`/${Cl.todayCardPreview}`,query:[El.ids,`${El.fetchData}?`,`${El.isTodaySection}?`]}]}generatePageRequest(e,t){const n=p(e.query[El.ids]);if(!l(n))return null;const r=n.split(",");return(new fh).forType("editorial-items").withIds(r).includingAdditionalPlatforms(Za()).includingAttributes(ap).includingRelationshipsForUpsell(!0)}renderPage(e,t){const n=P("PAGE_TITLE_TODAY"),r={title:n,label:"TodayForApps",resourceTypes:[],meta:{},contents:He(e)},o=new sp;let a=!1;s(i(t,El.isTodaySection))&&(a=!d(t,El.isTodaySection));const l=Ot(r,{hideTitle:!1,contentOffsetWithinModule:0,setTitleToDateForTodaySection:!0},o,a);return new Qd([l],null,n,n)}}),wi(new gd),wi(new class extends Bu{constructor(){super("SearchLandingPageBuilder")}get pageRoute(){return[{protocol:Pl.internal,path:`${Cl.searchLandingPage}`}]}pageType(){return"page"}handlePage(e,t,n,r,i){Is.c(`${this.builderClass}.handlePage`,()=>{this.fetchPage().then(t=>{r($u.createFlowAction(t,this.pageType(),e))}).catch(i)})}fetchPage(){return this.fetchSearchLandingPage().catch(()=>this.fetchTrendingSearchesFallbackPage())}fetchTrendingSearchesFallbackPage(){const e={url:bs.trendingSearchesURL};return net.fetch(e).then(t=>{if(!t.ok)throw Error(`Bad Status code ${t.status} for ${e.url}`);return JSON.parse(t.body)}).then(e=>new pd(this.trendingSearchesShelvesForResponse(e)))}fetchSearchLandingPage(){const e=(new fh).forType("landing").includingAdditionalPlatforms(Za());return e.targetResourceType="groupings",$(e).then(e=>this.landingPageFromResponse(e))}landingPageFromResponse(e){const t=u(e,"results.contents")[0];if(a(t))return null;const n=H(t,"tabs"),r=ne(t,"id");if(a(n))return null;const i={shelves:[],metricsPageInformation:Ke("Genre",t.id,t),metricsLocationTracker:{rootPosition:0,locationStack:[]},groupingData:H(t,"tabs"),pageGenreAdamId:r,pageGenreId:oe(t,"genre"),hasAuthenticatedUser:s(ql.dsid),isSearchGrouping:!0};if(tn(Ge(n),i),l(i.shelves))for(const e of i.shelves)e.isHorizontal=!1;const o=new pd(i.shelves);return Je(o,i.metricsPageInformation),o}trendingSearchesShelvesForResponse(e){return Is.c("trendingSearchesShelfForResponse",()=>{const t={rootPosition:0,locationStack:[]},n=u(e,"trendingSearches").map(e=>{const n=p(e,"label"),r=new nd(n,p(e,"url"),"trending");return Ma(r,n,t),Ea(t),new bc(r)});let r=0;switch(ol){case"pad":r=10;break;case"phone":r=7}const i=new Tu("action");return i.title=n.length>0?p(e,"header.label"):null,i.isHorizontal=!1,i.items=n.slice(0,r),[i]})}}),wi(new class extends $u{constructor(){super("SearchTrendingContentPageBuilder")}pageType(){return"page"}get pageRoute(){return[{protocol:Pl.internal,path:`${Cl.searchTrendingApps}`}]}defaultPlatforms(){return Za()}defaultAttributes(){return["isAppleWatchSupported","requiredCapabilities","screenshotsByType","videoPreviewsByType","minimumOSVersion"]}generatePageRequest(e,t){const n=this.fetchLimitForTrendingContentForATV();let r=(new fh).forType("trending-contents").addingQuery("bubble[contents]","apps").withLimit(n);return host.clientIdentifier===tl&&(r=r.addingQuery("contexts","arcade")),r.attributingTo(e.build())}renderPage(e,t,n){return Is.c("renderPage",()=>this.trendingContentsPageFromCollectionResultsContainer(e))}trendingContentsPageFromCollectionResultsContainer(e){return Is.c("trendingContentsPageFromCollectionResultsContainer",()=>{const t=Ke("Search",null,e),n={pageInformation:t,locationTracker:{rootPosition:0,locationStack:[]},recoMetricsData:ze(e)},r=He(e.results.contents),i=this.mixedMediaShelfFromLockupDataCollection(r,n),o=new ud([i]);return Je(o,t),o})}handlePageError(e,t,n,r,i){t($u.createFlowAction(new ud([]),this.pageType(),r))}mixedMediaShelfFromLockupDataCollection(e,t){return Is.c("lockupShelfFromLockupDataCollection",()=>{const n=new Tu("mixedMediaLockup");n.title=P("TRENDING_SHELF_TITLE");const r={showPlaybackControls:!1,canPlayFullScreen:!1,playbackControls:{}},i={metricsOptions:t,artworkUseCase:1,canDisplayArcadeOfferButton:ha("mixedMediaLockup")},a=[];for(const n of e){if(o(n.attributes))continue;const e=Zi(n,i,r);e&&(a.push(e),Ea(t.locationTracker))}const s=this.multipleOfItemsRequiredInMixedMediaShelfForATV();return n.items=at(a,s),n})}fetchLimitForTrendingContentForATV(){return 9}multipleOfItemsRequiredInMixedMediaShelfForATV(){return 3}}),wi(new class extends Cd{constructor(){super("AccessoryProtocolRoomBuilder")}generatePageRequest(e,t){const n=[];for(const t of Object.keys(e.query))t.startsWith("id")&&n.push(e.query[t]);return this.requestWithFilter("deviceProtocol",n.join(","))}get pageRoute(){return[{query:[`${El.action}=accessoryLookup`]}]}}),wi(new class extends Bu{constructor(){super("TabSelectionBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){var o;const a=e.pathComponents(),s=a.length-1;let l,c;l=s>=0?a[s]:e.query.action,null!=l&&this.currentDeviceSupportsUrlAction(l)&&(c=new Zl(l),c.popToRoot=null!=(o="true"===e.query.popToRoot)&&o),void 0===c&&(c=new Zl("phone"===ol||"pad"===ol?"today":"discover")),r(c)}get pageRoute(){const e=["today","games","apps","discover","create","work","play","develop","categories","arcade"],t=[];for(const n of e){const e=`${El.action}=${n}`,r=`${n}`;t.push({query:[e]}),t.push({path:r}),t.push({path:`{countryCode}/${r}`})}return t}currentDeviceSupportsUrlAction(e){return!("mac"!==ol||!["discover","arcade","create","work","play","develop","categories","search"].includes(e))||!("phone"!==ol&&"pad"!==ol||!["today","apps","games","arcade","search"].includes(e))||!("tv"!==ol||!["discover","apps","games","arcade","search"].includes(e))}}),wi(new class extends Bu{constructor(){super("PassbookBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){Ii(this.assemblePassbookRoomURL(e).build()).then(r,i)}get pageRoute(){return[{query:[`${El.action}=passbook`]}]}assemblePassbookRoomURL(e){let t=bs.passbookMainURL;return null!=t&&"string"==typeof t||(t="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewFeature?id=717384713&mt=8"),new xl(t)}}),wi(new class extends Bu{constructor(){super("LibraryLink")}pageType(){return"unknown"}handlePage(e,t,n,r,i){Ii(`https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewGenre?id=${e.query.g}&mt=8`).then(r,i)}get pageRoute(){return[{query:[`${El.action}=library-link`]}]}}),wi(new class extends Bu{constructor(){super("LongUrlBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const o=e.query.originalUrl;l(o)?net.fetch({url:o,method:"GET",signingStyle:"platform"}).then(e=>{let t;const n=e.headers["Content-Type"];if(e.ok&&e.redirected&&s(e.url))t=e.url;else{if(e.ok&&o!==e.url)return console.log(`[LongUrlBuilder] Url redirect was already processed. Original url: ${o}. Redirected url: ${e.url}`),void r(new Ic);if(e.ok&&l(n)&&-1!==n.toLowerCase().indexOf("text/xml")){const n=plist.parse(e.body),r=p(n,"action.kind"),i=p(n,"action.url");"Goto"===r&&i&&(t=i)}}l(t)?Ii(t).then(r,i):i(new Error(`Unable to map long url for: ${o}`))},e=>{i(new Error(`Unable to fetch long url: ${o}`))}):i(new Error("Original url is missing when creating action for checkForLongUrl."))}get pageRoute(){return[{query:[`${El.action}=checkForLongUrl`]}]}}),wi(new class extends Bu{constructor(){super("WatchCategoryBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){"phone"===ol?Ii(bs.watchAppsGroupingURL).then(e=>{const t=new Zl("apps");t.actions=[e],r(t)},i):i(new Error(`Unsupported url for current platform: ${e}`))}get pageRoute(){return[{query:[`${El.action}=watchCategory`]}]}}),wi(new class extends Bu{constructor(){super("ExperimentLink")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const o={url:e.toString()},a=net.fetch(o);a.then(t=>{if(t.status>=200&&t.status<300){const t=new hc("default");t.title="You have been enrolled in the AB test",t.message=`Test ${e.query.ab2} is now active on your device.`,t.buttonTitles=["OK"],t.buttonActions=[new Zl("infer")],r(t)}else i(new Error(`unexpected response status: ${t.status} from ${t.url}`))}),a.catch(i)}get pageRoute(){return[{protocol:Pl.https,hostName:"xp.apple.com",path:"register",query:["ab2"]}]}}),wi(new class extends Bu{constructor(){super("MultiplexingBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){$((new fh).forType("multiplex").withIds([t.id])).then(e=>this.actionFromMultiplexResponse(e)).then(r,i)}get pageRoute(){return[{protocol:Pl.https,path:"WebObjects/MZStore.woa/wa/viewFeature",query:[El.id]}]}actionFromMultiplexResponse(e){const t=h(e,"results.target"),n=h(e,"results.target-link");return t?this.targetDataToAction(t):n?this.targetLinkDataToAction(n):null}targetDataToAction(e){const t=p(e,"href");return t?Ii(Ne(t)):null}targetLinkDataToAction(e){const t=p(e,"url"),n=new xl(t),r=this.addProtocolToURLIfNeeded(n).toString();return Promise.resolve(new ec(r,!1))}addProtocolToURLIfNeeded(e){return e.protocol||(e.protocol="https"),e}}),wi(new class extends Bu{constructor(){super("ShowAccountPageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){let o,a=[];if("mac"===ol)o="account";else{o="updates";const e=new Xl("account");e.presentationContext="presentModalFormSheet",e.animationBehavior="never",a=[e]}const s=new Zl(o);s.actions=a,r(s)}get pageRoute(){return[{hostName:`${vl.showAccountPage}`},{hostName:`${vl.showPurchasesPage}`}]}}),wi(new class extends Bu{constructor(){super("ShowSubscriptionPageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){r(new Xl("finance",qu))}get pageRoute(){return[{hostName:`${vl.showSubscriptionsPage}`}]}}),wi(new class extends Bu{constructor(){super("ShowUpdatesBageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const o=new Zl("updates");if("mac"!==ol){const e=new Xl("account");e.presentationContext="presentModalFormSheet",e.animationBehavior="never",o.actions=[e]}r(o)}get pageRoute(){return[{hostName:`${vl.showUpdatesPage}`},{path:"updates"},{path:"{countryCode}/updates"},{query:[`${El.action}=updates`]}]}}),wi(new class extends Bu{constructor(){super("FamilyCircleBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,i){const o=new Ac,a=new Zl("arcade");a.actions=[o],r(a)}get pageRoute(){return[{hostName:`${vl.familyCircle}`},{path:`${vl.familyCircle}`}]}}),wi(new class extends Bu{constructor(){super("ArcadeOfferRedirectHandler")}pageType(){return"article"}defaultTab(e){return"arcade"}get pageRoute(){return[{path:"arcade/offers"},{path:"/{countryCode}/arcade/offers"}]}handlePage(e,t,n,r,i){if(l(bs.arcadeOfferEditorialItemId)){const e=new Xl("article");e.pageUrl=`https://apps.apple.com/story/id${bs.arcadeOfferEditorialItemId}`,r(e)}else i(new Error("ArcadeOffersBuilder: Missing bag key 'arcadeOfferEditorialItemId'"))}}),wi(new mp),wi(new class extends Bu{constructor(){super("ArcadeWelcomeBuilder")}pageType(){return"arcadeWelcome"}handlePage(e,t,n,r,i){const o=this.generatePage(t,n);r(Bu.createFlowAction(o,this.pageType(),e))}get pageRoute(){return[{hostName:`${vl.arcadeWelcomePage}`,query:[`${El.context}?`]}]}generatePage(e,t){return n=e[El.context],"tv"===ol?function(){const e=new Ic;e.title=P("ARCADE_WELCOME_TV_CONTINUE_BUTTON"),Na(e,{id:"arcade-welcome-continue",actionType:"navigate",pageInformation:new Yu,locationTracker:{rootPosition:0,locationStack:[]},targetType:"button"});const t=new Cc(P("ARCADE_WELCOME_INDIVIDUAL_TITLE"),null,[new Pc(P("ARCADE_WELCOME_TV_DEVICES_HEADING"),P("ARCADE_WELCOME_TV_DEVICES_BODY"),it("resource://DeviceSharing")),new Pc(P("ARCADE_WELCOME_TV_INDIVIDUAL_PEOPLE_HEADING"),P("ARCADE_WELCOME_TV_INDIVIDUAL_PEOPLE_BODY"),it("resource://FamilySharing")),new Pc(P("ARCADE_WELCOME_TV_CONTROLLERS_HEADING"),P("ARCADE_WELCOME_TV_CONTROLLERS_BODY"),it("resource://ControllerSupport"))],e,null);return new vc(t,t)}():"mac"===ol?function(){const e={rootPosition:0,locationStack:[]},t=new Ic;t.title=P("ARCADE_WELCOME_CONTINUE_BUTTON"),Na(t,{id:"arcade-welcome-continue",actionType:"navigate",pageInformation:new Yu,locationTracker:e,targetType:"button"});const n=new ec("x-apple.systempreferences:com.apple.preferences.FamilySharingPrefPane");n.title=P("ARCADE_WELCOME_INDIVIDUAL_FAMILY_BUTTON"),Na(n,{id:"arcade-welcome-create-family",actionType:"navigate",pageInformation:new Yu,locationTracker:e,targetType:"button"});const r=new ec("x-apple.systempreferences:com.apple.preferences.FamilySharingPrefPane");r.title=P("ARCADE_WELCOME_FAMILY_MEMBER_FAMILY_BUTTON"),Na(r,{id:"arcade-welcome-invite-to-family",actionType:"navigate",pageInformation:new Yu,locationTracker:e,targetType:"button"});const i=new Cc(P("ARCADE_WELCOME_INDIVIDUAL_TITLE"),P("ARCADE_WELCOME_INDIVIDUAL_SUBTITLE"),[new Pc(null,null,it("resource://WelcomeArcade"))],t,n),o=new Cc(P("ARCADE_WELCOME_FAMILY_MEMBER_TITLE"),P("ARCADE_WELCOME_FAMILY_MEMBER_SUBTITLE"),[new Pc(null,null,it("resource://WelcomeArcade"))],t,r);return new vc(i,o)}():function(e){const t={rootPosition:0,locationStack:[]},n=function(e){if(Pe(e)){const e=new Ic;return e.title=P("ARCADE_WELCOME_TV_CONTINUE_BUTTON"),e}return Dn(P("ARCADE_WELCOME_CONTINUE_BUTTON"))}(e);Na(n,{id:"arcade-welcome-continue",actionType:"navigate",pageInformation:new Yu,locationTracker:t,targetType:"button"});const r=function(e){return Pe(e)?Dn(P("AppStore.Arcade.Welcome.Family.Button.ExploreArcade")):null}(e);r&&Na(r,{id:"arcade-welcome-create-family",actionType:"navigate",pageInformation:new Yu,locationTracker:t,targetType:"button"});let i=gp,o="oe";"pad"===ol&&(i=yp,o="og");const a=new Cc(P("ARCADE_WELCOME_INDIVIDUAL_TITLE"),P("AppStore.Arcade.Welcome.Family.Description"),[new Pc(null,null,Lo(i,{useCase:22,cropCode:o}))],n,r);if(y("dismissingPostSubscribeActions"))if(Pe(e)){a.nonDismissingContinueAction=Dn(P("AppStore.Arcade.Welcome.Family.Button.ExploreArcade")),n.title=a.nonDismissingContinueAction.title;const e=new Ic;e.title=P("ARCADE_SUBSCRIBE_PAGE_NOT_NOW"),a.dismissingFamilyAction=e,r.title=a.dismissingFamilyAction.title}else a.nonDismissingContinueAction=Dn(P("AppStore.Arcade.Welcome.Family.Button.ExploreArcade")),n.title=a.nonDismissingContinueAction.title;return new vc(a,a)}(n);var n}}),wi(new class extends Nf{constructor(){super("TopChartsAdapterBuilder","topCharts",Os.topCharts,Cs.topCharts)}}),wi(new class extends Nf{constructor(){super("ReviewsAdapterBuilder","product",Os.reviews,Cs.reviews,[],null,Ps.reviews,vs.reviews)}}),wi(new class extends Nf{constructor(){super("SortedReviewsAdapterBuilder","reviews",Os.sortedReviews,Cs.sortedReviews)}}),wi(new class extends Nf{constructor(){super("PersonalizedReviewsAdapterBuilder","unknown",[],null,Rs.personalizedReviews,Es.personalizedReviews)}}),wi(new class extends Nf{constructor(){super("ProductInAppPurchaseAdapterBuilder","product",Os.productInAppPurchase,Cs.productInAppPurchase)}}),wi(new class extends Nf{constructor(){super("InAppPurchaseInstallAdapterBuilder","inAppPurchaseInstall",Os.inAppPurchaseInstall,Cs.inAppPurchaseInstall)}}),wi(new class extends Nf{constructor(){super("DeveloperAdapterBuilder","page",Os.developer,Cs.developer,Rs.developer,Es.developer)}}),wi(new class extends Nf{constructor(){super("DeveloperHrefAdapterBuilder","page",Os.developerHref,Cs.developerHref)}}),wi(new class extends Nf{constructor(){super("ArticleAdapterBuilder","article",Os.article,Cs.article)}}),wi(new class extends Nf{constructor(){super("SearchAdapterBuilder","page",Os.search,Cs.search)}}),wi(new class extends Nf{constructor(){super("MSOAdapterBuilder","mso",Os.msoRoom,Cs.msoRoom,Rs.mso,Es.mso)}}),wi(new class extends Nf{constructor(){super("ResetAndRedirectAdapterBuilder","unknown",Os.resetAndRedirect,Cs.resetAndRedirect)}}),wi(new class extends Nf{constructor(){super("ActionAdapterBuilder","unknown",Os.action,Cs.actionHandler)}}),wi(new class extends Nf{constructor(){super("PersonalizationTransparencyAdapterBuilder","account",Os.personalizationTransparency,Cs.personalizationTransparency)}}),wi(new class extends Nf{constructor(){super("TodayAdapterBuilder","today",[],null,Rs.today,Es.today)}});const Vf=z("FF5046"),qf=[Vf,z("FFFFFF"),K("white")],Gf={identifer:"wWq5csz",treatments:[0,1]};class Hf{constructor(e,t){this.videos=e,this.mediaPlatform=t}}const jf=new qs(414,896),Wf=new qs(375,812),zf=(new qs(414,736),new qs(375,667)),Yf=new qs(320,568),Kf=new qs(320,480),Qf=(new qs(768,1024),new qs(834,1112)),Jf=new qs(834,1194),Xf=new qs(1024,1366),Zf=new qs(1024,1366),eh=new qs(368,448),th=["iphone_6_5","iphone_5_8","iphone6+","iphone6","iphone5","iphone"],nh=18,rh=18,ih=41.5,oh=39,ah=34;class sh{constructor(){this.location=null,this.position=0}}const lh="undefined"!=typeof ask&&void 0!==ask.arcade?ask.arcade:{getRecentlyPlayedGamesWithTimeout:e=>Promise.resolve([]),getRecentlyPlayedGames:()=>Promise.resolve([])},ch=()=>lh.getRecentlyPlayedGames(),uh=e=>lh.getRecentlyPlayedGamesWithTimeout(e),dh="1469266318",ph=5;class fh{constructor(e){if(this.ids=new Set,this.relationshipIncludes=new Set,this.attributeIncludes=new Set,this.platform=null,this.additionalPlatforms=new Set,this.additionalQuery={},this.relationshipLimits={},this.searchTerm=null,this.searchTypes=[],this.context=null,this.platform=Xa(),!a(e))if("string"==typeof e)this.href=e;else if(Array.isArray(e)){const t=new Set;for(const n of e)t.add(n.type),this.ids.add(n.id);1===t.size?this.resourceType=t.values().next().value:t.size>1&&(this.resourceType="contents")}}forType(e){return this.resourceType=e,this}withIds(e){for(const t of e)l(t)&&this.ids.add(t);return this}includingRelationships(e){for(const t of e)this.relationshipIncludes.add(t);return this}includingScopedRelationships(e,t){this.scopedRelationshipIncludes||(this.scopedRelationshipIncludes=new Map);let n=this.scopedRelationshipIncludes.get(e);n||(n=new Set);for(const e of t)n.add(e);return this.scopedRelationshipIncludes.set(e,n),this}includingMetaKeys(e,t){this.metaIncludes||(this.metaIncludes=new Map);let n=this.metaIncludes.get(e);n||(n=new Set);for(const e of t)n.add(e);return this.metaIncludes.set(e,n),this}includingRelationshipsForUpsell(e){const t=Ba()?"marketing-items":"upsell";if(e){this.scopedRelationshipIncludes||(this.scopedRelationshipIncludes=new Map);let e=this.scopedRelationshipIncludes.get("editorial-items");e||(e=new Set),e.add(t),this.scopedRelationshipIncludes.set("editorial-items",e)}else this.relationshipIncludes.add(t);if("marketing-items"===t){this.metaIncludes||(this.metaIncludes=new Map);let e=this.metaIncludes.get("marketing-items");e||(e=new Set),e.add("metrics"),this.metaIncludes.set("marketing-items",e)}return this}includingAttributes(e){for(const t of e)this.attributeIncludes.add(t);return this}includingAdditionalPlatforms(e){for(const t of e)this.additionalPlatforms.add(t);return this}addingQuery(e,t){return this.additionalQuery[e]=t,this}addingRelationshipLimit(e,t){return this.relationshipLimits[e]=t,this}withSearchTerm(e){return this.searchTerm=e,this}searchingOverTypes(e){for(const t of e)this.searchTypes.push(t);return this}addingContext(e){return this.context=e,this}attributingTo(e){return this.canonicalUrl=e,this}withFilter(e,t){return this.filterType=e,this.filterValue=t,this}withLimit(e){return this.limit=e,this}withSparseLimit(e){return this.sparseLimit=e,this}asPartialResponseLimitedToFields(e){return this.fields=e,this}}class hh extends Ls{constructor(e,t){super(),this.lockups=e,this.missingIds=t}}class mh extends Ls{constructor(e){super(),this.targetName=e,this.imageName="none"}}class gh extends Ls{constructor(e){super(),this.name=e}}class yh extends Ls{constructor(e){super(),this.identifier=e}}class wh extends yh{constructor(e){super(e)}}class Th extends yh{constructor(e){super(e)}}class Ah extends yh{constructor(e){super(e)}}class Ih extends Ls{constructor(e){super(),this.style=e}}class bh{constructor(e){if(this._values={},!o(e)&&e.length>0){const t=e.split("&");for(const e of t){const[t,n]=e.split("="),r=decodeURIComponent(t),i=o(n)?"":decodeURIComponent(n);this._values[r]=i}}}_searchKey(e,t){if(0===e.length)throw new Error("key may not be zero length");return o(t)||0===t.length?e:`${t}${e.charAt(0).toUpperCase()}${e.slice(1)}`}get(e,t="mt"){const n=this._searchKey(e,t);return this._values[n]}set(e,t,n="mt"){const r=this._searchKey(e,n);return o(t)?delete this._values[r]:this._values[r]=t,this}toString(){let e="";for(const t of Object.keys(this._values)){const n=this._values[t];e.length>0&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(n)}return e}toEncodedMap(){const e={};for(const t of Object.keys(this._values)){const n=this._values[t],r=encodeURIComponent(t),i=encodeURIComponent(n);e[r]=i}return e}}const kh=new class{constructor(){this._app="",this._clientId="",this._pages=[]}get _requestId(){const e=Date.now().toString(36).toUpperCase(),t=Math.floor(1e5*Math.random()).toString(36).toUpperCase();return this._clientId+"z"+e+"z"+t}get _prevPage(){return this._pages.length>=2?this._pages[this._pages.length-2]:void 0}useApp(e){""!==this._app||o(e)||(this._app=e)}useClientId(e){o(e)||(this._clientId=e)}usePageHistory(e){if(0!==e.length){this._pages.length=0;for(const t of e){const e=p(t);o(e)||this._pages.push(e)}}}useNativeValues(e){const t=p(e,"nativeApp");this.useApp(t);const n=p(e,"nativeClientId");this.useClientId(n);const r=u(e,"nativePageHistory");this.usePageHistory(r)}getPageHistoryFor(e){const t=this._pages.slice();return this._pages.length>=5&&this._pages.shift(),this._pages.push(e),t}get params(){return{app:this._app,clientId:this._clientId,requestId:this._requestId,prevPage:this._prevPage,eventTime:Date.now()}}},Sh=new Hu({defaultTopic:"xp_amp_appstore",buildType:pl,jsVersion:T("version"),buyDecorator:kh,isLoggingEnabled:!0,bagProvider:(e,t)=>{const n=bs.metricsConfiguration;if(!o(t)){const r=i(n,[t,e]);if(!o(r))return r}return i(n,e)}});exportService("SearchData",{fetchHints:e=>N(()=>{const t=e.term,n=function(e,t,n=host.clientIdentifier){let r=xl.from(e).param("caller","com.apple.AppStore").param("v","4");return o(t)||(r=r.param("term",t)),r=n===Zs?r.param("media","watchSoftware").param("clientApplication","Watch"):n===el?r.param("clientApplication","Messages"):r.param("clientApplication","Software"),r.build()}(bs.searchHintsURL,t);return function(e){return function(e,t){return net.fetch(e).then(t=>{if(!t.ok)throw Error(`Bad Status code ${t.status} for ${e.url}`);const n=Date.now(),r=(e=>plist.parse(e))(t.body),i=Date.now();if(r){const e=function(e,t,n){if(a(e))return null;const r=e[0];return r.parseStartTime=t,r.parseEndTime=n,r}(t.metrics,n,i);s(e)&&(r[ks.timingValues]=e)}return r[ks.requestedUrl]=e.url.toString(),r})}(e)}({url:n,signingStyle:"platform"}).then(e=>(function(e,t,n){return Is.c("searchHintsFromApiResponse",()=>{const r={rootPosition:0,locationStack:[]},i=u(n,"hints").map(t=>{const n=p(t,"hintsEntity"),i=new nd(p(t,"searchTerm"),null,"hints",n);return Ma(i,e,r),Ea(r),i}),o=ke(e,"key","input",t,{}),a=new rd(i);return a.pageMetrics.addData(o,["pageEnter"]),a})})(t,n,e))}),fetchTrending:e=>N(()=>{const e={url:bs.trendingSearchesURL};return net.fetch(e).then(t=>{if(!t.ok)throw Error(`Bad Status code ${t.status} for ${e.url}`);return function(e){return Is.c("trendingSearchesFromApiResponse",()=>{const t={rootPosition:0,locationStack:[]},n=u(e,"trendingSearches").map(e=>{const n=p(e,"label"),r=new nd(n,p(e,"url"),"trending");return Ma(r,n,t),Ea(t),r}),r=n.length>0?p(e,"header.label"):null,i=new id(r,n);switch(ol){case"pad":i.maxNumberOfSearches=10;break;case"phone":i.maxNumberOfSearches=7}return i})}(JSON.parse(t.body))})}),fetchResults(e){const t=new Df(e.targetingData,random.nextUUID());return N(()=>{if(a(e.term))return Promise.resolve(fi(e.facets));const n=e.term.trim();return a(n)?Promise.resolve(fi(e.facets)):function(r){const i={},c={};t.validAdRequest()&&(i["X-Apple-App-Store-Client-Request-Id"]=t.appStoreClientRequestId,i["X-Apple-iAd-Request-Data"]=t.targetingData,i["X-Apple-iAd-Env-Name"]=t.iAdRoutingInfo),l(void 0)&&(i[Mu]=void 0),c.headers=i;const u=s(e.url)?di(null,e.facets,e.searchEntity,e.origin):di(n,e.facets,e.searchEntity,e.origin),d=$(u,c);let f,h;if(function(e=fs){switch(e.deviceType){case"pad":case"mac":return!0;default:return!1}}(fs)){const e=ns(null,null,function(e=fs){switch(e.deviceType){case"pad":return["iphone"];default:return[]}}(fs));e&&(f=$(e).catch(()=>void 0))}const m=bs.searchTransparencyAdamId;return l(m)&&(h=$((new fh).forType("editorial-items").withIds([m]).includingAdditionalPlatforms(Za())).catch(()=>void 0)),Promise.all([d,f,h]).then(([r,i,c])=>{const d=rs(i,!1),f=Ge(c);return function(e,t,n,r,i,c,u,d,f=!1){const h={},m=Is.c("searchResultsFromResponse",()=>{!function(e){const t=ze(e);s(t)&&(e.meta.metrics["data.search.dataSetId"]=p(t,"dataSetId"),delete e.meta.metrics.dataSetId)}(e);const m=[],g="phone"===ol||"pad"===ol||"unknown"===ol,y=Ke("Search",p(e,["meta","metrics","data.search.dataSetId"]),e);y.searchTerm=r,y.pageUrl=i;const w={rootPosition:0,locationStack:[]},T=He(e.results.search);let A=[];g&&(A=function(e,t,n,r,i=!1){const o=[];e.iAdInfo=new zu(t.iAdId,t.appStoreClientRequestId),Pa({id:"ad_container",kind:"iosSoftware",softwareType:null,targetType:null,title:"ad_container",pageInformation:e,locationTracker:n,idType:"sequential"},"ad_container");const s=He(r.results.search)[0],c=He(r.results["ads-result"]);let u,d="Adverts received from ad server: ";for(const e of c)d=d+"["+e.id+"], ";ci(d);let p=!0;for(const t of c){if(_e(t)){ci(`SearchAd [${t.id}] filtered by media_shouldFilter() - app probably not supported on current os or device`);continue}const r=ri(t,s);if(t.attributes.iad=ni(t,r),a(t.attributes.iad)){ci(`SearchAd [${t.id}] filtered because no appropriate iAd dictionary was found. (Probably a server issue if hitting this)`);continue}const c={metricsOptions:{pageInformation:e,locationTracker:n,targetType:"card",isAdvert:!0},hideZeroRatings:!0,artworkUseCase:8,isNetworkConstrained:i,canDisplayArcadeOfferButton:ha("mixedMediaLockup")},d=oi(t,r,c,u);if(a(u))u=d,ci(`SearchAd [${t.id}] dictates ad display style of: ${li(d)}`);else{if(!ti(u,d,t.id))continue;ci(`SearchAd [${t.id}] will be displayed because it is compatible with the display style of: ${li(d)}, which is the same height as display style: ${li(u)}`)}const f=ee(t,"iad");f&&e.iAdInfo.apply(t.id,f);let h=ii(t,c);if(h=ai(h,d,s&&t.id===s.id,p),"TEXT"===d.style){const e=ne(t,"iad.format.text");"none"!==e&&(h.searchAd.advertisingText=ye(t,"description"===e?"description.standard":e))}const m=new Xu("advert",h);l(m)&&(o.push(m),Ea(n),p=!1)}const f=c[0],h=ee(f,"iad");return h&&e.iAdInfo.apply(f.id,h),e.baseFields.iAdTemplateType=u?u.style:null,Ca(n),Ea(n),o}(y,n,w,e,f));const I=A||[];let b=!0;for(const e of T){if(o(e.attributes)){m.push(e);continue}if(_e(e,13822))continue;const t=gi(e,y,w,f,u);if(t){if("tv"===ol)switch(t.type){case"content":case"editorial":break;default:continue}if("inAppPurchase"===t.type){const e=t.resultModel;e&&e.parent&&(h[e.productIdentifier]=e.parent.bundleId)}b&&l(A)&&(ui(A[0],t),b=!1),I.push(t),Ea(w)}}const k=new Ku;k.results=I;const S=!a(u);if(k.facets=S?null:hi(t,c),k.isAutoPlayEnabled="tv"!==ol,l(d)){const e={};if(l(ne(d,"url"))){const t=_o(d,P("SEARCH_TRANSPARENCY_LINK"),{targetType:"link",pageInformation:y,locationTracker:w});e[`${P("SEARCH_TRANSPARENCY_LINK")}`]=ao(d,t,host.clientIdentifier),k.transparencyLink=new ru(P("SEARCH_TRANSPARENCY_TEXT"),e)}}if(m.length>0){const e=function(e,t,n,r){return{results:e,maxPerPage:30,searchEntity:t,pageInformation:n,metricsLocationTracker:r}}(m,u,y,w);k.nextPage=yi(e)}return Je(k,y),k});return new Promise((e,t)=>{0===Object.keys(h).length?e(m):function(e){return new Promise((t,n)=>{Gp.visibilityForIAPs(e,(e,n)=>{t(n?{}:e)})})}(h).then(t=>{const n=m.results.filter(e=>{const n=e;if(!n||"inAppPurchase"!==n.type)return!0;const r=n.resultModel;if(!r)return!1;const i=t[r.productIdentifier];return null==i?r.isVisibleByDefault:i});m.results=n,e(m)})})}(r,e.facets,t,n,M(u).toString(),d,e.searchEntity,f,e.isNetworkConstrained)})}()})},fetchMoreResults:e=>N(()=>{const t=function(e){return JSON.parse(e)}(e.pageToken),n=function(e){return e&&e.results?e.results.slice(0,e.maxPerPage):[]}(t);return 0===n.length?Promise.resolve(fi()):$(function(e){return new fh(e).includingAdditionalPlatforms(pi(fs)).includingRelationships(["apps","top-apps"]).includingAttributes(["screenshotsByType","messagesScreenshots","videoPreviewsByType","requiredCapabilities","supportsFunCamera","minimumOSVersion"]).includingRelationshipsForUpsell(!0)}(n)).then(n=>(function(e,t,n){return Is.c("resultsFromLookupResponse",()=>{const r=[];for(const i of e.data){const e=i.id;if(o(i.attributes)){console.warn(`no data found for ${e}, skipping`);continue}if(_e(i,13822))continue;const a=gi(i,t.pageInformation,t.metricsLocationTracker,n,t.searchEntity);a&&(r.push(a),Ea(t.metricsLocationTracker))}const i=new Ku;return i.results=r,i.nextPage=yi(t),i})})(n,function(e){let t=[];e&&e.results&&(t=e.results.slice(e.maxPerPage,e.results.length));const n=Object.assign({},e);return n.results=t,n}(t),e.isNetworkConstrained))})}),exportService("PageData",{fetchGeneric:e=>N(()=>Ai(e.url,ud)),fetchMoreOfGeneric:e=>N(()=>bi(e.pageToken)),fetchShelves:e=>N(()=>(function(e){return new Promise((t,n)=>{const r=Object.keys(e),i={shelves:{},errors:{}},o=new Iu(r.length);o.then(()=>{if(Object.keys(i.shelves).length>0)t(i);else{const t=Object.keys(i.errors).map(e=>i.errors[e].message);0===t.length?n(new Error(`Could not load any shelves: ${JSON.stringify(e)}`)):n(new Error(t.join("\n")))}});for(const t of r){const n=e[t],r=e=>{i.shelves[t]=e,o.countDown()},a=e=>{i.errors[t]=e,o.countDown()},s=Bf.routedObjectForUrl(n);s.object?s.object.handleShelf(s.normalizedUrl,s.parameters,s.matchedRuleIdentifier,r,a):a(new Error(`fetchShelves: Unhandled shelf url: ${n}`))}})})(e.requests)),fetchAction:e=>N(()=>(0!==V(new xl(e.url)).length&&net.fetch({url:bs.redirectUrlEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`url=${encodeURIComponent(e.url)}`}),Ii(e.url).then(t=>{if(!t)throw new Error(`Promise resolved to null action for: ${e.url}`);if(e.isIncomingURL){const e=[t];if(t instanceof Zl)for(const n of t.actions)e.push(n);for(const t of e){const e=t.pageData;e&&"pageMetrics"in e&&Ze(e)}}switch(t.actionClass){case"FlowAction":const n=t;"finance"===n.page||"article"===n.page||"arcadeSubscribe"===n.page?n.presentationContext="infer":e.isIncomingURL?"tv"===ol?(n.presentationContext="infer",n.animationBehavior="infer"):n.presentationContext="push":(n.presentationContext="replace",n.animationBehavior="never")}return t}).catch(e=>{if(e instanceof Ul)switch(e.statusCode){case 204:const e=new hc("default");if(e.title=P("APP_NOT_AVAILABLE_TITLE"),e.message=P("APP_NOT_AVAILABLE_MESSAGE"),e.isCancelable=!0,"tv"===ol)return e;{const t=new Zl("today");return t.title=P("ACTION_OK"),t.actions=[e],t}}throw Error(e.message)}))),fetchGenericAccount:e=>N(()=>Ai(e.url,Pu))}),exportService("ProductData",{fetchPage:e=>e.preloading&&1===Z(Hl)?Promise.reject(new Error("Product page preloading is disabled")):N(()=>{0!==V(new xl(e.url)).length&&net.fetch({url:bs.redirectUrlEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`url=${encodeURIComponent(e.url)}`});let t=Ai(e.url,cd);return t||(t=$(new fh(e.url)).then(e=>Wr(e))),t.then(e=>(host.clientIdentifier===rl&&e&&"pageMetrics"in e&&Ze(e),e))}),fetchInstallPage:e=>N(()=>Ai(e.url,dd)),fetchInstallPageAction:e=>N(()=>new Promise((t,n)=>{const r=new Xl("inAppPurchaseInstall");r.pageUrl=Yi(e.id,e.parentId),t(r)}))}),exportService("TopChartData",{fetchPage:e=>N(()=>{const t=new xl(e.url),n=t.query[El.chartIdentifier],r=t.query[El.chartIdentifiers];t.removeParam(El.chartIdentifier),t.query.limit="200",host.clientIdentifier===el&&(t.query.contexts="messages");const i=$(new fh(t.toString()));let o;return o="tv"===ol||l(r)||host.clientIdentifier===el?Promise.resolve({}):$(ns()).catch(()=>void 0),Promise.all([i,o]).then(([e,r])=>{const i=rs(r);return Jr(e,t,i,n)})}),fetchMoreOfSegment:e=>N(()=>{const t=st(e.pageToken);return 0===t.length?Promise.resolve(new Of(null,null,null,[])):$(new fh(t)).then(t=>{const n=lt(e.pageToken);return Zr(t,e.pageToken,n)})})}),exportService("TodayData",{fetchPage:e=>N(()=>{const t="x-as3-internal:/today/test"===e.url,n=-1!==e.url.indexOf(Cl.todayCardPreview);if(t)return new Promise((e,t)=>{t()});if(n){const t=xl.from(e.url);return t.param(El.fetchData,"true"),Ai(t.build(),Qd)}return function(t){const n=Za(),r={};if(l(void 0)){const e={};e[Mu]=void 0,r.headers=e}const i=$((new fh).forType("today").includingAdditionalPlatforms(n).includingAttributes(ap).includingRelationshipsForUpsell(!0),r);let a=Promise.resolve(null);const c=(new fh).forType("editorial-items").withIds(e.onboardingCardIds).includingAdditionalPlatforms(n).includingAttributes(ap);return c.ids.size>0&&(a=$(c,{}).catch(()=>void 0)),Promise.all([i,a]).then(([e,t])=>(function(e,t){if(o(e))return null;!function(e){let t=!0;const n=u(e.results.data),r={};for(const e of n){const t=u(e.contents);for(const e of t)if(je(e)){const t=r[e.id];r[e.id]=t?t+1:1}}for(let e=n.length-1;e>=0;e--){const i=n[e],o=Ct(i.contents,r,t);i.contents=o.contents,t=!o.contentsContainsHydratedData}}(e);const n=new sp;n.pageInformation=Ke("Today","today",e);const r=He(t),i=l(r),a=[];if(i){!function(e){for(const t of e)t[np]=!0}(r);for(const e of r)a.push(e.id)}const c=[];let d=!1;for(const t of e.results.data){const e=Ce(p(t,"date"));if(s(e)){const t=new Date;if(e.getTime()>t.getTime())continue}if(i&&!d){const e=u(t.contents);t.contents=r.concat(e),d=!0}bt(c,t)}const f=ln();f&&It(c,f);const h=bs.termsAndConditionsURL;o(h)||It(c,gn(h));const m=[];let g=!1,y=!0;for(;!g;){const e=Et(c,n,y);if(!s(e))break;m.push(e),g=s(e.url),y=!1}const w={queue:c,metricsContext:n};let T=null;e.results.data.length>0&&(T=p(e.results.data[0].title));const A=vt(m,w,a,T);return Je(A,n.pageInformation),A})(e,t))}()}),fetchMoreOfPage:e=>N(()=>(function(e){var t;const n=a(t=e.queue)?null:"shelf"===t[0].internalContentType?"shelf":"moduleSlice";if(o(n))return Promise.reject(new Error("today.nextPageFromPageToken called on end of page"));const r="pad"===ol?al.isEqualTo(Xf)?6:2:1;if("shelf"===n){const t=kt(e.queue,"conservative",6).shelf;return Ea(e.metricsContext.locationTracker),Promise.resolve(vt([t],e))}return function(e,t,n){const r=kt(e,"conservative",6);return"moduleSlice"!==r.contentType?Promise.reject(new Error("dequeueHydratedModuleSlice: TodayContentQueue dequeued unexpected contentType.")):St(r.moduleSlice).then(t=>{const r=t.todayModule.contents.length;let i=Math.ceil(r/n)*n;0===i&&(i=n);const o=i-r;return!t.isLastOfModule&&o>0?function e(t,n){if(0===n)return Promise.reject(new Error("hydrateContentsUntilCountOrEndOfModule: Hydrating module slice of size 0."));const r=kt(t,"conservative",n);if("moduleSlice"!==r.contentType)return Promise.reject(new Error("hydrateContentsUntilCountOrEndOfModule: TodayContentQueue dequeued unexpected contentType."));const i=r.moduleSlice;if(i.isLastOfModule)return St(i);const o=i.todayModule.contents.length;return St(i).then(n=>{const r=n.todayModule.contents.length,i=o-r;return i>0?e(t,i).then(e=>Pt(n,e)):n})}(e,o).then(e=>Pt(t,e)):t})}(e.queue,0,r).then(t=>{const n={contentOffsetWithinModule:t.contentOffsetWithinSourceModule,hideTitle:t.isContinuationModule,setTitleToDateForTodaySection:!1},r=Ot(t.todayModule,n,e.metricsContext);return t.isLastOfModule&&Ea(e.metricsContext.locationTracker),vt([r],e)})})(e.pageToken)),fetchArticle:e=>N(()=>Ai(e.url,Ip))}),exportService("ContentData",{fetchIconArtwork:e=>N(()=>$((new fh).withIds(e.adamIds).forType("apps").includingAdditionalPlatforms(Za())).then(e=>{const t=He(e),n={};for(const e of t)n[e.id]=No(e,{useCase:3});return n})),fetchLockups:e=>0===e.bundleIds.length?Promise.resolve(new hh([],[])):N(()=>$((new fh).forType("apps").includingAdditionalPlatforms(Za()).withFilter("bundleId",e.bundleIds.join(","))).then(t=>(function(e,t){return Is.c("lockupsFromResponse",()=>{const n={rootPosition:0,locationStack:[]},r=new Yu,i=He(e),o=[],a=new Set(t);for(const e of i){const t=Ki(e,{metricsOptions:{pageInformation:r,locationTracker:n},artworkUseCase:2});t&&(o.push(t),a.delete(t.bundleId))}return new hh(o,Array.from(a))})})(t,e.bundleIds)))}),exportService("Metrics",{buildEvent:e=>N(()=>{const t=Sh.makeEvent(e.fields);return Promise.resolve(t)})}),exportService("Purchases",{decorateArcadePurchase:e=>N(()=>{const t=m(e.intent,"token");let n=t.buyParams;n=cs(p(e.intent,"adamId"),n,m(e.intent,"token.pageInformation"),d(e.intent,"token.excludeAttribution"),p(e.intent,"token.metricsPlatformDisplayStyle"),h(e.intent,"metrics"),h(e.intent,"systemInformation"));const r=new bh(n),i={product:p(e.intent,"product")||t.productIdentifier,adamId:p(e.intent,"adamId"),buyParams:r.toEncodedMap()};return Promise.resolve(i)}),decoratePurchase:e=>N(()=>{const t=e.intent;let n=p(t,"token.buyParams");const r=p(t,"overrideBuyParams");s(r)&&(n=r),n=cs(p(t,"adamId"),n,m(t,"token.pageInformation"),d(t,"token.excludeAttribution"),p(t,"token.metricsPlatformDisplayStyle"),h(t,"metrics"),h(t,"systemInformation"));const i=u(t,"token.appPlatforms"),o=i&&i.length&&i.length>0&&i.indexOf("tv")>=0,a=Wo(ol).some(e=>-1!==i.indexOf(e)),l=p(t,"instalationType"),c="update"===l,f="redownload"===l,y=d(t,"token.isPreorder"),w=!(y||o&&!a),T=Object.assign(Object.assign({},h(t,"token.additionalHeaders",{})),h(t,"additionalHeaders",{})),A={adamId:p(t,"adamId"),buyParams:n,vendor:p(t,"token.vendor"),appName:p(t,"token.appName"),bundleId:p(t,"token.bundleId"),appPlatforms:i,additionalHeaders:T,isUpdate:c,isRedownload:f,isPreorder:y,createsJobs:w,preflightPackageUrl:p(t,"token.preflightPackageUrl"),isArcadeApp:g(t,"token.isArcadeApp")};return Promise.resolve(A)})}),exportService("MSOData",{fetchProviderData:e=>N(()=>{const t=e.providerAdamId;return $((new fh).forType("multiple-system-operators").withIds([t])).then(e=>(function(e){return Is.c("msoProviderDataFromData",()=>{const t=Ge(e),n=ne(t,"name"),r=ne(t,"url"),i=function(e){return Is.c("msoProviderArtworkFromData",()=>Lo(ee(e,"editorialArtwork.storeFlowcase")||ee(e,"artwork"),{useCase:3}))}(t);i&&(i.crop="sr");const o=function(e){const t=ee(e,"editorialArtwork.bannerUber");return t?Lo(t,{useCase:20}):null}(t);return new Sp(n,r,i,o)})})(e))}),fetchPage(e){const t=o(e.providerAdamId)||o(e.subscribedChannelIds);return N(()=>t?Ai(e.url,ud):$(Wn(e.providerAdamId)).then(t=>zn(t,function(e,t){const n=e.appsToAlwaysShow;for(const r of Object.keys(e.apps)){const i=e.apps[r];for(const e of i)if(-1!==t.indexOf(e)){n.push(r);break}}return n}(function(e){return Is.c("msoAppsFromResponse",()=>{const t=Ge(e),n=W(t,"channel-apps"),r={};for(const e of n)r[j(e,"app").id]=te(e,"channelNames");const i=W(t,"apps").map(e=>e.id);return new Pp(r,i)})}(t),e.subscribedChannelIds))))}}),exportService("CMCPersonalizationData",{fetchPersonalizedOfferContext:e=>N(()=>{const t=e.offerToken.offerAction,n=e.offerToken.offerDisplayProperties;if(!t||!n)return Promise.reject(new Error("Invalid offerToken for personalized offer fetch."));const r=t.adamId,i={url:bs.buyButtonMetadataURL,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"ids="+r,signingStyle:"platform"};return net.fetch(i).then(e=>{if(!e.ok)throw Error(`Bad Status code ${e.status} for ${i.url}`);const a=h(JSON.parse(e.body),r);let s=null,l=null;const c=function(e){return Is.c("personalizedOfferTypeFromBuyButtonMetadata",()=>{const t=u(e,"offers");if(0===t.length)return null;for(const e of t){const t=p(e,"type");if(t)return t}return"none"})}(a);if(o(c))throw new Error("fetchPersonalizedOfferContext: Failed to determine offer type from buyButtonMetadata");if("none"!==c){let e="colored";s=function(e,t){return Is.c("personalizedCMCOfferActionFromBuyButtonMetadata",()=>{const n=u(e,"offers");if(0===n.length)return null;let r,i=null;for(const e of n)switch(r=p(e,"type"),r){case"complete":case"purchased":i=e;break;default:i=null}if(!i)return null;let a=p(i,"buyParams");if("complete"===r&&o(a))return Is.d("ignoredValue","string","item.offer.buyParams"),null;a||(a="");const s=t.purchaseConfiguration,l=new xs(a,s.vendor,s.appName,s.bundleId,s.appPlatforms,s.isPreorder,s.excludeAttribution,s.metricsPlatformDisplayStyle);l.pageInformation=s.pageInformation;const c=bo(i,t.adamId,l);return function(e,t){const n=t.purchaseConfiguration.pageInformation;let r;for(const e of t.actionMetrics.data)if(r=u(e.fields,"location"),r)break;Fa(e,n,r,!1)}(c,t),c})}(a,t);let r=null;switch(c){case"purchased":e="disabled",r=P("BUNDLE_OFFER_BUTTON_TITLE_PURCHASED");break;case"complete":(o(s.price)||0===s.price)&&(r=P("OFFER_BUTTON_TITLE_GET"))}l=function(e,t,n,r){return o(e)?null:Is.c("personalizedCMCDisplayPropertiesFromBuyButtonMetadata",()=>{const t=new Ns("app",e.adamId,r),i=To(e);t.isFree=i;let o=null;o=i?e.title:e.priceFormatted,t.titles.standard=o;const a=n.hasInAppPurchases;if(t.hasInAppPurchases=a,a){const e=P("INLINE_IN_APP_PURCHASES");t.subtitles.standard=e}return t.contentRating=n.contentRating,t})}(s,0,n,e),r&&(l.titles.standard=r)}const d=Po(s,!1);return new Us(c,d,l)})})}),exportService("ArcadeData",{fetchPage:e=>N(()=>{const t=xl.from(e.url);return t.param(El.isArcade,"true"),t.param(El.isSubscribed,`${e.isSubscribed}`),t.param(El.isTrialAvailable,`${e.isTrialAvailable}`),Ai(t.build(),fd)}),fetchSubscribePage:e=>N(()=>Ai(xl.from(e.url).build(),Sc)),fetchArcadeSeeAllGames:e=>N(()=>Ai(e.url,hd)),fetchMoreArcadeSeeAllGames:e=>N(()=>bi(e.pageToken).then((function(e){return e}))),fetchArcadeWelcomePage:e=>N(()=>Ai(e.url,vc))}),exportService("TopShelfData",{fetchTopShelf:e=>N(()=>{switch(host.clientIdentifier){case"com.apple.TVAppStore.AppStoreTopShelfExtension":return function(e){return Is.b("topShelfFromGroupingUrl",()=>{const t=e.query.id;let n,r;const i=e.pathComponents();if(-1!==i.indexOf("viewGenre")?n=t:-1!==i.indexOf("genre")?n=Ue(e):r=t,!c(r)&&!c(n))throw new Error(`Unable to map ${e.build()} to a media api url`);let o=(new fh).forType("groupings").addingRelationshipLimit("contents",6).addingQuery("fields","name,artistName,label,editorialElementKind,displayStyle,displaySubStyle,cardDisplayStyle,editorialArtwork,link,target,url,isCanvasAvailable,editorialNotes,description");return c(r)?o=o.withIds([r]):c(n)&&(o=o.addingQuery("genre",n)),$(o).then(e=>{const t=Ge(e);if(!t)return null;const n=j(t,"tabs");if(!n)return null;const r=H(n,"children");if(!r||r.data.length<1)return null;const i=r.data[0],o=ne(i,"editorialElementKind");if(475!==Number(o))return null;if("large"!==ne(i,"displayStyle"))return null;const a=W(i,"contents"),l={locationTracker:{rootPosition:0,locationStack:[]},pageInformation:Ke("TopShelf",t.id,e)},c=new Ih("inset");return c.items=function(e,t){const n=[];for(const r of e){if(!s(r.attributes))continue;const e=is(r,t);e&&n.push(e)}return n}(a,l),c})})}(xl.from(e.url));case"com.apple.Arcade.ArcadeTopShelfExtension":return function(e,t){return Is.b("topShelfForArcade",()=>{if(!y("arcadeTopShelf")){const e=new Ih("carouselDetails");return e.items=[],Promise.resolve(e)}if(bs.isArcadeComingSoonEnabled)return $((new fh).forType("editorial-items").withIds([dh])).then(e=>{const t=new Ih("carouselDetails");return t.items=[],t.promotionItem=function(e){return Is.b("topShelfPromotionItemFromComingSoonEditorialItem",()=>{const t=Ge(e);if(!l(t))return null;const n=new Ah("arcade-coming-soon");y("arcadeWordmarkAssetName")&&(n.promotionImageName=bl,n.contextImageName=bl),n.contextTitle=P("APPLE_ARCADE"),n.title=ca(t,"name"),n.promotionText=n.title,n.accessibilityLabel=n.title;const r=Ri(t);n.image=r.artwork;const i=_i(t);if(o(n.image)&&!o(i.video)&&(n.image=i.video.preview),y("arcadeTopShelfFullUpcomingExperience"))o(i.video)||(n.previewVideoUrl=i.video.videoUrl);else{const e=new mh("openApplication");e.bundleIdentifier=`${tl}`,e.title=P("INTRO_PRICE_OFFER_SUBTITLE"),n.playAction=e}return n})}(e),t});let n=Promise.resolve(null);e||(n=$(za("arcadeTopShelfATV")));let r=Promise.resolve(null);e&&(r=Ka(2,!0));const i=$(ja(!1).includingAttributes(["description"]).withSparseLimit(5));return Promise.all([n,r,i]).then(([n,r,i])=>{const a=new Ih("carouselDetails");a.items=[],a.promotionItem=function(e){return Is.b("topShelfItemFromUpsellResponse",()=>{const t=u(e,"results.data")[0],n=h(e,"results.content",{}),r=t||n;if(!l(r))return null;const i=new Ah("arcade-upsell");y("arcadeWordmarkAssetName")&&(i.promotionImageName=bl,i.contextImageName=bl),i.contextTitle=P("APPLE_ARCADE");let a=Ni(r),c=Ui(r);const d=h(e,"results.offer",{});s(d)&&(a=yt(a,d),c=yt(c,d)),i.title=a,i.accessibilityLabel=i.title,i.promotionText=i.title,i.termsAndConditionsText=c;const p=Ri(r,!0);s(p.artwork)&&(i.image=p.artwork,i.promotionHeadingTintStyle=Y(p.artwork.backgroundColor)?"light":"dark");const f=_i(r);o(f.video)||(i.previewVideoUrl=f.video.videoUrl);const m=ne(r,"breakoutCallToActionLabel");return i.playAction=ls(m),i})}(n);const c=new Set,d=function(e,t,n,r,i,o=null){const a=He(e);return l(a)?os(a,t,n,{locationTracker:{rootPosition:0,locationStack:[]},pageInformation:Ke("TopShelf",r,e)},i,o):[]}(r,e,t,"recently-played",c);a.items=a.items.concat(d);const p=function(e,t,n,r,i,o=null){const a=We(e);return l(a)?os(a,t,n,{locationTracker:{rootPosition:0,locationStack:[]},pageInformation:Ke("TopShelf",r,e)},i,o):[]}(i,e,t,"recently-added",c,5);return a.items=a.items.concat(p),console.log(`Top shelf has ${a.items.length} items.`),a})})}(d(e.isSubscribed),d(e.isTrialAvailable));default:return Promise.reject("Top shelf requested outside of an extension.")}}),createPurchase:e=>N(()=>{const t=p(e,"userInfo.adamId");if(!s(t))return Promise.reject("Missing adamId for top shelf purchase.");const n=m(e,"userInfo.token");if(o(n))return Promise.reject("Missing configuration token for top shelf purchase.");const r={adamId:t,buyParams:cs(t,p(n.buyParams),n.pageInformation,d(n.excludeAttribution),p(n.metricsPlatformDisplayStyle),e.metrics,e.systemInformation),vendor:p(n.vendor),appName:p(n.appName),bundleId:p(n.bundleId),appPlatforms:u(n.appPlatforms),additionalHeaders:h(n.additionalHeaders),isUpdate:!1,isRedownload:!1,isPreorder:!1,createsJobs:!0,preflightPackageUrl:p(n.preflightPackageUrl)};return Promise.resolve(r)})}),Is.a()}]);