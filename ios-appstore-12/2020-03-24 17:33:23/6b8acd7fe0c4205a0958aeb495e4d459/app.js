!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){var r,o;if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;if(r=Object.create(null),t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(o in e)t.d(r,o,function(t){return e[t]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=83)}([function(e,t,n){(function(e){function r(){return 0===p.nameStack.length?["<empty stack>"]:p.nameStack.slice(0)}function o(e){(function(e){return e&&void 0!==e.$incidents})(e)&&(e.$incidents=p.incidents),p.incidents=[],p.nameStack=[],p.suppressedIncidentPaths=[]}function i(){for(const t of Object.keys(e.services)){const n=e.services[t];for(const e of Object.keys(n)){const t=n[e];t instanceof Function&&(n[e]=function(...e){const n=t.apply(this,e);return n instanceof Promise?n.then(e=>(o(e),e)):(o(n),n)})}}}function s(e,t,n){let r=null;n&&(r=e,p.suppressedIncidentPaths.push(n));let o=null;try{!function(e){p.nameStack.push(e)}(e),o=t()}catch(e){throw e.hasThrown||(u("defaultValue","no exception",e.message),e.hasThrown=!0),e}finally{e===r&&p.suppressedIncidentPaths.pop(),0===p.nameStack.length&&console.warn("endContext() called without active validation context, ignoring"),p.nameStack.pop()}return o}function a(e,t,n){let r=null;try{r=s(e,t)}catch(e){r=null,n&&(r=n(e))}return r}function c(e){-1===p.suppressedIncidentPaths.indexOf(e.objectPath)&&p.incidents.push(e)}function l(e,t,n){c({type:"nullValue",expected:t,actual:"null",objectPath:n||"<this>",contextNames:r(),recoveryAction:e})}function u(e,t,n,o){var i;c({type:"badType",expected:t,actual:`${i=n,Array.isArray(i)?"array":null===i?"null":typeof i} (${n})`,objectPath:o||"<this>",contextNames:r(),recoveryAction:e})}n.d(t,"a",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return a}),n.d(t,"d",function(){return l}),n.d(t,"e",function(){return u});const p={nameStack:[],incidents:[],suppressedIncidentPaths:[]}}).call(this,n(17))},function(e,t,n){e.exports=n(42)},,function(e,t,n){e.exports=n(39)},function(e,t,n){var r=n(1),o=n(23),i=n(5),s=n(8),a=n(16),c=a.environment,l=n(11),u=n(27),p={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){var r=Array.prototype.slice.call(arguments),o=i.value("metricsBase",l.topic());return o&&r.push(o),p.processMetricsData.apply(p,r)},processMetricsData:function(e,t,n){var r,a,c,u,d=null,f="function"==typeof this.eventType?this.eventType():null;return i.metricsDisabledOrBlacklistedEvent(f,l.topic())||(r=this!==p,a="function"!=typeof this.mtIncludeBaseFields||this.mtIncludeBaseFields(),c=Array.prototype.slice.call(arguments,3),r&&a&&(c=[p.metricsData.apply(p,arguments)].concat(c)),d=s.eventFields.processMetricsData(this,this.knownFields(),e,t,n,c),r&&(u=i.constraintsForEvent(d,l.topic()),o.utils.eventFields.applyEventConstraints(d,u),i.removeBlacklistedFields(d,l.topic()),i.applyDeRes(d,l.topic()))),d},knownFields:function(){return["app","appVersion","baseVersion","capacityData","capacityDataAvailable","capacityDisk","capacitySystem","capacitySystemAvailable","connection","constraintProfile","clientId","cookies","dsId","environmentBuild","environmentDataCenter","environmentInstance","eventTime","experimentId","isSignedIn","hardwareFamily","hardwareModel","hostApp","hostAppVersion","os","osBuildNumber","osVersion","page","pageContext","pageDetails","pageId","pageType","pageUrl","parentPageUrl","pixelRatio","resourceRevNum","screenHeight","screenWidth","storeFrontHeader","timezoneOffset","userAgent","userType","windowInnerHeight","windowInnerWidth","windowOuterHeight","windowOuterWidth","xpPostFrequency","xpSendMethod","xpVersionMetricsKit","xpDelegatesInfo"]},app:function(e){return e&&e.app||c.app()},appVersion:function(e){return e&&e.appVersion||c.appVersion()},baseVersion:function(e){return 1},capacityData:function(e){return e&&e.capacityData||c.capacityData()},capacityDataAvailable:function(e){return e&&e.capacityDataAvailable||c.capacityDataAvailable()},capacityDisk:function(e){return e&&e.capacityDisk||c.capacityDisk()},capacitySystem:function(e){return e&&e.capacitySystem||c.capacitySystem()},capacitySystemAvailable:function(e){return e&&e.capacitySystemAvailable||c.capacitySystemAvailable()},connection:function(e){return e&&e.connection||c.connectionType()},constraintProfile:function(e){return e&&e.constraintProfile||i.constraintProfile(l.topic())},clientId:function(e){return e&&e.clientId||r.cookies.get("xp_ci")},cookies:function(e){var t,n,o,s,a=null;if(e.cookies)a=e.cookies;else if((t=i.value("fieldsMap.cookies",l.topic()))&&t)for(n=0;n<t.length;n++)o=t[n],(s=r.cookies.get(o))&&(a||(a={}),a[o]=s);return a},dsId:function(e){return e&&e.dsId||c.dsId()},isSignedIn:function(e){return e&&"isSignedIn"in e?e.isSignedIn:!!this.dsId(e)},eventTime:function(e){return e&&e.eventTime||Date.now()},experimentId:function(e){return e&&e.experimentId||r.optionValueFromStoreFrontHeader(this.storeFrontHeader(e),"ab")},hardwareFamily:function(e){return e&&e.hardwareFamily||c.hardwareFamily()},hardwareModel:function(e){return e&&e.hardwareModel||c.hardwareModel()},hostApp:function(e){return e&&e.hostApp||c.hostApp()},hostAppVersion:function(e){return e&&e.hostAppVersion||c.hostAppVersion()},os:function(e){return e&&e.os||c.os()},osBuildNumber:function(e){return e&&e.osBuildNumber||c.osBuildNumber()},osVersion:function(e){return e&&e.osVersion||c.osVersion()},page:function(e){if(!e)throw"No data provided to event_handlers/base page function";return e.page?e.page:this.pageType(e)&&this.pageId(e)?this.pageType(e)+i.value("compoundSeparator",l.topic())+this.pageId(e):void 0},pageContext:function(e){return e&&e.pageContext},pageDetails:function(e){return e&&e.pageDetails},pageId:function(e){return e&&e.pageId},pageType:function(e){return e&&e.pageType},pageUrl:function(e){return e&&e.pageUrl||c.pageUrl()},parentPageUrl:function(e){return e&&e.parentPageUrl||c.parentPageUrl()},pixelRatio:function(e){return e&&e.pixelRatio||c.pixelRatio()},resourceRevNum:function(e){return e&&e.resourceRevNum||c.resourceRevNum()},screenHeight:function(e){return e&&e.screenHeight||c.screenHeight()},screenWidth:function(e){return e&&e.screenWidth||c.screenWidth()},storeFrontHeader:function(e){return e&&e.storeFrontHeader||c.storeFrontHeader()},timezoneOffset:function(e){return e&&e.timezoneOffset||(new Date).getTimezoneOffset()},userAgent:function(e){return e&&e.userAgent||c.userAgent()},userType:function(e){return e&&e.userType||c.userType()},windowInnerHeight:function(e){return e&&e.windowInnerHeight||c.windowInnerHeight()},windowInnerWidth:function(e){return e&&e.windowInnerWidth||c.windowInnerWidth()},windowOuterHeight:function(e){return e&&e.windowOuterHeight||c.windowOuterHeight()},windowOuterWidth:function(e){return e&&e.windowOuterWidth||c.windowOuterWidth()},xpPostFrequency:function(e){return e&&e.xpPostFrequency||i.value("postFrequency",l.topic())},xpViewablePercentage:function(e){return e&&e.xpViewablePercentage||i.value("impressions.viewablePercentage",l.topic())},xpSendMethod:function(e){return e&&e.xpSendMethod||a.eventRecorder.sendMethod()},xpVersionMetricsKit:function(){return u.version},xpDelegatesInfo:function(){var e=r.delegatesInfo.getStoredDelegateObject(this);return e&&e.delegates||void 0}};e.exports=p},function(e,t,n){e.exports=n(40)},function(e,t,n){var r=n(62).loggerNamed("mt-metricskit");e.exports=r},function(e,t,n){var r=n(19),o={setDelegate:!0},i={_utResetNonOverridableFunctions:function(){o={setDelegate:!0}},functionName:function e(){return e.caller.name},shallowClone:function(e){var t,n,r,o={},s=i.hasGetterAndSetterMethods(e);for(r in e)t=null,n=null,s&&(t=e.__lookupGetter__(r),n=e.__lookupSetter__(r)),t||n?(t&&o.__defineGetter__(r,t),n&&o.__defineSetter__(r,n)):o[r]=e[r];return o},isDefined:function(e){return void 0!==e},isDefinedNonNull:function(e){return this.isDefined(e)&&null!==e},isDefinedNonNullNonEmpty:function(e){return i.isDefinedNonNull(e)&&!i.isEmptyString(e)&&!i.isEmptyArray(e)&&!i.isEmptyObject(e)},isEmptyString:function(e){return i.isString(e)&&0===e.length},isEmptyArray:function(e){return i.isArray(e)&&0===e.length},isEmptyObject:function(e){return i.isObject(e)&&0===Object.keys(e).length},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isInteger:function(e){return i.isNumber(e)&&e%1==0},isString:function(e){return"string"==typeof e||e instanceof String},isElement:function(e){return e&&1==e.nodeType},isArray:function(e){return e&&e.constructor===Array},isObject:function(e){return e&&e.constructor===Object},values:function(e){var t,n,r=[];for(t in e)n=e[t],e.hasOwnProperty(t)&&!i.isFunction(n)&&r.push(n);return r},keys:function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&!i.isFunction(e[t])&&n.push(t);return n},hasAnyKeys:function(e){for(var t in e)if(e.hasOwnProperty(t))return!0},hasAnyNonNullKeys:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0},hasGetterAndSetterMethods:function(e){return i.isObject(e)&&i.isFunction(e.__lookupGetter__)&&i.isFunction(e.__lookupSetter__)&&i.isFunction(e.__defineGetter__)&&i.isFunction(e.__defineSetter__)},methods:function(e){var t,n,r=[];for(t in e)n=e[t],e.hasOwnProperty(t)&&i.isFunction(n)&&r.push(n);return r},invert:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&!i.isFunction(e[t])&&(n[e[t]]=t);return n},extend:function(e){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return this.copyKeysAndValues.apply(this,t)},copyKeysAndValues:function(e,t,n,r){var o,s,a,c,l,u,p,d=n&&r||{};for(l=3;l<arguments.length;l++)for(u in o=arguments[l],s=i.hasGetterAndSetterMethods(o),o)a=null,c=null,s&&(a=o.__lookupGetter__(u),c=o.__lookupSetter__(u)),a||c?(a&&d.__defineGetter__(u,a),c&&d.__defineSetter__(u,c)):Object.prototype.hasOwnProperty.call(o,u)&&(p=o[u],(e||null!=p)&&(t||"function"!=typeof p)&&(d[u]=p));return d},addNonOverrideableFunctions:function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],o[n]=!0},attachDelegate:function(e,t){var n,s=!1;return e&&t&&e!==t&&(r.storeDelegateInfo(e,t),n={},Object.keys(t).forEach(function(t){e[t]||(n[t]=!0)}),i.extend(n,o),s=i.attachMethods(e,t,null,n)),s},attachMethods:function(e,t,n,r){var o,i,s,a,c=!1;if(e&&t)for(i in r=r||{},n=n||t,o=function(e,t,n,r){var o=function(){return n[r].apply(e,arguments)};return t&&(o.origFunction=t),o},t)i in r||t[i]&&"function"==typeof t[i]&&(a=(s=e[i])&&"function"==typeof s?s.bind(e):null,e[i]=o(n,a,t,i),c=!0);return c},setDelegates:function(e,t){var n,r={};for(n in e)t[n]&&i.isFunction(e[n].setDelegate)&&(r[n]=e[n].setDelegate(t[n]));return r},copyDelegatedFunctions:function(e,t){var n,r,o=null;if(e&&t&&t.setDelegate){for(r in n={},e)i.isFunction(e[r])&&e[r].origFunction&&(n[r]=e[r]);o=t.setDelegate(n)}return o}};e.exports=i},function(e,t,n){var r=n(1),o={};o.delegateExtension=n(10),o.eventFields=n(61),o.keyValue=r.keyValue,o.network=n(31),o.reflect=n(69),o.string=n(70),e.exports=o},function(e,t,n){e.exports=n(52)},function(e,t,n){var r=n(1),o=n(27),i={mtName:function(){return o.name},mtVersion:function(){return o.version}},s={attachDelegateInfo:function(e){r.reflect.extend(e,i)}};e.exports=s},function(e,t,n){var r,o,i=n(5),s=n(15),a=n(6),c=n(31),l=n(1);i.environment.setDelegate(s),i.logger.setDelegate(a),i.network.setDelegate(c),l.reflect.attachMethods(i,l.config,i),o={topic:function(){return r},setTopic:function(e){r=e}},e.exports=o},function(e,t,n){e.exports=n(34),e.exports.hbsHelper=n(37)},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},constrainedValue:function(e,t,n){var r=e&&e.hasOwnProperty(n)?e[n]:null;return o.applyConstraintRules(r,t)},applyConstraintRules:function(e,t){var n=e;return t&&t.blacklisted&&(n=null),n}};e.exports=o},function(e,t){var n={hostname:function(e){var t,r;return e=e||"",t=n.withoutParams(e).split("/"),r="",(r=-1===e.indexOf("//")?t[0]:t[2]).substring(r.indexOf("@")+1).split(":")[0]},mainDomain:function(e){var t=n.hostname(e).split("."),r=t[t.length-1],o=t[t.length-2],i=2;return r&&2===r.length&&o&&(2===o.length||o in n.reservedCCSLDs())&&(i=3),t.slice(-1*i).join(".")},reservedCCSLDs:function(){return{com:!0,org:!0,net:!0,edu:!0,gov:!0}},withoutParams:function(e){return(e=e||"").split("?")[0]}};e.exports=n},function(e,t,n){n(6);var r=n(1),o=["The function metrics.system.environment.","placeholder","() must be overridden with a platform-specific delegate function. If you have no data for this field, have your delegate return null or undefined (no 'return')"],i={setDelegate:function(e){return r.cookies.setDelegate(e),r.reflect.attachDelegate(this,e)},app:function(){throw o[1]=r.reflect.functionName(),o.join("")},appVersion:function(){throw o[1]=r.reflect.functionName(),o.join("")},capacityData:function(){throw o[1]=r.reflect.functionName(),o.join("")},capacityDataAvailable:function(){throw o[1]=r.reflect.functionName(),o.join("")},capacityDisk:function(){throw o[1]=r.reflect.functionName(),o.join("")},capacitySystem:function(){throw o[1]=r.reflect.functionName(),o.join("")},capacitySystemAvailable:function(){throw o[1]=r.reflect.functionName(),o.join("")},connectionType:function(){throw o[1]=r.reflect.functionName(),o.join("")},cookieOwnerObject:function(){throw o[1]=r.reflect.functionName(),o.join("")},dsId:function(){throw o[1]=r.reflect.functionName(),o.join("")},environmentBuild:function(){},environmentDataCenter:function(){},environmentInstance:function(){},hardwareFamily:function(){},hardwareModel:function(){},hostApp:function(){throw o[1]=r.reflect.functionName(),o.join("")},hostAppVersion:function(){},os:function(){},osBuildNumber:function(){},osLanguages:function(){},osVersion:function(){throw o[1]=r.reflect.functionName(),o.join("")},pageUrl:function(){throw o[1]=r.reflect.functionName(),o.join("")},parentPageUrl:function(){},pixelRatio:function(){throw o[1]=r.reflect.functionName(),o.join("")},resourceRevNum:function(){throw o[1]=r.reflect.functionName(),o.join("")},screenHeight:function(){throw o[1]=r.reflect.functionName(),o.join("")},screenWidth:function(){throw o[1]=r.reflect.functionName(),o.join("")},storeFrontHeader:function(){throw o[1]=r.reflect.functionName(),o.join("")},userAgent:function(){throw o[1]=r.reflect.functionName(),o.join("")},userType:function(){throw o[1]=r.reflect.functionName(),o.join("")},windowInnerHeight:function(){throw o[1]=r.reflect.functionName(),o.join("")},windowInnerWidth:function(){throw o[1]=r.reflect.functionName(),o.join("")},windowOuterHeight:function(){throw o[1]=r.reflect.functionName(),o.join("")},windowOuterWidth:function(){throw o[1]=r.reflect.functionName(),o.join("")},localStorageObject:r.storage.localStorageObject,sessionStorageObject:r.storage.sessionStorageObject};e.exports=i},function(e,t,n){var r,o=n(10),i=n(5),s={};for(r in s.configSources=i.defaultConfig(),s.environment=n(15),s.eventRecorder=n(71),s.logger=n(6),s)o.attachDelegateInfo(s[r]);e.exports=s},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(7),o={deResNumber:function(e,t,n){var o,i=void 0;return r.isDefined(e)&&(r.isDefined(t)||(t=1048576),r.isDefined(n)||(n=2),r.isNumber(e)&&r.isNumber(t)&&t>0&&r.isInteger(n)&&n>=0?(o=Math.pow(10,n),i=Math[e>0?"floor":"ceil"](e/t/o)*o):i=NaN),i}};e.exports=o},function(e,t){var n={},r={},o=function(e){var t={};return"function"==typeof e.mtName&&"function"==typeof e.mtVersion&&(t.name=e.mtName(),t.version=e.mtVersion()),t},i=function(e){var t;return"function"==typeof e.mtName&&"function"==typeof e.mtVersion&&(t=e.mtName()+e.mtVersion()),t},s={storeDelegateInfo:function(e,t){var s=i(e),a=i(t);s&&a&&(n[a]||(n[a]=o(t)),n[s]||(n[s]=o(e),r[s]={}),n[s].delegates?r[s][a]||n[s].delegates.push(n[a]):n[s].delegates=[n[a]],r[s][a]=!0)},getStoredDelegateObject:function(e){return n[i(e)]}};e.exports=s},function(e,t,n){(function(t){var n={startsWith:function(e,t,n){var r=!1;return e&&t&&(e=e.substr(0,t.length),n&&(e=e.toLowerCase(),t=t.toLowerCase()),r=0===e.indexOf(t)),r},endsWith:function(e,t,n){var r,o=!1;return e&&t&&(n&&(e=e.toLowerCase(),t=t.toLowerCase()),o=(r=e.length-t.length)>=0&&e.lastIndexOf(t)===r),o},trim:function(e,t,n){var r,o,i,s=null,a="\t\n\v\f\r             　\u2028\u2029​",c=new RegExp("^["+a+"]+"),l=new RegExp("["+a+"]+$");return e&&(n||t&&t!=a||!e.trim?(r=null,o=null,i=null,t&&void 0!==t?(r="["+(t=t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",o=new RegExp("^"+r+"+"),i=new RegExp(r+"+$")):(r=a,o=c,i=l),s=e.replace(o,"").replace(i,"")):s=e.trim()),s},snakeCaseToCamelCase:function(e,t){var n,r,o,i="";if(e)for(n=e.toLowerCase().split("_"),o=0;o<n.length;o++)r=n[o][0],(0!==o||t)&&(r=r.toUpperCase()),i+=r+n[o].slice(1);return i},snakeCaseToUpperCamelCase:function(e){return n.snakeCaseToCamelCase(e,!0)},paramString:function(e){var t,n,r="",o="",i=!0;for(t in e)((n=e[t])||0===n||!1===n)&&(r+=o+t+"="+encodeURIComponent(n),i&&(o="&",i=!1));return r},versionStringFromUserAgent:function(e,t){var n,r=null;return t=t||"\\S+",(n=new RegExp("\\b"+t+"/(\\S+)\\b","i").exec(e))&&n[1]&&(r=n[1]),r},requestId:function(e){var t=Date.now(),n=Math.floor(1e5*Math.random());return e+"z"+(t=t.toString(36).toUpperCase())+"z"+n.toString(36).toUpperCase()},uuid:function(e){var t,r,o,i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",s="";for(r=0,o=i.length;r<o;r++)s+="x"===(t=i.charAt(r))?n.randomHexCharacter(e):"y"===t?n.randomHexCharacter(e,"8","b"):t;return s},randomHexCharacter:function(e,r,o){var i,s=t.crypto||t.msCrypto;return i=e?(16*e()|0).toString(16):s&&s.getRandomValues?(15&s.getRandomValues(new Uint8Array(1))[0]).toString(16):s&&s.randomBytes?s.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),r&&o&&(i<r||i>o)&&(i=n.randomHexCharacter(e,r,o)),i},weakUUID:function(){return n.uuid()},convertNumberToBaseAlphabet:function(e,t){var n,r,o,i="",s=t.length;if(s<=36)i=e.toString(s).toUpperCase();else{for(o=[];e>0;)n=e%s,r=t.charAt(n),o.push(r),e=(e-n)/s;i=o.reverse().join("")}return""===i&&(i="0"),i},base10Alphabet:"0123456789"};n.base16Alphabet=n.base10Alphabet+"ABCDEF",n.base36Alphabet=n.base10Alphabet+"ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.base61Alphabet=n.base36Alphabet+"abcdefghijklmnopqrstuvwxy",n.base62Alphabet=n.base61Alphabet+"z",e.exports=n}).call(this,n(17))},function(e,t){var n={_valueForKeyPath:function(e,t,n){var r,o,i,s=t;if(e&&t)for(r=e.split("."),o=0;s&&o<r.length;o++)!s[i=r[o]]&&n&&(s[i]={}),s=s[i]?s[i]:null;return s},valueForKeyPath:function(e){var t,n,r,o=null;if(e&&arguments.length>1)for(n=(t=this.sourcesArray(Array.prototype.slice.call(arguments,1))).length-1;n>=0&&(r=t[n],!(o=this._valueForKeyPath(e,r)));n--);return o},createObjectAtKeyPath:function(e,t){return this._valueForKeyPath(e,t,!0)},sourcesArray:function(e){var t,n,r=[],o=[];for(o=o.concat(e),arguments&&arguments.length>1&&(o=o.concat(Array.prototype.slice.call(arguments,1))),t=0;t<o.length;t++)n=o[t],r=r.concat(n);return r}};e.exports=n},function(e,t,n){var r=n(1),o={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(e){return r.reflect.attachDelegate(this,e)},execute:function(e,t,n){var r,i,s,a,c,l=e.levelStringToIntMap[t];if(e.level()!==e.NONE&&e.level()<=l){if(r=Array.prototype.slice.call(n),i=o.nonFlagLogArguments(r),c=(a=(s=o.logOptions(e,l,r)).includeCallStack?(new Error).stack:null)?i.concat("\n"+a):i,e[t]._lastLog=c,s.mirrorToServer&&o.sendToServer(e,t,i,a),s.throwInsteadOfPrint)throw new Error(i.toString());s.suppressClientOutput||(console[t]?console[t].apply(console,c):console.log.apply(console,c))}},isFlagObject:function(e){return e&&e===o.flagArguments[e.constructor.name]},nonFlagLogArguments:function(e){return e.filter(function(e){return!o.isFlagObject(e)})},logOptions:function(e,t,n){var i,s={};return n.forEach(function(e){o.isFlagObject(e)&&(i=r.string.snakeCaseToCamelCase(e.constructor.name),s[i]=!0)}),r.reflect.isFunction(e.mirrorToServerLevel)&&e.mirrorToServerLevel()!==e.NONE&&e.mirrorToServerLevel()<=t&&(s.mirrorToServer=!0),e.throwLevel()!==e.NONE&&e.throwLevel()<=t&&(s.throwInsteadOfPrint=!0),s},sendToServer:function(e,t,n,r){}};e.exports=o},function(e,t,n){e.exports=n(55)},function(e,t,n){var r={eventFields:n(57),url:n(14)};e.exports=r},function(e,t,n){var r={base:n(13),clientId:n(58),parentPageUrl:n(59)};e.exports=r},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},localStorageObject:r.storage.localStorageObject,sessionStorageObject:r.storage.sessionStorageObject};e.exports=o},function(e,t){e.exports={version:"6.11.2",name:"mt-metricskit"}},function(e,t,n){e.exports=n(64)},function(e,t,n){var r=n(9).loggerNamed("mt-event-queue");e.exports=r},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},makeAjaxRequest:r.network.makeAjaxRequest};e.exports=o},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},makeAjaxRequest:r.network.makeAjaxRequest};e.exports=o},function(e,t,n){var r=n(1),o=n(4),i=[],s={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["clientCorrelationKey","eventType","eventVersion","extRefUrl","hostApp","refApp","refUrl","requestStartTime","responseStartTime","responseEndTime","pageHistory","pageLoadTime","pageRenderTime","searchFilters","searchTerm"]},clientCorrelationKey:function(e){return e&&e.clientCorrelationKey||r.string.weakUUID()},eventType:function(e){return"page"},eventVersion:function(e){return e&&e.eventVersion||1},pageHistory:function(e){var t,n;return(e=e||{}).pageHistory?t=e.pageHistory:(t=i.slice(0),(n=e.page)&&(i.length>=5&&i.shift(),i.push(n))),t}};e.exports=s},,function(e,t,n){e.exports.its={},n(35)(e.exports),n(36)(e.exports)},function(e,t){e.exports=function(e){var t=e.its;t.isDefined=function(e){return void 0!==e},void 0===t.string&&(t.string={}),t.string.replace=function(e,t,n){return e?("string"!=typeof e&&(e+=""),e.split(t).join(n)):e}}},function(e,t){e.exports=function(e){var t=e.its,n=e.iTSLocalization={};n._strings={},n.hasLocalizedValue=function(e){var r=n._strings[e];return t.isDefined(r)},n.isLocalized=function(e){var r=n._strings[e];return!(!t.isDefined(r)||-1!==e.indexOf(".")&&(r===e||0===r.indexOf("**")&&r.lastIndexOf("**")===r.length-2)&&(console.error("unlocalized key in keys dictionary",e),1))},t.loc=function(e,t){var r=n._strings[e];return void 0===r&&(r=e),t&&(r=n.replaceTokens(r,t)),"undefined"==typeof itms&&(r=n.replaceMarkupTokens(r,t)),r},t.locDate=function(e){var t,n,r,o,i;return e?((t=e.length)>10?n=new Date(e):(r=t>=4?e.slice(0,4):0,o=t>=7?e.slice(5,7):1,i=t>=10?e.slice(8,10):1,n=new Date(r,o-1,i)),formatDate(n)):""},t.locWithMarkupTokens=function(e,r){return n.replaceMarkupTokens(t.loc(e,r),r)},n._strings._showLocKeys&&(t.loc=function(e){return"+"+e+"+"}),t.locWithCount=function(e,r,o){var i,s,a=null;return 0==r&&(i=e+".zero",n.isLocalized(i)&&(a=i)),null===a&&(a=e,"other"!==(s=n.pluralCategory(r))&&(i=e+"."+s,n.isLocalized(i)&&(a=i))),o||(o={}),t.isDefined(o.count)||(o.count=t.formatNumber(r)),t.isDefined(o.number)||(o.number=t.formatNumber(r)),t.loc(a,o)},n.replaceTokens=function(e,n){var r,o;if(n)for(r in n)n.hasOwnProperty(r)&&(o="@@"+r+"@@",e=t.string.replace(e,o,n[r]));return e},n.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"©"},n.replaceMarkupTokens=function(e,t){var r,o,i;if(e.indexOf("##")>-1){if(t)for(r in t)n.markupParams[r.toString()]=t[r];for(o in n.markupParams)i="##"+o+"##",e=e.replace(new RegExp(i,"gi"),n.markupParams[o]);e=e.replace(/##([^##]+)##/gi,"<$1>")}return e},n.localizedResourceUrlForPathKey=function(e,n){return void 0===n&&(n=/https:/.test(window.location.protocol)),(n?"https://s.mzstatic.com":"http://r.mzstatic.com")+t.loc(e)},"undefined"!=typeof itms&&"undefined"!=typeof formatNumber?t.formatNumber=function(e){return formatNumber(Number(e))}:t.formatNumber=function(e){var t,r,o,i,s;for(void 0===n.decimalSeparator&&(void 0===(t=n._strings._decimalSeparator)&&(t="."),n.decimalSeparator=t,void 0===(t=n._strings._thousandsSeparator)&&(t=","),n.thousandsSeparator=t),r=parseFloat(e).toString().split("."),o=n.thousandsSeparator,s=(i=r[0].split("")).length-3;s>0;s-=3)i.splice(s,0,o);return r[0]=i.join(""),r.join(n.decimalSeparator)},n._pluralCategoryDefault=function(e){return"other"},n._pluralCategoryOne=function(e){return 1==e?"one":"other"},n._pluralCategoryArabic=function(e){var t,n=e>>0;return n!=e?"other":0===n?"zero":1===n?"one":2===n?"two":(t=n%100)>=11?"many":t>=3?"few":"other"},n._pluralCategoryFrench=function(e){return e<2&&e>=0?"one":"other"},n._pluralCategoryHebrew=function(e){var t=e>>0;return t!=e?"other":1===t?"one":2===t?"two":0==t%10&&t>10?"many":"other"},n._pluralCategoryPolish=function(e){var t,n,r=e>>0;return r!=e?"other":1===r?"one":(t=r%10)<=4&&t>=2&&((n=r%100)>14||n<12)?"few":"many"},n._pluralCategoryRomanian=function(e){var t,n=e>>0;return n!=e?"few":0===n?"few":1===n?"one":(t=e%100)<=19&&t>=1?"few":"other"},n._pluralCategoryRussian=function(e){var t,n,r=e>>0;return r!=e?"other":(t=r%10)>=5||0==t?"many":(n=r%100)<=14&&n>=11?"many":1==t?"one":"few"},n._pluralCategoryFnByLanguage={zh:n._pluralCategoryDefault,id:n._pluralCategoryDefault,ja:n._pluralCategoryDefault,ko:n._pluralCategoryDefault,ms:n._pluralCategoryDefault,th:n._pluralCategoryDefault,vi:n._pluralCategoryDefault,en:n._pluralCategoryOne,ca:n._pluralCategoryOne,da:n._pluralCategoryOne,nl:n._pluralCategoryOne,de:n._pluralCategoryOne,el:n._pluralCategoryOne,fi:n._pluralCategoryOne,hu:n._pluralCategoryOne,it:n._pluralCategoryOne,nb:n._pluralCategoryOne,no:n._pluralCategoryOne,pt:n._pluralCategoryOne,es:n._pluralCategoryOne,sv:n._pluralCategoryOne,tr:n._pluralCategoryOne,ar:n._pluralCategoryArabic,fr:n._pluralCategoryFrench,iw:n._pluralCategoryHebrew,pl:n._pluralCategoryPolish,ro:n._pluralCategoryRomanian,ru:n._pluralCategoryRussian},n.pluralCategory=function(e){var r,o,i;return t.serverData&&t.serverData.constants?r=t.serverData.constants.languageCode:"undefined"!=typeof itms&&itms.getBag&&(r=(r=(o=itms.getBag())&&o.language||"en").slice(0,2)),(i=n._pluralCategoryFnByLanguage[r])?i(e):(console.warn("missing plural category function for: "+r),"other")},t.updateLocale=function(e){n._strings=e}}},function(e,t,n){e.exports=function(e,t){return n(38).its.loc(e,t)},"undefined"!=typeof Handlebars&&Handlebars.registerHelper("loc",helper)},function(e,t){window.iTSLocalization||(iTSLocalization={}),window.iTSLocalization._strings||(iTSLocalization._strings={}),iTSLocalization.hasLocalizedValue=function(e){var t=iTSLocalization._strings[e];return its.isDefined(t)},its.loc=function(e,t){var n=iTSLocalization._strings[e];return void 0===n&&(n=e),t&&(n=iTSLocalization.replaceTokens(n,t)),"undefined"==typeof itms&&(n=iTSLocalization.replaceMarkupTokens(n,t)),n},its.locDate=function(e){var t,n,r,o,i;return e?((t=e.length)>10?n=new Date(e):(r=t>=4?e.slice(0,4):0,o=t>=7?e.slice(5,7):1,i=t>=10?e.slice(8,10):1,n=new Date(r,o-1,i)),formatDate(n)):""},its.locWithMarkupTokens=function(e,t){return iTSLocalization.replaceMarkupTokens(its.loc(e,t),t)},iTSLocalization._strings._showLocKeys&&(its.loc=function(e){return"+"+e+"+"}),its.locWithCount=function(e,t,n){var r,o,i=null;return 0==t&&(r=e+".zero",iTSLocalization.hasLocalizedValue(r)&&(i=r)),null===i&&(i=e,"other"!==(o=iTSLocalization.pluralCategory(t))&&(r=e+"."+o,iTSLocalization.hasLocalizedValue(r)&&(i=r))),n||(n={}),its.isDefined(n.count)||(n.count=its.formatNumber(t)),its.loc(i,n)},iTSLocalization.replaceTokens=function(e,t){var n,r;if(t)for(n in t)t.hasOwnProperty(n)&&(r="@@"+n+"@@",e=its.string.replace(e,r,t[n]));return e},iTSLocalization.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"©"},iTSLocalization.replaceMarkupTokens=function(e,t){var n,r,o;if(e.indexOf("##")>-1){if(t)for(n in t)iTSLocalization.markupParams[n.toString()]=t[n];for(r in iTSLocalization.markupParams)o="##"+r+"##",e=e.replace(new RegExp(o,"gi"),iTSLocalization.markupParams[r]);e=e.replace(/##([^##]+)##/gi,"<$1>")}return e},iTSLocalization.localizedResourceUrlForPathKey=function(e,t){return void 0===t&&(t=/https:/.test(window.location.protocol)),(t?"https://s.mzstatic.com":"http://r.mzstatic.com")+its.loc(e)},"undefined"!=typeof itms&&"undefined"!=typeof formatNumber?its.formatNumber=function(e){return formatNumber(Number(e))}:its.formatNumber=function(e){var t,n,r,o,i;for(void 0===iTSLocalization.decimalSeparator&&(void 0===(t=iTSLocalization._strings._decimalSeparator)&&(t="."),iTSLocalization.decimalSeparator=t,void 0===(t=iTSLocalization._strings._thousandsSeparator)&&(t=","),iTSLocalization.thousandsSeparator=t),n=parseFloat(e).toString().split("."),r=iTSLocalization.thousandsSeparator,i=(o=n[0].split("")).length-3;i>0;i-=3)o.splice(i,0,r);return n[0]=o.join(""),n.join(iTSLocalization.decimalSeparator)},iTSLocalization._pluralCategoryDefault=function(e){return"other"},iTSLocalization._pluralCategoryOne=function(e){return 1==e?"one":"other"},iTSLocalization._pluralCategoryArabic=function(e){var t,n=e>>0;return n!=e?"other":0===n?"zero":1===n?"one":2===n?"two":(t=n%100)>=11?"many":t>=3?"few":"other"},iTSLocalization._pluralCategoryFrench=function(e){return e<2&&e>=0?"one":"other"},iTSLocalization._pluralCategoryHebrew=function(e){var t=e>>0;return t!=e?"other":1===t?"one":2===t?"two":0==t%10&&t>10?"many":"other"},iTSLocalization._pluralCategoryPolish=function(e){var t,n,r=e>>0;return r!=e?"other":1===r?"one":(t=r%10)<=4&&t>=2&&((n=r%100)>14||n<12)?"few":"many"},iTSLocalization._pluralCategoryRomanian=function(e){var t,n=e>>0;return n!=e?"few":0===n?"few":1===n?"one":(t=e%100)<=19&&t>=1?"few":"other"},iTSLocalization._pluralCategoryRussian=function(e){var t,n,r=e>>0;return r!=e?"other":(t=r%10)>=5||0==t?"many":(n=r%100)<=14&&n>=11?"many":1==t?"one":"few"},iTSLocalization._pluralCategoryFnByLanguage={zh:iTSLocalization._pluralCategoryDefault,id:iTSLocalization._pluralCategoryDefault,ja:iTSLocalization._pluralCategoryDefault,ko:iTSLocalization._pluralCategoryDefault,ms:iTSLocalization._pluralCategoryDefault,th:iTSLocalization._pluralCategoryDefault,vi:iTSLocalization._pluralCategoryDefault,en:iTSLocalization._pluralCategoryOne,ca:iTSLocalization._pluralCategoryOne,da:iTSLocalization._pluralCategoryOne,nl:iTSLocalization._pluralCategoryOne,de:iTSLocalization._pluralCategoryOne,el:iTSLocalization._pluralCategoryOne,fi:iTSLocalization._pluralCategoryOne,hu:iTSLocalization._pluralCategoryOne,it:iTSLocalization._pluralCategoryOne,nb:iTSLocalization._pluralCategoryOne,no:iTSLocalization._pluralCategoryOne,pt:iTSLocalization._pluralCategoryOne,es:iTSLocalization._pluralCategoryOne,sv:iTSLocalization._pluralCategoryOne,tr:iTSLocalization._pluralCategoryOne,ar:iTSLocalization._pluralCategoryArabic,fr:iTSLocalization._pluralCategoryFrench,iw:iTSLocalization._pluralCategoryHebrew,pl:iTSLocalization._pluralCategoryPolish,ro:iTSLocalization._pluralCategoryRomanian,ru:iTSLocalization._pluralCategoryRussian},iTSLocalization.pluralCategory=function(e){var t;if(its.serverData&&its.serverData.constants){if(t=iTSLocalization._pluralCategoryFnByLanguage[its.serverData.constants.languageCode])return t(e);its.Logger&&its.Logger.named("its-base-util").error("missing plural category function for: "+its.serverData.constants.languageCode,!0)}return"other"}},function(e,t,n){var r,o,i,s,a=n(5),c=n(23),l=n(1),u=n(8),p=n(16),d=n(11),f=n(72),h=n(10);u=n(8),o=function(e){l.reflect.attachMethods(e,l.config,e),l.reflect.attachMethods(e,c.config,e),h.attachDelegateInfo(e)},i=function(){l.reflect.attachMethods(a,c.config,a),c.system.environment.setDelegate(p.environment)},s={_utSetInitCalled:function(e){r=e},system:p,config:a.defaultConfig(),eventHandlers:f,utils:u,init:function(e,t,n,i,c){if(!r){r=!0,n&&(l.reflect.setDelegates(f,n),l.reflect.setDelegates(p,n),l.reflect.setDelegates(u,n)),d.setTopic(e);var h=a.createConfig(e,t,i,c);o(h),l.reflect.copyDelegatedFunctions(s.config,h),s.config=h,s.system.configSources=s.config}}},o(a.defaultConfig()),i(),e.exports=s},function(e,t,n){var r=n(41);e.exports=r},function(e,t,n){var r=n(1),o=n(50),i=n(51),s=n(54),a={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"https://xp.apple.com/config/1/report",constraints:{profiles:{strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc","xp_ab","xp_abc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"https://xp.apple.com/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},c={},l=function(e){this._topic=e,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+a.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+a.compoundSeparator+this._topic};l.createConfig=function(e,t,n,r){var o=c[e=e||"noTopicConfig"];return o||(o=new l(e),c[e]=o,"noTopicConfig"!==e&&o.initialize(t,n,r)),o},l.defaultConfig=function(){return l.createConfig()},l.value=function(e,t){var n=t&&c[t]||l.defaultConfig();return n.value.call(n,e)},l.environment=o,l.logger=i,l.network=s,l.prototype._defaults=function(){return a},l.prototype._setInitialized=function(e){this._initialized=e},l.prototype._setShowedDebugWarning=function(e){this._showedDebugWarning=e},l.prototype._setShowedNoProvidedSourceWarning=function(e){this._showedNoProvidedSourceWarning=e},l.prototype.setDelegate=function(e){return r.reflect.attachDelegate(this,e)},l.prototype.topic=function(){return this._topic},l.prototype.configUrl=function(){var e=this.value("configBaseUrl");return"noTopicConfig"!==this._topic?e+="/"+this.topic():l.logger.error("config.configUrl(): Topic must be provided"),e},l.prototype.sources=function(){},l.prototype.value=function(e){var t,n=this.cachedSource(),o=this.serviceSource(),i=this.sources(),s=this.debugSource(),c=n||o||i||s;return i||o||e in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,l.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),s&&(this._showedDebugWarning||(this._showedDebugWarning=!0,l.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),r.reflect.isArray(i)||(i=[i]),t=0===e.indexOf("blacklisted")?c?[n,o,i,s]:[a]:[a,n,o,i,s],r.keyValue.valueForKeyPath.apply(r.keyValue,[e].concat(t))},l.prototype.setDebugSource=function(e){return this._debugSource=e||null,r.storage.saveObjectToStorage(l.environment.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},l.prototype.debugSource=function(){return this._debugSource||(this._debugSource=r.storage.objectFromStorage(l.environment.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},l.prototype.setCachedSource=function(e){return this._cachedSource=e||null,r.storage.saveObjectToStorage(l.environment.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},l.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=r.storage.objectFromStorage(l.environment.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},l.prototype.setServiceSource=function(e){return this._serviceSource=e,this._serviceSource},l.prototype.serviceSource=function(){return this._serviceSource},l.prototype.fetchConfig=function(e,t,n){n=n||function(){},r.backoff.exponentialBackoff(s.makeAjaxRequest.bind(s,e,"GET",null),function(e){var r;try{e=JSON.parse(e),r=!0}catch(e){n.call(n,e)}r&&t&&t.call(t,e)},n)},l.prototype.initialize=function(e,t,n){var r,o,i;t=t||function(){},r=function(){this._initialized=!0,t.call(t)}.bind(this),e?(this.setDelegate({sources:e}),r()):(this.setCachedSource(this.cachedSource()),o=this.configUrl(),i=function(e){this.setCachedSource(e),this.setServiceSource(e),r()}.bind(this),this.fetchConfig(o,i,n))},l.prototype.initialized=function(){return this._initialized},e.exports=l},function(e,t,n){var r={};r.backoff=n(43),r.config=n(44),r.cookies=n(45),r.delegatesInfo=n(19),r.eventFields=n(46),r.keyValue=n(21),r.network=n(47),r.number=n(18),r.reflect=n(7),r.sampling=n(48),r.storage=n(49),r.string=n(20),r.optionValueFromStoreFrontHeader=function(e,t){var n,o=null,i="string"==typeof e?e.split(" "):[],s=r.string.endsWith(t,":")?t:t+":";for(n=0;!o&&n<i.length;++n)0===i[n].search(s)&&(o=i[n].slice(s.length));return o},e.exports=r},function(e,t){var n,r=1500,o=100,i=2,s=function(e,t,n){this.delay=e||o,this.maxWait="number"==typeof t?t:r,this.factor=n||i,this.timeWaited=0};s.prototype.nextDelay=function(){var e=null,t=this.maxWait-this.timeWaited;return t>0&&(this.delay=Math.min(this.delay,t),this.timeWaited+=this.delay),(0===this.maxWait||t>0)&&(e=this.delay,this.delay=this.delay*this.factor),e},n={_backoff:function(e,t,r,o){t.call(t,r,function(){var i=e.nextDelay();i?setTimeout(n._backoff.bind(n,e,t,r,o),i):o.apply(o,arguments)})},exponentialBackoff:function(e,t,r,o,i,a){var c=new s(o,i,a);n._backoff(c,e,t,r)}},e.exports=n},function(e,t,n){var r=n(18),o=(n(7),{disabled:function(e){return!!this.value("disabled",e)},blacklistedEvents:function(e){return this.value("blacklistedEvents",e)||[]},blacklistedFields:function(e){return this.value("blacklistedFields",e)||[]},removeBlacklistedFields:function(e,t){var n,r,i;if(e)for(n=o.blacklistedFields.call(this,t),r=0;r<n.length;r++)(i=n[r])&&i in e&&delete e[i];return e},metricsDisabledOrBlacklistedEvent:function(e,t){return o.disabled.call(this,t)||!!e&&o.blacklistedEvents.call(this,t).indexOf(e)>-1},deResFields:function(e){return this.value("deResFields",e)||[]},applyDeRes:function(e,t){var n;return e&&o.deResFields.call(this,t).forEach(function(t){(n=t.fieldName)in e&&(e[n]=r.deResNumber(e[n],t.magnitude,t.significantDigits))}),e}});e.exports=o},function(e,t,n){var r=n(20),o=n(7),i={EXPIRE_NOW:-1,EXPIRE_SESSION:null,EXPIRE_ONE_SECOND:1,EXPIRE_ONE_MINUTE:60*this.EXPIRE_ONE_SECOND,EXPIRE_ONE_HOUR:60*this.EXPIRE_ONE_MINUTE,EXPIRE_ONE_DAY:24*this.EXPIRE_ONE_HOUR,EXPIRE_ONE_WEEK:7*this.EXPIRE_ONE_DAY,EXPIRE_ONE_MONTH:31*this.EXPIRE_ONE_DAY,EXPIRE_ONE_YEAR:365*this.EXPIRE_ONE_DAY,EXPIRE_ONE_SIDEREAL_YEAR:365.25*this.EXPIRE_ONE_DAY,EXPIRE_SIX_MONTHS:180*this.EXPIRE_ONE_DAY,setDelegate:function(e){return o.attachDelegate(this,e)},cookie:function(){var e;return"undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes?e=iTunes:"undefined"!=typeof itms&&void 0!==itms.cookie?e=itms:"undefined"!=typeof document&&(e=document),e?e.cookie:void 0},cookieOwnerObject:function(){if("undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes)return iTunes;if("undefined"!=typeof itms&&void 0!==itms.cookie)return itms;if("undefined"!=typeof document)return document;throw"cookies.cookieOwnerObject: No owning object"},get:function(e){var t=this.getUnescaped(e);return t&&(t=unescape(t)),t},getUnescaped:function(e){var t,n,o,i,s=null,a=this._getRaw();if(a&&e)for(n=(t=a.split(";")).length-1;!s&&n>=0;n--)(i=(o=t[n]).indexOf("="))>0&&(i+1==o.length?s="":r.trim(o.substring(0,i))==e&&(s=r.trim(o.substring(i+1))));return s},remove:function(e,t){return this.setUnescaped(e,".",this.EXPIRE_NOW,null,t)},_getRaw:function(){var e=this.cookie();return o.isString(e)||(e=this.cookieOwnerObject().cookie),e||""}};e.exports=i},function(e,t,n){var r=n(21),o=n(7),i={mergeAndCleanEventFields:function(e){var t,n,r,i=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),s=[];for(t=0;t<i.length;t++)if((n=i[t])&&n.constructor===Array)for(r=0;r<n.length;r++)s.push(n[r]);else s.push(n);return o.copyKeysAndValues.apply(this,s)},processMetricsData:function(e,t,n,r){var o,i,s,a,c=this.mergeAndCleanEventFields(r),l=c;if(e&&t){if(o={},n||(t=t.filter(function(e){return e in c})),t.length)for(i=0;i<t.length;i++)"function"==typeof(a=e[s=t[i]])&&(o[s]=a.call(e,c));l=this.mergeAndCleanEventFields(l,o)}return l},applyFieldsMap:function(e,t,n,i){var s,a,c,l,u,p,d;if(e&&t&&n)if(a={},s=r.valueForKeyPath(t,n,n.custom))if(o.isArray(s))for(l=0;l<s.length;++l)u=e[s[l]],o.isDefinedNonNull(u)&&(a[s[l]]=u);else if("object"==typeof s){for(p in s)for(l=0;l<s[p].length;++l)if(u=r.valueForKeyPath(s[p][l],e),o.isDefinedNonNull(u)){a[p]=u;break}}else c="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else c="metrics: unable to get "+t+" section from fieldsMap";else d=[],e||d.push("data"),t||d.push("sectionName"),n||d.push("fieldsMap"),c="metrics: missing argument(s): "+d.join(",")+" not provided to applyFieldsMap";return c&&o.isFunction(i)&&i(c),a}};e.exports=i},function(e,t,n){var r=n(7),o={makeAjaxGetRequest:function(e,t,n){this.makeAjaxRequest(e,"GET",null,t,n)},makeAjaxRequest:function(e,t,n,o,i,s){var a,c=new XMLHttpRequest;n=n||void 0,s=s||{},o=r.isFunction(o)?o:function(){},i=r.isFunction(i)?i:function(){},a=!1!==s.async,s.timeout&&a&&(c.timeout=s.timeout),c.onload=function(){c.status>=200&&c.status<300?o(c.response):i(new Error("XHR error: server responded with status "+c.status+" "+c.statusText),c.status)},c.onerror=function(){i(new Error("XHR error"))},c.open(t,e,a),c.withCredentials=!0,c.setRequestHeader("Content-type","application/json"),c.send(n)}};e.exports=o},function(e,t){var n={},r=function(e){n[e]&&(clearTimeout(n[e]),n[e]=null)},o={_utClearSessions:function(){for(var e in n)r(e)},lottery:function(e){return Math.random()<e},sessionSampled:function(e,t,i){var s,a;return n[e]?s=!0:((a=o.lottery(t))&&i>0&&(n[e]=setTimeout(r.bind(null,e),i)),s=a),s},isSampledIn:function(e,t,n,r,i){return t||o.sessionSampled(e,n,r)||o.lottery(i)}};e.exports=o},function(e,t){var n=function(e){var t=null,n=!1;return function(){return e?t=e:(n||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),n=!0),t||(t={storage:{},getItem:function(e){return this.storage[e]},setItem:function(e,t){this.storage[e]=t},removeItem:function(e){delete this.storage[e]}})),t}},r={localStorageObject:n("undefined"!=typeof localStorage?localStorage:null),sessionStorageObject:n("undefined"!=typeof sessionStorage?sessionStorage:null),saveObjectToStorage:function(e,t,n){var r=null;if(n)try{e.setItem(t,JSON.stringify(n)),r=n}catch(e){}else r=e.removeItem(t);return r},objectFromStorage:function(e,t){var n=null,r=e.getItem(t);if(r)try{n=JSON.parse(r)}catch(e){n=void 0}return n}};e.exports=r},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},localStorageObject:r.storage.localStorageObject,sessionStorageObject:r.storage.sessionStorageObject};e.exports=o},function(e,t,n){var r=n(9).loggerNamed("mt-client-config");e.exports=r},function(e,t,n){var r=n(53),o=n(22);r.utils=o,e.exports=r},function(e,t,n){var r=n(1),o=n(22),i={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},s={loggerName:"defaultLogger",level:i.INFO,throwLevel:i.NONE},a={},c=function(e){this._loggerName=e,this._level,this._throwLevel};c.loggerNamed=function(e){var t=a[e=e||s.loggerName];return t||(t=new c(e),a[e]=t),t},c.level=function(){return s.level},c.throwLevel=function(){return s.throwLevel},r.reflect.extend(c.prototype,i),r.reflect.extend(c.prototype,o.flagArguments),c.prototype.setDelegate=function(e){return r.reflect.attachDelegate(this,e)},c.prototype.loggerName=function(){return this._loggerName},c.prototype.levelParameterAsInt=function(e){var t,n=null;return r.reflect.isString(e)?t=this.levelStringToIntMap[e.toLowerCase()]:r.reflect.isNumber(e)&&(t=e),t>=this.MIN_LEVEL&&t<=this.MAX_LEVEL&&(n=t),n},c.prototype.setLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._level=t)},c.prototype.setThrowLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._throwLevel=t)},c.prototype.level=function(){var e=this._level;return r.reflect.isNumber(e)?e:c.level()},c.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},c.prototype.throwLevel=function(){var e=this._throwLevel;return r.reflect.isNumber(e)?e:c.throwLevel()},c.prototype.debug=function(){o.execute(this,"debug",arguments)},c.prototype.info=function(){o.execute(this,"info",arguments)},c.prototype.warn=function(){o.execute(this,"warn",arguments)},c.prototype.error=function(){o.execute(this,"error",arguments)},c.prototype.lastLog=function(e){return this[e]?this[e]._lastLog:null},e.exports=c},function(e,t,n){var r=n(1),o={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},makeAjaxRequest:r.network.makeAjaxRequest};e.exports=o},function(e,t,n){var r={config:n(56),fieldHandlers:n(25),system:n(60),utils:n(24)};e.exports=r},function(e,t,n){var r=n(24).eventFields,o={constraintProfile:function(e){var t;return this.createConfig&&(t=this.createConfig(e)),t&&t.constraintProfile?t.constraintProfile(e):this.value("constraints.defaultProfile",e)},constraintsForEvent:function(e,t){var n="constraints.profiles."+this.constraintProfile(t),o=this.value(n),i=null;return o&&o.precedenceOrderedRules&&(i=o.precedenceOrderedRules.reduce(function(t,n){return r.eventMatchesRule(e,n)&&(t=r.updateRules(t,n)),t},{})),i}};e.exports=o},function(e,t,n){var r=n(1),o=n(25),i={applyEventConstraints:function(e,t){return t&&t.fieldConstraints&&(e=i.applyFieldConstraints(e,t.fieldConstraints)),e},applyFieldConstraints:function(e,t){var n,i,s,a;if(t){for(a in n={},t)s=t[a],(e.hasOwnProperty(a)||!0===s.generateValue)&&(i=a in o?o[a].constrainedValue(e,s):o.base.constrainedValue(e,s,a),n[a]=i);for(a in n)e[a]=n[a];e=r.eventFields.mergeAndCleanEventFields(e)}return e},eventMatchesRule:function(e,t){var n=!1;return e&&t.filters&&("any"===t.filters?n=!0:r.reflect.isObject(t.filters)&&(n=i.eventMatchesNonEmptyFields(e,t.filters.nonEmptyFields)&&i.eventMatchesFieldValues(e,t.filters.valueMatches))),n},eventMatchesNonEmptyFields:function(e,t){var n=!1;return e&&(n=!t||!r.reflect.isArray(t)||t.every(function(t){return e.hasOwnProperty(t)&&r.reflect.isDefinedNonNullNonEmpty(e[t])})),n},eventMatchesFieldValues:function(e,t){var n=!1;return e&&(n=!(t&&r.reflect.isObject(t)&&!r.reflect.isEmptyObject(t))||Object.keys(t).every(function(n){var r=t[n];return e.hasOwnProperty(n)&&r.indexOf(e[n])>-1})),n},updateRules:function(e,t){var n,r,o=e||{};if(t&&t.fieldConstraints)for(n in o.fieldConstraints=o.fieldConstraints||{},t.fieldConstraints)for(r in o.fieldConstraints[n]=o.fieldConstraints[n]||{},t.fieldConstraints[n])o.fieldConstraints[n][r]=t.fieldConstraints[n][r];return o}};e.exports=i},function(e,t,n){var r=n(1),o=n(26),i=n(13),s=n(14),a={SCOPE_STRATEGIES:{ALL:"all",MAIN_DOMAIN:"mainDomain"},setDelegate:function(e){return r.reflect.attachDelegate(this,e)},constrainedValue:function(e,t){var n,s,c=e?e.clientId:null;return e&&t&&!r.reflect.isEmptyObject(t)&&!t.blacklisted&&(n=a.storageKey(e,t),(s=r.storage.objectFromStorage(o.localStorageObject(),n)||{}).value=a.clientIdString(s,t),s.expirationTime=a.expirationTime(t.expirationPeriod),r.storage.saveObjectToStorage(o.localStorageObject(),n,s),c=s.value),i.applyConstraintRules(c,t)},storageKey:function(e,t){return a.storageKeyPrefix()+"_"+a.scope(e,t)},storageKeyPrefix:function(){return"mtClientId"},scope:function(e,t){var n,r,o="";if(t&&(t.namespace&&(o+=t.namespace),t.scopeStrategy)){switch(t.scopeStrategy){case a.SCOPE_STRATEGIES.MAIN_DOMAIN:r=t.scopeFieldName,n=s.mainDomain(e[r])||"unknownDomain";break;case a.SCOPE_STRATEGIES.ALL:default:n=a.SCOPE_STRATEGIES.ALL}o.length&&(o+="_"),o+=n}return o},clientIdString:function(e,t){var n=e?e.value:null,r=n;return(!n||e.expirationTime<=Date.now())&&(r=a.generateId(t)),r},expirationTime:function(e){return e?Date.now()+e:null},generateId:function(e){var t=a.rawUUID(),n=null,o=null;return e&&(n=a.expirationTime(e.expirationPeriod),o=e.tokenSeparator),(a.generatedIdMetadata(n)+a.idTokenSeparator()+t||"").split(a.idTokenSeparator()).map(function(e){var t=parseInt(e,16);return r.string.convertNumberToBaseAlphabet(t,r.string.base61Alphabet)}).join(a.generatedIdSeparator(o))||"0"},generatedIdMetadata:function(e){var t=[a.generatedIdVersion()];return e&&t.push(e),t.map(function(e){return e.toString(16)}).join(a.idTokenSeparator())},rawUUID:function(){return r.string.uuid()},generatedIdVersion:function(){return 4},idTokenSeparator:function(){return"-"},generatedIdSeparator:function(e){return e||"z"}};e.exports=a},function(e,t,n){var r=n(1),o=n(13),i=n(14),s={SCOPES:{HOSTNAME:"hostname",FULL:"full",FULL_WITHOUT_PARAMS:"fullWithoutParams"},setDelegate:function(e){return r.reflect.attachDelegate(this,e)},constrainedValue:function(e,t){var n=e&&e.parentPageUrl?e.parentPageUrl:null,r=n;if(n&&t&&t.scope)switch(t.scope){case s.SCOPES.HOSTNAME:r=i.hostname(n);break;case s.SCOPES.FULL_WITHOUT_PARAMS:r=i.withoutParams(n);break;case s.SCOPES.FULL:}return o.applyConstraintRules(r,t)}};e.exports=s},function(e,t,n){var r={environment:n(26)};e.exports=r},function(e,t,n){var r=n(1),o=n(5),i=n(11),s=n(6),a={getIdType:function(e){var t=e.indexOf("."),n=o.value("compoundSeparator",i.topic());return(-1!==t?e.substring(0,t):"its")+n+"id"},processMetricsData:function(e,t,n,o,i,s){var a=[{pageId:n,pageType:o,pageContext:i}];return r.reflect.isArray(s)&&(a=a.concat(s)),r.eventFields.processMetricsData(e,t,!0,a)},applyFieldsMap:function(e,t){var n,a,c,l,u,p;if(e&&t)if(c={},n=o.value("fieldsMap",i.topic())||{},a=r.keyValue.valueForKeyPath(t,n,n.custom))if(Array.isArray(a))for(l=0;l<a.length;++l)e[a[l]]&&(c[a[l]]=e[a[l]]);else if("object"==typeof a){for(u in a)for(l=0;l<a[u].length;++l)if(p=r.keyValue.valueForKeyPath(a[u][l],e)){c[u]=p;break}}else s.error("mt-metricskit: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)");else s.error("mt-metricskit: unable to get fieldsMap from config-source");else e||s.error("mt-metricskit: No data provided to applyFieldsMap"),t||s.error("mt-metricskit: No sectionName provided to applyFieldsMap");return c},flattenImpressions:function(e,t){var n,a,c,l,u,p=[],d=t||1;if(e)for(e=function(e){var t,n,r={},o=[];if(e&&e[0]&&void 0!==e[0].index)for(n=0;n<e.length;++n)r[t=e[n].index]||(r[t]=!0,o.push(e[n]));return o}(e),u=0;u<e.length;u++){if("string"==typeof(n=e[u]).data)try{a=JSON.parse(n.data)}catch(e){l=decodeURIComponent(n.data);try{a=JSON.parse(l)}catch(t){s.error("mt-metricskit: non-JSON serialized data found on impression object. Cannot parse.",e)}}else a=n;a&&(a.impressionTimes=n.timestamps,a.impressionIndex=n.index,a.id&&!a.idType&&("genre"===n.kind?a.idType="label"+o.value("compoundSeparator",i.topic())+"id":a.idType=this.getIdType(a.id.toString())),n.parent&&void 0!==n.parent.impressionId&&(a.impressionParentId=n.parent.impressionId),a.impressionId=d,n.impressionId=d,++d,p.push(a),r.keyValue.valueForKeyPath("children.length",n)>0&&(c=this.flattenImpressions(n.children,d),p=p.concat(c),d+=c.length))}else s.warn("Fuse-Metrics: No impressions provided to to flattenImpressions");return p},buildLocationStructure:function(e){for(var t,n,r,o,i,s,a=e,c=[];a;){if(n={},i=0,t=a.parentNode,a.hasAttribute&&a.hasAttribute("data-metrics-location")&&(n=JSON.parse(a.getAttribute("data-metrics-location"))).locationType){if(t)for(r=t.childNodes,s=0;s<r.length;s++)if((o="function"==typeof r.item&&r.item(s)||r[s]).hasAttribute&&o.hasAttribute("data-metrics-location")?JSON.parse(o.getAttribute("data-metrics-location")).locationType:void 0){if(o===a)break;i++}n.locationPosition=i,c.push(n)}a=t}return c}};e.exports=a},function(e,t,n){e.exports=n(63)},function(e,t,n){n(28);var r=n(67),o=n(68);r.utils.setDelegate(o),e.exports=r},function(e,t,n){var r={eventRecorder:n(65),logger:n(29),network:n(30)};e.exports=r},function(e,t,n){var r=n(1),o=n(5),i=n(66),s={_utResetQueue:function(){for(var e in i._utQueue().eventQueues)i._utQueue().resetTopicPostInterval(e);i._utQueue().eventQueues={}},setDelegate:function(e){return r.reflect.attachDelegate(this,e)},recordEvent:function(e,t,n){var s=null;return t&&!r.config.metricsDisabledOrBlacklistedEvent.call(o,t.eventType,e)&&(r.config.removeBlacklistedFields.call(o,t,e),i.recordEvent(e,t,n),s=t),s},flushUnreportedEvents:function(e){i.flushUnreportedEvents(e)},sendMethod:function(){return"javascript"}};e.exports=s},function(e,t,n){var r=n(1),o=n(5),i=n(29),s=n(30),a={DEFAULT_REQUEST_TIMEOUT:1e4,EVENTS_KEY:"events",EVENT_DELIVERY_VERSION:"1.0",EVENT_SEND_METHOD:{AJAX:"ajax",AJAX_SYNCHRONOUS:"ajaxSynchronous",IMAGE:"image"},MAX_PERSISTENT_QUEUE_SIZE:100,RETRY_EXPONENT_BASE:2,URL_DELIVERY_VERSION:2,eventQueues:{},enqueueEvent:function(e,t){var n,r=null;return e&&t&&(a.eventQueues=a.eventQueues||{},a.eventQueues[e]=a.eventQueues[e]||{},a.eventQueues[e][a.EVENTS_KEY]=a.eventQueues[e][a.EVENTS_KEY]||[],a.eventQueues[e][a.EVENTS_KEY].push(t),r=t,n=o.value("maxPersistentQueueSize",e)||a.MAX_PERSISTENT_QUEUE_SIZE,a.trimEventQueues(a.eventQueues,n)),r},trimEventQueues:function(e,t){var n=Object.keys(e);n.length&&n.forEach(function(n){var r=e[n][a.EVENTS_KEY];r&&r.length&&r.length>t&&(i.warn("eventQueue overflow, deleting LRU events: size is: "+r.length+" which is over max size: "+t),e[n][a.EVENTS_KEY]=r.slice(-t))})},resetTopicQueue:function(e){a.eventQueues[e]&&(a.eventQueues[e][a.EVENTS_KEY]=null)},resetTopicRetryAttempts:function(e){a.eventQueues[e]&&(a.eventQueues[e].retryAttempts=0)},scheduleNextTopicRetryAttempt:function(e){if(a.eventQueues[e]){a.eventQueues[e].retryAttempts=a.eventQueues[e].retryAttempts||0,a.eventQueues[e].retryAttempts++;var t=Math.pow(a.RETRY_EXPONENT_BASE,a.eventQueues[e].retryAttempts)*o.value("postFrequency",e);a.resetTopicPostInterval(e),a.setTopicPostInterval(e,t)}},sendEvents:function(e,t){for(var n in a.eventQueues)a.sendEventsForTopic(n,e,t)},sendEventsForTopic:function(e,t,n){var i=a.eventQueues[e],s=o.value("testExponentialBackoff",e),c=o.value("metricsUrl",e),l=r.config.disabled.call(o);if(i&&c&&!l&&!s&&(!i.retryAttempts||!n))switch(a.resetTopicPostInterval(e),a.setTopicPostInterval(e,o.value("postFrequency",e)),t){case a.EVENT_SEND_METHOD.IMAGE:a.sendEventsViaImage(e);break;case a.EVENT_SEND_METHOD.AJAX_SYNCHRONOUS:a.sendEventsViaAjax(e,!1);break;case a.EVENT_SEND_METHOD.AJAX:default:a.sendEventsViaAjax(e,!0)}s&&a.scheduleNextTopicRetryAttempt(e)},sendEventsViaImage:function(e){var t,n,r,o;a.eventQueues[e]&&(n=-1==(t=a.metricsUrlForTopic(e)).indexOf("?")?"?":"&",r=t+n+"responseType=image",(o=a.eventQueues[e][a.EVENTS_KEY])&&o.length&&o.forEach(function(e){var t,n=a.createQueryParams(e);n&&(t=r+"&"+n,(new Image).src=t)}),a.resetTopicQueue(e))},createQueryParams:function(e){var t,n,o="";return Object.keys(e).forEach(function(i,s,a){t=e[i],n=r.reflect.isString(t)?t:JSON.stringify(t),o+=i+"="+encodeURIComponent(n),s<a.length-1&&(o+="&")}),o.length?o:null},sendEventsViaAjax:function(e,t){var n,r,i,c,l;a.eventQueues[e]&&a.eventQueues[e][a.EVENTS_KEY]&&(n=a.enrichAndSerializeEvents(a.eventQueues[e][a.EVENTS_KEY]))&&(r=a.metricsUrlForTopic(e),i=function(){a.resetTopicQueue(e),a.resetTopicRetryAttempts(e)},c=function(t,n){n>=400&&n<500?i():a.scheduleNextTopicRetryAttempt(e)},l=o.value("requestTimeout",e)||a.DEFAULT_REQUEST_TIMEOUT,l=Math.min(l,o.value("postFrequency",e)),s.makeAjaxRequest(r,"POST",n,i,c,{async:t,timeout:l}))},enrichAndSerializeEvents:function(e){var t,n=null;if(e&&e.length){(t={}).deliveryVersion=a.EVENT_DELIVERY_VERSION,t.postTime=Date.now(),t[a.EVENTS_KEY]=e;try{n=JSON.stringify(t)}catch(e){i.error("Error stringifying events as JSON: "+e)}}return n},metricsUrlForTopic:function(e){return o.value("metricsUrl",e)+"/"+a.URL_DELIVERY_VERSION+"/"+e},setTopicPostInterval:function(e,t){a.eventQueues[e]&&t&&(a.eventQueues[e].postIntervalToken=setInterval(function(){i.debug("MetricsKit: triggering postIntervalTimer for "+e+" at "+(new Date).toString()),a.sendEventsForTopic.call(a,e)},t))},resetTopicPostInterval:function(e){a.eventQueues[e]&&(clearInterval(a.eventQueues[e].postIntervalToken),a.eventQueues[e].postIntervalToken=null)}},c={_utQueue:function(){return a},recordEvent:function(e,t,n){r.config.disabled.call(o)||(0===o.value("postFrequency",e)&&(n=!0),a.enqueueEvent(e,t),n?a.sendEvents(a.EVENT_SEND_METHOD.AJAX,!0):a.eventQueues[e].postIntervalToken||a.setTopicPostInterval(e,o.value("postFrequency",e)))},flushUnreportedEvents:function(e){var t;e?(t=navigator.userAgent,/iPad|iPhone|iPod/.test(t)&&-1==t.indexOf("IEMobile")?a.sendEvents(a.EVENT_SEND_METHOD.AJAX_SYNCHRONOUS,!0):a.sendEvents(a.EVENT_SEND_METHOD.IMAGE,!0)):a.sendEvents(a.EVENT_SEND_METHOD.AJAX,!0)}};e.exports=c},function(e,t,n){var r=n(1),o=n(9),i={mirrorToServerLevel:o.prototype.NONE,topic:""};o.setTopic=function(e){i.topic=e},o.topic=function(){return i.topic},o.mirrorToServerLevel=function(){return i.mirrorToServerLevel},o.prototype.setTopic=function(e){this._topic=e},o.prototype.topic=function(){var e=this._topic||o.topic();return e||console.error("LoggerKit: topic must be set in order to mirror log events to the server. Example: loggerKit.setTopic('my_figaro_topic');"),e},o.prototype.setMirrorToServerLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._mirrorToServerLevel=t)},o.prototype.mirrorToServerLevel=function(){var e=this._mirrorToServerLevel;return r.reflect.isNumber(e)?e:o.mirrorToServerLevel()},e.exports=o},function(e,t,n){var r,o,i,s=n(1),a=n(9),c=n(28);a.eventRecorder=c.eventRecorder,r={eventType:"log",eventVersion:"4"},o=function(e,t,n,o){var i,a=null,c=n&&n.length;if(t&&(c||o)){if(a={},s.reflect.extend(a,r),a.eventTime=Date.now(),a.level=t,a.loggerName=e.loggerName(),o&&(a.callstack=o),c){try{a.arguments=JSON.stringify(n)}catch(t){e.error("Error stringifying arguments as JSON: "+t)}"string"==typeof n[0]?a.message=n[0]:"object"==typeof n[0]&&1===n.length&&(i=n[0],a=s.reflect.extend({},i,a))}}else console.error("LoggerKit: at least one argument or the INCLUDE_CALL_STACK flag is required in order to mirror to server");return a},i={sendToServer:function(e,t,n,r){var i=e.topic(),s=o(e,t,n,r),c=null;return i&&s&&(c=a.eventRecorder.recordEvent(i,s)),c}},e.exports=i},function(e,t,n){var r=n(1),o={attachDelegate:function(e,t){return r.reflect.attachDelegate(e,t)},extend:function(e){return r.reflect.extend.apply(r.reflect,arguments)}};e.exports=o},function(e,t,n){var r=n(1),o={versionStringFromUserAgent:function(e,t){return r.string.versionStringFromUserAgent(e,t)}};e.exports=o},function(e,t,n){var r=n(1),o=(n(6),["The function metrics.system.eventRecorder.","placeholder","() must be overridden with a platform-specific delegate function. If you have no data for this field, have your delegate return null or undefined (no 'return')"]),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},recordEvent:function(e,t){throw o[1]=r.reflect.functionName(),o.join("")},sendMethod:function(){throw o[1]=r.reflect.functionName(),o.join("")},flushUnreportedEvents:function(e){}};e.exports=i},function(e,t,n){var r,o=n(10),i={};for(r in i.account=n(73),i.base=n(4),i.buyConfirmed=n(74),i.click=n(75),i.dialog=n(76),i.enter=n(77),i.exit=n(78),i.flexible=n(79),i.impressions=n(80),i.media=n(81),i.page=n(32),i.search=n(82),i)o.attachDelegateInfo(i[r]);e.exports=i},function(e,t,n){var r=n(1),o=n(4),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","type"]},eventType:function(e){return"account"},eventVersion:function(e){return e&&e.eventVersion||1}};e.exports=i},function(e,t,n){var r=n(1),o=n(4),i=n(32),s=n(15),a=n(6),c={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion"]},eventType:function(e){return"buyConfirmed"},eventVersion:function(e){return e&&e.eventVersion||1},createClientBuyId:function(){var e=null,t=s.sessionStorageObject().getItem("mtMetricsKit_previousClientBuyId");return e=++t,t||(a.warn("Metrics: buyConfirmed.createClientBuyId: clientBuyId did not exist or was of incorrect type, reset to 1."),e=1),s.sessionStorageObject().setItem("mtMetricsKit_previousClientBuyId",e),e},clientBuyIdQueryParamString:function(e){return"&clientBuyId="+e},metricsBuyParamsString:function(e,t,n,s){var c,l,u=Array.prototype.slice.call(arguments,4),p=i.pageHistory(),d=o.clientId();return Array.isArray(p)?p.length>=2&&(c=p[p.length-2]):a.warn("MetricsKit: metricsBuyParamsString: pageHistory is not an Array"),l={mtApp:o.app(),mtEventTime:Date.now(),mtHardwareFamily:o.hardwareFamily(),mtHardwareModel:o.hardwareModel(),mtHostApp:o.hostApp(),mtHostAppVersion:o.hostAppVersion(),mtOs:o.os(),mtOsBuildNumber:o.osBuildNumber(),mtOsVersion:o.osVersion(),mtPageId:e,mtPageType:t,mtPageContext:n,mtTopic:s||"xp_its_main",mtPrevPage:c,mtRequestId:r.string.requestId(d),mtClientId:d},r.reflect.extend.apply(r.reflect,[l].concat(u)),r.string.paramString(l)},cacheMetricsBuyData:function(e,t){if(2!=arguments.length)a.error("buyConfirmed.cacheMetricsBuyData(): function invoked with incorrect number of parameters. Perhaps you meant to retrieve cached data instead of setting it, which would be a call to uncacheMetricsBuyData(clientBuyId)?");else{var n=JSON.stringify(t);s.sessionStorageObject().setItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+e,n)}},uncacheMetricsBuyData:function(e){var t,n=null;return 1!=arguments.length?a.error("buyConfirmed.uncacheMetricsBuyData(): function invoked with incorrect number of parameters. Perhaps you meant to set cached data instead of retrieving it, which would be a call to cacheMetricsBuyData(clientBuyId, metricsBuyData)?"):(t=s.sessionStorageObject().getItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+e))&&(n=JSON.parse(t),s.sessionStorageObject().removeItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+e)),n},buyFailureOccurred:function(e){var t=this.uncacheMetricsBuyData(e);t&&(t.detoured=!0,this.cacheMetricsBuyData(e,t))}};e.exports=c},function(e,t,n){var r=n(1),o=n(8),i=n(4),s=n(6),a={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n,r){var s=[e,t,n];return r&&(s.push({location:o.eventFields.buildLocationStructure(r)}),s.push(a.dataForElement(r)||{})),s=s.concat(Array.prototype.slice.call(arguments,4)),i.processMetricsData.apply(this,s)},knownFields:function(){return["actionContext","actionDetails","actionType","actionUrl","eventType","eventVersion","impressions","location","targetId","targetType","positionX","positionY","xpViewablePercentage"]},dataForElement:function(e){var t,n=null;if(e&&r.reflect.isFunction(e.hasAttribute)&&r.reflect.isFunction(e.getAttribute)&&(t=a.dataAttribute(),e.hasAttribute(t)))try{n=JSON.parse(e.getAttribute(t))}catch(e){s.error("MetricsKit: error parsing click data - "+e)}return n},dataAttribute:function(){return"data-metrics-click"},eventType:function(e){return"click"},eventVersion:function(e){return e&&e.eventVersion||4},impressions:function(e){return e?e.impressions:void 0},xpViewablePercentage:function(e){return i.xpViewablePercentage(e)}};e.exports=a},function(e,t,n){var r=n(1),o=n(4),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["buttons","code","details","message","type","eventType","eventVersion","type"]},eventType:function(e){return"dialog"},eventVersion:function(e){return e&&e.eventVersion||2}};e.exports=i},function(e,t,n){var r=n(1),o=n(4),i=n(16).environment,s={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","extRefUrl","osLanguages","refApp","type"]},eventType:function(e){return"enter"},eventVersion:function(e){return e&&e.eventVersion||1},osLanguages:function(e){return e&&e.osLanguages||i.osLanguages()}};e.exports=s},function(e,t,n){var r=n(1),o=n(4),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["destinationUrl","eventType","eventVersion","type"]},eventType:function(e){return"exit"},eventVersion:function(e){return e&&e.eventVersion||1}};e.exports=i},function(e,t,n){var r=n(1),o=(n(8),n(4)),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e){var t,n=[void 0,void 0,void 0];return n.push({eventType:e}),t=Array.prototype.slice.call(arguments,1),n=n.concat(t),o.processMetricsData.apply(this,n)},knownFields:function(){return["eventTime","eventType"]},mtIncludeBaseFields:function(){return!1},eventTime:function(e){return e&&e.eventTime||Date.now()},eventType:function(e){return e&&e.eventType||void 0}};e.exports=i},function(e,t,n){var r=n(1),o=n(5),i=n(11),s=n(4),a={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return s.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","impressions","xpViewablePercentage","xpViewableThreshold"]},eventType:function(e){return"impressions"},eventVersion:function(e){return e&&e.eventVersion||3},impressions:function(e){return e?e.impressions:void 0},xpViewablePercentage:function(e){return s.xpViewablePercentage(e)},xpViewableThreshold:function(e){return e&&e.xpViewableThreshold||o.value("impressions.viewableThreshold",i.topic())}};e.exports=a},function(e,t,n){var r=n(1),o=n(4),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","id","idType","type","typeDetails","actionType","actionDetails","url","duration","position"]},eventType:function(e){return"media"},eventVersion:function(e){return e&&e.eventVersion||1}};e.exports=i},function(e,t,n){var r=n(1),o=n(4),i={setDelegate:function(e){return r.reflect.attachDelegate(this,e)},metricsData:function(e,t,n){return o.processMetricsData.apply(this,arguments)},knownFields:function(){return["actionDetails","actionType","actionUrl","eventType","eventVersion","filters","location","targetId","targetType","term"]},eventType:function(e){return"search"},eventVersion:function(e){return e&&e.eventVersion||2}};e.exports=i},function(e,t,n){function r(){const e=Ko();return null===e?Math.floor(4294967295*Math.random()):e}function o(){return 1e4*(Date.now()+1221e10)}function i(e,t){if(t>8)throw Error("lengh of string too long to pad");let n=e.toString(16);const r="00000000".length-n.length;return r>0&&(n="00000000".slice(0,r).concat(n)),r<0?n.slice(0,t):n}function s(e){return c(e)?null:Array.isArray(e)?e.join("."):e}function a(e,t,n){if(c(e))return n;if(!t)return e;let r=null;"string"==typeof t?(r=ni[t])||(r=t.split("."),ni[t]=r):r=t;let o=e;for(const e of r)if(c(o=o[e]))return n;return o}function c(e){return null==e}function l(e){return c(e)||0===Object.keys(e).length}function u(e){return null!=e}function p(e){return u(e)&&0!==Object.keys(e).length}function d(e,t){const n=a(e,t,null);return Array.isArray(n)?n:(c(n)||Fo.c("asArrayOrEmpty",()=>{Fo.e("defaultValue","array",n,s(t))}),[])}function f(e,t){const n=a(e,t,null);return"boolean"==typeof n?n:(c(n)||Fo.c("asBooleanOrFalse",()=>{Fo.e("defaultValue","boolean",n,s(t))}),!1)}function h(e,t,n="coercible"){const r=a(e,t,null);if(c(r)||"string"==typeof r)return r;{const e="object"==typeof r?null:String(r);switch(n){case"strict":Fo.c("asString",()=>{Fo.e("coercedValue","string",r,s(t))});break;case"coercible":c(e)&&Fo.c("asString",()=>{Fo.e("coercedValue","string",r,s(t))})}return e}}function m(e,t,n="coercible"){const r=a(e,t,null);if(c(r)||"number"==typeof r)return r;{const e=Number(r);switch(n){case"strict":Fo.c("asNumber",()=>{Fo.e("coercedValue","number",r,s(t))});break;case"coercible":if(isNaN(e))return Fo.c("asNumber",()=>{Fo.e("coercedValue","number",r,s(t))}),null}return e}}function g(e,t,n){const r=a(e,t,null);return r instanceof Object&&!Array.isArray(r)?r:(c(r)||Fo.c("asDictionary",()=>{Fo.e("defaultValue","object",r,s(t))}),u(n)?n:null)}function y(e,t,n){return g(e,t,n)}function w(e,t,n="coercible"){const r=a(e,t,null);if(c(r))return null;if("boolean"==typeof r)return r;if("string"==typeof r){if("true"===r)return!0;if("false"===r)return!1}const o=Boolean(r);switch(n){case"strict":Fo.c("asBoolean",()=>{Fo.e("coercedValue","number",r,s(t))});break;case"coercible":if(c(o))return Fo.c("asBoolean",()=>{Fo.e("coercedValue","number",r,s(t))}),null}return o}function T(e){return"undefined"==typeof ask||a(ri,e)}function S(e){const t=T(e);return void 0!==t?Boolean(t):"undefined"==typeof ask||Boolean(ri.clientFeatures[e])}function A(e){return h(ri,e)}function v(e){return wi.deviceHasCapabilities(e)}function I(){return"phone"===Ii}function b(){return"pad"===Ii}function k(){return"mac"===Ii}function _(e,t){let n=Ni[e];if(!n)if((n=Fi.string(e))&&n!==e)Ni[e]=n;else{const r=xo.its.loc(e);n=r!==e?r:t||e}return n}function P(e,t,n){let r=Fi.stringWithCount(e,t);if(!r||r===e){const o=xo.its.locWithCount(e,t,n);o&&(r=o)}return r}function C(e,t,n){return Fi.stringWithCounts?Fi.stringWithCounts(e,t):null}function E(e,t){let n=Fi.decimal(e,t);return n||(n="number"==typeof e?`* ${e.toString()} *`:"* null *"),n}function O(e){let t=Fi.formattedCount?Fi.formattedCount(e):null;return t||(t="* null *"),t}function R(e){let t=Fi.timeAgo(e);return t||(t="* null *"),t}function D(e,t){let n=Fi.formatDate(e,t);return n||(n="* null *"),n}function x(e,t){F(e)||(Di=e,xo.its.updateLocale(t))}function F(e){return Di===e}function L(e){return function(){if(xi)return console.log("Same Promise"),xi;if(void 0===Lo.language||null===Lo.language)return Promise.reject(new Error("Bag language is not available. Unable to load localizations."));{const e=function(e,t){if(null==e)return null;switch(e=e.toLocaleLowerCase()){case"yue-hant":{const e=A("macauStorefrontIdentifier");return"string"==typeof t&&-1!==t.indexOf(e)?"zh-ma":"zh-hk"}default:return e}}(Lo.language,Ci),t=`local/${e}`;if(!F(t)){const n=T(`localizations.${e}`);if(null!=n)x(t,n);else{const e=T("localizations.en-us");null!=e&&x(t,e)}}return new Promise((e,t)=>{e()})}}().then(t=>e())}function N(){switch(Ii){case"phone":return"iphone";case"pad":return"ipad";case"tv":return"appletv";case"mac":return"mac";default:return null}}function M(){const e=N();return function(e){const t=new Set;if(t.add("iphone"),t.add("ipad"),t.add("appletv"),t.add("mac"),null!==e)for(const n of e)t.delete(n);return Array.from(t)}(new Set([e]))}function U(){switch(Ii){case"phone":return 6;case"pad":return 10;case"mac":return 12;default:return 8}}function V(e,t,n){return e?Fo.c(t,()=>{let r=e[$i],o=null;return r?(o=a(r,t))||(o=B(r,t,n)):(r={},e[$i]=r,o=B(r,t,n)),o}):null}function B(e,t,n){const r=n();return e[t]=r,r}function $(e,t,n){return c(e)?null:g(e.attributes,t,n)}function q(e,t){return c(e)?[]:d(e.attributes,t)}function j(e,t,n="coercible"){return c(e)?null:h(e.attributes,t,n)}function H(e,t,n="coercible"){return c(e)?null:w(e.attributes,t,n)}function G(e,t){return!c(e)&&f(e.attributes,t)}function z(e,t,n="coercible"){return c(e)?null:m(e.attributes,t,n)}function W(e,t){return a($(e,"platformAttributes"),t)}function Y(e,t){return p(W(e,t))}function Q(e,t,n){const r=W(e,t);return c(r)?null:g(r,n)}function K(e,t,n,r="coercible"){const o=W(e,t);return c(o)?null:h(o,n,r)}function J(e,t,n=!0){const r=X(e,t);return!!r&&!(!r.data||n&&0===r.data.length)}function X(e,t){return y(e.relationships,t)}function Z(e,t){const n=d(e.relationships,[t,"data"]);return 0===n.length?null:(n.length>1&&(console.warn(`there was an array of relationships when only the first was asked for in relationship ${t}`),console.log(JSON.stringify(e))),n[0])}function ee(e,t){return d(e.relationships,[t,"data"])}function te(e,t,n=!1){return V(e,`dataHasDeviceFamily.${t}`,()=>!(!e||!t)&&-1!==oe(e,n).indexOf(t))}function ne(e,t,n=!1){return te(e,t,n)&&1===oe(e,n).length}function re(e,t,n=!1){const r=new Set(oe(e,n));return t.length===r.size&&t.every(e=>r.has(e))}function oe(e,t=!1){const n=q(e,"deviceFamilies");if(0===n.length&&t){const n=ee(e,"apps");for(const e of n){const n=oe(e,t);if(p(n))return n}}return n}function ie(e,t,n){const r=e.indexOf(t);let o,i=e;if(-1!==r){const s=e.slice(0,r),a=e.slice(r+t.length,e.length);"prefix"===n?(o=s,i=a):(o=a,i=s)}return{result:o,remainder:i}}function se(e){let t=e.targetType;return t||(t="lockup"),t}function ae(e){let t=e.idType;return t||(t="its_id"),t}function ce(e){return null==e?"":e}function le(e){if(!e)return null;const t=new as(e);let n=null;for(const e of Object.keys(t.query))if("referrer"===e){"siri"===t.query[e]&&(n="com.apple.siri");break}return n}function ue(e){return function e(t){if(c(t))return null;if(t instanceof Array){const n=[];for(const r of t){const t=e(r);u(t)&&n.push(t)}return n}if(t instanceof Object){const n={};return Object.keys(t).forEach((r,o,i)=>{const s=t[r],a=e(s);u(a)&&(n[r]=a)}),n}return t}(e)}function pe(e){if(!e)return null;const t=new as(e),n=t.query.term,r=t.pathname;return c(n)||c(r)?null:r.endsWith("/search")?n:null}function de(e,t){if(!e||!t)return"unknown";if("app-bundles"===e.type)return"bundle";switch(t.style){case"roundedRect":return"ios";case"unadorned":return"mac";case"tvRect":return"tv";case"round":return"watch";case"pill":return"messages";case"iap":return"iap";default:return function(e){throw new Error("This method should never be called with value: ${value}")}(),"unknown"}}function fe(e,t){const n=Ae(e.locationTracker);return n.push(Te(e,t)),n}function he(e,t){const n=Ae(e.locationTracker);return n.push(Se(e,t)),n}function me(e,t){const n=new cs;n.location=Te(e,t),e.locationTracker.locationStack.push(n)}function ge(e){0!==e.locationStack.length?e.locationStack.pop():Fo.e("ignoredValue","non-empty location stack","empty location stack")}function ye(e){const t=ve(e);return t?t.position:e.rootPosition}function we(e){const t=ve(e);t?t.position++:e.rootPosition++}function Te(e,t){const n=Se(e,t);return!e.id&&e.locationTracker?(n.idType="sequential",n.id=ye(e.locationTracker).toString()):(n.idType=ae(e),n.id=ce(e.id)),e.fcKind&&(n.fcKind=e.fcKind),e.displayStyle&&(n.displayStyle=e.displayStyle),n}function Se(e,t){const n={locationPosition:ye(e.locationTracker),locationType:se(e),name:ce(t)};return e.recoMetricsData&&Object.assign(n,e.recoMetricsData),n}function Ae(e){return e.locationStack.map(e=>e.location)}function ve(e){const t=e.locationStack.length;return 0===t?null:e.locationStack[t-1]}function Ie(e){const t={};return e?(Object.assign(t,e.baseFields),e.pageUrl&&(t.pageUrl=e.pageUrl),e.recoMetricsData&&Object.assign(t,e.recoMetricsData),ue(t)):t}function be(e){if(null==e)return e;const t=Object.create(Object.getPrototypeOf(e));return Object.assign(t,e),t}function ke(e,t){const n=Ie(t.pageInformation);n.id=ce(t.id),n.idType=ae(t),n.type="video",n.typeDetails="iTunesStoreContent",n.location=fe(t,null),t.actionDetails&&(n.actionDetails=t.actionDetails),e.templateMediaEvent=new ws(n);const r=be(n);r.actionUrl=e.videoUrl,e.templateClickEvent=new us(null,"button",r)}function _e(e,t,n,r){n||(n=Oe(e));let o=Q(e,n,t);return o||(o=$(e,t,r)),o}function Pe(e,t){let n=function(e,t,n){const r=W(e,t);return c(r)?[]:d(r,n)}(e,Oe(e),t);return l(n)&&(n=q(e,t)),n}function Ce(e,t,n="coercible"){let r=K(e,Oe(e),t,n);return r||(r=j(e,t,n)),r}function Ee(e,t){let n=function(e,t,n){const r=W(e,t);return!c(r)&&f(r,n)}(e,Oe(e),t);return n||(n=G(e,t)),n}function Oe(e){return V(e,"bestAttributePlatformFromData",()=>{const t=re(e,["iphone","ipad","ipod"],!0),n=ne(e,"tvos"),r=ne(e,"mac");let o=null;if(n?o="appletvos":r?o="osx":t&&(o="ios"),!c(o))return o;const i=function(){const e=Re();switch(e){case"ios":return["ios","appletvos","osx"];case"osx":return["osx","ios","appletvos"];case"appletvos":return["appletvos","ios","osx"];default:return[e]}}();for(const t of i)if(Y(e,t))return t;return Re()})}function Re(){switch(Ii){case"phone":case"pad":return"ios";case"tv":return"appletvos";case"mac":return"osx";default:return null}}function De(e){return l(e)?null:(-1!==e.indexOf("T")&&(e=e.split("T")[0]),new Date(e.replace(/-/g,"/")))}function xe(e){const t=function(e){return c(e)?null:new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))}(e);return c(t)?null:t.getTime()}function Fe(e,t,n,r){const o={};t&&(Object.assign(o,Ie(t)),r&&t.iAdInfo&&t.iAdInfo.iAdAdamId===e.adamId&&Object.assign(o,t.iAdInfo.clickFields)),o.actionType="buy",o.actionDetails={buyParams:e.purchaseConfiguration.buyParams},o.location=n,o.targetId=e.adamId,jr(e)&&(o.offerType="preorder",u(e.expectedReleaseDate)&&(o.offerReleaseDate=xe(e.expectedReleaseDate)));const i=new us(e.adamId,"button",o);e.metricsEvents=[i]}function Le(e,t,n=!1){let r=t.actionType;r||(r="navigate");const o={actionType:r};if(e instanceof ia){const t=e;o.actionUrl=t.pageUrl}else if(e instanceof aa){const t=e;o.actionUrl=t.url}t.actionDetails&&(o.actionDetails=t.actionDetails),t.actionContext&&(o.actionContext=t.actionContext),u(t.offerType)&&(o.offerType=t.offerType),u(t.offerReleaseDate)&&(o.offerReleaseDate=xe(t.offerReleaseDate)),o.location=fe(t,e.title),Object.assign(o,Ie(t.pageInformation)),t.isAdvert&&n&&t.pageInformation.iAdInfo&&Object.assign(o,t.pageInformation.iAdInfo.clickFields);const i=new us(t.id,se(t),ue(o));e.metricsEvents=[i]}function Ne(e,t,n){const r=Ie(n.pageInformation);u(t)&&(r.actionUrl=t),n.targetType||(n.targetType="button"),r.location=he(n,e.title),r.actionType="navigate",r.target="button_See All";const o=new us("See All","button",r);e.metricsEvents=[o]}function Me(e,t,n){const r=[];if("trending"===e.origin){const o="trending",i="button",s={actionType:o,actionUrl:ce(e.url),location:he({pageInformation:null,locationTracker:n,targetType:i},e.term),page:"Search",pageDetails:"Apps",pageType:"Search",actionDetails:{term:t,actionType:o}},a=new us("",i,s);r.push(a)}let o="listItem",i="trending";const s={targetId:ye(n)};switch(e.origin){case"trending":o="button",i="trending";break;case"hints":o="listItem",i="hint";const n={searchPrefix:t};p(e.entity)&&(n.hintsEntity=e.entity),s.actionDetails=n}const a=new hs(e.term,o,i,e.url,s);r.push(a),e.metricsEvents=r}function Ue(e,t=null){switch(e){case"mac":return function(e){let t="x-apple.systempreferences:com.apple.preferences.softwareupdate?client=AppStore";return e&&(t+=`&installMajorOSVersion=${e}`),t}(t);default:return null}}function Ve(e){const t=d(e,"data");return t.length>1&&(console.warn("tried to extract data from container but more than one member present"),console.log(JSON.stringify(e))),1!==t.length?null:t[0]}function Be(e){return d(e,"data")}function $e(e){return u(e.attributes)}function qe(e){return g(e,"meta.metrics")}function je(e,t){return e.slice(t,e.length)}function He(e,t){return e.slice(t,e.length)}function Ge(e,t){return`${qi.internal}:/${ji.reviews}/${ji.shelf}/${e}/${t}`}function ze(e){return!!u(e)&&(!!G(e,"isFirstPartyHideableApp")||!!G(e,"reviewsRestricted"))}function We(e,t){const n=as.from(e),r=h(n.query,"displayable-kind");return t&&p(r)&&(n.query["displayable-kind"]=Na[r]||r),n}function Ye(e,t){return Fo.c("reportConcernActionFromApiRow",()=>{const n=h(t,"id","coercible"),r=Lo.reportConcernUrl,o=new ma(r);o.method="POST",o.isStoreRequest=!0,o.disableCache=!0,o.needsAuthentication=!0,o.headers={"Content-Type":ba.contentType},o.body=(new ba).param("userReviewId",n).param("guid",e).build();const i=new ha("selectedReason","formBody","decimalPad"),s=new ha("explanation","formBody","text");o.parameters=[i,s];const a=new Ta("toast");a.title=_("TOAST_CONCERN_REPORTED_TITLE"),a.message=_("TOAST_CONCERN_REPORTED_DESCRIPTION"),a.artwork=new li("resource://ToastExclamation.png",90,90),o.successAction=a;let c=Lo.reportConcernReasons;l(c)&&(c=[{reasonId:"1",name:"It contains offensive material",upperCaseName:"IT CONTAINS OFFENSIVE MATERIAL"},{reasonId:"8",name:"It's off-topic",upperCaseName:"IT’S OFF-TOPIC"},{reasonId:"111003",name:"It looks like spam",upperCaseName:"IT LOOKS LIKE SPAM"},{reasonId:"7",name:"Something else",upperCaseName:"SOMETHING ELSE"}]);const u=c.map(e=>new mi(h(e,"reasonId"),h(e,"name"),h(e,"upperCaseName"))),p=new Aa(u);return p.title=_("ACTION_REVIEW_REPORT"),p.explanation=Lo.reportConcernExplanation,l(p.explanation)&&(p.explanation="Tell us a little more (Optional)"),p.artwork=new li("resource://ContextActionExclamation",28,28),p.sendAction=o,p})}function Qe(e,t,n){const r=Lo.voteUrl,o=h(n,"id","coercible"),i=new as(r).param("userReviewId",o),s=new fa(i.build()),a=new Ta("toast");return t?(s.title=_("ACTION_REVIEW_HELPFUL"),s.artwork=new li("resource://ContextActionThumbsUp",28,28),a.title=_("TOAST_HELPFUL_TITLE"),a.message=_("TOAST_HELPFUL_DESCRIPTION"),a.artwork=new li("resource://ToastThumbsUp.png",90,90)):(s.title=_("ACTION_REVIEW_NOT_HELPFUL"),s.artwork=new li("resource://ContextActionThumbsDown",28,28),a.title=_("TOAST_NOT_HELPFUL_TITLE"),a.message=_("TOAST_NOT_HELPFUL_DESCRIPTION"),a.artwork=new li("resource://ToastThumbsDown.png",90,90)),s.method="POST",s.isStoreRequest=!0,s.disableCache=!0,s.headers={"Content-Type":ba.contentType},s.body=(new ba).param("vote",t?"1":"0").param("guid",e).build(),s.successAction=a,s}function Ke(e,t,n,r=!1,o=!0){return Fo.c("createReviewItems",()=>{const i=function(e,t){return t?1e3*((new Date).getTime()-e.getTime())<3600?_("TIME_AGO_EDITED_JUST_NOW"):_("TIME_AGO_EDITED_TIME").replace("{time}",R(e)):R(e)};return n.map(n=>{const s=new Oa;s.id=h(n,"id","coercible"),s.title=j(n,"title");const a=j(n,"date");a&&(s.date=new Date(a),s.dateText=i(s.date,G(n,"isEdited"))),s.contents=j(n,"review"),s.rating=z(n,"rating"),s.reviewerName=j(n,"userName");const c=j(n,"developerResponse.id");if(p(c)){const e=new Ra;e.id=c,e.contents=j(n,"developerResponse.body");const t=j(n,"developerResponse.modified");t&&(e.date=new Date(t),e.dateText=i(e.date,!1)),s.response=e}return r&&(s.moreAction=function(e,t,n){return n?Fo.c("singleReviewActionFromReviewData",()=>{const r=Xe(e,t,[n]),o=new Ca;o.adamId=h(t,"adamId"),o.targetReviewId=h(n,"id","coercible"),o.shelves=[r];const i=new ia("reviews");return i.pageData=o,i.title=_("PRODUCT_SECTION_REVIEWS"),i}):null}(e,t,n)),o&&(h(t,"adamId"),s.topLevelAction=function(e,t,n){if(!n)return null;const r=[Qe(e,!0,n),Qe(e,!1,n),Ye(e,n)],o=new wa(r);return o.isCancelable=!0,o}(e,0,n)),s})})}function Je(e,t,n,r=!1){return Fo.c("createWriteReviewAction",()=>{const o=_(r?"EDIT_REVIEW":"WRITE_A_REVIEW"),i=function(e,t){return We(Lo.writeReviewURL,t).param("id",e).build()}(e,t);let s;switch(Ii){case"mac":{const t=new ya(e,i);t.title=o,t.appIcon=n,s=t;break}default:{const t=new ia("writeReview");t.title=o,t.pageUrl=i,t.pageData=e,t.presentationContext="presentModal",s=t;break}}return s})}function Xe(e,t,n,r=!1,o=!0){return Fo.c("reviewsShelfForReviewsData",()=>{const i=new ta("reviews");return i.items=Ke(e,t,n,r,o),i})}function Ze(e,t,n,r,o,i,s=!1,a=!0,l=null){return Fo.c("reviewsContainerShelfForReviewsData",()=>{const a=function(e,t,n,r,o,i=null){return Fo.c("reviewsContainerForReviewsData",()=>{const s=new Fa,a=h(t,"adamId"),l=f(t,"isBundle");if(s.adamId=a,s.ratings=function(e,t){return t?Fo.c("ratingsFromApiResponses",()=>{const e=new Ea;e.productId=h(t,"adamId","coercible"),e.ratingAverage=m(t,"ratingAverage"),e.totalNumberOfRatings=m(t,"ratingCount"),e.totalNumberOfReviews=m(t,"totalNumberOfReviews");const n=d(t,"ratingCountList").slice().reverse(),r=n.reduce((e,t)=>e+t,0);if(e.ratingCounts=r>0?n.map(t=>t/r*e.totalNumberOfRatings):n,!(e.ratingAverage>0&&e.ratingCounts)){const n=f(t,"wasReset");e.status=_(n?"RATINGS_STATUS_DEVELOPER_RESET":"RATINGS_STATUS_NOT_ENOUGH_RATINGS")}return e}):null}(0,t),s.tapToRate=function(e,t,n=null){const r=new Da;switch(Ii){case"mac":r.title=_("CLICK_TO_RATE");break;default:r.title=_("TAP_TO_RATE")}return r.rating=n,r.rateAction=function(e,t){const n=new Ta("toast");n.title=_("TOAST_TAP_TO_RATE_TITLE"),n.message=_("TOAST_TAP_TO_RATE_DESCRIPTION"),n.artwork=new li("resource://ToastStar.png",95,90);const r=new ga(function(e,t){return We(Lo.userRateURL,t).param("id",e).build()}(e,t));r.adamId=e,r.method="POST",r.isStoreRequest=!0,r.disableCache=!0,r.successAction=n;const o=new ha("rating","urlQuery","decimalPad"),i=new ha("version-to-review","urlQuery","decimalPad");return r.parameters=[o,i],r}(e,t),r}(a,l,i),u(n)&&n.length>0&&(s.reviews=Ke(e,t,n,!0,!0)),c(s.reviews)||0===s.reviews.length){const e=s.ratings.ratingAverage>0&&s.ratings.ratingCounts,n=f(t,"wasReset");e||n||(s.ratings.status=_("RATINGS_STATUS_NOT_ENOUGH_RATINGS_OR_REVIEWS"))}c(o)||(s.editorsChoice=o);const p=u(i)&&i>0;s.writeReviewAction=Je(a,l,r,p);const g=h(t,"supportUrl");if(g){const e=new aa(g,!1);e.title=_("APP_SUPPORT"),s.supportAction=e}return s})}(e,t,n,r,o,l),p=new ta("reviewsContainer");return p.title=_("PRODUCT_SECTION_REVIEWS"),p.items=[a],s&&u(a.reviews)&&a.reviews.length>0&&(p.seeAllAction=function(e,t,n,r=null,o=null){return t?Fo.c("reviewsPageActionFromReviewsData",()=>{const i=nt(e,t,n,!0,r,null,o),s=new ia("reviews");return s.pageData=i,s.title=_("ACTION_SEE_ALL"),s}):null}(e,t,n,i)),p})}function et(e,t,n){return Fo.c("personalizedReviewsContainerShelf",()=>{const r=z(Ve(n),"rating");return Ze(e,t.ratingsData,t.reviewItems,t.appIcon,t.editorsChoice,t.nextPageHref,t.includeSeeAllAction,!1,r)})}function tt(e,t,n,r){const o=function(e,t){return`${qi.internal}:/${ji.reviews}/${e}/${t}`}(e,t);return new Pa(t,n,r,o)}function nt(e,t,n,r,o=null,i=null,s=null,a=Ma){const l=new Ca;return l.shelves=[],Fo.c("reviewsPageForReviewsData",()=>{let u,d;if(p(o)&&p(n)&&n.length%2>0){const r=n.slice(0,n.length-1);d=n.slice(n.length-1),u=Xe(e,t,r,!1)}else u=Xe(e,t,n,!1),d=[];const f=c(i)?h(t,"adamId"):i;if(r&&!c(t)){l.adamId=f;const n=Ze(e,t,[],s);l.shelves.push(n)}return u.items.length>0&&(r&&(u.presentationHints=new na,u.presentationHints.isSortable=!0,c(t)||(l.initialSortOptionIdentifier=a,l.sortActionSheetTitle=_("REVIEWS_SORT_BY"),l.sortOptions=[tt(f,"helpful",_("REVIEWS_MOST_HELPFUL"),_("REVIEWS_SORT_BY_MOST_HELPFUL")),tt(f,"favorable",_("REVIEWS_MOST_FAVORABLE"),_("REVIEWS_SORT_BY_MOST_FAVORABLE")),tt(f,"critical",_("REVIEWS_MOST_CRITICAL"),_("REVIEWS_SORT_BY_MOST_CRITICAL")),tt(f,"recent",_("REVIEWS_MOST_RECENT"),_("REVIEWS_SORT_BY_MOST_RECENT"))])),l.shelves.push(u),p(o)&&(l.nextPage=function(e,t,n,r){return{url:Ge(e,a),remainingContent:r,nextHref:t,profile:"lockup",maxPerPage:La,highestOrdinal:0,metricsPageInformation:null,metricsLocationTracker:null}}(f,o,0,d))),l})}function rt(e,t,n,r,o,i){return Fo.c("reviewsPageForReviewsMediaContainer",()=>{let s;return s=p(r.data)?n.concat(r.data):n,nt(e,null,s,o,r.next,t,null,i)})}function ot(e){const t=p(e.href)?e.href:function(e){switch(e){case"personalization-data":case"reviews":return`/v1/${it(e)}/`;default:return`/v1/${it(e)}/${Lo.mediaCountryCode}/`}}(e.resourceType),n=new as(t);if(p(e.resourceType))for(const t of function(e){switch(e.resourceType){case"eula":return[e.resourceType,e.targetResourceType];case"user-reviews":return["apps"];case"reviews":return["reviews","apps"];case"multiplex":return["multiplex"];default:return[e.resourceType]}}(e))n.append("pathname",t);if(e.ids.size>1)n.param("ids",Array.from(e.ids).join(","));else if(1===e.ids.size){const t=e.ids.values().next().value;n.append("pathname",t)}const r=function(t){switch(e.resourceType){case"user-reviews":return"reviews";default:return null}}();p(r)&&n.append("pathname",r),n.param("platform",e.platform),e.additionalPlatforms.size>0&&n.param("additionalPlatforms",Array.from(e.additionalPlatforms).sort().join(",")),e.attributeIncludes.size>0&&n.param("extend",Array.from(e.attributeIncludes).sort().join(",")),e.relationshipIncludes.size>0&&n.param("include",Array.from(e.relationshipIncludes).sort().join(","));for(const t of Object.keys(e.relationshipLimits).sort()){const r=e.relationshipLimits[t];n.param(`limit[${t}]`,`${r}`)}p(e.additionalQuery)&&n.append("query",e.additionalQuery),p(e.searchTerm)&&(n.append("pathname","search"),n.param("bubble[search]",e.searchTypes.join(",")),n.param("term",e.searchTerm)),p(e.context)&&n.param("contexts",e.context),p(e.filterType)&&p(e.filterValue)&&n.param(`filter[${e.filterType}]`,e.filterValue);const o=Lo.mediaApiLanguage;return c(o)||n.param("l",o),n.host=function(e,t){const r=n.pathname;let o=null;return c(o=t.isStorePreviewRequest?Lo.mediaPreviewHost:Lo.edgeEndpoints.map(e=>r.includes(e)).reduce(Ua,!1)?r.includes("search")?Lo.mediaEdgeSearchHost:Lo.mediaEdgeHost:Lo.mediaHost)&&(o="api.apps.apple.com"),o}(0,e),n.protocol="https",n}function it(e){switch(e){case"apps":case"app-bundles":case"charts":case"contents":case"developers":case"eula":case"in-apps":case"multiple-system-operators":case"user-reviews":return"catalog";case"categories":case"editorial-items":case"editorial-elements":case"groupings":case"multiplex":case"multirooms":case"rooms":case"today":return"editorial";case"ratings":return"ratings";case"personalization-data":case"reviews":return"me";default:return"catalog"}}function st(e){const t=e.host;if(c(t))return!1;for(const e of Va)if(!c(e)&&-1!==t.indexOf(e))return!0;return!1}function at(){let e=null;return host.clientIdentifier===Ai?e="messages":host.clientIdentifier===Si&&(e="watch"),e}function ct(e){return ot(new Mi(e)).toString()}function lt(e){return!c(e)&&!isNaN(e)}function ut(e){let t=e.query.id;const n=e.pathname;if(c(t)&&p(n)){const e=$a.exec(n);e&&e.length>1&&(t=e[1])}if(!lt(t)){const n=e.pathComponents();p(n)&&(t=n[n.length-1])}return t}function pt(e){const t=ut(e);if(!lt(t))throw new Error(`Unable to map ${e.build()} to a media api url`);let n="apps",r=Ba,o=["customers-also-bought-apps","developer-other-apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items"];return-1!==e.pathname.indexOf("app-bundle")&&(n="app-bundles",r=["screenshotsByType","videoPreviewsByType","minimumOSVersion"],o=["developer-other-apps","apps","reviews","related-editorial-items"]),(new Mi).forType(n).withIds([t]).includingAdditionalPlatforms(M()).includingRelationships(o).includingAttributes(r).addingRelationshipLimit("reviews",U()).attributingTo(e.build())}function dt(){const e=["editorialArtwork","requiredCapabilities","minimumOSVersion"];return"mac"===Ii?e.push("screenshotsByType"):e.push("isAppleWatchSupported"),e}function ft(){let e=[];return"mac"===Ii?e.push(ja):e=e.concat(qa),e}function ht(e,t){const n=c(e.title)?t.title:e.title,r={id:ce(t.id),idType:ae(t),impressionType:se(t),name:ce(n)};if(t&&t.kind&&(r.kind=t.kind),t&&t.recoMetricsData&&Object.assign(r,t.recoMetricsData),t&&t.locationTracker){const e=ye(t.locationTracker);r.impressionIndex=e,""===r.id&&(r.id=e.toString(),r.idType="sequential")}return u(t.offerType)&&(r.offerType=t.offerType),""===r.id&&console.log(`impressionId missing. Tracking broken for ${r.name} of ${r.impressionType}`),r}function mt(e,t){e&&(e.impressionFields=ht(e,t))}function gt(e,t,n){return yt(e,t.title,n)}function yt(e,t,n){return Fo.c("impressionOptions",()=>{const r=function(e){const t=h(e,"type"),n=te(e,"mac",!0),r=ne(e,"mac",!0),o=function(e,t,n=!1){const r=new Set(oe(e,n));for(const e of["iphone","ipad","ipod","tvos"])if(r.has(e))return!0;return!1}(e,0,!0),i=re(e,["iphone","ipad","ipod","tvos"],!0),s="phone"===Ii||"pad"===Ii||"tv"===Ii;if(r||n&&"mac"===Ii)switch(t){case"apps":return"macSoftware";case"app-bundles":return"macSoftwareBundle"}if(i||o&&s)switch(t){case"apps":return"iosSoftware";case"app-bundles":return"mobileSoftwareBundle"}switch(t){case"in-apps":return"softwareAddOn";case"groupings":return"grouping";case"editorial-elements":case"editorial-items":return"editorialItem";default:return null}}(e),o=Object.assign({},n,{kind:r,title:t,id:e.id});return qr(e)&&(o.offerType="preorder"),o})}function wt(){ask.storeMetrics.flushUnrecordedEvents()}function Tt(e){return u(e)?j(e,"customUrl"):null}function St(e,t,n,r){if(!p(n)&&"mac"!==Ii)return e;const o=new da(t,e),i=new aa(n);return Le(i,{actionType:"open",actionDetails:{actionUrl:n},id:t,pageInformation:r.pageInformation,locationTracker:r.locationTracker}),o.openAction=i,o}function At(e,t,n){const r=n[nc]||{};if(r.pageType=e,r.pageId=t,"Software"===e){const e=Ve(n),t=j(e,"name"),o=j(e,"artistName");r.pageDetails=`${o}_${t}`}else"Genre"===e?r.pageDetails=`${e}_${t}`:"Search"===e&&(r.pageDetails="Apps");const o=new sc(ue(r));o.timingMetrics=n[ec],o.pageUrl=n[tc];const i=n[rc];if(i){const e=JSON.parse(i);o.iAdInfo=new ic(h(e,"iAdId")),o.iAdInfo.applyClickFieldsFromPageRequest(t,e)}return o.recoMetricsData=qe(n),o}function vt(e,t,n,r){const o=new sc({pageType:e,pageId:t,page:`${e}_${t}`,pageDetails:n});return r&&(o.iAdInfo=new ic(h(r,"iAdId")),o.iAdInfo.applyClickFieldsFromPageRequest(t,r)),o}function It(e,t,n){if(c(t))return;const r=function(e,t){const n=kt(e,t);e.searchTerm&&(n.searchTerm=e.searchTerm);const r=be(n);e.iAdInfo&&Object.assign(r,e.iAdInfo.impressionsFields);const o=new gs(r);let i=[o];if(e.iAdInfo){const t=be(n);Object.assign(t,e.iAdInfo.impressionsFields),i=[new ys(r),o]}return i}(t,n);r.push(function(e,t){const n=kt(e,t);return e.iAdInfo&&Object.assign(n,e.iAdInfo.pageFields),u(e.offerReleaseDate)&&(n.offerReleaseDate=xe(e.offerReleaseDate)),e.searchTerm&&(n.searchTerm=e.searchTerm),fs.copyTimingMetricsInto(e.timingMetrics,n),new fs(n)}(t,n)),r.push(function(e,t){const n=kt(e,t);return e.searchTerm&&(n.searchTerm=e.searchTerm),ms.copyTimingMetricsInto(e.timingMetrics,n),new ms(n)}(t,n)),e instanceof ac||r.push(bt(t,n)),e.metricsEvents=r}function bt(e,t){const n=kt(e,t);return new ps(n)}function kt(e,t){const n=Ie(e);return c(n.pageUrl)&&u(e.timingMetrics)&&(n.pageUrl=e.timingMetrics.pageURL),u(e.offerType)&&(n.offerType=e.offerType),n&&t&&t(n),n}function _t(e){return-1!==vc.indexOf(e.protocol)}function Pt(e){return e.startsWith("{")&&e.endsWith("}")}function Ct(e,t){let n=[];if(n=(n=e?kc:_c).slice(),t&&t.spotlightSection){const e=function(e,t){let n=0;for(const r of t){if(r.type===e.type){if("shelf"!==r.type)return n;if(r.shelfId===e.shelfId)return n}n+=1}return-1}(t.spotlightSection,n);-1!==e&&(n.splice(e,1),n.splice(Pc,0,t.spotlightSection))}return n}function Et(e){return new Tc("shelf",e?"subscriptions":"inAppPurchases")}function Ot(e){if(!Lo.isContentGiftingEnabled)return null;if(c(e))return null;const t=Vr(e);return c(t)?null:qr(e)?null:m(t,"price")>0?e.id:null}function Rt(e,t,n,r,o,i,s){return o?Fo.c("shareSheetDataWithContext",()=>{let a=null,l=null,p=null,d=null;u(s)&&j(s,"url")&&(t&&(l=Ot(s)),a=no(s),p=z(s,"contentRatingsBySystem.appsApple.value"),d=function(e){return Fo.c("notesMetadataFromProductData",()=>{if(c(e))return null;const t=j(e,"name");if(!t||0===t.length)return null;const n=j(e,"artistName"),r=j(e,"genreNames.0"),o=wo(e);let i;switch(e.type){case"apps":i="app";break;case"app-bundles":i="bundle";break;case"in-apps":i="iap";break;default:i=null}return new fi(t,n,r,o,i)})}(s));let f=null;switch(n){case Ai:f="messages";break;case Si:f="watch"}if(f){const e=new as(o);if(e.param(rs.clientSpecifier,f),o=e.toString(),i){const e=new as(i);e.param(rs.clientSpecifier,f),i=e.toString()}}return new hi(e,r,o,i,a,l,p,d)}):null}function Dt(e,t){return c(e)?null:Fo.c("shareSheetDataForProductFromProductData",()=>{const n=j(e,"url"),r=j(e,"shortUrl"),o=j(e,"name"),i=j(e,"artistName");if(!n||!o||!i)return null;const s=_("SHARE_SHEET_PRODUCT_TITLE_FORMAT").replace("{title}",o).replace("{developer}",i);return Rt("product",t,host.clientIdentifier,s,n,r,e)})}function xt(e,t){const n=ot(e).toString(),r=mediaToken.tokenString;let o;return(o=""===r?mediaToken.refreshToken().then(e=>Lt(n,e,t)):Lt(n,r,t)).then(t=>{const n=t;return e.canonicalUrl&&(n[tc]=e.canonicalUrl),n})}function Ft(e){return Lo.redirectUrlWhitelistedQueryParams.filter(t=>u(e.query[t]))}function Lt(e,t,n={},r=!1){const o=new as(e),i=Ft(o);for(const e of i)o.removeParam(e);let s=n.headers;return s||(s={}),s.Authorization="Bearer "+t,net.fetch({url:e,headers:s,method:n.method,body:n.requestBodyString,timeout:n.timeout}).then(t=>{try{if(401===t.status||403===t.status){if(r)throw Error("We refreshed the token but we still get 401 from the API");return mediaToken.refreshToken().then(t=>Lt(e,t,n,!0))}if(404===t.status)Nt();else if(!t.ok){const n=new nl(`Bad Status code ${t.status} for ${e}`);throw n.statusCode=t.status,n}const o=Date.now(),i=JSON.parse(t.body),s=Date.now();if(i){if(i[nc]=function(e){const t=Ci;let n=null;if(p(t)){const e=t.split("-");p(e)&&(n=e[0])}return{serverInstance:e.headers[rl],storeFrontHeader:t,language:Lo.language,storeFront:n,environmentDataCenter:e.headers[ol]}}(t),t.metrics.length>0){const e=t.metrics[0];e.parseStartTime=o,e.parseEndTime=s,i[ec]=e}Array.isArray(i.data)&&function(e){return u(e)&&0===e.length}(i.data)&&Nt()}return i[tc]=e,i}catch(t){if(t instanceof nl)throw t;throw new Error(`Error Fetching: ${e}, ${t.name}, ${t.message}`)}})}function Nt(){const e=new nl("No content");throw e.statusCode=204,e}function Mt(e,t,n){const r=new ia(e,t);return n&&(r.presentationContext="push"),r}function Ut(e){const t=[],n=new Jc,r={};r[_("ACCOUNT_SETTINGS")]=new ia("finance","account"),n.footer=new Gs(_("PERSONALIZATION_DESCRIPTION_FOOTER_OPTED_IN").replace("{account_settings}",_("ACCOUNT_SETTINGS")),r);const o=new Bs(_("PERSONALIZATION_DESCRIPTION_OPTED_IN"));n.addContentItem(new tl(o)),t.push(n);const i=new Jc(_("PERSONALIZATION_INTERACTIONS"));i.footer=new Gs(_("PERSONALIZATION_INTERACTIONS_FOOTER")),i.addContentItem(new Zc(_("PERSONALIZATION_PURCHASES"),Mt("purchases",null,!0),"navigation")),i.addContentItem(new Zc(_("PERSONALIZATION_SUBSCRIPTIONS"),Mt("finance",cl,!1),"navigation")),i.addContentItem(new Zc(_("PERSONALIZATION_PREORDERS"),Mt("finance",ll,!0),"navigation")),i.addContentItem(new Zc(_("PERSONALIZATION_RATINGS"),Mt("finance",al,!0),"navigation")),t.push(i);const s=new Jc(_("PERSONALIZATION_ADDITIONAL_INFO")),c=[_("PERSONALIZATION_ADDITIONAL_INFO_ITEM_1"),_("PERSONALIZATION_ADDITIONAL_INFO_ITEM_2"),_("PERSONALIZATION_ADDITIONAL_INFO_ITEM_3"),_("PERSONALIZATION_ADDITIONAL_INFO_ITEM_4"),_("PERSONALIZATION_ADDITIONAL_INFO_ITEM_5")].join("\n"),l=new Bs(c);s.addContentItem(new tl(l)),t.push(s);const u=a(e,"results.derived-user-info");if(p(u)){const e=new Jc(_("ACCOUNT_INFO")),n=["gender","birthyear"];for(const t of n){const n=h(u,`${t}.label`),r=h(u,`${t}.value`);p(n)&&p(r)&&e.addContentItem(new el(n,r))}e.footer=new Gs(_("PERSONALIZATION_ACCOUNT_INFO_FOOTER")),t.push(e)}return new Kc(_("RECOMMENDATIONS"),t)}function Vt(e){switch(j(e,"editorialContext")){case"Watch":return"com.apple.AppStore.BridgeStoreExtension";case"Messages":return"com.apple.MobileSMS";default:return null}}function Bt(e){return Fo.c("developerPageFromResponse",()=>{const t=e.data.length?e.data[0]:null;if(!t)return null;const n=At("Artist",t.id,e),r=function(e,t,n){return"mac"===Ii?function(t,n,r){const o=ee(e,ja),i={lockupOptions:{metricsOptions:{pageInformation:n,locationTracker:r}},filter:Wo.DeveloperPage};me({pageInformation:n,locationTracker:r,idType:"sequential",id:"0",targetType:"swoosh"},ja);const s=qt(o,"screenshotsLockup",i),a=o.filter(e=>l(e.attributes)),c={id:null,kind:null,targetType:"swoosh",title:ja,pageInformation:n,locationTracker:r,idType:null};if(ge(r),mt(s,c),we(r),a.length){const e=new gl;e.contentType="screenshotsLockup",e.remainingData=a,e.lockupListOptions=i,s.url=`${qi.internal}:/${ji.developer}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(e))}return[s]}(0,t,n):function(e,t,n){let r=0;const o=[];for(const s of qa){const a=X(e,s),c=d(a,"data"),p=c.length;if(0===p)continue;let f,h=!1;"imessage-apps"===s?f=Ai:"watch-apps"===s?f=Si:"atv-apps"===s?(f="AppleTV",h=!0):f=Ti;const m=$t(s,e);me({pageInformation:t,locationTracker:n,idType:"sequential",id:`${r}`,targetType:"swoosh"},m);const g={excludeIconInSidepacksIfNotTvOnly:h,lockupOptions:{metricsOptions:{pageInformation:t,locationTracker:n},clientIdentifierOverride:f},filter:Wo.DeveloperPage},y=qt(c,"smallLockup",g);if(y.title=m,a.next){const r=new ia("page"),o=new yl;o.title=m,o.href=a.href,o.developerId=e.id,o.relationshipId=s,r.pageUrl=u(i=o)?`${qi.internal}:/${ji.developer}/${ji.room}/`+encodeURIComponent(JSON.stringify(i)):null,r.title=_("ACTION_SEE_ALL"),y.seeAllAction=r,Ne(r,r.pageUrl,{pageInformation:t,locationTracker:n}),r.pageData=fl.seeAllPage(m)}if(p<3&&(y.rowsPerColumn=p),"latest-release-app"===s&&0===p)continue;const w=c.filter(e=>l(e.attributes)),T={id:null,kind:null,targetType:"swoosh",title:y.title,pageInformation:t,locationTracker:n,idType:null};if(ge(n),mt(y,T),we(n),w.length){const e=new gl;e.contentType="smallLockup",e.remainingData=w,e.lockupListOptions=g,y.url=`${qi.internal}:/${ji.developer}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(e))}y.items.length>0&&(o.push(y),r++)}var i;return o}(e,t,n)}(t,n,{rootPosition:0,locationStack:[]});1===r.length&&(r[0].isHorizontal=!1);const o=bo(t,"standard");if(o){const e=new Bs(o,"text/x-apple-as3-nqml"),t=new ta("paragraph");t.items=[e],r.unshift(t)}const i=new ka(r);i.title=j(t,"name"),i.presentationOptions=["prefersLargeTitle"],It(i,n);const s=$(t,"editorialArtwork.bannerUber");return s&&(i.uber=to(s,null,"sr")),i})}function $t(e,t){switch(e){case"latest-release-app":return _("DEVELOPER_LATEST_RELEASE");case"system-apps":return _("DEVELOPER_SYSTEM_APPS");case"imessage-apps":return _("DEVELOPER_IMESSAGE");case"watch-apps":return _("DEVELOPER_WATCH");case"atv-apps":return _("DEVELOPER_TV");case"app-bundles":return _("DEVELOPER_BUNDLES");case"ios-apps":const n=G(t,"hasApps"),r=G(t,"hasGames");return _(n&&r?"DEVELOPER_APPS_AND_GAMES":r?"DEVELOPER_GAMES":"DEVELOPER_APPS");default:return null}}function qt(e,t,n){const r=new ta(t);switch(t){case"screenshotsLockup":r.items=function(e,t){return Fo.c("screenshotsLockupsFromData",()=>{if(!e)return[];const n=[];for(let r=0;r<e.length;r++){const o=e[r];if(c(o.attributes)){t.contentUnavailable&&t.contentUnavailable(o.id,r);continue}const i=t.lockupOptions;let s=Wo.All;if(null!==t.filter&&(s=t.filter),eo(o,s))continue;const a=Cr(o,i);a.isValid()&&(n.push(a),we(t.lockupOptions.metricsOptions.locationTracker))}return n})}(e,n),r.isHorizontal=!1,r.presentationHints=new na,r.presentationHints.showSupplementaryText=!1;break;case"smallLockup":default:r.items=Rr(e,n),r.isHorizontal=!0}return r}function jt(e,t){return Fo.b(`module: ${t.module}`,()=>{let n;switch(t.module){case"Header":t.titleForNextShelf=j(e,"editorialCopy"),n=null;break;case"TextBlock":n=function(t,n){const r=j(e,"editorialCopy");if(!r)return null;const o=new Bs(r,"text/x-apple-as3-nqml","article");Wt(o,n);const i=new ta("paragraph");return i.items=[o],i}(0,t);break;case"CollectionLockup":n=function(e,t){const n=G(e,"showOrdinals"),r="OrdinalDesc"===j(e,"collectionLockupDisplayType")?"descending":"ascending",o={metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride},i=j(e,"collectionLockupSize");let s;if(t.subStyle=i,i)switch(i){case"Large":s="largeLockup";break;case"Medium":s="mediumLockup";break;case"Small":default:s="smallLockup"}const a=Rr(ee(e,"contents"),{includeOrdinals:n,ordinalDirection:r,lockupOptions:o});if(!a||0===a.length)return null;const c=new ta(s);return c.items=a,c}(e,t);break;case"InlineImage":n=function(e,t){let n=to($(e,"artwork"));const r=j(e,"inlineImageDisplayType");if(!n)return null;"FullWidth"===r&&(n=n.createArtworkWithFullWidthCanvasArtWorkaround());const o=new Ks(n,!1,"text/x-apple-as3-nqml");if(o.caption=j(e,"editorialCopy"),t.subStyle=r,r)switch(r){case"BoundingBox":o.isFullWidth=!1,o.hasRoundedCorners=!0;break;case"FullWidth":default:o.isFullWidth=!0,o.hasRoundedCorners=!1}Wt(o,t);const i=new ta("framedArtwork");return i.items=[o],i}(e,t);break;case"AppLockup":n=function(e,t){const n=zt(e);if(!n)return null;const r=j(e,"appLockupSize");let o,i;t.subStyle=r;let s=!1;if(r)switch(r){case"Small":o="smallLockup",s=!0;break;case"Medium":o="mediumLockup",s=!0;break;case"Large":default:o="appShowcase",i="large"}const a=new ta(o),c=Tt(e);if(s){const e=kr(n,{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:c});a.items=[e]}else{const r=kr(n,{offerStyle:"colored",metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:c}),o=new Is(i,r);o.description=Ir(n);let s=null;switch(j(e,"appLockupVideo")){case"AppTrailer":{const e=so(n);e&&e.length>0&&(s=e[0]);break}}s&&(ke(s,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId}),o.video=s),a.backgroundColor=Is.backgroundColor,a.items=[o]}return a}(e,t);break;case"TipBlock":n=function(e,t){const n=to($(e,"artwork"));if(!n)return null;const r=j(e,"editorialCopy"),o=j(e,"tipNumber"),i=new Ks(n,!1,"text/x-apple-as3-nqml");i.isFullWidth=!1,i.hasRoundedCorners=!0,i.caption=r,i.ordinal=o,Wt(i,t);const s=new ta("framedArtwork");return s.items=[i],s}(e,t);break;case"PullQuote":n=function(e,t){const n=j(e,"quote"),r=j(e,"quoteAttribution"),o=to($(e,"artwork")),i="FullWidth"===j(e,"pullQuoteDisplayType"),s=new Zs(n,r,o,i);Wt(s,t);const a=new ta("quote");return a.items=[s],a}(e,t);break;case"InlineVideo":n=function(e,t){const n=to($(e,"video.previewFrame"));if(!n)return null;const r=j(e,"video.video");if(!r)return null;const o="FullWidth"===j(e,"inlineVideoDisplayType"),i=new _s(r,n);ke(i,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId});const s=new Js(i,o,"text/x-apple-as3-nqml");s.caption=j(e,"editorialCopy"),Wt(s,t);const a=new ta("framedVideo");return a.items=[s],a}(e,t);break;case"AppMedia":n=function(e,t){const n=zt(e);if(!n)return null;const r=j(e,"appMediaOption"),o=j(e,"appMediaPlatform");switch(t.subStyle=r,r){case"Screenshots":{let e=null;if("mac"===Ii){e=new ta("productMedia");const t=co(n);u(t)&&t.length&&(e.items=t)}else if(e=new ta("screenshots"),c(o)){const t=ao(n);t&&t.length>0&&(e.items=[t[0]])}else{const t=function(e){switch(e){case"Watch":return"watch";case"iOS":return"pad"===Ii?"pad":"phone";case"tvOS":return"tv";case"Messages":return"messages";default:return null}}(o);if(t){const r=ao(n,[t]);r&&r.length&&(e.items=[r[0]])}}return u(e)&&0===e.items.length?null:e}case"AppTrailers":const e=new ta("framedVideo"),i=so(n);if(i&&i.length>0){const n=i[0];ke(n,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,id:t.pageId});const r=new Js(n,!1,"text/plain",null,null,!0);return e.items=[r],e}return null;default:return null}}(e,t);break;case"LinkBlock":n=function(e,t){const n=j(e,"url");if(!n)return null;const r=j(e,"urlTitle");let o=j(e,"editorialCopy");if(!o){o=new as(n).host}const i=new aa(n);Le(i,{targetType:"link",pageInformation:t.metricsPageInformation,id:`${t.index}`,locationTracker:t.metricsLocationTracker});const s=new Hs(r,o,i);Wt(s,t);const a=new ta("link");return a.items=[s],a}(e,t);break;case"TextList":n=function(e,t){const n=q(e,"editorialCopy");if(!n.length)return null;const r=j(e,"textListDisplayType");t.subStyle=r;let o,i=!1;switch(r){case"Bulleted":i=!0;break;default:i=!1}o=i?"<ul>":"<ol>";for(const e of n)o=`${o}<li>${e}</li>`;const s=new Bs(o=i?`${o}</ul>`:`${o}</ol>`,"text/x-apple-as3-nqml","article");Wt(s,t);const a=new ta("paragraph");return a.items=[s],a}(e,t);break;case"IAPLockup":n=function(t,n){const r=zt(e);if(!r)return null;const o=_r(r,{metricsOptions:{pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},clientIdentifierOverride:n.clientIdentifierOverride});if(!o)return null;const i=new ks(o),s=new ta("inAppPurchaseShowcase");return s.backgroundColor=ks.backgroundColor,s.items=[i],s}(0,t);break;case"AppMarker":n=function(t,n){const r=j(e,"appMarkerType");n.subStyle=r;let o=null;switch(r){case"OSUpgrade":o=function(e,t){if(!S("clientControlButton"))return null;if("mac"!==Ii)return null;const n=Ue(Ii);if(null===n)return null;const r=new aa(n);Le(r,{targetType:"link",pageInformation:t.metricsPageInformation,id:`${t.index}`,locationTracker:t.metricsLocationTracker});const o=_("CLIENT_CONTROL_OS_UPGRADE_TITLE","CHECK FOR UPDATE"),i=new ea(o,r);Wt(i,t);const s=new ta("clientControlButton");return s.items=[i],s}(0,n)}return o}(0,t);break;case"StoryList":n=function(e,t){const n=ee(e,"contents");if(!n)return null;const r=j(e,"name"),o=j(e,"tagline");return zn(n,"mac"===Ii?"smallStoryCard":"todayBrick",r,o,t,null)}(e,t);break;default:console.log(`Unknown module: ${t.module}`),n=null}return n})}function Ht(e){const t=ee(e,"card-contents");if(1!==t.length)return null;const n=t[0];if(!n)return null;switch(n.type){case"apps":case"app-bundles":return n;default:return null}}function Gt(){switch(Ii){case"mac":return"white";default:return"vibrant"}}function zt(e,t){return Z(e,"contents")||null}function Wt(e,t){if(!e)return;let n=t.module;t.subStyle&&(n=n+"_"+t.subStyle);const r={id:`${t.index}`,idType:"sequential",impressionType:n,kind:"iosModule"};e.impressionFields=ue(r)}function Yt(e){return(new Mi).forType("multiple-system-operators").withIds([e]).includingRelationships(["apps","channel-apps"])}function Qt(e,t){return Fo.c("msoRoomPageWithResponse",()=>{const n=Ve(e),r=At("Room",n.id,e),o=ee(n,"apps"),i=ee(n,"channel-apps");for(const e of i){const t=Z(e,"app");p(t)&&o.push(t)}const s=!G(n,"doNotFilter"),a=new pl;a.ids=o.map(e=>e.id),a.shouldFilter=s,a.metricsPageInformation=r;const c=function(e,t,n,r=[]){return Fo.c("msoRoomPageWithContext",()=>{const o=[],i=[];for(const n of e)-1!==t.indexOf(n.id)?o.push(n):i.push(n);const s={rootPosition:0,locationStack:[]},a={lockupOptions:{metricsOptions:{pageInformation:n.metricsPageInformation,locationTracker:s}}},c=[],l={pageInformation:n.metricsPageInformation,locationTracker:s,targetType:"swoosh",idType:"sequential",id:"0"};if(o.length>0){const e=_("MSO_INCLUDED_IN_SUBSCRIPTION"),t=new pl;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=s,t.preferredShelfContentType="mediumLockup",l.id="0",me(l,e),a.contentUnavailable=function(e,n){return t.remainingContent.push(o[n]),!1};const r=new ta("mediumLockup");r.title=e,r.shouldFilterApps=n.shouldFilter,r.items=Rr(o,a),r.url=Kt(t),ge(s),we(s),c.push(r)}if(o.length>0&&i.length>0){const e=_("MSO_AVAILABLE_WITH_UPGRADED_SUBSCRIPTION"),t=new pl;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=s,t.preferredShelfContentType="mediumLockup",l.id="1",me(l,e),a.contentUnavailable=function(e,n){return t.remainingContent.push(i[n]),!1};const r=new ta("mediumLockup");r.title=e,r.shouldFilterApps=n.shouldFilter,r.items=Rr(i,a),r.url=Kt(t),ge(s),we(s),c.push(r)}if(0===c.length){const t=new pl;t.remainingContent=[],t.metricsPageInformation=n.metricsPageInformation,t.metricsLocationTracker=s,t.preferredShelfContentType="smallLockup",l.id="0",me(l,null),a.contentUnavailable=function(n,r){return t.remainingContent.push(e[r]),!1};const r=new ta("mediumLockup");r.shouldFilterApps=n.shouldFilter,r.items=Rr(e,a),r.url=Kt(t),ge(s),we(s),c.push(r)}for(const e of c)e.isHorizontal=c.length>1;const u=r.concat(c);return new ka(u)})}(o,t,a);return c.title=j(n,"name"),c.isIncomplete=!1,It(c,r),c})}function Kt(e){return e.remainingContent.length?`${qi.internal}:/${ji.mso}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(e)):null}function Jt(e,t,n){return Fo.c("topChartsPageFromApiResponse",()=>{const r=function(e){return d(e,"results.apps").filter(e=>!c(e.data))}(e),o=At("TopChartsPage",null,e),i=r.map(e=>(function(e,t){return Fo.c("segmentFromData",()=>{const n={rootPosition:0,locationStack:[]},r=[];let o=0;const i=[];for(const s of e.data){const e=Zt(o,s,t,n);if(e){if(eo(s))continue;r.push(e),we(n),o++}else i.push(s)}const s=[],a=new ta("smallLockup");a.items=r,s.push(a);let l=h(e,"shortName");const u=h(e,"name"),p=h(e,"chart");c(l)&&(l=u);const d=new bl(l,u,p,s),f=function(e,t,n=null,r,o){return{remainingContent:e,maxPerPage:La,highestOrdinal:0,url:null,metricsPageInformation:r,metricsLocationTracker:o}}(i,0,e.next,t,n);return f.metricsPageInformation=t,f.metricsLocationTracker=n,f.highestOrdinal=o,d.nextPage=f,It(d,t),d})})(e,o)).sort((e,t)=>e.chart.localeCompare(t.chart)),s=h(r,"0.href"),a=new as(s),l=a.query.genre,u=a.query.ages,p=_("PAGE_TITLE_TOP_CHARTS"),f=[];if(null!=t)for(const e of t.categories)e.genreId&&f.push(Xt(e));const m=function e(t,n,r){for(const o of r){if(n&&o.ageBandId===n||!n&&!o.ageBandId&&o.genreId===t)return o;const r=e(t,n,o.children);if(r)return r}return null}(l,u,f);let g;g=null!=m?new _l(l,m.ageBandId,p,i,m.name,f):new _l(l,null,p,i,null,f);const y=i.findIndex(e=>e.chart===n);return y>=0&&(g.initialSegmentIndex=y),g})}function Xt(e){const t=function(e,t=null){let n=(new Mi).forType("charts").addingQuery("types","apps").addingQuery("genre",e);return t&&(n=n.addingQuery("ages",t)),n}(e.genreId,e.ageBandId),n=e.children.map(e=>Xt(e));return new kl(e,ot(t).toString(),n)}function Zt(e,t,n,r){return Fo.c("lockupFromApiChartItem",()=>kr(t,{ordinal:E(e+1),maxSubtitleCount:1,metricsOptions:{pageInformation:n,locationTracker:r}}))}function en(e,t,n=null,r=null,o=host.clientIdentifier){let i;i="story"===n?["editorial-items"]:"developer"===n?["developers"]:["apps","developers","groupings","editorial-items","app-bundles","in-apps"];const s=(new Mi).withSearchTerm(e).searchingOverTypes(i).includingAdditionalPlatforms(tn(Do)).includingRelationships(["apps","top-apps"]).includingAttributes(["screenshotsByType","messagesScreenshots","videoPreviewsByType","requiredCapabilities","editorialBadgeInfo","supportsFunCamera","minimumOSVersion"]);for(const e of Object.keys(t))s.addingQuery(e,t[e]);return"hints"===r?s.addingQuery("src","hint"):"trending"===r&&s.addingQuery("src","trending"),o===Si?s.searchingContext("watch"):o===Ai&&s.searchingContext("messages"),s}function tn(e=Do){switch(e.deviceType){case"pad":return["iphone"];default:return[]}}function nn(e,t){const n=new ac;return u(e)&&(n.facets=rn(e,t)),n.results=[],n}function rn(e,t){const n=[];if("mac"!==Ii&&n.push(new cc("targetPlatform",[new lc(_("SEARCH_FACET_IPAD_ONLY"),null,e.targetPlatform),new lc(_("SEARCH_FACET_IPHONE_ONLY"),"iphone",e.targetPlatform)])),n.push(new cc("price",[new lc(_("SEARCH_FACET_ANY_PRICE","Any"),null,e.price),new lc(_("SEARCH_FACET_FREE","Any"),"free",e.price)])),t){const r=t.categories;if(r.length){const t=r.filter(e=>u(e.genreId)).map(t=>new lc(t.name,t.genreId,e.genre));t.unshift(new lc(_("SEARCH_FACET_ANY_CATEGORY","Any"),null,e.genre)),n.push(new cc("genre",t))}}const r=Lo.searchSortOptions,o=[];o.push(new lc(_("SEARCH_FACET_RELEVANCE"),null,e.sort));for(const t of r)o.push(new lc(_("SEARCH_FACET_"+t),t,e.sort));o.length>1&&n.push(new cc("sort",o));const i=Lo.ageBands.map(t=>new lc(h(t,"name"),h(t,"ageBandId"),e.ages));return i.length>0&&"mac"!==Ii&&n.push(new cc("ages",i)),n}function on(e,t,n,r){return Fo.c("searchResultContainerFromData",()=>{let o;const i=e.type,s={metricsOptions:{pageInformation:n,locationTracker:r,targetType:"card"},hideZeroRatings:!0};switch(i){case"rooms":case"multirooms":case"developers":case"editorial-items":case"groupings":const r={pageInformation:s.metricsOptions.pageInformation,locationTracker:s.metricsOptions.locationTracker},a=Qn(e,{useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0},r);if(a&&a.media&&"inAppPurchase"===a.media.kind){const e=a.media.lockup;e.theme="dark",o=new uc("inAppPurchase",e)}else{const t=function(e,t){return Fo.c("editorialSerachResultFromData",()=>{let n=new fc;n.title=j(e,"name");const r={pageInformation:t.pageInformation,locationTracker:t.locationTracker};switch(e.type){case"groupings":const t=q(e,"contentIds");if(p(t))n.collectionAdamIds=t;else{const t=to($(e,"artwork"),null);t.format="png",n.iconArtwork=t}n.type="category";break;case"rooms":case"multirooms":n.artwork=to($(e,"artwork"),null,"sr"),n.collectionAdamIds=q(e,"contentIds"),n.type="collection";break;case"editorial-items":n=function(e,t){const n={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0,prevailingCropCode:"fo"},r=Qn(e,n,t);if(!r)return null;const o=new fc;o.type="story",o.title=r.title,o.clickAction=r.clickAction;let i=null;if(r.media)switch(r.media.kind){case"brandedSingleApp":const t=r.media;switch(o.artwork=t.art,c(o.artwork)&&(o.iconArtwork=t.icon),j(e,"displaySubStyle")){case"GameOfDay":case"AppOfDay":const n=Z(e,"card-contents");n&&(o.title=j(n,"name")||o.title)}break;case"list":i=r.media.lockups;break;case"river":i=r.media.lockups;break;case"artwork":const n=r.media;o.artwork=n.art;break;case"grid":i=r.media.lockups;break;case"multiApp":i=r.media.lockups;break;case"video":const s=r.media;if(o.artwork=s.video.preview,o.video=s.video,r.overlay instanceof Gc){const e=r.overlay;o.title=e.title,o.subtitle=e.description}else o.subtitle=s.description}if(r.overlay)switch(r.overlay.kind){case"lockup":const e=r.overlay;o.artwork||(i=[e.lockup]);break;case"lockupList":i=r.overlay.lockups;break;case"paragraph":const t=r.overlay;o.subtitle=t.paragraph.text}if(u(i)){o.collectionAdamIds=[],o.collectionAppIcons=[];for(const e of i)o.collectionAdamIds.push(e.adamId),o.collectionAppIcons.push(e.icon)}const s=j(e,"alternateLabel");p(s)&&s!==o.title&&(o.tagline=s);const a=r.heroMedia;return p(a)&&(p(a.art)?(o.artwork=a.art,o.artwork.crop="em"):p(a.video)&&(o.video=a.video)),o.video&&(o.video.showPlaybackControls=!1,o.video.canPlayFullScreen=!1),o.collectionAdamIds||o.artwork||o.iconArtwork?o:null}(e,r);break;case"developers":if(n.artwork=to($(e,"editorialArtwork.bannerUber"),null,"sr"),!n.artwork){let t=ee(e,"top-apps");t=t.filter(e=>!eo(e,Wo.DeveloperPage));const r=[],o=[];t.forEach(e=>{r.push(e.id);const t=no(e);u(t)&&o.push(t)}),n.collectionAdamIds=r,n.collectionAppIcons=o}n.type="developer"}if(n){if(null!=n.collectionAdamIds&&n.collectionAdamIds.length){const e=n.collectionAdamIds.length;n.artworkGridType=e<=8?"large":e<=16?"mixed":"small"}const r=yt(e,n.title,t);n.clickAction=Dr(e,r,null),mt(n,r)}return n})}(e,s.metricsOptions);if(!t)return null;t.title&&(t.title=t.title.replace(/\n/g," ")),t.subtitle&&(t.subtitle=t.subtitle.replace(/\n/g," ")),o=new uc("editorial",t)}break;case"in-apps":const l=_r(e,s);l.theme="dark",o=new uc("inAppPurchase",l);break;case"apps":case"app-bundles":default:if(t&&n.iAdInfo&&n.iAdInfo.iAdIsPresent){s.metricsOptions.isAdvert=!0;const t=function(e,t,n){return Fo.c("adLockupFromData",()=>{const r=j(e,"iad.lineItem"),o=j(e,"iad.impressionId"),i=j(e,"iad.privacy"),s=new dc(i);s.title=_("IAD_PRIVACY_MARKER_BUTTON_TITLE");const a=new pc(r,o,s);if(G(e,"iad.format.images")){vr(e,a,n,t);const r=q(e,"iad.assetOverride");if(r.length){const e=function(e,t){const n=new Set(t),r=[],o=[],i=function(e,r){if(0===n.size)return!1;for(const o of t)if(o===r||-1!==e.indexOf(o))return n.delete(o),!0;return!1};if(t.length&&(e.screenshots.length||e.trailers.length)){if(e.trailers.length)for(const t of e.trailers[0].videos)i(t.videoUrl,t.preview.checksum)&&r.push(t);if(e.screenshots.length)for(const t of e.screenshots[0].artwork)i(t.template,t.checksum)&&o.push(t)}return!(0!==n.size||!r.length&&!o.length||(e.trailers.length&&(e.trailers[0].videos=r),e.screenshots.length&&(e.screenshots[0]=new ui(o,e.screenshots[0].mediaPlatform)),0))}(a,r);t.metricsOptions.pageInformation.iAdInfo&&t.metricsOptions.pageInformation.iAdInfo.iAdIsPresent&&t.metricsOptions.pageInformation.iAdInfo.setSpecifiedCreativeUsed(e)}Sr(e,a,t)}else Sr(e,a,t),a.screenshots=null;a.offerDisplayProperties&&(a.offerDisplayProperties=a.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"colored","ad")),G(e,"iad.format.userRating")||(a.rating=null,a.ratingCount=null);const c=j(e,"iad.format.text");return"none"!==c&&(a.advertisingText=Ce(e,"description"===c?"description.standard":c)),"regular"===j(e,"iad.format.icon")?a.iconStyle="regular":a.iconStyle="small",a})}(e,s,Ol),r=gt(e,t,s.metricsOptions);!function(e,t){const n=new ds(e.lineItem,e.impressionId,t.pageInformation.iAdInfo.iAdClickEventFields);if(e.clickAction){Le(e.clickAction,t,!0);const r=e.clickAction.metricsEvents?e.clickAction.metricsEvents:[];r.push(n),e.clickAction.metricsEvents=r}if(e.buttonAction){const t=e.buttonAction.metricsEvents?e.buttonAction.metricsEvents:[];t.push(n),e.buttonAction.metricsEvents=t}if(e.transparencyAction){const r=t.pageInformation,o={actionType:"ad_transparency"};Object.assign(o,Ie(r)),r.iAdInfo&&Object.assign(o,r.iAdInfo.clickFields);const i=new us(e.adamId,"button",o),s=e.transparencyAction.metricsEvents?e.transparencyAction.metricsEvents:[];s.push(i),s.push(n),e.transparencyAction.metricsEvents=s}}(t,r),function(e,t,n){if(!e||!n)return;mt(e,t);const r=ue(n.fastImpressionFields);Object.assign(e.impressionFields,r),e.impressionFields.isInFastQueue=!0,e.impressionFields.parentId="ad_container"}(t,r,n.iAdInfo),o=new uc("advert",t)}else if(delete e.attributes.iad,"app-bundles"===i){const t=Pr(e,s);o=new uc("bundle",t)}else{const t=function(e,t,n){return Fo.c("mixedMediaLockupFromData",()=>{const r=new Ls;return Sr(e,r,t),vr(e,r,n,t),r})}(e,s,Ol);o=new uc("content",t)}}return o})}function sn(e){return JSON.stringify(e)}function an(e){if(xl.has(e.builderClass))throw new Error(`routing: Registering duplicate builderClass ${e.builderClass}`);xl.add(e.builderClass),Fl.associate(e.pageRoute,e),Ll.associate(e.shelfRoute,e),Nl.associate(e.paginationRoute,e)}function cn(e,t){return ln(e).then(n=>new Promise((r,o)=>{if(!n)throw new Error(`Promise resolved to null action for: ${e}`);if("FlowAction"!==n.actionClass)return void o(new Error("Action is not a flowAction"));const i=n.pageData;!function(e,n){return i instanceof t}()?o(new Error(`${i} is not expected type ${t.name}`)):r(i)}))}function ln(e){return new Promise((t,n)=>{const r=Fl.routedObjectForUrl(e);r.object?r.object.handlePage(r.normalizedUrl,r.parameters,r.matchedRuleIdentifier,t,n):function(e,t,n){net.fetch({url:e.toString(),method:"GET"}).then(r=>{200===r.status&&r.redirected&&r.url?ln(r.url).then(t,n):n(new Error(`redirectAndRefetchActionIfPossible: Unhandled page url: ${e}`))})}(r.normalizedUrl,t,n)})}function un(e,t){t.isFirstRender=!1,t.isDeferring=!1,t.remainingItems=[];let n=new ta("mediumLockup");const r=t.featuredContentId;switch(r){case zo.AppStore_HeroList:case zo.AppStore_Hero:case zo.AppStore_CustomHero:case zo.Sundance_Flowcase:n=mn(e.data,t);break;case zo.AppStore_GenreStack:{const r=Z(t.featuredContentData,"children");r&&(n=Sn(pn(e.data,ee(r,"children")),t));break}case zo.AppStore_BrickRow:case zo.AppStore_Brick:case zo.AppStore_CustomBrick:case zo.Sundance_BrickRow:n=gn(pn(e.data,ee(t.featuredContentData,"children")),t);break;case zo.AppStore_LinkList:case zo.Sundance_LinkList:n=Tn(t.featuredContentData,t);break;case zo.AppStore_HorizontalCardSwoosh:{const r={metricsLocationTracker:t.metricsLocationTracker,metricsPageInformation:t.metricsPageInformation};n=wn(e.data,t.shelfStyle,t,r);break}default:if(En(r)){n=yn(e.data,t);break}console.warn("Unknown featured content ID:",t.featuredContentId)}if(t.remainingItems.length){const e=t.remainingItems.map(e=>e.id);console.warn("Could not load items for: "+e.join(","))}return n&&(n.mergeWhenFetched=!0,n.networkTimingMetrics=e[ec]),0===n.items.length&&(n.isHidden=!0),n}function pn(e,t){const n={};for(const t of e)n[t.id]=t;const r=["contents","grouping"],o=[];for(const e of t){let t=!0;for(const o of r){const r=ee(e,o);if(u(r)){const i=[];for(const e of r){const t=n[e.id];p(t)&&i.push(t)}i.length===r.length?e.relationships[o]={data:i}:t=!1}}t&&o.push(e)}return o}function dn(e,t){const n=z(e,"editorialElementKind");Fo.b(`walkFeaturedContent: ${n}`,()=>{const r=Z(e,"tabs");if(u(r))return void dn(r,t);const o=new Ul(n);o.metricsPageInformation=t.metricsPageInformation,o.metricsLocationTracker=t.metricsLocationTracker,o.pageGenreId=t.pageGenreId,o.featuredContentData=e,o.id=h(e,"id"),o.title=j(e,"name"),o.subtitle=j(e,"tagline");const i={id:o.id,kind:null,targetType:"swoosh",title:o.title,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"its_contentId",fcKind:n,recoMetricsData:fn(e)};let s,a=!1;switch(n){case zo.AppStore_Root:case zo.AppStore_TabRoot:case zo.AppStore_ChartSet:case zo.Sundance_Root:case zo.Sundance_TabRoot:case zo.Sundance_Stack:case zo.Sundance_QuickLinks:case zo.Sundance_TabSet:hn(e,t);break;case zo.AppStore_GenreStack:{const n=Z(e,"children");if(n){const e=ee(n,"children");e.length&&(me(i,o.title),s=Sn(e,o),ge(t.metricsLocationTracker),a=!0)}break}case zo.AppStore_HeroList:case zo.AppStore_Hero:case zo.AppStore_CustomHero:case zo.Sundance_Flowcase:me(i,o.title),s=mn(ee(e,"children"),o),ge(t.metricsLocationTracker),a=!0;break;case zo.AppStore_BrickRow:case zo.AppStore_Brick:case zo.AppStore_CustomBrick:case zo.Sundance_BrickRow:{me(i,o.title);let n=H(e,"suppressText");c(n)&&(n=!0);const r=!n;s=gn(ee(e,"children"),o,r),ge(t.metricsLocationTracker),a=!0;break}case zo.AppStore_LinkList:case zo.Sundance_LinkList:me(i,o.title),s=Tn(e,o),ge(t.metricsLocationTracker),a=!0;break;case zo.AppStore_DateBlock:{const n=j(e,"date");t.nextShelfTitle=n,hn(e,t);break}case zo.AppStore_HorizontalCardSwoosh:{me(i,o.title);const n=function(t){switch(j(e,"displayStyle")){case"small":return"smallStoryCard";case"medium":return"mediumStoryCard";case"large":return"largeStoryCard";default:return null}}();if("mac"===Ii&&("smallStoryCard"===n||"mediumStoryCard"===n||"largeStoryCard"===n)&&t.shelves.filter(e=>e.contentType===n).length>0)break;const r=ee(e,"contents"),c={metricsLocationTracker:o.metricsLocationTracker,metricsPageInformation:o.metricsPageInformation};s=wn(r,n,o,c),o.shelfStyle=n,s.url=Pn(o),ge(t.metricsLocationTracker),a=!0;break}default:if(En(n)){const r=!G(e,"doNotFilter"),l=j(e,"chartHref"),u=j(e,"chart"),d=Z(e,"room"),f=X(e,"contents");let h=f?f.data:null;if(Rn(n)){if(!t.hasAuthenticatedUser){console.log(`Skipping recommendations shelf with fcID ${n}: No user logged-in`);break}if(c(h)&&(o.recommendationsHref=e.href),G(e,"noPersonalizationAvailable"))break}if(h&&0!==h.length||(h=ee(e,"children")),p(l)){const e=function(e,t=host.clientIdentifier){const n=new Mi(e).includingAttributes(["isAppleWatchSupported","requiredCapabilities","minimumOSVersion"]);return t===Si?n.searchingContext("watch"):t===Ai&&n.searchingContext("messages"),n}(new as(l).param(Zi.chartIdentifier,u).toString());o.seeAllUrl=ot(e).toString()}else p(d)&&(o.seeAllUrl=ct(d.href));o.shouldFilter=r,o.shelfStyle=function(e,t,n){if(e===zo.AppStore_Shelf||e===zo.AppStore_PersonalizedShelfMarker||e===zo.Sundance_RecommendedAppsShelf||e===zo.Sundance_RecommendedGamesShelf){let t=j(n,"displayStyle");return t||(t=e===zo.Sundance_RecommendedAppsShelf||e===zo.Sundance_RecommendedGamesShelf?"large":"small"),`${t}Lockup`}if(e===zo.AppStore_iAPShelf)return"inAppPurchaseTiledLockup";if(e===zo.AppStore_ScreenShotShelf)return"screenshotsLockup";if(e===zo.Sundance_iPhoneAppTrailerShelf||e===zo.Sundance_iPadAppTrailerShelf||e===zo.AppStore_VideoShelf||e===zo.AppStore_TrailerShelf)return"appTrailerLockup";if(On(e))return"smallLockup";switch(t.shelves.length%3){case 0:return"smallLockup";case 1:return"mediumLockup";default:return"largeLockup"}}(o.featuredContentId,t,e),i.displayStyle=o.shelfStyle,On(n)&&(o.showOrdinals=!0,o.shouldFilter=!1),o.clientIdentifierOverride=Vt(e),me(i,o.title),s=yn(h,o),ge(t.metricsLocationTracker),a=!0;break}console.warn("Unknown featured content ID:",n)}const l=p(o.remainingItems),d=u(o.recommendationsHref),f=l||d;s&&(p(s.items)||f)&&(mt(s,i),t.shelves.push(s)),a&&we(t.metricsLocationTracker)})}function fn(e){const t=z(e,"editorialElementKind");switch(t){case zo.AppStore_GenreStack:case zo.AppStore_HeroList:case zo.AppStore_Hero:case zo.AppStore_CustomHero:case zo.Sundance_Flowcase:case zo.AppStore_BrickRow:case zo.AppStore_Brick:case zo.AppStore_CustomBrick:case zo.Sundance_BrickRow:return qe(X(e,"children"));case zo.AppStore_LinkList:case zo.Sundance_LinkList:{const t=X(e,"children"),n=q(e,"links");return p(t)?qe(t):p(n)?qe(e):null}default:if(En(t)){let t=X(e,"contents");if(c(t))return null;const n=t.data;return n&&0!==n.length||(t=X(e,"children")),qe(t)}return console.warn("Unknown featured content ID:",t),null}}function hn(e,t){const n=ee(e,"children");for(const e of n)dn(e,t)}function mn(e,t){const n=new ta("editorialCard");n.isHorizontal=!0,t.relationshipDataToFetch="contents";const r=[];for(const n of e){const e={targetType:"hero",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:qe(n)},o=bn(n,t,e,()=>{t.remainingItems.push(n)});if(!o)continue;const i=new qs;let s=j(n,"designBadge");s||(s=o.caption),i.caption=s;let a=j(n,"title");a||(a=o.title),i.title=a;let c=xn(j(n,"designTag"));if(c||(c=o.subtitle),i.subtitle=c,o.artwork&&t.featuredContentId!==zo.Sundance_Flowcase){const e=g(o.artwork,"subscriptionHero");i.artwork=_n(e)}else i.artwork=kn(n,416,204);i.clickAction=o.action,mt(i,yt(n,o.title,e)),i.isValid()&&(r.push(i),we(t.metricsLocationTracker))}return n.items=r,n.url=Pn(t),n}function gn(e,t,n){const r=[],o=new ta("brick");o.isHorizontal=!0;const i=[];for(const n of e){const e={targetType:"brick",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:qe(n)},o=bn(n,t,e);if(!o){i.push(n);continue}const s=new js;if(o.artwork&&t.featuredContentId!==zo.Sundance_BrickRow){let e=g(o.artwork,"subscriptionHero");e||(e=g(o.artwork,"originalFlowcaseBrick")),s.artwork=_n(e)}else s.artwork=kn(n,1060,520);s.accessibilityLabel=o.title,s.shortEditorialDescription=o.title,s.clickAction=o.action,z(n,"editorialElementKind")===zo.AppStore_MSOBrickMarker&&(s.personalizationStyle="mso"),mt(s,yt(n,o.title,e)),s.isValid()&&(r.push(s),we(e.locationTracker))}if(u(n)){const e=new na;e.showSupplementaryText=n,o.presentationHints=e}return u(a(t.featuredContentData,"relationships.children.data"))&&(t.featuredContentData.relationships.children.data=i),o.title=t.title,o.subtitle=t.subtitle,o.items=r,o.url=Pn(t),o}function yn(e,t){let n=[];const r=new ta(t.shelfStyle);let o,i;r.isHorizontal=!0,p(t)&&(o=t.clientIdentifierOverride);for(const r of e){if(c(r.attributes)||Dn(t)){t.isDeferring=!0,t.remainingItems.push(r);continue}if(eo(r))continue;let e;t.showOrdinals&&(e=t.ordinalIndex.toString());const i={ordinal:e,metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:qe(r)},clientIdentifierOverride:o};let s;(s="appTrailerLockup"===t.shelfStyle?Er(r,i,{}):"screenshotsLockup"===t.shelfStyle?Cr(r,i):kr(r,i))&&s.isValid()&&(n.push(s),we(t.metricsLocationTracker),t.ordinalIndex++)}if(On(t.featuredContentId)&&(n=function(e,t){if(!e)return null;const n=e.length,r=n%3;return n>=3?e.slice(0,n-r):e}(n)),On(t.featuredContentId))i=new ia("topCharts");else{i=new ia("page");const e=function(e){if(!e)return null;switch(e){case"inAppPurchaseLockup":case"inAppPurchaseTiledLockup":return e;default:return null}}(t.shelfStyle);i.pageData=fl.seeAllPage(t.title,e)}return i.pageUrl=t.seeAllUrl,i.title=_("ACTION_SEE_ALL"),i.referrerUrl=t.metricsPageInformation.pageUrl,Ne(i,t.seeAllUrl,{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker}),r.seeAllAction=i,r.title=t.title,r.subtitle=t.subtitle,r.items=n,r.shouldFilterApps=t.shouldFilter,r.url=Pn(t),"screenshotsLockup"===t.shelfStyle&&(u(r.presentationHints)||(r.presentationHints=new na),r.presentationHints.showSupplementaryText=!0),r}function wn(e,t,n,r){return zn(e,"mac"===Ii?t:"todayBrick",n.title,n.subtitle,r,function(e){return n.remainingItems.push(e),!1})}function Tn(e,t){const n=[],r=new ta("action");r.isHorizontal=!1;const o=ee(e,"children"),i=p(o),s=q(e,"links");let a=[];i?a=o:p(s)&&(a=s);for(const e of a){if(c(e))continue;const r={targetType:"link",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker};i&&(r.recoMetricsData=qe(e));const o=bn(e,t,r);if(!o)continue;const s=o.action;if(!s.title)continue;const a=Cn(e);a&&mt(s,Object.assign({},r,{kind:"link",title:s.title,id:a})),n.push(s),we(t.metricsLocationTracker)}return r.items=n,r.title=t.title,r.subtitle=t.subtitle,r.url=Pn(t),r}function Sn(e,t){const n=[];for(const r of e){const e=Z(r,"grouping");if(c(e))continue;const o=Cn(e);if(c(r.attributes)||c(e.attributes)||Dn(t)){t.isDeferring=!0,t.remainingItems.push(e);continue}const i={targetType:"listItem",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,recoMetricsData:qe(r)},s=Dr(e,Object.assign({},i,{id:o}),t.clientIdentifierOverride);mt(s,Object.assign({},i,{kind:"link",title:s.title,id:o}));const a=$(e,"artwork");p(a)&&(s.artwork=to(a),s.artwork.format="png"),n.push(s),we(t.metricsLocationTracker)}"mac"===Ii&&An(n);const r=function(e){const t=new ta("action");if(t.isHorizontal=!1,e.length>6&&"mac"!==Ii){t.items=e.slice(0,6);const n=new ia("page");n.title=_("ACTION_SEE_ALL"),t.seeAllAction=n;const r=new ta("action");r.isHorizontal=!1,An(e),r.items=e;const o=new ka([r]);o.title=_("PAGE_TITLE_CATEGORIES"),n.pageData=o}else t.items=e;return t}(n);return r.title=t.title,r.subtitle=t.subtitle,r.url=Pn(t),r}function An(e){e.sort((e,t)=>{try{return e.title.localeCompare(t.title,Li,{usage:"sort"})}catch(e){return 0}})}function vn(e){const t=new aa(e),n=_("TERMS_AND_CONDITIONS_TITLE"),r=new Rs(n);r.clickAction=t,r.presentationStyle=["hasChevron","textLightensOnHighlight"];const o=new ta("footnote");o.items=[r];const i=function(){if(!Lo.emailSupportLinkURL)return null;const e=new aa(Lo.emailSupportLinkURL),t=new Rs("Email Support");return t.clickAction=e,t.presentationStyle=["hasChevron","textLightensOnHighlight"],t}();return i&&o.items.push(i),o}function In(){if(Tl&&Tl.isManagedAppleID)return null;const e=new ta("titledButtonStack"),t=[],n=_("FOOTER_REDEEM","Redeem"),r=new ia("finance");r.pageUrl="redeem";const o=new Qs(n,r);if(t.push(o),Lo.isMonetaryGiftingEnabled){const e=_("FOOTER_SEND_GIFT","Send Gift"),n=new ia("finance");n.pageUrl="gift";const r=new Qs(e,n);t.push(r)}const i=Lo.accountTopUpURL;if(i){const e=_("FOOTER_ADD_MONEY"),n=new ia("finance");n.pageUrl=i;const r=new Qs(e,n);t.push(r)}const s=new Ys(t);return s.compactLineBreaks=s.buttons.map((e,t)=>t),e.items=[s],e}function bn(e,t,n,r){const o=p(h(e,"url")),i=p(j(e,"link.url")),s=J(e,"contents",!1);if(i||o)return function(e,t,n,r){const o=u(h(e,"url"))?e:$(e,"link");if(c(o)||Dn(t))return i=e,r?r():t.remainingItems.push(i),null;var i;const s=h(o,"target"),a=h(o,"url"),l=h(o,"label"),p=xn(j(e,"designTag"))||l;let d=null;if("external"===s)(d=new aa(a)).title=p;else{const e=function(e){const t=Fl.routedObjectForUrl(e);return t.object?t.object.pageType():"unknown"}(a),t=new ia(e);t.pageUrl=a,t.title=p,d=t}return d.presentationStyle=["textFollowsTintColor"],Le(d,Object.assign({},n,{id:""})),{action:d,caption:null,title:p,subtitle:null,artwork:null,shortEditorialDescription:null}}(e,t,n,r);if(s){const o=Z(e,"contents");if(c(o))return null;if(c(o.attributes)||Dn(t))return t.isDeferring=!0,function(e){r?r():t.remainingItems.push(e)}(o),null;let i=bo(o,"tagline")||Ir(o);const s=Dr(o,Object.assign({},n,{id:Cn(o)}),t.clientIdentifierOverride);s.presentationStyle=["textFollowsTintColor"];const a=xn(j(e,"designTag"));s.title=a||s.title;let l=null,u=null;const p=j(o,"itunesNotes.short");switch(o.type){case"groupings":l=$(o,"artwork");break;case"editorial-items":{(u=j(o,"label"))&&(u=u.replace(/\n/g," "));const e=Z(o,"contents"),t=h(o,"editorialNotes.tagline");t?i=t:e&&(i=bo(e,"short")),s.title=s.title||i||u}default:l=_e(o,"editorialArtwork")||$(o,"editorialArtwork")}return{action:s,caption:u,title:s.title,subtitle:i,artwork:l,shortEditorialDescription:p}}return null}function kn(e,t,n){const r=$(e,"artwork");if(r instanceof Array){const e=function(e,t,n){const r=t/n;let o=0,i=null;for(const n of e){const e=m(n,"width"),s=e/m(n,"height");(s===r||Math.abs(r-s)<=Math.abs(r-o))&&(!i||e<=t&&e>i.width||i.width>t&&e<i.width&&e>i.width)&&(i=n,o=s)}if(i){const e=h(i,"url"),t=m(i,"width"),n=m(i,"height"),r=h(i,"checksum");return new li(e,t,n,null,r)}return null}(r,t,n);return e.crop="bb",e}return null!=r?_n(r):null}function _n(e){const t=to(e);return t&&(t.crop="sr"),t}function Pn(e){return(e.remainingItems.length||e.recommendationsHref)&&e.isFirstRender?`${qi.internal}:/${ji.grouping}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(e)):null}function Cn(e){let t=j(e,"adamId");return t||(t=j(e,"contentId")),t||(t=j(e,"id")),t}function En(e){return On(e)||Rn(e)||e===zo.AppStore_Shelf||e===zo.AppStore_iAPShelf||e===zo.AppStore_ScreenShotShelf||e===zo.AppStore_VideoShelf||e===zo.AppStore_TrailerShelf||e===zo.Sundance_iPhoneAppTrailerShelf||e===zo.Sundance_iPadAppTrailerShelf||e===zo.Sundance_Shelf}function On(e){switch(e){case zo.Common_iPhoneTopChart:case zo.Common_iPhonePaidTopChart:case zo.Common_iPhoneFreeTopChart:case zo.Common_iPadTopChart:case zo.Common_iPadFreeTopChart:case zo.Common_iPadPaidTopChart:case zo.AppStore_iPhoneFreeTopChartV2:case zo.AppStore_iPhoneGrossingTopCharV2t:case zo.AppStore_iPadFreeTopChartV2:case zo.AppStore_iPadGrossingTopChartV2:case zo.AppStore_TVFreeTopChartV2:case zo.AppStore_TVGrossingTopChartV2:case zo.AppStore_WatchFreeTopChartV2:case zo.AppStore_WatchGrossingTopChartV2:case zo.AppStore_iPhonePaidTopChartV2:case zo.AppStore_iPadPaidTopChartV2:case zo.AppStore_TVPaidTopChartV2:case zo.AppStore_WatchPaidTopChartV2:case zo.AppStore_iPhoneiMessageFreeTopChart:case zo.AppStore_iPhoneiMessagePaidTopChart:case zo.AppStore_iPhoneiMessageGrossingTopChart:case zo.AppStore_iPadiMessageFreeTopChart:case zo.AppStore_iPadiMessagePaidTopChart:case zo.AppStore_iPadiMessageGrossingTopChart:case zo.AppStore_MacFreeTopChartV2:case zo.AppStore_MacPaidTopChartV2:case zo.AppStore_MacGrossingTopChartV2:return!0;default:return!1}}function Rn(e){return e===zo.Sundance_RecommendedAppsShelf||e===zo.Sundance_RecommendedGamesShelf||e===zo.AppStore_PersonalizedShelfMarker}function Dn(e){return e.isDeferring&&e.isFirstRender}function xn(e){if(c(e))return null;const t=e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`").replace(/\r\n/g," ").replace(/&nbsp;/g," ").replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<br>/g," ").replace(/⏎/g,"").replace(/<i>/g,"").replace(/<\/i>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");return t.match(/^\s*$/)?null:t}function Fn(e,t){const n={internalContentType:"shelf",shelf:t};e.push(n)}function Ln(e,t){const n={internalContentType:"contentPool",contentPool:new Bl(t)};e.push(n)}function Nn(e,t,n){if(l(e))return null;const r=e.shift();if("shelf"===r.internalContentType)return{contentType:"shelf",shelf:r.shelf};const o=r.contentPool,i=o.numberOfItemsProcessed,s=i>0;let a;a="greedy"===t&&o.isFullyHydrated?function(e){const t={label:e.label,title:e.title,meta:e.meta,date:e.date,contents:e.remainingContents};return e.numberOfItemsProcessed=e.remainingContents.length,e.remainingContents=[],t}(o):function(e,t){const n=e.remainingContents.length,r=e.remainingContents.slice(0,t),o=e.remainingContents.slice(t,n),i={label:e.label,title:e.title,meta:e.meta,date:e.date,contents:r};return e.numberOfItemsProcessed+=r.length,e.remainingContents=o,i}(o,n);const c=l(o.remainingContents),u={todayModule:a,isContinuationModule:s,isLastOfModule:c,contentOffsetWithinSourceModule:i};return c||e.unshift(r),{contentType:"moduleSlice",moduleSlice:u}}function Mn(e){const t=[],n=[];for(const r of e.todayModule.contents)$e(r)?t.push(r):n.push(r);return 0===n.length?Promise.resolve(e):xt(new Mi(n).includingAdditionalPlatforms(M()).includingAttributes(["editorialArtwork","minimumOSVersion"])).then(n=>{const r=Be(n),o=t.concat(r);return e.todayModule.contents=o,e}).catch(()=>(e.todayModule.contents=[],e))}function Un(e,t){const n=e.todayModule,r=t.todayModule;return{todayModule:{label:n.label,title:n.title,meta:n.meta,contents:n.contents.concat(r.contents)},isContinuationModule:e.isContinuationModule,isLastOfModule:t.isLastOfModule,contentOffsetWithinSourceModule:e.contentOffsetWithinSourceModule}}function Vn(e,t,n){let r=!1,o=[],i=[];for(let s=e.length-1;s>=0;s--){const a=e[s];$e(a)?1===t[a.id]?(n&&0===o.length&&o.unshift(...i),i=[],o.unshift(a),r=!0):(i.unshift(a),t[a.id]-=1):i.unshift(a)}return n&&0===o.length&&(o=i),{contents:o,contentsContainsHydratedData:r}}function Bn(e,t,n=null,r){const o=_("PAGE_TITLE_TODAY"),i=new Yc(e,n,r||o,o);return u(t)&&p(t.queue)&&(i.nextPage=t),i}function $n(e,t,n=!1){const r=Nn(e,"greedy",6);if(c(r))return null;let o,i=null;if("shelf"===r.contentType&&(i=r.shelf,o=!0),"moduleSlice"===r.contentType){const e=r.moduleSlice,s={contentOffsetWithinModule:e.contentOffsetWithinSourceModule,hideTitle:e.isContinuationModule,setTitleToDateForTodaySection:n};i=qn(e.todayModule,s,t),o=e.isLastOfModule}return u(i)&&o&&we(t.locationTracker),i}function qn(e,t,n,r=!1){const o=qe(e),i={id:null,kind:null,targetType:"swoosh",title:e.title,pageInformation:n.pageInformation,locationTracker:n.locationTracker,idType:"its_contentId",recoMetricsData:o};n.currentShelfRecoMetricsData=o;const s=new ta("todayCard");s.isHorizontal=!1,mt(s,i),me(i,e.title),function(e,t){const n=ve(e);n?n.position=t:e.rootPosition=t}(i.locationTracker,t.contentOffsetWithinModule);const f={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0};f.useThreeLineOverlayForBranded=!function(e){const t=a(e,"date");return"TodayForApps"===e.label||u(t)}(e)||r;const m=[],g=d(e.contents);let y=0;for(const e of g){if(!$e(e))break;const t=Qn(e,f,n);u(t)&&(m.push(t),we(n.locationTracker)),y++}const w=g.slice(y);e.contents=w,s.items=m;const T=h(e,"date");if("TodayForApps"===e.label&&t.setTitleToDateForTodaySection){const e=new Date;s.title=D("EEEE, MMMM d",e)}else if(p(T)){const e=De(T);s.title=D("EEEE",e),s.subtitle=D("MMMM d",e)}else s.title=e.title;if(t.hideTitle&&(s.title=void 0),ge(n.locationTracker),p(e.contents)){const r=t.contentOffsetWithinModule+y,o=new Hl(e,r,n.pageInformation,n.locationTracker);s.url=c((S=o).todayModule)||l(S.todayModule.contents)?null:`${qi.internal}:/${ji.today}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(S))}var S;return s}function jn(e){var t,n;const r=l(t=e.queue)?null:"shelf"===t[0].internalContentType?"shelf":"moduleSlice";if(c(r))return Promise.reject(new Error("today.nextPageFromPageToken called on end of page"));const o=(n=bi,"pad"===Ii?n.isEqualTo(fu)?6:2:1);if("shelf"===r){const t=Nn(e.queue,"conservative",6).shelf;return we(e.metricsContext.locationTracker),Promise.resolve(Bn([t],e))}return function(e,t,n){const r=Nn(e,"conservative",t);return"moduleSlice"!==r.contentType?Promise.reject(new Error("dequeueHydratedModuleSlice: TodayContentQueue dequeued unexpected contentType.")):Mn(r.moduleSlice).then(t=>{const r=t.todayModule.contents.length;let o=Math.ceil(r/n)*n;0===o&&(o=n);const i=o-r;return!t.isLastOfModule&&i>0?function e(t,n){if(0===n)return Promise.reject(new Error("hydrateContentsUntilCountOrEndOfModule: Hydrating module slice of size 0."));const r=Nn(t,"conservative",n);if("moduleSlice"!==r.contentType)return Promise.reject(new Error("hydrateContentsUntilCountOrEndOfModule: TodayContentQueue dequeued unexpected contentType."));const o=r.moduleSlice;if(o.isLastOfModule)return Mn(o);const i=o.todayModule.contents.length;return Mn(o).then(n=>{const r=n.todayModule.contents.length,o=i-r;return o>0?e(t,o).then(e=>Un(n,e)):n})}(e,i).then(e=>Un(t,e)):t})}(e.queue,6,o).then(t=>{const n={contentOffsetWithinModule:t.contentOffsetWithinSourceModule,hideTitle:t.isContinuationModule,setTitleToDateForTodaySection:!1},r=qn(t.todayModule,n,e.metricsContext);return t.isLastOfModule&&we(e.metricsContext.locationTracker),Bn([r],e)})}function Hn(e,t){switch(t){case"smallStoryCard":return Gl.has(e);case"mediumStoryCard":return zl.has(e);case"largeStoryCard":return Wl.has(e);default:return!1}}function Gn(e,t,n,r){const o={pageInformation:n.metricsPageInformation,locationTracker:n.metricsLocationTracker},i={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!0};i.prevailingCropCode=function(e){switch(e){case"smallStoryCard":return"em";case"mediumStoryCard":return"el";case"largeStoryCard":return"ek";default:return null}}(t),i.coercedGeneralCardSubType="Grid";const s=[];for(const a of e){if(!u(a.attributes)){r&&r(a);continue}const e=Qn(a,i,o);if(e){if("largeStoryCard"===t){const t=e.heroMedia;if(!u(t)||!u(t.art)&&!u(t.video))continue}if(Hn(e.media.kind,t)){if(u(n.filterOutMediaCardKinds)&&n.filterOutMediaCardKinds.has(e.media.kind))continue;s.push(e)}}}return s}function zn(e,t,n,r,o,i){if(!u(t))return null;const s=new ta(t);switch(n&&(s.title=n),s.subtitle=r,s.items=Gn(e,t,o,i),t){case"todayBrick":s.items=[Yn(e,o.metricsPageInformation,o.metricsLocationTracker,()=>!0,i)];break;default:s.items=Gn(e,t,o,i)}return s}function Wn(e){switch(e.media.kind){case"brandedSingleApp":return e.overlay instanceof Gc?e.overlay.heading:u(e.title)?e.title.replace(/\n/g," "):null;default:const t=_("TODAY_BRICK_STANDARD_DESCRIPTION");let n,r;return e.overlay instanceof Gc?(n=e.overlay.heading,r=e.overlay.title):(n=e.heading,r=e.title),t&&n&&r?t.replace("{heading}",n).replace("{title}",r):null}}function Yn(e,t,n,r,o){return Fo.c("todayCardsFromPlatformData",()=>{if(!e)return null;const i={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!1,enableListCardToMultiAppFallback:!0,coercedGeneralCardSubType:"Grid",prevailingCropCode:"fo"},s={pageInformation:t,locationTracker:n},a=[];for(const t of e){if(!u(t.attributes)){o&&o(t);continue}const e=Qn(t,i,s);if(e&&r(e)){e.inlineDescription=Wn(e);const t=e.media;t&&"brandedSingleApp"===t.kind&&(e.title=null),a.push(e)}}return a.length?new Wc(a):null})}function Qn(e,t,n){return Fo.b("todayCardFromData",()=>{const r=j(e,"displayStyle"),o=Vt(e);!function(e,t,n){const r=sr(e);let o=j(e,"displaySubStyle");if(o&&n.coercedGeneralCardSubType&&(o=n.coercedGeneralCardSubType),"Content"!==j(e,"displayStyle"))return!1;if(r.length>=6&&"Grid"===o)return!1;const i=Kn("Content");if(!G(e,"ignoreEditorialArt")&&rr(e,i,n.prevailingCropCode))return!1;if(Jn(r))return!1;if(!S("editorialContextForToday")){if("com.apple.AppStore.BridgeStoreExtension"===t){if(1===r.length&&"Grid"!==o)return!1;if(r.length>=2&&"Grid"===o)return!1}if("com.apple.MobileSMS"===t){if("Grid"===o)return!1;if(1===r.length)return!1}}return!0}(e,o,t)?t.clientIdentifierOverride=null:t.clientIdentifierOverride=o;let i=null;switch(r){case"Branded":i=function(e,t,n){return Fo.c("brandedCard",()=>{let r;u(t)&&(r=t.clientIdentifierOverride);const o=tr(e,n,r),i=S("threeLineTodayOverlays")&&t.useThreeLineOverlayForBranded;er(e,o,n);try{const r=Kn("Branded"),s=rr(e,r,t.prevailingCropCode);s?o.style=or(s):(o.backgroundColor=Dc.noArtBackgroundColor,o.style="dark");const a=j(e,"displayStyle"),d=ir(o.style,a),f=ar(e,t,n,!0,d);if(!f||1!==f.length)return null;const h=f[0];switch(j(e,"displaySubStyle")){case"AppOfDay":case"GameOfDay":{let t=!0,n=null;if(u(s)&&(t=!1,n=s.backgroundColor),i){const t=function(e){const t=j(e,"displaySubStyle");let n=j(e,"alternateLabel");return c(n)&&"AppOfDay"===t?n=$l:c(n)&&"GameOfDay"===t&&(n=ql),n}(e);let n=ko(e,"name");l(n)&&(n=h.title);let r=ko(e,"short");if(l(r)){const t=ee(e,"card-contents");if(0!==t.length){r=ko(t[0],"tagline")}c(r)&&p(h.subtitles)&&(r=h.subtitles[0])}o.overlay=new Gc(t,n,r),o.style="white",o.title=null,u(s)&&(s.crop="fo")}else{const r=ko(e,"short");let i=null;p(r)&&S("marketingLockupOverlaySupportsParagraph")&&(i=new Bs(r)),o.overlay=new $c(h,i,t,n)}break}default:{const e=new Bc(h);e.displaysIcon=!1,o.overlay=e;break}}return i||(o.title=j(e,"label")),o.media=new Dc(h.icon,s),o.media.impressionFields=h.impressionFields,o}finally{ge(n.locationTracker)}})}(e,t,n);break;case"Content":i=function(e,t,n){return Fo.c("contentCard",()=>{let r;u(t)&&(r=t.clientIdentifierOverride);const o=tr(e,n,r);er(e,o,n);try{const r=sr(e),i=Jn(r);if(i){const e=_r(i,{offerStyle:"colored",metricsOptions:{pageInformation:n.pageInformation,locationTracker:n.locationTracker}});return e?(e.theme="dark",o.media=new Lc(e),o.media.impressionFields=e.impressionFields,o.media.impressionFields.parentId=o.impressionFields.id,o.backgroundColor="F1F4F6",o):null}{const i=Kn("Content"),s=Zn(e,o,i,t.prevailingCropCode);if(s){const r=j(e,"displayStyle"),i=ir(s.style,r),a=ar(e,t,n,!0,i);if(Xn(e,s,a),null!==o.overlay&&o.overlay instanceof jc){o.overlay.style="white"}return o}if(1===r.length){const r=ar(e,t,n,!0);if(1!==r.length)return null;const i=r[0];return o.media=new Rc(i.icon),Xn(e,o,r),null!==o.overlay&&o.overlay instanceof Bc&&(o.overlay.displaysIcon=!1),o}{const i=r.filter(e=>{const t=Ao(e);return!To(e)||!t});let s=j(e,"displaySubStyle");switch(s&&t.coercedGeneralCardSubType&&(s=t.coercedGeneralCardSubType),s){case"List":case"NumberedList":{const r=ar(e,t,n,!1);if(r.length<4&&t.enableListCardToMultiAppFallback)return nr(e,r,o),o;if("NumberedList"===s){let e=1;for(const t of r)t.ordinal=`${e}`,e++}return o.style="white",o.media=new xc(r,null),o}case"River":{const r=cr(i,t,n,!0);return 0===r.length?null:r.length<5?(nr(e,r,o),o):(o.style="white",o.media=new Nc(r),o)}case"Grid":{const r=cr(i,t,n,!0);if(0===r.length)return null;if(r.length<=5)return nr(e,r,o),o;const s=r.length%2!=0;let a;r.length<=9&&s&&r.pop(),o.style="white";const c=r.length;return a=c<=13?"large":c<=25?"mixed":"small",o.media=new Mc(r,a),o}default:return null}}}}finally{ge(n.locationTracker)}})}(e,t,n);break;case"Media":i=function(e,t,n){return Fo.c("mediaCard",()=>{let r;u(t)&&(r=t.clientIdentifierOverride);const o=tr(e,n,r);er(e,o,n);try{switch(j(e,"cardDisplayStyle")){case"Video":return function(e,t,n,r){let o=null;const i=$(e,"editorialVideo.storeFrontVideo4x3"),s=$(e,"editorialVideo.storeFrontVideo");if(!(o="pad"===Ii?i||s:s||i))return null;const a=to(g(o,"previewFrame"));if(!a)return null;const c=h(o,"video");if(!c)return null;const l=bo(e,"short"),u=new _s(c,a,{canPlayFullScreen:n.enableFullScreenVideo});return ke(u,{pageInformation:r.pageInformation,locationTracker:r.locationTracker,id:e.id}),t.style="white",t.media=new Uc(u,l),S("threeLineTodayOverlays")&&(t.overlay=new Gc(t.heading,t.title,l),t.title=null,t.heading=null),t}(e,o,t,n);case"FullBleedImage":const r=Kn("Media"),i=Zn(e,o,r,t.prevailingCropCode);return Xn(e,i,[]),i;default:return null}}finally{ge(n.locationTracker)}})}(e,t,n);break;default:i=null}if(c(i))return null;i.inlineDescription=bo(e,"short");const s=new Ec,a=function(e,t,n,r){switch(t){case"article":return rr(e,Kn(n),"fn");case"inline":default:return rr(e,"editorialArtwork.crossoverCard",r)}}(e,t.heroDisplayContext,r,t.prevailingCropCode);if(u(a)&&(s.art=a),u(i.media)&&i.media instanceof Uc&&(s.video=i.media.video),"mac"===Ii&&s.isValid()){i.heroMedia=s;let e=or(s.art);u(e)||(e=or(s.video.preview)),i.style=e}return c(i)?(console.log(`Unknown style: ${r}`),null):i})}function Kn(e){switch(e){case"Branded":return"editorialArtwork.dayCard";case"Content":return"editorialArtwork.generalCard";case"Media":return"editorialArtwork.mediaCard";default:return null}}function Jn(e){if(1===e.length){const t=e[0];if("in-apps"===t.type)return t}return null}function Xn(e,t,n){if(!t)return;const r=bo(e,"short"),o=G(e,"ignoreITunesShortNotes");if(r&&!o)t.overlay=new jc(new Bs(r));else if(n&&0!==n.length)if(1===n.length)t.overlay=new Bc(n[0]);else{const e=new qc(n);e.displaysTitle=!1,t.overlay=e}}function Zn(e,t,n,r){return Fo.c("cardWithArtwork",()=>{if(G(e,"ignoreEditorialArt"))return null;const o=rr(e,n,r);return o?(t.media=new Oc(o),t.style=or(o),t.clickAction instanceof aa&&(t.overlay=new Hc(t.clickAction),t.style="white"),t):null})}function er(e,t,n){me({pageInformation:n.pageInformation,locationTracker:n.locationTracker,targetType:"todayCard",idType:"its_id",id:e.id},t.title)}function tr(e,t,n){return Fo.c("basicCard",()=>{const r=new zc,o=j(e,"label"),i=j(e,"displayStyle"),s=j(e,"displaySubStyle");r.heading=o;let a=bo(e,"name");c(a)&&"Branded"===i&&(a=j(e,"label")),r.title=a;const l=function(t){return f(e,Vl)}(),p={cardType:i,franchise:o};u(s)&&(p.cardSubType=s),l&&(p.isOnboardingCard=l);const d=yt(e,a,{targetType:"todayCard",pageInformation:t.pageInformation,locationTracker:t.locationTracker}),h=d;return h.actionDetails=p,r.clickAction=Fr(e,h,n,t.currentShelfRecoMetricsData),function(e,t,n,r,o,i){if(!e)return;const s=ht(e,d);s.franchise=ce(n),s.cardType=ce(r),i&&(s.cardSubType=ce(i)),o&&(s.isOnboardingCard=o),e.impressionFields=s}(r,0,o,i,l,s),r})}function nr(e,t,n){const r=bo(e,"short");if(n.media=new Fc(t,r),n.backgroundColor=Fc.multiAppBackgroundColor,n.clickAction instanceof ia){const e=as.from(n.clickAction.pageUrl);e.param(Zi.showingFallbackMedia,"true"),n.clickAction.pageUrl=e.build()}}function rr(e,t,n){const r=$(e,t);if(r){const e=to(r);return e.crop=n||("mac"===Ii?"fn":"sr"),e}return null}function or(e){return e&&e.backgroundColor?Ts.fromString(e.backgroundColor).luminance<Yl?"dark":"light":null}function ir(e,t){if("Branded"!==t)return null;switch(e){case"dark":return"dark";default:return null}}function sr(e){return ee(e,"card-contents")}function ar(e,t,n,r,o){return cr(ee(e,"card-contents"),t,n,r,o,Tt(e))}function cr(e,t,n,r,o,i){return l(e)?[]:Rr(e.filter(e=>!p(e.attributes)||"in-apps"!==e.type),{lockupOptions:{metricsOptions:{pageInformation:n.pageInformation,locationTracker:n.locationTracker},offerEnvironment:o,clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:i},shouldIgnoreLocationIncrement:r,clientIdentifierOverride:t.clientIdentifierOverride,filter:Wo.TodayCard})}function lr(e,t){return Fo.c("titledParagraphFromVersionHistoryEntry",()=>{const n=h(e,"releaseNotes"),r=new $s(n,t),o=h(e,"versionDisplay"),i=_("VERSION_STRING_TEMPLATE");switch(t){case"detail":r.primarySubtitle=o;break;default:r.primarySubtitle=i.replace("{version}",o)}const s=h(e,"releaseDate");if(s){const e=new Date(s);r.secondarySubtitle=function(e){let t=Fi.relativeDate(e);return t||(t="* null *"),t}(e)}return r})}function ur(e,t,n){return e?Fo.c("informationFromLookupResponse",()=>{const r=[],o=function(e){const t=Ce(e,"seller"),n=Ce(e,"sellerLabel")||_("SELLER");if(!u(t))return null;const r=new vs(t);return new As(n,[r])}(e);o&&r.push(o);const i=wo(e);if(!t&&u(i)){const e=function(e){let t=Fi.fileSize(e);return t||(t="* null *"),t}(i),t=new vs(e),n=new As(_("FILE_SIZE"),[t]);r.push(n)}const s=ee(e,"genres");if(s.length>0){let e=_("INFO_LIST_CHILD_PARENT_CATEGORY_SUMMARY");"INFO_LIST_CHILD_PARENT_CATEGORY_SUMMARY"===e&&(e="{parentCategory}: {childCategory}");const t=function(e,t,n,r){if(!e||!e.length)return null;let o=e[0];const i=j(o,"parentId");let s=null;for(const t of e){const e=j(t,"parentId");if(t.id!==o.id){if(e&&e===o.id){s=t;break}if(t.id===i){s=o,o=t;break}}}const a=j(o,"name"),c=j(s,"name");return a&&c?t.replace("{parentCategory}",a).replace("{childCategory}",c):a}(s,e);if(t){const e=new vs(t);let n=_("INFO_LIST_CATEGORY_TITLE");"INFO_LIST_CATEGORY_TITLE"===n&&(n="Category");const o=new As(n,[e]);r.push(o)}}const a=function(e){const t=Ce(e,"requirementsString");if(!u(t))return null;let n=null;if(Mr(e)){const t=po(e),r=t&&-1!==t.indexOf(Ii),o=function(e){if(host.deviceLocalizedModel)return host.deviceLocalizedModel;switch(e){case"phone":const t=_("IPHONE_BRAND_NAME");return"IPHONE_BRAND_NAME"===t?"iPhone":t;case"pad":const n=_("IPAD_BRAND_NAME");return"IPAD_BRAND_NAME"===n?"iPad":n;case"tv":const r=_("APPLE_TV_BRAND_NAME");return"APPLE_TV_BRAND_NAME"===r?"Apple TV":r;case"watch":const o=_("APPLE_WATCH_BRAND_NAME");return"APPLE_WATCH_BRAND_NAME"===o?"Apple Watch":o;case"mac":const i=_("MAC_BRAND_NAME");return"MAC_BRAND_NAME"===i?"Mac":i;case"unknown":default:return null}}(Ii);r&&o&&(n=_("INFO_LIST_REQUIREMENTS_SUMMARY").replace("{deviceName}",o))}const r=new vs(t);return new As(_("REQUIREMENTS"),[r],n)}(e);if(a&&r.push(a),G(e,"usesLocationBackgroundMode")){const e=_("INFO_LIST_LOCATION_TITLE"),t=_("INFO_LIST_LOCATION_DESCRIPTION"),n=new vs(t),o=new As(e,[n]);r.push(o)}const p=function(e){const t=Pe(e,"languageList");if(l(t))return null;const n=t.length;if(n<1)return null;let r=null,o=null;switch(n){case 0:break;case 1:o=t[0];break;case 2:o=_("INFO_LIST_TWO_LANGUAGES_SUMMARY").replace("{first}",t[0]).replace("{second}",t[1]);break;default:const e=n-1;r=_("INFO_LIST_MORE_LANGUAGES_SUMMARY").replace("{language}",t[0]).replace("{count}",e.toString()),o=function(e,t){if(null===e||null===t)return null;if(0===e.length)return"";let n=e.length,r="";return e.forEach((e,o)=>{null===e?n-=1:(r+=e,o<n-1&&(r+=t))}),r}(t,_("CONJUNCTION_SEPARATOR"))}if(!u(o))return null;const i=new vs(o);return new As(_("SUPPORTED_LANGUAGES"),[i],r)}(e);p&&r.push(p);const f=$(e,"contentRatingsBySystem.appsApple");if(f){const t=h(f,"name");if(t){const o=d(f,"advisories");let i=null;const s=Q(e,Oe(e),"ageBand"),a=m(s,"minAge"),c=m(s,"maxAge");t&&u(a)&&u(a)?"{ageRating}, Made for Ages {minAgeRating}–{maxAgeRating}"===(i=_("INFO_LIST_AGE_RATING_SUMMARY").replace("{ageRating}",t).replace("{minAgeRating}",a.toString()).replace("{maxAgeRating}",c.toString()))&&(i=t):i=t;const l=[];if(Lo.requireAgeVerification&&function(e,t){return m(f,"rank")>=nu.seventeenPlus}()&&function(e){const t=ee(e,"genres");for(const e of t)if(h(e,"id")===No.Games.toString())return!0;return!1}(e)){let t=null;const n="app-bundles"===e.type;if(n){const n=X(e,"apps");if(u(n))for(const e of n.data)if(u(j(e,"gracRegistrationNumber"))){t="AppStore.AgeVerification.ProductPage.Rating.BundleUnsuitableForJuveniles";break}}else u(j(e,"gracRegistrationNumber"))&&(t="AppStore.AgeVerification.ProductPage.Rating.UnsuitableForJuveniles");let r;null!=t&&l.push(new vs(_(t))),r=n?"AppStore.AgeVerification.ProductPage.Rating.BundleRequiredAge":"AppStore.AgeVerification.ProductPage.Rating.RequiredAge",l.push(new vs(_(r)+"\n"))}if(i&&l.push(new vs(i)),o.length>0)for(const e of o)l.push(new vs(e));let p=null;l.length>1&&(p=i);let g=_("INFO_LIST_AGE_RATING_TITLE");"INFO_LIST_AGE_RATING_TITLE"===g&&(g=_("AGE_RATING"));const y=new As(g,l,p);r.push(y),n&&(n.index=r.length-1,n.section=new Tc("shelf","information"))}}const g=ee(e,"top-in-apps");if(g.length>0){const e=[];for(const t of g){const n=j(t,"name"),r=h(Vr(t),"priceFormatted");e.push(new vs(n,r))}const t=new As(_("INFO_LIST_IN_APP_PURCHASES"),e,_("YES"));r.push(t)}const y=Ce(e,"copyright");if(!c(y)){const e=new vs(y),t=new As(_("INFO_LIST_COPYRIGHT"),[e]);r.push(t)}return r}):null}function pr(e,t){return Fo.c("productPageFromResponse",()=>{const n=e.data.length?e.data[0]:null;if(!n)return null;u(t)&&(t.iAdClickFields&&(e[rc]=JSON.stringify(t.iAdClickFields)),t.iAdLineItem&&(e[oc]=t.iAdLineItem));const r="app-bundles"===n.type,o=ze(n),i=At(r?"SoftwareBundle":"Software",n.id,e),s={rootPosition:0,locationStack:[]},a=new Xl(i,s),c=hr(n,a,t),l=po(n);It(c,a.metricsPageInformation,e=>{const t=l&&(mo(l,Ii)||go(l,Ii)),r=function(e,t){if(!Mr(e))return!1;if(eo(e,Wo.ThirtyTwoBit|Wo.UnsupportedSystemDeletableApps|Wo.MinimumOSRequirement|Wo.UnsupportedPlatform))return!1;const n=fo(t),r=po(e);return n.some(e=>ho(r,e))}(n,Ii);e.deviceCompatibility=t&&r?"runnable":t?"purchasable":"none"});const d=Vr(n),f=de(n,c.icon),g=Br(d,n,f,{pageInformation:a.metricsPageInformation,locationTracker:a.locationTracker,id:n.id,isAdvert:!!i.iAdInfo&&i.iAdInfo.iAdIsPresent});g.lineItem=h(e,oc);let y=Yr(g,n,null,"productPage");if(u(t)&&p(t.externalDeepLinkUrl)){const e={pageInformation:i,locationTracker:s};y=St(y,g.adamId,t.externalDeepLinkUrl,e)}c.buttonAction=y;const w=jr(g);let T;r&&(T=function(e,t){return e?Fo.c("bundleChildrenShelf",()=>{let n;(n=new ta("smallLockup")).isHorizontal=!0;const r=e.data.length;if(!r)return null;n.title=P("APPS_IN_BUNDLE",r);const o=wr(e,t,null,Wo.Bundles);if(o.unavailableIds.length){const e=new Jl(o.unavailableIds,n.title,!1,"smallLockup","infer",null);e.isBundleShelf=!0,n.url=yr(e,t)}return me({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},n.title),n.items=o.items,ge(t.locationTracker),we(t.locationTracker),n.rowsPerColumn=r<2?1:2,t.addImpressionsToShelf(n,"bundleChildren"),n}):null}(X(n,"apps"),a)),T&&(c.shelfMapping.bundleChildren=T);const A=function(e,t){return e?Fo.c("bundleParentsShelf",()=>{let n;const r=e.data.length;if(!r)return null;(n=new ta("smallLockup")).isHorizontal=!0,n.title=_("INCLUDED_IN_BUNDLES").replace("{count}",r.toString());const o=wr(e,t);if(n.items=o.items,o.unavailableIds.length){const e=new Jl(o.unavailableIds,n.title,!1,"smallLockup","infer",null);e.isBundleShelf=!0,n.url=yr(e,t)}return n.rowsPerColumn=r<2?1:2,t.addImpressionsToShelf(n,"bundleParent"),n}):null}(X(n,"app-bundles"),a);A&&(c.shelfMapping.bundleParents=A);const v=function(e){return Fo.c("editorsChoiceItem",()=>{const t=h(_e(e,"editorialNotes"),"standard");if(t){const n=new xa(t),r=_e(e,"editorialBadgeInfo");if(r){const e=h(r.editorialBadgeType);n.showsBadge=e&&"editorialPriority"===e}return n.showsBadge||(n.title=_("APP_STORE_EDITORS_NOTES")),n}return null})}(n);let I=null;const b=!(1===l.length&&"mac"===l[0]&&"mac"!==Ii||w||o);if(v&&!b){const e=new Fa;e.adamId=n.id,e.editorsChoice=v,(I=new ta("reviewsContainer")).items=[e],c.shelfMapping.reviews=I}else if(b){const e=X(n,"reviews"),t=$(n,"userRating");t.ratingAverage=m(t,"value"),t.adamId=n.id,t.isBundle=r,t.supportUrl=Ce(n,"supportURLForLanguage"),I=function(e,t,n,r,o,i){return Fo.c("reviewsContainerShelf",()=>{const s={pageInformation:i.metricsPageInformation,locationTracker:i.locationTracker},a=_("PRODUCT_SECTION_REVIEWS");me({pageInformation:i.metricsPageInformation,locationTracker:i.locationTracker,targetType:"swoosh",id:`${i.getSequenceId()}`,idType:"sequential"},a);const c=Be(t),l=Ze(_i,e,c,n,r,t.next,o);return l.title=a,i.addImpressionsToShelf(l,"ratings"),l.seeAllAction&&Ne(l.seeAllAction,null,s),ge(i.locationTracker),we(i.locationTracker),l})}(t,e,no(n),v,!(1===l.length&&"tv"===l[0]),a)}I&&(c.shelfMapping.reviews=I);const k=G(n,"isFirstPartyHideableApp");if(!k&&!r&&!w){const e=Pe(n,"versionHistory");if(e&&e.length>1){const t=function(e,t,n){return Fo.c("mostRecentVersionShelf",()=>{const r=function(e){return e?e.map(e=>lr(e,"detail")):[]}(e);let o;if(r.length>0){(o=new ta("titledParagraph")).title=_("PRODUCT_SECTION_MOST_RECENT_VERSION");const i=lr(e[0],"overview");o.items=[i];const s=new ta("titledParagraph");s.items=r;const a=new ka([s]);a.title=_("VERSION_HISTORY_PAGE_TITLE","Version History"),a.presentationOptions=["prefersLargeTitle"],It(a,vt("VersionHistory",t,""));const c=new ia("versionHistory");c.title=_("ACTION_VERSION_HISTORY_SEE_ALL"),c.pageData=a,Ne(c,null,{pageInformation:n.metricsPageInformation,locationTracker:n.locationTracker}),o.seeAllAction=c,n.addImpressionsToShelf(o,"versionHistory")}return o})}(e,n.id,a);t&&(c.shelfMapping.mostRecentVersion=t)}}const C=new eu,E=function(e,t,n,r){return Fo.c("informationShelf",()=>{let o;const i=ur(e,n,r);return i.length>0&&((o=new ta("annotation")).title=_("PRODUCT_SECTION_INFORMATION"),o.items=i,t.addImpressionsToShelf(o,"information")),o})}(n,a,k,C);E&&(c.shelfMapping.information=E);const O=function(e,t){return Fo.c("linksShelf",()=>{const n=new ta("productPageLink"),r=function(e){return e?Fo.c("productLinksFromData",()=>{const t=[],n=Ce(e,"websiteUrl");if(n){const e=new aa(n,!1),r=_("DEVELOPER_WEBSITE");t.push(new zs(r,e,"developer"))}const r=Ce(e,"privacyPolicyUrl");if(r){const e=new aa(r,!1),n=_("PRIVACY_POLICY");t.push(new zs(n,e,"privacy"))}if(H(e,"hasEula")){const n=function(e){const t=e.id,n=e.type;return u(e)&&u(t)&&u(n)?`${qi.internal}:/${ji.eula}?resourceType=${n}&resourceId=${t}`:null}(e);if(n){const e=new ia("page");e.pageUrl=n;const r=_("LICENSE_AGREEMENT");t.push(new zs(r,e,"eula"))}}const o=Lo.reportProblemUrl;if(u(o)){const n=new as(o);n.query.a=e.id,n.query.o="",n.query.s="mac"===Ii?"10":"9";const r=new aa(n.build(),!1),i=_("REPORT_A_PROBLEM"),s=Lo.reportProblemUrlDaysToDisplay;t.push(new Ws(i,r,s))}return t}):null}(e);return r&&r.length>0&&(n.items=r),t.addImpressionsToShelf(n,"links"),n})}(n,a);O&&(c.shelfMapping.links=O);const R=function(e,t){return Fo.c("capabilitiesShelf",()=>{let n;const r=[];Ee(e,"isGameCenterEnabled")&&r.push(new Es("gameCenter")),Ee(e,"isSiriSupported")&&r.push(new Es("siri")),Ee(e,"supportsPassbook")&&r.push(new Es("wallet"));const o=j(e,"familyShareEnabledDate");if(o&&!G(e,"isFirstPartyHideableApp")){const e=new Date(o),t=new Date;e&&e<=t&&r.push(new Es("familySharing"))}return r.length>0&&((n=new ta("productCapability")).title=_("PRODUCT_SECTION_SUPPORTS"),n.items=r,t.addImpressionsToShelf(n,"supports")),n})}(n,a);R&&(c.shelfMapping.capabilities=R);const D=X(n,"related-editorial-items"),x=_("PRODUCT_SECTION_FEATURED_IN"),F="mac"===Ii?function(e,t,n,r){return Fo.c("smallStoryShelf",()=>{if(!n||!n.data.length)return null;const t={pageInformation:r.metricsPageInformation,locationTracker:r.locationTracker,targetType:"swoosh",id:`${r.getSequenceId()}`,idType:"sequential"};me(t,e);const o=[],i={metricsLocationTracker:t.locationTracker,metricsPageInformation:t.pageInformation,filterOutMediaCardKinds:new Set(["appIcon"])},s=zn(n.data,"smallStoryCard",e,"",i,function(e){return o.push(e.id),!1});if(s.isHorizontal=!0,o.length){const e=new Jl(o,s.title,!1,"smallStoryCard");s.url=yr(e,r)}return ge(r.locationTracker),r.addImpressionsToShelf(s,"featuredIn"),we(r.locationTracker),s})}(x,0,D,a):function(e,t){function n(e,t,n){return Yn(e.data,t.pageInformation,t.locationTracker,gr,n)}return Fo.c("featuredInShelf",()=>{if(!e||!e.data.length)return null;const r={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},o=new ta("todayBrick"),i=_("PRODUCT_SECTION_FEATURED_IN");o.title=i,o.isHorizontal=!1;const s=[];if(o.items=[n(e,r,function(e){return s.push(e.id),!1})],s.length){const e=new Jl(s,o.title,!1,"todayBrick");o.url=yr(e,t)}return me(r,i),t.addImpressionsToShelf(o,"featuredIn"),ge(t.locationTracker),we(t.locationTracker),o})}(D,a);F&&(c.shelfMapping.featuredIn=F);const L=function(e,t){return Fo.c("moreByDeveloperShelf",()=>{let n;const r=mr(Z(e,"developer")),o=j(e,"artistName"),i=X(e,"developer-other-apps");if(!i||0===i.data.length)return null;const s=_("MORE_BY_DEVELOPER_TEMPLATE").replace("{developer}",o);let a;me({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},s),(n=new ta(a="mac"===Ii?"mediumLockup":"smallLockup")).title=s;const c=wr(i,t,"white");if(!c)return null;if(n.items=c.items,c.unavailableIds&&c.unavailableIds.length){const e=new Jl(c.unavailableIds,n.title,!1,a,"white",null);n.url=yr(e,t)}const l=new ia("page");return l.pageUrl=r,l.title=_("ACTION_SEE_ALL"),Ne(l,l.pageUrl,{pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),n.seeAllAction=l,n.isHorizontal=!0,i.data.length<2?n.rowsPerColumn=1:n.rowsPerColumn=2,n.backgroundColor=Zl,t.addImpressionsToShelf(n,"developer"),ge(t.locationTracker),we(t.locationTracker),n})}(n,a);L&&(c.shelfMapping.moreByDeveloper=L);const N=function(e,t){return e?Fo.c("similarItemsShelf",()=>{let n;const r=X(e,"customers-also-bought-apps");if(!r||!r.data.length)return null;const o=_("SIMILAR_ITEMS_TITLE");me({pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,targetType:"swoosh",id:`${t.getSequenceId()}`,idType:"sequential"},o),(n=new ta("smallLockup")).title=o;const i=wr(r,t,"white");if(n.items=i.items,i.unavailableIds.length){const r=new Jl(i.unavailableIds,n.title,!0,"smallLockup","white",null),o=vt("SimilarItems",e.id,"");n.url=yr(r,t,o)}return n.isHorizontal=!0,r.data.length<2?n.rowsPerColumn=1:n.rowsPerColumn=2,n.backgroundColor=Zl,t.addImpressionsToShelf(n,"similarItems"),ge(t.locationTracker),we(t.locationTracker),n}):null}(n,a);if(N&&(c.shelfMapping.similarItems=N),!w){const e=Tr(n,!0,t,a);e&&(c.shelfMapping.subscriptions=e);const r=Tr(n,!1,t,a);r&&(c.shelfMapping.inAppPurchases=r)}c.pageTopBackgroundColor=null,c.pageBottomBackgroundColor=Zl,c.purchasedOrdering=Ct(!0,t),c.notPurchasedOrdering=Ct(!1,t),dr(t,c);const M={};return M.contentRating=C,function(e,t,n){let r=0;for(const o of e){const e=t[o.type];if(e){const t=new va(e.section,!0);t.index=e.index,o.compactAction=t,o.regularAction=t}let i;switch(o.type){case"contentRating":case"editorsChoice":case"rating":i="select";break;default:i="navigate"}o.compactAction&&Le(o.compactAction,{targetType:"badge",id:o.type,actionType:i,actionDetails:{position:r},pageInformation:n.metricsPageInformation,locationTracker:n.locationTracker}),r+=1}}(c.badges,M,a),c.isComplete=!0,"app-bundles"===n.type&&c.offerDisplayProperties.isFree&&!S("freeCMBEnabled")&&"mac"!==Ii&&(c.offerDisplayProperties.offerToken=null),c})}function dr(e,t){if(e&&e.spotlightSection){const n=e.spotlightInAppProductIdentifier;if(n&&"shelf"===e.spotlightSection.type){const r=t.shelfMapping[e.spotlightSection.shelfId];if(!r)return;if(r.presentationHints||(r.presentationHints=new na),r.presentationHints.isInProductPageSpotlight=!0,fr(n,r.items),r.url){const e=new as(r.url);e&&(r.url=e.param(Zi.offerName,n).build())}}}}function fr(e,t){if(!t)return;let n=-1,r=null;t.forEach((t,o)=>{const i=t,s=i,a=i&&i.adamId===e,c=s&&s.productIdentifier===e;(a||c)&&(n=o,r=i,s&&(s.theme="spotlight",s.offerDisplayProperties=s.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"white")))}),-1!==n&&(t.splice(n,1),t.splice(0,0,r))}function hr(e,t,n,r){return Fo.c("productPageSidePackLockup",()=>{const o=new Ac,i=qr(e);i&&u(t)&&u(t.metricsPageInformation)&&(t.metricsPageInformation.offerType="preorder",t.metricsPageInformation.offerReleaseDate=Gr(e)),function(e,t){if(c(t))return;const n=[];n.push(bt(t,null)),e.metricsEvents=n}(o,t.metricsPageInformation);const s=e.id,a=j(e,"name"),l=ze(e);let d;o.uber=function(e){let t=null,n=null;switch(Ii){case"mac":t=_e(e,"editorialArtwork.centeredFullscreenBackground"),n="ep";break;default:t=_e(e,"editorialArtwork.bannerUber"),n="sr"}return u(t)&&u(n)?to(t,null,n):null}(e),o.adamId=s,o.bundleId=h(e,"bundleId"),u(n)&&(d=n.clientIdentifierOverride),r||(o.icon=no(e,d)),o.title=a,o.isComplete=!1;const f=Ir(e);f&&(o.subtitles=[f]),o.developerTagline=Ce(e,"subtitle"),o.regularPriceFormatted=j(e,"regularPriceFormatted"),l||(o.rating=z(e,"userRating.value"));const y=co(e,null,d),w=io(e);let T=null;if(w)for(const e of y)if(e.mediaPlatform.isEqualTo(w.mediaPlatform)){T=e;break}let A=null;if(T){const e=T.mediaPlatform.appPlatform;if("phone"===e||"messages"===e)for(const e of T.items){const t=e.screenshot;if((A=t.width/t.height)<1)break}}const v={pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker,id:s,isAdvert:!!t.metricsPageInformation.iAdInfo&&t.metricsPageInformation.iAdInfo.iAdIsPresent};o.children=Ar(e,{metricsOptions:v});const I=[],b=[];if(T&&w&&w.videos)for(const e of w.videos){const t=new Ps;t.video=e;const n=e.preview.width/e.preview.height,r=null===A||n.toFixed(2)===A.toFixed(2),o=T.mediaPlatform.isEqualTo(w.mediaPlatform);r&&o?I.push(t):b.push(e),ke(e,v)}T&&(T.items=I.concat(T.items));let k=null;b.length>0&&(k=function(e,t){return Fo.c("videoShelf",()=>{if(!e||0===e.length)return null;const n=new ta("framedVideo");return n.title=_("PRODUCT_SECTION_VIDEOS"),n.items=e.map(e=>new Js(e,!0,"text/plain",null,null,!0)),n.isHorizontal=!0,t.addImpressionsToShelf(n,"videos"),n})}(b,t)),o.media=y,o.mediaSectionTitle=_("PRODUCT_SECTION_SCREENSHOTS_PREVIEW");const C=po(e);o.appPlatforms=C;const R=Vr(e),x=de(e,o.icon),F=Br(R,e,x,v);let L;if(p(F)&&(u(n)&&(F.lineItem=n.iAdLineItem),L=Yr(F,e,null,"productPage"),u(n)&&p(n.externalDeepLinkUrl)&&p(L)&&(L=St(L,F.adamId,n.externalDeepLinkUrl,v))),o.buttonAction=L,!G(e,"isFirstPartyHideableApp")){const t=function(e){return Fo.c("updateOfferDataFromData",()=>{const t=Pe(e,"offers");if(0===t.length)return null;for(const e of t){if("update"===h(e,"type"))return e}return null})}(e);o.updateBuyParams=h(t,"buyParams"),o.externalVersionIdentifier=function(e,t,n="coercible"){let r=function(e,t,n,r="coercible"){const o=W(e,t);return c(o)?null:m(o,n,r)}(e,Oe(e),t,n);return c(r)&&(r=z(e,t)),r}(e,"externalVersionId")}if(i){o.theme="blue";const e=_("PREORDER_EXPANDED_OFFER_TITLE");let t=null;if(u(F.expectedReleaseDate)){const e=D(_("PREORDER_EXPANDED_OFFER_DATE_FORMAT","MMM d, yyyy"),F.expectedReleaseDate);t=_("PREORDER_EXPANDED_OFFER_SUBTITLE").replace("{releaseDate}",e)}o.expandedOfferDetails=new Sc(e,t)}const N=Jr(F,"app",e,"colored","productPage",null,null,"productPage");let M;o.offerDisplayProperties=N,o.badges=function(e){return e?Fo.c("badgesFromLookupResponse",()=>{const t=[];if(qr(e)){const e=_("BADGE_PREORDER_TERMS");t.push(new wc("paragraph",{paragraphText:e},null,null,e))}else{const n=$(e,"userRating");let r=null;const o=ze(e);if(!o&&n&&n.value&&n.ratingCount){const e=m(n,"value"),t=Math.round(10*e)/10,o=E(t,1),i=m(n,"ratingCount"),s=P("BADGE_RATING_CAPTION_SHORT_TEMPLATE",i).replace("{count}",O(i)),a=P("BADGE_RATING_CAPTION_LONG_TEMPLATE",i).replace("{count}",O(i)).replace("{rating}",o),c=_("PRODUCT_ACCESSIBILITY_BADGE_STAR_RATING").replace("{starCount}",o);r=new wc("rating",{rating:t,ratingFormatted:o},s,a,c,s)}else{const e=_("BADGE_NO_RATINGS_CAPTION");if(o&&"BADGE_NO_RATINGS_CAPTION"!==e)r=new wc("rating",{},e,null,e);else if(!o){const e=_("BADGE_NOT_ENOUGH_RATINGS_CAPTION");r=new wc("rating",{},e,null,e)}}if(r){const e=new Tc("shelf","reviews");r.compactAction=new va(e),r.regularAction=r.compactAction,t.push(r)}const i=_e(e,"editorialBadgeInfo");if(i){const n=h(i.editorialBadgeType);if(n&&"editorialPriority"===n){let n;n="Games"===q(e,"genreNames")[0]?_("EDITORIAL_BADGE_GAMES"):_("EDITORIAL_BADGE_APPS");const r=_("PRODUCT_ACCESSIBILITY_BADGE_EDITORS_CHOICE"),o=new wc("editorsChoice",{},n,null,r,n),i=new Tc("shelf","reviews");o.compactAction=new va(i),o.regularAction=o.compactAction,t.push(o)}}const s=_e(e,"chartPositions");if(s){const e=function(e){switch(host.clientIdentifier){case Ti:return"appStore";case Si:return"watch";case Ai:return"messages";case vi:return"appletv";default:return null}}();if(e){const n=g(s,e);if(n){const e=m(n,"position"),r=h(n,"genreName"),o=h(n,"genre"),i=h(n,"chart"),s=_("PRODUCT_ACCESSIBILITY_BADGE_CHART_POSITION_TITLE").replace("{chartPosition}",e.toString()),a=new wc("chartPosition",{position:e.toString()},r,null,s,r,"view"),c=function(e,t){return ot((new Mi).forType("charts").addingQuery("types","apps").addingQuery("chart",t).addingQuery("genre",e)).toString()}(o,i);if(c){const e=new ia("topCharts");e.pageUrl=c,a.compactAction=e,a.regularAction=e}t.push(a)}}}}const n=j(e,"contentRatingsBySystem.appsApple.name");if(n){const r={contentRating:n},o=function(e){if(!e)return null;switch(e){case 6:return"AgeRatingL";case 7:return"AgeRating10";case 8:return"AgeRating12";case 9:return"AgeRating14";case 10:return"AgeRating16";case 11:return"AgeRating18";default:return null}}(z(e,"contentRatingsBySystem.appsBrazil.rank"));o&&(r.contentRatingResource=o);let i=_("BADGE_AGE_RATING");"BADGE_AGE_RATING"===i&&(i=_("AGE_RATING"));const s=_("PRODUCT_ACCESSIBILITY_BADGE_AGE_RATING_TITLE"),a=new wc("contentRating",r,i,null,n,s,"view");t.push(a)}return t}):null}(e);const U=Z(e,"developer"),V=mr(U);if(u(V)){M=new ia("page");const n=j(e,"artistName");M.title=n,M.pageUrl=V,Le(M,{targetType:"button",id:U.id,actionType:"navigate",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker})}o.developerAction=M;const B=function(e){return e?Fo.c("productDescriptionLinksFromData",()=>{const t=[],n=Ce(e,"websiteUrl");if(n){const e=new aa(n,!1),r=_("PRODUCT_DEVELOPER_WEBSITE");t.push(new zs(r,e,"developer"))}const r=Ce(e,"supportURLForLanguage");if(r){const e=new aa(r,!1),n=_("DEVELOPER_SUPPORT");t.push(new zs(n,e,"support"))}return t}):null}(e),H=Dt(e,!0);switch(Ii){case"mac":if(H){const e=new Sa(H);Le(e,{targetType:"button",id:s,actionType:"share",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),o.shareAction=e}break;default:{const n=[];if(H){const e=new Sa(H);e.title=_("SHARE_APP"),e.artwork=new li("resource://action_share",28,28),Le(e,{targetType:"button",id:s,actionType:"share",actionContext:"shareSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),n.push(e)}const r=Ot(e);if(r){const e=new ia("finance");e.title=_("SHARE_GIFT_APP"),e.artwork=new li("resource://action_gift",28,28),e.pageUrl=`gift/${r}`,Le(e,{targetType:"button",id:s,actionType:"gift",actionContext:"shareSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),n.push(e)}if(V){const e=new ia("page");e.title=_("SHARE_MORE_BY_DEVELOPER"),e.artwork=new li("resource://action_dev",28,28),e.pageUrl=V,Le(e,{targetType:"button",id:U.id,actionType:"navigate",actionContext:"shareSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}),n.push(e)}if(n.length>0){const e=new wa(n);e.isCancelable=!0,o.shareAction=e,Le(o.shareAction,{targetType:"button",id:s,actionType:"actionSheet",pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker})}}}const Y=function(e,t,n,r){return Fo.c("descriptionShelf",()=>{let o,i=Ce(e,"promotionalText");i||(i="");let s=Ce(e,"description.standard");s||(s="");let a="";i.length>0&&s.length>0&&(a="\n\n");const c=i+a+s;if(c.length>0){o=new ta("productDescription");const e=new Bs(c);e.isCollapsed=!0;const i=new Os(e,n,t);o.items=[i],r.addImpressionsToShelf(o,"description")}return o})}(e,M,B,t);return o.shelfMapping={},function(e,t){let n=e.offerDisplayProperties;const r=e.appPlatforms,o=e.title;let i=null;if(Ee(t,"is32bitOnly")&&((i=new ta("banner")).items=[new bs(_("UNSUPPORTED_IOS_11"))],n=n.newOfferDisplayPropertiesChangingAppearance(!1,"disabled")),null!==i||Mr(t)||((i=new ta("banner")).items=[new bs(_("UNSUPPORTED_CAPABILITIES"))]),null===i&&eo(t,Wo.UnsupportedSystemDeletableApps)&&((i=new ta("banner")).items=[new bs(_("UNSUPPORTED_CAPABILITIES"))],n=n.newOfferDisplayPropertiesChangingAppearance(!1,"disabled")),eo(t,Wo.MinimumOSRequirement)){let e;const n=K(t,Oe(t),"minimumOSVersion");if(S("supportedOSBannerText")){const r=Ee(t,"supportsArcade");switch(Ii){case"mac":e=_(r?"AppStore.AppleArcadeRequirement.not.upgradable.macOS":"UNSUPPORTED_MACOS_VERSION").replace("{osVersion}",n);break;case"phone":case"pad":e=_(r?"AppStore.AppleArcadeRequirement.not.upgradable.iOS":"UNSUPPORTED_IOS_VERSION").replace("{osVersion}",n);break;case"tv":e=_("UNSUPPORTED_TVOS_VERSION").replace("{osVersion}",n);break;case"watch":e=_("UNSUPPORTED_WATCHOS_VERSION").replace("{osVersion}",n);break;default:e=_("UNSUPPORTED_CAPABILITIES")}}else{e=Ce(t,"requirementsString")||_("UNSUPPORTED_CAPABILITIES")}(i=new ta("banner")).items=[new bs(e)]}if(eo(t,Wo.UnsupportedPlatform)){let e;n=n.newOfferDisplayPropertiesChangingAppearance(!1,"disabled");const t=mo(r,"phone"),s=mo(r,"pad"),a=t||s,c=mo(r,"tv");e=mo(r,"mac")?_("UNSUPPORTED_MACOS_ONLY").replace("{appName}",o):c?a?_("UNSUPPORTED_IOS_TVOS_ONLY").replace("{appName}",o):_("UNSUPPORTED_TVOS_ONLY").replace("{appName}",o):s&&!t?_("UNSUPPORTED_PAD_ONLY").replace("{appName}",o):_("UNSUPPORTED_IOS_ONLY").replace("{appName}",o),(i=new ta("banner")).items=[new bs(e)]}i&&(e.shelfMapping.banner=i,e.offerDisplayProperties=n)}(o,e),Y&&(o.shelfMapping.description=Y),k&&(o.shelfMapping.videos=k),o.purchasedOrdering=Ct(!0,n),o.notPurchasedOrdering=Ct(!1,n),dr(n,o),"app-bundles"===e.type&&o.offerDisplayProperties.isFree&&!S("freeCMBEnabled")&&"mac"!==Ii&&(o.offerDisplayProperties.offerToken=null),o})}function mr(e){return u(e)?`${qi.internal}:/${ji.developer}/${ji.href}?${Zi.href}=${e.href}`:null}function gr(e){if(-1===tu.indexOf(e.media.kind))return!1;const t=e.clickAction;if(!t)return!0;const n=t.pageUrl;if(!n)return!0;const r=new as(n),o=Vo.product;for(const e of o)if(new Ic(e).matches(r))return!1;return!0}function yr(e,t,n){const r=e.ids;return r&&r.length?(e.sourcePageInformation=t.metricsPageInformation,e.sourceLocationTracker=t.locationTracker,e.destinationPageInformation=n,`${qi.internal}:/${ji.product}/${ji.shelf}/`+encodeURIComponent(JSON.stringify(e))):null}function wr(e,t,n,r){if(!e.data||0===e.data.length)return null;const o=[],i={metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.locationTracker}},s=c(n)?{}:{offerStyle:n};return{items:Or(e,{lockupOptions:Object.assign({},i,s),shouldConsiderDataPastLastAvailable:!0,contentUnavailable:(e,t)=>(o.push(e),!0),filter:r}),unavailableIds:o}}function Tr(e,t,n,r){return Fo.c("inAppPurchasesShelf",()=>{const o=X(e,"merchandised-in-apps");if(!o||!o.data.length)return null;if(!o.data.filter(function(e){return G(e,"isSubscription")===t}).length)return null;const i={pageInformation:r.metricsPageInformation,locationTracker:r.locationTracker,targetType:"swoosh",id:`${r.getSequenceId()}`,idType:"sequential"};let s="infer";qr(e)&&(s="disabled");const a=new ta("inAppPurchaseLockup");let l=null;n&&(l=n.spotlightInAppProductIdentifier),function(e,t){for(const n of t.data){let t=X(n,"app");t||(t={data:[e]}),c(n.relationships)&&(n.relationships={}),n.relationships.app=t}}(e,o);const u=[];if(a.items=function(e,t,n,r,o){const i=Or(e,{lockupOptions:{metricsOptions:n,offerStyle:t,skipDefaultClickAction:!0},contentUnavailable:function(e){return u.push(e),!1}});return r&&fr(r,i),i}(o,s,i,l).filter(function(e){return e.isSubscription===t}),u.length){const n=new Jl(u,a.title,!1,"inAppPurchaseLockup",s,null);n.appBundleId=Ce(e,"bundleId"),n.inAppShelfId=t?"subscriptions":"inAppPurchases",a.url=yr(n,r)}let p;return t?(a.title=_("PRODUCT_SECTION_SUBSCRIPTIONS","Subscriptions"),p="subscription"):(a.title=_("PRODUCT_SECTION_IN_APP_PURCHASES"),p="iAP"),me(i,a.title),ge(r.locationTracker),we(r.locationTracker),a.isHorizontal=!0,r.addImpressionsToShelf(a,p),a})}function Sr(e,t,n){e&&Fo.c("copyDataIntoLockup",()=>{t.adamId=e.id,t.bundleId=Ce(e,"bundleId");let r=null;n&&n.clientIdentifierOverride&&(r=n.clientIdentifierOverride),t.icon=no(e,r),n&&n.titleObjectPath?t.title=Ce(e,n.titleObjectPath):t.title=j(e,"name");const o=[];if(n&&n.subtitleObjectPaths){for(const t of n.subtitleObjectPaths)if(!n.maxSubtitleCount||n.maxSubtitleCount&&o.length<n.maxSubtitleCount){const n=h(e,t);n&&n.length&&o.push(n)}}else{const t=Ir(e);t&&o.push(t)}t.subtitles=o,t.developerTagline=Ce(e,"subtitle"),t.editorialTagline=bo(e,"tagline"),t.editorialDescription=bo(e,"standard"),t.shortEditorialDescription=bo(e,"short"),t.ageRating=j(e,"contentRatingsBySystem.appsApple.name"),ze(e)||(z(e,"userRating.ratingCount")>0||!n||!n.hideZeroRatings)&&(t.rating=z(e,"userRating.value"),t.ratingCount=O(z(e,"userRating.ratingCount")));const i=function(e,t){return Fo.c("clickOptionsForLockup",()=>{const n=Object.assign({},t,{id:e.id});return qr(e)&&(n.offerType="preorder"),n})}(e,n.metricsOptions),s=Vr(e),a=de(e,t.icon),c=Br(s,e,a,i),l=d(s,"discounts");let f=Yr(c,e,i,"default",n.ignoreIconInSidepack);u(n)&&p(n.externalDeepLinkUrl)&&(f=St(f,c.adamId,n.externalDeepLinkUrl,n.metricsOptions)),t.buttonAction=f;const m=Dt(e,!0);if(m){const e=new Ia,n=be(i);n.actionType="share",n.targetType="lockup",Le(e,n);const r=new Ds;r.shareAction=e,r.shareSheetData=m,t.contextMenuData=r}const g=Ur(e);let y=!1;g&&(y=!(zr(Vr(g))>0));const w=function(t){switch(e.type){case"in-apps":return"inAppPurchase";default:return"app"}}();if(t.offerDisplayProperties=n?Jr(c,w,e,n.offerStyle,n.offerEnvironment,l[0],y):Jr(c,w,e,null,null,l[0],y),!n||!n.skipDefaultClickAction){const o=u(n)?n.externalDeepLinkUrl:null;t.clickAction=Lr(e,i,r,n.ignoreIconInSidepack,o)}n&&n.ordinal&&(t.ordinal=n.ordinal);const T=_e(e,"editorialBadgeInfo");if(T){const e=h(T,"editorialBadgeType");t.isEditorsChoice=e&&"editorialPriority"===e}t.children=Ar(e,n);const S=gt(e,t,n.metricsOptions);mt(t,S)})}function Ar(e,t){const n=X(e,"apps");return n?Or(n,{lockupOptions:t,filter:Wo.None}):null}function vr(e,t,n,r){e&&Fo.c("copyMediaIntoMixedMediaLockup",()=>{t.screenshots=ao(e);const o=t.screenshots[0];t.trailers=[];const i=oo(e,n,r.metricsOptions,t.adamId);(l(o)||u(i)&&i.mediaPlatform.isEqualTo(o.mediaPlatform))&&t.trailers.push(i)})}function Ir(e){return Fo.c("subtitleFromData",()=>{const t=Ce(e,"subtitle");if(t)return t;{const t=ee(e,"genres");if(t.length>0){let e=t[0];const n=No.Games.toString();if(e.id===n)for(const r of t){const t=j(r,"parentId");if(r.id!==n&&t===n){e=r;break}}return j(e,"name")}{const t=q(e,"genreNames");return t.length>0?t[0]:null}}})}function br(e,t){const n=(new ba).param(Zi.id,t).param(es.inAppPurchaseId,e).build();return`${qi.internal}:/${ji.product}/${ji.install}/?${n}`}function kr(e,t){return Fo.c("lockupFromData",()=>{if(!e)return Fo.d("ignoredValue","data"),null;if(!function(e){return!c(g(e,"attributes"))}(e))return null;switch(e.type){case"in-apps":return _r(e,t);default:if(!S("childrenOnLockup"))return Pr(e,t);const n=new xs;return Sr(e,n,t),n}})}function _r(e,t){return Fo.c("inAppPurchaseLockupFromData",()=>{const n=new Us;return function(e,t,n){e&&Fo.c("copyDataIntoInAppPurchaseLockup",()=>{Sr(e,t,n);const r=Ur(e);if(!r)return;t.productIdentifier=j(e,"offerName"),t.parent=kr(r,n),t.description=j(e,"description.standard"),t.isVisibleByDefault=G(e,"isMerchandisedVisibleByDefault"),t.isSubscription=G(e,"isSubscription");const o=Vr(e),i=d(o,"discounts");t.offerDisplayProperties.hasDiscount=i.length>0,t.offerDisplayProperties.subscriptionFamilyId=j(e,"subscriptionFamilyId");const s=new ia("inAppPurchaseInstall");s.presentationContext="presentModalFormSheet";const a=br(t.adamId,r.id);s.pageUrl=a;const c=new _a;c.parentLockup=be(t.parent),c.lockup=be(t),c.preInstallOfferDescription=Xr(o),s.pageData=c;const l=j(e,"offerName"),u=Ce(r,"bundleId"),p=j(r,"firstVersionSupportingInAppPurchaseApi");if(p){const e=new pa(l,r.id,u,s,p);t.parent&&(e.appTitle=t.parent.title),e.productTitle=t.title,Le(e,Object.assign({},n.metricsOptions,{id:t.adamId,idType:"its_id",actionDetails:{parentAdamId:r.id}})),t.buttonAction=e}else{const e=new Ta("default");e.title=_("SEED_IN_APP_UNSUPPORTED_MESSAGE_OPTION_1"),e.message="",e.isCancelable=!0,t.buttonAction=e}const f=gt(e,t,n.metricsOptions);if(!n||!n.skipDefaultClickAction){const n=xr(e,f);t.clickAction=n,t.productAction=n}!function(e,t){e&&(e.impressionFields||mt(e,t),e.parent&&e.parent.adamId&&(e.impressionFields.parentAdamId=ce(e.parent.adamId)))}(t,f)},"item.offer.buyParams")}(e,n,t),n})}function Pr(e,t){return Fo.c("bundleLockupFromData",()=>{const n=new Vs;return function(e,t,n){e&&Fo.c("copyDataIntoBundleLockup",()=>{Sr(e,t,n);const r=X(e,"apps");if(r){const e={lockupOptions:n};t.children=Or(r,e)}})}(e,n,t),n})}function Cr(e,t){return Fo.c("screenshotsLockupFromData",()=>{const n=new Fs;return function(e,t,n){e&&Fo.c("copyDataIntoScreenshotsLockup",()=>{Sr(e,t,n),t.screenshots=ao(e)})}(e,n,t),n})}function Er(e,t,n){return Fo.c("trailersLockupFromData",()=>{const r=new Ns;return function(e,t,n,r){e&&Fo.c("copyDataIntoTrailersLockup",()=>{Sr(e,t,r),t.trailers=oo(e,n,r.metricsOptions,t.adamId)})}(e,r,n,t),r})}function Or(e,t){return c(e)?[]:Rr(e.data,t)}function Rr(e,t){return Fo.c("lockupsFromData",()=>{if(!e)return[];const n=[];for(let r=0;r<e.length;r++){const o=e[r];if(c(o.attributes)){t.contentUnavailable&&t.contentUnavailable(o.id,r);continue}const i=t.lockupOptions;let s=Wo.All;if(t.includeOrdinals){const n="descending"===t.ordinalDirection?e.length-r:r+1;i.ordinal=n.toString()}if(null!==t.filter&&(s=t.filter),eo(o,s))continue;t.excludeIconInSidepacksIfNotTvOnly&&(ne(o,"tvos")||(i.ignoreIconInSidepack=!0));const a=kr(o,i);a.isValid()&&(n.push(a),we(t.lockupOptions.metricsOptions.locationTracker))}return n})}function Dr(e,t,n,r=!1,o=null){return Fo.c(`actionFromData: ${e.type}`,()=>{switch(e.type){case"apps":case"app-bundles":return Lr(e,t,n,r,o);case"in-apps":return xr(e,t);case"editorial-items":return Fr(e,t,n);case"multiple-system-operators":return function(e,t){return e?Fo.c("msoActionFromPlatformData",()=>{const n=j(e,"url");if(!n)return Fo.d("ignoredValue","string","url"),null;const r=new ia("mso");return r.pageUrl=n,r.title=j(e,"name"),Le(r,t),r}):null}(e,t);case"groupings":return function(e,t){return e?Fo.c("groupingActionFromData",()=>{if(!e.href)return Fo.d("ignoredValue","string","href"),null;const n=new ia("page");return n.pageUrl=ot(function(e){const t=new Mi(e).includingAttributes(["editorialArtwork","isAppleWatchSupported","requiredCapabilities","minimumOSVersion"]),n=at();return u(n)&&t.addingQuery("contexts",n),t}(e.href)).toString(),n.title=Nr(e),Le(n,t),n}):null}(e,t);case"developers":default:return function(e,t){return e?Fo.c("genericActionFromData",()=>{const n=h(e,"type"),r=j(e,"url");if(!r)return Fo.d("ignoredValue","string","url"),null;const o=new ia("page");return o.pageUrl=r,o.title="groupings"===n?Nr(e):j(e,"name"),Le(o,t),o}):null}(e,t)}})}function xr(e,t){return Fo.c("iAPActionFromData",()=>{const n=Ur(e);if(!n)return null;const r=new ia("product"),o=j(n,"url"),i=j(e,"offerName"),s=G(e,"isSubscription");return r.pageUrl=function(e,t,n){const r=(new ba).param(ts.url,e).param(Zi.offerName,t).param(ts.isSubscription,n.toString()).build();return`${qi.internal}:/${ji.product}/${ji.lookup}/?${r}`}(o,i,s),r.title=j(e,"name"),Le(r,t),r})}function Fr(e,t,n,r){return e?Fo.c("editorialItemActionFromData",()=>{const o=j(e,"displaySubStyle"),i=$(e,"link"),s="List"===o||"NumberedList"===o,a=G(e,"isCanvasAvailable")||s,l=ee(e,"card-contents"),d=p(l)&&1===l.length;if(function(e){const t=h(e,"target");return t&&"external"===t}(i))return function(e,t){return Fo.c("editorialItemExternalLinkActionFromData",()=>{const n=h($(e,"link"),"url"),r=new aa(n),o=bo(e,"short");if(o)r.title=o;else{const e=new as(n);r.title=e.host}return Le(r,t),r})}(e,t);let f,m;if(a){f="article";const t=as.from(j(e,"url"));u(r)&&t.param(Zi.recoMetrics,JSON.stringify(r)),m=t.build()}else{if(d)return Dr(l[0],t,n);f="unknown",m=h(i,"url")}const g=new ia(f);g.pageUrl=m;let y=bo(e,"name");return c(y)&&(y=h(e,"label")),g.title=y,Le(g,t),g}):null}function Lr(e,t,n,r=!1,o=null){return e?Fo.c("productActionFromData",()=>{let i=j(e,"url");if(!i)return Fo.d("ignoredValue","string","url"),null;let s={};const a={};if(t.isAdvert){const n=h(e,"iad.lineItem");null!==n&&n.length>0&&(a[oc]=n);const r=t.pageInformation.iAdInfo.clickFields;a[rc]=JSON.stringify(r),s={iAdClickFields:r,iAdLineItem:n}}s.externalDeepLinkUrl=o,u(o)&&(a[yc]=o);const c=new as(i);for(const e of Object.keys(a))c.param(e,a[e]);s.clientIdentifierOverride=n,p(n)&&c.param("clientIdentifierOverride",n),i=c.toString();const l=function(e,t,n){const r=j(e,"url"),o=j(e,"name"),i=j(e,"artistName");let s=null;t&&(s=t.iAdClickFields);const a=vt("Software",e.id,`${i}_${o}`,s);return a.pageUrl=r,hr(e,new Xl(a,{rootPosition:0,locationStack:[]}),t,n)}(e,s,r),d=new ia("product");return d.pageUrl=i,d.pageData=l,d.title=j(e,"name"),t&&t.pageInformation&&(d.referrerUrl=t.pageInformation.pageUrl),qr(e)?Le(d,Object.assign({},t,{offerType:"preorder",offerReleaseDate:Gr(e)})):Le(d,t),d}):null}function Nr(e){const t=q(e,"genreNames");return p(t)?t[0]:j(e,"name")}function Mr(e){if(!e)return!1;const t=Ce(e,"requiredCapabilities");return!t||v(t.split(" "))}function Ur(e){return e?Z(e,"app"):null}function Vr(e){return Fo.c("offerDataFromData",()=>{const t=Pe(e,"offers");return 0===t.length?null:t[0]})}function Br(e,t,n,r){return Fo.c(`media_offerActionFromOfferData: ${t.id}`,()=>{let o=h(e,"buyParams");if(c(o))return Fo.d("ignoredValue","string","item.offer.buyParams"),null;"app-bundles"===t.type&&(o.indexOf("rebuy")>=0?o=o.replace("rebuy=false","rebuy=true"):(o.length>0&&(o+="&"),o+="rebuy=true"));const i=t.id;if(c(i))return Fo.d("ignoredValue","string","item.offer.id"),null;const s=$r(e),a=function(e,t,n,r,o,i){return Fo.c("purchaseConfigurationFromProduct",()=>{const s=j(e,"name");let a=j(e,"artistName");a||(a="test");const c=Ce(e,"bundleId"),l=po(e),u=j(e,"iad.lineItem"),p=Ce(e,"preflightPackageUrl"),d=new si(t,a,s,c,l,n,r,i,u,!1,p);return d.pageInformation=o,d})}(t,o,s,r.excludeAttribution,r.pageInformation,n),l=Wr(e,i,a);return function(e,t){Fe(e,t.pageInformation,fe(t,e.title),t.isAdvert)}(l,r),l})}function $r(e){return Fo.c("isPreorderFromOfferData",()=>"preorder"===h(e,"type"))}function qr(e){return Fo.c("isPreorderFromData",()=>{const t=Pe(e,"offers");return 0!==t.length&&$r(t[0])})}function jr(e){return!c(e)&&!c(e.purchaseConfiguration)&&e.purchaseConfiguration.isPreorder}function Hr(e){return c(e)||c(e.price)||0===e.price}function Gr(e){return Fo.c("expectedReleaseDateFromData",()=>De(j(e,"offers.0.expectedReleaseDate")))}function zr(e){const t=h(e,"type");return"buy"===t||"complete"===t||"preorder"===t?m(e,"price"):null}function Wr(e,t,n){return Fo.c("offerActionFromOfferData",()=>{const r=h(e,"type");let o;switch(r){case"get":case"preorder":o=_("OFFER_BUTTON_TITLE_GET","GET");break;default:o=r}let i=null,s=null;const a=zr(e);a>0&&(i=a,s=h(e,"priceFormatted"));const c=De(h(e,"expectedReleaseDate")),l=new la(o,t,n);return l.price=i,l.priceFormatted=s,l.expectedReleaseDate=c,l})}function Yr(e,t,n,r="default",o=!1){if(_o(t)){if("default"===r)return Dr(t,n,null,o);const i=function(e){if(c(e))return null;const t=Pe(e,"versionHistory");return t&&0!==t.length?h(t[0],"versionDisplay"):null}(t);if(p(i)){const t=Ue("mac",i),n=new aa(t);return new da(e.adamId,n)}}const i=jr(e);if("default"===r){if("app-bundles"===t.type)return Dr(t,n,null,o);if(i)return function(e,t,n,r=!1){if(c(e))return null;const o=Dr(t,n,null,r);if(!o)return e;const i=new da(e.adamId,o);return i.buyAction=e,i}(e,t,n)}return ne(t,"tvos")?function(e,t){const n=new Ta("default");n.title=_("BUY_TV_ONLY_ALERT_TITLE"),"BUY_TV_ONLY_ALERT_TITLE"===n.title&&(n.title="This will download to Apple TV."),n.message=_("BUY_TV_ONLY_ALERT_MESSAGE"),"BUY_TV_ONLY_ALERT_MESSAGE"===n.message&&(n.message="If the download doesn’t start automatically, open the App Store on your Apple TV, then go to Purchased and select the app."),n.isCancelable=!0,n.buttonActions=t?[Kr(e)]:[e],n.buttonTitles=[_("BUY_TV_ONLY_ALERT_BUTTON_TITLE")],"BUY_TV_ONLY_ALERT_BUTTON_TITLE"===n.buttonTitles[0]&&(n.buttonTitles=["Continue"]);const r=new da(e.adamId,n);return r.title=e.title,r}(e,Ee(t,"requiresGameController")):Qr(e,i,n)}function Qr(e,t,n){if(c(e))return null;if(Ei||t)return e;const r=new Ia;r.impressionFields=e.impressionFields;const o=be(n);c(o)||(o.actionType="buyInitiate",Le(r,n));const i=new ua(e,r);return i.confirmationAccessibilityAction=function(e){if(c(e))return null;const t=new Ta("default");c(e.priceFormatted)?(t.title=_("GET"),t.message="Are you sure you want to get "+e.purchaseConfiguration.appName):(t.title="Buy App",t.message=`Are you sure you want to buy ${e.purchaseConfiguration.appName} for ${e.priceFormatted}`),t.isCancelable=!0,t.buttonActions=[e];const n=new da(e.adamId,e);return n.buyAction=t,n}(e),i}function Kr(e){const t=new Ta("default");return t.title=_("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_TITLE"),t.message=_("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_MESSAGE"),t.buttonTitles=[_("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_BUTTON_TITLE")],t.isCancelable=!0,t.buttonActions=[e],t}function Jr(e,t,n,r,o,i,s,a="default"){return c(e)?null:Fo.c("displayPropertiesFromOfferAction",()=>{let c=r;eo(n,Wo.Offers)&&(c="disabled");const l=jr(e);Mr(n)||(c="disabled");const p=Ur(n);let d=null;p&&(d=p.id);let f=new ai(t,e.adamId,c,d,o);l&&(f.offerLabelStyle="preorder");const m=Hr(e);f.isFree=m;let g=null;if(g="default"!==a||"app-bundles"!==n.type&&!_o(n)?m?e.title:e.priceFormatted:_("OFFER_BUTTON_TITLE_VIEW"),f.titles.standard=g,Ei||(f.titles.confirmation=_(m?"ACTION_GET_CONFIRM":"ACTION_BUY_CONFIRM")),i){const e=h(i,"modeType"),t=h(i,"priceFormatted");if(u(t)&&u(e)){let n=null,r=null;switch(e){case"FreeTrial":s?(n=_("INTRO_PRICE_OFFER_FREE_TRIAL"),r=_("INTRO_PRICE_OFFER_FREE_TRIAL")):(n=_("INTRO_PRICE_OFFER_FREE_TRIAL"),r=_("INTRO_PRICE_OFFER_TRIAL"));break;case"PayUpFront":const o=_("INTRO_PRICE_OFFER_PAID_UPFRONT_TRIAL").replace("{price}",t);s?(n=o,r=o):(n=o,r=_("INTRO_PRICE_OFFER_TRIAL"));break;case"PayAsYouGo":n=_("INTRO_PRICE_OFFER_TRIAL"),r=_("INTRO_PRICE_OFFER_TRIAL")}f.titles.discountOwnedParent=n,f.titles.discountUnownedParent=r,f.subtitles.discountOwnedParent=_("INTRO_PRICE_OFFER_SUBTITLE"),f.subtitles.discountUnownedParent=_("INTRO_PRICE_OFFER_SUBTITLE");const o=10;let i=!1;for(const e of Object.keys(f.titles))if(f.titles[e].length>o){i=!0;break}i&&(f=f.newOfferDisplayPropertiesChangingAppearance(!1,null,"widthConstrainedLockup"))}}const y=Ee(n,"hasInAppPurchases");if(f.hasInAppPurchases=y,y){const e=_("INLINE_IN_APP_PURCHASES");f.subtitles.standard=e,Ei||(f.subtitles.confirmation=e)}const w=G(n,"isFirstPartyHideableApp");f.isDeletableSystemApp=w;const T=z(n,"contentRatingsBySystem.appsApple.value");return f.contentRating=T,"app-bundles"===n.type&&(f.offerToken={offerAction:e,offerDisplayProperties:be(f)}),f})}function Xr(e){const t=d(e,"discounts")[0];if(!t)return null;const n=h(t,"recurringSubscriptionPeriod"),r=h(e,"recurringSubscriptionPeriod");if(!n||!r)return null;const o=h(t,"modeType"),i=Zr(n),s=Zr(r),a=function(e,t,n){if(c(e)||c(t))return null;const r={D:"DAYS",W:"WEEKS",M:"MONTHS",Y:"YEARS"},o=r[e.type],i=r[t.type],s={FreeTrial:"FREE_TRIAL",PayUpFront:"PAID_UPFRONT",PayAsYouGo:"PAID_TRIAL"}[n];return o&&i&&s?`IN_APP_OFFER_PAGE_DESCRIPTION_${s}_${o}_POST_TRIAL_${i}`:null}(i,s,o);if(!a)return null;const l=h(t,"priceFormatted"),u=h(e,"priceFormatted"),p=m(t,"numOfPeriods"),f=i.period*p;switch(o){case"FreeTrial":const e=C(a,[f,s.period]);if(e)return e.replace("{postTrialPrice}",u);break;case"PayUpFront":const t=C(a,[f,s.period]);if(t)return t.replace("{trialPrice}",l).replace("{postTrialPrice}",u);break;case"PayAsYouGo":const n=C(a,[i.period,f,s.period]);if(n)return n.replace("{trialPrice}",l).replace("{postTrialPrice}",u);break;default:return null}return null}function Zr(e){if(!e)return null;const t=e.match(/P(\d+)([A-Z]+)/);if(!t||3!==t.length)return null;let n=m(t[1]),r=t[2];return n&&r?("D"===r&&n>0&&n%ou==0&&(r="W",n/=ou),new ru(n,r)):null}function eo(e,t=Wo.All){let n=!1;return t&Wo.ThirtyTwoBit&&(n=n||function(e){return Ee(e,"is32bitOnly")}(e)),t&Wo.UnsupportedSystemDeletableApps&&(n=n||function(e){return V(e,"shouldFilterDeletableSystemApp",()=>{const t=Ce(e,"bundleId");if(!G(e,"isFirstPartyHideableApp"))return!1;const n=host.deviceModel,r=n.startsWith("iPhone"),o=n.startsWith("iPad");let i;switch(i=!!Po("12.3")||Lo.isTVAppEnabled,t){case"com.apple.compass":case"com.apple.Bridge":return!r;case"com.apple.calculator":case"com.apple.weather":return o;case"com.apple.Photo-Booth":return!o;case"com.apple.tv":return!i;case"com.apple.videos":return i;case"com.apple.iCloudDriveApp":return!0;case"com.apple.facetime":return!v(["any-telephony"])||!v(["venice"]);case"com.apple.Fitness":return!Ri;case"com.apple.measure":return!v(["arkit"]);case"com.apple.Jellyfish":return!v(["front-depth-camera"]);case"com.apple.news":return(function(e){let t=null;if(p(Ci)){const e=Ci.split("-");p(e)&&(t=e[0])}if(!t){const e=Lo.metricsConfiguration;if(l(e))return!1;t=h(e,"metricsBase.storeFront")}return t||console.log("Client storefront not found in either client.storefrontIdentifer or bag metrics config"),!(!t||"143455"!==t)}()||function(e){const t=Lo.mediaCountryCode;return!(!t||""===t)&&t.toLowerCase()==="ca".toLowerCase()}())&&!Po("12.2");case"com.apple.shortcuts":return!0}return!1})}(e)),t&Wo.UnsupportedWatchAppOnWatchClient&&(n=n||function(e){return V(e,"shouldFilterUnsupportedWatchAppOnWatchClient",()=>{const t=Ee(e,"isAppleWatchSupported"),n="app-bundles"===e.type;return host.clientIdentifier===Si&&!t&&!n})}(e)),t&Wo.DisabledMerchandisableIAPs&&(n=n||function(e){return"in-apps"===e.type&&!G(e,"isMerchandisedEnabled")}(e)),t&Wo.LegacyMacApps&&(n=n||function(e){return V(e,"shouldFilterLegacyMacApps",()=>{const t=Ce(e,"bundleId");if(!("mac"===Ii))return!1;switch(t){case"com.apple.FaceTime":return!0;case"com.apple.InstallAssistant.Seed.macOS1013Seed1":case"com.apple.InstallAssistant.OSX12PublicSeed2":case"com.apple.InstallAssistant.OSX12CustomerSeed1":case"com.apple.InstallAssistant.OSX12Seed2":return!0;case"com.apple.Server.v3":case"com.apple.Server.v2":case"com.apple.Server.v1":return!0}return!1})}(e)),t&Wo.LegacyProductionMacOSInstaller&&(n=n||function(e){return V(e,"isLegacyMacOSInstaller",()=>{const t=Ce(e,"bundleId");if(!("mac"===Ii))return!1;switch(t){case"com.apple.InstallAssistant.ElCapitan2":case"com.apple.InstallAssistant.ElCapitan":case"com.apple.InstallAssistant.Yosemite":case"com.apple.InstallAssistant.Mavericks":case"com.apple.InstallAssistant.MountainLion":case"com.apple.InstallAssistant.Lion":case"com.apple.InstallAssistant.Sierra":case"com.apple.InstallAssistant.HighSierra":return!0}return!1})}(e)),t&Wo.UnsupportedPlatform&&(n=n||function(e){return V(e,"shouldFilterUnsupportedPlatform",()=>{if("apps"!==e.type&&"app-bundles"!==e.type)return!1;return!mo(po(e),Ii)})}(e)),t&Wo.UnsupportedPreorders&&(n=n||function(e){return V(e,"shouldFilterUnsupportedPreordersOnPlatform",()=>{return!!qr(e)&&("apps"===e.type&&!go(po(e),Ii))})}(e)),t&Wo.MinimumOSRequirement&&(n=n||function(e){return!Po(K(e,Oe(e),"minimumOSVersion"))}(e)),t&Wo.Arcade&&(n=n||function(e){return H(e,"supportsArcade")}(e)),n}function to(e,t,n){return Fo.c("artworkFromApiArtwork",()=>{const r=h(e,"url");if(c(r))return null;const o=new li(r,m(e,"width"),m(e,"height"),h(e,"bgColor"),h(e,"checksum"));return u(t)&&(o.style=t),u(n)&&(o.crop=n),o})}function no(e,t){return Fo.c("iconFromData",()=>{if(!e)return Fo.d("ignoredValue","data"),null;const n=e.type;let r;switch(t){case Si:case Ai:r="ios";break;case vi:r="appletvos";break;default:r=Oe(e)}const o=t||host.clientIdentifier,i=Q(e,r,"circularArtwork");if(o===Si&&u(i))return to(i,"round");const s=Ao(e),a=To(e)&&(o===Ai||s),c=Q(e,r,"ovalArtwork");if(a&&u(c))return to(c,"pill");let l;if("in-apps"===n)return to(l=$(e,"artwork"),"iap");if("app-bundles"===n){const t=to(l=$(e,"artwork"),"roundedRect");return t&&(t.format="png"),t}if(l=Q(e,r,"artwork"),ne(e,"tvos")||t===vi)return to(l,"tvRect");const p=to(l,"roundedRect");return p&&"osx"===r&&(p.format="png",p.style="unadorned"),p})}function ro(e,t,n){if(!e)return null;const r=function(e){switch(e){case"ipadPro_2018":return yu/hu.width;case"ipad_11":return wu/du.width;case"iphone_6_5":return Tu/su.width;case"iphone_5_8":return Su/au.width;case"appleWatch_2018":return Au/mu.width;default:return null}}(t);return new pi(e,n,r)}function oo(e,t,n,r){const o=io(e,t);if(!o)return null;const i=o.videos,s=[];if(i&&i.length>0)for(const e of i)ke(e,Object.assign({},n,{id:r})),s.push(e);let a=null;return s.length>0&&((a=new Ms).videos=s,a.mediaPlatform=o.mediaPlatform),a}function io(e,t){return Fo.c("platformVideoPreviewFromData",()=>{const n=function(e){return _e(e,"videoPreviewsByType")}(e),r={};if(!n)return null;const o=uo(e,host.clientIdentifier,Ii);if(0===o.length)return null;for(const e of o){const o=yo(e,bi);for(const e of Object.keys(n)){const o=d(n,e),i=[];for(const n of o){const r=g(n,"previewFrame");if(!r){Fo.d("ignoredValue","object",`videoPreviewsByType.${e}.previewFrame`);continue}const o=h(n,"video");if(!o){Fo.d("ignoredValue","string",`videoPreviewsByType.${e}.video`);continue}const s=new li(h(r,"url"),m(r,"width"),m(r,"height"),null,h(r,"checksum"));i.push(new _s(o,s,t))}r[e]=i}for(const t of o)if(r[t])return new iu(r[t],ro(e,t))}return null})}function so(e){return Fo.c("videoPreviewsFromApiPlatformData",()=>{const t=io(e);return t?t.videos:[]})}function ao(e,t=null,n){return Fo.c("screenshotsFromData",()=>{const r=[];let o=t;if(!o||0===o.length){const t=n||host.clientIdentifier;let r=Ii;"com.apple.AppStore.BridgeStoreExtension"===t&&(r="watch"),o=uo(e,t,r)}for(const t of o){const n=[];let o;if("messages"===t?(o=vo(e),So(e)&&n.push("faceTime")):o="tv"===t&&"iOS"===host.platform?Io(e,"appletvos"):Io(e),!o)continue;const i=lo(o,t,n);i&&r.push(i)}return r})}function co(e,t=null,n){return function(e){const t=[];if(e&&e.length>0)for(const n of e){const e=[];for(const t of n.artwork){const n=new Ps;n.screenshot=t,e.push(n)}const r=n.mediaPlatform,o=new Cs(e,r);t.push(o)}return t}(ao(e,t,n))}function lo(e,t,n){const r=yo(function(e){if("messages"===e)switch(Ii){case"pad":return"pad";default:return"phone"}return e}(t),bi);let o,i;for(let t=0;t<r.length&&!o;t++)o=e[r[t]],i=r[t];if(o){const e=o.map(to),r=ro(t,i,n);return new ui(e,r)}return null}function uo(e,t,n){return V(e,`sortedAppPlatformsFromData.${t}.${n}`,()=>{const r=po(e),o=[];let i=[];const s=function(e,t){-1===i.indexOf(e)&&-1===o.indexOf(e)&&-1!==r.indexOf(e)&&(i.push(e),t&&o.push(t))};switch(t){case Si:s("watch");break;case Ai:s("messages")}switch(n){case"phone":s("phone");break;case"pad":s("pad");break;case"tv":s("tv");break;case"watch":s("watch");break;case"mac":s("pad")}return s("phone"),s("pad"),s("messages"),s("watch"),s("tv"),s("mac"),i=i.filter(function(e){return-1===o.indexOf(e)})})}function po(e){return e?V(e,"supportedAppPlatformsFromData",()=>{const t=To(e),n=Ao(e),r=function(e){return Ee(e,"isAppleWatchSupported")}(e),o=q(e,"deviceFamilies"),i=[];for(const e of o)switch(e){case"iphone":n||i.push("phone");break;case"ipad":n||i.push("pad");break;case"tvos":i.push("tv")}return t&&i.push("messages"),r&&i.push("watch"),te(e,"mac")&&i.push("mac"),i}):null}function fo(e){switch(e){case"phone":return["phone","messages"];case"pad":return["phone","pad","messages"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}function ho(e,t){return-1!==e.indexOf(t)}function mo(e,t){return function(e){switch(e){case"phone":return["phone","watch","messages","tv"];case"pad":return["phone","pad","messages","tv"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}(t).some(t=>ho(e,t))}function go(e,t){return function(e){switch(e){case"phone":return["phone","watch","messages"];case"pad":return["phone","pad","messages"];case"tv":return["tv"];case"watch":return["watch"];case"mac":return["mac"];default:return[]}}(t).some(t=>ho(e,t))}function yo(e,t){switch(e){case"mac":return["mac"];case"watch":return["appleWatch_2018","appleWatch"];case"tv":return["appleTV"];case"pad":{const e=[];return t.isEqualTo(hu)&&ki>0?(e.push("ipadPro_2018"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(fu)?(e.push("ipadPro"),e.push("ipadPro_2018"),e.push("ipad_11"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(du)?(e.push("ipad_11"),e.push("ipadPro_2018"),e.push("ipadPro"),e.push("ipad_10_5"),e.push("ipad")):t.isEqualTo(pu)?(e.push("ipad_10_5"),e.push("ipad"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipadPro_2018")):(e.push("ipad"),e.push("ipad_10_5"),e.push("ipad_11"),e.push("ipadPro"),e.push("ipadPro_2018")),e}case"phone":{let e;e=t.isEqualTo(su)?"iphone_6_5":t.isEqualTo(au)?"iphone_5_8":t.isEqualTo(uu)?"iphone":t.isEqualTo(lu)?"iphone5":t.isEqualTo(cu)?"iphone6":"iphone6+";const n=gu.indexOf(e),r=gu.slice(0,n);r.reverse();const o=gu.slice(n+1);return[e].concat(r,o)}default:return[]}}function wo(e){if(c(e))return null;if("mac"===Ii)return function(e){const t=Vr(e);if(c(t))return null;const n=d(t,"assets");if(!n.length)return null;for(const e of n)if("macSoftware"===h(e,"flavor"))return m(e,"size");return null}(e);{const t=$(e,"fileSizeByDevice");if(t){let e=[];Pi&&(e=Pi.split(" ")),e=e.concat([host.deviceModel,"universal"]);for(const n of e){const e=m(t[n]);if(e)return e}}}return null}function To(e){return Ee(e,"hasMessagesExtension")}function So(e){return Ee(e,"supportsFunCamera")}function Ao(e){return Ee(e,"isHiddenFromSpringboard")}function vo(e){return _e(e,"messagesScreenshots")}function Io(e,t){return _e(e,"screenshotsByType",t)}function bo(e,t){return ko(e,t)||Ce(e,`itunesNotes.${t}`)}function ko(e,t){return Ce(e,`editorialNotes.${t}`)}function _o(e){return V(e,"isMacOSInstaller",()=>{if("mac"!==Ii)return!1;const t=Ce(e,"bundleId");return!!u(t)&&t.startsWith("com.apple.InstallAssistant")})}function Po(e){if(c(e)||0===e.length)return!0;const t=e.split("."),n=p(t[0])?m(t[0]):0,r=p(t[1])?m(t[1]):0,o=p(t[2])?m(t[2]):0;return host.isOSAtLeast(n,r,o)}function Co(e,t=host.clientIdentifier,n=[],r=Do){e||(e="mac"===r.deviceType?No.MacApps:No.Apps);const o=(new Mi).forType("categories").includingAdditionalPlatforms(n).addingQuery("genre",`${e}`);return t===Si?o.searchingContext("watch"):t===Ai&&o.searchingContext("messages"),o}function Eo(e,t=!0){return Fo.c("categoryListFromApiResponse",()=>{const n=function e(t,n=!0){return Fo.c("categoryFromApiResponse",()=>{if(!t)return null;const r=h(t,"name"),o=h(t,"genre"),i=h(t,"ages"),s=to(g(t,"artwork"));s&&(s.format="png");const a=d(t,"children").map(t=>e(g(t),n)).filter(e=>u(e)),c=function(e){return a.sort((e,t)=>{try{return e.name.localeCompare(t.name,Li,{usage:"sort"})}catch(e){return 0}})}(),l=h(t,"label");return l&&n&&c.unshift(new Ui(l,o,s,i,[])),new Ui(r,o,s,i,c)})}(g(d(e,"results.categories"),"0"),t);return n?new Vi(n.children):null})}function Oo(e,t,n,r="mt"){if(c(e))return n;const o=h(t,e);return c(o)?n:Ro(e,o,n,r)}function Ro(e,t,n,r="mt"){let o=e;return r&&(o="mt"+e.charAt(0).toUpperCase()+e.slice(1)),n+"&"+o+"="+encodeURIComponent(t)}var Do,xo,Fo,Lo,No,Mo,Uo,Vo,Bo,$o,qo,jo,Ho,Go,zo,Wo;n.r(t),Do={},n.r(Do),n.d(Do,"appStoreIdentifier",function(){return Ti}),n.d(Do,"watchIdentifier",function(){return Si}),n.d(Do,"messagesIdentifier",function(){return Ai}),n.d(Do,"tvIdentifier",function(){return vi}),n.d(Do,"deviceType",function(){return Ii}),n.d(Do,"screenSize",function(){return bi}),n.d(Do,"screenCornerRadius",function(){return ki}),n.d(Do,"guid",function(){return _i}),n.d(Do,"thinnedApplicationVariantIdentifier",function(){return Pi}),n.d(Do,"storefrontIdentifier",function(){return Ci}),n.d(Do,"newPaymentMethodEnabled",function(){return Ei}),n.d(Do,"buildType",function(){return Oi}),n.d(Do,"isActivityAvailable",function(){return Ri}),n.d(Do,"deviceHasCapabilities",function(){return v}),n.d(Do,"isPhone",function(){return I}),n.d(Do,"isPad",function(){return b}),n.d(Do,"isMac",function(){return k});const Yo="undefined"!=typeof ask&&void 0!==ask.randomSource?ask.randomSource:{arc4random:()=>Qo?Qo.arc4random():null,arc4random_uniform:e=>Qo?Qo.arc4random_uniform(e):null,sha256:e=>Qo?Qo.sha256(e):null,makeUUID:()=>Qo?Qo.makeUUID():null};let Qo=null;const Ko=()=>Yo.arc4random(),Jo=()=>Yo.makeUUID();let Xo=r(),Zo=o();const ei=r(),ti=r();xo=n(12),Fo=n(0);const ni={},ri="undefined"!=typeof ask?ask.props:{tvAppEnabledStorefronts:["143441","143455","143460"]};bag.registerBagKeys([{key:"trending-searches",type:"url"},{key:"search",type:"url"},{key:"searchHints",type:"url"},{key:"personalizedUserReviewUrl",type:"url"},{key:"personalizedUserReviewEnabled",type:"boolean"},{key:"p2-application-user-rate-content",type:"url"},{key:"p2-application-user-write-review",type:"url"},{key:"p2-accessory-room",type:"url"},{key:"passbook",type:"url"},{key:"library-link",type:"url"},{key:"metrics",type:"dictionary"},{key:"language-tag",type:"string"},{key:"language",type:"string"},{key:"p2-service-terms-url",type:"url"},{key:"usePostForAppStoreSearch",type:"boolean"},{key:"isBuyingScheduledGiftCertificateEnabled",type:"boolean"},{key:"isScheduledGiftingEnabled",type:"boolean"},{key:"AddFundsUrl",type:"url"},{key:"personalized-buy-buttons/software",type:"url"},{key:"uvSearch/nowplaying-enabled",type:"boolean"},{key:"supportLinkUrl",type:"url"},{key:"voteUrl",type:"url"},{key:"reportConcernUrl",type:"url"},{key:"reportConcernExplanation",type:"string"},{key:"reportConcernReasons",type:"array"},{key:"reportProblemUrl",type:"url"},{key:"reportProblemUrlDaysToDisplay",type:"number"},{key:"createAccountUrl",type:"url"},{key:"apps-media-api-host",type:"string"},{key:"apps-media-api-edge-host",type:"string"},{key:"apps-media-api-preview-host",type:"string"},{key:"apps-media-api-search-edge-host",type:"string"},{key:"apps-media-api-edge-end-points",type:"array"},{key:"countryCode",type:"string"},{key:"searchSortOptions",type:"array"},{key:"ageBands",type:"array"},{key:"processRedirectUrl/whitelistedQueryParams",type:"array"},{key:"processRedirectUrl/endpoint",type:"string"},{key:"requireAgeVerification",type:"boolean"},{key:"safariExtensionsGrouping",type:"url"}]),Lo={get trendingSearchesURL(){return bag.url("trending-searches")},get searchHintsURL(){return bag.url("searchHints")},get personalizedUserReviewURL(){return bag.url("personalizedUserReviewUrl")},get personalizedUserReviewEnabled(){return bag.boolean("personalizedUserReviewEnabled")},get userRateURL(){return bag.url("p2-application-user-rate-content")},get writeReviewURL(){return bag.url("p2-application-user-write-review")},get accessoryRoomURL(){return bag.url("p2-accessory-room")},get passbookMainURL(){return bag.url("passbook")},get libraryLinkURL(){return bag.url("library-link")},get metricsConfiguration(){return bag.dictionary("metrics")},get language(){return bag.string("language")},get mediaApiLanguage(){return bag.string("language-tag")||bag.string("language")},get termsAndConditionsURL(){return bag.url("p2-service-terms-url")},get usePostForAppStoreSearch(){return bag.boolean("usePostForAppStoreSearch")},get isMonetaryGiftingEnabled(){return bag.boolean("isBuyingScheduledGiftCertificateEnabled")},get accountTopUpURL(){return bag.url("AddFundsUrl")},get isContentGiftingEnabled(){return bag.boolean("isScheduledGiftingEnabled")},get buyButtonMetadataURL(){return bag.url("personalized-buy-buttons/software")},get isTVAppEnabled(){return bag.boolean("uvSearch/nowplaying-enabled")},get emailSupportLinkURL(){return bag.url("supportLinkUrl")},get voteUrl(){return bag.url("voteUrl")},get reportConcernUrl(){return bag.url("reportConcernUrl")},get reportConcernExplanation(){return bag.string("reportConcernExplanation")},get reportConcernReasons(){return bag.array("reportConcernReasons")},get reportProblemUrl(){return bag.url("reportProblemUrl")},get reportProblemUrlDaysToDisplay(){return bag.double("reportProblemUrlDaysToDisplay")||90},get createAccountUrl(){return bag.url("createAccountUrl")},get mediaCountryCode(){return bag.string("countryCode")},get mediaHost(){return bag.string("apps-media-api-host")},get mediaEdgeHost(){return bag.string("apps-media-api-edge-host")},get mediaEdgeSearchHost(){return bag.string("apps-media-api-search-edge-host")},get mediaPreviewHost(){return bag.string("apps-media-api-preview-host")},get edgeEndpoints(){const e=bag.array("apps-media-api-edge-end-points");return void 0===e?[]:e},get searchSortOptions(){return bag.array("searchSortOptions")||[]},get ageBands(){return bag.array("ageBands")||[]},get redirectUrlWhitelistedQueryParams(){return bag.array("processRedirectUrl/whitelistedQueryParams")||["affC","adId","advp","at","ct","itsct","itscg","itscc","itcCt","its_qt","ls","partnerId","pt","qtkid","uo"]},get redirectUrlEndpoint(){return bag.string("processRedirectUrl/endpoint")||"https://itunes.apple.com/WebObjects/MZStoreServices.woa/wa/processRedirectUrl"},get requireAgeVerification(){return bag.boolean("requireAgeVerification")},get safariExtensionsGroupingURL(){return bag.url("safariExtensionsGrouping")}};class oi{isValid(){return!0}}class ii extends oi{constructor(){super()}}class si extends oi{constructor(e,t,n,r,o,i,s,a,c,l,u,p){super(),this.buyParams=e,this.vendor=t,this.appName=n,this.bundleId=r,this.appPlatforms=o,this.isPreorder=null!=i&&i,this.excludeAttribution=null==s||s,this.metricsPlatformDisplayStyle=a,this.isRedownload=null!=l&&l,this.lineItem=c,this.preflightPackageUrl=void 0===u?null:u,this.additionalHeaders=p}}class ai extends oi{constructor(e,t,n,r,o,i,s,a,c,l,u,p,d,f,h){super(),this.offerType=e,this.adamId=t,this.parentAdamId=r,this.style=null==n?"infer":n,this.environment=null==o?"light":o,this.tint=null==i?"blue":i,this.titles=null==s?{}:s,this.subtitles=null==a?{}:a,this.hasInAppPurchases=c,this.isDeletableSystemApp=l,this.isFree=u,this.offerLabelStyle=null==p?"none":p,this.hasDiscount=d,this.contentRating=f,this.subscriptionFamilyId=h}newOfferDisplayPropertiesChangingAppearance(e,t,n,r){return new ai(this.offerType,this.adamId,null==t||!e&&"disabled"===this.style?this.style:t,this.parentAdamId,null==n?this.environment:n,null==r?this.tint:r,this.titles,this.subtitles,this.hasInAppPurchases,this.isDeletableSystemApp,this.isFree,this.offerLabelStyle,this.hasDiscount,this.contentRating,this.subscriptionFamilyId)}}class ci extends oi{constructor(e,t,n){super(),this.offerAction=t,this.offerDisplayProperties=n,this.personalizedOfferType=e}}class li extends oi{constructor(e,t,n,r,o){super(),this.style=null,this.crop="bb",this.format="jpeg",this.quality=70,this.template=e,this.width=t,this.height=n,this.backgroundColor=r,this.checksum=o}isValid(){return this.template&&this.width>0&&this.height>0}createArtworkWithFullWidthCanvasArtWorkaround(){const e=new li(this.template.replace("{c}","bw").replace("bb.{f}","bw.{f}"),this.width,this.height,this.backgroundColor,this.checksum);return e.style=this.style,e.crop=this.crop,e.format=this.format,e.quality=this.quality,e}}class ui extends oi{constructor(e,t){super(),this.artwork=e,this.mediaPlatform=t}}class pi extends oi{constructor(e,t,n){super(),this.appPlatform=e,this.supplementaryAppPlatforms=t||[],this.deviceCornerRadiusFactor=n}isEqualTo(e){this.supplementaryAppPlatforms.sort(),e.supplementaryAppPlatforms.sort();const t=this.supplementaryAppPlatforms.join(",")===e.supplementaryAppPlatforms.join(",");return e.appPlatform===this.appPlatform&&t&&e.deviceCornerRadiusFactor===this.deviceCornerRadiusFactor}}class di{constructor(e,t){this.width=e,this.height=t}static fromNativeSize(e){return new di(e.width,e.height)}isEqualTo(e){return e.width===this.width&&e.height===this.height}}class fi extends oi{constructor(e,t,n,r,o){super(),this.itemName=e,this.developer=t,this.category=n,this.fileSize=r,this.mediaType=o}}class hi extends oi{constructor(e,t,n,r,o,i,s,a){super(),this.context=e,this.text=t,this.url=n,this.shortUrl=r,this.artwork=o,this.giftAdamId=i,this.contentRating=s,this.notesMetadata=a}}class mi extends oi{constructor(e,t,n){super(),this.reasonId=e,this.name=t,this.uppercaseName=n}}class gi extends oi{constructor(e){super(),this.description=e,this.options=[],this.hasDivider=!0}}class yi extends oi{constructor(e,t,n){super(),this.title=e,this.value=t,this.action=n}}const wi="undefined"!=typeof ask?ask.client:{deviceType:"phone",screenSize:{width:0,height:0},screenCornerRadius:0,guid:"",deviceHasCapabilities:e=>!1,thinnedApplicationVariantIdentifier:null,storefrontIdentifier:"",newPaymentMethodEnabled:!1,buildType:"production",isActivityAvailable:!1},Ti="com.apple.AppStore",Si="com.apple.AppStore.BridgeStoreExtension",Ai="com.apple.MobileSMS",vi="AppleTV",Ii=wi.deviceType,bi=di.fromNativeSize(wi.screenSize),ki=wi.screenCornerRadius,_i=wi.guid,Pi=wi.thinnedApplicationVariantIdentifier,Ci=wi.storefrontIdentifier,Ei=wi.newPaymentMethodEnabled,Oi=wi.buildType,Ri=wi.isActivityAvailable;let Di=null;const xi=null,Fi="undefined"!=typeof ask?ask.loc:{identifier:"en",decimal:e=>null!=e?String(e):null,string:e=>e,stringWithCount:(e,t)=>e,stringWithCounts:(e,t)=>e,uppercased:e=>e,fileSize:e=>null!=e?`${e} bytes`:null,formattedCount:e=>null!=e?`${e}`:null,timeAgo:e=>null!=e?e.toString():null,formatDate:(e,t)=>null!=t?t.toString():null,relativeDate:e=>null!=e?e.toString():null},Li=Fi.identifier.split("_")[0],Ni={};class Mi{constructor(e){if(this.ids=new Set,this.relationshipIncludes=new Set,this.attributeIncludes=new Set,this.platform=null,this.additionalPlatforms=new Set,this.additionalQuery={},this.relationshipLimits={},this.searchTerm=null,this.searchTypes=[],this.context=null,this.platform=N(),!l(e))if("string"==typeof e)this.href=e;else if(Array.isArray(e)){const t=new Set;for(const n of e)t.add(n.type),this.ids.add(n.id);1===t.size?this.resourceType=t.values().next().value:t.size>1&&(this.resourceType="contents")}}forType(e){return this.resourceType=e,this}withIds(e){for(const t of e)p(t)&&this.ids.add(t);return this}includingRelationships(e){for(const t of e)this.relationshipIncludes.add(t);return this}includingAttributes(e){for(const t of e)this.attributeIncludes.add(t);return this}includingAdditionalPlatforms(e){for(const t of e)this.additionalPlatforms.add(t);return this}addingQuery(e,t){return this.additionalQuery[e]=t,this}addingRelationshipLimit(e,t){return this.relationshipLimits[e]=t,this}withSearchTerm(e){return this.searchTerm=e,this}searchingOverTypes(e){for(const t of e)this.searchTypes.push(t);return this}searchingContext(e){return this.context=e,this}attributingTo(e){return this.canonicalUrl=e,this}withFilter(e,t){return this.filterType=e,this.filterValue=t,this}}class Ui extends oi{constructor(e,t,n,r,o){super(),this.name=e,this.genreId=t,this.artwork=n,this.ageBandId=r,this.children=o}}class Vi extends oi{constructor(e){super(),this.categories=e}}!function(e){e[e.Apps=36]="Apps",e[e.MacApps=39]="MacApps",e[e.Games=6014]="Games",e[e.Discover=39]="Discover"}(No||(No={})),function(e){e[e.EditorialItem=59]="EditorialItem",e[e.Software=11]="Software"}(Mo||(Mo={}));const Bi="Apple-AUD",$i=Symbol("derived-data"),qi={internal:"x-as3-internal",http:"http",https:"https",itms:"itms",itmss:"itmss",itmsAppss:"itms-appss",itmsApps:"itms-apps",itmsMessagess:"itms-messagess",itmsMessages:"itms-messages",itmsWatchs:"itms-watchs",itmsWatch:"itms-watch",file:"file",resource:"resource",macappstore:"macappstore",macappstores:"macappstores"},ji={shelf:"shelf",store:"WebObjects/MZStore.woa/wa",storeElements:"WebObjects/MZStoreElements.woa/wa",lookup:"lookup",docTypeLookup:"docTypeLookup",install:"install",grouping:"viewGrouping",viewArtist:"viewArtist",viewSoftware:"viewSoftware",today:"today",genre:"genre",viewGenre:"viewGenre",recommendationsSeeAll:"recommendationsSeeAll",screenshots:"screenshots",room:"viewRoom",multiRoom:"viewMultiRoom",topCharts:"viewTop",mediaCharts:"charts",product:"app",productBundle:"app-bundle",developer:"developer",artist:"artist",ratings:"ratings",reviews:"reviews",viewReviews:"viewContentsUserReviews",personalizedReviews:"personalizedReviews",article:"article",story:"story",editorialItem:"editorialItem",viewEditorialItem:"viewEditorialItem",todayCardPreview:"todayCardPreview",mso:"mso",resetAndRedirect:"resetAndRedirect",account:"account",personalizationTransparency:"personalizationTransparency",href:"href",eula:"eula",appsForYou:"apps-for-you",storeFront:"storeFront",test:"test",builtIn:"builtIn",textAndImagesTest:"textAndImage",lockupsTest:"lockups",miscTest:"misc",articleTestArtwork:"articleArtworkTest",articleTestSingleAppIcon:"articleSingleAppIconTest",articleTestSingleAppIconHeroArt:"articleSingleAppIconHeroArtTest",articleTestBrandedApp:"articleBrandedAppTest",articleTestMultiAppTwo:"articleMultiAppTwoTest",articleTestMultiAppThree:"articleMultiAppThreeTest",articleTestGrid:"articleGridTest",articleTestInAppPurchase:"articleInAppPurchaseTest"},Hi="showUpdatesPage",Gi="showAccountPage",zi="showPurchasesPage",Wi="showSubscriptionsPage",Yi="searchExtensions",Qi="search.itunes.apple.com",Ki="storepreview.apple.com",Ji="arcadeSubscribePage",Xi="safariExtensions",Zi={id:"id",ids:"ids",countryCode:"cc",featuredContentId:"fcId",fetchData:"fetchData",isTodaySection:"isTodaySection",popId:"popId",genreId:"genreId",genre:"genre",mediaType:"mt",bundleIdentifier:"bundleIdentifier",offerName:"offerName",chartIdentifier:"chartIdentifier",v0:"v0",action:"action",type:"type",enabled:"enabled",href:"href",recoMetrics:"recoMetrics",showingFallbackMedia:"showingFallbackMedia",path:"path",useReleaseId:"useReleaseId",clientIdentifierOverride:"clientIdentifierOverride",grouping:"grouping"},es={inAppPurchaseId:"inAppPurchaseId"},ts={url:"productUrl",isSubscription:"isSubscription"},ns="availableAdamIds",rs={clientSpecifier:"app"},os=/^([a-z][a-z0-9.+-]*:)(\/\/)?([\S\s]*)/i,is=/([^=?&]+)=?([^&]*)/g,ss=["hash","query","pathname","host"];class as{constructor(e){if(this.query={},!e)return;let t=e;const n=os.exec(e);if(n){let e=n[1];e&&(e=e.split(":")[0]),this.protocol=e,t=n[3]}let r={remainder:t,result:null};for(const e of ss){if(!r.remainder)break;switch(e){case"hash":r=ie(r.remainder,"#","suffix"),this.hash=r.result;break;case"query":(r=ie(r.remainder,"?","suffix")).result&&(this.query=as.queryFromString(r.result));break;case"pathname":(r=ie(r.remainder,"/","suffix")).result&&(this.pathname="/"+r.result);break;case"host":if(r.remainder){const e=ie(r.remainder,"@","prefix"),t=e.result,n=e.remainder;if(t){const e=t.split(":");this.username=decodeURIComponent(e[0]),this.password=decodeURIComponent(e[1])}if(n){const e=n.split(":");this.host=e[0],this.port=e[1]}}break;default:throw new Error("Unhandled case!")}}}set(e,t){return t?("query"===e&&"string"==typeof t&&(t=as.queryFromString(t)),this[e]=t,this):this}append(e,t){const n=this[e];let r;if("query"===e)"string"==typeof t&&(t=as.queryFromString(t)),r=Object.assign({},n,t);else{let o=n;o||(o="");let i=o;if("pathname"===e){const e=o.length;e&&"/"===n[e-1]||(i+="/")}r=i+=t}return this.set(e,r)}param(e,t){return e?(this.query||(this.query={}),this.query[e]=t,this):this}removeParam(e){return e&&this.query?(void 0!==this.query[e]&&delete this.query[e],this):this}path(e){return this.append("pathname",e)}pathExtension(){if(void 0===this.pathname)return null;const e=this.pathname.split("/").filter(e=>e.length>0).pop().split(".");return e.filter(function(e){return""!==e}).length<2?null:e.pop()}pathComponents(){return this.pathname?this.pathname.split("/").filter(e=>e.length>0):[]}build(){return this.toString()}toString(){let e="";return this.protocol&&(e+=this.protocol+"://"),this.username&&(e+=encodeURIComponent(this.username),this.password&&(e+=":"+encodeURIComponent(this.password)),e+="@"),this.host&&(e+=this.host,this.port&&(e+=":"+this.port)),this.pathname&&(e+=this.pathname),this.query&&Object.keys(this.query).length&&(e+="?"+as.toQueryString(this.query)),this.hash&&(e+="#"+this.hash),e}static queryFromString(e){const t={};let n=is.exec(e);for(;n;){const r=decodeURIComponent(n[1]),o=decodeURIComponent(n[2]);t[r]=o,n=is.exec(e)}return t}static toQueryString(e){let t="",n=!0;for(const r of Object.keys(e)){n||(t+="&"),n=!1,t+=encodeURIComponent(r);const o=e[r];o&&o.length&&(t+="="+encodeURIComponent(o))}return t}static from(e){return new as(e)}static fromComponents(e,t,n,r,o){const i=new as;return i.protocol=e,i.host=t,i.pathname=n,i.query=r,i.hash=o,i}}class cs{constructor(){this.location=null,this.position=0}}class ls extends oi{constructor(e,t,n){super(),this.instruction=e,this.eventFields=Object.freeze(t),this.invocationPoints=n}}class us extends ls{constructor(e,t,n){super("click",n,[]),this.targetType=t,this.targetId=e}}class ps extends ls{constructor(e){const t={};Object.assign(t,e),t.actionType="back",super("click",t,["backButton"]),this.targetType="button",this.targetId="back"}}class ds extends ls{constructor(e,t,n){super("toroClick",n,[]),this.lineItem=e,this.impressionId=t}}class fs extends ls{constructor(e){super("page",e,["pageEnter"]),this.isReferralEligible=!1}static copyTimingMetricsInto(e,t){e&&(t.clientCorrelationKey=e.clientCorrelationKey,t.requestStartTime=e.requestStartTime,t.responseStartTime=e.responseStartTime,t.responseEndTime=e.responseEndTime)}}class hs extends ls{constructor(e,t,n,r,o){const i={};Object.assign(i,o),i.term=e,i.targetType=t,i.actionType=n,i.actionUrl=r,super("search",i,[])}}class ms extends ls{constructor(e){super("pageRender",e,["never"])}static copyTimingMetricsInto(e,t){e&&(t.pageUrl||(t.pageUrl=e.pageURL),t.clientCorrelationKey=e.clientCorrelationKey,t.platformRequestStartTime=e.requestStartTime,t.platformResponseStartTime=e.responseStartTime,t.platformResponseEndTime=e.responseEndTime,t.platformResponseWasCached=e.responseWasCached,t.platformJsonParseStartTime=e.parseStartTime,t.platformJsonParseEndTime=e.parseEndTime)}}class gs extends ls{constructor(e){super("impressions",e,["pageExit","appExit"]),this.impressionQueue="data-metrics"}}class ys extends ls{constructor(e){super("impressions",e,["timer","pageExit","appExit"]),this.impressionQueue="data-metrics-impressions-low-latency"}}class ws extends ls{constructor(e){super("media",e,["never"])}}class Ts{constructor(e,t,n){this.red=e,this.green=t,this.blue=n}get luminance(){return.2126*this.red+.7152*this.green+.0722*this.blue}static fromString(e){if(!e)return null;const t=Ts.HEX_PARSER.exec(e);if(null===t||4!==t.length)return null;const n=parseInt(t[1],16)/255,r=parseInt(t[2],16)/255,o=parseInt(t[3],16)/255;return new Ts(n,r,o)}}Ts.HEX_PARSER=new RegExp("#?([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])");class Ss{constructor(e,t){this.lightColor=e,this.darkColor=t}static with(e,t){return new Ss(Ts.fromString(e),Ts.fromString(t))}}class As extends oi{constructor(e,t,n){super(),this.title=e,this.summary=n,this.items=t}}class vs extends oi{constructor(e,t){super(),this.text=e,this.subText=t}}class Is extends oi{constructor(e,t){super(),this.allowsAutoPlay=!0,this.type=e,this.lockup=t}}Is.backgroundColor=Ss.with("F1F4F6","303031");class bs extends oi{constructor(e){super(),this.message=e}}class ks extends oi{constructor(e){super(),this.lockup=e}}ks.backgroundColor=Ss.with("F1F4F6","303031");class _s extends oi{constructor(e,t,n={}){super(),this.videoUrl=e,this.preview=t,this.allowsAutoPlay=n.allowsAutoPlay,this.looping=n.looping,this.canPlayFullScreen=n.canPlayFullScreen,this.showPlaybackControls=n.showPlaybackControls,this.templateMediaEvent=null}}class Ps extends oi{}class Cs extends oi{constructor(e,t){super(),this.items=e,this.mediaPlatform=t}}class Es extends oi{constructor(e){super(),this.type=e}}class Os extends oi{constructor(e,t,n){super(),this.paragraph=e,this.developerAction=n,this.developerLinks=t}}class Rs extends oi{constructor(e){super(),this.text=e,this.presentationStyle=[],this.clickAction=null}}class Ds extends oi{}class xs extends ii{isValid(){return!!this.title&&!(!this.icon||!this.icon.isValid())&&super.isValid()}}class Fs extends xs{isValid(){return!(!this.screenshots||!this.screenshots.length)&&super.isValid()}}class Ls extends xs{}class Ns extends xs{isValid(){return!(!this.trailers||!this.trailers.isValid())&&!(!this.editorialTagline||0===this.editorialTagline.length)&&super.isValid()}}class Ms extends oi{constructor(){super(...arguments),this.allowsAutoPlay=!0,this.looping=!0}isValid(){return this.videos&&this.videos.length>0&&super.isValid()}}class Us extends xs{}class Vs extends xs{isValid(){if(this.children)for(const e of this.children)if(!e.isValid())return!1;return super.isValid()}}class Bs extends ii{constructor(e,t,n){super(),this.text=e,this.mediaType=t||"text/plain",this.style=n||"standard",this.alignment="localized",this.isCollapsed=!1,this.wantsCollapsedNewlines=!0}}class $s extends oi{constructor(e,t,n){super(),this.text=e,this.style=t,this.mediaType=n,this.wantsCollapsedNewlines=!0}}class qs extends ii{constructor(){super(),this.caption=null,this.title=null,this.subtitle=null,this.artwork=null,this.clickAction=null}isValid(){return!!this.clickAction&&!(!this.artwork||!this.artwork.isValid())&&!(!this.caption||!this.title)&&super.isValid()}}class js extends ii{constructor(){super(),this.artwork=null,this.accessibilityLabel=null,this.shortEditorialDescription=null,this.clickAction=null,this.personalizationStyle="none"}isValid(){return this.clickAction&&this.artwork&&this.artwork.isValid()&&super.isValid()}}class Hs extends ii{constructor(e,t,n){super(),this.descriptionText=e,this.summaryText=t,this.clickAction=n}}class Gs extends oi{constructor(e,t){super(),this.text=e,this.linkedSubstrings=t}}class zs extends oi{constructor(e,t,n){super(),this.text=e,this.clickAction=t,this.type=n}}class Ws extends zs{constructor(e,t,n){super(e,t,"reportProblem"),this.numberOfDaysToDisplayLinkPostPurchase=n,this.isHiddenByDefault=!0}}class Ys extends oi{constructor(e){super(),this.buttons=e}}class Qs extends oi{constructor(e,t){super(),this.title=e,this.action=t}}class Ks extends ii{constructor(e,t,n="text/plain",r=null,o=null,i=null){super(),this.artwork=e,this.isFullWidth=t,this.hasRoundedCorners="boolean"==typeof i?i:!this.isFullWidth,this.ordinal=o,this.caption=r,this.captionMediaType=n}}class Js extends ii{constructor(e,t,n="text/plain",r=null,o=null,i=null){super(),this.canPlayFullScreen=!0,this.allowsAutoPlay=!0,this.looping=!0,this.showAudioControl=!0,this.video=e,this.isFullWidth=t,this.hasRoundedCorners="boolean"==typeof i?i:!this.isFullWidth,this.ordinal=o,this.caption=r,this.captionMediaType=n}}class Xs extends oi{constructor(e,t,n,r){super(),this.type=e,this.title=t,this.hasDivider=n,this.action=r}}class Zs extends ii{constructor(e,t,n,r){super(),this.text=e,this.credit=t,this.artwork=n,this.isFullWidthArtwork=r||!1}}class ea extends ii{constructor(e,t){super(),this.title=e,this.buttonAction=t}}class ta extends ii{constructor(e){super(),this.isPersonalized=!1,this.shouldFilterApps=!1,this.contentType=e,this.title=null,this.subtitle=null,this.seeAllAction=null,this.isHorizontal=!1,this.items=[],this.url=null,this.isHidden=!1,this.mergeWhenFetched=!1,this.backgroundColor=null,this.rowsPerColumn=null}}class na extends oi{}class ra extends oi{constructor(){super(),this.shelves={},this.errors={}}}class oa extends ii{constructor(e){super(),this.title=null,this.artwork=null,this.presentationStyle=[],this.actionClass=e}}class ia extends oa{constructor(e,t){super("FlowAction"),this.page=e,this.pageUrl=t,this.pageData=null,this.presentationContext="infer",this.animationBehavior="infer",this.origin="inapp"}}class sa extends oa{constructor(e){super("TabChangeAction"),this.navigationTab=e,this.actions=[]}}class aa extends oa{constructor(e,t=!0){super("ExternalUrlAction"),this.url=e,this.isSensitive=t}}class ca extends oa{constructor(e){super("CompoundAction"),this.actions=e}}class la extends oa{constructor(e,t,n){super("OfferAction"),this.title=e,this.adamId=t,this.purchaseConfiguration=n,n&&(this.bundleId=n.bundleId,this.lineItem=n.lineItem)}}class ua extends oa{constructor(e,t){super("OfferConfirmationAction"),this.buyAction=e,this.confirmationInitiationAction=t}}class pa extends oa{constructor(e,t,n,r,o){super("InAppPurchaseAction"),this.productIdentifier=e,this.appAdamId=t,this.appBundleId=n,this.installRequiredAction=r,this.minimumShortVersionSupportingInAppPurchaseFlow=o}}class da extends oa{constructor(e,t){super("AppStateAction"),this.title=t.title,this.adamId=e,this.defaultAction=t}}class fa extends oa{constructor(e){super("HttpAction"),this.url=e,this.method="GET",this.headers={},this.body=null,this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}}class ha{constructor(e,t,n,r){this.key=e,this.target=t,this.inputType=n,this.title=r,this.isRequired=!0,this.maximumLength=null}}class ma extends oa{constructor(e){super("HttpTemplateAction"),this.message=null,this.url=e,this.method="GET",this.headers={},this.body=null,this.parameters=[],this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}}class ga extends ma{}class ya extends oa{constructor(e,t){super("WriteReviewAction"),this.adamId=e,this.url=t}}class wa extends oa{constructor(e){super("SheetAction"),this.actions=e,this.isCancelable=!1,this.message=null,this.style="default"}}class Ta extends oa{constructor(e){super("AlertAction"),this.style=e,this.title=null,this.message=null,this.isCancelable=!1,this.buttonActions=[],this.buttonTitles=[]}}class Sa extends oa{constructor(e){super("ShareSheetAction"),this.data=e}}class Aa extends oa{constructor(e){super("ReportConcernAction"),this.reasons=e}}class va extends oa{constructor(e,t){super("ProductPageScrollAction"),this.section=e,this.clicksOnScroll=t}}class Ia extends oa{constructor(e){super("BlankAction"),null!=e&&(this.metricsEvents=[e])}}class ba{static get contentType(){return"application/x-www-form-urlencoded"}constructor(){this._params=""}param(e,t){if(e&&t){const n=this._params.length>0?"&":"";this._params+=`${n}${encodeURIComponent(e)}=${encodeURIComponent(t)}`}return this}build(){return this._params}}class ka extends oi{constructor(e){super(),this.shelves=e,this.title=null,this.presentationOptions=[],this.isIncomplete=!1}}class _a extends oi{}class Pa extends oi{constructor(e,t,n,r){super(),this.id=e,this.title=t,this.selectedActionTitle=n,this.url=r}}class Ca extends ka{constructor(){super([])}}class Ea extends oi{}class Oa extends oi{}class Ra extends oi{}class Da extends oi{}class xa extends oi{constructor(e){super(),this.showsBadge=!1,this.title=null,this.notes=e,this.isCollapsed=!0}}class Fa extends oi{}const La=20,Na={11:"43",30:"44"},Ma="helpful",Ua=(e,t)=>e||t,Va=[Lo.mediaHost,Lo.mediaEdgeHost,Lo.mediaEdgeSearchHost],Ba=["description","fileSizeByDevice","messagesScreenshots","minimumOSVersion","privacyPolicyUrl","promotionalText","screenshotsByType","supportsFunCamera","supportURLForLanguage","versionHistory","videoPreviewsByType","websiteUrl"],$a=/id([0-9]+)\/?$/i,qa=["latest-release-app","system-apps","app-bundles","ios-apps","imessage-apps","watch-apps","atv-apps"],ja="mac-apps";Uo=n(3);const Ha={eventRecorder:{recordEvent:(e,t)=>!t||Uo.config.metricsDisabledOrBlacklistedEvent(t.eventType)||function(e){const t=h(e,"hostApp");return!c(t)&&Ga.has(t)}(t)?null:(Uo.config.removeBlacklistedFields(t),function(e,t){ask.storeMetrics.recordEvent(e,t)}(e,t),t),sendMethod:()=>"itms"}},Ga=new Set([]),za="xp_amp_appstore",Wa="xp_amp_appstore_feedback",Ya="hasiAdData",Qa="hackForMacDeveloperAnalytics",Ka=new Set,Ja={cookieString:"",appString:"",app(){return this.appString},appVersion:()=>null,capacitySystemAvailable:()=>null,capacitySystem:()=>null,capacityDisk:()=>null,capacityDataAvailable:()=>null,capacityData:()=>null,connectionType:()=>null,cookie(){return null===this.cookieString||void 0===this.cookieString?"":this.cookieString},cookieOwnerObject(){return{cookie:this.cookie().toString()}},dsId:()=>null,hostApp:()=>null,osVersion:()=>null,pageUrl:()=>null,pixelRatio:()=>null,resourceRevNum:()=>A("version"),screenHeight:()=>null,screenWidth:()=>null,storeFrontHeader:()=>null,userAgent:()=>null,userType:()=>null,windowInnerHeight:()=>null,windowInnerWidth:()=>null,windowOuterHeight:()=>null,windowOuterWidth:()=>null},Xa=()=>[Lo.metricsConfiguration],Za={postEvent(e){Ja.cookieString=e.cookie,delete e.cookie,delete e.resourceRevNum,""===Ja.appString&&(Ja.appString=e.app);const t=e[Qa];delete e[Qa],e.clientBuildType=Oi;const n=e.eventType;switch(console.log(`metrics.recorder.postEvent(${n})`),n){case"enter":return this.postEnterEvent(e);case"exit":return this.postExitEvent(e);case"click":return this.postClickEvent(e);case"page":return this.postPageEvent(e);case"search":return this.postSearchEvent(e);case"impressions":return this.postImpressionsEvent(e,t);case"media":return this.postMediaEvent(e);default:return this.postGenericEvent(e)}},flush(){wt()},postEnterEvent(e){const t=Uo.eventHandlers.enter.metricsData(e.pageId,e.pageType,e.pageContext,e);return Ha.eventRecorder.recordEvent(za,t),t},postExitEvent(e){const t=Uo.eventHandlers.exit.metricsData(e.pageId,e.pageType,e.pageContext,e);return Ha.eventRecorder.recordEvent(za,t),wt(),t},postClickEvent(e){const t=Uo.eventHandlers.click.metricsData(e.pageId,e.pageType,e.pageContext,e.target,e);return Ha.eventRecorder.recordEvent(za,t),e[Ya]&&wt(),t},postPageEvent(e){const t=h(e,"refUrl"),n=le(t);t&&n&&(e.refApp=n);const r=pe(t);r&&(e.searchTerm=r);const o=Uo.eventHandlers.page.metricsData(e.pageId,e.pageType,e.pageContext,e);return Ha.eventRecorder.recordEvent(za,o),o},postSearchEvent(e){e.eventVersion=3;const t=Uo.eventHandlers.search.metricsData(e.pageId,e.pageType,e.pageContext,e);return Ha.eventRecorder.recordEvent(za,t),t},postImpressionsEvent(e,t){if(null===e.impressions)return{};if(function(e){if(w(e,"hasiAdData")){const t=d(e,"impressions");if(1!==t.length)return!1;const n=t[0];if("data-metrics-impressions-low-latency"!==h(n,"impressionQueueTag"))return!1;const r=h(n,"iAdImpressionId");return Ka.has(r)?(console.log("fastpipe impressions filtered for iAdImpressionId"+r),!0):(Ka.add(r),!1)}return!1}(e))return{};if(t){const n=e.impressions;t.impressionTimes=[Date.now()],t.impressionId=n.length,n.push(t),e.impressions=n}const n=pe(h(e,"refUrl"));n&&(e.searchTerm=n),delete e.refUrl;const r=Uo.eventHandlers.impressions.metricsData(e.pageId,e.pageType,e.pageContext,e);return Ha.eventRecorder.recordEvent(za,r),e[Ya]&&wt(),r},postMediaEvent(e){const t=Uo.eventHandlers.media.metricsData(e.pageId,e.pageType,e.pageContext,e),n=t.position;return u(n)&&(t.position=Math.round(n)),Ha.eventRecorder.recordEvent(za,t),t},postGenericEvent(e){const t=e.topic||za;return Ha.eventRecorder.recordEvent(t,e)}};Uo.init(za,Xa,Ha,null,null),Uo.system.environment.setDelegate(Ja);const ec=Symbol("metricsHelpers.timingValues"),tc=Symbol("metricsHelpers.requestedUrl"),nc=Symbol("metricsHelpers.pageInformation"),rc="X-AppStore-iAdClickToken",oc="X-AppStore-iAdLineItem";class ic{constructor(e,t){this.pageFields={},this.clickFields={},this.impressionsFields={},this.fastImpressionFields={},this.iAdClickEventFields={},this._iAdApplied=!1,this._iAdId=e,this._iAdAdamId=null,this.pageFields[Ya]=!0,this.pageFields.iAdAppStoreClientRequestId=t,this.pageFields.iAdId=ce(e)}get iAdIsPresent(){return this._iAdApplied}get iAdAdamId(){return this._iAdAdamId}apply(e,t){if(this._iAdAdamId=e,t){this.impressionsFields[Ya]=!0,this.impressionsFields.iAdId=ce(this._iAdId),this.fastImpressionFields.iAdImpressionId=ce(t.impressionId),this.fastImpressionFields.iAdMetadata=ce(t.metadata);const n={iAdFormat:ue(y(t,"format")),iAdAlgoId:ce(t.algoId),iAdImpressionId:ce(t.impressionId),iAdMetadata:ce(t.metadata)};this.pageFields.iAd=n,this.pageFields.adamId=e,this.clickFields[Ya]=!0,this.clickFields.iAdId=ce(this._iAdId),this.clickFields.iAdImpressionId=ce(t.impressionId),this.clickFields.iAdMetadata=ce(t.metadata),Object.assign(this.iAdClickEventFields,t),this._iAdApplied=!0}}applyClickFieldsFromPageRequest(e,t){this._iAdApplied=!0,this._iAdAdamId=e,Object.assign(this.clickFields,t)}setSpecifiedCreativeUsed(e){this.fastImpressionFields.iAdIsSpecifiedCreativeUsed=e,this.clickFields.iAdIsSpecifiedCreativeUsed=e}}class sc{constructor(e={}){this.baseFields=e}}class ac extends oi{}class cc extends oi{constructor(e,t){super(),this.type=e,this.values=t}}class lc extends oi{constructor(e,t,n=null){super(),this.name=e,this.value=t,this.isSelected=t===n}}class uc extends oi{constructor(e,t){super(),this.type=e,this.resultModel=t}}class pc extends Ls{constructor(e,t,n){super(),this.isAd=!0,this.lineItem=e,this.impressionId=t,this.transparencyAction=n}}class dc extends oa{constructor(e){super("AdTransparencyAction"),this.adTransparencyData=e}}class fc extends ii{}class hc extends oa{constructor(e,t,n,r){super("SearchAction"),this.term=e,this.url=t,this.origin=n,this.entity=r}}class mc extends oi{constructor(e){super(),this.hints=e}}class gc extends oi{constructor(e,t){super(),this.title=e,this.searches=t}}const yc="externalDeepLinkUrl";class wc extends oi{constructor(e,t,n,r,o,i,s="infer"){super(),this.type=e,this.content=t,this.caption=n,this.longCaption=r,this.leadingValue=s,this.accessibilityTitle=o,this.accessibilityCaption=i}}class Tc extends oi{constructor(e,t){super(),this.type=e,this.shelfId=t}}class Sc extends oi{constructor(e,t){super(),this.title=e,this.subtitle=t}}class Ac extends xs{}Vo={product:[{protocol:qi.https,path:`/{countryCode}/${ji.product}/{appName}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.productBundle}/{appName}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.product}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.productBundle}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/${ji.product}/{appName}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/${ji.productBundle}/{appName}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/${ji.product}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,path:`/${ji.product}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.v0}?`]},{protocol:qi.https,path:`/${ji.productBundle}/{id}`,query:[`${Zi.mediaType}?`,`${Zi.action}?`,`${Zi.offerName}?`]},{protocol:qi.https,query:[Zi.bundleIdentifier]},{protocol:qi.https,query:[Zi.action,Zi.ids]},{protocol:qi.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/catalog/{countryCode}/apps/{id}",query:[]},{protocol:qi.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/catalog/{countryCode}/app-bundles/{id}",query:[]},{protocol:qi.https,path:"{apiVersion}/catalog/{countryCode}/apps/{id}",query:[]},{protocol:qi.https,path:"{apiVersion}/catalog/{countryCode}/app-bundles/{id}",query:[]},{protocol:qi.https,path:`/${ji.store}/${ji.viewSoftware}`,query:[Zi.id,`${Zi.v0}?`]}],reviews:[{protocol:qi.https,path:`/{countryCode}/${ji.product}/{appName}/{id}`,query:[Zi.mediaType],hash:"reviews"},{protocol:qi.https,path:`/${ji.store}/${ji.viewReviews}`,query:[Zi.id]}],sortedReviews:[{protocol:qi.internal,path:`/${ji.reviews}/{adamId}/{sort}`}],productInAppPurchase:[{protocol:qi.internal,path:`/${ji.product}/${ji.lookup}`,query:[ts.url,Zi.offerName,ts.isSubscription]}],inAppPurchaseInstall:[{protocol:qi.internal,path:`/${ji.product}/${ji.install}`,query:[`${Zi.id}`,`${es.inAppPurchaseId}?`]}],topCharts:[{protocol:qi.https,path:`/${ji.store}/${ji.topCharts}`,query:[Zi.genreId,Zi.popId]},{protocol:qi.https,path:`/{apiVersion}/catalog/{countryCode}/${ji.mediaCharts}`,query:[`${Zi.genre}?`]}],developer:[{protocol:qi.https,path:`/${ji.developer}/{id}`},{protocol:qi.https,path:`/${ji.developer}/{developerName}/{id}`},{protocol:qi.https,path:`/{countryCode}/${ji.developer}/{developerName}/{id}`,query:[`${Zi.mediaType}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.artist}/{developerName}/{id}`,query:[`${Zi.mediaType}?`]},{protocol:qi.https,path:`/${ji.store}/${ji.viewArtist}`,query:[Zi.id,`${Zi.v0}?`]}],developerHref:[{protocol:qi.internal,path:`/${ji.developer}/${ji.href}`,query:[Zi.href]}],grouping:[{protocol:qi.https,path:`/${ji.store}/${ji.grouping}`,query:[Zi.id]},{hostName:Ki,path:`/WebObjects/{storePreviewInstance}/wa/${ji.grouping}`,query:[Zi.id,`${Zi.useReleaseId}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.genre}/{genreName}/{id}`,query:[Zi.mediaType]},{protocol:qi.https,path:`/${ji.store}/${ji.viewGenre}`,query:[Zi.id,Zi.mediaType]},{hostName:Ki,path:`/WebObjects/{storePreviewInstance}/wa/${ji.viewGenre}`,query:[Zi.id,Zi.mediaType,`${Zi.useReleaseId}?`]},{protocol:qi.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}",query:[]},{protocol:qi.https,path:"{apiVersion}/{realm}/editorial/{countryCode}/groupings/{id}",query:[]},{protocol:qi.https,path:"{apiVersion}/editorial/{countryCode}/groupings/{id}",query:[]},{protocol:qi.https,hostName:`${Xi}`}],search:[{hostName:Qi,path:"WebObjects/MZContentLink.woa/wa/link",query:[Zi.path]}],article:[{protocol:qi.https,path:`/{countryCode}/${ji.editorialItem}/{id}`,query:[`${Zi.showingFallbackMedia}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.story}/{id}`,query:[`${Zi.showingFallbackMedia}?`]},{protocol:qi.https,path:`/${ji.story}/{id}`,query:[`${Zi.showingFallbackMedia}?`]},{protocol:qi.https,path:`/${ji.store}/${ji.viewEditorialItem}`,query:[Zi.id,`${Zi.showingFallbackMedia}?`]},{protocol:qi.https,path:"WebObjects/MZStorePlatform.woa/ra/{apiVersion}/{realm}/editorial/{countryCode}/editorial-items/{id}",query:[Zi.id,`${Zi.showingFallbackMedia}?`]},{protocol:qi.https,path:"{apiVersion}/editorial/{countryCode}/editorial-items/{id}",query:[Zi.id,`${Zi.showingFallbackMedia}?`]}],msoRoom:[{protocol:qi.https,path:`/{countryCode}/${ji.mso}/{appName}/{id}`,query:[`${ns}?`]},{protocol:qi.https,path:`/${ji.mso}/{providerName}/{id}`,query:[`${ns}?`]},{protocol:qi.https,path:`/{countryCode}/${ji.mso}/{id}`,query:[`${ns}?`]},{protocol:qi.https,path:`/${ji.mso}/{id}`,query:[`${ns}?`]},{protocol:qi.https,path:`/${ji.mso}`,query:[Zi.id,`${ns}?`]},{protocol:qi.https,path:`{countryCode}/${ji.mso}`,query:[Zi.id,`${ns}?`]}],resetAndRedirect:[{protocol:qi.https,path:`/${ji.store}/${ji.resetAndRedirect}`}],action:[{query:[Zi.action]}],personalizationTransparency:[{protocol:qi.internal,path:`/${ji.account}/${ji.personalizationTransparency}`,query:[Zi.enabled]}]};const vc=[qi.https,qi.itmsApps,qi.itmsAppss,qi.itmsMessages,qi.itmsMessagess,qi.itmsWatch,qi.itmsWatchs,qi.macappstore,qi.macappstores];class Ic{constructor(e){var t;this.identifier=e.identifier,this._protocol=null==(t=e.protocol)?null:t,this._hostName=e.hostName,e.path?(this._pathComponents=e.path.split("/").filter(e=>e.length>0),this._pathParameterMap=function(e){const t={};return e.forEach((e,n)=>{Pt(e)&&(t[e]=n)}),t}(this._pathComponents)):(this._pathComponents=null,this._pathParameterMap=null),this._pathExtension=e.pathExtension,this._query=function(e){const t=[];if(!e)return t;for(const n of e){const e=n.split("=");let r=e[0];const o=-1!==r.indexOf("?");r=r.replace("?","");let i=null;e.length>1&&(i=decodeURIComponent(e[1])),t.push({key:r,value:i,optional:o})}return t}(e.query),this._hash=e.hash,e.exclusions?this._exclusions=e.exclusions.map(function(e){return new Ic(e)}):this._exclusions=null}matches(e){if(this._protocol&&e.protocol!==this._protocol)return!1;if(this._hostName&&e.host!==this._hostName)return!1;if(this._pathComponents){const t=this._pathComponents,n=e.pathComponents();if(t.length!==n.length)return!1;const r=t.length;for(let e=0;e<r;e++){const r=t[e];if(!Pt(r)&&r!==n[e])return!1}}if(this._pathExtension&&e.pathExtension()!==this._pathExtension)return!1;if(this._query)for(const t of this._query){const n=e.query[t.key];if(!n&&!t.optional)return!1;if(t.value&&t.value!==n)return!1}if(this._hash&&e.hash!==this._hash)return!1;if(this._exclusions)for(const t of this._exclusions){if(t._exclusions)throw Error("Matching exclusion rules with further exclusion rules may introduce significant code-complexity and/or reduce the ease with which developers are able to reason about your desired goals. Are there any simpler options?");if(t.matches(e))return!1}return!0}extractParameters(e){const t={};if(this._pathComponents){const n=e.pathComponents();for(const e of Object.keys(this._pathParameterMap)){const r=e.replace("{","").replace("}",""),o=this._pathParameterMap[e];t[r]=decodeURIComponent(n[o])}}if(this._query)for(const n of this._query)t[n.key]=e.query[n.key];return t}}class bc{constructor(){this._routeMappings=[]}associate(e,t){const n=[];for(const t of e)n.push(new Ic(t));this._routeMappings.push({route:n,object:t})}routedObjectForUrl(e){let t="string"==typeof e?new as(e):e;t=function(e){const t="string"==typeof e?new as(e):e;if(!_t(t))return t;const n=t.build();let r,o=be(t.query);const i={"finance-app.itunes.apple.com":"account"},s=[{key:"MZSearch.woa",action:"search"},{key:"search",action:"search"},{key:"freeProductCodeWizard",action:"redeem"},{key:"redeemLandingPage",action:"redeem"},{key:"showDialogForRedeem",action:"redeem"},{key:"redeem",action:"redeem"},{key:"buyLandingPage",action:"gift"},{key:"buyCharityGiftWizard",action:"donate"},{key:"longUrlHandler",action:"checkForLongUrl"},{key:"checkForPreorders",action:"checkForPreorders"},{key:"MZFinance.woa",action:"account"}],a={"accessory-lookup":"accessoryLookup",showDialogForRedeem:"redeem","finance-app":"account",viewEula:"eula",software:"apps"};let c=!1;for(const e of Object.keys(i))if(t.host&&-1!==t.host.indexOf(e)){c=!0,r=i[e];break}let l=!1;for(const e of s){const n=e.key;if(t.pathname&&-1!==t.pathComponents().indexOf(n)){l=!0,r=e.action,void 0!==o[n]&&delete o[n];break}}for(const e of Object.keys(a)){const n=void 0!==t.query[e]&&null!==t.query[e],i=t.query.action&&-1!==t.query.action.indexOf(e);if(n||i){r=a[e],void 0!==o[e]&&delete o[e];break}}if("account"===r&&-1!==n.indexOf("getPass")&&(r="addToPassbook",delete o.getPass),r){const e=null,n=null,i={action:r};return"redeem"===r&&(o.code||o.certId)?i.code=o.code||o.certId:"account"!==r&&"checkForPreorders"!==r&&"checkForLongUrl"!==r||!l&&!c||(i.originalUrl=t.toString()),o=Object.assign({},o,i),as.fromComponents(t.protocol,n,e,o,t.hash)}return t}(t=function(e){let t="string"==typeof e?new as(e):e;if(!_t(t))return t;const n=t.query,r=n.url;return(!t.host||0===t.host.length)&&null!=r&&(t=new as(r),n.dsid&&(t=t.append("query",{dsid:n.dsid}))),as.fromComponents(qi.https,t.host,t.pathname,t.query,t.hash)}(t));for(const e of this._routeMappings)for(const n of e.route)if(n.matches(t))return{normalizedUrl:t,parameters:n.extractParameters(t),object:e.object,matchedRuleIdentifier:n.identifier};return{normalizedUrl:t,parameters:null,object:null,matchedRuleIdentifier:null}}}const kc=[new Tc("header"),new Tc("askToBuyRequest"),new Tc("shelf","banner"),new Tc("topLockup"),new Tc("shelf","bundleChildren"),new Tc("shelf","bundleParents"),new Tc("shelf","mostRecentVersion"),new Tc("shelf","subscriptions"),new Tc("shelf","inAppPurchases"),new Tc("shelf","videos"),new Tc("screenshots"),new Tc("shelf","description"),new Tc("shelf","reviews"),new Tc("shelf","information"),new Tc("shelf","links"),new Tc("shelf","capabilities"),new Tc("shelf","featuredIn"),new Tc("shelf","moreByDeveloper"),new Tc("shelf","similarItems")],_c=[new Tc("header"),new Tc("askToBuyRequest"),new Tc("shelf","banner"),new Tc("topLockup"),new Tc("shelf","bundleChildren"),new Tc("shelf","bundleParents"),new Tc("screenshots"),new Tc("shelf","description"),new Tc("shelf","videos"),new Tc("shelf","reviews"),new Tc("shelf","mostRecentVersion"),new Tc("shelf","subscriptions"),new Tc("shelf","inAppPurchases"),new Tc("shelf","information"),new Tc("shelf","links"),new Tc("shelf","capabilities"),new Tc("shelf","featuredIn"),new Tc("shelf","moreByDeveloper"),new Tc("shelf","similarItems")],Pc=5;class Cc extends ii{constructor(e){super(),this.kind=e}}class Ec extends Cc{constructor(){super("hero"),this.allowsAutoPlay=!0,this.looping=!0}isValid(){const e=this.art&&this.art.isValid(),t=this.video&&this.video.isValid();return(e||t)&&super.isValid()}}class Oc extends Cc{constructor(e){super("artwork"),this.art=e}}class Rc extends Cc{constructor(e){super("appIcon"),this.icon=e}}class Dc extends Cc{constructor(e,t){super("brandedSingleApp"),this.icon=e,this.art=t}}Dc.noArtBackgroundColor="BBBBBB";class xc extends Cc{constructor(e,t){super("list"),this.lockups=e,this.marketingText=t}}class Fc extends Cc{constructor(e,t){super("multiApp"),this.lockups=e,this.additionalText=t}}Fc.multiAppBackgroundColor="F5F5F5";class Lc extends Cc{constructor(e){super("inAppPurchase"),this.lockup=e}}class Nc extends Cc{constructor(e){super("river"),this.lockups=e,this.lockupImpressionLimit=10}}class Mc extends Cc{constructor(e,t){super("grid"),this.lockups=e,this.artworkGridType=t,this.lockupImpressionLimit=3}}class Uc extends Cc{constructor(e,t){super("video"),this.allowsAutoPlay=!0,this.looping=!0,this.video=e,this.description=t}}class Vc extends oi{constructor(e){super(),this.kind=e}}class Bc extends Vc{constructor(e){super("lockup"),this.lockup=e,this.displaysIcon=!0}}class $c extends Vc{constructor(e,t,n,r){super("marketingLockup"),this.marketingText=null,this.lockup=e,this.paragraph=t,this.hideBackground=n,this.artworkBackgroundColor=r}}class qc extends Vc{constructor(e){super("lockupList"),this.lockups=e}}class jc extends Vc{constructor(e,t){super("paragraph"),this.paragraph=e,this.style=t}}class Hc extends Vc{constructor(e){super("action"),this.action=e}}class Gc extends Vc{constructor(e,t,n){super("threeLine"),this.heading=e,this.title=t,this.description=n}}class zc extends ii{constructor(){super(),this.heading=null,this.title=null,this.media=null,this.heroMedia=null,this.overlay=null,this.style=null,this.clickAction=null,this.backgroundColor=null,this.inlineDescription=null}}class Wc extends ii{constructor(e){super(),this.cards=e}}class Yc extends oi{constructor(e,t,n,r){super(),this.shelves=e,this.title=n,this.tabTitle=r,this.nextPage=null,this.onboardingCardIds=t||[]}}class Qc{constructor(e){this._count=e,this._triggers=[]}countDown(){if(0!==this._count&&(this._count--,0===this._count)){for(const e of this._triggers)e();this._triggers.splice(0)}}then(e){0===this._count?e():this._triggers.push(e)}}class Kc extends oi{constructor(e,t){super(),this.title=e,this.sections=t||[]}}class Jc extends oi{constructor(e,t){super(),this.title=e,this.footer=t,this.contents=[]}addContentItem(e){this.contents.push(e)}}class Xc extends oi{constructor(e){super(),this.type=e}}class Zc extends Xc{constructor(e,t,n){super("link"),this.title=e,this.action=t,this.displayType=n||"action"}}class el extends Xc{constructor(e,t){super("infoListItem"),this.title=e,this.value=t}}class tl extends Xc{constructor(e){super("text"),this.text=e}}class nl extends Error{}const rl="x-apple-application-instance",ol="x-apple-application-site";class il{constructor(e){this.builderClass=e}handleShelf(e,t,n,r,o){o(new Error(`${this.builderClass} does not implement handleShelf`))}handlePagination(e,t,n,r,o,i){i(new Error(`${this.builderClass} does not implement handlePagination`))}get shelfRoute(){return[{protocol:qi.internal,path:`${this.shelfPath}{data}`}]}get paginationRoute(){return[{protocol:qi.internal,path:`${this.paginationPath}`}]}shelfUrl(e){return`${qi.internal}:${this.shelfPath}${encodeURIComponent(JSON.stringify(e))}`}get shelfPath(){return`/${this.builderClass}/${ji.shelf}/`}get paginationUrl(){return`${qi.internal}:${this.paginationPath}`}get paginationPath(){return`/${this.builderClass}/${ji.lookup}/`}static createFlowAction(e,t,n){const r=new ia(t);return r.pageUrl=n.build(),r.pageData=e,r}}class sl extends il{defaultAttributes(){return[]}prepareRequest(e,t,n){e.includingAdditionalPlatforms(this.defaultPlatforms()),e.includingAttributes(this.defaultAttributes())}handlePage(e,t,n,r,o){Fo.c(`${this.builderClass}.handlePage`,()=>{let n;const i=e.build();if(!(n=st(e)?new Mi(i):this.generatePageRequest(e,t)))return void o(new Error(`Could not construct media API request for: ${e}`));const s=this.pageType();this.prepareRequest(n,e,t),n.attributingTo(i),xt(n,this.createFetchOptions(null)).then(e=>this.renderPage(e,t)).then(t=>sl.createFlowAction(t,s,e)).then(r,o)})}handleShelf(e,t,n,r,o){Fo.c(`${this.builderClass}.handleShelf`,()=>{let n;const i=e.build();(n=st(e)?new Mi(i):this.generateShelfRequest(e,t))?(this.prepareRequest(n,e,t),n.attributingTo(e.build()),xt(n).then(e=>this.renderShelf(e)).then(r,o)):o(new Error(`Could not construct media API request for: ${e}`))})}handlePagination(e,t,n,r,o,i){Fo.c(`${this.builderClass}.handlePagination`,()=>{let n;const s=e.build();(n=st(e)?new Mi(s):this.generatePaginationRequest(e,t,r))?(this.prepareRequest(n,e,t),n.attributingTo(e.build()),xt(n).then(e=>this.renderPaginatedPage(e,r)).then(o,i)):i(new Error(`Could not construct media API request for: ${e}`))})}generateShelfRequest(e,t){throw new Error(`generateShelfRequest is not supported on: ${this.builderClass}`)}generatePaginationRequest(e,t,n){throw new Error(`generatePaginationRequest is not supported on: ${this.builderClass}`)}renderShelf(e){throw new Error(`renderShelf is not supported on: ${this.builderClass}`)}renderPaginatedPage(e,t){throw new Error(`renderPaginatedPage is not supported on: ${this.builderClass}`)}createFetchOptions(e){const t={};if(p(e)){const n={};n[Bi]=e,t.headers=n}return t}}const al="https://itunes.apple.com/WebObjects/MZStore.woa/wa/genericPageTemplate?pageComponent=finance_internet_eraser_page&additionalResources=p7financebootstrap",cl="https://finance-app.itunes.apple.com/subscriptions/manage?context=deeplink",ll="https://finance-app.itunes.apple.com/preorders",ul="mediumLockup";class pl{constructor(){this.profile="lockup",this.maxPerPage=La}}class dl extends sl{defaultAttributes(){return["editorialArtwork","isAppleWatchSupported","requiredCapabilities"]}defaultPlatforms(){return M()}pageType(){return"page"}generatePaginationRequest(e,t,n){return new Mi(n.remainingContent)}renderPaginatedPage(e,t){const n=t;return this.pageWithContent(e,n)}pageWithContent(e,t){return Fo.c("pageWithContent",()=>{const n=new ta(t.preferredShelfContentType||ul),r={id:null,kind:null,targetType:"swoosh",title:t.title,pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,idType:"its_contentId",recoMetricsData:qe(e)};mt(n,r),me(r,t.title),n.isHorizontal=!1,n.shouldFilterApps=t.shouldFilter;const o=Be(e);t.remainingContent=[],n.items=Rr(o,{contentUnavailable:(e,n)=>(t.remainingContent=He(o,n),!1),lockupOptions:{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride}});const i=new ka([n]);return t.remainingContent.length&&(i.nextPage=t),i})}}class fl extends dl{constructor(){super("RoomBuilder")}generatePageRequest(e,t){let n=e.query[Zi.featuredContentId];if(this.isValidRoomId(n)||(n=t.id),!this.isValidRoomId(n))throw new Error(`Unable to map ${e.build()} to a media api url`);return(new Mi).forType("rooms").withIds([n])}renderPage(e,t){return Fo.c("renderPage",()=>{const t=Ve(e),n=X(t,"contents"),r=At("Room",t.id,e),o=new pl;o.remainingContent=n.data,o.url=this.paginationUrl,o.shouldFilter=!G(t,"doNotFilter"),o.metricsPageInformation=r,o.metricsLocationTracker={rootPosition:0,locationStack:[]};const i=j(t,"editorialElementKind");o.preferredShelfContentType=this.preferredShelfStyleForFcKind(Number(i)),o.clientIdentifierOverride=Vt(t),o.title=j(t,"title");const s=this.pageWithContent(n,o);return s.title=o.title,It(s,r),s})}get pageRoute(){return[{protocol:qi.https,path:`/${ji.store}/${ji.room}`,query:[Zi.featuredContentId]},{protocol:qi.https,path:`/${ji.storeElements}/${ji.recommendationsSeeAll}`},{protocol:qi.https,path:"{apiVersion}/editorial/{countryCode}/rooms/{id}"},{protocol:qi.https,path:"/{countryCode}/collection/today-view-widgets",query:[Zi.featuredContentId]}]}isValidRoomId(e){return!(c(e)||isNaN(e))}preferredShelfStyleForFcKind(e){if(null==e)return null;switch(e){case zo.AppStore_iAPShelf:return"inAppPurchaseTiledLockup";default:return null}}static seeAllPage(e,t){const n=new ta(t||ul);n.isHorizontal=!1,n.items="parentShelfItems";const r=new ka([n]);return r.isIncomplete=!0,r.title=e,r}}class hl extends dl{requestWithFilter(e,t){return(new Mi).forType("apps").withFilter(e,t)}renderPage(e,t){return Fo.c("renderPage",()=>{const t=new pl;return t.url=this.paginationUrl,t.shouldFilter=!1,t.metricsLocationTracker={rootPosition:0,locationStack:[]},this.pageWithContent(e,t)})}}class ml extends dl{handlePage(e,t,n,r,o){r(this.action())}generatePageRequest(e,t){throw new Error(`generatePageRequest is not supported on: ${this.builderClass}`)}renderPage(e,t){throw new Error(`renderPage is not supported on: ${this.builderClass}`)}}class gl{}class yl{}Bo={product:[{protocol:qi.internal,path:`/${ji.product}/${ji.lookup}`,query:[Zi.ids]}],reviews:[{protocol:qi.internal,path:`/${ji.reviews}/${ji.shelf}/{adamId}/{sort}`}],topCharts:[{protocol:qi.internal,path:`/${ji.topCharts}/{genre}/{pop}`}],grouping:[{protocol:qi.internal,path:`/${ji.grouping}/${ji.shelf}/{shelfToken}`}]};class wl extends oi{constructor(e,t,n,r){super(),this.card=e,this.shelves=t,this.footerLockup=n,this.shareAction=r,this.isIncomplete=!1}}const Tl="undefined"!=typeof ask?ask.user:{firstName:"Jonny",lastName:"Appleseed",accountIdentifier:"appleseed@apple.com",dsid:"123456",isManagedAppleID:!1};class Sl{constructor(){this.index=0,this.todayShelfRecoMetricsData={}}}const Al=["AppLockup","InlineImage","InlineVideo"];class vl{constructor(e,t,n,r){this.name=e,this.url=t,this.artwork=n,this.roomUber=r}}class Il extends oi{constructor(e,t){super(),this.apps=e,this.appsToAlwaysShow=t}}class bl extends oi{constructor(e,t,n,r){super(),this.shortName=e,this.longName=t,this.chart=n,this.shelves=r,this.nextPage=null}}class kl extends Ui{constructor(e,t,n){super(e.name,e.genreId,e.artwork,e.ageBandId,n),this.shortName=this.name,this.longName=this.name,this.url=t}}class _l extends oi{constructor(e,t,n,r,o,i){super(),this.genreId=e,this.ageBandId=t,this.title=n,this.segments=r,this.categoriesButtonTitle=o,this.categories=i,this.initialSegmentIndex=0}}!function(e){e.TopPaid="top-paid",e.TopFree="top-free"}($o||($o={}));const Pl="undefined"!=typeof ask&&void 0!==ask.clientOrdering?ask.clientOrdering:{orderedVisibleIAPs(e,t,n,r,o){const i=[];-1!==t.findIndex(function(e,t,n){return e===r})&&i.push(r);for(const e of n)e!==r&&i.push(e);o(i,null)},visibilityForIAPs(e,t){t({},null)}};class Cl{constructor(e,t){e&&(this.appStoreClientRequestId=t,this.targetingData=e.dataBlob,this.iAdId=e.iAdId,this.iAdRoutingInfo=e.iAdRoutingInfo,this.canary=e.canary)}validAdRequest(){const e=this.targetingData&&this.targetingData.length>0,t=this.iAdRoutingInfo&&this.iAdRoutingInfo.length>0;return e&&t}}const El="data.search.dataSetId",Ol={showPlaybackControls:!1,canPlayFullScreen:!1},Rl=30;qo={search(e,t,n){c(h(t,Zi.path))?n.reject(new Error(`Unhandled search url: ${e}`)):net.fetch({url:e.build(),method:"GET"}).then(t=>{u(t.url)?ln(t.url).then(n.resolve,n.reject):n.reject(new Error(`Unhandled search url: ${e}`))})},topCharts(e,t,n){xt(new Mi(e.build())).then(e=>Jt(e)).then(t=>il.createFlowAction(t,"topCharts",e)).then(n.resolve,n.reject)},product(e,t,n){const r=t[Zi.bundleIdentifier],o=t[Zi.ids];let i=null;var s,a;r?(a=r,i=(new Mi).forType("apps").withFilter("bundleId",a).includingAdditionalPlatforms(M()).includingRelationships(["customers-also-bought-apps","developer-other-apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items"]).includingAttributes(Ba).addingRelationshipLimit("reviews",U())):"lookup"===t[Zi.action]&&o?(s=o,i=(new Mi).forType("contents").addingQuery("ids",s).includingAdditionalPlatforms(M()).includingRelationships(["customers-also-bought-apps","developer-other-apps","apps","reviews","app-bundles","merchandised-in-apps","top-in-apps","related-editorial-items"]).includingAttributes(["screenshotsByType","videoPreviewsByType","minimumOSVersion"]).addingRelationshipLimit("reviews",U())):i=pt(e),c(i)?n.reject(new Error("pageHandler.product: Unable to create MAPI request")):function(n,r){const o={clientIdentifierOverride:e.query[Zi.clientIdentifierOverride]},i=t[Zi.offerName];if(i){const e="true"===t[ts.isSubscription];o.spotlightSection=Et(e),o.spotlightInAppProductIdentifier=i}const s=e.query[rc];s&&(e.removeParam(rc),o.iAdClickFields=JSON.parse(s));const a=e.query[oc];a&&(o.iAdLineItem=a,e.removeParam(oc));const c=e.query[yc];u(c)&&(o.externalDeepLinkUrl=c,e.removeParam(yc)),xt(n).then(e=>{const n=e[tc];return Fo.c(`fetchProductForUrl: ${n}`,()=>{const r=e.data.length?e.data[0]:null,i=p(r)&&"app-bundles"===r.type,s=pr(e,o),a=il.createFlowAction(s,"product",new as(n)),c=1===a.pageData.appPlatforms.length&&"tv"===a.pageData.appPlatforms[0];if(t[Zi.action]!==Ql||c){if(t[Zi.action]!==Kl||c)return a;{const e=s.shelfMapping.reviews;let t=null;return e&&e.seeAllAction&&((t=e.seeAllAction).animationBehavior="never"),a.animationBehavior="never",new ca([a,t])}}{const e=Je(s.adamId,i,s.icon);return a.animationBehavior="never",new ca([a,e])}})}).then(r.resolve,r.reject)}(i,n)},sortedReviews(e,t,n){const r=t.adamId,o=t.sort;xt((new Mi).forType("user-reviews").withIds([r]).includingAdditionalPlatforms(M()).addingQuery("sort",o),{}).then(e=>rt(_i,r,[],e,!0,o)).then(t=>il.createFlowAction(t,"reviews",e)).then(n.resolve,n.reject)},reviews(e,t,n){xt(pt(e)).then(t=>{const n=pr(t),r=il.createFlowAction(n,"product",e);let o=null;const i=n.shelfMapping.reviews,s=1===n.appPlatforms.length&&"tv"===n.appPlatforms[0];return i&&i.seeAllAction&&!s&&((o=i.seeAllAction).animationBehavior="never"),o?(r.animationBehavior="never",new ca([r,o])):r}).then(n.resolve,n.reject)},productInAppPurchase(e,t,n){const r=t[ts.url],o=pt(new as(r)),i={},s="true"===t[ts.isSubscription];i.spotlightSection=Et(s),i.spotlightInAppProductIdentifier=t[Zi.offerName],xt(o).then(t=>{const n=pr(t,i);return il.createFlowAction(n,"product",e)}).then(n.resolve,n.reject)},inAppPurchaseInstall(e,t,n){const r=t[Zi.id],o=t[es.inAppPurchaseId];xt((new Mi).forType("in-apps").withIds([o]),{}).then(e=>{const t=function(e,t){const n={pageId:ce(o),pageType:"IAPInstallPage",parentId:ce(e)};return new sc(n)}(r),n=Ve(e);let i;const s={metricsOptions:{pageInformation:t,locationTracker:{rootPosition:0,locationStack:[]}}};o&&n&&((i=_r(n,s)).theme="dark");const a=Z(n,"app");let c;r&&a&&(c=kr(a,s));const l=new _a;l.isComplete=!0,l.lockup=i,l.parentLockup=c;const u=Vr(n);return l.preInstallOfferDescription=Xr(u),function(e,t){It(l,t)}(0,t),l}).then(t=>il.createFlowAction(t,"inAppPurchaseInstall",e)).then(n.resolve,n.reject)},developer(e,t,n){xt(function(e){const t=ut(e);if(!lt(t))throw new Error(`Unable to map ${e.build()} to a media api url`);return(new Mi).forType("developers").withIds([t]).includingAdditionalPlatforms(M()).includingRelationships(ft()).includingAttributes(dt()).attributingTo(e.build())}(e)).then(e=>Bt(e)).then(t=>il.createFlowAction(t,"page",e)).then(n.resolve,n.reject)},developerHref(e,t,n){xt(function(e){return new Mi(e).includingAdditionalPlatforms(M()).includingAttributes(dt()).includingRelationships(ft())}(t[Zi.href])).then(e=>Bt(e)).then(t=>il.createFlowAction(t,"page",e)).then(n.resolve,n.reject)},grouping(e,t,n){var r;r=n,xt(function(e){if(st(e))return new Mi(e.build());let t,n,r=e.query.id;if(e.host===Xi&&p(Lo.safariExtensionsGroupingURL)){const e=as.from(Lo.safariExtensionsGroupingURL);u(e)&&(r=ut(e))}const o=e.pathComponents();if(-1!==o.indexOf("viewGenre")?t=r:-1!==o.indexOf("genre")?t=ut(e):n=r,!lt(n)&&!lt(t))throw new Error(`Unable to map ${e.build()} to a media api url`);let i=(new Mi).forType("groupings").includingAttributes(["editorialArtwork","isAppleWatchSupported","requiredCapabilities","minimumOSVersion"]);const s=at();u(s)&&i.addingQuery("contexts",s),lt(n)?i=i.withIds([n]):lt(t)&&(i=i.addingQuery("genre",t));const a=e.query[Zi.useReleaseId];return e.host===Ki&&p(a)&&(i.isStorePreviewRequest=!0,i=i.addingQuery("release",a)),i.attributingTo(e.build())}(e)).then(t=>{const n=function(e){return Fo.c("groupingPageFromResponse",()=>{const t=Ve(e);if(!t)return null;if(!J(t,"tabs"))return null;const n=new Ml;n.hasAuthenticatedUser=u(Tl.dsid),n.pageGenreId=z(t,"genre")||function(e){return c(e)?null:m(as.from(e).query,"genre")}(j(t,"chartUrl")),n.metricsPageInformation=At("Genre",t.id,e),n.groupingData=X(t,"tabs"),n.pageGenreAdamId=j(t,"id"),dn(Ve(n.groupingData),n);const r=In();r&&n.shelves.push(r);const o=Lo.termsAndConditionsURL;if(!c(o)){const e=vn(o);n.shelves.push(e)}const i=function(e,t){let r=null;switch(n.pageGenreId){case No.Apps:r=host.clientIdentifier===Ti?"mac"===Ii?function(e){const t=X(e,"tabs");if(u(t)&&u(t.data))for(const e of t.data){const t=j(e,"name"),n=z(e,"editorialElementKind"),r=j(e,"token");if(p(t)&&u(n)&&p(r)&&"macOS"===r&&n===zo.AppStore_TabRoot)return t}return _("GROUPING_DISCOVER")}(e):_("GROUPING_APPS"):_("GROUPING_APP_STORE","App Store");break;case No.Discover:r=_("GROUPING_DISCOVER");break;default:r=Nr(e)}return r}(t),s=new ka(n.shelves);return n.pageGenreId===No.Discover||n.pageGenreId===No.Apps&&"mac"===Ii?s.presentationOptions=["prefersRevealNavigationBarOnMouseOver"]:s.presentationOptions=["prefersLargeTitleWhenRoot"],s.title=i,It(s,n.metricsPageInformation),s})}(t);return il.createFlowAction(n,"page",e)}).then(r.resolve,r.reject)},article(e,t,n){const r=JSON.parse(h(e.query,Zi.recoMetrics));xt(function(e){const t=e.pathComponents();if(t.indexOf("story")<0&&t.indexOf("editorialItem")<0&&t.indexOf("viewEditorialItem")<0)throw new Error(`Unable to map ${e.build()} to a media api url`);const n=ut(e);if(!lt(n))throw new Error(`Unable to map ${e.build()} to a media api url`);if(c(n)||isNaN(n))throw new Error(`Unable to map ${e} to a media api url`);return(new Mi).forType("editorial-items").withIds([n]).includingAdditionalPlatforms(M()).includingAttributes(["screenshotsByType","videoPreviewsByType","requiredCapabilities","minimumOSVersion"]).includingRelationships(["canvas"]).attributingTo(e.build())}(e)).then(e=>{const n=new Sl;return n.todayShelfRecoMetricsData=r,n.showingFallbackMediaInline=Boolean(t[Zi.showingFallbackMedia]),function(e,t){return Fo.c("articlePageWithResponse",()=>{const n=Ve(e);t.metricsPageInformation=At("editorialItem",n.id,e),t.metricsLocationTracker={rootPosition:0,locationStack:[]},t.pageId=n.id;const r={pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},o=function(e){if(!u(e))return null;const t={useThreeLineOverlayForBranded:!1,enableFullScreenVideo:!0,enableListCardToMultiAppFallback:!1};return t.clientIdentifierOverride=e.clientIdentifierOverride,"mac"===Ii&&(t.prevailingCropCode="en",t.coercedGeneralCardSubType="Grid",t.heroDisplayContext="article"),t}(t),i=Qn(n,o,r);t.clientIdentifierOverride=o.clientIdentifierOverride,me({pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker,targetType:"article",id:t.pageId,idType:"its_id"},i.title);const s=function(e,t,n){return Fo.c("renderArticle",()=>{const r=[];let o=!1;for(const t of e){n.module=j(t,"displayType"),n.subStyle=null;let e=!0;"mac"===Ii&&"StoryList"===n.module&&(o&&(e=!1),o=!0);const i=e?jt(t,n):null;i&&(i.title=n.titleForNextShelf,r.push(i),n.titleForNextShelf=null),n.index++,we(n.metricsLocationTracker)}if(n.showingFallbackMediaInline&&0===r.length){const e=function(e){if(e.media instanceof xc){const t=e.media,n=new ta("smallLockup");return n.items=t.lockups,n}return null}(t);u(e)&&r.push(e)}return r})}(ee(n,"canvas"),i,t),a=s[s.length-1],l=function(e,t,n){if("pad"!==Ii&&"phone"!==Ii||"debug"!==Oi&&"internal"!==Oi)return null;{const o=new gi("Apple Internal: To help improve our personalized recommendations, please provide your feedback on this story. (Feedback will include your account details)");function r(t){const r=qe(e)||{},o=Object.assign({},r,n,{id:e.id,topic:Wa,feedback:t,feedbackId:`id_${t.toLowerCase().split(" ").join("_")}`,dsId:Tl.dsid}),i=new ls("generic",o,null);return new Ia(i)}o.hasDivider=!t;const i=["I like this","Seen too many times","Not relevant at this time of year","Not appropriate where I live","I don’t like it"];for(const e of i)o.options.push(new yi(e,`id_${e.toLowerCase().split(" ").join("_")}`,r(e)));const s=new ta("personalizationFeedbackContainer");return s.items=[o],s}}(n,c(a),t.todayShelfRecoMetricsData);u(l)&&s.unshift(l);const p=function(e,t){if(e&&t){const n=e.items.length;if(n>0&&-1!==Al.indexOf(t)){const t=e.items[n-1];switch(e.contentType){case"framedArtwork":{const e=t;return e&&e.isFullWidth}case"framedVideo":{const e=t;return e&&e.isFullWidth}default:return!0}}}return!1}(a,t.module),d=function(e){const t=Ht(e);let n=null;const r=bo(e,"name"),o=bo(e,"short");if(r&&o&&(n=_("SHARE_SHEET_TITLE_SUBTITLE_FORMAT","{title}: {subtitle}").replace("{title}",r).replace("{subtitle}",o)),!n&&r&&(n=r),!n&&o&&(n=o),!n&&t){const r=j(t,"name"),o=j(e,"displaySubStyle");switch(o){case"GameOfDay":n=_("SHARE_SHEET_GAME_OF_DAY_TITLE_FORMAT").replace("{title}",r);break;case"AppOfDay":n=_("SHARE_SHEET_APP_OF_DAY_TITLE_FORMAT").replace("{title}",r);break;default:console.log(`No title for article with unknown substyle: ${o}`)}}const i=function(e,t,n,r){return Rt("article",!0,host.clientIdentifier,e,t,null,r)}(n,j(e,"url"),0,t);return u(i)?new Sa(i):null}(n),f=function(e,t,n){if(!u(e))return null;Le(e,{targetType:"button",id:t.pageId,actionType:"share",pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker});const r=new Xs("share",_("SHARE_STORY"),!n,e),o=new ta("roundedButton");return o.items=[r],o}(d,t,p);f&&s.push(f);const m=Ht(n);let g=null;if(m){const e=Tt(n);g=function(e,t,n){return kr(m,{offerStyle:Gt(),metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker},clientIdentifierOverride:t.clientIdentifierOverride,externalDeepLinkUrl:n})}(0,t,e)}const y=new wl(i,s,g,d);return It(y,t.metricsPageInformation,e=>{let t=i.title;if(i.media instanceof Dc&&i.overlay instanceof Bc&&(t=i.overlay.lockup.title),!t)return;g&&"mac"===Ii&&(e[Qa]=g.impressionFields);let n=h(e,"pageDetails","coercible");n=n||h(e,"pageId"),e.pageDetails=n?`${n}_${t}`:`unknown_${t}`}),y})}(e,n)}).then(t=>il.createFlowAction(t,"article",e)).then(n.resolve,n.reject)},resetAndRedirect(e,t,n){const r={url:e.toString(),signingStyle:"platform"};net.fetch(r).then(n.resolve,n.reject)},msoRoom(e,t,n){const r=function(e){const t=e[ns];return t?t.split(","):[]}(t);xt(function(e){return Yt(ut(e))}(e.removeParam(ns))).then(e=>Qt(e,r)).then(t=>il.createFlowAction(t,"mso",e)).then(n.resolve,n.reject)},actionHandler(e,t,n){(function(e,t){const n=e.query.action;switch(n){case"account":const t=new ia("finance");t.presentationContext="presentModalFormSheet",t.animationBehavior="always";const r=e.query.originalUrl;return r?t.pageUrl=r:e.query.continuation?t.pageUrl=as.fromComponents(null,n,null,{continuation:e.query.continuation}).toString():t.pageUrl=n,Promise.resolve(t);case"signup":const o=new ia("finance");return o.presentationContext="presentModalFormSheet",o.animationBehavior="always",o.pageUrl=function(){let e=Lo.createAccountUrl;return(c(e)||"string"!=typeof e)&&(e="https://buy.itunes.apple.com/WebObjects/MZFinance.woa/wa/signupWizard"),new as(e)}().build(),Promise.resolve(o);case"purchased":let i,s=[];if(k())i="account";else{i="updates";const e=new ia("account");e.presentationContext="presentModalFormSheet",e.animationBehavior="never";const t=new ia("purchases");t.animationBehavior="never",s=[e,t]}const a=new sa(i);return a.actions=s,Promise.resolve(a);case"checkForPreorders":const u=e.query.originalUrl;if(u.length>0){const e={url:u,signingStyle:"platform"};return net.fetch(e),Promise.resolve(new Ia)}return Promise.reject(new Error("Original url is missing when creating action for checkForPreorders."));case"redeem":const p=new ia("finance");return p.presentationContext="presentModalFormSheet",p.animationBehavior="always",e.query.code&&e.query.code.length>0?p.pageUrl=`${n}/${e.query.code}`:p.pageUrl=n,Promise.resolve(p);case"gift":const d=new ia("finance");return d.presentationContext="presentModalFormSheet",d.animationBehavior="always",d.pageUrl=n,Promise.resolve(d);case"donate":const f=new ia("finance");return f.presentationContext="presentModalFormSheet",f.animationBehavior="always",f.pageUrl="charity",Promise.resolve(f);case"search":let h=e.query.term;if(h||(h=e.query.q),h&&h.length>0){if(l(h=h.replace(/\+/g," ").trim()))return Promise.reject(new Error("Empty search term."));const e=ot(en(h,{})).toString(),t=new hc(h,e,"externalUrl"),n=new ia("search");return n.pageData=t,Promise.resolve(n)}{const e=new sa("search");return Promise.resolve(e)}}return Promise.reject(new Error(`FlowAction was not able to be created for this action URL: ${e}`))})(e).then(n.resolve,n.reject)},personalizationTransparency(e,t,n){w(t[Zi.enabled])?xt((new Mi).forType("personalization-data")).then(e=>Ut(e),()=>Ut()).then(t=>il.createFlowAction(t,"account",e)).then(n.resolve,n.reject):n.resolve(il.createFlowAction(function(){const e=[],t=new Jc,n=new Bs(_("PERSONALIZATION_DESCRIPTION_OPTED_OUT"));t.addContentItem(new tl(n)),e.push(t);const r=new Jc;return r.addContentItem(new Zc(_("ACCOUNT_SETTINGS"),Mt("finance","account",!1),"navigation")),e.push(r),new Kc(_("RECOMMENDATIONS"),e)}(),"account",e))}},jo={reviews(e,t,n){const r=n.pageToken,o=t.adamId,i=t.sort,s=d(r.remainingContent);xt(new Mi(r.nextHref).includingAdditionalPlatforms(M()).addingQuery("sort",i),{}).then(e=>rt(_i,o,s,e,!1,i)).then(n.resolve,n.reject)}},Ho={product(e,t,n){const r=t.token,o=JSON.parse(r);let i;if(o.isBundleShelf)i="app-bundles";else switch(o.contentType){case"smallStoryCard":case"todayBrick":i="editorial-items";break;case"inAppPurchaseLockup":i="in-apps";break;default:i="apps"}xt((new Mi).forType(i).withIds(o.ids).includingAdditionalPlatforms(M()).includingAttributes(["editorialArtwork","minimumOSVersion"])).then(e=>{const t=function(e,t){return Fo.c("shelfFromLookupResponse",()=>{const n=new ta(t.contentType),r={pageInformation:t.sourcePageInformation,locationTracker:t.sourceLocationTracker,excludeAttribution:!0};let o;switch(t.contentType){case"todayBrick":const n=Yn(e.data,r.pageInformation,r.locationTracker,gr);u(n)&&(o=[n]);break;case"smallStoryCard":const i={metricsLocationTracker:r.locationTracker,metricsPageInformation:r.pageInformation};o=Gn(e.data,t.contentType,i);break;default:const s={metricsOptions:r,offerStyle:t.offerStyle};"inAppPurchaseLockup"===t.contentType&&(s.skipDefaultClickAction=!0);const a={lockupOptions:s};t.isBundleShelf&&(a.filter=Wo.None);const c=Or(e,a),l={[Si]:"round",[Ai]:"pill"}[host.clientIdentifier];l&&c.sort((e,t)=>{const n=e.icon.style===l,r=t.icon.style===l;return n&&r?0:n&&!r?-1:1});const p=t.spotlightInAppProductIdentifier;p&&fr(p,c),o=c}return n.items=o,n})}(e,o);if(t.mergeWhenFetched=!0,o.shouldInferSeeAllFromFetchesItems){const e=new ia("page");e.title=_("ACTION_SEE_ALL");const n=new ta(t.contentType);n.items=function(e,t){if(!e)return null;const n=[];for(const t of e){const e=be(t);e.offerDisplayProperties&&(e.offerDisplayProperties=e.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"infer")),n.push(e)}return n}(t.items);const r=new ka([n]);It(r,o.destinationPageInformation),r.title=o.title,e.pageData=r,Ne(e,null,{pageInformation:o.sourcePageInformation,locationTracker:o.sourceLocationTracker}),t.seeAllAction=e}const n=t.items;if("inAppPurchaseLockup"===o.contentType&&n){const e=[],r=[];for(const t of n){const n=t.productIdentifier;Et(t.isSubscription).shelfId===o.inAppShelfId&&(e.push(n),t.isVisibleByDefault&&r.push(n))}return function(e,t,n,r){return new Promise((o,i)=>{if(!e||!t||!n)return void i(new Error("Client ordering API invoked with malformed parameters."));const s=t.filter(e=>null!=e),a=n.filter(e=>null!=e);Pl.orderedVisibleIAPs(e,s,a,r,(e,t)=>{t?i(t):o(e)})})}(o.appBundleId,e,r,o.spotlightInAppProductIdentifier).then(e=>(t.items=function(e,t){const n={};for(const t of e)n[t.productIdentifier]=t;const r=[];for(const e of t){const t=n[e];if(t){const e=be(t);r.push(e)}}return r}(n,e),t))}return"todayBrick"===t.contentType&&0===t.items.length&&(t.isHidden=!0),t}).then(n.resolve,n.reject)},developer(e,t,n){const r=t.token,o=JSON.parse(r);xt(new Mi(o.remainingData).includingAdditionalPlatforms(M())).then(e=>(function(e,t){const n=qt(e.data,t.contentType,t.lockupListOptions);return n.mergeWhenFetched=!0,n})(e,o)).then(n.resolve,n.reject)},grouping(e,t,n){const r=t.token,o=JSON.parse(r),i=p(o.remainingItems),s=p(o.recommendationsHref);if(i){let e=o.remainingItems;const t=p(o.relationshipDataToFetch);t&&(e=o.remainingItems.map(e=>Z(e,o.relationshipDataToFetch)));let r=new Mi(e).includingAdditionalPlatforms(M()),i=["editorialArtwork","minimumOSVersion"];return"apps"===r.resourceType&&(i=["editorialArtwork","minimumOSVersion","screenshotsByType","videoPreviewsByType"]),void xt(r=r.includingAttributes(i)).then(e=>{let n=e;if(t){const t={};for(const n of e.data)t[n.id]=n;n={data:[]};for(const e of o.remainingItems){const r=Z(e,o.relationshipDataToFetch);p(r)&&(e.relationships[o.relationshipDataToFetch].data=[t[r.id]]),n.data.push(e)}}return un(n,o)}).then(n.resolve,n.reject)}if(s){let e=new Mi(o.recommendationsHref).includingAdditionalPlatforms(M()),t=["editorialArtwork","minimumOSVersion"];return"apps"===e.resourceType&&(t=["editorialArtwork","minimumOSVersion","screenshotsByType","videoPreviewsByType"]),void xt(e=e.includingAttributes(t)).then(e=>{const t=Ve(e);return l(o.title)&&(o.title=j(t,"name")),un(X(t,"contents"),o)}).then(n.resolve,n.reject)}n.reject(new Error("shelf-handler: grouping: Was unable to infer how to update shelf from token."))},today(e,t,n){const r=t.token,o=JSON.parse(r);c(o.todayModule)?n.reject():xt(new Mi(o.todayModule.contents).includingAdditionalPlatforms(M()).includingAttributes(["editorialArtwork","minimumOSVersion"])).then(e=>(function(e,t){if(c(e.todayModule))return null;const n=e.todayModule;n.contents=Be(t);const r=new jl;r.locationTracker=e.metricsLocationTracker,r.pageInformation=e.metricsPageInformation;const o=qn(n,{contentOffsetWithinModule:e.contentOffsetWithinModule,hideTitle:!0,setTitleToDateForTodaySection:!1},r);return o.mergeWhenFetched=!0,o})(o,e)).then(n.resolve,n.reject)},personalizedReviews(e,t,n){const r=t.token,o=JSON.parse(r);xt((new Mi).forType("reviews").withIds([o.adamId])).then(e=>et(_i,o,e)).catch(()=>et(_i,o)).then(n.resolve,n.reject)},mso(e,t,n){const r=t.token,o=JSON.parse(r);xt(new Mi(o.remainingContent).includingAdditionalPlatforms(M()).includingAttributes(["editorialArtwork","minimumOSVersion"])).then(e=>(function(e,t){const n=Be(e),r=t;r.remainingContent=[];const o={lockupOptions:{metricsOptions:{pageInformation:t.metricsPageInformation,locationTracker:t.metricsLocationTracker}},contentUnavailable:function(e,t){return r.remainingContent=He(r.remainingContent,t),r.remainingContent.push(n[t]),!1}},i=new ta(t.preferredShelfContentType);return i.shouldFilterApps=t.shouldFilter,i.items=Rr(n,o),i.mergeWhenFetched=!0,i.url=Kt(r),i})(e,o)).then(n.resolve,n.reject)}},Go={product:[{protocol:qi.internal,path:`/${ji.product}/${ji.shelf}/{token}`}],grouping:[{protocol:qi.internal,path:`/${ji.grouping}/${ji.shelf}/{token}`}],today:[{protocol:qi.internal,path:`/${ji.today}/${ji.shelf}/{token}`}],topCharts:[{protocol:qi.internal,path:`/${ji.topCharts}/{genre}/${ji.shelf}/{pop}`}],developer:[{protocol:qi.internal,path:`/${ji.developer}/${ji.shelf}/{token}`}],personalizedReviews:[{protocol:qi.internal,path:`/${ji.personalizedReviews}/${ji.shelf}/{token}`}],mso:[{protocol:qi.internal,path:`/${ji.mso}/${ji.shelf}/{token}`}]};class Dl extends il{constructor(e,t,n=[],r=null,o=[],i=null,s=[],a=null){super(e),this._pageType=t,this._pageRoute=n,this._pageHandler=r,this._shelfRoute=o,this._shelfHandler=i,this._paginationRoute=s,this._paginationHandler=a}pageType(){return this._pageType}handlePage(e,t,n,r,o){this._pageHandler||o(new Error(`${this.builderClass} does not implement handlePage`)),this._pageHandler(e,t,{resolve:r,reject:o})}handleShelf(e,t,n,r,o){this._shelfHandler||o(new Error(`${this.builderClass} does not implement handleShelf`)),this._shelfHandler(e,t,{resolve:r,reject:o})}handlePagination(e,t,n,r,o,i){this._paginationHandler||i(new Error(`${this.builderClass} does not implement handlePagination`)),this._paginationHandler(e,t,{resolve:o,reject:i,pageToken:r})}get pageRoute(){return this._pageRoute}get shelfRoute(){return this._shelfRoute}get paginationRoute(){return this._paginationRoute}}const xl=new Set,Fl=new bc,Ll=new bc,Nl=new bc;an(new class extends ml{constructor(){super("StoreFrontRoomBuilder")}get pageRoute(){return[{protocol:qi.https,path:`${ji.store}/${ji.storeFront}`}]}action(){return new sa("discover")}}),an(new class extends sl{constructor(){super("EulaBuilder")}defaultPlatforms(){return M()}generatePageRequest(e,t){const n=e.query.resourceId,r=e.query.resourceType;if(c(n)||c(r))throw new Error(`Unable to map ${e.build()} to a media api url`);const o=(new Mi).forType("eula").withIds([n]);return o.targetResourceType=r,o}get pageRoute(){return[{protocol:qi.internal,path:`${ji.eula}`}]}pageType(){return"page"}renderPage(e,t){return Fo.c("renderPage",()=>{const t=h(e,"results.eula.text").split("\n\n"),n=[];for(const e of t){const t=new Bs(e);t.wantsCollapsedNewlines=!1,n.push(t)}const r=new ta("paragraph");r.isHorizontal=!1,r.items=n;const o=new ka([r]);return o.title=_("LICENSE_AGREEMENT"),o})}}),an(new fl),an(new class extends dl{constructor(){super("RecommendationRoomBuilder")}generatePageRequest(e,t){const n=ut(e),r=t[Zi.grouping];if(!this.isValidId(n))throw new Error(`Unable to map ${e.build()} to a media api url. Missing id.`);if(!this.isValidId(r))throw new Error(`Unable to map ${e.build()} to a media api url. Missing grouping.`);return(new Mi).forType("editorial-elements").withIds([n]).addingQuery("grouping",r)}renderPage(e,t){return Fo.c("renderPage",()=>{const n=Ve(e),r=X(n,"contents"),o=t[Zi.grouping],i=At("Room",`${n.id}-${o}`,e),s=new pl;s.remainingContent=r.data,s.url=this.paginationUrl,s.shouldFilter=!G(n,"doNotFilter"),s.metricsPageInformation=i,s.metricsLocationTracker={rootPosition:0,locationStack:[]},s.title=j(n,"name");const a=this.pageWithContent(r,s);return a.title=s.title,It(a,i),a})}get pageRoute(){return[{protocol:qi.https,path:`/{countryCode}/${ji.appsForYou}/{title}/{id}`,query:[Zi.grouping]},{protocol:qi.https,path:`/{countryCode}/${ji.appsForYou}/{id}`,query:[Zi.grouping]},{protocol:qi.https,path:`/${ji.appsForYou}/{title}/{id}`,query:[Zi.grouping]},{protocol:qi.https,path:`/${ji.appsForYou}/{id}`,query:[Zi.grouping]}]}isValidId(e){return!(c(e)||isNaN(e))}}),an(new class extends hl{constructor(){super("DocTypeRoomBuilder")}generatePageRequest(e,t){const n=e.query.uti;return this.requestWithFilter("uti",n)}get pageRoute(){return[{protocol:qi.https,path:`/${ji.store}/${ji.docTypeLookup}`}]}}),an(new class extends ml{constructor(){super("AppDownloadFileHandlerRoomBuilder")}get pageRoute(){return[{protocol:qi.file,pathExtension:"appdownload"}]}action(){return new sa("account")}}),an(new class extends hl{constructor(){super("GenericFileHandlerRoomBuilder")}generatePageRequest(e,t){const n=e.pathExtension();return null==n?null:this.requestWithFilter("extension",n)}get pageRoute(){return[{protocol:qi.file}]}}),an(new class extends hl{constructor(){super("SearchExtensionRoomBuilder")}generatePageRequest(e,t){const n=t[Zi.type];return this.requestWithFilter("appex",n)}get pageRoute(){return[{hostName:`${Yi}`,query:[Zi.type]}]}}),an(new class extends dl{constructor(){super("DeveloperRoomBuilder")}get pageRoute(){return[{protocol:qi.internal,path:`/${ji.developer}/${ji.room}/{token}`}]}get paginationRoute(){return[{protocol:qi.internal,path:`${this.paginationPath}`,query:[`${Zi.href}`]}]}generatePageRequest(e,t){const n=t.token,r=JSON.parse(n);if(c(r))throw new Error(`Unable to map ${e.build()} to a media api url`);return new Mi(r.href)}renderPage(e,t){return Fo.c("renderPage",()=>{const n=t.token,r=JSON.parse(n),o=At("Room",`${r.developerId}_${r.relationshipId}`,e),i=new pl;i.title=r.title,i.metricsPageInformation=o,i.metricsLocationTracker={rootPosition:0,locationStack:[]};const s=this.pageWithContent(e,i);return s.title=i.title,this.configurePaginationForPage(s,i,e.next),It(s,o),s})}generatePaginationRequest(e,t,n){const r=t[Zi.href];return new Mi(r)}renderPaginatedPage(e,t){const n=t,r=this.pageWithContent(e,n);return this.configurePaginationForPage(r,n,e.next),r}configurePaginationForPage(e,t,n){p(n)?(t.url=`${this.paginationUrl}?${Zi.href}=${encodeURIComponent(n)}`,e.nextPage=t):e.nextPage=null}}),an(new class extends hl{constructor(){super("SchemeTypeRoomBuilder")}generatePageRequest(e,t){return this.requestWithFilter("scheme",e.protocol)}get pageRoute(){const e={exclusions:[]};for(const t of Object.keys(qi)){const n=qi[t];if("string"==typeof n){const t={protocol:n};e.exclusions.push(t)}}return[e]}}),an(new class extends il{constructor(){super("TodayCardPreviewBuilder")}pageType(){return"today"}handlePage(e,t,n,r,o){Fo.c(`${this.builderClass}.pageHandler`,()=>{const n=e.build();if(w(t[Zi.fetchData])){const i=this.generatePageRequest(e,t);if(!i)return void o(new Error(`Could not construct media API request for: ${e}`));i.attributingTo(n),xt(i,{}).then(e=>this.renderPage(e,t)).then(t=>il.createFlowAction(t,this.pageType(),e)).then(r,o)}else{const n=this.renderPage({data:[]},t),o=il.createFlowAction(n,this.pageType(),e);r(o)}})}get pageRoute(){return[{protocol:qi.https,path:`/${ji.todayCardPreview}`,query:[Zi.ids,`${Zi.fetchData}?`,`${Zi.isTodaySection}?`]}]}generatePageRequest(e,t){const n=h(e.query[Zi.ids]);if(!p(n))return null;const r=n.split(",");return(new Mi).forType("editorial-items").withIds(r).includingAdditionalPlatforms(M()).includingAttributes(["screenshotsByType","videoPreviewsByType","requiredCapabilities","minimumOSVersion"])}renderPage(e,t){const n=_("PAGE_TITLE_TODAY"),r={title:n,label:"TodayForApps",resourceTypes:[],meta:{},contents:Be(e)},o=new jl;let i=!1;u(a(t,Zi.isTodaySection))&&(i=!f(t,Zi.isTodaySection));const s=qn(r,{hideTitle:!1,contentOffsetWithinModule:0,setTitleToDateForTodaySection:!0},o,i);return new Yc([s],null,n,n)}}),an(new class extends hl{constructor(){super("AccessoryProtocolRoomBuilder")}generatePageRequest(e,t){const n=[];for(const t of Object.keys(e.query))t.startsWith("id")&&n.push(e.query[t]);return this.requestWithFilter("deviceProtocol",n.join(","))}get pageRoute(){return[{query:[`${Zi.action}=accessoryLookup`]}]}}),an(new class extends il{constructor(){super("TabSelectionBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){const i=e.pathComponents(),s=i.length-1;let a,c;null!=(a=s>=0?i[s]:e.query.action)&&this.currentDeviceSupportsUrlAction(a)&&(c=new sa(a)),void 0===c&&(c=new sa("phone"===Ii||"pad"===Ii?"today":"discover")),r(c)}get pageRoute(){const e=["today","games","apps","discover","create","work","play","develop","categories"],t=[];for(const n of e){const e=`${Zi.action}=${n}`,r=`${n}`;t.push({query:[e]}),t.push({path:r}),t.push({path:`{countryCode}/${r}`})}return t}currentDeviceSupportsUrlAction(e){return"mac"===Ii&&-1!==["discover","create","work","play","develop","categories","search"].indexOf(e)||("phone"===Ii||"pad"===Ii)&&-1!==["today","apps","games","search"].indexOf(e)}}),an(new class extends il{constructor(){super("PassbookBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){ln(this.assemblePassbookRoomURL(e).build()).then(r,o)}get pageRoute(){return[{query:[`${Zi.action}=passbook`]}]}assemblePassbookRoomURL(e){let t=Lo.passbookMainURL;return null!=t&&"string"==typeof t||(t="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewFeature?id=717384713&mt=8"),new as(t)}}),an(new class extends il{constructor(){super("LibraryLink")}pageType(){return"unknown"}handlePage(e,t,n,r,o){ln(`https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewGenre?id=${e.query.g}&mt=8`.toString()).then(r,o)}get pageRoute(){return[{query:[`${Zi.action}=library-link`]}]}}),an(new class extends il{constructor(){super("MultiplexingBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){xt((new Mi).forType("multiplex").withIds([t.id])).then(e=>this.actionFromMultiplexResponse(e)).then(r,o)}get pageRoute(){return[{protocol:qi.https,path:"WebObjects/MZStore.woa/wa/viewFeature",query:[Zi.id]}]}actionFromMultiplexResponse(e){const t=g(e,"results.target"),n=g(e,"results.target-link");return t?this.targetDataToAction(t):n?this.targetLinkDataToAction(n):null}targetDataToAction(e){const t=h(e,"href");return t?ln(ct(t)):null}targetLinkDataToAction(e){const t=h(e,"url"),n=new as(t),r=this.addProtocolToURLIfNeeded(n).toString();return Promise.resolve(new aa(r,!1))}addProtocolToURLIfNeeded(e){return e.protocol||(e.protocol="https"),e}}),an(new class extends il{constructor(){super("LongUrlBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){const i=e.query.originalUrl;p(i)?net.fetch({url:i,method:"GET",signingStyle:"platform"}).then(e=>{let t;const n=e.headers["Content-Type"];if(e.ok&&e.redirected&&u(e.url))t=e.url;else{if(e.ok&&i!==e.url)return console.log(`[LongUrlBuilder] Url redirect was already processed. Original url: ${i}. Redirected url: ${e.url}`),void r(new Ia);if(e.ok&&p(n)&&-1!==n.toLowerCase().indexOf("text/xml")){const n=plist.parse(e.body),r=h(n,"action.kind"),o=h(n,"action.url");"Goto"===r&&o&&(t=o)}}p(t)?ln(t).then(r,o):o(new Error(`Unable to map long url for: ${i}`))},e=>{o(new Error(`Unable to fetch long url: ${i}`))}):o(new Error("Original url is missing when creating action for checkForLongUrl."))}get pageRoute(){return[{query:[`${Zi.action}=checkForLongUrl`]}]}}),an(new class extends il{constructor(){super("ShowAccountPageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){let i,s=[];if("mac"===Ii)i="account";else{i="infer";const e=new ia("account");e.presentationContext="presentModalFormSheet",e.animationBehavior="never",s=[e]}const a=new sa(i);a.actions=s,r(a)}get pageRoute(){return[{hostName:`${Gi}`},{hostName:`${zi}`}]}}),an(new class extends il{constructor(){super("ShowSubscriptionPageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){r(new ia("finance",cl))}get pageRoute(){return[{hostName:`${Wi}`}]}}),an(new class extends il{constructor(){super("ShowUpdatesBageBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){r(new sa("updates"))}get pageRoute(){return[{hostName:`${Hi}`},{path:"updates"},{path:"{countryCode}/updates"},{query:[`${Zi.action}=updates`]}]}}),an(new class extends il{constructor(){super("ArcadeBuilder")}pageType(){return"unknown"}handlePage(e,t,n,r,o){const i=new ia("article");i.pageUrl="https://apps.apple.com/story/id1456880492",r(i)}get pageRoute(){return[{query:[`${Zi.action}=arcade`]},{path:"arcade"},{path:"{countryCode}/arcade"},{path:"arcade/subscribe"},{path:"{countryCode}/arcade/subscribe"},{hostName:`${Ji}`}]}}),an(new class extends Dl{constructor(){super("TopChartsAdapterBuilder","topCharts",Vo.topCharts,qo.topCharts)}}),an(new class extends Dl{constructor(){super("ProductAdapterBuilder","unknown",Vo.product,qo.product,Go.product,Ho.product)}}),an(new class extends Dl{constructor(){super("ReviewsAdapterBuilder","product",Vo.reviews,qo.reviews,[],null,Bo.reviews,jo.reviews)}}),an(new class extends Dl{constructor(){super("SortedReviewsAdapterBuilder","reviews",Vo.sortedReviews,qo.sortedReviews)}}),an(new class extends Dl{constructor(){super("PersonalizedReviewsAdapterBuilder","unknown",[],null,Go.personalizedReviews,Ho.personalizedReviews)}}),an(new class extends Dl{constructor(){super("ProductInAppPurchaseAdapterBuilder","product",Vo.productInAppPurchase,qo.productInAppPurchase)}}),an(new class extends Dl{constructor(){super("InAppPurchaseInstallAdapterBuilder","inAppPurchaseInstall",Vo.inAppPurchaseInstall,qo.inAppPurchaseInstall)}}),an(new class extends Dl{constructor(){super("DeveloperAdapterBuilder","page",Vo.developer,qo.developer,Go.developer,Ho.developer)}}),an(new class extends Dl{constructor(){super("DeveloperHrefAdapterBuilder","page",Vo.developerHref,qo.developerHref)}}),an(new class extends Dl{constructor(){super("GroupingAdapterBuilder","page",Vo.grouping,qo.grouping,Go.grouping,Ho.grouping)}}),an(new class extends Dl{constructor(){super("ArticleAdapterBuilder","article",Vo.article,qo.article)}}),an(new class extends Dl{constructor(){super("SearchAdapterBuilder","page",Vo.search,qo.search)}}),an(new class extends Dl{constructor(){super("MSOAdapterBuilder","mso",Vo.msoRoom,qo.msoRoom,Go.mso,Ho.mso)}}),an(new class extends Dl{constructor(){super("ResetAndRedirectAdapterBuilder","unknown",Vo.resetAndRedirect,qo.resetAndRedirect)}}),an(new class extends Dl{constructor(){super("ActionAdapterBuilder","unknown",Vo.action,qo.actionHandler)}}),an(new class extends Dl{constructor(){super("PersonalizationTransparencyAdapterBuilder","account",Vo.personalizationTransparency,qo.personalizationTransparency)}}),an(new class extends Dl{constructor(){super("TodayAdapterBuilder","today",[],null,Go.today,Ho.today)}}),function(e){e[e.Common_iPhoneTopChart=117]="Common_iPhoneTopChart",e[e.Common_iPhoneFreeTopChart=118]="Common_iPhoneFreeTopChart",e[e.Common_iPhonePaidTopChart=122]="Common_iPhonePaidTopChart",e[e.Common_iPadTopChart=195]="Common_iPadTopChart",e[e.Common_iPadFreeTopChart=194]="Common_iPadFreeTopChart",e[e.Common_iPadPaidTopChart=197]="Common_iPadPaidTopChart",e[e.Sundance_Root=254]="Sundance_Root",e[e.Sundance_TabRoot=255]="Sundance_TabRoot",e[e.Sundance_Stack=256]="Sundance_Stack",e[e.Sundance_Header=257]="Sundance_Header",e[e.Sundance_Flowcase=258]="Sundance_Flowcase",e[e.Sundance_Shelf=260]="Sundance_Shelf",e[e.Sundance_BrickRow=261]="Sundance_BrickRow",e[e.Sundance_LinkList=265]="Sundance_LinkList",e[e.Sundance_QuickLinks=266]="Sundance_QuickLinks",e[e.Sundance_GenreStack=267]="Sundance_GenreStack",e[e.Sundance_TabSet=271]="Sundance_TabSet",e[e.Sundance_iPhoneAppTrailerShelf=304]="Sundance_iPhoneAppTrailerShelf",e[e.Sundance_iPadAppTrailerShelf=305]="Sundance_iPadAppTrailerShelf",e[e.Sundance_RecommendedAppsShelf=311]="Sundance_RecommendedAppsShelf",e[e.Sundance_RecommendedGamesShelf=312]="Sundance_RecommendedGamesShelf",e[e.AppStore_iPhoneFreeTopChartV2=369]="AppStore_iPhoneFreeTopChartV2",e[e.AppStore_iPhoneGrossingTopCharV2t=370]="AppStore_iPhoneGrossingTopCharV2t",e[e.AppStore_iPadFreeTopChartV2=371]="AppStore_iPadFreeTopChartV2",e[e.AppStore_iPadGrossingTopChartV2=372]="AppStore_iPadGrossingTopChartV2",e[e.AppStore_TVFreeTopChartV2=373]="AppStore_TVFreeTopChartV2",e[e.AppStore_TVGrossingTopChartV2=374]="AppStore_TVGrossingTopChartV2",e[e.AppStore_WatchFreeTopChartV2=375]="AppStore_WatchFreeTopChartV2",e[e.AppStore_WatchGrossingTopChartV2=376]="AppStore_WatchGrossingTopChartV2",e[e.AppStore_iPhonePaidTopChartV2=377]="AppStore_iPhonePaidTopChartV2",e[e.AppStore_iPadPaidTopChartV2=378]="AppStore_iPadPaidTopChartV2",e[e.AppStore_TVPaidTopChartV2=379]="AppStore_TVPaidTopChartV2",e[e.AppStore_WatchPaidTopChartV2=380]="AppStore_WatchPaidTopChartV2",e[e.AppStore_iPhoneiMessageFreeTopChart=395]="AppStore_iPhoneiMessageFreeTopChart",e[e.AppStore_iPhoneiMessagePaidTopChart=396]="AppStore_iPhoneiMessagePaidTopChart",e[e.AppStore_iPhoneiMessageGrossingTopChart=397]="AppStore_iPhoneiMessageGrossingTopChart",e[e.AppStore_iPadiMessageFreeTopChart=398]="AppStore_iPadiMessageFreeTopChart",e[e.AppStore_iPadiMessagePaidTopChart=399]="AppStore_iPadiMessagePaidTopChart",e[e.AppStore_iPadiMessageGrossingTopChart=400]="AppStore_iPadiMessageGrossingTopChart",e[e.AppStore_MacFreeTopChartV2=491]="AppStore_MacFreeTopChartV2",e[e.AppStore_MacPaidTopChartV2=492]="AppStore_MacPaidTopChartV2",e[e.AppStore_MacGrossingTopChartV2=493]="AppStore_MacGrossingTopChartV2",e[e.AppStore_Root=413]="AppStore_Root",e[e.AppStore_TabRoot=414]="AppStore_TabRoot",e[e.AppStore_HeroList=415]="AppStore_HeroList",e[e.AppStore_Hero=416]="AppStore_Hero",e[e.AppStore_CustomHero=417]="AppStore_CustomHero",e[e.AppStore_Shelf=418]="AppStore_Shelf",e[e.AppStore_TrailerShelf=420]="AppStore_TrailerShelf",e[e.AppStore_BrickRow=421]="AppStore_BrickRow",e[e.AppStore_Brick=422]="AppStore_Brick",e[e.AppStore_CustomBrick=423]="AppStore_CustomBrick",e[e.AppStore_ChartSet=424]="AppStore_ChartSet",e[e.AppStore_GenreStack=425]="AppStore_GenreStack",e[e.AppStore_ScreenShotShelf=429]="AppStore_ScreenShotShelf",e[e.AppStore_VideoShelf=430]="AppStore_VideoShelf",e[e.AppStore_iAPShelf=431]="AppStore_iAPShelf",e[e.AppStore_MSOBrickMarker=435]="AppStore_MSOBrickMarker",e[e.AppStore_DateBlock=436]="AppStore_DateBlock",e[e.AppStore_LinkList=437]="AppStore_LinkList",e[e.AppStore_HorizontalCardSwoosh=475]="AppStore_HorizontalCardSwoosh",e[e.AppStore_PersonalizedShelfMarker=476]="AppStore_PersonalizedShelfMarker"}(zo||(zo={}));class Ml{constructor(){this.shelves=[],this.metricsLocationTracker={rootPosition:0,locationStack:[]}}}class Ul{constructor(e){this.shouldFilter=!1,this.remainingItems=[],this.isFirstRender=!0,this.isDeferring=!1,this.showOrdinals=!1,this.ordinalIndex=1,this.featuredContentId=e}}const Vl="isOnBoardingCard";class Bl{constructor(e){this.label=e.label,this.title=e.title,this.meta=e.meta,this.date=h(e,"date"),this.remainingContents=d(e,"contents"),this.numberOfItemsProcessed=0,this.isFullyHydrated=function(e){for(let t=e.length-1;t>=0;t--)if(!$e(e[t]))return!1;return!0}(this.remainingContents)}}const $l="FEATURED APP",ql="FEATURED GAME";class jl{constructor(){this.locationTracker={rootPosition:0,locationStack:[]}}}class Hl{constructor(e,t,n,r){this.todayModule=e,this.metricsPageInformation=n,this.contentOffsetWithinModule=t,this.metricsLocationTracker=r}}const Gl=new Set(["artwork","appIcon","grid","multiApp","video"]),zl=new Set(["artwork","appIcon","grid","multiApp","video"]),Wl=new Set(["artwork","appIcon","grid","multiApp","video"]),Yl=.84,Ql="write-review",Kl="reviews";class Jl{constructor(e,t,n,r,o,i){this.isBundleShelf=!1,this.ids=e,this.title=t,this.shouldInferSeeAllFromFetchesItems=n,this.contentType=r,this.offerStyle=o,this.spotlightInAppProductIdentifier=i}}class Xl{constructor(e,t){this.sequenceId=0,this.metricsPageInformation=e,this.locationTracker=t}addImpressionsToShelf(e,t){mt(e,{id:`${this.sequenceId}`,kind:null,targetType:t,title:e.title,pageInformation:this.metricsPageInformation,locationTracker:this.locationTracker}),this.sequenceId++}getSequenceId(){return this.sequenceId}}const Zl=Ss.with("F0F0F8","303031");class eu{}const tu=["brandedSingleApp","grid","artwork","video"],nu={default:1,twelvePlus:3,seventeenPlus:4,adultOnly:5};class ru{constructor(e,t){this.period=e,this.type=t}isEqualTo(e){return e.period===this.period&&e.type===this.type}}const ou=7;!function(e){e[e.None=0]="None",e[e.ThirtyTwoBit=2]="ThirtyTwoBit",e[e.UnsupportedSystemDeletableApps=4]="UnsupportedSystemDeletableApps",e[e.UnsupportedWatchAppOnWatchClient=8]="UnsupportedWatchAppOnWatchClient",e[e.DisabledMerchandisableIAPs=16]="DisabledMerchandisableIAPs",e[e.LegacyMacApps=32]="LegacyMacApps",e[e.LegacyProductionMacOSInstaller=64]="LegacyProductionMacOSInstaller",e[e.UnsupportedPlatform=128]="UnsupportedPlatform",e[e.UnsupportedPreorders=256]="UnsupportedPreorders",e[e.MinimumOSRequirement=512]="MinimumOSRequirement",e[e.Arcade=1024]="Arcade",e[e.DeveloperPage=1780]="DeveloperPage",e[e.Offers=1462]="Offers",e[e.TodayCard=1918]="TodayCard",e[e.Search=1406]="Search",e[e.Bundles=1406]="Bundles",e[e.All=2046]="All"}(Wo||(Wo={}));class iu{constructor(e,t){this.videos=e,this.mediaPlatform=t}}const su=new di(414,896),au=new di(375,812),cu=(new di(414,736),new di(375,667)),lu=new di(320,568),uu=new di(320,480),pu=(new di(768,1024),new di(834,1112)),du=new di(834,1194),fu=new di(1024,1366),hu=new di(1024,1366),mu=new di(368,448),gu=["iphone_6_5","iphone_5_8","iphone6+","iphone6","iphone5","iphone"],yu=18,wu=18,Tu=41.5,Su=39,Au=34;class vu extends oi{constructor(e,t){super(),this.lockups=e,this.missingIds=t}}exportService("SearchData",{fetchHints:e=>L(()=>{const t=e.term,n=function(e,t,n=host.clientIdentifier){let r=as.from(e).param("caller","com.apple.AppStore");return r=S("searchHintsV3")?r.param("v","3"):r.param("version","1"),c(t)||(r=r.param("term",t)),(r=n===Si?r.param("media","watchSoftware").param("clientApplication","Watch"):n===Ai?r.param("clientApplication","Messages"):r.param("clientApplication","Software")).build()}(Lo.searchHintsURL,t);return function(e){return function(e,t){return net.fetch(e).then(n=>{if(!n.ok)throw Error(`Bad Status code ${n.status} for ${e.url}`);const r=Date.now(),o=t(n.body),i=Date.now();if(o){const e=function(e,t,n){if(l(e))return null;const r=e[0];return r.parseStartTime=t,r.parseEndTime=n,r}(n.metrics,r,i);u(e)&&(o[ec]=e)}return o[tc]=e.url.toString(),o})}({url:n,signingStyle:"platform"},e=>plist.parse(e))}().then(e=>(function(e,t,n){return Fo.c("searchHintsFromApiResponse",()=>{const r={rootPosition:0,locationStack:[]},o=d(n,"hints").map(t=>{const n=h(t,"hintsEntity");let o;return Me(o=S("searchHintsV3")?new hc(h(t,"searchTerm"),null,"hints",n):new hc(h(t,"term"),h(t,"url"),"hints",n),e,r),we(r),o}),i=new hs(e,"key","input",t,{}),s=new mc(o);return s.metricsEvents=[i],s})})(t,n,e))}),fetchTrending:e=>L(()=>{const e={url:Lo.trendingSearchesURL};return net.fetch(e).then(t=>{if(!t.ok)throw Error(`Bad Status code ${t.status} for ${e.url}`);return function(e){return Fo.c("trendingSearchesFromApiResponse",()=>{const t={rootPosition:0,locationStack:[]},n=d(e,"trendingSearches").map(e=>{const n=h(e,"label"),r=new hc(n,h(e,"url"),"trending");return Me(r,n,t),we(t),r}),r=n.length>0?h(e,"header.label"):null,o=new gc(r,n);switch(Ii){case"pad":o.maxNumberOfSearches=10;break;case"phone":o.maxNumberOfSearches=7}return o})}(JSON.parse(t.body))})}),fetchResults(e){const t=new Cl(e.targetingData,function(){const e=Jo();return null===e?function(){const e=o();e<Zo&&Xo++,Zo=e;const t=i(65535&e,4),n=i(e/65535&65535,4),r=i(e/4294967295&65535,4),s=i(e/0xffffffffff&4095|4096,4),a=i(255&Xo,2),c=i(Xo/255&63|128,2),l=i(ei,8);return`${n}${t}-${r}-${s}-${a}${c}-${i(ti,4)}${l}`}():e}());return L(()=>{if(l(e.term))return Promise.resolve(nn(e.facets));const n=e.term.trim();return l(n)?Promise.resolve(nn(e.facets)):function(r){const o={},i={};t.validAdRequest()&&(o["X-Apple-App-Store-Client-Request-Id"]=t.appStoreClientRequestId,o["X-Apple-iAd-Request-Data"]=t.targetingData,o["X-Apple-iAd-Env-Name"]=t.iAdRoutingInfo),p(void 0)&&(o[Bi]=void 0),i.headers=o;const s=u(e.url)?en(null,e.facets,e.searchEntity,e.origin):en(n,e.facets,e.searchEntity,e.origin),a=xt(s,i);let d;if(function(e=Do){switch(e.deviceType){case"pad":case"mac":return!0;default:return!1}}(Do)){const e=Co(null,null,function(e=Do){switch(e.deviceType){case"pad":return["iphone"];default:return[]}}(Do));e&&(d=xt(e).catch(()=>void 0))}return Promise.all([a,d]).then(([r,o])=>{const i=Eo(o,!1);return function(e,t,n,r,o,i,s){const a={},p=Fo.c("searchResultsFromResponse",()=>{!function(e){const t=qe(e);u(t)&&(e.meta.metrics[El]=h(t,"dataSetId"),delete e.meta.metrics.dataSetId)}(e);const p=[],d={},f=[],m="mac"!==Ii,g=At("Search",h(e,["meta","metrics",El]),e);g.searchTerm=r,g.pageUrl=o,m&&(g.iAdInfo=new ic(n.iAdId,n.appStoreClientRequestId));const y={rootPosition:0,locationStack:[]},w=Be(e.results.search),T=function(e){let t=null;const n=Be(e.results["ads-result"])[0];if(l(n))return null;const r=$(n,"iads"),o=Be(e.results.search)[0];let i=null;return(i=l(o)?h(r,"NOORGANIC"):o.id===n.id?h(r,"DUP"):h(r,"NORMAL"))&&i.length&&(t=JSON.parse(i)),u(n.attributes)&&(n.attributes.iad=t),n}(e);u(T)&&w.unshift(T);for(const e of w){if(c(e.attributes)){f.push(e);continue}if(eo(e,Wo.Search))continue;const t=$(e,"iad");let n=!1;m&&t&&!d[e.id]&&(n=!0,d[e.id]=!0,g.iAdInfo.apply(e.id,t));const r=on(e,n,g,y);if(r){if("inAppPurchase"===r.type){const e=r.resultModel;e&&e.parent&&(a[e.productIdentifier]=e.parent.bundleId)}p.push(r),we(y)}}const A=new ac;A.results=p;const v=S("disablingSearchFilters"),I=!l(s);if(A.facets=v&&I?null:rn(t,i),A.isAutoPlayEnabled=!0,f.length>0){const e=function(e,t,n){return{results:f,maxPerPage:Rl,renderedAdvertIds:{},pageInformation:t,metricsLocationTracker:n}}(0,g,y);e.renderedAdvertIds=d,A.nextPage=sn(e)}return It(A,g),A});return new Promise((e,t)=>{0===Object.keys(a).length?e(p):function(e){return new Promise((t,n)=>{Pl.visibilityForIAPs(e,(e,n)=>{t(n?{}:e)})})}(a).then(t=>{const n=p.results.filter(e=>{const n=e;if(!n||"inAppPurchase"!==n.type)return!0;const r=n.resultModel;if(!r)return!1;const o=t[r.productIdentifier];return null==o?r.isVisibleByDefault:o});p.results=n,e(p)})})}(r,e.facets,t,n,ot(s).toString(),i,e.searchEntity)})}()})},fetchMoreResults:e=>L(()=>{const t=function(e){return JSON.parse(e)}(e.pageToken),n=function(e){return e&&e.results?e.results.slice(0,e.maxPerPage):[]}(t);return 0===n.length?new Promise((e,t)=>nn()):xt(function(e){return new Mi(n).includingAdditionalPlatforms(tn(Do)).includingRelationships(["apps","top-apps"]).includingAttributes(["screenshotsByType","messagesScreenshots","videoPreviewsByType","requiredCapabilities","supportsFunCamera","minimumOSVersion"])}()).then(e=>(function(e,t){return Fo.c("resultsFromLookupResponse",()=>{const n=[];for(const r of e.data){const e=r.id;if(c(r.attributes)){console.warn(`no data found for ${e}, skipping`);continue}if(eo(r,Wo.Search))continue;let o=!1;$(r,"iad",null)&&(o=!0,t.renderedAdvertIds[r.id]=!0);const i=on(r,o,t.pageInformation,t.metricsLocationTracker);i&&n.push(i)}const r=new ac;return r.results=n,r.nextPage=sn(t),r})})(e,function(e){let t=[];e&&e.results&&(t=e.results.slice(e.maxPerPage,e.results.length));const n=Object.assign({},e);return n.results=t,n}(t)))})}),exportService("PageData",{fetchGeneric:e=>L(()=>cn(e.url,ka)),fetchMoreOfGeneric:e=>L(()=>(function(e){return new Promise((t,n)=>{const r=e.url;if(!r)return void n(new Error("Page token missing required `url` property"));const o=Nl.routedObjectForUrl(r);o.object?o.object.handlePagination(o.normalizedUrl,o.parameters,o.matchedRuleIdentifier,e,t,n):n(new Error(`fetchMoreOfPage: Unhandled pagination url: ${r}`))})})(e.pageToken)),fetchShelves:e=>L(()=>(function(e){return new Promise((t,n)=>{const r=Object.keys(e),o=new ra,i=new Qc(r.length);i.then(()=>{if(Object.keys(o.shelves).length>0)t(o);else{const t=Object.keys(o.errors).map(e=>o.errors[e].message);0===t.length?n(new Error(`Could not load any shelves: ${JSON.stringify(e)}`)):n(new Error(t.join("\n")))}});for(const t of r){const n=e[t],r=e=>{o.shelves[t]=e,i.countDown()},s=e=>{o.errors[t]=e,i.countDown()},a=Ll.routedObjectForUrl(n);a.object?a.object.handleShelf(a.normalizedUrl,a.parameters,a.matchedRuleIdentifier,r,s):s(new Error(`fetchShelves: Unhandled shelf url: ${n}`))}})})(e.requests)),fetchAction:e=>L(()=>(0!==Ft(new as(e.url)).length&&net.fetch({url:Lo.redirectUrlEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`url=${encodeURIComponent(e.url)}`}),ln(e.url).then(t=>{if(!t)throw new Error(`Promise resolved to null action for: ${e.url}`);if(e.isIncomingURL){const e=t.pageData;e&&function(e){if(c(e))return;const t=e.metricsEvents;if(!c(t)){for(const e of t)"page"===e.instruction&&(e.isReferralEligible=!0);e.metricsEvents=t}e instanceof Ac&&e.buttonAction instanceof la&&e.buttonAction.purchaseConfiguration&&(e.buttonAction.purchaseConfiguration.excludeAttribution=!1)}(e)}switch(t.actionClass){case"FlowAction":const n=t;"finance"===n.page||"article"===n.page?n.presentationContext="infer":e.isIncomingURL?n.presentationContext="push":(n.presentationContext="replace",n.animationBehavior="never")}return t}).catch(e=>{if(e instanceof nl)switch(e.statusCode){case 204:const t=new Ta("default");t.title=_("AppStore.ItemNotAvailable.Title"),t.message=_("AppStore.ItemNotAvailable.Message"),t.isCancelable=!0;const n=new sa("today");return n.title=_("OK"),n.actions=[t],n}throw Error(e.message)}))),fetchGenericAccount:e=>L(()=>cn(e.url,Kc))}),exportService("ProductData",{fetchPage:e=>L(()=>{0!==Ft(new as(e.url)).length&&net.fetch({url:Lo.redirectUrlEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`url=${encodeURIComponent(e.url)}`});const t=cn(e.url,Ac);return t||xt(new Mi(e.url)).then(e=>pr(e))}),fetchTVMedia:e=>L(()=>Promise.reject(new Error("fetchTVMedia is deprecated and should no longer be used. Logging this error is expected in older client code."))),fetchInstallPage:e=>L(()=>cn(e.url,_a)),fetchInstallPageAction:e=>L(()=>new Promise((t,n)=>{const r=new ia("inAppPurchaseInstall");r.pageUrl=br(e.id,e.parentId),t(r)}))}),exportService("TopChartData",{fetchPage:e=>L(()=>{const t=new as(e.url),n=t.query[Zi.chartIdentifier];t.removeParam(Zi.chartIdentifier),t.query.limit="200",host.clientIdentifier===Ai&&(t.query.contexts="messages");const r=xt(new Mi(t.toString()));let o;const i=Co(h(t.query,"genre"));return i&&(o=xt(i).catch(()=>void 0)),Promise.all([r,o]).then(([e,t])=>Jt(e,Eo(t),n))}),fetchMoreOfSegment:e=>L(()=>{const t=function(e){return e&&e.remainingContent?e.remainingContent.slice(0,e.maxPerPage):[]}(e.pageToken);return 0===t.length?Promise.resolve(new bl(null,null,null,[])):xt(new Mi(t)).then(t=>{const n=function(e){const t=Object.assign({},e);if(e&&e.ids){const n=je(e.ids,e.maxPerPage);t.ids=n}if(e&&e.remainingContent){const n=je(e.remainingContent,e.maxPerPage);t.remainingContent=n}return t}(e.pageToken);return function(e,t,n){return Fo.c("topChartSegmentFromLookupResponse",()=>{const r=[];let o=t.highestOrdinal;const i=Be(e);for(const e of i)eo(e)||(r.push(Zt(o,e,t.metricsPageInformation,t.metricsLocationTracker)),we(t.metricsLocationTracker),o++);const s=[];if(r.length>0){const e=new ta("smallLockup");e.items=r,s.push(e),n.highestOrdinal=o}const a=new bl(null,null,null,s);return a.nextPage=n,a})}(t,e.pageToken,n)})})}),exportService("TodayData",{fetchPage:e=>L(()=>{const t="x-as3-internal:/today/test"===e.url,n=-1!==e.url.indexOf(ji.todayCardPreview);if(t)return new Promise((e,t)=>{t()});if(n){const t=as.from(e.url);return t.param(Zi.fetchData,"true"),cn(t.build(),Yc)}return function(t){const n=M(),r=["editorialArtwork","minimumOSVersion"],o={};if(p(void 0)){const e={};e[Bi]=void 0,o.headers=e}const i=xt((new Mi).forType("today").includingAdditionalPlatforms(n).includingAttributes(r),o);let s=Promise.resolve(null);const a=(new Mi).forType("editorial-items").withIds(e.onboardingCardIds).includingAdditionalPlatforms(n).includingAttributes(r);return a.ids.size>0&&(s=xt(a,{}).catch(()=>void 0)),Promise.all([i,s]).then(([e,t])=>(function(e,t=null){if(c(e))return null;!function(t){let n=!0;const r=d(e.results.data),o={};for(const e of r){const t=d(e.contents);for(const e of t)if($e(e)){const t=o[e.id];o[e.id]=t?t+1:1}}for(let e=r.length-1;e>=0;e--){const t=r[e],i=Vn(t.contents,o,n);t.contents=i.contents,n=!i.contentsContainsHydratedData}}();const n=new jl;n.pageInformation=At("Today","today",e);const r=Be(t),o=p(r),i=[];if(o){!function(e){for(const t of e)t[Vl]=!0}(r);for(const e of r)i.push(e.id)}const s=[];let a=!1;for(const t of e.results.data){const e=De(h(t,"date"));if(u(e)){const t=new Date;if(e.getTime()>t.getTime())continue}if(o&&!a){const e=d(t.contents);t.contents=r.concat(e),a=!0}Ln(s,t)}const l=In();l&&Fn(s,l);const f=Lo.termsAndConditionsURL;c(f)||Fn(s,vn(f));const m=[];let g=!1,y=!0;for(;!g;){const e=$n(s,n,y);if(!u(e))break;m.push(e),g=u(e.url),y=!1}const w={queue:s,metricsContext:n};let T=null;e.results.data.length>0&&(T=h(e.results.data[0].title));const S=Bn(m,w,i,T);return It(S,n.pageInformation),S})(e,t))}()}),fetchMoreOfPage:e=>L(()=>jn(e.pageToken)),fetchArticle:e=>L(()=>cn(e.url,wl))}),exportService("ContentData",{fetchIconArtwork:e=>L(()=>xt((new Mi).withIds(e.adamIds).forType("apps").includingAdditionalPlatforms(M())).then(e=>{const t=Be(e),n={};for(const e of t)n[e.id]=to(Q(e,Oe(e),"artwork"));return n})),fetchLockups:e=>0===e.bundleIds.length?Promise.resolve(new vu([],[])):L(()=>xt((new Mi).forType("apps").includingAttributes(["editorialArtwork","minimumOSVersion","screenshotsByType","videoPreviewsByType"]).includingAdditionalPlatforms(M()).withFilter("bundleId",e.bundleIds.join(","))).then(t=>(function(e,t){return Fo.c("lockupsFromResponse",()=>{const n={rootPosition:0,locationStack:[]},r=new sc,o=Be(e),i=[],s=new Set(t);for(const e of o){const t=kr(e,{metricsOptions:{pageInformation:r,locationTracker:n}});t&&(i.push(t),s.delete(t.bundleId))}return new vu(i,Array.from(s))})})(t,e.bundleIds)))}),exportService("Metrics",{postEvent:e=>L(()=>(Za.postEvent(e.metricsEvent),Promise.resolve({result:!0})))}),exportService("Purchases",{decoratePurchase:e=>L(()=>{const t=e.intent;let n=h(t,"token.buyParams");const r=h(t,"overrideBuyParams");u(r)&&(n=r),n=function(e,t,n,r,o,i,s){let a=t;const c=Ie(n),l=ce(h(c,"pageId")),p=ce(h(c,"pageType")),d=ce(h(i,"pageContext"));if(a+="&"+Uo.eventHandlers.buyConfirmed.metricsBuyParamsString(l,p,d,za,s),s)for(const e of Object.keys(s))a=Oo(e,s,a);if(!i)return a;if(!r){const e=h(i,"extRefUrl2"),t=le(e);e&&t&&(i.refApp=t),a=Oo("extRefApp2",i,a,null),a=Oo("extRefUrl2",i,a,null)}const f=h(c,"pageId"),m=f&&f===e;if("Software"!==h(c,"pageType")||m){const e=pe(h(i,"refUrl"));a=u(e)?Oo("searchTerm",{searchTerm:e},a):Oo("searchTerm",n,a)}return o&&(a=Ro("platformDisplayStyle",o,a)),a}(t.adamId,n,y(t,"token.pageInformation"),f(t,"token.excludeAttribution"),h(t,"token.metricsPlatformDisplayStyle"),g(t,"metrics"),g(t,"systemInformation"));const o=d(t,"token.appPlatforms"),i=o&&o.length&&o.length>0&&o.indexOf("tv")>=0,s=fo(Ii).some(e=>-1!==o.indexOf(e)),a=h(t,"instalationType"),c="update"===a,l="redownload"===a,p=f(t,"token.isPreorder"),m=!(p||i&&!s),w=Object.assign({},g(t,"token.additionalHeaders",{}),g(t,"additionalHeaders",{})),T={adamId:h(t,"adamId"),buyParams:n,vendor:h(t,"token.vendor"),appName:h(t,"token.appName"),bundleId:h(t,"token.bundleId"),appPlatforms:o,additionalHeaders:w,isUpdate:c,isRedownload:l,isPreorder:p,createsJobs:m,preflightPackageUrl:h(t,"token.preflightPackageUrl")};return Promise.resolve(T)})}),exportService("MSOData",{fetchProviderData:e=>L(()=>{const t=e.providerAdamId;return xt((new Mi).forType("multiple-system-operators").withIds([t])).then(e=>(function(e){return Fo.c("msoProviderDataFromData",()=>{const t=Ve(e),n=j(t,"name"),r=j(t,"url"),o=function(e){return Fo.c("msoProviderArtworkFromData",()=>{const t=$(e,"editorialArtwork.storeFlowcase");return to(t||$(e,"artwork"))})}(t);o&&(o.crop="sr");const i=function(e){const n=$(t,"editorialArtwork.bannerUber");return n?to(n):null}();return new vl(n,r,o,i)})})(e))}),fetchPage(e){const t=c(e.providerAdamId)||c(e.subscribedChannelIds);return L(()=>t?cn(e.url,ka):xt(Yt(e.providerAdamId)).then(t=>Qt(t,function(e,t){const n=e.appsToAlwaysShow;for(const r of Object.keys(e.apps)){const o=e.apps[r];for(const e of o)if(-1!==t.indexOf(e)){n.push(r);break}}return n}(function(e){return Fo.c("msoAppsFromResponse",()=>{const t=Ve(e),n=ee(t,"channel-apps"),r={};for(const e of n)r[Z(e,"app").id]=q(e,"channelNames");const o=ee(t,"apps").map(e=>e.id);return new Il(r,o)})}(t),e.subscribedChannelIds))))}}),exportService("CMCPersonalizationData",{fetchPersonalizedOfferContext:e=>L(()=>{const t=e.offerToken.offerAction,n=e.offerToken.offerDisplayProperties;if(!t||!n)return Promise.reject(new Error("Invalid offerToken for personalized offer fetch."));const r=t.adamId,o={url:Lo.buyButtonMetadataURL,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"ids="+r,signingStyle:"platform"};return net.fetch(o).then(e=>{if(!e.ok)throw Error(`Bad Status code ${e.status} for ${o.url}`);const i=g(JSON.parse(e.body),r);let s=null,a=null;const l=function(e){return Fo.c("personalizedOfferTypeFromBuyButtonMetadata",()=>{const t=d(e,"offers");if(0===t.length)return null;for(const e of t){const t=h(e,"type");if(t)return t}return"none"})}(i);if(c(l))throw new Error("fetchPersonalizedOfferContext: Failed to determine offer type from buyButtonMetadata");if("none"!==l){let e="colored",r=null;switch(l){case"purchased":e="disabled",r=_("BUNDLE_OFFER_BUTTON_TITLE_PURCHASED")}a=function(e,t,n,r){return c(e)?null:Fo.c("personalizedCMCDisplayPropertiesFromBuyButtonMetadata",()=>{const t=new ai("app",e.adamId,r),o=Hr(e);t.isFree=o;let i=null;i=o?e.title:e.priceFormatted,t.titles.standard=i;const s=n.hasInAppPurchases;if(t.hasInAppPurchases=s,s){const e=_("INLINE_IN_APP_PURCHASES");t.subtitles.standard=e}return t.contentRating=n.contentRating,t})}(s=function(e,t){return Fo.c("personalizedCMCOfferActionFromBuyButtonMetadata",()=>{const n=d(e,"offers");if(0===n.length)return null;let r,o=null;for(const e of n)switch(r=h(e,"type")){case"complete":case"purchased":o=e;break;default:o=null}if(!o)return null;let i=h(o,"buyParams");if("complete"===r&&c(i))return Fo.d("ignoredValue","string","item.offer.buyParams"),null;i||(i="");const s=t.purchaseConfiguration,a=new si(i,s.vendor,s.appName,s.bundleId,s.appPlatforms,s.isPreorder,s.excludeAttribution,s.metricsPlatformDisplayStyle);a.pageInformation=s.pageInformation;const l=Wr(o,t.adamId,a);return function(e,t){const n=t.purchaseConfiguration.pageInformation;let r;for(const e of t.metricsEvents)if(r=d(e.eventFields,"location"))break;Fe(e,n,r,!1)}(l,t),l})}(i,t),0,n,e),r&&(a.titles.standard=r)}const u=Qr(s,!1);return new ci(l,u,a)})})}),Fo.a()}]);