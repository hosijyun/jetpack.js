/**
 * {{{pkg.name}}}
 * Copyright Â© {{{year}}} Apple Inc. All rights reserved.
 **/
(function(){function s(l,d,g){function h(y,A){if(!d[y]){if(!l[y]){var T="function"==typeof require&&require;if(!A&&T)return T(y,!0);if(P)return P(y,!0);var I=new Error("Cannot find module '"+y+"'");throw I.code="MODULE_NOT_FOUND",I}var k=d[y]={exports:{}};l[y][0].call(k.exports,function(_){var w=l[y][1][_];return h(w||_)},k,k.exports,s,l,d,g)}return d[y].exports}for(var P="function"==typeof require&&require,S=0;S<g.length;S++)h(g[S]);return h}return s})()({1:[function(s,l){l.exports=s("./src/metrics")},{"./src/metrics":49}],2:[function(s,l){l.exports={version:"6.4.2",name:"mt-metricskit"}},{}],3:[function(s,l){l.exports=s("./src")},{"./src":6}],4:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./environment"),P=s("./logger"),S="noTopicConfig",y={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"https://xp.apple.com/config/1/report",fieldsMap:{cookies:["itcCt","itscc","xp_ab","xp_abc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"https://xp.apple.com/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},A={},T=function(k){this._topic=k,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+y.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+y.compoundSeparator+this._topic};T.createConfig=function(k,_,w,E){k=k||S;var C=A[k];return C||(C=new T(k),A[k]=C,k!==S&&C.initialize(_,w,E)),C},T.defaultConfig=function(){return T.createConfig()},T.value=function(k,_){var w=_&&A[_]||T.defaultConfig();return w.value.call(w,k)},T.environment=h,T.logger=P,T.prototype._defaults=function(){return y},T.prototype._setInitialized=function(k){this._initialized=k},T.prototype._setShowedDebugWarning=function(k){this._showedDebugWarning=k},T.prototype._setShowedNoProvidedSourceWarning=function(k){this._showedNoProvidedSourceWarning=k},T.prototype.setDelegate=function(k){return g.reflect.attachDelegate(this,k)},T.prototype.topic=function(){return this._topic},T.prototype.configUrl=function(){var k=this.value("configBaseUrl");return this._topic===S?T.logger.error("config.configUrl(): Topic must be provided"):k+="/"+this.topic(),k},T.prototype.sources=function(){},T.prototype.value=function(k){var _=this.cachedSource(),w=this.serviceSource(),E=this.sources(),C=this.debugSource(),F=_||w||E||C,R;return E||w||k in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,T.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),C&&!this._showedDebugWarning&&(this._showedDebugWarning=!0,T.logger.warn("\"debugSource\" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting \"sticks\" across session, use \"setDebugSource(null)\" to clear")),g.reflect.isArray(E)||(E=[E]),R=0===k.indexOf("blacklisted")?F?[_,w,E,C]:[y]:[y,_,w,E,C],g.keyValue.valueForKeyPath.apply(g.keyValue,[k].concat(R))},T.prototype.setDebugSource=function(k){return this._debugSource=k||null,g.storage.saveObjectToStorage(T.environment.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},T.prototype.debugSource=function(){return this._debugSource||(this._debugSource=g.storage.objectFromStorage(T.environment.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},T.prototype.setCachedSource=function(k){return this._cachedSource=k||null,g.storage.saveObjectToStorage(T.environment.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},T.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=g.storage.objectFromStorage(T.environment.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},T.prototype.setServiceSource=function(k){return this._serviceSource=k,this._serviceSource},T.prototype.serviceSource=function(){return this._serviceSource},T.prototype.fetchConfig=function(k,_,w){w=w||function(){};g.backoff.exponentialBackoff(g.network.makeAjaxGetRequest.bind(g.network,k),function(F){var R;try{F=JSON.parse(F),R=!0}catch(O){w.call(w,O)}R&&_&&_.call(_,F)},w)},T.prototype.initialize=function(k,_,w){_=_||function(){};var E=function(){this._initialized=!0,_.call(_)}.bind(this);if(k)this.setDelegate({sources:k}),E();else{this.setCachedSource(this.cachedSource());var C=this.configUrl(),F=function(O){this.setCachedSource(O),this.setServiceSource(O),E()}.bind(this);this.fetchConfig(C,F,w)}},T.prototype.initialized=function(){return this._initialized},l.exports=T},{"./environment":5,"./logger":7,"@amp-metrics/mt-metricskit-utils-private":21}],5:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h={setDelegate:function(S){return g.reflect.attachDelegate(this,S)},localStorageObject:g.storage.localStorageObject,sessionStorageObject:g.storage.sessionStorageObject};l.exports=h},{"@amp-metrics/mt-metricskit-utils-private":21}],6:[function(s,l){var g=s("./config");l.exports=g},{"./config":4}],7:[function(s,l){var g=s("@amp-metrics/mt-client-logger-core"),h=g.loggerNamed("mt-client-config");l.exports=h},{"@amp-metrics/mt-client-logger-core":8}],8:[function(s,l){l.exports=s("./src")},{"./src":9}],9:[function(s,l){var g=s("./logger"),h=s("./utils");g.utils=h,l.exports=g},{"./logger":10,"./utils":11}],10:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./utils"),P={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},S={loggerName:"defaultLogger",level:P.INFO,throwLevel:P.NONE},y={},A=function(I){this._loggerName=I,this._level,this._throwLevel};A.loggerNamed=function(I){I=I||S.loggerName;var k=y[I];return k||(k=new A(I),y[I]=k),k},A.level=function(){return S.level},A.throwLevel=function(){return S.throwLevel},g.reflect.extend(A.prototype,P),g.reflect.extend(A.prototype,h.flagArguments),A.prototype.setDelegate=function(I){return g.reflect.attachDelegate(this,I)},A.prototype.loggerName=function(){return this._loggerName},A.prototype.levelParameterAsInt=function(I){var k=null,_;return g.reflect.isString(I)?_=this.levelStringToIntMap[I.toLowerCase()]:g.reflect.isNumber(I)&&(_=I),_>=this.MIN_LEVEL&&_<=this.MAX_LEVEL&&(k=_),k},A.prototype.setLevel=function(I){var k=this.levelParameterAsInt(I);null!==k&&(this._level=k)},A.prototype.setThrowLevel=function(I){var k=this.levelParameterAsInt(I);null!==k&&(this._throwLevel=k)},A.prototype.level=function(){var T=this._level;return g.reflect.isNumber(T)?T:A.level()},A.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},A.prototype.throwLevel=function(){var T=this._throwLevel;return g.reflect.isNumber(T)?T:A.throwLevel()},A.prototype.debug=function(){h.execute(this,"debug",arguments)},A.prototype.info=function(){h.execute(this,"info",arguments)},A.prototype.warn=function(){h.execute(this,"warn",arguments)},A.prototype.error=function(){h.execute(this,"error",arguments)},A.prototype.lastLog=function(I){return this[I]?this[I]._lastLog:null},l.exports=A},{"./utils":11,"@amp-metrics/mt-metricskit-utils-private":21}],11:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(S){return g.reflect.attachDelegate(this,S)},execute:function(S,y,A){var T=S.levelStringToIntMap[y];if(S.level()!==S.NONE&&S.level()<=T){var I=Array.prototype.slice.call(A),k=h.nonFlagLogArguments(I),_=h.logOptions(S,T,I),w=_.includeCallStack?new Error().stack:null,E=w?k.concat("\n"+w):k;if(S[y]._lastLog=E,_.mirrorToServer&&h.sendToServer(S,y,k,w),_.throwInsteadOfPrint)throw new Error(k.toString());else _.suppressClientOutput||(console[y]?console[y].apply(console,E):console.log.apply(console,E))}},isFlagObject:function(S){return S&&S===h.flagArguments[S.constructor.name]},nonFlagLogArguments:function(S){return S.filter(function(y){return!h.isFlagObject(y)})},logOptions:function(S,y,A){var P={},T;return A.forEach(function(I){h.isFlagObject(I)&&(T=g.string.snakeCaseToCamelCase(I.constructor.name),P[T]=!0)}),g.reflect.isFunction(S.mirrorToServerLevel)&&S.mirrorToServerLevel()!==S.NONE&&S.mirrorToServerLevel()<=y&&(P.mirrorToServer=!0),S.throwLevel()!==S.NONE&&S.throwLevel()<=y&&(P.throwInsteadOfPrint=!0),P},sendToServer:function(){}};l.exports=h},{"@amp-metrics/mt-metricskit-utils-private":21}],12:[function(s,l){l.exports=s("./src")},{"./src":15}],13:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-config"),P=s("./logger"),S=function(){var I=navigator.userAgent;return /iPad|iPhone|iPod/.test(I)&&-1==I.indexOf("IEMobile")},y={DEFAULT_REQUEST_TIMEOUT:1e4,EVENTS_KEY:"events",EVENT_DELIVERY_VERSION:"1.0",EVENT_SEND_METHOD:{AJAX:"ajax",AJAX_SYNCHRONOUS:"ajaxSynchronous",IMAGE:"image"},MAX_PERSISTENT_QUEUE_SIZE:100,RETRY_EXPONENT_BASE:2,URL_DELIVERY_VERSION:2,eventQueues:{},enqueueEvent:function(I,k){var _=null;if(I&&k){y.eventQueues=y.eventQueues||{},y.eventQueues[I]=y.eventQueues[I]||{},y.eventQueues[I][y.EVENTS_KEY]=y.eventQueues[I][y.EVENTS_KEY]||[],y.eventQueues[I][y.EVENTS_KEY].push(k),_=k;var w=h.value("maxPersistentQueueSize",I)||y.MAX_PERSISTENT_QUEUE_SIZE;y.trimEventQueues(y.eventQueues,w)}return _},trimEventQueues:function(I,k){var _=Object.keys(I);_.length&&_.forEach(function(w){var E=I[w][y.EVENTS_KEY];E&&E.length&&E.length>k&&(P.warn("eventQueue overflow, deleting LRU events: size is: "+E.length+" which is over max size: "+k),I[w][y.EVENTS_KEY]=E.slice(-k))})},resetTopicQueue:function(I){y.eventQueues[I]&&(y.eventQueues[I][y.EVENTS_KEY]=null)},resetTopicRetryAttempts:function(I){y.eventQueues[I]&&(y.eventQueues[I].retryAttempts=0)},scheduleNextTopicRetryAttempt:function(I){if(y.eventQueues[I]){y.eventQueues[I].retryAttempts=y.eventQueues[I].retryAttempts||0,y.eventQueues[I].retryAttempts++;var k=Math.pow(y.RETRY_EXPONENT_BASE,y.eventQueues[I].retryAttempts)*h.value("postFrequency",I);y.resetTopicPostInterval(I),y.setTopicPostInterval(I,k)}},sendEvents:function(I,k){for(var _ in y.eventQueues)y.sendEventsForTopic(_,I,k)},sendEventsForTopic:function(I,k,_){var w=y.eventQueues[I],E=h.value("testExponentialBackoff",I),C=h.value("metricsUrl",I),F=g.config.disabled.call(h);if(w&&C&&!F&&!E&&!(w.retryAttempts&&_))switch(y.resetTopicPostInterval(I),y.setTopicPostInterval(I,h.value("postFrequency",I)),k){case y.EVENT_SEND_METHOD.IMAGE:y.sendEventsViaImage(I);break;case y.EVENT_SEND_METHOD.AJAX_SYNCHRONOUS:y.sendEventsViaAjax(I,!1);break;case y.EVENT_SEND_METHOD.AJAX:default:y.sendEventsViaAjax(I,!0);}E&&y.scheduleNextTopicRetryAttempt(I)},sendEventsViaImage:function(I){if(y.eventQueues[I]){var k=y.metricsUrlForTopic(I),_=-1==k.indexOf("?")?"?":"&",E=y.eventQueues[I][y.EVENTS_KEY];E&&E.length&&E.forEach(function(C){var F=y.createQueryParams(C);if(F){var O=new Image;O.src=k+_+"responseType=image"+"&"+F}}),y.resetTopicQueue(I)}},createQueryParams:function(I){var w="",k,_;return Object.keys(I).forEach(function(E,C,F){k=I[E],_=g.reflect.isString(k)?k:JSON.stringify(k),w+=E+"="+encodeURIComponent(_),C<F.length-1&&(w+="&")}),w.length?w:null},sendEventsViaAjax:function(I,k){if(y.eventQueues[I]&&y.eventQueues[I][y.EVENTS_KEY]){var _=y.enrichAndSerializeEvents(y.eventQueues[I][y.EVENTS_KEY]);if(_){var w=y.metricsUrlForTopic(I),E=function(){y.resetTopicQueue(I),y.resetTopicRetryAttempts(I)},C=function(){y.scheduleNextTopicRetryAttempt(I)},F=y.createAjaxRequest(w,k,E,C);if(k){var R=h.value("requestTimeout",I)||y.DEFAULT_REQUEST_TIMEOUT;F.timeout=Math.min(R,h.value("postFrequency",I))}F.send(_)}}},createAjaxRequest:function(I,k,_,w){var E=new XMLHttpRequest;return E.onload=function(){200<=E.status&&300>E.status||400<=E.status&&500>E.status?_():w()},E.open("POST",I,k),E.withCredentials=!0,E.setRequestHeader("Content-type","application/json"),E},enrichAndSerializeEvents:function(I){var k=null;if(I&&I.length){var _={};_.deliveryVersion=y.EVENT_DELIVERY_VERSION,_.postTime=Date.now(),_[y.EVENTS_KEY]=I;try{k=JSON.stringify(_)}catch(w){P.error("Error stringifying events as JSON: "+w)}}return k},metricsUrlForTopic:function(I){var k=h.value("metricsUrl",I)+"/"+y.URL_DELIVERY_VERSION+"/";return k+I},setTopicPostInterval:function(I,k){y.eventQueues[I]&&k&&(y.eventQueues[I].postIntervalToken=setInterval(function(){P.debug("MetricsKit: triggering postIntervalTimer for "+I+" at "+new Date().toString()),y.sendEventsForTopic.call(y,I)},k))},resetTopicPostInterval:function(I){y.eventQueues[I]&&(clearInterval(y.eventQueues[I].postIntervalToken),y.eventQueues[I].postIntervalToken=null)}};l.exports={_utQueue:function(){return y},/**
     * Enqueues events to be sent to the server in batches after "postFrequency" milliseconds since the previous send.
     * The queue is stored in memory, and will retry on failed sends for as long as the session is open.
     * Immediately before a page turn/tab close (usually onpagehide), clients can call flushUnreportedEvents() to send up any events still left in the queue.
     *
     * Flow:
     *      1. Normal:
     *          a. [recordEvent()} Events posted to in-memory eventQueue via "recordEvent() (this method)".
     *             NOTE1: Only remember the most recent MAX_PERSISTENT_QUEUE_SIZE events per queue so we don't eat up all browser memory if we can't send for a very long time.
     *             NOTE2: We could have another set of "waitingForAck" queues which was also in-memory, but then
     *                    we'd need code to merge two queues on re-tries (since _sendEvents() already merges in previously-queued events before attempting to [re]send)
     *                    Since the send failure case is a rare case anyway, we err on the side of not adding code complexity to deal with it.
     *          b. [_sendEvents()] Wait "_postFrequency()" milliseconds before attempting actual "_sendEvents()"
     *          c. Set a timeout for the send which should be the lower of "_postFrquency()" or config.requestTimeout (which defaults to DEFAULT_REQUEST_TIMEOUT).
     *             This guarantees that only one send attempt per topic is pending at any given time.
     *          d. Wait for status=200 response ack, and clear event queue when received (see "Edge Cases", below)
     *      2. Unsent due to ingestion server problem (5XX response):
     *          a. Continue gathering events, adding to in-memory eventQueue
     *          b. Use an exponential back-off strategy by waiting 2^1 = times "_postFrequency()" milliseconds before attempting another "_sendEvents()", as in "Normal" case, above
     *          c. If the ingestion server responds with another 5XX code, wait 2^2 = 4 times "_postFrequency()" milliseconds before attempting another send, and so on
     *          d. Continue as in 1c, above
     *      3. Unsent due to failed conection or other error:
     *          a. Continue gathering events, adding to in-memory eventQueue
     *          b. Wait "_postFrequency()" milliseconds before attempting another "_sendEvents()", as in "Normal" case, above
     *          c. Continue as in 1c, above
     *
     * Edge Cases: Here are the small edge-case windows of failure in the in-memory event queue facility:
     *          1. If two batches of events are sent out before the first one returns and clears the queue, the second one will try to send any queued events as well.
     *             For this to happen, we'd have to be in a situation where we're not leaving the page, event sends are taking some time to respond,
     *             causing us to build up a queue, and then two "sends" are attempted back-to-back by a client calling recordEvent() with postNow=true or flushUnreportedEvents().
     *             It's so rare that the code complexity to try and prevent this case is not worth it (synchronous event posting is the most straightforward way to handle it).
     *          2. If we send a batch of events, the last of which causes, say, a page turn, and invokes flushUnreportedEvents(), we will never get the ack that the batch made it to the server
     *             so we just clear the queue and assume that they made it. During empirical testing, events did continue to get sent event after the browser is closed as long as there is a network connection.
     *          3. If the ingestion server is down, we would only retry as long as the session is open, and lose all events once the user leaves. Events are usually flushed on page turns
     *             without the opportunity to see if the send was successful (see 2 above) so if we wanted to preserve events in the case of ingestion server failure,
     *             we would have to a) keep track of the previous send attempts, b) not flush events on page turn, c) stash the events and the retry state in persistent storage,
     *             and d) fetch the events from persistent storage and restore the retry state, which we choose not to do in order to avoid all of this complexity for what is probably a rare scenario.
     *
     * Note: each topic has its own queue, and all of the above logic applies to each individual queue.
     * For example, exponential backoff works independently on a per-topic basis, in case the server tells us to back off of one topic, but not another.
     * Testing tips:
     * 1) A debug message is logged every time a postInterval timer is triggered, but the metricskit logger debug messages are off by default.
     *    They can be enabled in Web inspector via: metrics.system.logger.setLevel(metrics.system.logger.DEBUG);
     * 2) Exponential backoff can be tested by using a debug source with the 'testExpontentialBackoff' flag enabled.
     *    When this flag is enabled, the metrics queue will skip sending and instead schedule the next retry for _postFrequency() * RETRY_EXPONENT_BASE ^ n milliseconds
     *    where n is the current retry attempt. (see mt-metricskit docs for more details on using debug sources)
     *    To see this in action, you can enable debug logs as in (1) above, then set a debug source with testExponentialBackoff=true (and optionally, a lower postFrequency),
     *    then call recordEvent() to enqueue an event.
     *    You should see a debug message (which includes a timestamp) after postFrequency milliseconds, and then every postFrequency * 2^n milliseconds thereafter.
     *
     * @param {String} topic defines the Figaro "topic" that this event should be stored under
     * @param {Object} eventFields a JavaScript object which will be converted to a JSON string and enqued for sending to Figaro according to the postFrequency schedule
     * @param {Boolean} postNow - effectively forces an immediate send, along with any other messages that may be sitting in the queue
     */recordEvent:function(I,k,_){g.config.disabled.call(h)||(0===h.value("postFrequency",I)&&(_=!0),y.enqueueEvent(I,k),_?y.sendEvents(y.EVENT_SEND_METHOD.AJAX,!0):!y.eventQueues[I].postIntervalToken&&y.setTopicPostInterval(I,h.value("postFrequency",I)))},flushUnreportedEvents:function(I){I?S()?y.sendEvents(y.EVENT_SEND_METHOD.AJAX_SYNCHRONOUS,!0):y.sendEvents(y.EVENT_SEND_METHOD.IMAGE,!0):y.sendEvents(y.EVENT_SEND_METHOD.AJAX,!0)}}},{"./logger":16,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],14:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-config"),P=s("./event_queue");l.exports={_utResetQueue:function(){for(var A in P._utQueue().eventQueues)P._utQueue().resetTopicPostInterval(A);P._utQueue().eventQueues={}},setDelegate:function(A){return g.reflect.attachDelegate(this,A)},recordEvent:function(A,T,I){var k=null;return T&&!g.config.metricsDisabledOrBlacklistedEvent.call(h,T.eventType,A)&&(g.config.removeBlacklistedFields.call(h,T,A),P.recordEvent(A,T,I),k=T),k},flushUnreportedEvents:function(A){P.flushUnreportedEvents(A)},sendMethod:function(){return"javascript"}}},{"./event_queue":13,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],15:[function(s,l){var g=s("./event_recorder"),h=s("./logger");l.exports={eventRecorder:g,logger:h}},{"./event_recorder":14,"./logger":16}],16:[function(s,l){var g=s("@amp-metrics/mt-client-logger-core"),h=g.loggerNamed("mt-event-queue");l.exports=h},{"@amp-metrics/mt-client-logger-core":8}],17:[function(s,l){l.exports=s("./src")},{"./src":18}],18:[function(s,l){var g=s("@amp-metrics/mt-event-queue"),h=s("./logger"),P=s("./utils");h.utils.setDelegate(P),l.exports=h},{"./logger":19,"./utils":20,"@amp-metrics/mt-event-queue":12}],19:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-logger-core"),P={mirrorToServerLevel:h.prototype.NONE,topic:""};h.setTopic=function(y){P.topic=y},h.topic=function(){return P.topic},h.mirrorToServerLevel=function(){return P.mirrorToServerLevel},h.prototype.setTopic=function(y){this._topic=y},h.prototype.topic=function(){var S=this._topic||h.topic();return S||console.error("LoggerKit: topic must be set in order to mirror log events to the server. Example: loggerKit.setTopic('my_figaro_topic');"),S},h.prototype.setMirrorToServerLevel=function(y){var A=this.levelParameterAsInt(y);null!==A&&(this._mirrorToServerLevel=A)},h.prototype.mirrorToServerLevel=function(){var S=this._mirrorToServerLevel;return g.reflect.isNumber(S)?S:h.mirrorToServerLevel()},l.exports=h},{"@amp-metrics/mt-client-logger-core":8,"@amp-metrics/mt-metricskit-utils-private":21}],20:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-logger-core"),P=s("@amp-metrics/mt-event-queue");h.eventRecorder=P.eventRecorder;var S={eventType:"log",eventVersion:"4"},y=function(I,k,_,w){var E=null,C=_&&_.length;if(!(k&&(C||w)))console.error("LoggerKit: at least one argument or the INCLUDE_CALL_STACK flag is required in order to mirror to server");else if(E={},g.reflect.extend(E,S),E.eventTime=Date.now(),E.level=k,E.loggerName=I.loggerName(),w&&(E.callstack=w),C){try{E.arguments=JSON.stringify(_)}catch(R){I.error("Error stringifying arguments as JSON: "+R)}if("string"==typeof _[0])E.message=_[0];else if("object"==typeof _[0]&&1===_.length){var F=_[0];E=g.reflect.extend({},F,E)}}return E};l.exports={sendToServer:function(I,k,_,w){var E=I.topic(),C=y(I,k,_,w),F=null;return E&&C&&(F=h.eventRecorder.recordEvent(E,C)),F}}},{"@amp-metrics/mt-client-logger-core":8,"@amp-metrics/mt-event-queue":12,"@amp-metrics/mt-metricskit-utils-private":21}],21:[function(s,l){l.exports=s("./src")},{"./src":27}],22:[function(s,l){var g={exponential:{maxWait:1500,initialDelay:100,factor:2}},h=function(S,y,A){this.delay=S||g.exponential.initialDelay,this.maxWait="number"==typeof y?y:g.exponential.maxWait,this.factor=A||g.exponential.factor,this.timeWaited=0};h.prototype.nextDelay=function(){var y=null,A=this.maxWait-this.timeWaited;return 0<A&&(this.delay=Math.min(this.delay,A),this.timeWaited+=this.delay),(0===this.maxWait||0<A)&&(y=this.delay,this.delay*=this.factor),y};var P={_backoff:function(y,A,T,I){A.call(A,T,function(){var w=y.nextDelay();w?setTimeout(P._backoff.bind(P,y,A,T,I),w):I.apply(I,arguments)})},exponentialBackoff:function(y,A,T,I,k,_){var w=new h(I,k,_);P._backoff(w,y,A,T)}};l.exports=P},{}],23:[function(s,l){var g=s("./number"),h=s("./reflect"),P={disabled:function(y){return!!this.value("disabled",y)},blacklistedEvents:function(y){var A=this.value("blacklistedEvents",y);return A||[]},blacklistedFields:function(y){var A=this.value("blacklistedFields",y);return A||[]},removeBlacklistedFields:function(y,A){if(y)for(var T=P.blacklistedFields.call(this,A),I=0,k;I<T.length;I++)k=T[I],k&&k in y&&delete y[k];return y},metricsDisabledOrBlacklistedEvent:function(y,A){var T=P.disabled.call(this,A)||!!y&&-1<P.blacklistedEvents.call(this,A).indexOf(y);return T},deResFields:function(y){var A=this.value("deResFields",y);return A||[]},applyDeRes:function(y,A){if(y){var T=P.deResFields.call(this,A),I;T.forEach(function(k){I=k.fieldName,I in y&&(y[I]=g.deResNumber(y[I],k.magnitude,k.significantDigits))})}return y}};l.exports=P},{"./number":30,"./reflect":31}],24:[function(s,l){var g=s("./string.js"),h=s("./reflect.js"),P={EXPIRE_NOW:-1,EXPIRE_SESSION:null,EXPIRE_ONE_SECOND:1,EXPIRE_ONE_MINUTE:60*this.EXPIRE_ONE_SECOND,EXPIRE_ONE_HOUR:60*this.EXPIRE_ONE_MINUTE,EXPIRE_ONE_DAY:24*this.EXPIRE_ONE_HOUR,EXPIRE_ONE_WEEK:7*this.EXPIRE_ONE_DAY,EXPIRE_ONE_MONTH:31*this.EXPIRE_ONE_DAY,EXPIRE_ONE_YEAR:365*this.EXPIRE_ONE_DAY,EXPIRE_ONE_SIDEREAL_YEAR:365.25*this.EXPIRE_ONE_DAY,EXPIRE_SIX_MONTHS:180*this.EXPIRE_ONE_DAY,setDelegate:function(y){return h.attachDelegate(this,y)},cookie:function(){var y;return"undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes?y=iTunes:"undefined"!=typeof itms&&"undefined"!=typeof itms.cookie?y=itms:"undefined"!=typeof document&&(y=document),y?y.cookie:void 0},/**
     * NOTE: This API has been deprecated; callers should instead override cookie() with the actual cookie string
     * TODO: This API should be removed in the next major version update of utils-private.
     *       It is preserved for compatibility with any client that includes utils-private 2.x (e.g. MetricsKit <= 6.0.0)
     * The old API is: environment.cookieOwnerObject (returns a dictionary containing a "cookie" key), replaced by environment.cookie (returns the actual cookie string)
     * When other incompatible changes are made, notify consumers to use the new API; once they have migrated, remove the legacy API.
     * Clients have had since MetricsKit 4.3.0 to update their delegates to use cookie() instead of cookieOwnerObject().
     */cookieOwnerObject:function(){if("undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes)return iTunes;if("undefined"!=typeof itms&&"undefined"!=typeof itms.cookie)return itms;if("undefined"!=typeof document)return document;throw"cookies.cookieOwnerObject: No owning object"},get:function(y){var A=this.getUnescaped(y);return A&&(A=unescape(A)),A},getUnescaped:function(y){var A=null,T=this._getRaw();if(T&&y)for(var I=T.split(";"),k=I.length-1;!A&&0<=k;k--){var _=I[k],w=_.indexOf("=");if(0<w)if(w+1==_.length)A="";else{var E=g.trim(_.substring(0,w));E==y&&(A=g.trim(_.substring(w+1)))}}return A},remove:function(y,A){return this.setUnescaped(y,".",this.EXPIRE_NOW,null,A)},_getRaw:function(){var S=this.cookie();h.isString(S)||(S=this.cookieOwnerObject().cookie);var y=S||"";return y}};l.exports=P},{"./reflect.js":31,"./string.js":34}],25:[function(s,l){var g={},h={},P=function(T){var I={};return"function"==typeof T.mtName&&"function"==typeof T.mtVersion&&(I.name=T.mtName(),I.version=T.mtVersion()),I},S=function(T){var I;return"function"==typeof T.mtName&&"function"==typeof T.mtVersion&&(I=T.mtName()+T.mtVersion()),I};l.exports={storeDelegateInfo:function(T,I){var k=S(T),_=S(I);k&&_&&(!g[_]&&(g[_]=P(I)),!g[k]&&(g[k]=P(T),h[k]={}),g[k].delegates?!h[k][_]&&g[k].delegates.push(g[_]):g[k].delegates=[g[_]],h[k][_]=!0)},getStoredDelegateObject:function(T){return g[S(T)]}}},{}],26:[function(s,l){var g=s("./key_value"),h=s("./reflect");l.exports={mergeAndCleanEventFields:function(){for(var A=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),T=[],I=0,k;I<A.length;I++)if(k=A[I],k&&k.constructor===Array)for(var _=0;_<k.length;_++)T.push(k[_]);else T.push(k);return h.copyKeysAndValues.apply(this,T)},processMetricsData:function(y,A,T,I){var k=this.mergeAndCleanEventFields(I),_=k;if(y&&A){var w={};if(T||(A=A.filter(function(R){return R in k})),A.length)for(var E=0;E<A.length;E++){var C=A[E],F=y[C];"function"==typeof F&&(w[C]=F.call(y,k))}_=this.mergeAndCleanEventFields(_,w)}return _},applyFieldsMap:function(S,y,A,T){var I,k,_;if(!(S&&y&&A)){var F=[];S||F.push("data"),y||F.push("sectionName"),A||F.push("fieldsMap"),_="metrics: missing argument(s): "+F.join(",")+" not provided to applyFieldsMap"}else if(k={},I=g.valueForKeyPath(y,A,A.custom),I){var w,E;if(h.isArray(I))for(w=0;w<I.length;++w)E=S[I[w]],h.isDefinedNonNull(E)&&(k[I[w]]=E);else if("object"==typeof I){for(var C in I)for(w=0;w<I[C].length;++w)if(E=g.valueForKeyPath(I[C][w],S),h.isDefinedNonNull(E)){k[C]=E;break}}else _="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)"}else _="metrics: unable to get "+y+" section from fieldsMap";return _&&h.isFunction(T)&&T(_),k}}},{"./key_value":28,"./reflect":31}],27:[function(s,l){var g={};g.backoff=s("./backoff"),g.config=s("./config"),g.cookies=s("./cookies"),g.delegatesInfo=s("./delegates_info"),g.eventFields=s("./event_fields"),g.keyValue=s("./key_value"),g.network=s("./network"),g.number=s("./number"),g.reflect=s("./reflect"),g.sampling=s("./sampling"),g.storage=s("./storage"),g.string=s("./string"),g.optionValueFromStoreFrontHeader=function(P,S){for(var y=null,A="string"==typeof P?P.split(" "):[],T=g.string.endsWith(S,":")?S:S+":",I=0;!y&&I<A.length;++I)0===A[I].search(T)&&(y=A[I].slice(T.length));return y},l.exports=g},{"./backoff":22,"./config":23,"./cookies":24,"./delegates_info":25,"./event_fields":26,"./key_value":28,"./network":29,"./number":30,"./reflect":31,"./sampling":32,"./storage":33,"./string":34}],28:[function(s,l){l.exports={_valueForKeyPath:function(h,P,S){var y=P;if(h&&P)for(var A=h.split("."),T=0,I;y&&T<A.length;T++)I=A[T],!y[I]&&S&&(y[I]={}),y=y[I]?y[I]:null;return y},valueForKeyPath:function(h){var P=null;if(h&&1<arguments.length)for(var S=this.sourcesArray(Array.prototype.slice.call(arguments,1)),y=S.length-1,A;0<=y&&(A=S[y],P=this._valueForKeyPath(h,A),!P);y--);return P},createObjectAtKeyPath:function(h,P){return this._valueForKeyPath(h,P,!0)},sourcesArray:function(h){var P=[],S=[];S=S.concat(h),arguments&&1<arguments.length&&(S=S.concat(Array.prototype.slice.call(arguments,1)));for(var y=0,A;y<S.length;y++)A=S[y],P=P.concat(A);return P}}},{}],29:[function(s,l){l.exports={makeAjaxGetRequest:function(P,S,y){var A=new XMLHttpRequest;A.onload=function(){200==A.status?S(A.response):y(new Error("XHR error: server responded with status "+A.status+" "+A.statusText))},A.onerror=function(){y(new Error("XHR error"))},A.open("GET",P),A.withCredentials=!0,A.send()}}},{}],30:[function(s,l){var g=s("./reflect");l.exports={deResNumber:function(S,y,A){var T;if(g.isDefined(S))if(g.isDefined(y)||(y=1048576),g.isDefined(A)||(A=2),g.isNumber(S)&&g.isNumber(y)&&0<y&&g.isInteger(A)&&0<=A){var I=Math.pow(10,A),k=0<S?"floor":"ceil";T=Math[k](S/y/I)*I}else T=NaN;return T}}},{"./reflect":31}],31:[function(s,l){var g=s("./delegates_info"),h={setDelegate:!0},P={_utResetNonOverridableFunctions:function(){h={setDelegate:!0}},functionName:function S(){return S.caller.name},shallowClone:function(y){var A={},T=P.hasGetterAndSetterMethods(y),I,k;for(var _ in y)I=null,k=null,T&&(I=y.__lookupGetter__(_),k=y.__lookupSetter__(_)),I||k?(I&&A.__defineGetter__(_,I),k&&A.__defineSetter__(_,k)):A[_]=y[_];return A},isDefined:function(y){return"undefined"!=typeof y},isDefinedNonNull:function(y){return this.isDefined(y)&&null!==y},isDefinedNonNullNonEmpty:function(y){return this.isDefined(y)&&null!==y&&""!==y},isFunction:function(y){return"function"==typeof y},isNumber:function(y){return"number"==typeof y},isInteger:function(y){return P.isNumber(y)&&0==y%1},isString:function(y){return"string"==typeof y||y instanceof String},isElement:function(y){return y&&1==y.nodeType},isArray:function(y){return y&&y.constructor===Array},isObject:function(y){return y&&y.constructor===Object},values:function(y){var S=[];for(var A in y){var T=y[A];y.hasOwnProperty(A)&&!P.isFunction(T)&&S.push(T)}return S},keys:function(y){var S=[];for(var A in y)y.hasOwnProperty(A)&&!P.isFunction(y[A])&&S.push(A);return S},hasAnyKeys:function(y){for(var A in y)if(y.hasOwnProperty(A))return!0},hasAnyNonNullKeys:function(y){for(var A in y)if(y.hasOwnProperty(A)&&y[A])return!0},hasGetterAndSetterMethods:function(y){return P.isObject(y)&&P.isFunction(y.__lookupGetter__)&&P.isFunction(y.__lookupSetter__)&&P.isFunction(y.__defineGetter__)&&P.isFunction(y.__defineSetter__)},methods:function(y){var S=[];for(var A in y){var T=y[A];y.hasOwnProperty(A)&&P.isFunction(T)&&S.push(T)}return S},invert:function(S){var y={};for(var A in S)S.hasOwnProperty(A)&&!P.isFunction(S[A])&&(y[S[A]]=A);return y},extend:function(){var A=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return this.copyKeysAndValues.apply(this,A)},copyKeysAndValues:function(y,A,T,I){for(var k=T?I||{}:{},F=3,_,w,E,C;F<arguments.length;F++)for(var R in _=arguments[F],w=P.hasGetterAndSetterMethods(_),_)if(E=null,C=null,w&&(E=_.__lookupGetter__(R),C=_.__lookupSetter__(R)),E||C)E&&k.__defineGetter__(R,E),C&&k.__defineSetter__(R,C);else if(Object.prototype.hasOwnProperty.call(_,R)){var O=_[R];(y||null!==O&&void 0!==O)&&(A||"function"!=typeof O)&&(k[R]=O)}return k},addNonOverrideableFunctions:function(y){for(var A=0,T;A<y.length;A++)T=y[A],h[T]=!0},attachDelegate:function(y,A){var T=!1;if(y&&A){g.storeDelegateInfo(y,A);var I={};Object.keys(A).forEach(function(k){y[k]||(I[k]=!0)}),P.extend(I,h),T=P.attachMethods(y,A,null,I)}return T},attachMethods:function(y,A,T,I){var k=!1;if(y&&A){I=I||{},T=T||A;var _=function(O,D,x,L){var M=function(){return x[L].apply(O,arguments)};return D&&(M.origFunction=D),M};for(var w in A)if(!(w in I)&&A[w]&&"function"==typeof A[w]){var E=y[w],F=E&&"function"==typeof E?E.bind(y):null;y[w]=_(T,F,A,w),k=!0}}return k},setDelegates:function(y,A){var T={};for(var I in y)A[I]&&P.isFunction(y[I].setDelegate)&&(T[I]=y[I].setDelegate(A[I]));return T}};l.exports=P},{"./delegates_info":25}],32:[function(s,l){var g={},h=function(y){g[y]&&(clearTimeout(g[y]),g[y]=null)},P={_utClearSessions:function(){for(var y in g)h(y)},lottery:function(y){return Math.random()<y},sessionSampled:function(y,A,T){var I;if(g[y])I=!0;else{var k=P.lottery(A);k&&0<T&&(g[y]=setTimeout(h.bind(null,y),T)),I=k}return I},isSampledIn:function(y,A,T,I,k){return A||P.sessionSampled(y,T,I)||P.lottery(k)}};l.exports=P},{}],33:[function(s,l){var g=function(S){var y=null,A=!1;return function(){return S?y=S:(!A&&(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),A=!0),!y&&(y={storage:{},getItem:function(T){return this.storage[T]},setItem:function(T,I){this.storage[T]=I},removeItem:function(T){delete this.storage[T]}})),y}},h={localStorageObject:g("undefined"==typeof localStorage?null:localStorage),sessionStorageObject:g("undefined"==typeof sessionStorage?null:sessionStorage),saveObjectToStorage:function(S,y,A){var T=null;if(A)try{S.setItem(y,JSON.stringify(A)),T=A}catch(I){}else T=S.removeItem(y);return T},objectFromStorage:function(S,y){var A=null,T=S.getItem(y);if(T)try{A=JSON.parse(T)}catch(I){A=void 0}return A}};l.exports=h},{}],34:[function(s,l){var g={startsWith:function(P,S,y){var A=!1;return P&&S&&(P=P.substr(0,S.length),y&&(P=P.toLowerCase(),S=S.toLowerCase()),A=0===P.indexOf(S)),A},endsWith:function(P,S,y){var A=!1;if(P&&S){y&&(P=P.toLowerCase(),S=S.toLowerCase());var T=P.length-S.length;A=0<=T&&P.lastIndexOf(S)===T}return A},trim:function(P,S,y){var A=null,T="\t\n\x0B\f\r \xA0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u3000\u2028\u2029\u200B",I=/^[	\n\v\f\r Â âââââââââââã\u2028\u2029â]+/,k=/[	\n\v\f\r Â âââââââââââã\u2028\u2029â]+$/;if(P)if(!y&&(!S||S==T)&&P.trim)A=P.trim();else{var _=null,w=null,E=null;S&&"undefined"!=typeof S?(S=S.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"),_="["+S+"]",w=new RegExp("^"+_+"+"),E=new RegExp(_+"+$")):(_=T,w=I,E=k);var C=P.replace(w,"");A=C.replace(E,"")}return A},snakeCaseToCamelCase:function(P,S){var y="";if(P)for(var A=P.toLowerCase().split("_"),I=0,T;I<A.length;I++)T=A[I][0],(0!==I||S)&&(T=T.toUpperCase()),y+=T+A[I].slice(1);return y},snakeCaseToUpperCamelCase:function(P){return g.snakeCaseToCamelCase(P,!0)},paramString:function(P){var h="",S="",y=!0;for(var A in P){var T=P[A];(T||0===T||!1===T)&&(h+=S+A+"="+encodeURIComponent(T),y&&(S="&",y=!1))}return h},versionStringFromUserAgent:function(P,S){var y=null;S=S||"\\S+";var A=new RegExp("\\b"+S+"/(\\S+)\\b","i"),T=A.exec(P);return T&&T[1]&&(y=T[1]),y},requestId:function(P){var S="z",y=Date.now(),A=Math.floor(1e5*Math.random());return y=y.toString(36).toUpperCase(),A=A.toString(36).toUpperCase(),P+S+y+S+A},weakUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(P){var S=0|16*Math.random(),y="x"===P?S:8|3&S;return y.toString(16)})}};l.exports=g},{}],35:[function(s,l){var g=s("@amp-metrics/mt-client-config"),h=s("./system/environment"),P=s("./system/logger"),S=s("@amp-metrics/mt-metricskit-utils-private");g.environment.setDelegate(h),g.logger.setDelegate(P),S.reflect.attachMethods(g,S.config,g);var y;l.exports={topic:function(){return y},setTopic:function(I){y=I}}},{"./system/environment":50,"./system/logger":53,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],36:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base");l.exports={setDelegate:function(y){return g.reflect.attachDelegate(this,y)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","type"]},eventType:function(){return"account"},eventVersion:function(){return 1}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],37:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-config"),P=s("../utils"),S=s("../system"),y=S.environment,A=s("../config"),T=s("../../../info"),I={setDelegate:function(_){return g.reflect.attachDelegate(this,_)},metricsData:function(){var E=Array.prototype.slice.call(arguments),C=h.value("metricsBase",A.topic());return C&&E.push(C),I.processMetricsData.apply(I,E)},processMetricsData:function(_,w,E){var C=null,F="function"==typeof this.eventType?this.eventType():null;if(!h.metricsDisabledOrBlacklistedEvent(F,A.topic())){var R=this!==I,O="function"!=typeof this.mtIncludeBaseFields||this.mtIncludeBaseFields(),D=Array.prototype.slice.call(arguments,3);if(R&&O){var x=I.metricsData.apply(I,arguments);D=[x].concat(D)}C=P.eventFields.processMetricsData(this,this.knownFields(),_,w,E,D),R&&(h.removeBlacklistedFields(C,A.topic()),h.applyDeRes(C,A.topic()))}return C},knownFields:function(){return["app","appVersion","baseVersion","capacityData","capacityDataAvailable","capacityDisk","capacitySystem","capacitySystemAvailable","connection","clientId","cookies","dsId","environmentBuild","environmentDataCenter","environmentInstance","eventTime","experimentId","isSignedIn","hostApp","hostAppVersion","osVersion","page","pageContext","pageDetails","pageId","pageType","pageUrl","pixelRatio","resourceRevNum","screenHeight","screenWidth","storeFrontHeader","timezoneOffset","userAgent","userType","windowInnerHeight","windowInnerWidth","windowOuterHeight","windowOuterWidth","xpPostFrequency","xpSendMethod","xpVersionMetricsKit","xpDelegatesInfo"]},app:function(_){return _&&_.app||y.app()},appVersion:function(_){return _&&_.appVersion||y.appVersion()},baseVersion:function(){return 1},capacityData:function(_){return _&&_.capacityData||y.capacityData()},capacityDataAvailable:function(_){return _&&_.capacityDataAvailable||y.capacityDataAvailable()},capacityDisk:function(_){return _&&_.capacityDisk||y.capacityDisk()},capacitySystem:function(_){return _&&_.capacitySystem||y.capacitySystem()},capacitySystemAvailable:function(_){return _&&_.capacitySystemAvailable||y.capacitySystemAvailable()},connection:function(_){return _&&_.connection||y.connectionType()},clientId:function(_){return _&&_.clientId||g.cookies.get("xp_ci")},cookies:function(_){var w=null;if(_.cookies)w=_.cookies;else{var E=h.value("fieldsMap.cookies",A.topic());if(E&&E)for(var C=0;C<E.length;C++){var F=E[C],R=g.cookies.get(F);R&&(!w&&(w={}),w[F]=R)}}return w},dsId:function(_){return _&&_.dsId||y.dsId()},isSignedIn:function(){return!!this.dsId()},eventTime:function(_){return _&&_.eventTime||Date.now()},experimentId:function(_){return _&&_.experimentId||g.optionValueFromStoreFrontHeader(this.storeFrontHeader(_),"ab")},hostApp:function(_){return _&&_.hostApp||y.hostApp()},hostAppVersion:function(_){return _&&_.hostAppVersion||y.hostAppVersion()},osVersion:function(_){return _&&_.osVersion||y.osVersion()},page:function(_){if(_){if(_.page)return _.page;if(this.pageType(_)&&this.pageId(_))return this.pageType(_)+h.value("compoundSeparator",A.topic())+this.pageId(_)}else throw"No data provided to event_handlers/base page function"},pageContext:function(_){return _&&_.pageContext},pageDetails:function(_){return _&&_.pageDetails},pageId:function(_){return _&&_.pageId},pageType:function(_){return _&&_.pageType},pageUrl:function(_){return _&&_.pageUrl||y.pageUrl()},pixelRatio:function(_){return _&&_.pixelRatio||y.pixelRatio()},resourceRevNum:function(_){return _&&_.resourceRevNum||y.resourceRevNum()},screenHeight:function(_){return _&&_.screenHeight||y.screenHeight()},screenWidth:function(_){return _&&_.screenWidth||y.screenWidth()},storeFrontHeader:function(_){return _&&_.storeFrontHeader||y.storeFrontHeader()},timezoneOffset:function(_){return _&&_.timezoneOffset||new Date().getTimezoneOffset()},userAgent:function(_){return _&&_.userAgent||y.userAgent()},userType:function(_){return _&&_.userType||y.userType()},windowInnerHeight:function(_){return _&&_.windowInnerHeight||y.windowInnerHeight()},windowInnerWidth:function(_){return _&&_.windowInnerWidth||y.windowInnerWidth()},windowOuterHeight:function(_){return _&&_.windowOuterHeight||y.windowOuterHeight()},windowOuterWidth:function(_){return _&&_.windowOuterWidth||y.windowOuterWidth()},xpPostFrequency:function(_){return _&&_.xpPostFrequency||h.value("postFrequency",A.topic())},xpViewablePercentage:function(_){return _&&_.xpViewablePercentage||h.value("impressions.viewablePercentage",A.topic())},xpSendMethod:function(_){return _&&_.xpSendMethod||S.eventRecorder.sendMethod()},xpVersionMetricsKit:function(){return T.version},xpDelegatesInfo:function(){var _=g.delegatesInfo.getStoredDelegateObject(this),w=_&&_.delegates;return w?w:void 0}};l.exports=I},{"../../../info":2,"../config":35,"../system":52,"../utils":56,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],38:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base"),P=s("./page"),S=s("../system/environment"),y=s("../system/logger");l.exports={setDelegate:function(I){return g.reflect.attachDelegate(this,I)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion"]},eventType:function(){return"buyConfirmed"},eventVersion:function(){return 1},createClientBuyId:function(){var T=null,I=S.sessionStorageObject().getItem("mtMetricsKit_previousClientBuyId");return T=++I,I||(y.warn("Metrics: buyConfirmed.createClientBuyId: clientBuyId did not exist or was of incorrect type, reset to 1."),T=1),S.sessionStorageObject().setItem("mtMetricsKit_previousClientBuyId",T),T},clientBuyIdQueryParamString:function(T){return"&clientBuyId="+T},metricsBuyParamsString:function(T,I,k,_){var w=P.pageHistory(),E=h.clientId(),C;return Array.isArray(w)?2<=w.length&&(C=w[w.length-2]):y.warn("MetricsKit: metricsBuyParamsString: pageHistory is not an Array"),g.string.paramString({mtApp:h.app(),mtEventTime:Date.now(),mtHostApp:h.hostApp(),mtHostAppVersion:h.hostAppVersion(),mtPageId:T,mtPageType:I,mtPageContext:k,mtTopic:_||"xp_its_main",mtPrevPage:C,mtRequestId:g.string.requestId(E),mtClientId:E})},cacheMetricsBuyData:function(T,I){if(2!=arguments.length)y.error("buyConfirmed.cacheMetricsBuyData(): function invoked with incorrect number of parameters. Perhaps you meant to retrieve cached data instead of setting it, which would be a call to uncacheMetricsBuyData(clientBuyId)?");else{var k=JSON.stringify(I);S.sessionStorageObject().setItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+T,k)}},uncacheMetricsBuyData:function(T){var I=null;if(1!=arguments.length)y.error("buyConfirmed.uncacheMetricsBuyData(): function invoked with incorrect number of parameters. Perhaps you meant to set cached data instead of retrieving it, which would be a call to cacheMetricsBuyData(clientBuyId, metricsBuyData)?");else{var k=S.sessionStorageObject().getItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+T);k&&(I=JSON.parse(k),S.sessionStorageObject().removeItem("mtMetricsKit_metricsBuyData_for_clientBuyId_"+T))}return I},buyFailureOccurred:function(T){var I=this.uncacheMetricsBuyData(T);I&&(I.detoured=!0,this.cacheMetricsBuyData(T,I))}}},{"../system/environment":50,"../system/logger":53,"./base":37,"./page":47,"@amp-metrics/mt-metricskit-utils-private":21}],39:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("../utils"),P=s("./base"),S=s("../system/logger"),y={setDelegate:function(T){return g.reflect.attachDelegate(this,T)},metricsData:function(A,T,I,k){var _=[A,T,I];return k&&(_.push({location:h.eventFields.buildLocationStructure(k)}),_.push(y.dataForElement(k)||{})),_=_.concat(Array.prototype.slice.call(arguments,4)),P.processMetricsData.apply(this,_)},knownFields:function(){return["actionContext","actionDetails","actionType","actionUrl","eventType","eventVersion","impressions","location","targetId","targetType","positionX","positionY","xpViewablePercentage"]},dataForElement:function(T){var I=null;if(T&&g.reflect.isFunction(T.hasAttribute)&&g.reflect.isFunction(T.getAttribute)){var k=y.dataAttribute();if(T.hasAttribute(k))try{I=JSON.parse(T.getAttribute(k))}catch(_){S.error("MetricsKit: error parsing click data - "+_)}}return I},dataAttribute:function(){return"data-metrics-click"},eventType:function(){return"click"},eventVersion:function(){return 4},impressions:function(T){return T?T.impressions:void 0},xpViewablePercentage:function(T){return P.xpViewablePercentage(T)}};l.exports=y},{"../system/logger":53,"../utils":56,"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],40:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base");l.exports={setDelegate:function(y){return g.reflect.attachDelegate(this,y)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["buttons","code","details","message","type","eventType","eventVersion","type"]},eventType:function(){return"dialog"},eventVersion:function(){return 2}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],41:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base"),P=s("../system").environment;l.exports={setDelegate:function(A){return g.reflect.attachDelegate(this,A)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","extRefUrl","osLanguages","refApp","type"]},eventType:function(){return"enter"},eventVersion:function(){return 1},osLanguages:function(A){return A&&A.osLanguages||P.osLanguages()}}},{"../system":52,"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],42:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base");l.exports={setDelegate:function(y){return g.reflect.attachDelegate(this,y)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["destinationUrl","eventType","eventVersion","type"]},eventType:function(){return"exit"},eventVersion:function(){return 1}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],43:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("../utils"),P=s("./base");l.exports={setDelegate:function(A){return g.reflect.attachDelegate(this,A)},metricsData:function(y){var A=[void 0,void 0,void 0,{eventType:y}],T=Array.prototype.slice.call(arguments,1);return A=A.concat(T),P.processMetricsData.apply(this,A)},knownFields:function(){return["eventTime","eventType"]},mtIncludeBaseFields:function(){return!1},eventTime:function(A){return A&&A.eventTime||Date.now()},eventType:function(y){return y&&y.eventType||void 0}}},{"../utils":56,"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],44:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-config"),P=s("../config"),S=s("./base");l.exports={setDelegate:function(T){return g.reflect.attachDelegate(this,T)},metricsData:function(){return S.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","eventVersion","impressions","xpViewablePercentage","xpViewableThreshold"]},eventType:function(){return"impressions"},eventVersion:function(){return 3},impressions:function(T){return T?T.impressions:void 0},xpViewablePercentage:function(T){return S.xpViewablePercentage(T)},xpViewableThreshold:function(T){return T&&T.xpViewableThreshold||h.value("impressions.viewableThreshold",P.topic())}}},{"../config":35,"./base":37,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],45:[function(s,l){var g=s("../utils/delegate_extension"),h={};for(var P in h.account=s("./account"),h.base=s("./base"),h.buyConfirmed=s("./buy_confirmed"),h.click=s("./click"),h.dialog=s("./dialog"),h.enter=s("./enter"),h.exit=s("./exit"),h.flexible=s("./flexible"),h.impressions=s("./impressions"),h.media=s("./media"),h.page=s("./page"),h.search=s("./search"),h)g.attachDelegateInfo(h[P]);l.exports=h},{"../utils/delegate_extension":54,"./account":36,"./base":37,"./buy_confirmed":38,"./click":39,"./dialog":40,"./enter":41,"./exit":42,"./flexible":43,"./impressions":44,"./media":46,"./page":47,"./search":48}],46:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base");l.exports={setDelegate:function(y){return g.reflect.attachDelegate(this,y)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["eventType","id","idType","type","typeDetails","actionType","actionDetails","url","duration","position"]},eventType:function(){return"media"},eventVersion:function(){return 1}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],47:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base"),P=[];l.exports={setDelegate:function(A){return g.reflect.attachDelegate(this,A)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["clientCorrelationKey","eventType","eventVersion","extRefUrl","hostApp","refApp","refUrl","requestStartTime","responseStartTime","responseEndTime","pageHistory","pageLoadTime","pageRenderTime","searchFilters","searchTerm"]},clientCorrelationKey:function(A){return A&&A.clientCorrelationKey||g.string.weakUUID()},eventType:function(){return"page"},eventVersion:function(){return 1},pageHistory:function(A){var T;if(A=A||{},A.pageHistory)T=A.pageHistory;else{T=P.slice(0);var I=A.page;I&&(5<=P.length&&P.shift(),P.push(I))}return T}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],48:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./base");l.exports={setDelegate:function(y){return g.reflect.attachDelegate(this,y)},metricsData:function(){return h.processMetricsData.apply(this,arguments)},knownFields:function(){return["actionDetails","actionType","actionUrl","eventType","eventVersion","filters","location","targetId","targetType","term"]},eventType:function(){return"search"},eventVersion:function(){return 2}}},{"./base":37,"@amp-metrics/mt-metricskit-utils-private":21}],49:[function(s,l){var g=s("@amp-metrics/mt-client-config"),h=s("@amp-metrics/mt-metricskit-utils-private"),P=s("./utils"),S=s("./system"),y=s("./config"),A=s("./event_handlers"),T=s("./utils/delegate_extension"),k=function(){h.reflect.attachMethods(_.config,h.config,_.config),T.attachDelegateInfo(_.config)},_={_utSetInitCalled:function(E){I=E},system:S,config:g.defaultConfig(),eventHandlers:A,utils:P,init:function(E,C,F,R,O){I||(I=!0,F&&(h.reflect.setDelegates(A,F),h.reflect.setDelegates(S,F)),y.setTopic(E),_.config=g.createConfig(E,C,R,O),k(),_.system.configSources=_.config)}},I;k(),l.exports=_},{"./config":35,"./event_handlers":45,"./system":52,"./utils":56,"./utils/delegate_extension":54,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],50:[function(s,l){var g=s("./logger"),h=s("@amp-metrics/mt-metricskit-utils-private"),P=["The function metrics.system.environment.","placeholder","() must be overridden with a platform-specific delegate function. If you have no data for this field, have your delegate return null or undefined (no 'return')"],S={setDelegate:function(A){return h.cookies.setDelegate(A),h.reflect.attachDelegate(this,A)},app:function(){throw P[1]=h.reflect.functionName(),P.join("")},appVersion:function(){throw P[1]=h.reflect.functionName(),P.join("")},capacityData:function(){throw P[1]=h.reflect.functionName(),P.join("")},capacityDataAvailable:function(){throw P[1]=h.reflect.functionName(),P.join("")},capacityDisk:function(){throw P[1]=h.reflect.functionName(),P.join("")},capacitySystem:function(){throw P[1]=h.reflect.functionName(),P.join("")},capacitySystemAvailable:function(){throw P[1]=h.reflect.functionName(),P.join("")},connectionType:function(){throw P[1]=h.reflect.functionName(),P.join("")},cookieOwnerObject:function(){throw P[1]=h.reflect.functionName(),P.join("")},dsId:function(){throw P[1]=h.reflect.functionName(),P.join("")},environmentBuild:function(){},environmentDataCenter:function(){},environmentInstance:function(){},hostApp:function(){throw P[1]=h.reflect.functionName(),P.join("")},hostAppVersion:function(){},osLanguages:function(){},osVersion:function(){throw P[1]=h.reflect.functionName(),P.join("")},pageUrl:function(){throw P[1]=h.reflect.functionName(),P.join("")},pixelRatio:function(){throw P[1]=h.reflect.functionName(),P.join("")},resourceRevNum:function(){throw P[1]=h.reflect.functionName(),P.join("")},screenHeight:function(){throw P[1]=h.reflect.functionName(),P.join("")},screenWidth:function(){throw P[1]=h.reflect.functionName(),P.join("")},storeFrontHeader:function(){throw P[1]=h.reflect.functionName(),P.join("")},userAgent:function(){throw P[1]=h.reflect.functionName(),P.join("")},userType:function(){throw P[1]=h.reflect.functionName(),P.join("")},windowInnerHeight:function(){throw P[1]=h.reflect.functionName(),P.join("")},windowInnerWidth:function(){throw P[1]=h.reflect.functionName(),P.join("")},windowOuterHeight:function(){throw P[1]=h.reflect.functionName(),P.join("")},windowOuterWidth:function(){throw P[1]=h.reflect.functionName(),P.join("")},localStorageObject:h.storage.localStorageObject,sessionStorageObject:h.storage.sessionStorageObject};l.exports=S},{"./logger":53,"@amp-metrics/mt-metricskit-utils-private":21}],51:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("./logger"),P=["The function metrics.system.eventRecorder.","placeholder","() must be overridden with a platform-specific delegate function. If you have no data for this field, have your delegate return null or undefined (no 'return')"];l.exports={setDelegate:function(A){return g.reflect.attachDelegate(this,A)},recordEvent:function(){throw P[1]=g.reflect.functionName(),P.join("")},sendMethod:function(){throw P[1]=g.reflect.functionName(),P.join("")},flushUnreportedEvents:function(){}}},{"./logger":53,"@amp-metrics/mt-metricskit-utils-private":21}],52:[function(s,l){var g=s("../utils/delegate_extension"),h=s("@amp-metrics/mt-client-config"),P={};for(var S in P.configSources=h.defaultConfig(),P.environment=s("./environment"),P.eventRecorder=s("./event_recorder"),P.logger=s("./logger"),P)g.attachDelegateInfo(P[S]);l.exports=P},{"../utils/delegate_extension":54,"./environment":50,"./event_recorder":51,"./logger":53,"@amp-metrics/mt-client-config":3}],53:[function(s,l){var g=s("@amp-metrics/mt-loggerkit"),h=g.loggerNamed("mt-metricskit");l.exports=h},{"@amp-metrics/mt-loggerkit":17}],54:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("../../../info"),P={mtName:function(){return h.name},mtVersion:function(){return h.version}};l.exports={attachDelegateInfo:function(y){g.reflect.extend(y,P)}}},{"../../../info":2,"@amp-metrics/mt-metricskit-utils-private":21}],55:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h=s("@amp-metrics/mt-client-config"),P=s("../config"),S=s("../system/logger"),y=function(T){var I={},k=[],_;if(T&&T[0]&&T[0].index!==void 0)for(var w=0;w<T.length;++w)_=T[w].index,I[_]||(I[_]=!0,k.push(T[w]));return k};l.exports={getIdType:function(T){var k=T.indexOf("."),_=h.value("compoundSeparator",P.topic()),w=-1===k?"its":T.substring(0,k);return w+_+"id"},processMetricsData:function(T,I,k,_,w,E){var C=[{pageId:k,pageType:_,pageContext:w}];return g.reflect.isArray(E)&&(C=C.concat(E)),g.eventFields.processMetricsData(T,I,!0,C)},applyFieldsMap:function(T,I){var k,_,w;if(!(T&&I))T||S.error("mt-metricskit: No data provided to applyFieldsMap"),I||S.error("mt-metricskit: No sectionName provided to applyFieldsMap");else if(w={},k=h.value("fieldsMap",P.topic())||{},_=g.keyValue.valueForKeyPath(I,k,k.custom),_){var E;if(Array.isArray(_))for(E=0;E<_.length;++E)T[_[E]]&&(w[_[E]]=T[_[E]]);else if("object"==typeof _)for(var C in _)for(E=0;E<_[C].length;++E){var F=g.keyValue.valueForKeyPath(_[C][E],T);if(F){w[C]=F;break}}else S.error("mt-metricskit: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)")}else S.error("mt-metricskit: unable to get fieldsMap from config-source");return w},flattenImpressions:function(T,I){var k=[],F=I||1,_,w,E,C;if(T){T=y(T);for(var R=0;R<T.length;R++){if(_=T[R],"string"==typeof _.data)try{w=JSON.parse(_.data)}catch(O){C=decodeURIComponent(_.data);try{w=JSON.parse(C)}catch(D){S.error("mt-metricskit: non-JSON serialized data found on impression object. Cannot parse.",O)}}else w=_;w&&(w.impressionTimes=_.timestamps,w.impressionIndex=_.index,w.id&&!w.idType&&("genre"===_.kind?w.idType="label"+h.value("compoundSeparator",P.topic())+"id":w.idType=this.getIdType(w.id.toString())),_.parent&&void 0!==_.parent.impressionId&&(w.impressionParentId=_.parent.impressionId),w.impressionId=F,_.impressionId=F,++F,k.push(w),0<g.keyValue.valueForKeyPath("children.length",_)&&(E=this.flattenImpressions(_.children,F),k=k.concat(E),F+=E.length))}}else S.warn("Fuse-Metrics: No impressions provided to to flattenImpressions");return k},buildLocationStructure:function(T){for(var I=T,w=[],k,E,C,F,O,D;I;){if(E={},D=0,k=I.parentNode,I.hasAttribute&&I.hasAttribute("data-metrics-location")&&(E=JSON.parse(I.getAttribute("data-metrics-location")),E.locationType)){if(k){C=k.childNodes;for(var x=0;x<C.length;x++)if(F="function"==typeof C.item&&C.item(x)||C[x],O=F.hasAttribute&&F.hasAttribute("data-metrics-location")?JSON.parse(F.getAttribute("data-metrics-location")).locationType:void 0,O)if(F===I)break;else D++}E.locationPosition=D,w.push(E)}I=k}return w}}},{"../config":35,"../system/logger":53,"@amp-metrics/mt-client-config":3,"@amp-metrics/mt-metricskit-utils-private":21}],56:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private"),h={};h.delegateExtension=s("./delegate_extension"),h.eventFields=s("./event_fields"),h.keyValue=g.keyValue,h.reflect=s("./reflect"),h.string=s("./string"),l.exports=h},{"./delegate_extension":54,"./event_fields":55,"./reflect":57,"./string":58,"@amp-metrics/mt-metricskit-utils-private":21}],57:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private");l.exports={attachDelegate:function(S,y){return g.reflect.attachDelegate(S,y)},extend:function(){return g.reflect.extend.apply(g.reflect,arguments)}}},{"@amp-metrics/mt-metricskit-utils-private":21}],58:[function(s,l){var g=s("@amp-metrics/mt-metricskit-utils-private");l.exports={versionStringFromUserAgent:function(S,y){return g.string.versionStringFromUserAgent(S,y)}}},{"@amp-metrics/mt-metricskit-utils-private":21}],59:[function(s,l){l.exports=function(h,P){return s("./util").its.loc(h,P)},"undefined"!=typeof Handlebars&&Handlebars.registerHelper("loc",helper)},{"./util":64}],60:[function(s,l){l.exports=s("./its"),l.exports.hbsHelper=s("./hbs-helper")},{"./hbs-helper":59,"./its":61}],61:[function(s,l){l.exports.its={},s("./util")(l.exports),s("./loc")(l.exports)},{"./loc":62,"./util":63}],62:[function(s,l){l.exports=function(g){var h=g.its,P=g.iTSLocalization={};P._strings={},P.hasLocalizedValue=function(y){var A=P._strings[y];return h.isDefined(A)},P.isLocalized=function(y){var A=P._strings[y];return!!h.isDefined(A)&&(-1===y.indexOf(".")||(A===y||0===A.indexOf("**")&&A.lastIndexOf("**")===A.length-2?(console.error("unlocalized key in keys dictionary",y),!1):!0))},h.loc=function(S,y){var A=P._strings[S];return"undefined"==typeof A&&(A=S),y&&(A=P.replaceTokens(A,y)),"undefined"==typeof itms&&(A=P.replaceMarkupTokens(A,y)),A},h.locDate=function(S){// So if anIso8601Date does not specify a time, assume that we want to preserve the date
if(!S)return"";var y=S.length,A;if(10<y)A=new Date(S);else{var T=4<=y?S.slice(0,4):0,I=7<=y?S.slice(5,7):1,k=10<=y?S.slice(8,10):1;A=new Date(T,I-1,k)}return formatDate(A)},h.locWithMarkupTokens=function(S,y){return P.replaceMarkupTokens(h.loc(S,y),y)},P._strings._showLocKeys&&(h.loc=function(S){return"+"+S+"+"}),h.locWithCount=function(S,y,A){var T=null,I,k;return 0==y&&(I=S+".zero",P.isLocalized(I)&&(T=I)),null===T&&(T=S,k=P.pluralCategory(y),"other"!==k&&(I=S+"."+k,P.isLocalized(I)&&(T=I))),A||(A={}),h.isDefined(A.count)||(A.count=h.formatNumber(y)),h.isDefined(A.number)||(A.number=h.formatNumber(y)),h.loc(T,A)},P.replaceTokens=function(y,A){if(A)for(var T in A)if(A.hasOwnProperty(T)){y=h.string.replace(y,"@@"+T+"@@",A[T])}return y},P.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"\xA9"},P.replaceMarkupTokens=function(y,A){if(-1<y.indexOf("##")){if(A)for(var T in A)P.markupParams[T.toString()]=A[T];for(var I in P.markupParams){y=y.replace(new RegExp("##"+I+"##","gi"),P.markupParams[I])}y=y.replace(/##([^##]+)##/gi,"<$1>")}return y},P.localizedResourceUrlForPathKey=function(y,A){A===void 0&&(A=/https:/.test(window.location.protocol));var T=A?"https://s.mzstatic.com":"http://r.mzstatic.com";return T+h.loc(y)},h.formatNumber="undefined"!=typeof itms&&"undefined"!=typeof formatNumber?function(S){return formatNumber(+S)}:function(S){if("undefined"==typeof P.decimalSeparator){var y=P._strings._decimalSeparator;"undefined"==typeof y&&(y="."),P.decimalSeparator=y,y=P._strings._thousandsSeparator,"undefined"==typeof y&&(y=","),P.thousandsSeparator=y}for(var A=parseFloat(S).toString().split("."),T=P.thousandsSeparator,I=A[0].split(""),k=I.length-3;0<k;k-=3)I.splice(k,0,T);A[0]=I.join("");var _=A.join(P.decimalSeparator);return _},P._pluralCategoryDefault=function(){return"other"},P._pluralCategoryOne=function(S){return 1==S?"one":"other"},P._pluralCategoryArabic=function(S){var y=S>>0;if(y!=S)return"other";if(0==y)return"zero";if(1==y)return"one";if(2==y)return"two";var A=y%100;return 11<=A?"many":3<=A?"few":"other"},P._pluralCategoryFrench=function(S){return 2>S&&0<=S?"one":"other"},P._pluralCategoryHebrew=function(S){var y=S>>0;if(y!=S)return"other";if(1==y)return"one";if(2==y)return"two";return 0==y%10&&10<y?"many":"other"},P._pluralCategoryPolish=function(S){var y=S>>0;if(y!=S)return"other";if(1==y)return"one";var A=y%10;if(4>=A&&2<=A){var T=y%100;if(14<T||12>T)return"few"}return"many"},P._pluralCategoryRomanian=function(S){var y=S>>0;if(y!=S)return"few";if(0==y)return"few";if(1==y)return"one";var A=S%100;return 19>=A&&1<=A?"few":"other"},P._pluralCategoryRussian=function(S){var y=S>>0;if(y!=S)return"other";var A=y%10;if(5<=A||0==A)return"many";var T=y%100;return 14>=T&&11<=T?"many":1==A?"one":"few"},P._pluralCategoryFnByLanguage={zh:P._pluralCategoryDefault,id:P._pluralCategoryDefault,ja:P._pluralCategoryDefault,ko:P._pluralCategoryDefault,ms:P._pluralCategoryDefault,th:P._pluralCategoryDefault,vi:P._pluralCategoryDefault,en:P._pluralCategoryOne,ca:P._pluralCategoryOne,da:P._pluralCategoryOne,nl:P._pluralCategoryOne,de:P._pluralCategoryOne,el:P._pluralCategoryOne,fi:P._pluralCategoryOne,hu:P._pluralCategoryOne,it:P._pluralCategoryOne,nb:P._pluralCategoryOne,no:P._pluralCategoryOne,pt:P._pluralCategoryOne,es:P._pluralCategoryOne,sv:P._pluralCategoryOne,tr:P._pluralCategoryOne,ar:P._pluralCategoryArabic,fr:P._pluralCategoryFrench,iw:P._pluralCategoryHebrew,pl:P._pluralCategoryPolish,ro:P._pluralCategoryRomanian,ru:P._pluralCategoryRussian},P.pluralCategory=function(S){var y;if(h.serverData&&h.serverData.constants)y=h.serverData.constants.languageCode;else if("undefined"!=typeof itms&&itms.getBag){var A=itms.getBag();y=A&&A.language||"en",y=y.slice(0,2)}var T=P._pluralCategoryFnByLanguage[y];return T?T(S):(console.warn("missing plural category function for: "+y),"other")},h.updateLocale=function(y){P._strings=y}}},{}],63:[function(s,l){l.exports=function(g){var h=g.its;h.isDefined=function(S){return"undefined"!=typeof S},"undefined"==typeof h.string&&(h.string={}),h.string.replace=function(P,S,y){return P?("string"!=typeof P&&(P+=""),P.split(S).join(y)):P}}},{}],64:[function(){window.iTSLocalization||(iTSLocalization={}),window.iTSLocalization._strings||(iTSLocalization._strings={}),iTSLocalization.hasLocalizedValue=function(h){var P=iTSLocalization._strings[h];return its.isDefined(P)},its.loc=function(g,h){var P=iTSLocalization._strings[g];return"undefined"==typeof P&&(P=g),h&&(P=iTSLocalization.replaceTokens(P,h)),"undefined"==typeof itms&&(P=iTSLocalization.replaceMarkupTokens(P,h)),P},its.locDate=function(g){// So if anIso8601Date does not specify a time, assume that we want to preserve the date
if(!g)return"";var h=g.length,P;if(10<h)P=new Date(g);else{var S=4<=h?g.slice(0,4):0,y=7<=h?g.slice(5,7):1,A=10<=h?g.slice(8,10):1;P=new Date(S,y-1,A)}return formatDate(P)},its.locWithMarkupTokens=function(g,h){return iTSLocalization.replaceMarkupTokens(its.loc(g,h),h)},iTSLocalization._strings._showLocKeys&&(its.loc=function(g){return"+"+g+"+"}),its.locWithCount=function(g,h,P){var S=null,y,A;return 0==h&&(y=g+".zero",iTSLocalization.hasLocalizedValue(y)&&(S=y)),null===S&&(S=g,A=iTSLocalization.pluralCategory(h),"other"!==A&&(y=g+"."+A,iTSLocalization.hasLocalizedValue(y)&&(S=y))),P||(P={}),its.isDefined(P.count)||(P.count=its.formatNumber(h)),its.loc(S,P)},iTSLocalization.replaceTokens=function(h,P){if(P)for(var S in P)if(P.hasOwnProperty(S)){h=its.string.replace(h,"@@"+S+"@@",P[S])}return h},iTSLocalization.markupParams={nbsp:"&nbsp;",gt:"&gt;",lt:"&lt;",copy:"\xA9"},iTSLocalization.replaceMarkupTokens=function(h,P){if(-1<h.indexOf("##")){if(P)for(var S in P)iTSLocalization.markupParams[S.toString()]=P[S];for(var y in iTSLocalization.markupParams){h=h.replace(new RegExp("##"+y+"##","gi"),iTSLocalization.markupParams[y])}h=h.replace(/##([^##]+)##/gi,"<$1>")}return h},iTSLocalization.localizedResourceUrlForPathKey=function(h,P){P===void 0&&(P=/https:/.test(window.location.protocol));var S=P?"https://s.mzstatic.com":"http://r.mzstatic.com";return S+its.loc(h)},its.formatNumber="undefined"!=typeof itms&&"undefined"!=typeof formatNumber?function(g){return formatNumber(+g)}:function(g){if("undefined"==typeof iTSLocalization.decimalSeparator){var h=iTSLocalization._strings._decimalSeparator;"undefined"==typeof h&&(h="."),iTSLocalization.decimalSeparator=h,h=iTSLocalization._strings._thousandsSeparator,"undefined"==typeof h&&(h=","),iTSLocalization.thousandsSeparator=h}for(var P=parseFloat(g).toString().split("."),S=iTSLocalization.thousandsSeparator,y=P[0].split(""),A=y.length-3;0<A;A-=3)y.splice(A,0,S);P[0]=y.join("");var T=P.join(iTSLocalization.decimalSeparator);return T},iTSLocalization._pluralCategoryDefault=function(){return"other"},iTSLocalization._pluralCategoryOne=function(g){return 1==g?"one":"other"},iTSLocalization._pluralCategoryArabic=function(g){var h=g>>0;if(h!=g)return"other";if(0==h)return"zero";if(1==h)return"one";if(2==h)return"two";var P=h%100;return 11<=P?"many":3<=P?"few":"other"},iTSLocalization._pluralCategoryFrench=function(g){return 2>g&&0<=g?"one":"other"},iTSLocalization._pluralCategoryHebrew=function(g){var h=g>>0;if(h!=g)return"other";if(1==h)return"one";if(2==h)return"two";return 0==h%10&&10<h?"many":"other"},iTSLocalization._pluralCategoryPolish=function(g){var h=g>>0;if(h!=g)return"other";if(1==h)return"one";var P=h%10;if(4>=P&&2<=P){var S=h%100;if(14<S||12>S)return"few"}return"many"},iTSLocalization._pluralCategoryRomanian=function(g){var h=g>>0;if(h!=g)return"few";if(0==h)return"few";if(1==h)return"one";var P=g%100;return 19>=P&&1<=P?"few":"other"},iTSLocalization._pluralCategoryRussian=function(g){var h=g>>0;if(h!=g)return"other";var P=h%10;if(5<=P||0==P)return"many";var S=h%100;return 14>=S&&11<=S?"many":1==P?"one":"few"},iTSLocalization._pluralCategoryFnByLanguage={zh:iTSLocalization._pluralCategoryDefault,id:iTSLocalization._pluralCategoryDefault,ja:iTSLocalization._pluralCategoryDefault,ko:iTSLocalization._pluralCategoryDefault,ms:iTSLocalization._pluralCategoryDefault,th:iTSLocalization._pluralCategoryDefault,vi:iTSLocalization._pluralCategoryDefault,en:iTSLocalization._pluralCategoryOne,ca:iTSLocalization._pluralCategoryOne,da:iTSLocalization._pluralCategoryOne,nl:iTSLocalization._pluralCategoryOne,de:iTSLocalization._pluralCategoryOne,el:iTSLocalization._pluralCategoryOne,fi:iTSLocalization._pluralCategoryOne,hu:iTSLocalization._pluralCategoryOne,it:iTSLocalization._pluralCategoryOne,nb:iTSLocalization._pluralCategoryOne,no:iTSLocalization._pluralCategoryOne,pt:iTSLocalization._pluralCategoryOne,es:iTSLocalization._pluralCategoryOne,sv:iTSLocalization._pluralCategoryOne,tr:iTSLocalization._pluralCategoryOne,ar:iTSLocalization._pluralCategoryArabic,fr:iTSLocalization._pluralCategoryFrench,iw:iTSLocalization._pluralCategoryHebrew,pl:iTSLocalization._pluralCategoryPolish,ro:iTSLocalization._pluralCategoryRomanian,ru:iTSLocalization._pluralCategoryRussian},iTSLocalization.pluralCategory=function(g){if(its.serverData&&its.serverData.constants){var h=iTSLocalization._pluralCategoryFnByLanguage[its.serverData.constants.languageCode];if(h)return h(g);if(its.Logger){var P=its.Logger.named("its-base-util");P.error("missing plural category function for: "+its.serverData.constants.languageCode,!0)}}return"other"}},{}],65:[function(s,l,d){(function(g){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("./builders/search"),P=s("./builders/product-pages"),S=s("./builders/top-charts"),y=s("./builders/pagination"),A=s("./wrappers/store"),T=s("./wrappers/bag"),I=s("./routing/routing"),k=s("./models"),_=s("./metrics"),w=s("./metrics/helpers"),E=s("./builders/static_pages"),C=s("./bootstrap"),F=s("./builders/content"),R=s("./data/server-data"),O=s("./builders/lockups"),D=s("./util/localization"),x=s("./builders/mso"),L=s("./builders/onboarding-cards"),M=s("./builders/offers"),N=s("./basic-crypto");s("./promise+piping");const U=s("./wrappers/client");g.StoreDataProvider={fetchSearchHints(B,V){C.load(V,()=>{const z=h.assembleUrl(T.default.searchUrl,B,{}),j=A.fetchPlist(h.assembleUrl(T.default.searchHintsUrl,B,{}),{isStoreRequest:!0}).then(H=>h.searchHintsFromApiResponse(B,z,H));j.pipeInto(V)})},fetchTrendingSearches(B){C.load(B,()=>{const V=A.fetchJson(T.default.trendingSearchesUrl,{isStoreRequest:!0}).then(z=>h.trendingSearchesFromApiResponse(z));V.pipeInto(B)})},fetchSearchResultsWithUrl(B,V,z,j,H){const q=new h.SearchAdData(j,N.makeUUID());C.load(H,()=>{if(U.isOperatingSystemAtLeast(11,3,0)&&!R.isNull(B)&&B.length){_.recorder.postEvent({eventType:"search",term:B,targetType:"button",actionType:"submit",pageContext:"Search"})}const G={},W={isStoreRequest:!0};q.validAdRequest()&&(G["X-Apple-App-Store-Client-Request-Id"]=q.appStoreClientRequestId,T.default.usePostForAppStoreSearch?(W.method="POST",W.requestBodyString="X-Apple-iAd-Request-Data="+encodeURIComponent(q.targetingData),G["Content-Type"]="application/x-www-form-urlencoded"):G["X-Apple-iAd-Request-Data"]=q.targetingData),W.headers=G;const Y=R.isNull(V)?h.assembleUrl(T.default.searchUrl,B,z):h.assembleUrl(V,null,z);A.fetchJson(Y,W).then(K=>{return h.responseWithPrewarmData(K)}).then(K=>{const Q=h.resultsFromApiResponse(K,z,q,B,Y);Q.pipeInto(H)})})},fetchSearchResults(B,V,z,j){g.StoreDataProvider.fetchSearchResultsWithUrl(B,null,V,z,j)},fetchMoreSearchResults(B,V){C.load(V,()=>{const z=h.searchTokenFromJSONString(B),j=h.getResultsForLookup(z),H=j.map(G=>G.id);if(0===H.length)return void V.resolveToValue(JSON.stringify(h.emptyResults()));const q=A.fetchStorePlatformData(H,{p:z.profile}).then(G=>{const W=h.nextSearchToken(z);return h.resultsFromLookupResponse(G,j,W)});q.pipeInto(V)})},fetchPage(B,V){C.load(V,()=>{const z=I.fetchPage(B);z.pipeInto(V)})},fetchMoreOfPage(B,V){C.load(V,()=>{const z=I.fetchMoreOfPage(B);z.pipeInto(V)})},fetchShelf(B,V){C.load(V,()=>{const z=I.fetchShelf(B);z.pipeInto(V)})},fetchShelves(B,V){C.load(V,()=>{const z=I.fetchShelves(B);z.pipeInto(V)})},fetchProductPage(B,V){C.load(V,()=>{const z=I.fetchPage(B);if(z)z.pipeInto(V);else{const j=P.productPageFromUrl(B);j.pipeInto(V)}})},fetchTVProductMedia(B,V){C.load(V,()=>{A.fetchStorePlatformData([B],{p:"screenshots-by-type",platform:"atv9"}).then(H=>{const q=H[B];if(!R.isNull(q)){const G=F.bestScreenshotData("tv",q.screenshotsByType),W=[];for(const K of G.artwork){const Q=new k.ProductMediaItem;Q.screenshot=K,W.push(Q)}const Y=new k.ProductMedia(W,G.mediaPlatform);return Y.appPlatform=G.mediaPlatform.appPlatform,Y}const G=new k.MediaPlatform("tv"),W=new k.ProductMedia([],G);return W.appPlatform=G.appPlatform,W}).pipeInto(V)})},fetchTVScreenshots(B,V){C.load(V,()=>{A.fetchStorePlatformData([B],{p:"screenshots-by-type",platform:"atv9"}).then(H=>F.bestScreenshotData("tv",H[B].screenshotsByType)).pipeInto(V)})},fetchInstallPage(B,V){C.load(V,()=>{const z=I.fetchPage(B);z.pipeInto(V)})},fetchInstallPageAction(B,V,z){C.load(z,()=>{const j=new Promise(H=>{const G=new k.FlowAction("inAppPurchaseInstall"),W=D.string("INSTALL_PAGE_BANNER_MESSAGE");G.pageUrl=O.configureIAPInstallPageUrl(B,V,W),H(G)});j.pipeInto(z)})},fetchAction(B,V,z){C.load(z,()=>{const j=I.fetchAction(B).then(H=>{if(!H)throw new Error(`Promise resolved to null action for: ${B}`);switch(H.actionClass){case"FlowAction":const q=H;"finance"===q.page||"article"===q.page?q.presentationContext="infer":V?q.presentationContext="push":(q.presentationContext="replace",q.animationBehavior="never");break;default:}return H});j.pipeInto(z)})},fetchTopCharts(B,V){C.load(V,()=>{A.fetchJson(B,{isStoreRequest:!0}).then(z=>S.topChartsPageFromApiResponse(z)).pipeInto(V)})},fetchMoreOfTopChartSegment(B,V){C.load(V,()=>{const z=y.getIdsForLookup(B);return 0===z.length?void V.resolveToValue(JSON.stringify(S.emptySegment())):void A.fetchStorePlatformData(z,{p:B.profile}).then(j=>{const H=y.nextPageToken(B);return S.topChartSegmentFromLookupResponse(j,B,H)}).pipeInto(V)})},postMetricsEvent(B,V){C.load(V,()=>{_.recorder.postEvent(B);const z=JSON.stringify({result:!0});V.resolveToValue(z)})},purchase(B,V){C.load(V,()=>{let z=R.traverse(B,"token.buyParams");const j=R.traverse(B,"overrideBuyParams");R.isNull(j)||(z=j),z=w.addMetricsToBuyParams(z,R.traverse(B,"token.pageInformation"),R.asBooleanOrFalse(B,"token.excludeAttribution"),R.traverse(B,"metrics"));const H=R.traverse(B,"token.appPlatforms"),q=H&&H.length&&1===H.length&&0===H.indexOf("tv"),G=R.asBooleanOrFalse(B,"token.isPreorder");let W=!0;(q||G)&&(W=!1);const Y={adamId:R.asString(B,"adamId"),buyParams:z,vendor:R.asString(B,"token.vendor"),appName:R.asString(B,"token.appName"),bundleId:R.asString(B,"token.bundleId"),appPlatforms:H,additionalHeaders:R.traverse(B,"token.additionalHeaders"),isUpdate:R.asBooleanOrFalse(B,"token.isUpdate"),isRedownload:R.asBooleanOrFalse(B,"isRedownload"),isPreorder:G,createsJobs:W},K=A.makePurchase(Y);K.then(function(){_.recorder.flush()}),K.pipeInto(V)})},fetchTodayPageWithOnboardingCards(B,V,z){C.load(z,()=>{if("x-as3-internal:/today/test"===B)z.resolveToValue(JSON.stringify(E.testTodayPage()));else{const j=L.assemblePageUrlWithOnboardingCardIds(B,V),H=I.fetchPage(j);H.pipeInto(z)}})},fetchTodayPage(B,V){g.StoreDataProvider.fetchTodayPageWithOnboardingCards(B,[],V)},fetchMoreOfTodayPage(B,V){C.load(V,()=>{V.resolveToError(new Error(`No endpoint for ${B}`))})},fetchArticlePage(B,V){C.load(V,()=>{const z=I.fetchPage(B);z.pipeInto(V)})},fetchIconArtwork(B,V){C.load(V,()=>{A.fetchStorePlatformData(B,{p:"artwork"}).then(z=>{const j={};for(const H of Object.keys(z)){const q=z[H];null!=q&&(j[H]=F.artworkFromApiArtwork(q.artwork))}return j}).pipeInto(V)})},fetchMSOProviderData(B,V){C.load(V,()=>{A.fetchStorePlatformData([B],{p:"product-dv"}).then(z=>x.msoProviderDataFromPlatformData(z[B])).pipeInto(V)})},fetchMSOPage(B,V,z,j){const H=R.isNull(V)||R.isNull(z);C.load(j,()=>{if(H){const q=I.fetchPage(B);q.pipeInto(j)}else{const q=x.assembleMSOAppsUrl(V);A.fetchJson(q,{isStoreRequest:!0}).then(G=>x.msoAppsFromResponse(G)).then(G=>{const W=x.availableAdamIdsFromAppsResponse(G,z);return x.assembleMSOPageUrl(B,W)}).then(G=>I.fetchPage(G)).pipeInto(j)}})},fetchRemotePersonalizationResult(B,V){C.load(V,()=>{const z=B.length;if(!z)return new k.RemotePersonalizationResult([]);const H=`lockup=${B.join(",")}`;let G=T.default.buyButtonMetadataUrl;G||(G="https://se.itunes.apple.com/WebObjects/MZStoreElements.woa/wa/buyButtonMetaData"),A.fetchJson(G,{isStoreRequest:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",requestBodyString:H}).then(W=>{const Y=[];for(const K of B){const Q=W[K];if(Q){const J=M.personalizedOfferTypeFromBuyButtonMetadata(Q);"purchased"===J&&Y.push(K)}}return new k.RemotePersonalizationResult(Y)}).pipeInto(V)})},fetchPersonalizedOfferContext(B,V){C.load(V,()=>{const z=B;if(!z)return void V.resolveToError(new Error("Invalid offerToken for personalized offer fetch."));const j=z.adamId;let W=T.default.buyButtonMetadataUrl;W||(W="https://se.itunes.apple.com/WebObjects/MZStoreElements.woa/wa/buyButtonMetaData"),A.fetchJson(W,{isStoreRequest:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",requestBodyString:"product-dv="+j}).then(Y=>{const K=Y[j];let Q=null,J=null;const X=M.personalizedOfferTypeFromBuyButtonMetadata(K);if(X&&"none"!==X){let Z="colored",$=null;switch(X){case"purchased":Z="disabled",$=D.string("BUNDLE_OFFER_BUTTON_TITLE_PURCHASED");break;default:}Q=M.personalizedOfferActionFromBuyButtonMetadataResponse(K,z),J=M.displayPropertiesFromOfferAction(Q,"app",K,Z),$&&(J.title=$,J.titles.standard=$)}return new k.PersonalizedOfferContext(X,Q,J)}).pipeInto(V)})}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./basic-crypto":67,"./bootstrap":70,"./builders/content":72,"./builders/lockups":76,"./builders/mso":77,"./builders/offers":79,"./builders/onboarding-cards":80,"./builders/pagination":81,"./builders/product-pages":83,"./builders/search":87,"./builders/static_pages":90,"./builders/top-charts":97,"./data/server-data":101,"./metrics":115,"./metrics/helpers":108,"./models":121,"./promise+piping":130,"./routing/routing":140,"./util/localization":145,"./wrappers/bag":150,"./wrappers/client":152,"./wrappers/store":155}],66:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../wrappers/random-source");d.sha256=function(P){return h.sha256(P)}},{"../wrappers/random-source":153}],67:[function(s,l,d){"use strict";function g(h){for(var P in h)d.hasOwnProperty(P)||(d[P]=h[P])}Object.defineProperty(d,"__esModule",{value:!0}),g(s("./random")),g(s("./uuid")),g(s("./hash"))},{"./hash":66,"./random":68,"./uuid":69}],68:[function(s,l,d){"use strict";function g(){const S=P.arc4random();return null===S?Math.floor(4294967295*Math.random()):S}Object.defineProperty(d,"__esModule",{value:!0});const P=s("../wrappers/random-source");d.number=g,d.numberTo=function(S){const y=P.arc4randomUniform(S);return null===y?g()%S:y}},{"../wrappers/random-source":153}],69:[function(s,l,d){"use strict";function h(){const w=P();w<I&&T++,I=w;const E=S(65535&w,4),C=S(65535&w/65535,4),F=S(65535&w/4294967295,4),R=S(4096|4095&w/0xFFFFFFFFFF,4),O=S(255&T,2),D=S(128|63&T/255,2),x=S(k,8),L=S(_,4);return`${C}${E}-${F}-${R}-${O}${D}-${L}${x}`}function P(){const E=Date.now()+1.221e13;return 1e4*E}function S(w,E){if(8<E)throw Error("lengh of string too long to pad");const C="00000000";let F=w.toString(16);const R=C.length-F.length;return 0<R&&(F=C.slice(0,R).concat(F)),0>R?F.slice(0,E):F}Object.defineProperty(d,"__esModule",{value:!0});const y=s("../wrappers/random-source"),A=s("./random");d.makeUUID=function(){const w=y.makeUUID();return null===w?h():w};let T=A.number(),I=P();const k=A.number(),_=A.number()},{"../wrappers/random-source":153,"./random":68}],70:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("./util/localization");d.load=function(P,S){h.loadLocalizations().then(()=>{S()},y=>{P.resolveToError(new Error(`Error loading localization: ${y}`))})}},{"./util/localization":145}],71:[function(s,l,d){"use strict";function g(oe){return"Watch"===oe?"watch":"iOS"===oe?"pad"===Z.deviceType?"pad":"phone":"tvOS"===oe?"tv":"Messages"===oe?"messages":null}function S(oe,ne){return J.context("renderArticle",()=>{ne.platformData=z.traverse(oe,"relatedContent",{});const se=z.asArrayOrEmpty(oe,"canvas"),le=[];let de;for(const ue of se){ne.module=z.asString(ue,"displayType"),ne.subStyle=null;const me=y(ue,ne);me&&(me.title=ne.titleForNextShelf,le.push(me),ne.titleForNextShelf=null,de=me),ne.index++,G.nextPosition(ne.metricsLocationTracker)}const ce=T(de,ne.module),pe=A(oe,ne,ce);return pe&&le.push(pe),le})}function y(oe,ne){return J.catchingContext(`module: ${ne.module}`,()=>{let se;switch(ne.module){case"Header":{ne.titleForNextShelf=z.asString(oe,"editorialCopy"),se=null;break}case"TextBlock":{se=I(oe,ne);break}case"CollectionLockup":{se=R(oe,ne);break}case"InlineImage":{se=k(oe,ne);break}case"AppLockup":{se=C(oe,ne);break}case"TipBlock":{se=_(oe,ne);break}case"PullQuote":{se=w(oe,ne);break}case"InlineVideo":{se=E(oe,ne);break}case"AppMedia":{se=D(oe,ne);break}case"LinkBlock":{se=x(oe,ne);break}case"TextList":{se=L(oe,ne);break}case"IAPLockup":{se=F(oe,ne);break}default:console.log(`Unknown module: ${ne.module}`),se=null;}return se})}function A(oe,ne,se){const le=U(oe);let de=null;const ce=H.itunesNotes(oe,"name"),pe=H.itunesNotes(oe,"short");if(ce&&pe&&(de=Y.string("SHARE_SHEET_TITLE_SUBTITLE_FORMAT","{title}: {subtitle}").replace("{title}",ce).replace("{subtitle}",pe)),!de&&ce&&(de=ce),!de&&pe&&(de=pe),!de&&le){const Pe=z.asString(le,"name"),Se=z.asString(oe,"displaySubStyle");switch(Se){case"GameOfDay":{de=Y.string("SHARE_SHEET_GAME_OF_DAY_TITLE_FORMAT").replace("{title}",Pe);break}case"AppOfDay":{de=Y.string("SHARE_SHEET_APP_OF_DAY_TITLE_FORMAT").replace("{title}",Pe);break}default:{console.log(`No title for article with unknown substyle: ${Se}`);break}}}const ue=z.asString(oe,"link.url"),me=Q.shareSheetDataForArticle(de,ue,null,le);if(!me)return null;const fe=new V.ShareSheetAction(me);G.addClickEventToAction(fe,{targetType:"button",id:ne.pageId,actionType:"share",pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker});const ge=new V.RoundedButton("share",Y.string("SHARE_STORY"),!se,fe);X.enabled("supportsAccessibilityDarkenedColors")||(ge.buttonColor="F1F4F6",ge.titleColor="0179FE");const he=new V.Shelf("roundedButton");return he.items=[ge],he}function T(oe,ne){if(oe&&ne){const se=oe.items.length;if(0<se&&-1!==te.indexOf(ne)){const le=oe.items[se-1];switch(oe.contentType){case"framedArtwork":{const de=le;return de&&de.isFullWidth}case"framedVideo":{const de=le;return de&&de.isFullWidth}default:return!0;}}}return!1}function I(oe,ne){const se=z.asString(oe,"editorialCopy");if(!se)return null;const le=new V.Paragraph(se,"text/x-apple-as3-nqml","article");N(le,ne);const de=new V.Shelf("paragraph");return de.items=[le],de}function k(oe,ne){const se=z.traverse(oe,"artwork");let le=q.artworkFromApiArtwork(se);const de=z.asString(oe,"inlineImageDisplayType");if(!le)return null;"FullWidth"===de&&(le=le.createArtworkWithFullWidthCanvasArtWorkaround());const ce=new V.FramedArtwork(le,!1,"text/x-apple-as3-nqml");if(ce.caption=z.asString(oe,"editorialCopy"),ne.subStyle=de,de)switch(de){case"BoundingBox":{ce.isFullWidth=!1,ce.hasRoundedCorners=!0;break}case"FullWidth":default:{ce.isFullWidth=!0,ce.hasRoundedCorners=!1;break}}N(ce,ne);const pe=new V.Shelf("framedArtwork");return pe.items=[ce],pe}function _(oe,ne){const se=z.traverse(oe,"artwork"),le=q.artworkFromApiArtwork(se);if(!le)return null;const de=z.asString(oe,"editorialCopy"),ce=z.asString(oe,"tipNumber"),pe=new V.FramedArtwork(le,!1,"text/x-apple-as3-nqml");pe.isFullWidth=!1,pe.hasRoundedCorners=!0,pe.caption=de,pe.ordinal=ce,N(pe,ne);const ue=new V.Shelf("framedArtwork");return ue.items=[pe],ue}function w(oe,ne){const se=z.asString(oe,"quote"),le=z.asString(oe,"quoteAttribution"),de=z.traverse(oe,"artwork"),ce=q.artworkFromApiArtwork(de),pe="FullWidth"===z.asString(oe,"pullQuoteDisplayType"),ue=new V.Quote(se,le,ce,pe);N(ue,ne);const me=new V.Shelf("quote");return me.items=[ue],me}function E(oe,ne){const se=z.traverse(oe,"video.previewFrame"),le=q.artworkFromApiArtwork(se);if(!le)return null;const de=z.asString(oe,"video.video");if(!de)return null;const ce=z.asString(oe,"inlineVideoDisplayType"),ue=new V.Video(de,le);G.addMetricsEventsToVideo(ue,{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker,id:ne.pageId});const me=new V.FramedVideo(ue,"FullWidth"===ce,"text/x-apple-as3-nqml");me.caption=z.asString(oe,"editorialCopy"),N(me,ne);const fe=new V.Shelf("framedVideo");return fe.items=[me],fe}function C(oe,ne){const se=M(oe,ne);if(!se)return null;const le=z.asString(oe,"appLockupSize");ne.subStyle=le;let pe=!1,de,ce;if(le)switch(le){case"Small":{de="smallLockup",pe=!0;break}case"Medium":{de="mediumLockup",pe=!0;break}case"Large":default:{de="appShowcase",ce="large";break}}const ue=new V.Shelf(de);if(pe){const me=j.lockupFromPlatformData(se,{metricsOptions:{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker}});ue.items=[me]}else{const me=j.lockupFromPlatformData(se,{offerStyle:"colored",metricsOptions:{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker}}),fe=new V.AppShowcase(ce,me);fe.description=j.subtitleFromPlatformData(se);let ge=null;const he=z.asString(oe,"appLockupVideo");switch(he){case"AppTrailer":{const Pe=q.videoPreviewsFromApiPlatformData(se);Pe&&0<Pe.length&&(ge=Pe[0]);break}default:}ge&&(G.addMetricsEventsToVideo(ge,{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker,id:ne.pageId}),fe.video=ge),ue.backgroundColor=V.AppShowcase.backgroundColor,ue.items=[fe]}return ue}function F(oe,ne){const se=M(oe,ne);if(!se)return null;H.hoistRelatedContentIntoiAP(ne.platformData,se);const le=j.inAppPurchaseLockupFromPlatformData(se,{metricsOptions:{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker}});if(!le)return null;const de=new V.InAppPurchaseShowcase(le),ce=new V.Shelf("inAppPurchaseShowcase");return ce.backgroundColor=V.InAppPurchaseShowcase.backgroundColor,ce.items=[de],ce}function R(oe,ne){const se=z.asBooleanOrFalse(oe,"showOrdinals"),le="OrdinalDesc"===z.asString(oe,"collectionLockupDisplayType")?"descending":"ascending",de={metricsOptions:{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker}},ce=z.asString(oe,"collectionLockupSize");ne.subStyle=ce;let pe;if(ce)switch(ce){case"Large":{pe="largeLockup";break}case"Medium":{pe="mediumLockup",de.offerSubtitlePosition="right";break}case"Small":default:{pe="smallLockup";break}}const ue=z.asArrayOrEmpty(oe,"contentIds"),me=j.lockupsFromPlatformData(ne.platformData,ue,{includeOrdinals:se,ordinalDirection:le,lockupOptions:de});if(!me||0===me.length)return null;const fe=new V.Shelf(pe);return fe.items=me,fe}function O(oe,ne,se){const le=new ee;return le.module=oe,le.moduleData=ne,le.contentId=z.asString(se,"id"),le}function D(oe,ne){const se=M(oe,ne);if(!se)return null;const le=z.asString(oe,"appMediaOption"),de=z.asString(oe,"appMediaPlatform");switch(ne.subStyle=le,le){case"Screenshots":{const ue=new V.Shelf("screenshots");if(z.isNull(de)){const me=q.screenshotsFromPlatformData(se);if(me&&0<me.length)ue.items=[me[0]];else{const fe=O(ne.module,oe,se);fe.storeLookupProfile="product-dv",ue.url=ae+encodeURIComponent(JSON.stringify(fe))}}else{const me=g(de);if(me){const fe=q.screenshotsFromPlatformData(se,[me]);if(fe&&fe.length)ue.items=[fe[0]];else{const ge=O(ne.module,oe,se),he={};he[ge.contentId]=se,ge.contentData=he,ue.url=`${ie}${encodeURIComponent(me)}/${encodeURIComponent(JSON.stringify(ge))}`}}}return ue}case"AppTrailers":const ce=new V.Shelf("framedVideo"),pe=q.videoPreviewsFromApiPlatformData(se);if(pe&&0<pe.length){const ue=pe[0];G.addMetricsEventsToVideo(ue,{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker,id:ne.pageId});const me=new V.FramedVideo(ue,!1,"text/plain",null,null,!0);ce.items=[me]}else{const ue=O(ne.module,oe,se);ue.storeLookupProfile="product-dv",ce.url=ae+encodeURIComponent(JSON.stringify(ue))}return ce;default:return null;}}function x(oe,ne){const se=z.asString(oe,"url");if(!se)return null;const le=z.asString(oe,"urlTitle");let de=z.asString(oe,"editorialCopy");if(!de){const me=new K.URL(se);de=me.host}const ce=new V.ExternalUrlAction(se);G.addClickEventToAction(ce,{targetType:"link",pageInformation:ne.metricsPageInformation,id:`${ne.index}`,locationTracker:ne.metricsLocationTracker});const pe=new V.Link(le,de,ce);N(pe,ne);const ue=new V.Shelf("link");return ue.items=[pe],ue}function L(oe,ne){const se=z.asArrayOrEmpty(oe,"editorialCopy");if(!se.length)return null;const le=z.asString(oe,"textListDisplayType");ne.subStyle=le;let de=!1;switch(le){case"Bulleted":{de=!0;break}default:{de=!1;break}}let ce=de?"<ul>":"<ol>";for(const me of se)ce=`${ce}<li>${me}</li>`;ce=de?`${ce}</ul>`:`${ce}</ol>`;const pe=new V.Paragraph(ce,"text/x-apple-as3-nqml","article");N(pe,ne);const ue=new V.Shelf("paragraph");return ue.items=[pe],ue}function M(oe,ne){const se=z.asString(oe,"contentId"),le=ne.platformData[se];return le?W.shouldFilter(le)?null:le:null}function N(oe,ne){if(oe){let se=ne.module;ne.subStyle&&(se=se+"_"+ne.subStyle);const le={id:`${ne.index}`,idType:"sequential",impressionType:se,kind:"iosModule"};oe.impressionFields=G.sanitizedMetricsDictionary(le)}}function U(oe){const ne=z.asArrayOrEmpty(oe,"cardIds"),se=z.traverse(oe,"relatedContent",{});if(1!==ne.length)return null;const le=se[ne[0]];return le&&"iosSoftware"===le.kind?le:null}function B(oe,ne){return j.lockupFromPlatformData(oe,{offerStyle:"vibrant",metricsOptions:{pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker}})}Object.defineProperty(d,"__esModule",{value:!0});const V=s("../models"),z=s("../data/server-data"),j=s("./lockups"),H=s("./today"),q=s("./content"),G=s("../metrics/helpers"),W=s("./filtering"),Y=s("../util/localization"),K=s("../data/urls"),Q=s("./sharing"),J=s("../data/validation"),X=s("../util/properties"),Z=s("../wrappers/client");class ${constructor(){this.index=0}}d.ArticleParseContext=$;class ee{constructor(){this.index=0}}d.ArticleToken=ee,d.articlePageWithResponse=function(oe){return J.context("articlePageWithResponse",()=>{const ne=new $;ne.metricsPageInformation=G.metricsPageInformationFromResponse(oe),ne.metricsLocationTracker=G.newLocationTracker();const se=z.traverse(oe,"pageData"),le=z.traverse(oe,"storePlatformData.editorial-item-product.results",{});ne.pageId=z.asString(se,"id");const de=le[ne.pageId],ce=H.todayCardFromPlatformData(de,ne);G.pushContentLocation({pageInformation:ne.metricsPageInformation,locationTracker:ne.metricsLocationTracker,targetType:"article",id:ne.pageId,idType:"its_id"},ce.title);const pe=S(de,ne),ue=U(de);let me=null;ue&&(me=B(ue,ne));const fe=new V.ArticlePage(ce,pe,me);return G.copyMetricsEventsIntoPageWithInformation(fe,ne.metricsPageInformation,ge=>{let he=ce.title;if(ce.media instanceof V.TodayCardMediaBrandedSingleApp&&ce.overlay instanceof V.TodayCardLockupOverlay){const Se=ce.overlay;he=Se.lockup.title}if(he){const Pe=z.asString(ge,"pageDetails","coercible");ge.pageDetails=Pe?`${Pe}_${he}`:`unknown_${he}`}}),fe})},d.articleShelfFromResponse=function(oe,ne){const se=new $;se.index=ne.index,se.module=ne.module,se.subStyle=ne.subStyle,se.metricsPageInformation=ne.metricsPageInformation,se.platformData=oe;const le=ne.moduleData,de=y(le,se);return de.mergeWhenFetched=!0,de};const te=["AppLockup","InlineImage","InlineVideo"],ae=`${K.Protocol.internal}:/${K.Path.article}/${K.Path.shelf}/`,ie=`${K.Protocol.internal}:/${K.Path.article}/${K.Path.shelf}/${K.Path.screenshots}/`},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"../util/properties":147,"../wrappers/client":152,"./content":72,"./filtering":74,"./lockups":76,"./sharing":88,"./today":96}],72:[function(s,l,d){"use strict";function g(q,G,W){return N.context("artworkFromApiArtwork",()=>{if(!q||!q.url)return null;const Y=new L.Artwork(M.asString(q,"url"),M.asNumber(q,"width"),M.asNumber(q,"height"),M.asString(q,"bgColor"),M.asString(q,"checksum"));return M.isNull(G)||(Y.style=G),M.isNull(W)||(Y.crop=W),Y})}function P(q,G){if(!q)return null;const W=D(G);return new L.MediaPlatform(q,W)}function y(q){return N.context("platformVideoPreviewFromApiPlatformData",()=>{const G=M.traverse(q,"videoPreviewsByType",null),W={};if(!G)return null;const Y=E(q,U);if(0===Y.length)return null;for(const K of Y){const Q=F(K,U.screenSize);for(const J of Object.keys(G)){const X=G[J],Z=[];for(const $ of X){const ee=$.previewFrame;if(!ee){N.unexpectedNull("ignoredValue","object",`videoPreviewsByType.${J}.previewFrame`);continue}const te=M.asString($,"video");if(!te){N.unexpectedNull("ignoredValue","string",`videoPreviewsByType.${J}.video`);continue}const ae=new L.Artwork(M.asString(ee,"url"),M.asNumber(ee,"width"),M.asNumber(ee,"height"),null,M.asString(ee,"checksum"));Z.push(new L.Video(te,ae))}W[J]=Z}for(const J of Q)if(W[J])return new z(W[J],P(K,J))}return null})}function I(q){if("messages"===q)switch(U.deviceType){case"pad":return"pad";default:return"phone";}return q}function _(q,G){const W=I(q),Y=F(W,U.screenSize);let K,Q;for(let J=0;J<Y.length&&!K;J++)K=G[Y[J]],Q=Y[J];if(K){const J=K.map(g),X=P(q,Q),Z=new L.Screenshots(J,X);return Z.appPlatform=X.appPlatform,Z}return null}function E(q,G){const W=C(q),Y=[];let K=[];const Q=function(J,X){-1!==K.indexOf(J)||-1!==Y.indexOf(J)||-1!==W.indexOf(J)&&(K.push(J),X&&Y.push(X))};switch(G.name){case"Watch":{Q("watch");break}default:}switch(G.deviceType){case"phone":{Q("phone");break}case"pad":{Q("pad");break}case"tv":{Q("tv");break}case"watch":{Q("watch");break}case"mac":{Q("mac");break}default:}return Q("phone"),Q("pad"),Q("messages"),Q("watch"),Q("tv"),Q("mac"),K=K.filter(function(J){return-1===Y.indexOf(J)}),K}function C(q){return q?N.context("deviceFamiliesFromLookupResponse",()=>{const G=M.asBooleanOrFalse(q,"hasMessagesExtension"),W=M.asBooleanOrFalse(q,"isHiddenFromSpringboard"),Y=M.asBooleanOrFalse(q,"isAppleWatchSupported"),K=M.asArrayOrEmpty(q,"deviceFamilies"),Q=[];for(const X of K)switch(X){case"iphone":W||Q.push("phone");break;case"ipad":W||Q.push("pad");break;case"tvos":Q.push("tv");break;default:}G&&Q.push("messages"),Y&&Q.push("watch");const J=M.asString(q,"kind");return"desktopApp"===J&&Q.push("mac"),Q}):null}function F(q,G){switch(q){case"mac":return["mac"];case"watch":return["appleWatch"];case"tv":return["appleTV"];case"pad":{const W=[],Y=B.enabled("screenshotTypeIPad10_5");return G.isEqualTo(d.screenSizeIPadPro)?(W.push("ipadPro"),Y&&W.push("ipad_10_5"),W.push("ipad")):G.isEqualTo(d.screenSizeIPad105)?(Y&&W.push("ipad_10_5"),W.push("ipad","ipadPro")):(W.push("ipad"),Y&&W.push("ipad_10_5"),W.push("ipadPro")),W}case"phone":{let W=G.isEqualTo(d.screenSizeIPhone58)?"iphone_5_8":G.isEqualTo(d.screenSizeIPhoneOriginal)?"iphone":G.isEqualTo(d.screenSizeIPhone5)?"iphone5":G.isEqualTo(d.screenSizeIPhone6)?"iphone6":"iphone6+";const Y=j.indexOf(W),K=j.slice(0,Y);K.reverse();const Q=j.slice(Y+1),J=[W];return J.concat(K,Q)}default:return[];}}function D(q){return"iphone_5_8"===q?H/d.screenSizeIPhone58.width:null}Object.defineProperty(d,"__esModule",{value:!0});const L=s("../models"),M=s("../data/server-data"),N=s("../data/validation"),U=s("../wrappers/client"),B=s("../util/properties"),V=s("../metrics/helpers");d.artworkFromApiArtwork=g,d.iconFromPlatformData=function(q,G){return N.context("iconFromPlatformData",()=>{if(!q)return N.unexpectedNull("ignoredValue","data"),null;const W=G?G:U.name,Y=M.asBooleanOrFalse(q,"isHiddenFromSpringboard"),K=M.asBooleanOrFalse(q,"hasMessagesExtension"),Q=M.asString(q,"kind");if("softwareAddOn"===Q)return g(q.artwork,"iap");if("desktopApp"===Q){const J=g(q.artwork);return J.format="png",J}if("Watch"===W&&q.circularArtwork)return g(q.circularArtwork,"round");if(K&&("Messages"===W||Y)&&q.ovalArtwork)return g(q.ovalArtwork,"pill");const J=M.asArrayOrEmpty(q,"deviceFamilies"),X=1===J.length&&-1!==J.indexOf("tvos");return B.enabled("supportsTvArtworkStyle")&&(X||"AppleTV"===W)?g(q.artwork,"tvRect"):g(q.artwork,"roundedRect")})},d.trailersFromApiPlatformData=function(q,G,W,Y){const K=y(q);if(!K)return null;const Q=K.videos;let J=null;if(!M.isNull(Q)){J=[];for(const Z of Q)V.addMetricsEventsToVideo(Z,Object.assign({},W,{id:Y})),J.push(Z)}let X=null;return J&&(X=new L.Trailers,X.videos=J,X.allowsAutoPlay=G,X.mediaPlatform=K.mediaPlatform),X};class z{constructor(q,G){this.videos=q,this.mediaPlatform=G}}d.platformVideoPreviewFromApiPlatformData=y,d.videoPreviewsFromApiPlatformData=function(q){return N.context("videoPreviewsFromApiPlatformData",()=>{const G=y(q);return G?G.videos:[]})},d.videoSetFromApiVideoPreview=function(q){return q?N.context("videoSetFromApiVideoPreview",()=>{const G={};for(const W of Object.keys(q)){const Y=q[W],K=Y.previewFrame;if(!K){N.unexpectedNull("ignoredValue","object",`videoPreviewByType.${W}.previewFrame`);continue}const Q=M.asString(Y,"video");if(!Q){N.unexpectedNull("ignoredValue","string",`videoPreviewByType.${W}.video`);continue}const J=new L.Artwork(M.asString(K,"url"),M.asNumber(K,"width"),M.asNumber(K,"height"));G[W]=[new L.Video(Q,J)]}return new L.VideoSet(G)}):null},d.screenshotsFromPlatformData=function(q,G=null,W=!1){return N.context("screenshotsFromPlatformData",()=>{const Y=[];let K=G;K&&0!==K.length||(K=E(q,U));for(const Q of K){let J;if(J="messages"===Q?q.messagesScreenshots:q.screenshotsByType,!!J){const X=_(Q,J);if(X)Y.push(X);else if("tv"===Q&&W){const Z=new L.MediaPlatform(Q),$=new L.Screenshots([],Z);$.appPlatform=Z.appPlatform,Y.push($)}}}return Y})},d.bestScreenshotData=_,d.bestVideo=function(q,G){if(!G)return null;for(const W of q)if(G[W]){const Y=G[W];return new L.Video(Y.video,g(Y.previewFrame))}return null},d.sortedAppPlatformsWithPlatformData=E,d.supportedAppPlatformsFromPlatformData=C,d.mediaTypesForAppPlatform=F,d.fileSizeInBytesFromProductData=function(q){if(M.isNull(q))return null;const G=q.fileSizeByDevice;if(G){const W=[U.thinnedApplicationVariantIdentifier,U.modelIdentifier,"universal"];for(const Y of W){const K=M.asNumber(G[Y]);if(K)return K}}return null},d.storeLookupPlatformFromAppPlatform=function(q){return"messages"===q?"Messages":"tv"===q?"atv9":null},d.screenSizeIPhone58=new L.Size(375,812),d.screenSizeIPhone6Plus=new L.Size(414,736),d.screenSizeIPhone6=new L.Size(375,667),d.screenSizeIPhone5=new L.Size(320,568),d.screenSizeIPhoneOriginal=new L.Size(320,480),d.screenSizeIPad=new L.Size(768,1024),d.screenSizeIPad105=new L.Size(834,1112),d.screenSizeIPadPro=new L.Size(1024,1366);const j=["iphone_5_8","iphone6+","iphone6","iphone5","iphone"],H=39;d.isOperatingSystemAtLeastVersion=function(q){if(M.isNull(q)||0===q.length)return!0;const G=q.split(".");return U.isOperatingSystemAtLeast(M.asNumber(G[0]),M.asNumber(G[1]),M.asNumber(G[2]))}},{"../data/server-data":101,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/properties":147,"../wrappers/client":152}],73:[function(s,l,d){"use strict";function P(x,L,M){const N=new A.Shelf("smallLockup");return N.items=T.lockupsFromPlatformData(x,L,M),N.isHorizontal=!0,N}Object.defineProperty(d,"__esModule",{value:!0});const S=s("../data/server-data"),y=s("../data/validation"),A=s("../models"),T=s("./lockups"),I=s("../data/urls"),k=s("../metrics/helpers"),_=s("./filtering"),w=s("../util/localization"),E=s("./content"),F=["latestRelease","systemApps","bundles","apps","games","appsAndGames","iMessageApps","watchApps","appleTVApps"],R={latestRelease:"DEVELOPER_LATEST_RELEASE",systemApps:"DEVELOPER_SYSTEM_APPS",apps:"DEVELOPER_APPS",games:"DEVELOPER_GAMES",appsAndGames:"DEVELOPER_APPS_AND_GAMES",iMessageApps:"DEVELOPER_IMESSAGE",watchApps:"DEVELOPER_WATCH",appleTVApps:"DEVELOPER_TV",bundles:"DEVELOPER_BUNDLES"},O={DEVELOPER_LATEST_RELEASE:"Latest Release",DEVELOPER_SYSTEM_APPS:"Built-In Apps",DEVELOPER_APPS:"Apps",DEVELOPER_GAMES:"Games",DEVELOPER_APPS_AND_GAMES:"Apps & Games",DEVELOPER_IMESSAGE:"iMessage",DEVELOPER_WATCH:"Watch",DEVELOPER_TV:"Apple TV",DEVELOPER_BUNDLES:"Bundles"};class D{}d.DeveloperPageToken=D,d.developerPageFromResponse=function(x){return y.context("developerPageFromResponse",()=>{const L=S.traverse(x,"pageData"),M=S.asArrayOrEmpty(L,"contentData"),N=S.traverse(x,["storePlatformData","lockup","results"],{}),U=k.metricsPageInformationFromResponse(x),B=k.newLocationTracker();let V=0;const z=[];for(const K of F){const Q=S.asArrayOrEmpty(L,K),J=Q.length;if(0!==J){const X=new D;let ee=!1,Z,$;"iMessageApps"===K?(Z=N,$="Messages"):"watchApps"===K?(Z=N,$="Watch"):"appleTVApps"===K?(X.lookupPlatform="atv9",Z={},$="AppleTV",ee=!0):(Z=N,$="AppStore");const te=R[K];let ae=w.string(te);ae&&ae!==te||(ae=O[R[K]]),k.pushContentLocation({pageInformation:U,locationTracker:B,idType:"sequential",id:`${V}`,targetType:"swoosh"},ae);const ie={excludeIconInSidepacksIfNotTvOnly:ee,lockupOptions:{metricsOptions:{pageInformation:U,locationTracker:B},clientNameOverride:$},filter:_.Filter.DeveloperPage},oe=P(Z,Q,ie);if(k.popLocation(B),k.nextPosition(B),oe.title=ae,3>J&&(oe.rowsPerColumn=J),"latestRelease"!==K||0!==oe.items.length){const ne=Q.filter(le=>{return null==Z[le]});ne.length&&(X.remainingIds=ne,X.lockupListOptions=ie,oe.url=`${I.Protocol.internal}:/${I.Path.developer}/${I.Path.shelf}/`+encodeURIComponent(JSON.stringify(X)));const se={id:null,kind:null,targetType:"swoosh",title:oe.title,pageInformation:U,locationTracker:B,idType:null};k.addImpressionFields(oe,se),z.push(oe),V++}}}1===z.length&&(z[0].isHorizontal=!1);const j=S.traverse(x,["storePlatformData","artist","results"],{}),H=Object.keys(j);let q;if(0<H.length){const K=H[0];q=j[K]}const G=S.traverse(q,"itunesNotes.standard");if(G){const K=new A.Paragraph(G,"text/x-apple-as3-nqml"),Q=new A.Shelf("paragraph");Q.items=[K],z.unshift(Q)}const W=new A.GenericPage(z);W.title=S.asString(q,"name"),W.presentationOptions=["prefersLargeTitle"],k.copyMetricsEventsIntoPageWithInformation(W,U);const Y=S.traverse(q,"editorialArtwork.bannerUber");return Y&&(W.uber=E.artworkFromApiArtwork(Y)),W})},d.loadMoreFromResponse=function(x,L){const M=P(x,L.remainingIds,L.lockupListOptions);return M.mergeWhenFetched=!0,M.networkTimingMetrics=x[k.timingValues],M}},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"./content":72,"./filtering":74,"./lockups":76}],74:[function(s,l,d){"use strict";function h(C){const F=T.asBooleanOrFalse(C,"is32bitOnly");return F}function P(C){const F=T.asBooleanOrFalse(C,"isAppleWatchSupported"),R=T.asString(C,"kind");return"Watch"!==I.name||F||"mobileSoftwareBundle"===R?!1:!0}function S(C){const F=T.asString(C,"bundleId"),R=T.asBooleanOrFalse(C,"isFirstPartyHideableApp");if(!R)return!1;let O=!1;if(_.default.isTVAppEnabled!==void 0)O=_.default.isTVAppEnabled;else{const M=I.storefrontIdentifier;let N=k.asArray("tvAppEnabledStorefronts_11_0");I.isOperatingSystemAtLeast(11,1,0)&&(N=N.concat(k.asArray("tvAppEnabledStorefronts_11_1")));for(const U of N)if(-1!==M.indexOf(U)){O=!0;break}}const D=I.modelIdentifier,x=D.startsWith("iPhone"),L=D.startsWith("iPad");switch(F){case"com.apple.compass":case"com.apple.Bridge":return!x;case"com.apple.calculator":case"com.apple.VoiceMemos":case"com.apple.weather":case"com.apple.stocks":return L;case"com.apple.Photo-Booth":return!L;case"com.apple.tv":return!O;case"com.apple.videos":return O;case"com.apple.iCloudDriveApp":case"com.apple.measure":return!0;case"com.apple.facetime":return k.enabled("isFaceTimeRestricted");case"com.apple.Fitness":return!k.enabled("isActivityAvailable");case"com.apple.Jellyfish":return k.enabled("deviceCapabilitiesPassThrough")?!I.deviceHasCapabilities(["front-depth-camera"]):!I.deviceHasCapabilities(["pearl-camera"]);case"com.apple.shortcuts":return!0;default:}return!1}function y(C){const F=T.asString(C,"kind");if("softwareAddOn"!==F)return!1;const R=T.asBooleanOrFalse(C,"isMerchandisedEnabled");return!R}function A(C){const F=T.asString(C,"minimumOSVersion");return!w.isOperatingSystemAtLeastVersion(F)}Object.defineProperty(d,"__esModule",{value:!0});const T=s("../data/server-data"),I=s("../wrappers/client"),k=s("../util/properties"),_=s("../wrappers/bag"),w=s("./content");var E;(function(C){C[C.None=0]="None",C[C.ThirtyTwoBit=2]="ThirtyTwoBit",C[C.UnsupportedSystemDeletableApps=4]="UnsupportedSystemDeletableApps",C[C.UnsupportedWatchAppOnWatchClient=8]="UnsupportedWatchAppOnWatchClient",C[C.DisabledMerchandisableIAPs=16]="DisabledMerchandisableIAPs",C[C.MinimumOSRequirement=32]="MinimumOSRequirement",C[C.DeveloperPage=52]="DeveloperPage",C[C.Offers=54]="Offers",C[C.All=62]="All"})(E=d.Filter||(d.Filter={})),d.shouldFilter=function(C,F=E.All){let R=!1;return F&E.ThirtyTwoBit&&(R=R||h(C)),F&E.UnsupportedSystemDeletableApps&&(R=R||S(C)),F&E.UnsupportedWatchAppOnWatchClient&&(R=R||P(C)),F&E.DisabledMerchandisableIAPs&&(R=R||y(C)),F&E.MinimumOSRequirement&&(R=R||A(C)),R}},{"../data/server-data":101,"../util/properties":147,"../wrappers/bag":150,"../wrappers/client":152,"./content":72}],75:[function(s,l,d){"use strict";function P(Te){let ve=null;if(Te.pageGenreId===ce.GenreIds.Apps)ve="AppStore"===pe.name?ne.string("GROUPING_APPS"):ne.string("GROUPING_APP_STORE","App Store");else if(Te.pageGenreAdamId){const ke=J(Te.platformData,Te.defaultStoreLookupProfile),be=$.traverse(ke,Te.pageGenreAdamId);be&&(ve=ee.nameFromGroupingData(be))}const Ie=new Z.GenericPage(Te.shelves);return Ie.presentationOptions=["prefersNavigationBarHiddenWhenRoot"],Ie.title=ve,Ie}function S(Te){const ve=7;if(null!==Te.shelves&&Te.shelves.length>ve){const ke=[];let be=0;Te.shelves.forEach(_e=>{(be<ve||"todayCard"!==_e.contentType)&&ke.push(_e),"todayCard"===_e.contentType&&be++}),Te.shelves=ke}const Ie=new Z.TodayPage(Te.shelves,fe.cardIdsFromToken(Te.onBoardingCardToken));return Ie.title=ne.string("TITLE_TODAY"),Ie}function y(Te,ve){const Ie=$.asArrayOrEmpty(Te,"today.modules");for(const ke of Ie){const be=$.asArrayOrEmpty(ke,"contents").map(we=>{return{contentId:we}}),_e={fcKind:Se.AppStore_TodayStack,content:be};ve.nextShelfTitle=$.asString(ke,"date"),A(_e,ve)}}function A(Te,ve){const Ie=$.asNumber(Te,"fcKind","coercible");me.catchingContext(`walkFeaturedContent: ${Ie}`,()=>{const ke=new Ae(Ie,ve.defaultStoreLookupProfile);ke.metricsPageInformation=ve.metricsPageInformation,ke.metricsLocationTracker=ve.metricsLocationTracker,ke.pageGenreId=ve.pageGenreId,ke.id=$.asString(Te,"adamId","coercible"),ke.title=$.asString(Te,"name"),ke.subtitle=$.asString(Te,"tagline");const be={id:ke.id,kind:null,targetType:"swoosh",title:ke.title,pageInformation:ve.metricsPageInformation,locationTracker:ve.metricsLocationTracker,idType:"its_contentId",fcKind:Ie};let _e;switch(Ie){case Se.AppStore_Root:case Se.AppStore_TabRoot:case Se.AppStore_ChartSet:case Se.Sundance_Root:case Se.Sundance_TabRoot:case Se.Sundance_Stack:case Se.Sundance_QuickLinks:case Se.Sundance_TabSet:{T(Te,ve);break}case Se.AppStore_GenreStack:{const we=$.asArrayOrEmpty(Te,"children");if(we.length){const Ee=we[0],Ce=$.asArrayOrEmpty(Ee,"children");Ce.length&&(oe.pushContentLocation(be,ke.title),_e=R(Ce,ve,ke),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker))}break}case Se.AppStore_HeroShelf:case Se.AppStore_CustomHeroShelf:case Se.Sundance_Flowcase:{oe.pushContentLocation(be,ke.title);const we=$.asArrayOrEmpty(Te,"children");_e=k(we,ve.platformData,ke,ve.unAvailableContentIds),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker);break}case Se.AppStore_BrickRow:case Se.AppStore_CustomBrickRow:case Se.Sundance_BrickRow:{oe.pushContentLocation(be,ke.title);let we=$.asBoolean(Te,"suppressText","coercible");$.isNull(we)&&(we=!0);const Ee=!we&&ge.enabled("supportsBrickSubtitle"),Ce=$.asArrayOrEmpty(Te,"children");_e=_(Ce,ve.platformData,ke,ve.unAvailableContentIds,Ee),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker);break}case Se.AppStore_LinkList:case Se.Sundance_LinkList:{oe.pushContentLocation(be,ke.title);const we=$.asArrayOrEmpty(Te,"links");_e=C(we,ve.platformData,ke,ve.unAvailableContentIds),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker);break}case Se.Sundance_RecommendedAppsShelf:case Se.Sundance_RecommendedGamesShelf:{_e=new Z.Shelf("largeLockup"),_e.isHorizontal=!0,_e.isPersonalized=!0;const we=$.asString(ve.recommendationConfig,"seeAllUrl");let Ee=te.URL.from(we);Ee=Ee.param("fcKindId",Ie.toString()),ke.seeAllUrl=Ee.toString();const Ce=new Z.FlowAction("page");Ce.pageUrl=ke.seeAllUrl,Ce.title=ne.string("ACTION_SEE_ALL"),oe.addClickEventToSeeAllAction(Ce,ke.seeAllUrl,{pageInformation:ke.metricsPageInformation,locationTracker:ke.metricsLocationTracker}),_e.seeAllAction=Ce;const Fe=$.asString(ve.recommendationConfig,"lookupUrlData.baseUrl");let Re=te.URL.from(Fe);Re=Re.param("fcKindId",Ie.toString()),ke.recommendationsUrl=Re.toString(),_e.url=q(ke);break}case Se.AppStore_DateBlock:{const we=$.asString(Te,"date");ve.nextShelfTitle=we,T(Te,ve);break}case Se.AppStore_TodayStack:{ve.isTodayPage=!0,ve.metricsPageInformation.baseFields.pageType="Today";const we=$.asString(ve.metricsPageInformation.baseFields,"pageId");ve.metricsPageInformation.baseFields.page=`Today_${we}`;const Ee=he.parseDateOmittingTimeFromString(ve.nextShelfTitle),Ce=new Date;if(Ee.getTime()>Ce.getTime())break;const Fe=ve.onBoardingCardToken,Re=0===ve.shelves.length;let Oe,De;Re?Oe=ne.formatDate("EEEE, MMMM d",Ee):(Oe=ne.formatDate("EEEE",Ee),De=ne.formatDate("MMMM d",Ee)),be.title=Oe,oe.pushContentLocation(be,Oe);const xe=$.asArrayOrEmpty(Te,"content");_e=D(xe,ve.platformData,ke,ve.unAvailableContentIds,Fe),(!ve.shouldHideDateBlockHeader||Re)&&(_e.title=Oe,_e.subtitle=De),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker);break}default:if(W(Ie)){const we=$.asBooleanOrFalse(Te,"showOrdinals"),Ee=!$.asBooleanOrFalse(Te,"doNotFilter");let Ce=$.asArrayOrEmpty(Te,"content");Ce&&0!==Ce.length||(Ce=$.asArrayOrEmpty(Te,"links")),ke.seeAllUrl=$.asString(Te,"seeAllUrl"),ke.shouldFilter=Ee,ke.shelfStyle=I(ke.featuredContentId,ve,Te),be.displayStyle=ke.shelfStyle,(Ie===Se.Sundance_iPhoneAppTrailerShelf||Ie===Se.Sundance_iPadAppTrailerShelf||Ie===Se.AppStore_VideoShelf||Ie===Se.AppStore_TrailerShelf)&&(ke.storeLookupProfile="trailer-lockup"),Ie===Se.AppStore_ScreenShotShelf&&(ke.storeLookupProfile="native-search-lockup"),Y(Ie)&&(ke.showOrdinals=!0,ke.shouldFilter=!1),oe.pushContentLocation(be,ke.title),_e=w(Ce,ve.platformData,ke,ve.unAvailableContentIds),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker);break}else{console.warn("Unknown featured content ID:",Ie);break}}_e&&(oe.addImpressionFields(_e,be),ve.shelves.push(_e))})}function T(Te,ve){const Ie=$.asArrayOrEmpty(Te,"children");for(const ke of Ie)A(ke,ve)}function I(Te,ve,Ie){if(Te===Se.AppStore_Shelf){let ke=$.asString(Ie,"displayStyle");return ke||(ke="small"),`${ke}Lockup`}if(Te===Se.AppStore_iAPShelf)return"inAppPurchaseTiledLockup";if(Te===Se.AppStore_ScreenShotShelf)return"screenshotsLockup";if(Te===Se.Sundance_iPhoneAppTrailerShelf||Te===Se.Sundance_iPadAppTrailerShelf||Te===Se.AppStore_VideoShelf||Te===Se.AppStore_TrailerShelf)return"appTrailerLockup";if(Y(Te))return"smallLockup";switch(ve.shelves.length%3){case 0:return"smallLockup";case 1:return"mediumLockup";default:return"largeLockup";}}function k(Te,ve,Ie,ke){const be=new Z.Shelf("editorialCard");be.isHorizontal=!0;const _e=[];for(const we of Te){const Ee={targetType:"hero",pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker},Ce=V(we,ve,Ie,Ee,ke);if(Ce){const Fe=new Z.EditorialCard;let Re=$.asString(we,"designBadge");Re||(Re=Ce.caption),Fe.caption=Re;let Oe=$.asString(we,"title");Oe||(Oe=Ce.title),Fe.title=Oe;let De=X($.asString(we,"designTag"));if(De||(De=Ce.subtitle),Fe.subtitle=De,Re&&Oe){if(Ce.artwork&&Ie.featuredContentId!==Se.Sundance_Flowcase){let Le=$.traverse(Ce.artwork,"subscriptionHero");Le||(Le=$.traverse(Ce.artwork,"storeFlowcase")),Fe.artwork=H(Le)}else Fe.artwork=j(we,416,204);if(Fe.artwork){Fe.clickAction=Ce.action;const xe=oe.impressionOptions(ve,Ce.title,Ee);oe.addImpressionFields(Fe,xe),_e.push(Fe),oe.nextPosition(Ie.metricsLocationTracker)}}}}return be.items=_e,be.url=q(Ie),be}function _(Te,ve,Ie,ke,be){const _e=[],we=new Z.Shelf("brick");we.isHorizontal=!0;for(const Ee of Te){const Ce={targetType:"brick",pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker},Fe=V(Ee,ve,Ie,Ce,ke);if(Fe){const Re=new Z.Brick;if(Fe.artwork&&Ie.featuredContentId!==Se.Sundance_BrickRow){let xe=$.traverse(Fe.artwork,"subscriptionHero");xe||(xe=$.traverse(Fe.artwork,"originalFlowcaseBrick")),Re.artwork=H(xe)}else Re.artwork=j(Ee,1060,520);if(Re.artwork){Re.accessibilityLabel=Fe.title,Re.shortEditorialDescription=Fe.title,Re.clickAction=Fe.action;const Oe=$.asNumber(Ee,"fcKind","coercible");Oe===Se.AppStore_MSOBrickMarker&&(Re.personalizationStyle="mso");const De=oe.impressionOptions(ve,Fe.title,Ce);oe.addImpressionFields(Re,De),_e.push(Re)}}}if(!$.isNull(be)){const Ee=new Z.ShelfPresentationHints;Ee.showSupplementaryText=be,we.presentationHints=Ee}return we.title=Ie.title,we.subtitle=Ie.subtitle,we.items=_e,we.url=q(Ie),we}function w(Te,ve,Ie,ke){let be=[];const _e=new Z.Shelf(Ie.shelfStyle);_e.isHorizontal=!0;for(const Ee of Te){const Ce=G(Ee),Fe=J(ve,Ie.storeLookupProfile)[Ce];if(!Fe||Q(Ie)){ke.has(Ce)||(Ie.isDeferring=!0,Ie.ids.push(Ce),Ie.deferredItems.push(Ee));continue}if(!de.shouldFilter(Fe)){let Re;Ie.showOrdinals&&(Re=Ie.ordinalIndex.toString());const Oe={ordinal:Re,metricsOptions:{pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker}};let De=null;if("appTrailerLockup"!==Ie.shelfStyle)"screenshotsLockup"===Ie.shelfStyle?(De=ee.screenshotsLockupFromPlatformData(Fe,Oe),be.push(De)):("mediumLockup"===Ie.shelfStyle&&(Oe.offerSubtitlePosition="right"),De=ee.lockupFromPlatformData(Fe,Oe),be.push(De));else if(ge.enabled("separatedMediaLockupTypes"))De=ee.trailersLockupFromPlatformData(Fe,Oe),De.editorialTagline&&De.editorialTagline.length&&be.push(De);else{De=ee.appTrailersLockupFromPlatformData(Fe,Oe);const xe=De;if(xe){const Le=xe.editorialTagline&&xe.editorialTagline.length,Me=!$.isNull(xe.trailer);Le&&Me&&be.push(xe)}}oe.nextPosition(Ie.metricsLocationTracker),Ie.ordinalIndex++}}Y(Ie.featuredContentId)&&(be=K(be,3));let we;if(Y(Ie.featuredContentId))we=new Z.FlowAction("topCharts");else{we=new Z.FlowAction("page");const Ee=E(Ie.shelfStyle);we.pageData=ae.roomPageForSeeAllAction(Ie.title,Ee)}return we.pageUrl=Ie.seeAllUrl,we.title=ne.string("ACTION_SEE_ALL"),oe.addClickEventToSeeAllAction(we,Ie.seeAllUrl,{pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker}),_e.seeAllAction=we,_e.title=Ie.title,_e.subtitle=Ie.subtitle,_e.items=be,_e.shouldFilterApps=Ie.shouldFilter,_e.url=q(Ie),_e}function E(Te){if(!Te)return null;return"inAppPurchaseLockup"===Te||"inAppPurchaseTiledLockup"===Te?Te:null}function C(Te,ve,Ie,ke){const be=[],_e=new Z.Shelf("action");_e.isHorizontal=!1;for(const we of Te){const Ee={targetType:"link",pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker},Ce=z(we,ve,Ie,Ee,ke);if(Ce){const Fe=Ce.action;if(Fe.title){const Re=G(we);Re&&oe.addImpressionFields(Fe,Object.assign({},Ee,{kind:"link",title:Fe.title,id:Re})),be.push(Fe),oe.nextPosition(Ie.metricsLocationTracker)}}}return _e.items=be,_e.title=Ie.title,_e.subtitle=Ie.subtitle,_e.url=q(Ie),_e}function R(Te,ve,Ie){const ke=[];for(const _e of Te){const we=$.traverse(_e,"link");if(we){const Ee={targetType:"listItem",pageInformation:Ie.metricsPageInformation,locationTracker:Ie.metricsLocationTracker},Ce=z(we,ve.platformData,Ie,Ee,ve.unAvailableContentIds);if(Ce){const Fe=Ce.action;oe.addImpressionFields(Fe,Object.assign({},Ee,{kind:"link",title:Fe.title,id:$.asString(we,"contentId")})),Ce.artwork&&(Fe.artwork=se.artworkFromApiArtwork(Ce.artwork),Fe.artwork.format="png"),ke.push(Fe),oe.nextPosition(Ie.metricsLocationTracker)}}}const be=O(ke);return be.title=Ie.title,be.subtitle=Ie.subtitle,be}function O(Te){const ve=new Z.Shelf("action");if(ve.isHorizontal=!1,6<Te.length){ve.items=Te.slice(0,6);const Ie=new Z.FlowAction("page");Ie.title=ne.string("ACTION_SEE_ALL"),ve.seeAllAction=Ie;const ke=new Z.Shelf("action");ke.isHorizontal=!1,Te.sort((_e,we)=>{try{return _e.title.localeCompare(we.title,ne.safeIdentifier,{usage:"sort"})}catch(Ee){return 0}}),ke.items=Te;const be=new Z.GenericPage([ke]);be.title=ne.string("TITLE_CATEGORIES"),Ie.pageData=be}else ve.items=Te;return ve}function D(Te,ve,Ie,ke,be){const _e=new Z.Shelf("todayCard");_e.isHorizontal=!1;let we=[];for(const Ce of Te){const Fe=$.asString(Ce,"contentId"),Re=J(ve,Ie.storeLookupProfile)[Fe];if(!Re||Q(Ie)){ke.has(Fe)||(Ie.isDeferring=!0,Ie.ids.push(Fe),Ie.deferredItems.push(Ce));continue}we.push(Re)}we=L(we);const Ee=[];if(be){for(const Ce of be.onboardingCards)x(Ce,Ie,Ee);be.onboardingCards=[]}for(const Ce of we)x(Ce,Ie,Ee);return _e.items=Ee,_e.url=q(Ie),_e}function x(Te,ve,Ie){const ke=le.todayCardFromPlatformData(Te,ve);ke&&(Ie.push(ke),oe.nextPosition(ve.metricsLocationTracker))}function L(Te){if(ge.enabled("supportsLargeVideoTodayCards")||!pe.screenSize.isEqualTo(se.screenSizeIPad105))return Te;const ve=[],Ie=[];for(let ke=0;ke<Te.length;ke++){const be=Te[ke];le.isVideoCard(be)&&Ie.push(ke),ve.push(be)}for(const ke of Ie){const be=Te[ke],we=0==ke/2%2,Ee=0==ke%2;if(we&&Ee||!we&&!Ee){const Fe=ke+1,Re=ke-1;if(we&&Ee&&Fe<Te.length){const Oe=Te[Fe];ve[Fe]=be,ve[ke]=Oe}else if(!we&&!Ee&&0<Re){const Oe=Te[Re];ve[Re]=be,ve[ke]=Oe}}}return ve}function M(Te){const ve=new Z.ExternalUrlAction(Te),Ie=ne.string("TERMS_AND_CONDITIONS_TITLE"),ke=new Z.Footnote(Ie);ke.clickAction=ve,ke.presentationStyle=["hasChevron","textLightensOnHighlight"];const be=new Z.Shelf("footnote");be.items=[ke];const _e=N();return _e&&be.items.push(_e),be}function N(){if(!Pe.default.emailSupportLinkUrl)return null;const Te=new Z.ExternalUrlAction(Pe.default.emailSupportLinkUrl),ve=ne.string("EMAIL_SUPPORT_TITLE"),Ie=new Z.Footnote("Email Support");return Ie.clickAction=Te,Ie.presentationStyle=["hasChevron","textLightensOnHighlight"],Ie}function U(){if(ue.current&&ue.current.isManagedAppleID)return null;if(!ge.enabled("titledButtonStack"))return B();const Te=new Z.Shelf("titledButtonStack"),ve=[],Ie=ne.string("FOOTER_REDEEM","Redeem"),ke=new Z.FlowAction("finance");ke.pageUrl="redeem";const be=new Z.TitledButton(Ie,ke);if(ve.push(be),Pe.default.isMonetaryGiftingEnabled){const Ee=ne.string("FOOTER_SEND_GIFT","Send Gift"),Ce=new Z.FlowAction("finance");Ce.pageUrl="gift";const Fe=new Z.TitledButton(Ee,Ce);ve.push(Fe)}const _e=Pe.default.accountTopUpUrl;if(_e){const Ee=ne.string("FOOTER_ADD_MONEY"),Ce=new Z.FlowAction("finance");Ce.pageUrl=_e;const Fe=new Z.TitledButton(Ee,Ce);ve.push(Fe)}const we=new Z.TitledButtonStack(ve);return 2<we.buttons.length&&(we.compactLineBreaks=[1]),Te.items=[we],Te}function B(){const Te=new Z.Shelf("footerButton"),ve=[],Ie=new Z.FlowAction("finance");Ie.pageUrl="redeem";const ke=ne.string("FOOTER_REDEEM","Redeem"),be=new Z.FooterButton(ke,Ie);if(ve.push(be),Pe.default.isMonetaryGiftingEnabled){const _e=new Z.FlowAction("finance");_e.pageUrl="gift";const we=ne.string("FOOTER_SEND_GIFT","Send Gift"),Ee=new Z.FooterButton(we,_e);ve.push(Ee)}return Te.items=ve,Te}function V(Te,ve,Ie,ke,be){const _e=$.traverse(Te,"link");return z(_e,ve,Ie,ke,be,()=>{Ie.deferredItems.push(Te)})}function z(Te,ve,Ie,ke,be,_e){const we=function(Ce){_e?_e():Ie.deferredItems.push(Ce)},Ee=$.asString(Te,"type");switch(Ee){case"link":{if(Q(Ie))return we(Te),null;const Ce=$.asString(Te,"target"),Fe=$.asString(Te,"url"),Re=$.asString(Te,"label");let Oe=null;if("external"===Ce)Oe=new Z.ExternalUrlAction(Fe),Oe.title=Re;else{const xe=new Z.FlowAction("unknown");xe.pageUrl=Fe,xe.title=Re,Oe=xe}Oe.presentationStyle=["textFollowsTintColor"];const De=Object.assign({},ke,{id:""});return oe.addClickEventToAction(Oe,De),{action:Oe,caption:null,title:Re,subtitle:null,artwork:null,shortEditorialDescription:null}}case"content":{const Ce=G(Te),Fe=J(ve,Ie.storeLookupProfile)[Ce];if(!Fe||Q(Ie))return be.has(Ce)||(Ie.isDeferring=!0,Ie.ids.push(Ce),we(Te)),null;const Re=$.asString(Fe,"kind");let Oe=$.asString(Fe,"itunesNotes.tagline");Oe||(Oe=ee.subtitleFromPlatformData(Fe));const De=ee.actionFromPlatformData(Fe,Object.assign({},ke,{id:Ce}));De.presentationStyle=["textFollowsTintColor"];let xe=null,Le=null;const Me=$.asString(Fe,"itunesNotes.short");switch(Re){case"grouping":{xe=$.traverse(Fe,"artwork");break}case"editorialItem":{Le=$.asString(Fe,"label"),Le&&(Le=Le.replace(/\n/g," "));const Ne=$.asArrayOrEmpty(Fe,"cardIds");let Ue=null;if(Ne.length){const Ve=Ne[0],ze=$.traverse(Fe,"relatedContent")||{};Ue=ze[Ve]}const Be=$.asString(Fe,"editorialNotes.tagline");Be?Oe=Be:Ue&&(Oe=le.itunesNotes(Ue,"short")),De.title=De.title||Oe||Le}default:{xe=$.traverse(Fe,"editorialArtwork");break}}return{action:De,caption:Le,title:De.title,subtitle:Oe,artwork:xe,shortEditorialDescription:Me}}default:}return null}function j(Te,ve,Ie){const ke=$.traverse(Te,"artwork");if(ke instanceof Array){const be=ie.closestArtworkMatchingSize(ke,ve,Ie);return be.crop="bb",be}return null==ke?null:H(ke)}function H(Te){const ve=se.artworkFromApiArtwork(Te);return ve&&(ve.crop="sr"),ve}function q(Te){return(Te.deferredItems.length||Te.recommendationsUrl)&&Te.isFirstRender?`${te.Protocol.internal}:/${te.Path.grouping}/${te.Path.shelf}/`+encodeURIComponent(JSON.stringify(Te)):null}function G(Te){let ve=$.asString(Te,"adamId","coercible");return ve||(ve=$.asString(Te,"contentId","coercible")),ve}function W(Te){return Y(Te)||Te===Se.AppStore_Shelf||Te===Se.AppStore_iAPShelf||Te===Se.AppStore_ScreenShotShelf||Te===Se.AppStore_VideoShelf||Te===Se.AppStore_TrailerShelf||Te===Se.Sundance_iPhoneAppTrailerShelf||Te===Se.Sundance_iPadAppTrailerShelf||Te===Se.Sundance_Shelf}function Y(Te){return Te===Se.Common_iPhoneTopChart||Te===Se.Common_iPhonePaidTopChart||Te===Se.Common_iPhoneFreeTopChart||Te===Se.Common_iPadTopChart||Te===Se.Common_iPadFreeTopChart||Te===Se.Common_iPadPaidTopChart||Te===Se.AppStore_iPhoneFreeTopChartV2||Te===Se.AppStore_iPhoneGrossingTopCharV2t||Te===Se.AppStore_iPadFreeTopChartV2||Te===Se.AppStore_iPadGrossingTopChartV2||Te===Se.AppStore_TVFreeTopChartV2||Te===Se.AppStore_TVGrossingTopChartV2||Te===Se.AppStore_WatchFreeTopChartV2||Te===Se.AppStore_WatchGrossingTopChartV2||Te===Se.AppStore_iPhonePaidTopChartV2||Te===Se.AppStore_iPadPaidTopChartV2||Te===Se.AppStore_TVPaidTopChartV2||Te===Se.AppStore_WatchPaidTopChartV2||Te===Se.AppStore_iPhoneiMessageFreeTopChart||Te===Se.AppStore_iPhoneiMessagePaidTopChart||Te===Se.AppStore_iPhoneiMessageGrossingTopChart||Te===Se.AppStore_iPadiMessageFreeTopChart||Te===Se.AppStore_iPadiMessagePaidTopChart||Te===Se.AppStore_iPadiMessageGrossingTopChart}function K(Te,ve){if(!Te)return null;const Ie=Te.length;return Te.slice(0,Ie-Ie%ve)}function Q(Te){return Te.isDeferring&&Te.isFirstRender}function J(Te,ve){return $.traverse(Te,ve+".results",Te)}function X(Te){if($.isNull(Te))return null;const ve=Te.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,"\"").replace(/&#39;/g,"'").replace(/&#96;/g,"`").replace(/\r\n/g," ").replace(/&nbsp;/g," ").replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<br>/g," ").replace(/â/g,"").replace(/<i>/g,"").replace(/<\/i>/g,"").replace(/<b>/g,"").replace(/<\/b>/g,"");return ve.match(/^\s*$/)?null:ve}Object.defineProperty(d,"__esModule",{value:!0});const Z=s("../models"),$=s("../data/server-data"),ee=s("./lockups"),te=s("../data/urls"),ae=s("./room"),ie=s("../data/legacy-artwork"),oe=s("../metrics/helpers"),ne=s("../util/localization"),se=s("./content"),le=s("./today"),de=s("./filtering"),ce=s("../util/constants"),pe=s("../wrappers/client"),ue=s("../wrappers/user"),me=s("../data/validation"),fe=s("../builders/onboarding-cards"),ge=s("../util/properties"),he=s("../util/date-util"),Pe=s("../wrappers/bag");var Se;(function(Te){Te[Te.Common_iPhoneTopChart=117]="Common_iPhoneTopChart",Te[Te.Common_iPhoneFreeTopChart=118]="Common_iPhoneFreeTopChart",Te[Te.Common_iPhonePaidTopChart=122]="Common_iPhonePaidTopChart",Te[Te.Common_iPadTopChart=195]="Common_iPadTopChart",Te[Te.Common_iPadFreeTopChart=194]="Common_iPadFreeTopChart",Te[Te.Common_iPadPaidTopChart=197]="Common_iPadPaidTopChart",Te[Te.Sundance_Root=254]="Sundance_Root",Te[Te.Sundance_TabRoot=255]="Sundance_TabRoot",Te[Te.Sundance_Stack=256]="Sundance_Stack",Te[Te.Sundance_Header=257]="Sundance_Header",Te[Te.Sundance_Flowcase=258]="Sundance_Flowcase",Te[Te.Sundance_Shelf=260]="Sundance_Shelf",Te[Te.Sundance_BrickRow=261]="Sundance_BrickRow",Te[Te.Sundance_LinkList=265]="Sundance_LinkList",Te[Te.Sundance_QuickLinks=266]="Sundance_QuickLinks",Te[Te.Sundance_GenreStack=267]="Sundance_GenreStack",Te[Te.Sundance_TabSet=271]="Sundance_TabSet",Te[Te.Sundance_iPhoneAppTrailerShelf=304]="Sundance_iPhoneAppTrailerShelf",Te[Te.Sundance_iPadAppTrailerShelf=305]="Sundance_iPadAppTrailerShelf",Te[Te.Sundance_RecommendedAppsShelf=311]="Sundance_RecommendedAppsShelf",Te[Te.Sundance_RecommendedGamesShelf=312]="Sundance_RecommendedGamesShelf",Te[Te.AppStore_iPhoneFreeTopChartV2=369]="AppStore_iPhoneFreeTopChartV2",Te[Te.AppStore_iPhoneGrossingTopCharV2t=370]="AppStore_iPhoneGrossingTopCharV2t",Te[Te.AppStore_iPadFreeTopChartV2=371]="AppStore_iPadFreeTopChartV2",Te[Te.AppStore_iPadGrossingTopChartV2=372]="AppStore_iPadGrossingTopChartV2",Te[Te.AppStore_TVFreeTopChartV2=373]="AppStore_TVFreeTopChartV2",Te[Te.AppStore_TVGrossingTopChartV2=374]="AppStore_TVGrossingTopChartV2",Te[Te.AppStore_WatchFreeTopChartV2=375]="AppStore_WatchFreeTopChartV2",Te[Te.AppStore_WatchGrossingTopChartV2=376]="AppStore_WatchGrossingTopChartV2",Te[Te.AppStore_iPhonePaidTopChartV2=377]="AppStore_iPhonePaidTopChartV2",Te[Te.AppStore_iPadPaidTopChartV2=378]="AppStore_iPadPaidTopChartV2",Te[Te.AppStore_TVPaidTopChartV2=379]="AppStore_TVPaidTopChartV2",Te[Te.AppStore_WatchPaidTopChartV2=380]="AppStore_WatchPaidTopChartV2",Te[Te.AppStore_iPhoneiMessageFreeTopChart=395]="AppStore_iPhoneiMessageFreeTopChart",Te[Te.AppStore_iPhoneiMessagePaidTopChart=396]="AppStore_iPhoneiMessagePaidTopChart",Te[Te.AppStore_iPhoneiMessageGrossingTopChart=397]="AppStore_iPhoneiMessageGrossingTopChart",Te[Te.AppStore_iPadiMessageFreeTopChart=398]="AppStore_iPadiMessageFreeTopChart",Te[Te.AppStore_iPadiMessagePaidTopChart=399]="AppStore_iPadiMessagePaidTopChart",Te[Te.AppStore_iPadiMessageGrossingTopChart=400]="AppStore_iPadiMessageGrossingTopChart",Te[Te.AppStore_Root=413]="AppStore_Root",Te[Te.AppStore_TabRoot=414]="AppStore_TabRoot",Te[Te.AppStore_HeroShelf=415]="AppStore_HeroShelf",Te[Te.AppStore_CustomHeroShelf=416]="AppStore_CustomHeroShelf",Te[Te.AppStore_Shelf=418]="AppStore_Shelf",Te[Te.AppStore_TrailerShelf=420]="AppStore_TrailerShelf",Te[Te.AppStore_BrickRow=421]="AppStore_BrickRow",Te[Te.AppStore_CustomBrickRow=423]="AppStore_CustomBrickRow",Te[Te.AppStore_ChartSet=424]="AppStore_ChartSet",Te[Te.AppStore_GenreStack=425]="AppStore_GenreStack",Te[Te.AppStore_ScreenShotShelf=429]="AppStore_ScreenShotShelf",Te[Te.AppStore_VideoShelf=430]="AppStore_VideoShelf",Te[Te.AppStore_iAPShelf=431]="AppStore_iAPShelf",Te[Te.AppStore_TodayStack=433]="AppStore_TodayStack",Te[Te.AppStore_MSOBrickMarker=435]="AppStore_MSOBrickMarker",Te[Te.AppStore_DateBlock=436]="AppStore_DateBlock",Te[Te.AppStore_LinkList=437]="AppStore_LinkList"})(Se=d.FeaturedContentID||(d.FeaturedContentID={}));class ye{constructor(){this.shelves=[],this.metricsLocationTracker=oe.newLocationTracker(),this.isTodayPage=!1,this.shouldHideDateBlockHeader=!1}}d.GroupingParseContext=ye;class Ae{constructor(Te,ve){this.shouldFilter=!1,this.deferredItems=[],this.ids=[],this.isFirstRender=!0,this.isDeferring=!1,this.showOrdinals=!1,this.ordinalIndex=1,this.isTodayShelf=!1,this.featuredContentId=Te,this.storeLookupProfile=ve}}d.GroupingShelfToken=Ae,d.groupingPageWithResponse=function(Te,ve=null,Ie=null){return me.context("groupingPageWithResponse",()=>{const ke=$.traverse(Te,"pageData"),be=new ye;be.isTodayPage="today"===$.asString(ke,"pageType"),be.metricsPageInformation=oe.metricsPageInformationFromResponse(Te);const _e=$.traverse(ke,"unAvailableContentIds",{});be.unAvailableContentIds=new Set(Object.keys(_e)),be.platformData=$.traverse(Te,"storePlatformData",{}),be.defaultStoreLookupProfile="lockup",be.shouldHideDateBlockHeader=$.asBooleanOrFalse(ke,"shouldHideDateBlockHeader");const we=fe.makeOnBoardingCardToken(ve,Ie);be.onBoardingCardToken=we,be.isTodayPage?y(ke,be):(be.fcStructure=$.traverse(ke,"fcStructure.model"),be.recommendationConfig=$.traverse(ke,"recommendationsSwooshData"),be.pageGenreAdamId=$.asString(ke,"contentId"),be.pageGenreId=$.asNumber(ke,"genreId"),A(be.fcStructure,be));const Ee=U();Ee&&be.shelves.push(Ee);const Ce=Pe.default.termsAndConditionsUrl;if(!$.isNull(Ce)){const Re=M(Ce);be.shelves.push(Re)}let Fe;return Fe=be.isTodayPage?S(be):P(be),oe.copyMetricsEventsIntoPageWithInformation(Fe,be.metricsPageInformation),Fe})},d.groupingPageShelfWithToken=function(Te,ve){const Ie=ve.deferredItems;ve.isFirstRender=!1,ve.isDeferring=!1,ve.deferredItems=[],ve.ids=[];const ke=new Set;let be;const _e=ve.featuredContentId;switch(_e){case Se.AppStore_HeroShelf:case Se.AppStore_CustomHeroShelf:case Se.Sundance_Flowcase:{be=k(Ie,Te,ve,ke);break}case Se.AppStore_BrickRow:case Se.AppStore_CustomBrickRow:case Se.Sundance_BrickRow:{be=_(Ie,Te,ve,ke);break}case Se.AppStore_LinkList:case Se.Sundance_LinkList:{be=C(Ie,Te,ve,ke);break}case Se.AppStore_TodayStack:{be=D(Ie,Te,ve,ke);break}default:if(ve.isTodayShelf){be=D(Ie,Te,ve,ke);break}else if(W(_e)){be=w(Ie,Te,ve,ke);break}else console.warn("Unknown featured content ID:",ve.featuredContentId);}return ve.ids.length&&console.warn("Could not load items for: "+ve.ids.join(",")),be&&(be.mergeWhenFetched=!0,be.networkTimingMetrics=J(Te,ve.storeLookupProfile)[oe.timingValues]),be},d.shelfForRecommendationResponse=function(Te,ve){const Ie=$.asArrayOrEmpty(Te,"contentIds"),ke=$.traverse(Te,"storePlatformData.lockup.results"),be=$.asString(Te,"title"),_e=$.traverse(Te,"recoMetricsData");ve.ids=Ie;const we={id:ve.id,kind:null,targetType:"recommendations_swoosh",title:be,pageInformation:ve.metricsPageInformation,locationTracker:ve.metricsLocationTracker,idType:"its_contentId",fcKind:ve.featuredContentId,recoMetricsData:_e};oe.pushContentLocation(we,ve.title);const Ee=new Z.Shelf("largeLockup");Ee.isHorizontal=!0,Ee.title=be,Ee.subtitle=ve.subtitle;const Ce={lockupOptions:{metricsOptions:{pageInformation:ve.metricsPageInformation,locationTracker:ve.metricsLocationTracker}}};Ee.items=ee.lockupsFromPlatformData(J(ke,ve.storeLookupProfile),ve.ids,Ce),Ee.mergeWhenFetched=!0,0===Ee.items.length&&(Ee.isHidden=!0);const Fe=new Z.FlowAction("page");return Fe.pageUrl=ve.seeAllUrl,Fe.title=ne.string("ACTION_SEE_ALL"),oe.addClickEventToSeeAllAction(Fe,ve.seeAllUrl,{pageInformation:ve.metricsPageInformation,locationTracker:ve.metricsLocationTracker}),Ee.seeAllAction=Fe,oe.addImpressionFields(Ee,we),oe.popLocation(ve.metricsLocationTracker),oe.nextPosition(ve.metricsLocationTracker),Fe.pageData=ae.roomPageForSeeAllAction(Ee.title),Ee}},{"../builders/onboarding-cards":80,"../data/legacy-artwork":100,"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/constants":142,"../util/date-util":144,"../util/localization":145,"../util/properties":147,"../wrappers/bag":150,"../wrappers/client":152,"../wrappers/user":156,"./content":72,"./filtering":74,"./lockups":76,"./room":86,"./today":96}],76:[function(s,l,d){"use strict";function g(ge){return"softwareAddOn"===ge?"inAppPurchase":"app"}function h(ge,he,Pe){ge&&ee.context("copyPlatformDataIntoLockup",()=>{he.adamId=$.asString(ge,"id"),he.bundleId=$.asString(ge,"bundleId");let Se=null;Pe&&Pe.clientNameOverride&&(Se=Pe.clientNameOverride),he.icon=Z.iconFromPlatformData(ge,Se),he.title=Pe&&Pe.titleObjectPath?$.asString(ge,Pe.titleObjectPath):$.asString(ge,"name");const ye=[];if(Pe&&Pe.subtitleObjectPaths){for(const Fe of Pe.subtitleObjectPaths)if(!Pe.maxSubtitleCount||Pe.maxSubtitleCount&&ye.length<Pe.maxSubtitleCount){const Re=$.asString(ge,Fe);Re&&Re.length&&ye.push(Re)}}else{const Fe=k(ge);Fe&&ye.push(Fe)}if(he.subtitles=ye,he.developerTagline=$.asString(ge,"subtitle"),he.editorialTagline=$.asString(ge,"itunesNotes.tagline"),he.editorialDescription=$.asString(ge,"itunesNotes.standard"),he.shortEditorialDescription=$.asString(ge,"itunesNotes.short"),he.ageRating=$.asString(ge,"contentRatingsBySystem.appsApple.name"),!$.asBooleanOrFalse(ge,"isFirstPartyHideableApp")&&!fe.shouldSuppressReviewsForAdamId(he.adamId)){const Fe=$.asNumber(ge,"userRating.ratingCount");(0<Fe||!(Pe&&Pe.hideZeroRatings))&&(he.rating=$.asNumber(ge,"userRating.value"),he.ratingCount=le.formattedCount($.asNumber(ge,"userRating.ratingCount")))}const Ae=oe.clickOptionsForLockup(ge,Pe.metricsOptions),Te=X.offerDataFromPlatformData(ge),ve=X.offerActionFromOfferData(Te,ge,Ae),Ie=$.asArrayOrEmpty(Te,"discounts");he.buttonAction=X.wrapOfferActionIfNeeded(ve,ge,!0,Ae,Pe.ignoreIconInSidepack);let ke=!1;const be=$.asArrayOrEmpty(ge,"softwareAdamIds");if(be.length){const Fe=$.traverse(ge,"software"),Re=Fe[be[0]];if(Re){const Oe=X.offerDataFromPlatformData(Re),De=X.priceFromOfferData(Oe);ke=!(0<De)}}const _e=$.asString(ge,"kind"),we=g(_e);he.offerDisplayProperties=Pe?X.displayPropertiesFromOfferAction(ve,we,ge,Pe.offerStyle,Pe.offerEnvironment,Pe.offerSubtitlePosition,Ie[0],ke):X.displayPropertiesFromOfferAction(ve,we,ge,null,null,null,Ie[0],ke),Pe&&Pe.skipDefaultClickAction||(he.clickAction=H(ge,Ae,Pe.ignoreIconInSidepack)),Pe&&Pe.ordinal&&(he.ordinal=Pe.ordinal);const Ee=ge.editorialBadgeInfo;if(Ee){const Fe=$.asString(Ee.editorialBadgeType);he.isEditorsChoice=Fe&&"editorialPriority"===Fe}const Ce=oe.impressionOptionsForLockup(ge,he,Pe.metricsOptions);oe.addImpressionFields(he,Ce)})}function P(ge,he,Pe){ge&&ee.context("copyPlatformDataIntoBundleLockup",()=>{h(ge,he,Pe);const Se=[],ye=$.asArrayOrEmpty(ge,"childrenIds"),Ae=$.traverse(ge,"children");for(const Te of ye){const ve=Ae[Te];ve&&Se.push(E(ve,Pe))}he.children=Se})}function S(ge,he,Pe){ge&&ee.context("copyPlatformDataIntoInAppPurchaseLockup",()=>{h(ge,he,Pe);const Se=$.asString(ge.softwareAdamIds[0]),ye=ge.software?ge.software[Se]:null;if(ye){he.productIdentifier=$.asString(ge,"offerName"),he.parent=E(ye,Pe),he.description=$.asString(ge,"description.standard"),he.isVisibleByDefault=$.asBooleanOrFalse(ge,"isMerchandisedVisibleByDefault"),he.isSubscription=$.asBooleanOrFalse(ge,"isSubscription");const Ae=X.offerDataFromPlatformData(ge),Te=$.asArrayOrEmpty(Ae,"discounts");he.offerDisplayProperties.hasDiscount=0<Te.length,he.offerDisplayProperties.subscriptionFamilyId=$.asString(ge,"subscriptionFamilyId");const ve=new te.FlowAction("inAppPurchaseInstall");ve.presentationContext="presentModalFormSheet";const Ie=le.string("INSTALL_PAGE_BANNER_MESSAGE"),ke=_(he.adamId,Se,Ie);ve.pageUrl=ke;const be=new te.InAppPurchaseInstallPage;me.enabled("installSheetParentInSidepack")&&(be.parentLockup=de.shallowCopyOf(he.parent)),be.lockup=de.shallowCopyOf(he),be.preInstallOfferDescription=X.installPagePreInstallTrialDescription(Ae),be.bannerMessage=Ie,ve.pageData=be;const _e=$.asString(ge,"offerName"),we=$.asString(ye,"bundleId"),Ee=$.asString(ye,"firstVersionSupportingInAppPurchaseApi");if(Ee){const Fe=new te.InAppPurchaseAction(_e,Se,we,ve,Ee);he.parent&&(Fe.appTitle=he.parent.title),Fe.productTitle=he.title;const Re=Object.assign({},Pe.metricsOptions,{id:he.adamId,idType:"its_id",actionDetails:{parentAdamId:Se}});oe.addClickEventToAction(Fe,Re),he.buttonAction=Fe}else{const Fe=new te.AlertAction("default");Fe.title=le.string("SEED_IN_APP_UNSUPPORTED_MESSAGE_OPTION_1"),Fe.message="",Fe.isCancelable=!0,he.buttonAction=Fe}const Ce=oe.impressionOptionsForLockup(ge,he,Pe.metricsOptions);if(!Pe||!Pe.skipDefaultClickAction){const Fe=z(ge,Ce);he.clickAction=Fe,he.productAction=Fe}oe.addImpressionFieldsToInAppPurchaseLockup(he,Ce)}},"item.offer.buyParams")}function y(ge,he,Pe,Se){ge&&ee.context("copyPlatformDataIntoTrailersLockup",()=>{h(ge,he,Se),he.trailers=Z.trailersFromApiPlatformData(ge,Pe,Se.metricsOptions,he.adamId)})}function A(ge,he,Pe,Se){ge&&ee.context("copyMediaIntoMixedMediaLockup",()=>{he.screenshots=Z.screenshotsFromPlatformData(ge),he.trailers=[];const ye=Z.trailersFromApiPlatformData(ge,Pe,Se.metricsOptions,he.adamId);ye&&he.trailers.push(ye)})}function T(ge,he,Pe,Se){ge&&ee.context("copyMediaIntoAppTrailersLockup",()=>{I(ge,he,Se);const ye=$.asArrayOrEmpty(ge,"videoPreviewByTypeList"),Ae=ye&&ye.length?ye[0]:null;he.trailers=Z.videoSetFromApiVideoPreview(Ae);const Te=Z.videoPreviewsFromApiPlatformData(ge);if(he.allowsAutoPlay=Pe,Te&&0<Te.length){const ve=Te[0];oe.addMetricsEventsToVideo(ve,Object.assign({},Se.metricsOptions,{id:he.adamId})),he.trailer=ve}else he.trailer=null})}function I(ge,he,Pe){ge&&ee.context("copyScreenshotsIntoScreenshotsLockup",()=>{h(ge,he,Pe),he.screenshots=Z.screenshotsFromPlatformData(ge)})}function k(ge){return ee.context("subtitleFromPlatformData",()=>{const he=$.asString(ge,"subtitle");if(he)return he;const Pe=$.asArrayOrEmpty(ge,"genres"),Se=Pe.length;if(0===Se)return null;let ye=Pe[0];const Ae=ie.GenreIds.Games.toString(),Te=$.asString(ye,"genreId");if(Te===Ae)for(const ve of Pe){const Ie=$.asString(ve,"genreId"),ke=$.asString(ve,"parentGenreId");if(Ie!==Ae&&ke===Ae){ye=ve;break}}return $.asString(ye,"name")})}function _(ge,he,Pe){const Se=new ne.FormBuilder().param(se.Parameters.id,he).param(se.InAppPurchaseInstallPageParameters.inAppPurchaseId,ge).param(se.InAppPurchaseInstallPageParameters.bannerMessage,Pe).build();return`${se.Protocol.internal}:/${se.Path.product}/${se.Path.install}/?${Se}`}function w(ge,he,Pe){const Se=new ne.FormBuilder().param(se.ProductPageParameters.url,ge).param(se.Parameters.offerName,he).param(se.ProductPageParameters.isSubscription,Pe.toString()).build();return`${se.Protocol.internal}:/${se.Path.product}/${se.Path.lookup}/?${Se}`}function E(ge,he){return ee.context("lockupFromPlatformData",()=>{if(!ge)return ee.unexpectedNull("ignoredValue","data"),null;const Pe=$.asString(ge,"kind");switch(Pe){case"softwareAddOn":return C(ge,he);case"mobileSoftwareBundle":return F(ge,he);default:const Se=new te.Lockup;return h(ge,Se,he),Se;}})}function C(ge,he){return ee.context("inAppPurchaseLockupFromPlatformData",()=>{const Pe=new te.InAppPurchaseLockup;return S(ge,Pe,he),Pe})}function F(ge,he){return ee.context("bundleLockupFromPlatformData",()=>{const Pe=new te.BundleLockup;return P(ge,Pe,he),Pe})}function M(ge,he){const Pe=new Set(he),Se=[],ye=[],Ae=function(Te,ve){if(0===Pe.size)return!1;for(const Ie of he)if(Ie===ve||-1!==Te.indexOf(Ie))return Pe.delete(Ie),!0;return!1};if(he.length&&(ge.screenshots.length||ge.trailers.length)){if(ge.trailers.length)for(const Te of ge.trailers[0].videos)Ae(Te.videoUrl,Te.preview.checksum)&&Se.push(Te);if(ge.screenshots.length)for(const Te of ge.screenshots[0].artwork)Ae(Te.template,Te.checksum)&&ye.push(Te)}return 0===Pe.size&&(Se.length||ye.length)&&(ge.trailers.length&&(ge.trailers[0].videos=Se),ge.screenshots.length&&(Se.length&&ye.push(new te.Artwork("",100,100)),ge.screenshots[0]=new te.Screenshots(ye,ge.screenshots[0].mediaPlatform)),!0)}function U(ge,he){const Pe=new Set(he);let Se=null;const ye=[],Ae=function(Te,ve){if(0===Pe.size)return!1;for(const Ie of he)if(Ie===ve||-1!==Te.indexOf(Ie))return Pe.delete(Ie),!0;return!1};if(he.length&&(ge.screenshots.length||null!=ge.trailer)&&(ge.trailer&&Ae(ge.trailer.videoUrl,ge.trailer.preview.checksum)&&(Se=ge.trailer),ge.screenshots.length))for(const Te of ge.screenshots[0].artwork)Ae(Te.template,Te.checksum)&&ye.push(Te);return 0===Pe.size&&(Se||ye.length)&&(ge.trailer=Se,ge.screenshots.length&&(Se&&ye.push(new te.Artwork("",100,100)),ge.screenshots[0]=new te.Screenshots(ye,ge.screenshots[0].mediaPlatform)),!0)}function V(ge,he,Pe=!1){const Se=$.asString(ge,"kind");return ee.context(`actionFromPlatformData: ${Se}`,()=>{switch(Se){case"iosSoftware":case"mobileSoftwareBundle":return H(ge,he,Pe);case"softwareAddOn":return z(ge,he);case"editorialItem":return j(ge,he);case"multipleSystemOperator":return q(ge,he);case"artist":case"grouping":default:return G(ge,he);}})}function z(ge,he){return ee.context("iAPActionFromPlatformData",()=>{const Pe=$.asString(ge,"softwareAdamIds.0","coercible"),Se=$.traverse(ge,"software"),ye=Se?Se[Pe]:null;if(!ye)return null;const Ae=new te.FlowAction("product"),Te=$.asString(ye.url),ve=$.asString(ge,"offerName"),Ie=$.asBooleanOrFalse(ge,"isSubscription");return Ae.pageUrl=w(Te,ve,Ie),Ae.title=$.asString(ge,"name"),oe.addClickEventToAction(Ae,he),Ae})}function j(ge,he){return ee.context("editorialItemActionFromPlatformData",()=>{const Pe=$.asString(ge,"id","coercible"),Se=$.traverse(ge,"link"),ye=$.asNumber(Se,"kindId","coercible"),Ae=$.asString(Se,"url");if(W(Se))return Y(ge,he);let Te;switch(ye){case ie.ContentKinds.EditorialItem:{Te="article";break}case ie.ContentKinds.Software:{const ke=$.traverse(ge,"relatedContent",{}),be=$.asArrayOrEmpty(ge,"cardIds");if(1===be.length){const _e=be[0],we=ke[_e];return V(we,he)}Te="product";break}default:{Te="unknown";break}}const ve=new te.FlowAction(Te);ve.pageUrl=Ae;let Ie=ue.itunesNotes(ge,"name");return $.isNull(Ie)&&(Ie=$.asString(ge,"label")),ve.title=Ie,oe.addClickEventToAction(ve,he),ve})}function H(ge,he,Pe=!1){return ge?ee.context("productActionFromPlatformData",()=>{let Se=$.asString(ge,"url");if(!Se)return ee.unexpectedNull("ignoredValue","string","url"),null;if(he.isAdvert){const Te=he.pageInformation.iAdInfo.clickFields,ve=new se.URL(Se);ve.param(oe.iAdURLParameterStringToken,JSON.stringify(Te));const Ie=$.asString(ge,"iad.lineItem");null!==Ie&&0<Ie.length&&ve.param(oe.iAdURLLineItemParameterStringToken,Ie),Se=ve.toString()}const ye=ae.productPageSidePackLockup(ge,null,Pe),Ae=new te.FlowAction("product");return Ae.pageUrl=Se,Ae.pageData=ye,Ae.title=$.asString(ge,"name"),he&&he.pageInformation&&(Ae.referrerUrl=he.pageInformation.pageUrl),X.isPreorderFromPlatformData(ge)?oe.addClickEventToAction(Ae,Object.assign({},he,{offerType:"preorder",offerReleaseDate:X.expectedReleaseDateFromPlatformData(ge)})):oe.addClickEventToAction(Ae,he),Ae}):null}function q(ge,he){return ge?ee.context("msoActionFromPlatformData",()=>{const Pe=$.asString(ge,"url");if(!Pe)return ee.unexpectedNull("ignoredValue","string","url"),null;const Se=new te.FlowAction("mso");return Se.pageUrl=Pe,Se.title=$.asString(ge,"name"),oe.addClickEventToAction(Se,he),Se}):null}function G(ge,he){return ge?ee.context("genericActionFromPlatformData",()=>{const Pe=$.asString(ge,"kind"),Se=$.asString(ge,"url");if(!Se)return ee.unexpectedNull("ignoredValue","string","url"),null;const ye=new te.FlowAction("page");return ye.pageUrl=Se,ye.title="grouping"===Pe?Q(ge):$.asString(ge,"name"),oe.addClickEventToAction(ye,he),ye}):null}function W(ge){const he=$.asString(ge,"target");return he&&"external"===he}function Y(ge,he){return ee.context("editorialItemExternalLinkActionFromPlatformData",()=>{const Pe=$.traverse(ge,"link"),Se=$.asString(Pe,"url"),ye=new te.ExternalUrlAction(Se),Ae=ue.itunesNotes(ge,"short");if(Ae)ye.title=Ae;else{const Te=new se.URL(Se);ye.title=Te.host}return oe.addClickEventToAction(ye,he),ye})}function Q(ge){const he=$.asArrayOrEmpty(ge,"genres");if(he&&0<he.length){const Pe=he[0];return $.asString(Pe,"name")}return $.asString(ge,"name")}Object.defineProperty(d,"__esModule",{value:!0});const X=s("./offers"),Z=s("./content"),$=s("../data/server-data"),ee=s("../data/validation"),te=s("../models"),ae=s("./product-pages"),ie=s("../util/constants"),oe=s("../metrics/helpers"),ne=s("../data/http"),se=s("../data/urls"),le=s("../util/localization"),de=s("../util/objects"),ce=s("./filtering"),pe=s("../wrappers/client"),ue=s("./today"),me=s("../util/properties"),fe=s("../builders/reviews");d.forTesting={copyPlatformDataIntoLockup:h},d.subtitleFromPlatformData=k,d.configureIAPInstallPageUrl=_,d.configureProductUrlFromInAppPurchase=w,d.lockupFromPlatformData=E,d.inAppPurchaseLockupFromPlatformData=C,d.bundleLockupFromPlatformData=F,d.screenshotsLockupFromPlatformData=function(ge,he){return ee.context("screenshotsLockupFromPlatformData",()=>{const Pe=new te.ScreenshotsLockup;return h(ge,Pe,he),I(ge,Pe,he),Pe})},d.appTrailersLockupFromPlatformData=function(ge,he){return ee.context("appTrailersLockupFromPlatformData",()=>{const Pe=new te.AppTrailersLockup;return h(ge,Pe,he),T(ge,Pe,!0,he),Pe})},d.trailersLockupFromPlatformData=function(ge,he){return ee.context("trailerLockupFromPlatformData",()=>{const Pe=new te.TrailersLockup;return y(ge,Pe,!0,he),Pe})},d.mixedMediaLockupFromPlatformData=function(ge,he){return ee.context("mixedMediaLockupFromPlatformData",()=>{const Pe=new te.MixedMediaLockup;return h(ge,Pe,he),A(ge,Pe,!0,he),Pe})},d.adLockupFromPlatformData=function(ge,he){return ee.context("advertisingLockupFromPlatformData",()=>{const Pe=$.asString(ge,"iad.lineItem"),Se=$.asString(ge,"iad.impressionId"),ye=$.asString(ge,"iad.privacy"),Ae=new te.AdTransparencyAction(ye);Ae.title=le.string("IAD_PRIVACY_MARKER_BUTTON_TITLE");const Te=new te.AdLockup(Pe,Se,Ae);if(!$.asBooleanOrFalse(ge,"iad.format.images"))h(ge,Te,he),Te.screenshots=null;else{A(ge,Te,!0,he);const Ie=$.asArrayOrEmpty(ge,"iad.assetOverride");if(Ie.length){const ke=M(Te,Ie);$.asBooleanOrFalse(he,"metricsOptions.pageInformation.iAdInfo.iAdIsPresent")&&he.metricsOptions.pageInformation.iAdInfo.setSpecifiedCreativeUsed(ke)}h(ge,Te,he)}Te.offerDisplayProperties&&(Te.offerDisplayProperties=me.enabled("adOfferEnvironment")?Te.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"colored","ad"):Te.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"white")),$.asBooleanOrFalse(ge,"iad.format.userRating")||(Te.rating=null,Te.ratingCount=null);const ve=$.asString(ge,"iad.format.text");return"none"!==ve&&("description"===ve?Te.advertisingText=$.asString(ge,"description.standard"):Te.advertisingText=$.asString(ge,ve)),Te.iconStyle="regular"===$.asString(ge,"iad.format.icon")?"regular":"small",Te})},d.advertisingLockupFromPlatformData=function(ge,he){return ee.context("advertisingLockupFromPlatformData",()=>{const Pe=$.asString(ge,"iad.lineItem"),Se=$.asString(ge,"iad.impressionId"),ye=$.asString(ge,"iad.privacy"),Ae=new te.AdTransparencyAction(ye);Ae.title=le.string("IAD_PRIVACY_MARKER_BUTTON_TITLE");const Te=new te.AdvertisingLockup(Pe,Se,Ae);if(!$.asBooleanOrFalse(ge,"iad.format.images"))h(ge,Te,he),Te.screenshots=null;else{T(ge,Te,!0,he);const ve=$.asArrayOrEmpty(ge,"iad.assetOverride");if(ve.length){const Ie=U(Te,ve);$.asBooleanOrFalse(he,"metricsOptions.pageInformation.iAdInfo.iAdIsPresent")&&he.metricsOptions.pageInformation.iAdInfo.setSpecifiedCreativeUsed(Ie)}h(ge,Te,he)}return Te.offerDisplayProperties&&(Te.offerDisplayProperties=me.enabled("adOfferEnvironment")?Te.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"colored","ad"):Te.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"white")),$.asBooleanOrFalse(ge,"iad.format.userRating")||(Te.rating=null,Te.ratingCount=null),"description"===$.asString(ge,"iad.format.text")?Te.advertisingText=$.asString(ge,"description.standard"):"promotionalText"===$.asString(ge,"iad.format.text")&&(Te.advertisingText=$.asString(ge,"promotionalText")||$.asString(ge,"description.standard")),Te.iconStyle="regular"===$.asString(ge,"iad.format.icon")?"regular":"small",Te})},d.applyAssetOverridesToAdvertisingLockup=U,d.lockupsFromPlatformData=function(ge,he,Pe){return ee.context("lockupsFromPlatformData",()=>{if(!ge)return[];const Se=[];let ye=-1;if(!Pe.shouldConsiderDataPastLastAvailable)for(let Ae=0;Ae<he.length;Ae++){const Te=he[Ae],ve=ge[Te];ve&&(ye=Ae)}for(let Ae=0;Ae<he.length;Ae++){const Te=ee.catchingContext(`lockupsFromPlatformData[${Ae}]`,()=>{const ve=he[Ae],Ie=ge[ve];if(!Ie){if(Ae>ye&&Pe&&Pe.contentUnavailable){const _e=Pe.contentUnavailable(ve,Ae);if(!_e)return!0}return!1}const ke=Pe.lockupOptions;let be=ce.Filter.All;if(Pe.includeOrdinals){const _e="descending"===Pe.ordinalDirection?he.length-Ae:Ae+1;ke.ordinal=_e.toString()}if(null!==Pe.filter&&(be=Pe.filter),ce.shouldFilter(Ie,be))return!1;if(Pe.excludeIconInSidepacksIfNotTvOnly){const _e=$.asArrayOrEmpty(Ie,"deviceFamilies"),we=1===_e.length&&-1!==_e.indexOf("tvos");we||(ke.ignoreIconInSidepack=!0)}return Se.push(E(Ie,ke)),Pe&&void 0!==Pe.shouldIgnoreLocationIncrement&&Pe.shouldIgnoreLocationIncrement||oe.nextPosition(ke.metricsOptions.locationTracker),!1},()=>{return!1});if(Te)break}return Se})},d.actionFromPlatformData=V,d.editorialItemActionFromPlatformData=j,d.shallowCopyLockupsOverridingProperties=function(ge,he){if(!ge)return null;const Pe=[];for(const Se of ge){const ye=de.shallowCopyOf(Se);he&&ye.offerDisplayProperties&&(ye.offerDisplayProperties=ye.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,he)),Pe.push(ye)}return Pe},d.nameFromGroupingData=Q,d.deviceHasCapabilitiesFromPlatformData=function(ge){if(!ge)return!1;const he=$.asString(ge,"requiredCapabilities");if(!he)return!0;const Pe=he.split(" ");return pe.deviceHasCapabilities(Pe)}},{"../builders/reviews":84,"../data/http":99,"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/constants":142,"../util/localization":145,"../util/objects":146,"../util/properties":147,"../wrappers/client":152,"./content":72,"./filtering":74,"./offers":79,"./product-pages":83,"./today":96}],77:[function(s,l,d){"use strict";function h(N){return M.context("msoProviderArtworkFromPlatformData",()=>{const U=E.traverse(N,"editorialArtwork.storeFlowcase");if(U)return C.artworkFromApiArtwork(U);const B=E.traverse(N,"artwork");return C.artworkFromApiArtwork(B)})}function P(N){const U=E.traverse(N,"editorialArtwork.bannerUber");return U?C.artworkFromApiArtwork(U):null}function _(N,U,B,V=[]){return M.context("msoRoomPageWithContext",()=>{const z=B.ids,j=[],H=[];for(const J of z)-1===U.indexOf(J)?H.push(J):j.push(J);const q=O.newLocationTracker(),G={lockupOptions:{metricsOptions:{pageInformation:B.metricsPageInformation,locationTracker:q}}},W=[],Y={pageInformation:B.metricsPageInformation,locationTracker:q,targetType:"swoosh",idType:"sequential",id:"0"};if(0<j.length){const J=R.string("MSO_INCLUDED_IN_SUBSCRIPTION");Y.id="0",O.pushContentLocation(Y,J);const X=new w.Shelf("mediumLockup");X.title=J,X.shouldFilterApps=B.shouldFilter,X.items=L.lockupsFromPlatformData(N,j,G),O.popLocation(q),O.nextPosition(q),W.push(X)}if(0<j.length&&0<H.length){const J=R.string("MSO_AVAILABLE_WITH_UPGRADED_SUBSCRIPTION");Y.id="1",O.pushContentLocation(Y,J);const X=new w.Shelf("mediumLockup");X.title=J,X.shouldFilterApps=B.shouldFilter,X.items=L.lockupsFromPlatformData(N,H,G),O.popLocation(q),O.nextPosition(q),W.push(X)}if(0===W.length){Y.id="0",O.pushContentLocation(Y,null);const J=new w.Shelf("mediumLockup");J.shouldFilterApps=B.shouldFilter,J.items=L.lockupsFromPlatformData(N,z,G),O.popLocation(q),O.nextPosition(q),W.push(J)}for(const J of W)J.isHorizontal=1<W.length;const K=V.concat(W),Q=new w.GenericPage(K);return Q})}Object.defineProperty(d,"__esModule",{value:!0});const w=s("../models"),E=s("../data/server-data"),C=s("./content"),F=s("../data/urls"),R=s("../util/localization"),O=s("../metrics/helpers"),D=s("./room-common"),x=s("./room"),L=s("./lockups"),M=s("../data/validation");d.msoProviderDataFromPlatformData=function(N){return M.context("msoProviderDataFromPlatformData",()=>{const U=E.asString(N,"name"),B=E.asString(N,"url"),V=h(N);V&&(V.crop="sr");const z=P(N);return new w.MSOProviderData(U,B,V,z)})},d.msoProviderArtworkFromPlatformData=h,d.msoProviderUberArtworkFromPlatformData=P,d.assembleMSOAppsUrl=function(N){const U=`https://itunes.apple.com/WebObjects/MZStore.woa/wa/multipleSystemOperatorApps`;return F.URL.from(U).param(F.Parameters.id,N).build()},d.msoAppsFromResponse=function(N){return M.context("msoAppsFromResponse",()=>{const U=E.asArrayOrEmpty(N,"apps"),B={};for(const z of U){const j=E.traverse(z,"id"),H=E.traverse(z,"channelIds");null!==j&&null!==H&&(B[j]=H)}const V=E.asArrayOrEmpty(N,"appsToAlwaysShow").map(z=>E.asString(z));return new w.MSOAppsResponse(B,V)})},d.availableAdamIdsFromAppsResponse=function(N,U){const B=N.appsToAlwaysShow;for(const V of Object.keys(N.apps)){const z=N.apps[V];for(const j of z)if(-1!==U.indexOf(j)){B.push(V);break}}return B},d.assembleMSOPageUrl=function(N,U){if(0===U.length)return N;const B=U.join(",");return F.URL.from(N).param(F.MSOPageParameters.availableAdamIds,B).build()},d.extractAvailableAdamIdsFromParameters=function(N){const U=N[F.MSOPageParameters.availableAdamIds];return U?U.split(","):[]},d.msoRoomPageWithResponse=function(N,U,B){return M.context("msoRoomPageWithResponse",()=>{const V=E.traverse(N,"pageData"),z=E.traverse(N,"storePlatformData.lockup.results",{}),j=O.metricsPageInformationFromResponse(N),H=E.asArrayOrEmpty(V,"adamIds"),q=!E.asBooleanOrFalse(V,"doNotFilter"),G=new x.RoomPageToken;G.ids=H.map(String),G.shouldFilter=!E.asBooleanOrFalse(V,"doNotFilter"),G.metricsPageInformation=j;const W=[],Y=D.descriptionShelfFromPageData(V);Y&&W.push(Y);const K=_(z,B,G,W);return K.title=E.asString(V,"pageTitle"),K.uber=D.uberArtFromPageData(V),O.copyMetricsEventsIntoPageWithInformation(K,j),K})},d.msoRoomPageWithContext=_},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"./content":72,"./lockups":76,"./room":86,"./room-common":85}],78:[function(s,l,d){"use strict";function h(w,E,C,F){return k.context("multiRoomPageWithContext",()=>{const R=C,O=[];let D=[],x=0;const L=I.newLocationTracker(),M={pageInformation:F,locationTracker:L};for(const U of w){const B=S.asArrayOrEmpty(U,"adamIds"),V=S.asString(U,"title"),z=S.traverse(U,"seeAllUrl");I.pushContentLocation(Object.assign({},M,{targetType:"swoosh",id:`${x}`,idType:"sequential"}),V);const j=new P.Shelf("mediumLockup");j.isHorizontal=!0,j.title=V;let H=!1;if(j.items=y.lockupsFromPlatformData(E,B,{contentUnavailable:()=>{return O.push(U),D=D.concat(B),H=!0,!1},lockupOptions:{metricsOptions:M}}),I.popLocation(L),I.nextPosition(L),!H){const q=new P.FlowAction("page");q.title=S.asString(z,"label"),q.pageUrl=S.asString(z,"url"),I.addClickEventToSeeAllAction(q,q.pageUrl,M),j.seeAllAction=q,R.push(j),x++}}const N=new P.GenericPage(R);if(O.length){const U=new _;U.missingSegments=O,U.ids=D,U.url=`${A.Protocol.internal}:/${A.Path.multiRoom}/${A.Path.lookup}/`,U.metricsPageInformation=F,U.metricsLocationTracker=L,N.nextPage=U}return N})}Object.defineProperty(d,"__esModule",{value:!0});const P=s("../models"),S=s("../data/server-data"),y=s("./lockups"),A=s("../data/urls"),T=s("./room-common"),I=s("../metrics/helpers"),k=s("../data/validation");class _{constructor(){this.missingSegments=[],this.profile="lockup",this.maxPerPage=50}}d.MultiRoomPageToken=_,d.multiRoomPageWithResponse=function(w){return k.context("multiRoomPageWithResponse",()=>{const E=S.traverse(w,"pageData"),C=S.asArrayOrEmpty(E,"segments"),F=S.traverse(w,"storePlatformData.lockup.results"),R=I.metricsPageInformationFromResponse(w),O=[],D=T.descriptionShelfFromPageData(E);D&&O.push(D);const x=h(C,F,O,R);return x.title=S.asString(E,"pageTitle"),I.copyMetricsEventsIntoPageWithInformation(x,R),x})},d.multiRoomPageWithContext=h},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"./lockups":76,"./room-common":85}],79:[function(s,l,d){"use strict";function g(X,Z,$,ee,te){return V.context("purchaseConfigurationFromProduct",()=>{const ae=B.asString(X,"name");let ie=B.asString(X,"artistName");ie||(ie="test");const oe=B.asString(X,"bundleId"),ne=z.supportedAppPlatformsFromPlatformData(X),se=B.asString(X,"iad.lineItem"),le=new U.PurchaseConfiguration(Z,ie,ae,oe,ne,$,ee,se);return le.pageInformation=te,le})}function y(X){return V.context("isPreorderFromOfferData",()=>{const Z=B.asString(X,"type");return"preorder"===Z})}function T(X){return B.isNull(X)||B.isNull(X.purchaseConfiguration)?!1:X.purchaseConfiguration.isPreorder}function k(X){const Z=B.asString(X,"type");return"buy"===Z||"complete"===Z||"preorder"===Z?B.asNumber(X,"price"):null}function _(X,Z,$){return V.context("offerActionFromOfferData",()=>{const ee=B.asString(X,"type"),te=X.actionText,ae=B.traverse(te,"short",ee);let ie=null,oe=null;const ne=k(X);0<ne&&(ie=ne,oe=B.asString(X,"priceFormatted"));const se=B.asString(X,"expectedReleaseDate"),le=K.parseDateOmittingTimeFromString(se),de=new U.OfferAction(ae,Z,$);return de.price=ie,de.priceFormatted=oe,de.expectedReleaseDate=le,de})}function w(X,Z,$,ee=!1){if(B.isNull(X))return null;const te=Y.actionFromPlatformData(Z,$,ee);if(!te)return X;const ae=new U.AppStateAction(X.adamId,te);return ae.buyAction=X,ae}function C(X,Z){const $=new U.AlertAction("default");$.title=G.string("BUY_TV_ONLY_ALERT_TITLE"),"BUY_TV_ONLY_ALERT_TITLE"===$.title&&($.title="This will download to Apple\xA0TV."),$.message=G.string("BUY_TV_ONLY_ALERT_MESSAGE"),"BUY_TV_ONLY_ALERT_MESSAGE"===$.message&&($.message="If the download doesn\u2019t start automatically, open the App\xA0Store on your Apple\xA0TV, then go to Purchased and select the app."),$.isCancelable=!0,$.buttonActions=Z?[F(X)]:[X],$.buttonTitles=[G.string("BUY_TV_ONLY_ALERT_BUTTON_TITLE")],"BUY_TV_ONLY_ALERT_BUTTON_TITLE"===$.buttonTitles[0]&&($.buttonTitles=["Continue"]);const ee=new U.AppStateAction(X.adamId,$);return ee.title=X.title,ee}function F(X){const Z=new U.AlertAction("default");return Z.title=G.string("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_TITLE"),Z.message=G.string("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_MESSAGE"),Z.buttonTitles=[G.string("BUY_TV_GAME_CONTROLLER_REQUIRED_ALERT_BUTTON_TITLE")],Z.isCancelable=!0,Z.buttonActions=[X],Z}function R(X){if(B.isNull(X))return null;const Z=new U.AlertAction("default");B.isNull(X.priceFormatted)?(Z.title=G.string("GET"),Z.message="Are you sure you want to get "+X.purchaseConfiguration.appName):(Z.title="Buy App",Z.message=`Are you sure you want to buy ${X.purchaseConfiguration.appName} for ${X.priceFormatted}`),Z.isCancelable=!0,Z.buttonActions=[X];const $=new U.AppStateAction(X.adamId,X);return $.buyAction=Z,$}function M(X){if(!X)return null;const Z=X.match(/P(\d+)([A-Z]+)/);if(!Z||3!==Z.length)return null;let $=B.asNumber(Z[1]),ee=Z[2];return $&&ee?("D"===ee&&0<$&&0==$%J&&(ee="W",$/=J),new Q($,ee)):null}function N(X,Z,$){if(B.isNull(X)||B.isNull(Z))return null;const ee={D:"DAYS",W:"WEEKS",M:"MONTHS",Y:"YEARS"},ae=ee[X.type],ie=ee[Z.type],oe={FreeTrial:"FREE_TRIAL",PayUpFront:"PAID_UPFRONT",PayAsYouGo:"PAID_TRIAL"}[$];return ae&&ie&&oe?`IN_APP_OFFER_PAGE_DESCRIPTION_${oe}_${ae}_POST_TRIAL_${ie}`:null}Object.defineProperty(d,"__esModule",{value:!0});const U=s("../models"),B=s("../data/server-data"),V=s("../data/validation"),z=s("./content"),j=s("../metrics/helpers"),H=s("../util/properties"),q=s("../wrappers/client"),G=s("../util/localization"),W=s("./filtering"),Y=s("./lockups"),K=s("../util/date-util");class Q{constructor(X,Z){this.period=X,this.type=Z}isEqualTo(X){return X.period===this.period&&X.type===this.type}}d.SubscriptionRecurrence=Q,d.offerDataFromPlatformData=function(X){return V.context("offerDataFromPlatformData",()=>{const Z=B.asArrayOrEmpty(X,"offers");return 0===Z.length?null:Z[0]})},d.updateOfferDataFromPlatformData=function(X){return V.context("updateOfferDataFromPlatformData",()=>{const Z=B.asArrayOrEmpty(X,"offers");if(0===Z.length)return null;for(const $ of Z){const ee=B.asString($,"type");if("update"===ee)return $}return null})},d.offerActionFromOfferData=function(X,Z,$){return V.context("offerActionFromPlatformData",()=>{let ee=B.asString(X,"buyParams");if(B.isNull(ee))return V.unexpectedNull("ignoredValue","string","item.offer.buyParams"),null;const te=B.asString(Z,"kind");"mobileSoftwareBundle"===te&&(0<=ee.indexOf("rebuy")?ee=ee.replace("rebuy=false","rebuy=true"):(0<ee.length&&(ee+="&"),ee+="rebuy=true"));const ae=B.asString(Z,"id");if(B.isNull(ae))return V.unexpectedNull("ignoredValue","string","item.offer.id"),null;const ie=y(X),oe=g(Z,ee,ie,$.excludeAttribution,$.pageInformation),ne=_(X,ae,oe);return j.addBuyEventToOfferActionOnPage(ne,$),ne})},d.isPreorderFromOfferData=y,d.isPreorderFromPlatformData=function(X){return V.context("isPreorderFromPlatformData",()=>{const Z=B.asArrayOrEmpty(X,"offers");if(0===Z.length)return!1;const $=Z[0];return y($)})},d.isPreorderFromOfferAction=T,d.expectedReleaseDateFromPlatformData=function(X){return V.context("expectedReleaseDateFromPlatformData",()=>{const Z=B.asString(X,"offers.0.expectedReleaseDate");return K.parseDateOmittingTimeFromString(Z)})},d.priceFromOfferData=k,d.wrapOfferActionIfNeeded=function(X,Z,$,ee,te=!1){const ae=T(X);if(ae&&$)return w(X,Z,ee);const ie=B.asArrayOrEmpty(Z,"deviceFamilies");if(ie){const oe=1===ie.length&&-1!==ie.indexOf("tvos");if(oe){const ne=B.asBooleanOrFalse(Z,"requiresGameController");return C(X,ne)}}return H.enabled("newPaymentMethod")?q.newPaymentMethodEnabled?X:R(X):R(X)},d.displayPropertiesFromOfferAction=function(X,Z,$,ee,te,ae,ie,oe){return B.isNull(X)?null:V.context("offerItemFromPlaformData",()=>{let ne=ee;const se=W.shouldFilter($,W.Filter.Offers),le=B.asString($,"kind");(se||"desktopApp"===le)&&(ne="disabled");const de=T(X);de&&!H.enabled("preorders")&&(ne="disabled");const ce=Y.deviceHasCapabilitiesFromPlatformData($);ce||(ne="disabled");const pe=B.asString($,"softwareAdamIds.0","coercible");let ue=new U.OfferDisplayProperties(Z,X.adamId,ne,pe,te);de&&(ue.offerLabelStyle="preorder");const me=!(0<X.price);ue.isFree=me;let fe=null;if(fe=me?X.title:X.priceFormatted,ue.title=fe,ue.titles.standard=fe,ie){const Se=B.asString(ie,"modeType"),ye=B.asString(ie,"priceFormatted");if(!B.isNull(ye)&&!B.isNull(Se)){let Ae=null,Te=null;switch(Se){case"FreeTrial":oe?(Ae=G.string("INTRO_PRICE_OFFER_FREE_TRIAL"),Te=G.string("INTRO_PRICE_OFFER_FREE_TRIAL")):(Ae=G.string("INTRO_PRICE_OFFER_FREE_TRIAL"),Te=G.string("INTRO_PRICE_OFFER_TRIAL"));break;case"PayUpFront":const ve=G.string("INTRO_PRICE_OFFER_PAID_UPFRONT_TRIAL").replace("{price}",ye);oe?(Ae=ve,Te=ve):(Ae=ve,Te=G.string("INTRO_PRICE_OFFER_TRIAL"));break;case"PayAsYouGo":oe?(Ae=G.string("INTRO_PRICE_OFFER_TRIAL"),Te=G.string("INTRO_PRICE_OFFER_TRIAL")):(Ae=G.string("INTRO_PRICE_OFFER_TRIAL"),Te=G.string("INTRO_PRICE_OFFER_TRIAL"));break;default:}if(ue.titles.discountOwnedParent=Ae,ue.titles.discountUnownedParent=Te,ue.subtitles.discountOwnedParent=G.string("INTRO_PRICE_OFFER_SUBTITLE"),ue.subtitles.discountUnownedParent=G.string("INTRO_PRICE_OFFER_SUBTITLE"),H.enabled("widthConstrainedLockup")){let Ie=!1;for(const ke of Object.keys(ue.titles)){const be=ue.titles[ke];if(be.length>10){Ie=!0;break}}Ie&&(ue=ue.newOfferDisplayPropertiesChangingAppearance(!1,null,"widthConstrainedLockup"))}}}const ge=B.asBooleanOrFalse($,"hasInAppPurchases");if(ue.hasInAppPurchases=ge,ge){const Se=G.string("INLINE_IN_APP_PURCHASES");ue.subtitle=Se,ue.subtitles.standard=Se}ue.subtitlePosition=ae;const he=B.asBooleanOrFalse($,"isFirstPartyHideableApp");ue.isDeletableSystemApp=he;const Pe=B.asNumber($,"contentRatingsBySystem.appsApple.value");return ue.contentRating=Pe,"mobileSoftwareBundle"===le&&(ue.offerToken=X),ue})},d.personalizedOfferTypeFromBuyButtonMetadata=function(X){return V.context("personalizedOfferTypeFromBuyButtonMetadata",()=>{const Z=B.asArrayOrEmpty(X,"offers");if(0===Z.length)return null;for(const $ of Z){const ee=B.asString($,"type");if(ee)return ee}return"none"})},d.personalizedOfferActionFromBuyButtonMetadataResponse=function(X,Z){return V.context("personalizedOfferActionFromBuyButtonMetadataResponse",()=>{const $=B.asArrayOrEmpty(X,"offers");if(0===$.length)return null;let te=null,ee;for(const se of $)switch(ee=B.asString(se,"type"),ee){case"complete":case"purchased":te=se;break;default:te=null;}if(!te)return null;let ae=B.asString(te,"buyParams");if("complete"===ee&&B.isNull(ae))return V.unexpectedNull("ignoredValue","string","item.offer.buyParams"),null;ae||(ae="");const ie=Z.purchaseConfiguration,oe=new U.PurchaseConfiguration(ae,ie.vendor,ie.appName,ie.bundleId,ie.appPlatforms,ie.isPreorder,ie.excludeAttribution);oe.pageInformation=ie.pageInformation;const ne=_(te,Z.adamId,oe);return j.addBuyEventToOfferActionInheritingMetrics(ne,Z),ne})},d.installPagePreInstallTrialDescription=function(X){const Z=B.asArrayOrEmpty(X,"discounts")[0];if(!Z)return null;const $=B.asString(Z,"recurringSubscriptionPeriod"),ee=B.asString(X,"recurringSubscriptionPeriod");if(!$||!ee)return null;const te=B.asNumber(Z,"price"),ae=B.asString(Z,"modeType"),ie=M($),oe=M(ee),ne=N(ie,oe,ae);if(!ne)return null;const se=B.asString(Z,"priceFormatted"),le=B.asString(X,"priceFormatted"),de=B.asNumber(Z,"numOfPeriods"),ce=ie.period*de;switch(ae){case"FreeTrial":const pe=G.stringWithCounts(ne,[ce,oe.period]);if(pe)return pe.replace("{postTrialPrice}",le);break;case"PayUpFront":const ue=G.stringWithCounts(ne,[ce,oe.period]);if(ue)return ue.replace("{trialPrice}",se).replace("{postTrialPrice}",le);break;case"PayAsYouGo":const me=G.stringWithCounts(ne,[ie.period,ce,oe.period]);if(me)return me.replace("{trialPrice}",se).replace("{postTrialPrice}",le);break;default:return null;}return null};const J=7;d.subscriptionRecurrenceForServerRecurrence=M},{"../data/server-data":101,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/date-util":144,"../util/localization":145,"../util/properties":147,"../wrappers/client":152,"./content":72,"./filtering":74,"./lockups":76}],80:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const A=s("../data/urls");class T{constructor(){this.onboardingCardIds=[],this.onboardingCards=[]}}d.OnBoardingCardToken=T,d.assemblePageUrlWithOnboardingCardIds=function(I,k){if(0===k.length)return I;const _=k.join(",");return A.URL.from(I).param(A.TodayPageParameters.onboardingCardIds,_).build()},d.extractOnboardingCardIdsFromParameters=function(I){const k=I[A.TodayPageParameters.onboardingCardIds];return k?k.split(","):[]},d.makeOnBoardingCardToken=function(I,k){if(!I||!k)return null;const _=new T;for(const w of I){const E=k[w];E&&(E.isOnBoardingCard=!0,_.onboardingCards.push(E),_.onboardingCardIds.push(w))}return 0===I.length?null:_},d.isCardDataOnboardingCard=function(I){if(!I)return!1;const k=I.isOnBoardingCard;return!!k},d.cardIdsFromToken=function(I){return I?I.onboardingCardIds:null}},{"../data/urls":103}],81:[function(s,l,d){"use strict";function S(A,T){return A.slice(T,A.length)}Object.defineProperty(d,"__esModule",{value:!0}),d.suggestedMaxPerPage=20,d.getIdsForLookup=function(A){return A&&A.ids?A.ids.slice(0,A.maxPerPage):[]},d.getMetricsPageInformation=function(A){return A?A.metricsPageInformation:null},d.nextPageToken=function(A){let T=[];A&&A.ids&&(T=S(A.ids,A.maxPerPage));const I=Object.assign({},A);return I.ids=T,I},d.nextIdRange=S,d.createPageToken=function(A,T=null){return{ids:A,profile:"lockup",maxPerPage:d.suggestedMaxPerPage,highestOrdinal:0,url:T,metricsPageInformation:null,metricsLocationTracker:null}}},{}],82:[function(s,l,d){"use strict";function h(I,k){let _=0;for(const w of k){if(w.type===I.type){if("shelf"!==w.type)return _;if(w.shelfId===I.shelfId)return _}_+=1}return-1}Object.defineProperty(d,"__esModule",{value:!0});const S=s("../models"),y=s("../util/properties"),A=[new S.ProductPageSection("header"),new S.ProductPageSection("askToBuyRequest"),new S.ProductPageSection("shelf","banner"),new S.ProductPageSection("topLockup"),new S.ProductPageSection("accessibilityBadges"),new S.ProductPageSection("shelf","bundleChildren"),new S.ProductPageSection("shelf","bundleParents"),new S.ProductPageSection("shelf","mostRecentVersion"),new S.ProductPageSection("shelf","subscriptions"),new S.ProductPageSection("shelf","inAppPurchases"),new S.ProductPageSection("shelf","videos"),new S.ProductPageSection("screenshots"),new S.ProductPageSection("shelf","description"),new S.ProductPageSection("shelf","ratings"),new S.ProductPageSection("shelf","tapToRate"),new S.ProductPageSection("shelf","reviews"),new S.ProductPageSection("shelf","reviewActions"),new S.ProductPageSection("shelf","editorsChoice"),new S.ProductPageSection("shelf","information"),new S.ProductPageSection("shelf","links"),new S.ProductPageSection("shelf","capabilities"),new S.ProductPageSection("shelf","featuredIn"),new S.ProductPageSection("shelf","moreByDeveloper"),new S.ProductPageSection("shelf","similarItems"),new S.ProductPageSection("shelf","copyright")],T=[new S.ProductPageSection("header"),new S.ProductPageSection("askToBuyRequest"),new S.ProductPageSection("shelf","banner"),new S.ProductPageSection("topLockup"),new S.ProductPageSection("accessibilityBadges"),new S.ProductPageSection("shelf","bundleChildren"),new S.ProductPageSection("shelf","bundleParents"),new S.ProductPageSection("screenshots"),new S.ProductPageSection("shelf","description"),new S.ProductPageSection("shelf","videos"),new S.ProductPageSection("shelf","ratings"),new S.ProductPageSection("shelf","reviews"),new S.ProductPageSection("shelf","editorsChoice"),new S.ProductPageSection("shelf","mostRecentVersion"),new S.ProductPageSection("shelf","subscriptions"),new S.ProductPageSection("shelf","inAppPurchases"),new S.ProductPageSection("shelf","information"),new S.ProductPageSection("shelf","links"),new S.ProductPageSection("shelf","capabilities"),new S.ProductPageSection("shelf","featuredIn"),new S.ProductPageSection("shelf","moreByDeveloper"),new S.ProductPageSection("shelf","similarItems"),new S.ProductPageSection("shelf","copyright")];d.spotlightIndex=5,d.sectionOrdering=function(I,k){let _=[];_=I?A:T,_=_.slice();let w=d.spotlightIndex;if(!y.enabled("productPageSupportsSectionHeader")){const E=h(new S.ProductPageSection("header"),_);-1<E&&(w-=1,_.splice(E,1))}if(!y.enabled("productPageSupportsSectionAskToBuyRequest")){const E=h(new S.ProductPageSection("askToBuyRequest"),_);-1<E&&(w-=1,_.splice(E,1))}if(k&&k.spotlightSection){const E=h(k.spotlightSection,_);-1!==E&&(_.splice(E,1),_.splice(d.spotlightIndex,0,k.spotlightSection))}return _},d.inAppPurchaseSection=function(I){return I?new S.ProductPageSection("shelf","subscriptions"):new S.ProductPageSection("shelf","inAppPurchases")}},{"../models":121,"../util/properties":147}],83:[function(s,l,d){"use strict";function g(Oe){return Oe?Oe.map(De=>{return h(De,"detail")}):[]}function h(Oe,De){return le.context("titledParagraphFromVersionHistoryEntry",()=>{const xe=se.asString(Oe,"releaseNotes"),Le=new de.TitledParagraph(xe,De),Me=se.asString(Oe,"versionString"),Ne=ge.string("VERSION_STRING_TEMPLATE");switch(De){case"detail":Le.primarySubtitle=Me;break;default:Le.primarySubtitle=Ne.replace("{version}",Me);}const Ue=se.asString(Oe,"releaseDate");if(Ue){const Be=new Date(Ue);Le.secondarySubtitle=ve.enabled("versionHistory")?ge.relativeDate(Be):ge.timeAgo(Be)}return Le})}function P(Oe,De){return Oe?le.context("badgesFromLookupResponse",()=>{const xe=[],Le=oe.isPreorderFromPlatformData(Oe),Me=se.asString(Oe,"id");if(!Le){if(!De){const Ve=Oe.userRating;let ze=null;const je=se.asBooleanOrFalse(Oe,"isFirstPartyHideableApp")||ue.shouldSuppressReviewsForAdamId(Me);if(!je&&Ve&&Ve.value&&Ve.ratingCount){const He=se.asNumber(Ve,"value"),qe=Math.round(10*He)/10,Ge=ge.decimal(qe,1),We=se.asNumber(Ve,"ratingCount"),Ye=ge.stringWithCount("BADGE_RATING_CAPTION_SHORT_TEMPLATE",We).replace("{count}",ge.formattedCount(We)),Ke=ge.stringWithCount("BADGE_RATING_CAPTION_LONG_TEMPLATE",We).replace("{count}",ge.formattedCount(We)).replace("{rating}",Ge),Qe=ge.string("PRODUCT_ACCESSIBILITY_BADGE_STAR_RATING").replace("{starCount}",Ge);ze=new de.Badge("rating",{rating:qe,ratingFormatted:Ge},Ye,Ke,Qe,Ye)}else{const He=ge.string("BADGE_NO_RATINGS_CAPTION");if(je&&"BADGE_NO_RATINGS_CAPTION"!==He)ze=new de.Badge("rating",{},He,null,He);else if(!je){const qe=ge.string("BADGE_NOT_ENOUGH_RATINGS_CAPTION");ze=new de.Badge("rating",{},qe,null,qe)}}if(ze){const He=new de.ProductPageSection("shelf","ratings");ze.compactAction=new de.ProductPageScrollAction(He),ze.regularAction=ze.compactAction,xe.push(ze)}}const Ue=Oe.editorialBadgeInfo;if(Ue){const Ve=se.asString(Ue.editorialBadgeType);if(Ve&&"editorialPriority"===Ve){let ze="Games"===se.asArrayOrEmpty(Oe.genreNames)[0]?ge.string("EDITORIAL_BADGE_GAMES"):ge.string("EDITORIAL_BADGE_APPS");const je=ge.string("PRODUCT_ACCESSIBILITY_BADGE_EDITORS_CHOICE"),He=new de.Badge("editorsChoice",{},ze,null,je,ze),qe=new de.ProductPageSection("shelf","editorsChoice"),Ge=new de.ProductPageScrollAction(qe,!0);Ge.index=0,He.compactAction=Ge;const We=new de.ProductPageSection("shelf","ratings"),Ye=new de.ProductPageScrollAction(We,!0);Ye.index=0,He.regularAction=Ye,xe.push(He)}}const Be=se.traverse(Oe,"chartPositionForStore");if(Be){const Ve=S(he.name);if(Ve){const ze=se.traverse(Be,Ve);if(ze){const je=se.asNumber(ze,"position"),He=se.asString(ze,"genreName"),qe=ge.string("PRODUCT_ACCESSIBILITY_BADGE_CHART_POSITION_TITLE").replace("{chartPosition}",je.toString()),Ge=new de.Badge("chartPosition",{position:je.toString()},He,null,qe,He,"view"),We=se.asString(ze,"chartUrl");if(We){const Ye=new de.FlowAction("topCharts");Ye.pageUrl=We,Ge.compactAction=Ye,Ge.regularAction=Ye}xe.push(Ge)}}}else{const Ve=se.traverse(Oe,"chartPosition");if(Ve){const ze=se.asNumber(Ve,"position"),je=se.asString(Ve,"localizedGenreName"),He=ge.string("PRODUCT_ACCESSIBILITY_BADGE_CHART_POSITION_TITLE").replace("{chartPosition}",ze.toString());xe.push(new de.Badge("chartPosition",{position:ze.toString()},je,null,He,je,"view"))}}}else if(ve.enabled("paragraphBadges")&&"pad"!==he.deviceType||ve.enabled("paragraphBadgesWithPadFix")){const Ue=ge.string("BADGE_PREORDER_TERMS");xe.push(new de.Badge("paragraph",{paragraphText:Ue},null,null,Ue))}const Ne=se.asString(Oe,"contentRatingsBySystem.appsApple.name");if(Ne){const Ue={contentRating:Ne},Be=se.asNumber(Oe,"contentRatingsBySystem.appsBrazil.rank"),Ve=y(Be);Ve&&(Ue.contentRatingResource=Ve);let ze=ge.string("BADGE_AGE_RATING");"BADGE_AGE_RATING"===ze&&(ze=ge.string("AGE_RATING"));const je=ge.string("PRODUCT_ACCESSIBILITY_BADGE_AGE_RATING_TITLE"),He=new de.Badge("contentRating",Ue,ze,null,Ne,je,"view");xe.push(He)}return xe}):null}function S(Oe){return"AppStore"===Oe?"appStore":"Watch"===Oe?"watch":"Messages"===Oe?"messages":null}function y(Oe){if(!Oe)return null;return 6===Oe?"AgeRatingL":7===Oe?"AgeRating10":8===Oe?"AgeRating12":9===Oe?"AgeRating14":10===Oe?"AgeRating16":11===Oe?"AgeRating18":null}function A(Oe,De,xe,Le){if(!Oe)return null;const Me=se.asArrayOrEmpty(Oe,"genres");if(0<Me.length){let Ne=Me[0];const Ue=se.asString(Ne,"genreId"),Be=se.asString(Ne,"parentGenreId");let Ve=null;for(const qe of Me){const Ge=se.asString(qe,"genreId"),We=se.asString(qe,"parentGenreId");if(Ge!==Ue)if(We&&We===Ue){Ve=qe;break}else if(Ge&&Ge===Be){Ve=Ne,Ne=qe;break}}let ze=null;const je=se.asString(Ne,"name"),He=se.asString(Ve,"name");return ze=je&&He?De.replace(`{${xe}}`,je).replace(`{${Le}}`,He):je,ze}return null}function T(Oe,De,xe){return Oe&&De?le.context("informationFromLookupResponse",()=>{const Le=se.traverse(Oe,"softwareInfo"),Me=[],Ne=se.asString(Le,"seller"),Ue=se.asString(De,"sellerLabel")||ge.string("SELLER");if(Ne){const Ke=new de.AnnotationItem(Ne),Qe=new de.Annotation(Ue,[Ke]);Me.push(Qe)}const Be=ne.fileSizeInBytesFromProductData(Oe);if(Be){const Ke=ge.fileSize(Be),Qe=new de.AnnotationItem(Ke),Je=new de.Annotation(ge.string("FILE_SIZE"),[Qe]);Me.push(Je)}const Ve=se.asArrayOrEmpty(Oe,"genres");if(0<Ve.length){let Ke=ge.string("INFO_LIST_CHILD_PARENT_CATEGORY_SUMMARY");"INFO_LIST_CHILD_PARENT_CATEGORY_SUMMARY"===Ke&&(Ke="{parentCategory}: {childCategory}");const Qe=A(Oe,Ke,"parentCategory","childCategory");if(Qe){const Je=new de.AnnotationItem(Qe);let Xe=ge.string("INFO_LIST_CATEGORY_TITLE");"INFO_LIST_CATEGORY_TITLE"===Xe&&(Xe="Category");const Ze=new de.Annotation(Xe,[Je]);Me.push(Ze)}}const ze=se.asString(Le,"requirementsString");if(ze){let Ke=null;if(ce.deviceHasCapabilitiesFromPlatformData(Oe)){const Xe=ne.supportedAppPlatformsFromPlatformData(Oe),Ze=Xe&&-1!==Xe.indexOf(he.deviceType),$e=ge.deviceDisplayName(he.deviceType);if(Ze&&$e){let et=ge.string("INFO_LIST_REQUIREMENTS_SUMMARY");"INFO_LIST_REQUIREMENTS_SUMMARY"===et&&(et="Works on this {deviceName}"),Ke=et.replace("{deviceName}",$e)}}const Qe=new de.AnnotationItem(ze),Je=new de.Annotation(ge.string("REQUIREMENTS"),[Qe],Ke);Me.push(Je)}const je=se.asBooleanOrFalse(Oe,"usesLocationBackgroundMode");if(je){const Ke=ge.string("INFO_LIST_LOCATION_TITLE"),Qe=ge.string("INFO_LIST_LOCATION_DESCRIPTION"),Je=new de.AnnotationItem(Qe),Xe=new de.Annotation(Ke,[Je]);Me.push(Xe)}const He=se.asArrayOrEmpty(Le,"languageList"),qe=He.length;let Ge=null;if(0<qe){let Ke=null,Qe=null;switch(qe){case 0:break;case 1:Qe=He[0];break;case 2:Qe=ge.string("INFO_LIST_TWO_LANGUAGES_SUMMARY").replace("{first}",He[0]).replace("{second}",He[1]);break;default:Ke=ge.string("INFO_LIST_MORE_LANGUAGES_SUMMARY").replace("{language}",He[0]).replace("{count}",(qe-1).toString()),Qe=Pe.join(He,ge.string("CONJUNCTION_SEPARATOR"));}if(Qe){const Je=new de.AnnotationItem(Qe);Ge=new de.Annotation(ge.string("SUPPORTED_LANGUAGES"),[Je],Ke)}}else{const Ke=se.asString(Le,"languagesDisplayString");if(Ke){const Qe=new de.AnnotationItem(Ke);Ge=new de.Annotation(ge.string("SUPPORTED_LANGUAGES"),[Qe])}}Ge&&Me.push(Ge);const We=se.traverse(Oe,"contentRatingsBySystem.appsApple");if(We){const Ke=se.asString(We,"name");if(Ke){const Qe=se.asArrayOrEmpty(We,"advisories");let Je=null;const Xe=se.traverse(Oe,"ageBand"),Ze=se.asNumber(Xe,"minAge"),$e=se.asNumber(Xe,"maxAge");!Ke||se.isNull(Ze)||se.isNull(Ze)?Je=Ke:(Je=ge.string("INFO_LIST_AGE_RATING_SUMMARY").replace("{ageRating}",Ke).replace("{minAgeRating}",Ze.toString()).replace("{maxAgeRating}",$e.toString()),"{ageRating}, Made for Ages {minAgeRating}\u2013{maxAgeRating}"===Je&&(Je=Ke));const et=[];if(Je&&et.push(new de.AnnotationItem(Je)),0<Qe.length)for(const it of Qe)et.push(new de.AnnotationItem(it));let tt=null;1<et.length&&(tt=Je);let at=ge.string("INFO_LIST_AGE_RATING_TITLE");"INFO_LIST_AGE_RATING_TITLE"===at&&(at=ge.string("AGE_RATING"));const rt=new de.Annotation(at,et,tt);Me.push(rt),xe&&(xe.index=Me.length-1,xe.section=new de.ProductPageSection("shelf","information"))}}const Ye=se.asArrayOrEmpty(De,"topInApps");if(0<Ye.length){const Ke=[];for(const Je of Ye){const Xe=Je.name,Ze=Je.price;Ke.push(new de.AnnotationItem(Xe,Ze))}const Qe=new de.Annotation(ge.string("INFO_LIST_IN_APP_PURCHASES"),Ke,ge.string("YES"));Me.push(Qe)}return Me}):null}function I(Oe){return Oe?le.context("productLinksFromLookupResponse",()=>{const De=[],xe=se.asString(Oe,"websiteUrl");if(xe){const Ne=new de.ExternalUrlAction(xe,!1),Ue=ge.string("DEVELOPER_WEBSITE");De.push(new de.ProductPageLink(Ue,Ne,"developer"))}const Le=se.asString(Oe,"privacyPolicyUrl");if(Le){const Ne=new de.ExternalUrlAction(Le,!1),Ue=ge.string("PRIVACY_POLICY");De.push(new de.ProductPageLink(Ue,Ne,"privacy"))}const Me=se.asString(Oe,"eulaUrl");if(Me){const Ne=new de.ExternalUrlAction(Me,!1),Ue=ge.string("LICENSE_AGREEMENT");De.push(new de.ProductPageLink(Ue,Ne,"eula"))}return De}):null}function _(Oe,De){return se.traverse(Oe,["storePlatformData",De,"results"],{})}function E(Oe,De,xe,Le){if(se.isNull(Oe)||se.isNull(xe))return null;if("unsupported_product_page"===xe.componentName)throw new Error("Item not available due to product page being unsupported.");return le.context("productPageFromData",()=>{const Me=se.traverse(xe,"id"),Ne=se.asString(Oe,"kind"),Ue="mobileSoftwareBundle"===Ne,Be=me.metricsPageInformationFromResponse({pageData:xe,[me.timingValues]:xe[me.timingValues],[me.requestedUrl]:xe[me.requestedUrl],[me.iAdURLParameterStringToken]:xe[me.iAdURLParameterStringToken]}),Ve=me.newLocationTracker(),ze=new we(Be,Ve),je=x(Oe,ze,Le);me.copyMetricsEventsIntoPageWithInformation(je,ze.metricsPageInformation);const He=oe.offerDataFromPlatformData(Oe),qe=oe.offerActionFromOfferData(He,Oe,{pageInformation:ze.metricsPageInformation,locationTracker:ze.locationTracker,id:Me,isAdvert:!!Be.iAdInfo&&Be.iAdInfo.iAdIsPresent});qe.lineItem=se.asString(xe,me.iAdURLLineItemParameterStringToken),je.buttonAction=oe.wrapOfferActionIfNeeded(qe,Oe,!1);const Ge=oe.isPreorderFromOfferAction(qe);let We;Ue&&(We=B(Oe,De,ze)),We&&(je.shelfMapping.bundleChildren=We);const Ye=V(Oe,ze);Ye&&(je.shelfMapping.bundleParents=Ye);let Ke=null;const Qe=1===je.appPlatforms.length&&"mac"===je.appPlatforms[0];if(!Qe&&!Ge&&!Ue&&!se.asBooleanOrFalse(Oe,"isFirstPartyHideableApp")&&!ue.shouldSuppressReviewsForAdamId(Me)){const ct=xe,pt=se.traverse(Oe,"userRating");pt.ratingAverage=se.asNumber(pt,"value"),pt.adamId=se.asString(Oe,"id"),pt.supportUrl=se.asString(Oe,"softwareInfo.supportUrl");const ut=se.asArrayOrEmpty(ct,"userReviewList");0<ut.length%2&&ut.pop();const mt=G(pt,ct,ze),ft=1===je.appPlatforms.length&&"tv"===je.appPlatforms[0];ft?mt.seeAllAction=null:(Ke=Y(pt,ct,mt,ze),je.shelfMapping.reviews=Ke,je.shelfMapping.tapToRate=W(Oe,ze),je.shelfMapping.reviewActions=K(pt,ze)),je.shelfMapping.ratings=mt}const Je=Q(Oe);if(Je){const ct=new de.Shelf("editorsChoice");if(ct.items=[Je],ze.addImpressionsToShelf(ct,"editorsChoice"),je.shelfMapping.editorsChoice=ct,Ke&&0<Ke.items.length){ct.presentationHints=new de.ShelfPresentationHints;const pt=new de.PredicateBuilder;ct.presentationHints.visibilityPredicate=pt.whenHorizontalSizeClassIs("compact").build(),Ke.accessoryModel=Je,Ke.accessoryContentType="editorsChoice",Ke.presentationHints=new de.ShelfPresentationHints;const ut=new de.PredicateBuilder;Ke.presentationHints.accessoryVisibilityPredicate=ut.whenHorizontalSizeClassIs("regular").build()}}if(!se.asBooleanOrFalse(Oe,"isFirstPartyHideableApp")&&!Ue&&!Ge){const ct=se.traverse(xe,"versionHistory");if(ct&&1<ct.length){const pt=j(ct,Me,ze);pt&&(je.shelfMapping.mostRecentVersion=pt)}}const Xe=new Ce,Ze=H(Oe,xe,ze,Xe);Ze&&(je.shelfMapping.information=Ze);const $e=q(Oe,ze);$e&&(je.shelfMapping.links=$e);const et=J(Oe,ze);et&&(je.shelfMapping.capabilities=et);const tt=X(Oe,ze);tt&&(je.shelfMapping.featuredIn=tt);const at=se.asString(Oe,"artistUrl"),rt=se.asString(Oe,"artistName"),it=Z(xe,rt,at,ze);it&&(je.shelfMapping.moreByDeveloper=it);const ot=$(xe,Me,ze);ot&&(je.shelfMapping.similarItems=ot);const nt=te(Oe,ze);if(nt&&(je.shelfMapping.copyright=nt),!Ge){const ct=ee(Oe,De,!0,Le,ze);ct&&(je.shelfMapping.subscriptions=ct);const pt=ee(Oe,De,!1,Le,ze);pt&&(je.shelfMapping.inAppPurchases=pt)}je.pageTopBackgroundColor=null,je.pageBottomBackgroundColor=Ee;const st="com.apple.AppStore.ProductPageExtension"===he.name;je.purchasedOrdering=st?fe.sectionOrdering(!1,Le):fe.sectionOrdering(!0,Le),je.notPurchasedOrdering=fe.sectionOrdering(!1,Le),F(Le,je);const lt={};return lt["contentRating"]=Xe,C(je.badges,lt),je.isComplete=!0,je})}function C(Oe,De){for(const xe of Oe){const Le=De[xe.type];if(Le){const Me=new de.ProductPageScrollAction(Le.section,!0);Me.index=Le.index,xe.compactAction=Me,xe.regularAction=Me}}}function F(Oe,De){if(Oe&&Oe.spotlightSection){const xe=Oe.spotlightInAppProductIdentifier;if(xe&&"shelf"===Oe.spotlightSection.type){const Le=De.shelfMapping[Oe.spotlightSection.shelfId];if(!Le)return;if(Le.presentationHints||(Le.presentationHints=new de.ShelfPresentationHints),Le.presentationHints.isInProductPageSpotlight=!0,R(xe,Le.items),Le.url){const Me=new pe.URL(Le.url);Me&&(Le.url=Me.param(pe.Parameters.offerName,xe).build())}}}}function R(Oe,De){if(De){let xe=-1,Le=null;De.forEach((Me,Ne)=>{const Ue=Me,Be=Ue,Ve=Ue&&Ue.adamId===Oe,ze=Be&&Be.productIdentifier===Oe;(Ve||ze)&&(xe=Ne,Le=Ue,Be&&(Be.theme="spotlight",Be.offerDisplayProperties=Be.offerDisplayProperties.newOfferDisplayPropertiesChangingAppearance(!1,"white")))}),-1!==xe&&(De.splice(xe,1),De.splice(0,0,Le))}}function O(Oe){const De=[];if(Oe&&0<Oe.length)for(const xe of Oe){const Le=[];for(const Ue of xe.artwork){const Be=new de.ProductMediaItem;Be.screenshot=Ue,Le.push(Be)}const Me=xe.mediaPlatform,Ne=new de.ProductMedia(Le,Me);Ne.appPlatform=Me.appPlatform,De.push(Ne)}return De}function x(Oe,De,xe,Le){return le.context("productPageSidePackLockup",()=>{const Me=new de.ProductPage,Ne=oe.isPreorderFromPlatformData(Oe);!Ne||se.isNull(De)||se.isNull(De.metricsPageInformation)||(De.metricsPageInformation.offerType="preorder",De.metricsPageInformation.offerReleaseDate=oe.expectedReleaseDateFromPlatformData(Oe)),me.copyMetricsEventsIntoSidepackedPagewithInformation(Me,De.metricsPageInformation);const Ue=se.asString(Oe,"id"),Be=se.asString(Oe,"name"),Ve=se.asString(Oe,"artistName"),ze=se.asString(Oe,"kind"),je="mobileSoftwareBundle"===ze,He=se.traverse(Oe,"editorialArtwork.bannerUber");He&&(Me.uber=ne.artworkFromApiArtwork(He,null,"sr")),Me.adamId=Ue,Me.bundleId=se.asString(Oe,"bundleId"),Le||(Me.icon=ne.iconFromPlatformData(Oe)),Me.title=Be,Me.isComplete=!1;let qe=[];Ve&&(qe=[Ve]),Me.subtitles=qe,Me.developerTagline=se.asString(Oe,"subtitle"),Me.regularPriceFormatted=se.asString(Oe,"regularPriceFormatted"),se.asBooleanOrFalse(Oe,"isFirstPartyHideableApp")||ue.shouldSuppressReviewsForAdamId(Me.adamId)||(Me.rating=se.asNumber(Oe,"userRating.value"));const Ge=ne.screenshotsFromPlatformData(Oe,null,!0);Me.screenshots=Ge;const We=O(Ge),Ye=ne.platformVideoPreviewFromApiPlatformData(Oe);let Ke=null;if(Ye)for(const ht of We)if(ht.mediaPlatform.isEqualTo(Ye.mediaPlatform)){Ke=ht;break}let Qe=null;if(Ke){const ht=Ke.mediaPlatform.appPlatform;if("phone"===ht||"messages"===ht)for(const Pt of Ke.items){const St=Pt.screenshot;if(Qe=St.width/St.height,1>Qe)break}}const Je={pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker,id:Ue},Xe="com.apple.AppStore.ProductPageExtension"===he.name,Ze=[],$e=[];if(Ke&&Ye&&Ye.videos)for(const ht of Ye.videos){const Pt=new de.ProductMediaItem;Pt.video=ht;const St=ht.preview.width/ht.preview.height,yt=null===Qe||St.toFixed(2)===Qe.toFixed(2),At=Ke.mediaPlatform.isEqualTo(Ye.mediaPlatform);!Xe&&yt&&At?Ze.push(Pt):$e.push(ht),me.addMetricsEventsToVideo(ht,Je)}Ke&&(Ke.items=Ze.concat(Ke.items));let et=null;0<$e.length&&(et=z($e,De)),Me.media=We,Me.mediaSectionTitle=ge.string("PRODUCT_SECTION_SCREENSHOTS_PREVIEW");const tt=ne.supportedAppPlatformsFromPlatformData(Oe);Me.appPlatforms=tt;const at=oe.offerDataFromPlatformData(Oe),rt=oe.offerActionFromOfferData(at,Oe,Je);Me.buttonAction=oe.wrapOfferActionIfNeeded(rt,Oe,!1);const it=oe.updateOfferDataFromPlatformData(Oe);if(Me.externalVersionIdentifier=se.traverse(it,"version.externalId"),Me.updateBuyParams=se.asString(it,"buyParams"),Ne){Me.theme="blue";const ht=ge.string("PREORDER_EXPANDED_OFFER_TITLE");let Pt=null;if(!se.isNull(rt.expectedReleaseDate)){const St=ge.string("PREORDER_EXPANDED_OFFER_DATE_FORMAT","MMM d, yyyy"),yt=ge.formatDate(St,rt.expectedReleaseDate);Pt=ge.string("PREORDER_EXPANDED_OFFER_SUBTITLE").replace("{releaseDate}",yt)}Me.expandedOfferDetails=new de.ProductPageExpandedOfferDetails(ht,Pt)}je&&(Me.offerToken=rt);let ot=oe.displayPropertiesFromOfferAction(rt,"app",Oe,"colored","productPage","right");1===tt.length&&"mac"===tt[0]&&(ot.title=ge.uppercased(ot.title));const nt=se.asBooleanOrFalse(Oe,"is32bitOnly");let st=null;if(nt&&(st=new de.Shelf("banner"),st.items=[new de.Banner(ge.string("UNSUPPORTED_IOS_11"))],ot=ot.newOfferDisplayPropertiesChangingAppearance(!1,"disabled")),"phone"===he.deviceType&&-1===tt.indexOf("phone")&&-1!==tt.indexOf("pad")&&(ot=ot.newOfferDisplayPropertiesChangingAppearance(!1,"disabled"),null===st)){st=new de.Shelf("banner");const ht=ge.string("UNSUPPORTED_PAD_ONLY").replace("{appName}",Be);st.items=[new de.Banner(ht)]}if(null===st&&Ne&&!ve.enabled("preorders")&&(st=new de.Shelf("banner"),st.items=[new de.Banner(ge.string("AppStore.Preorders.Unsupported"))]),null!==st||ce.deviceHasCapabilitiesFromPlatformData(Oe)||(st=new de.Shelf("banner"),st.items=[new de.Banner(ge.string("UNSUPPORTED_CAPABILITIES"))]),null===st&&Te.shouldFilter(Oe,Te.Filter.UnsupportedSystemDeletableApps)&&(st=new de.Shelf("banner"),st.items=[new de.Banner(ge.string("UNSUPPORTED_CAPABILITIES"))],ot=ot.newOfferDisplayPropertiesChangingAppearance(!1,"disabled")),"desktopApp"===ze){ot=ot.newOfferDisplayPropertiesChangingAppearance(!1,"disabled"),st=new de.Shelf("banner");const ht=ge.string("UNSUPPORTED_MACOS_ONLY").replace("{appName}",Be);st.items=[new de.Banner(ht)]}const lt=se.asString(Oe,"minimumOSVersion");if(!ne.isOperatingSystemAtLeastVersion(lt)){ot=ot.newOfferDisplayPropertiesChangingAppearance(!1,"disabled");const ht=se.traverse(Oe,"softwareInfo"),Pt=se.asString(ht,"requirementsString")||ge.string("UNSUPPORTED_CAPABILITIES");st=new de.Shelf("banner"),st.items=[new de.Banner(Pt)]}Me.offerDisplayProperties=ot,Me.badges=P(Oe,je);let dt;const ct=se.asString(Oe,"artistUrl"),pt=se.asString(Oe,"artistId");ct&&(dt=new de.FlowAction("page"),dt.title=Ve,dt.pageUrl=ct,me.addClickEventToAction(dt,{targetType:"button",id:pt,actionType:"navigate",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker})),Me.developerAction=dt;const ut=se.asString(Oe,"name"),mt=se.asString(Oe,"artistName"),ft=ge.string("SHARE_SHEET_PRODUCT_TITLE_FORMAT").replace("{title}",ut).replace("{developer}",mt);if(Me.textActivityProvider=new de.ProductTextActivityProvider(ft),ve.enabled("enhancedSharing")){const ht=ye.shareSheetDataForProductFromProductData(Oe,!1),Pt=[];if(ht){const yt=new de.ShareSheetAction(ht);yt.title=ge.string("SHARE_APP"),yt.artwork=new de.Artwork("resource://action_share",28,28),me.addClickEventToAction(yt,{targetType:"button",id:Ue,actionType:"share",actionContext:"shareSheet",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker}),Pt.push(yt)}const St=ye.adamIdForShareSheetGiftActivityFromProductData(Oe);if(St){const yt=new de.FlowAction("finance");yt.title=ge.string("SHARE_GIFT_APP"),yt.artwork=new de.Artwork("resource://action_gift",28,28),yt.pageUrl=`gift/${St}`,me.addClickEventToAction(yt,{targetType:"button",id:Ue,actionType:"gift",actionContext:"shareSheet",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker}),Pt.push(yt)}if(ct){const yt=new de.FlowAction("page");yt.title=ge.string("SHARE_MORE_BY_DEVELOPER"),yt.artwork=new de.Artwork("resource://action_dev",28,28),yt.pageUrl=ct,me.addClickEventToAction(yt,{targetType:"button",id:pt,actionType:"navigate",actionContext:"shareSheet",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker}),Pt.push(yt)}if(0<Pt.length){const yt=new de.SheetAction(Pt);yt.isCancelable=!0,Me.shareAction=yt,me.addClickEventToAction(Me.shareAction,{targetType:"button",id:Ue,actionType:"actionSheet",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker})}}else{const ht=ye.shareSheetDataForProductFromProductData(Oe,!0);ht&&(Me.shareAction=new de.ShareSheetAction(ht),me.addClickEventToAction(Me.shareAction,{targetType:"button",id:Ue,actionType:"share",pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker}))}const gt=U(Oe,dt,De);return Me.shelfMapping={},st&&(Me.shelfMapping.banner=st),gt&&(Me.shelfMapping.description=gt),et&&(Me.shelfMapping.videos=et),Me.purchasedOrdering=Xe?fe.sectionOrdering(!1,xe):fe.sectionOrdering(!0,xe),Me.notPurchasedOrdering=fe.sectionOrdering(!1,xe),F(xe,Me),Me})}function L(Oe){if(-1===Fe.indexOf(Oe.media.kind))return!1;const De=Oe.clickAction;if(!De)return!0;const xe=De.pageUrl;if(!xe)return!0;const Le=new pe.URL(xe),Me=be.default.product;for(const Ne of Me){const Ue=new ke.UrlRoute(Ne,null);if(Ue.matches(Le))return!1}return!0}function N(Oe,De,xe){const Le=Oe.ids;return Le&&Le.length?(Oe.sourcePageInformation=De.metricsPageInformation,Oe.sourceLocationTracker=De.locationTracker,Oe.destinationPageInformation=xe,`${pe.Protocol.internal}:/${pe.Path.product}/${pe.Path.shelf}/`+encodeURIComponent(JSON.stringify(Oe))):null}function U(Oe,De,xe){return le.context("descriptionShelf",()=>{let Me=se.asString(Oe,"promotionalText"),Le;Me||(Me="");let Ne=se.asString(Oe,"description.standard");Ne||(Ne="");let Ue="";0<Me.length&&0<Ne.length&&(Ue="\n\n");const Be=Me+Ue+Ne;if(0<Be.length){Le=new de.Shelf("productDescription");const Ve=new de.Paragraph(Be);Ve.isCollapsed=!0;const ze=new de.ProductDescription(Ve,De);Le.items=[ze],xe.addImpressionsToShelf(Le,"description")}return Le})}function B(Oe,De,xe){return le.context("bundleChildrenShelf",()=>{let Le;Le=new de.Shelf("smallLockup"),Le.isHorizontal=!0;const Me=se.asArrayOrEmpty(Oe,"childrenIds");if(0<Me.length){Le.title="APPS_IN_BUNDLE"===ge.string("APPS_IN_BUNDLE")?ge.string("APPS_IN_BUNDLE_TEMPLATE").replace("{count}",Me.length.toString()):ge.stringWithCount("APPS_IN_BUNDLE",Me.length),me.pushContentLocation({pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker,targetType:"swoosh",id:`${xe.getSequenceId()}`,idType:"sequential"},Le.title);const Ne=ie(De,Me,xe);if(Ne.unvailableIds.length){const Ue=new _e(Ne.unvailableIds,Le.title,!1,"smallLockup","infer","below",null);Ue.isBundleShelf=!0,Le.url=N(Ue,xe)}Le.items=Ne.lockups,me.popLocation(xe.locationTracker),me.nextPosition(xe.locationTracker)}return Le.rowsPerColumn=2>Me.length?1:2,xe.addImpressionsToShelf(Le,"bundleChildren"),Le})}function V(Oe,De){return le.context("bundleParentsShelf",()=>{let xe;const Le=se.asArrayOrEmpty(Oe,"appBundleAdamIds");if(0<Le.length){xe=new de.Shelf("smallLockup"),xe.isHorizontal=!0,xe.title=ge.string("INCLUDED_IN_BUNDLES").replace("{count}",Le.length.toString());const Me=new _e(Le,xe.title,!1,"smallLockup","infer","below",null);xe.url=N(Me,De),xe.rowsPerColumn=2>Le.length?1:2,De.addImpressionsToShelf(xe,"bundleParent")}return xe})}function z(Oe,De){return le.context("videoShelf",()=>{if(!Oe||0===Oe.length)return null;const xe=new de.Shelf("framedVideo");return xe.title=ge.string("PRODUCT_SECTION_VIDEOS"),xe.items=Oe.map(Le=>{return new de.FramedVideo(Le,!0,"text/plain",null,null,!0)}),xe.isHorizontal=!0,De.addImpressionsToShelf(xe,"videos"),xe})}function j(Oe,De,xe){return le.context("mostRecentVersionShelf",()=>{const Le=g(Oe);let Me;if(0<Le.length){Me=new de.Shelf("titledParagraph"),Me.title=ge.string("PRODUCT_SECTION_MOST_RECENT_VERSION");const Ne=h(Oe[0],"overview");Me.items=[Ne];const Ue=new de.Shelf("titledParagraph");Ue.items=Le;const Be=new de.GenericPage([Ue]);Be.title=ge.string("VERSION_HISTORY_PAGE_TITLE","Version History"),Be.presentationOptions=["prefersLargeTitle"];const Ve=me.fakeMetricsPageInformation("VersionHistory",De,"");me.copyMetricsEventsIntoPageWithInformation(Be,Ve);let ze;ze=ve.enabled("versionHistory")?new de.FlowAction("versionHistory"):new de.FlowAction("page"),ze.title=ge.string("ACTION_VERSION_HISTORY_SEE_ALL"),ze.pageData=Be,me.addClickEventToSeeAllAction(ze,null,{pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker}),Me.seeAllAction=ze,xe.addImpressionsToShelf(Me,"versionHistory")}return Me})}function H(Oe,De,xe,Le){return le.context("informationShelf",()=>{let Me;const Ne=T(Oe,De,Le);return 0<Ne.length&&(Me=new de.Shelf("annotation"),Me.title=ge.string("PRODUCT_SECTION_INFORMATION"),Me.items=Ne,xe.addImpressionsToShelf(Me,"information")),Me})}function q(Oe,De){return le.context("linksShelf",()=>{const xe=new de.Shelf("productPageLink"),Le=I(se.traverse(Oe,"softwareInfo"));return Le&&0<Le.length&&(xe.items=Le),De.addImpressionsToShelf(xe,"links"),xe})}function G(Oe,De,xe){return le.context("ratingsShelf",()=>{const Le={pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker},Me=ge.string("PRODUCT_SECTION_REVIEWS");me.pushContentLocation({pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker,targetType:"swoosh",id:`${xe.getSequenceId()}`,idType:"sequential"},Me);const Ne=ue.ratingsShelfForReviewsData(he.guid,Oe,De,Le);return Ne.title=Me,xe.addImpressionsToShelf(Ne,"ratings"),me.popLocation(xe.locationTracker),me.nextPosition(xe.locationTracker),Ne})}function W(Oe,De){return le.context("tapToRateShelf",()=>{const xe=new de.Shelf("tapToRate");return xe.items=[ue.tapToRateWithAdamId(se.asString(Oe,"id"))],De.addImpressionsToShelf(xe,"tapToRate"),xe})}function Y(Oe,De,xe,Le){return le.context("reviewsShelf",()=>{const Me=ue.reviewsShelfForReviewsData(he.guid,Oe,De,!0);if(Le.addImpressionsToShelf(Me,"reviews"),0<Me.items.length)return Me;if(xe.seeAllAction=null,0<xe.items.length){const Ne=xe.items[0],Ue=0<Ne.ratingAverage&&Ne.ratingCounts,Be=se.asBooleanOrFalse(Oe,"wasReset");return Ue||Be||(Ne.status=ge.string("RATINGS_STATUS_NOT_ENOUGH_RATINGS_OR_REVIEWS")),null}})}function K(Oe,De){return le.context("reviewActionsShelf",()=>{const xe=new de.Shelf("reviewActions"),Le=ue.reviewActionsForRatingsData(Oe,!1);return xe.items=[Le],De.addImpressionsToShelf(xe,"reviewActions"),xe})}function Q(Oe){return le.context("editorsChoiceItem",()=>{const De=se.asString(Oe,"itunesNotes.standard");if(De){const xe=new de.EditorsChoice(De),Le=Oe.editorialBadgeInfo;if(Le){const Me=se.asString(Le.editorialBadgeType);xe.showsBadge=Me&&"editorialPriority"===Me}return xe.showsBadge||(xe.title=ge.string("APP_STORE_EDITORS_NOTES")),xe}return null})}function J(Oe,De){return le.context("capabilitiesShelf",()=>{let xe;const Le=[];se.asBooleanOrFalse(Oe,"softwareInfo.isGameCenter")&&Le.push(new de.ProductCapability("gameCenter")),se.asBooleanOrFalse(Oe,"isSiriSupported")&&Le.push(new de.ProductCapability("siri")),se.asBooleanOrFalse(Oe,"supportsPassbook")&&Le.push(new de.ProductCapability("wallet"));const Me=se.asString(Oe,"familyShareEnabledDate");if(Me&&!se.asBooleanOrFalse(Oe,"isFirstPartyHideableApp")){const Ne=new Date(Me),Ue=new Date;Ne&&Ne<=Ue&&Le.push(new de.ProductCapability("familySharing"))}return 0<Le.length&&(xe=new de.Shelf("productCapability"),xe.title=ge.string("PRODUCT_SECTION_SUPPORTS"),xe.items=Le,De.addImpressionsToShelf(xe,"supports")),xe})}function X(Oe,De){return le.context("featuredInShelf",()=>{const xe=se.asArrayOrEmpty(Oe,"relatedEditorialItems");if(!xe.length)return null;const Le=new de.Shelf("todayBrick"),Me=ge.string("PRODUCT_SECTION_FEATURED_IN");Le.title=Me,Le.isHorizontal=!1,Le.isHidden=!0;const Ne=new _e(xe,Me,!1,"todayBrick");return Le.url=N(Ne,De),me.pushContentLocation({pageInformation:De.metricsPageInformation,locationTracker:De.locationTracker,targetType:"swoosh",id:`${De.getSequenceId()}`,idType:"sequential"},Me),De.addImpressionsToShelf(Le,"featuredIn"),me.popLocation(De.locationTracker),me.nextPosition(De.locationTracker),Le})}function Z(Oe,De,xe,Le){return le.context("moreByDeveloperShelf",()=>{let Me;const Ne=se.asArrayOrEmpty(Oe,"moreByThisDeveloper");if(0<Ne.length){const Ue=ge.string("MORE_BY_DEVELOPER_TEMPLATE").replace("{developer}",De);me.pushContentLocation({pageInformation:Le.metricsPageInformation,locationTracker:Le.locationTracker,targetType:"swoosh",id:`${Le.getSequenceId()}`,idType:"sequential"},Ue),Me=new de.Shelf("smallLockup"),Me.title=Ue;const Be=new _e(Ne,Me.title,!1,"smallLockup","white","below",null);Me.url=N(Be,Le);const Ve=new de.FlowAction("page");Ve.pageUrl=xe,Ve.title=ge.string("ACTION_SEE_ALL"),me.addClickEventToSeeAllAction(Ve,Ve.pageUrl,{pageInformation:Le.metricsPageInformation,locationTracker:Le.locationTracker}),Me.seeAllAction=Ve,Me.isHorizontal=!0,Me.rowsPerColumn=2>Ne.length?1:2,Me.backgroundColor=Ee,Le.addImpressionsToShelf(Me,"developer"),me.popLocation(Le.locationTracker),me.nextPosition(Le.locationTracker)}return Me})}function $(Oe,De,xe){return le.context("similarItemsShelf",()=>{let Le;const Me=se.asArrayOrEmpty(Oe,"customersAlsoBoughtApps");if(0<Me.length){const Ne=ge.string("SIMILAR_ITEMS_TITLE");me.pushContentLocation({pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker,targetType:"swoosh",id:`${xe.getSequenceId()}`,idType:"sequential"},Ne),Le=new de.Shelf("smallLockup"),Le.title=Ne;const Ue=new _e(Me,Le.title,!0,"smallLockup","white","below",null),Be=me.fakeMetricsPageInformation("SimilarItems",De,"");Le.url=N(Ue,xe,Be),Le.isHorizontal=!0,Le.rowsPerColumn=2>Me.length?1:2,Le.backgroundColor=Ee,xe.addImpressionsToShelf(Le,"similarItems"),me.popLocation(xe.locationTracker),me.nextPosition(xe.locationTracker)}return Le})}function ee(Oe,De,xe,Le,Me){return le.context("inAppPurchasesShelf",()=>{let Ne;const Ue=se.asArrayOrEmpty(Oe,"merchandisedInApps"),Be=Ue.filter(function(Ve){const ze=!se.isNull(Ve.isSubscription);return ze===xe});if(0<Be.length){Ne=new de.Shelf("inAppPurchaseLockup");const Ve=Be.map(function(We){return We.adamId}),ze=oe.isPreorderFromPlatformData(Oe);let je="infer";ze&&(je="disabled");let He=null;Le&&(He=Le.spotlightInAppProductIdentifier);const qe=new _e(Ve,Ne.title,!1,"inAppPurchaseLockup",je,"right",He);qe.appBundleId=se.asString(Oe,"bundleId");let Ge;xe?(Ne.title=ge.string("PRODUCT_SECTION_SUBSCRIPTIONS","Subscriptions"),qe.inAppShelfId="subscriptions",Ge="subscription"):(Ne.title=ge.string("PRODUCT_SECTION_IN_APP_PURCHASES"),qe.inAppShelfId="inAppPurchases",Ge="iAP"),me.pushContentLocation({pageInformation:Me.metricsPageInformation,locationTracker:Me.locationTracker,targetType:"swoosh",id:`${Me.getSequenceId()}`,idType:"sequential"},Ne.title),Ne.url=N(qe,Me),me.popLocation(Me.locationTracker),me.nextPosition(Me.locationTracker),Ne.isHorizontal=!0,Me.addImpressionsToShelf(Ne,Ge)}return Ne})}function te(Oe,De){return le.context("copyrightShelf",()=>{let xe;const Le=se.asString(Oe,"copyright");if(Le){xe=new de.Shelf("footnote");const Me=new de.Footnote(Le);xe.items=[Me],xe.backgroundColor=Ee,De.addImpressionsToShelf(xe,"copyright")}return xe})}function ie(Oe,De,xe,Le){const Me=[],Ne={lockupOptions:{metricsOptions:{pageInformation:xe.metricsPageInformation,locationTracker:xe.locationTracker}},shouldConsiderDataPastLastAvailable:!0,contentUnavailable:Be=>{return Me.push(Be),!0}};se.isNull(Le)||(Ne.lockupOptions.skipDefaultClickAction=Le);const Ue=ce.lockupsFromPlatformData(Oe,De,Ne);return new Re(Ue,Me)}Object.defineProperty(d,"__esModule",{value:!0});const oe=s("./offers"),ne=s("./content"),se=s("../data/server-data"),le=s("../data/validation"),de=s("../models"),ce=s("./lockups"),pe=s("../data/urls"),ue=s("../builders/reviews"),me=s("../metrics/helpers"),fe=s("./product-page-ordering"),ge=s("../util/localization"),he=s("../wrappers/client"),Pe=s("../util/string-util"),Se=s("../wrappers/store"),ye=s("./sharing"),Ae=s("../util/objects"),Te=s("./filtering"),ve=s("../util/properties"),Ie=s("./today"),ke=s("../routing/routing-components"),be=s("../routing/routes/page-routes");d.profile="product-dv",d.writeReviewAction="write-review",d.reviewsAction="reviews";class _e{constructor(Oe,De,xe,Le,Me,Ne,Ue){this.isBundleShelf=!1,this.ids=Oe,this.title=De,this.shouldInferSeeAllFromFetchesItems=xe,this.contentType=Le,this.offerStyle=Me,this.offerSubtitlePosition=Ne,this.spotlightInAppProductIdentifier=Ue}}d.ProductPageShelfToken=_e;class we{constructor(Oe,De){this.sequenceId=0,this.metricsPageInformation=Oe,this.locationTracker=De}addImpressionsToShelf(Oe,De){me.addImpressionFields(Oe,{id:`${this.sequenceId}`,kind:null,targetType:De,title:Oe.title,pageInformation:this.metricsPageInformation,locationTracker:this.locationTracker}),this.sequenceId++}getSequenceId(){return this.sequenceId}}d.ProductPageShelfMetrics=we,d.productCategoryStringFromPlatformData=A,d.informationFromLookupResponse=T;const Ee="F0F0F8";d.productPageFromUrl=function(Oe,De){const xe=new pe.URL(Oe);let Le=xe.query[me.iAdURLParameterStringToken];Le&&(xe.removeParam(me.iAdURLParameterStringToken),Le=JSON.parse(Le));const Me=xe.query[me.iAdURLLineItemParameterStringToken];return Me&&xe.removeParam(me.iAdURLLineItemParameterStringToken),Oe=xe.toString(),Se.fetchJson(Oe,{isStoreRequest:!0}).then(Ne=>{const Ue=se.traverse(Ne,"pageData");if(!Ue)return new Promise((je,He)=>{He(new Error(`No pageData found in response from url: ${Oe}`))});Ue[me.timingValues]=Ne[me.timingValues],Ue[me.requestedUrl]=Ne[me.requestedUrl],Le&&(Ue[me.iAdURLParameterStringToken]=Le),Me&&(Ue[me.iAdURLLineItemParameterStringToken]=Me);const Be=se.traverse(Ne,"pageData.id"),Ve=_(Ne,d.profile),ze=_(Ne,"lockup");return 0===Object.keys(Ve).length?Se.fetchStorePlatformData([Be],{p:d.profile}).then(je=>{return le.context("productPageFromUrl-fetch",()=>E(je[Be],ze,Ue,De))}):new Promise(je=>{je(le.context("productPageFromUrl-prewarmed",()=>E(Ve[Be],ze,Ue,De)))})})},d.productPageFromResponse=function(Oe,De){return le.context("productPageFromResponse",()=>{const xe=se.traverse(Oe,"pageData");xe[me.timingValues]=Oe[me.timingValues],xe[me.requestedUrl]=Oe[me.requestedUrl];const Le=se.traverse(Oe,"pageData.id"),Me=_(Oe,d.profile),Ne=_(Oe,"lockup");return E(Me[Le],Ne,xe,De)})};class Ce{}d.productPageSidePackLockup=function(Oe,De,xe){const Le=se.asString(Oe,"url"),Me=se.asString(Oe,"id"),Ne=se.asString(Oe,"name"),Ue=se.asString(Oe,"artistName"),Be=me.fakeMetricsPageInformation("Software",Me,`${Ue}_${Ne}`);Be.pageUrl=Le;const Ve=me.newLocationTracker(),ze=new we(Be,Ve);return x(Oe,ze,De,xe)};const Fe=["brandedSingleApp","grid","artwork","video"];d.shelfFromLookupResponse=function(Oe,De){return le.context("shelfFromLookupResponse",()=>{const xe=new de.Shelf(De.contentType),Le={pageInformation:De.sourcePageInformation,locationTracker:De.sourceLocationTracker,excludeAttribution:!0};let Me;switch(De.contentType){case"todayBrick":const Ne={metricsPageInformation:Le.pageInformation,metricsLocationTracker:Le.locationTracker,coercedGeneralCardSubType:"Grid",prevailingCropCode:"fo"},Ue=Ie.inlineTodayCardsFromPlatformData(Oe,De.ids,Ne,L);Ue&&(Me=[Ue]);break;default:const Be={metricsOptions:Le,offerStyle:De.offerStyle,offerSubtitlePosition:De.offerSubtitlePosition};"inAppPurchaseLockup"===De.contentType&&(Be.skipDefaultClickAction=!0);const Ve={lockupOptions:Be};De.isBundleShelf&&(Ve.filter=Te.Filter.None);let ze=ce.lockupsFromPlatformData(Oe,De.ids,Ve);const He={Watch:"round",Messages:"pill"}[he.name];He&&(ze=ze.sort((Ge,We)=>{const Ye=Ge.icon.style===He,Ke=We.icon.style===He;return Ye&&Ke?0:Ye&&!Ke?-1:1}));const qe=De.spotlightInAppProductIdentifier;qe&&R(qe,ze),Me=ze;}return xe.items=Me,xe})},d.filteredInAppLockupsUsingOrdering=function(Oe,De){const xe={};for(const Me of Oe)xe[Me.productIdentifier]=Me;const Le=[];for(const Me of De){const Ne=xe[Me];if(Ne){const Ue=Ae.shallowCopyOf(Ne);Le.push(Ue)}}return Le};class Re{constructor(Oe,De){this.lockups=Oe,this.unvailableIds=De}}},{"../builders/reviews":84,"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../routing/routes/page-routes":136,"../routing/routing-components":139,"../util/localization":145,"../util/objects":146,"../util/properties":147,"../util/string-util":149,"../wrappers/client":152,"../wrappers/store":155,"./content":72,"./filtering":74,"./lockups":76,"./offers":79,"./product-page-ordering":82,"./sharing":88,"./today":96}],84:[function(s,l,d){"use strict";function y(ee){const te=W.default.userRateUrl;return j.URL.from(te).param("id",ee).build()}function A(ee){const te=W.default.writeReviewUrl;return j.URL.from(te).param("id",ee).build()}function T(ee){const te=new z.AlertAction("toast");te.title=Y.string("TOAST_TAP_TO_RATE_TITLE"),te.message=Y.string("TOAST_TAP_TO_RATE_DESCRIPTION"),te.artwork=new z.Artwork("resource://ToastStar.png",95,90);const ae=new z.RateAction(y(ee));ae.adamId=ee,ae.method="POST",ae.isStoreRequest=!0,ae.disableCache=!0,ae.successAction=te;const ie=new z.HttpTemplateParameter("rating","urlQuery","decimalPad"),oe=new z.HttpTemplateParameter("version-to-review","urlQuery","decimalPad");return ae.parameters=[ie,oe],ae}function I(ee,te){return G.context("reportConcernActionFromApiRow",()=>{const ae=new z.HttpTemplateAction(q.asString(te,"reportConcernUrl"));ae.method="POST",ae.isStoreRequest=!0,ae.disableCache=!0,ae.needsAuthentication=!0,ae.headers={"Content-Type":H.FormBuilder.contentType},ae.body=new H.FormBuilder().param("userReviewId",q.asString(te,"userReviewId")).param("guid",ee).build();const ie=new z.HttpTemplateParameter("selectedReason","formBody","decimalPad"),oe=new z.HttpTemplateParameter("explanation","formBody","text");ae.parameters=[ie,oe];const ne=new z.AlertAction("toast");ne.title=Y.string("TOAST_CONCERN_REPORTED_TITLE"),ne.message=Y.string("TOAST_CONCERN_REPORTED_DESCRIPTION"),ne.artwork=new z.Artwork("resource://ToastExclamation.png",90,90),ae.successAction=ne;const se=q.asArrayOrEmpty(te,"reportConcernReasons").map(de=>{return new J.ReportConcernReason(q.asString(de,"reasonId"),q.asString(de,"name"),q.asString(de,"upperCaseName"))}),le=new z.ReportConcernAction(se);return le.title=Y.string("ACTION_REVIEW_REPORT"),le.explanation=q.asString(te,"reportConcernExplanation"),le.artwork=new z.Artwork("resource://ContextActionExclamation.png",28,28),le.sendAction=ae,le})}function k(ee,te,ae){const ie=new z.HttpAction(ae.voteUrl),oe=new z.AlertAction("toast");return te?(ie.title=Y.string("ACTION_REVIEW_HELPFUL"),ie.artwork=new z.Artwork("resource://ContextActionThumbsUp.png",28,28),oe.title=Y.string("TOAST_HELPFUL_TITLE"),oe.message=Y.string("TOAST_HELPFUL_DESCRIPTION"),oe.artwork=new z.Artwork("resource://ToastThumbsUp.png",90,90)):(ie.title=Y.string("ACTION_REVIEW_NOT_HELPFUL"),ie.artwork=new z.Artwork("resource://ContextActionThumbsDown.png",28,28),oe.title=Y.string("TOAST_NOT_HELPFUL_TITLE"),oe.message=Y.string("TOAST_NOT_HELPFUL_DESCRIPTION"),oe.artwork=new z.Artwork("resource://ToastThumbsDown.png",90,90)),ie.method="POST",ie.isStoreRequest=!0,ie.disableCache=!0,ie.headers={"Content-Type":H.FormBuilder.contentType},ie.body=new H.FormBuilder().param("vote",te?"1":"0").param("guid",ee).build(),ie.successAction=oe,ie}function _(ee,te){if(!te)return null;const ae=[k(ee,!0,te),k(ee,!1,te),I(ee,te)],ie=new z.SheetAction(ae);return ie.isCancelable=!0,ie}function w(ee,te,ae,ie=!1,oe=!0){return G.context("reviewsFromApiRows",()=>{const ne=function(le,de){if(de){const ce=new Date,pe=1e3*(ce.getTime()-le.getTime())<3600;return pe?Y.string("TIME_AGO_EDITED_JUST_NOW"):Y.string("TIME_AGO_EDITED_TIME").replace("{time}",Y.timeAgo(le))}return Y.timeAgo(le)},se=q.asArrayOrEmpty(ae,"userReviewList");return se.map(le=>{const de=new z.Review;de.id=q.asString(le,"userReviewId","coercible"),de.title=q.asString(le,"title");const ce=q.asString(le,"date");ce&&(de.date=new Date(ce),de.dateText=ne(de.date,q.asBooleanOrFalse(le,"isEdited"))),de.contents=q.asString(le,"body"),de.rating=q.asNumber(le,"rating"),de.reviewerName=q.asString(le,"name");const pe=q.asNumber(le,"developerResponse.id");if(0<pe){const ue=new z.Response;ue.id=pe.toString(),ue.contents=q.asString(le,"developerResponse.body");const me=q.asString(le,"developerResponse.modified");me&&(ue.date=new Date(me),ue.dateText=ne(ue.date,!1)),de.response=ue}return ie&&(de.moreAction=U(ee,te,le)),oe&&(de.topLevelAction=_(ee,le)),de})})}function E(ee,te,ae){return te?G.context("ratingsFromApiResponses",()=>{const ie=new z.Ratings;ie.productId=q.asString(te,"adamId","coercible"),ie.ratingAverage=q.asNumber(te,"ratingAverage"),ie.totalNumberOfRatings=q.asNumber(te,"ratingCount"),ie.totalNumberOfReviews=q.asNumber(te,"totalNumberOfReviews");const oe=q.asArrayOrEmpty(te,"ratingCountList").reverse(),ne=oe.reduce((le,de)=>le+de,0);ie.ratingCounts=0<ne?oe.map(le=>le/ne*ie.totalNumberOfRatings):oe;const se=0<ie.ratingAverage&&ie.ratingCounts;if(!se){const le=q.asBooleanOrFalse(te,"wasReset");ie.status=le?Y.string("RATINGS_STATUS_DEVELOPER_RESET"):Y.string("RATINGS_STATUS_NOT_ENOUGH_RATINGS")}return ie.reviews=ae?w(ee,te,ae):[],ie.actions=[],ie}):null}function C(ee){const te=new z.TapToRate;return te.title=Y.string("TAP_TO_RATE"),te.rateAction=T(ee),te}function F(ee,te){return G.context("reviewActionsForRatingsData",()=>{const ae=new z.ReviewActions,ie=new z.FlowAction("writeReview");ie.title=Y.string(te?"EDIT_REVIEW":"WRITE_A_REVIEW"),"EDIT_REVIEW"===ie.title&&(ie.title="Edit Review");const oe=q.asString(ee,"adamId");ie.pageUrl=A(oe),ie.pageData=oe,ie.presentationContext="presentModal",ae.writeReview=ie;const ne=q.asString(ee,"supportUrl");return ne&&(ae.support=new z.ExternalUrlAction(ne,!1),ae.support.title=Y.string("APP_SUPPORT")),ae})}function O(ee,te,ae,ie=!1,oe=!0){return G.context("reviewsShelfForReviewsData",()=>{const ne=new z.Shelf("reviews");return ne.items=w(ee,te,ae,ie,oe),ne.isHorizontal=!0,ne})}function D(ee){return G.context("personalizedReviewActionsShelfForRatingsData",()=>{const te=new z.Shelf("reviewActions"),ae=q.asString(ee,"adamId","coercible"),ie=q.asString(ee,"supportUrl");return te.url=`${j.Protocol.internal}:/${j.Path.personalizedReviewActions}/${j.Path.shelf}/${ae}/`+encodeURIComponent(ie),te})}function x(ee){const te=new z.Shelf("reviews");return te.url=`${j.Protocol.internal}:/${j.Path.personalizedReviews}/${j.Path.shelf}/`+q.asString(ee,"adamId","coercible"),te}function L(ee,te,ae,ie){const oe=V(ee,te);return new z.ReviewsPageSortOption(te,ae,ie,oe)}function M(ee,te,ae,ie=null,oe=null,ne=null,se=null){const le=new z.ReviewsPage;return le.shelves=[],G.context("reviewsPageForReviewsData",()=>{const de=O(ee,te,ae,!1),ce=q.isNull(se)?q.asString(te,"adamId"):se;if(!ie){le.adamId=ce,le.ratings=E(ee,te,ae),le.targetReviewId=oe;const pe=new z.Shelf("ratings");pe.items=[E(ee,te,null)];const ue=new z.Shelf("tapToRate");ue.items=[C(q.asString(te,"adamId"))],ue.isPersonalized=!0;let me;if(Q.enabled("personalizedReview")&&W.default.personalizedUserReviewEnabled)me=D(te);else{me=new z.Shelf("reviewActions");const ge=F(te,!1);me.items=[ge]}if(me.isPersonalized=!0,le.shelves.push(pe,ue,me),Q.enabled("personalizedReview")&&W.default.personalizedUserReviewEnabled){const ge=x(te);ge.isPersonalized=!0,le.shelves.push(ge)}const fe=q.asArrayOrEmpty(de.items).length;le.nextPage=K.createPageToken(null,B(le.adamId,fe,fe+d.pageSize,$))}return 0<de.items.length&&(Q.enabled("reviewsSortControls")&&((0===ne||!ie)&&(de.presentationHints=new z.ShelfPresentationHints,de.presentationHints.isSortable=!0),!ie&&(le.initialSortOptionIdentifier=$,le.sortActionSheetTitle=Y.string("REVIEWS_SORT_BY"),le.sortOptions=[L(ce,"1",Y.string("REVIEWS_MOST_HELPFUL"),Y.string("REVIEWS_SORT_BY_MOST_HELPFUL")),L(ce,"2",Y.string("REVIEWS_MOST_FAVORABLE"),Y.string("REVIEWS_SORT_BY_MOST_FAVORABLE")),L(ce,"3",Y.string("REVIEWS_MOST_CRITICAL"),Y.string("REVIEWS_SORT_BY_MOST_CRITICAL")),L(ce,"4",Y.string("REVIEWS_MOST_RECENT"),Y.string("REVIEWS_SORT_BY_MOST_RECENT"))])),de.isHorizontal=!1,le.shelves.push(de),ie&&(le.nextPage=K.createPageToken(null,ie))),le})}function N(ee,te,ae,ie=null){return te?G.context("reviewsActionFromReviewsData",()=>{const oe=M(ee,te,ae,null,ie),ne=new z.FlowAction("reviews");return ne.pageData=oe,ne.title=Y.string("PRODUCT_SECTION_REVIEWS"),ne}):null}function U(ee,te,ae){return ae?G.context("singleReviewActionFromReviewData",()=>{const ie=O(ee,te,{userReviewList:[ae]});ie.isHorizontal=!1;const oe=new z.ReviewsPage;oe.adamId=q.asString(te,"adamId"),oe.targetReviewId=q.asString(ae,"userReviewId","coercible"),oe.shelves=[ie];const ne=new z.FlowAction("reviews");return ne.pageData=oe,ne.title=Y.string("PRODUCT_SECTION_REVIEWS"),ne}):null}function B(ee,te,ae,ie){return`${j.Protocol.internal}:/${j.Path.reviews}/${j.Path.shelf}/${ee}/${te}/${ae}/${ie}`}function V(ee,te){return`${j.Protocol.internal}:/${j.Path.reviews}/${ee}/${te}`}Object.defineProperty(d,"__esModule",{value:!0});const z=s("../models"),j=s("../data/urls"),H=s("../data/http"),q=s("../data/server-data"),G=s("../data/validation"),W=s("../wrappers/bag"),Y=s("../util/localization"),K=s("./pagination"),Q=s("../util/properties"),J=s("../models/base"),X=s("../metrics/helpers"),Z="11",$="1";d.pageSize=16,d.shouldSuppressReviewsForAdamId=function(ee){if(q.isNull(ee))return!1;const te=Q.asArray("suppressedReviewAdamIds");return te.some(ae=>{return ae===ee})},d.assembleReviewsUrl=function(ee){const te=`https://itunes.apple.com/us/customer-reviews/id${ee}`;return j.URL.from(te).param("dataOnly","true").param("displayable-kind",Z).build()},d.assembleReviewRowsUrl=function(ee,te,ae,ie){return j.URL.from("https://itunes.apple.com/WebObjects/MZStore.woa/wa/userReviewsRow").param("id",ee).param("displayable-kind",Z).param("startIndex",te+"").param("endIndex",ae+"").param("sort",ie||$).build()},d.assemblePersonalizedReviewUrl=function(ee){let te=W.default.personalizedUserReviewUrl;return te||(te="https://se.itunes.apple.com/WebObjects/MZStoreElements.woa/wa/userReview"),j.URL.from(te).param("id",ee).param("displayable-kind",Z).build()},d.assembleUserRateUrl=y,d.assembleWriteReviewUrl=A,d.userRateAction=T,d.ratingsFromApiResponses=E,d.tapToRateWithAdamId=C,d.reviewActionsForRatingsData=F,d.ratingsShelfForReviewsData=function(ee,te,ae,ie){return G.context("ratingsShelfForReviewsData",()=>{const oe=new z.Shelf("ratings");return oe.items=[E(ee,te,ae)],oe.mergeWhenFetched=!0,oe.seeAllAction=N(ee,te,ae),oe.seeAllAction.title=Y.string("ACTION_SEE_ALL"),X.addClickEventToSeeAllAction(oe.seeAllAction,null,ie),oe})},d.reviewsShelfForReviewsData=O,d.personalizedReviewActionsShelfForRatingsData=D,d.personalizedReviewShelfForRatingsData=x,d.reviewsPageForReviewsData=M,d.reviewsPageUrl=B,d.sortedReviewsPageUrl=V},{"../data/http":99,"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../models/base":119,"../util/localization":145,"../util/properties":147,"../wrappers/bag":150,"./pagination":81}],85:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const P=s("../models"),S=s("../data/server-data"),y=s("../data/legacy-artwork"),A=s("../data/validation");d.uberArtFromPageData=function(T){return A.context("uberArtFromPageData",()=>{const I=S.traverse(T,"uber");if(I){const k=S.traverse(I,"masterArt"),_=S.asString(I,"backgroundColor"),w=y.closestArtworkMatchingSize(k,2048,520);return w.backgroundColor=_,w}return null})},d.descriptionShelfFromPageData=function(T){return A.context("descriptionShelfFromPageData",()=>{const I=S.asString(T,"description");if(I){const k=new P.Paragraph(I);k.alignment="justified";const _=new P.Shelf("paragraph");return _.items=[k],_}return null})}},{"../data/legacy-artwork":100,"../data/server-data":101,"../data/validation":104,"../models":121}],86:[function(s,l,d){"use strict";function h(D){if(null===D||D===void 0)return null;return D===F.FeaturedContentID.AppStore_iAPShelf?"inAppPurchaseTiledLockup":null}function S(D,x,L=[]){return C.context("roomPageWithContext",()=>{const M=new A.Shelf(x.preferredShelfContentType||R);M.isHorizontal=!1,M.shouldFilterApps=x.shouldFilter;const N=x.ids;x.ids=[],M.items=I.lockupsFromPlatformData(D,N,{contentUnavailable:(B,V)=>{return x.ids=k.nextIdRange(N,V),!1},lockupOptions:{metricsOptions:{pageInformation:x.metricsPageInformation,locationTracker:x.metricsLocationTracker},offerSubtitlePosition:"right"}}),L.push(M);const U=new A.GenericPage(L);return x.ids.length&&(U.nextPage=x),U})}Object.defineProperty(d,"__esModule",{value:!0});const A=s("../models"),T=s("../data/server-data"),I=s("./lockups"),k=s("./pagination"),_=s("../data/urls"),w=s("./room-common"),E=s("../metrics/helpers"),C=s("../data/validation"),F=s("./grouping"),R="mediumLockup";class O{constructor(){this.profile="lockup",this.maxPerPage=k.suggestedMaxPerPage}}d.RoomPageToken=O,d.roomPageWithResponse=function(D,x,L){return C.context("roomPageWithResponse",()=>{const M=T.traverse(D,"pageData"),N=T.traverse(D,"storePlatformData.lockup.results",{}),U=E.metricsPageInformationFromResponse(D);L||(L=T.asArrayOrEmpty(M,"adamIds"),0===L.length&&(L=T.asArrayOrEmpty(M,"ids")));const B=new O;B.ids=L.map(String),B.url=`${_.Protocol.internal}:/${_.Path.room}/${_.Path.lookup}/`,B.shouldFilter=!T.asBooleanOrFalse(M,"doNotFilter"),B.metricsPageInformation=U,B.metricsLocationTracker=E.newLocationTracker();const V=T.asString(M,"fcKind");B.preferredShelfContentType=h(+V);const z=[],j=w.descriptionShelfFromPageData(M);j&&z.push(j);const H=S(N,B,z);return H.title=T.asString(M,"pageTitle"),E.copyMetricsEventsIntoPageWithInformation(H,U),H})},d.roomPageForSeeAllAction=function(D,x){const L=new A.Shelf(x||R);L.isHorizontal=!1,L.items="parentShelfItems";const M=new A.GenericPage([L]);return M.isIncomplete=!0,M.title=D,M},d.roomPageWithContext=S,d.docTypeLookupWithResponse=function(D){return C.context("docTypeLookupWithResponse",()=>{const L=T.traverse(D,"storePlatformData.lockup.results"),M=T.asArrayOrEmpty(D,"adamIds"),N=E.metricsPageInformationFromResponse(D);N.baseFields.pageType=T.asString(D,"pageType");const U=new O;U.ids=M.map(String),U.url=`${_.Protocol.internal}:/${_.Path.docTypeLookup}/${_.Path.lookup}/`,U.shouldFilter=!1,U.metricsPageInformation=N,U.metricsLocationTracker=E.newLocationTracker();const B=S(L,U);return E.copyMetricsEventsIntoPageWithInformation(B,N),B})}},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"./grouping":75,"./lockups":76,"./pagination":81,"./room-common":85}],87:[function(s,l,d){"use strict";function I(X,Z,$,ee,te){return x.context("searchResultContainerFromRawResult",()=>{let ae;const ie=X.entity,oe={metricsOptions:{pageInformation:ee,locationTracker:te,targetType:"card"},hideZeroRatings:!0};switch(ie){case"collection":case"softwareDeveloper":case"editorialItem":case"grouping":const ne={metricsPageInformation:oe.metricsOptions.pageInformation,metricsLocationTracker:oe.metricsOptions.locationTracker},se=q.todayCardFromPlatformData(Z,ne);if(se&&se.media&&"inAppPurchase"===se.media.kind){const de=se.media,ce=de.lockup;ce.theme="dark",ae=new L.SearchResultContainer("inAppPurchase",ce)}else{const de=k(Z,ie,oe.metricsOptions);if(!de)return null;ae=new L.SearchResultContainer("editorial",de)}break;case"softwareAddOn":const le=M.inAppPurchaseLockupFromPlatformData(Z,oe);le.theme="dark",ae=new L.SearchResultContainer("inAppPurchase",le);break;case"software":case"iPadSoftware":case"watchSoftware":case"messagesSoftware":case"iphoneAppBundle":case"ipadAppBundle":default:if(!(ee.iAdInfo.iAdIsPresent&&$)){delete Z.iad;const de=D.asString(Z,"kind");if("mobileSoftwareBundle"===de&&j.enabled("bundleSearchResults")){const ce=M.bundleLockupFromPlatformData(Z,oe);ae=new L.SearchResultContainer("bundle",ce)}else if(j.enabled("separatedMediaLockupTypes")){const ce=M.mixedMediaLockupFromPlatformData(Z,oe);ae=new L.SearchResultContainer("content",ce)}else{const ce=M.appTrailersLockupFromPlatformData(Z,oe);ae=new L.SearchResultContainer("content",ce)}}else if(oe.metricsOptions.isAdvert=!0,j.enabled("separatedMediaLockupTypes")){const de=M.adLockupFromPlatformData(Z,oe),ce=U.impressionOptionsForLockup(Z,de,oe.metricsOptions);U.addClickEventsToAdLockup(de,ce),U.addImpressionsFieldsToAdLockup(de,ce,ee.iAdInfo),ae=new L.SearchResultContainer("advert",de)}else{const de=M.advertisingLockupFromPlatformData(Z,oe),ce=U.impressionOptionsForLockup(Z,de,oe.metricsOptions);U.addClickEventsToAdvertisingLockup(de,ce),U.addImpressionsFieldsToAdvertisingLockup(de,ce,ee.iAdInfo),ae=new L.SearchResultContainer("advert",de)}}return ae})}function k(X,Z,$){return x.context("editorialSerachResultFromPlatformData",()=>{let ee=new L.EditorialSearchResult;ee.title=D.traverse(X,"name",null);const te={metricsPageInformation:$.pageInformation,metricsLocationTracker:$.locationTracker,prevailingCropCode:"fo"};switch(Z){case"grouping":const ae=D.traverse(X,"contentIds");if(!D.isNull(ae)&&0<ae.length)ee.collectionAdamIds=ae;else{const ie=V.artworkFromApiArtwork(D.traverse(X,"artwork"),null);ie.format="png",ee.iconArtwork=ie}ee.type="category";break;case"collection":ee.artwork=V.artworkFromApiArtwork(D.traverse(X,"artwork"),null,"sr"),ee.collectionAdamIds=D.traverse(X,"contentIds"),ee.type="collection";break;case"editorialItem":ee=_(X,te);break;case"softwareDeveloper":j.enabled("developerSearchUbers")&&(ee.artwork=V.artworkFromApiArtwork(D.traverse(X,"editorialArtwork.bannerUber"),null,"sr")),ee.artwork||(ee.collectionAdamIds=D.traverse(X,"developerTopSoftwareIds")),ee.type="developer";break;default:}if(ee){if(null!=ee.collectionAdamIds&&ee.collectionAdamIds.length){const ie=ee.collectionAdamIds.length;ee.artworkGridType=8>=ie?"large":16>=ie?"mixed":"small"}const ae=U.impressionOptions(X,ee.title,$);ee.clickAction=M.actionFromPlatformData(X,ae),U.addImpressionFields(ee,ae)}return ee})}function _(X,Z){const $=q.todayCardFromPlatformData(X,Z);if(!$)return null;const ee=new L.EditorialSearchResult;if(ee.type="story",ee.title=$.title,ee.clickAction=$.clickAction,$.media)switch($.media.kind){case"brandedSingleApp":const te=$.media;ee.artwork=te.art;const ae=D.asString(X,"displaySubStyle");switch(ae){case"GameOfDay":case"AppOfDay":const de=D.asString(X,"cardIds.0"),ce=D.traverse(X,"relatedContent"),pe=ce&&ce[de];pe&&(ee.title=D.asString(pe,"name")||ee.title);break;default:}break;case"list":const ie=$.media;ee.collectionAdamIds=ie.lockups.map(de=>{return de.adamId});break;case"river":const oe=$.media;ee.collectionAdamIds=oe.lockups.map(de=>{return de.adamId});break;case"artwork":const ne=$.media;ee.artwork=ne.art;break;case"grid":const se=$.media;ee.collectionAdamIds=se.lockups.map(de=>{return de.adamId});break;case"video":const le=$.media;ee.artwork=le.video.preview,ee.subtitle=le.description;break;default:}if($.overlay)switch($.overlay.kind){case"lockup":const te=$.overlay;ee.artwork||(ee.collectionAdamIds=[te.lockup.adamId]);break;case"lockupList":const ae=$.overlay;ee.collectionAdamIds=ae.lockups.map(oe=>{return oe.adamId});break;case"paragraph":const ie=$.overlay;ee.subtitle=ie.paragraph.text;break;default:}return ee.collectionAdamIds||ee.artwork?ee:null}function w(X,Z=null,$,ee){return{results:X,profile:W,maxPerPage:J,url:Z,renderedAdvertIds:{},pageInformation:$,metricsLocationTracker:ee}}function E(X){return JSON.stringify(X)}Object.defineProperty(d,"__esModule",{value:!0});const O=s("../data/urls"),D=s("../data/server-data"),x=s("../data/validation"),L=s("../models"),M=s("./lockups"),N=s("../wrappers/client"),U=s("../metrics/helpers"),B=s("../util/localization"),V=s("./content"),z=s("./filtering"),j=s("../util/properties"),H=s("../wrappers/client-ordering"),q=s("./today"),G=s("../wrappers/store"),W="native-search-lockup";d.SearchToken=class{};d.SearchAdData=class{constructor(X,Z){X&&(this.appStoreClientRequestId=Z,this.targetingData=X.dataBlob,this.iAdId=X.iAdId)}validAdRequest(){return this.targetingData&&0<this.targetingData.length}},d.assembleUrl=function(X,Z,$,ee=N){let te=O.URL.from(X).param("caller","com.apple.AppStore").param("version","1");D.isNull(Z)||(te=te.param("term",Z));for(const ae of Object.keys($))te=te.param(ae,$[ae]);return te="Watch"===ee.name?te.param("media","watchSoftware").param("clientApplication","Watch"):"Messages"===ee.name?te.param("clientApplication","Messages"):te.param("clientApplication","Software"),te.build()},d.searchHintsFromApiResponse=function(X,Z,$){return x.context("searchHintsFromApiResponse",()=>{const ee=U.newLocationTracker(),te=D.asArrayOrEmpty($,"hints").map(oe=>{const ne=new L.SearchAction(D.asString(oe,"term"),D.asString(oe,"url"),"hints");return U.addClickEventToInitiateSearch(ne,X,ee),U.nextPosition(ee),ne}),ae=new L.MetricsSearchEvent(X,"key","input",Z,{}),ie=new L.SearchHintSet(te);return ie.metricsEvents=[ae],ie})},d.trendingSearchesFromApiResponse=function(X){return x.context("trendingSearchesFromApiResponse",()=>{const Z=U.newLocationTracker(),$=D.asArrayOrEmpty(X,"trendingSearches").map(ae=>{const ie=D.asString(ae,"label"),oe=new L.SearchAction(ie,D.asString(ae,"url"),"trending");return U.addClickEventToInitiateSearch(oe,ie,Z),U.nextPosition(Z),oe}),ee=0<$.length?D.asString(X,"header.label"):null,te=new L.TrendingSearches(ee,$);switch(N.deviceType){case"pad":te.maxNumberOfSearches=10;break;case"phone":te.maxNumberOfSearches=7;break;default:}return te})},d.emptyResults=function(){const X=new L.SearchResults;return X.results=[],X},d.responseWithPrewarmData=function(X){return new Promise(Z=>{const ee=D.traverse(X,["storePlatformData",W,"results"],{});let te=!0;const ae=Object.keys(ee);let ie=!1;if(0===ae.length)te=!1;else if(1===ae.length){const oe=ee[ae[0]];ie=null!==D.traverse(oe,"iad",null),te=!ie}if(!te){const oe=D.traverse(X,"pageData.bubbles.0",{}),ne=D.asArrayOrEmpty(oe,"results").map(ce=>{return ce.id});if(0===ne.length)return void Z(X);if(ne.length===ae.length)return void Z(X);let se=0;if(ie&&(se++,1<ne.length&&ne[0]===ne[1]&&se++),se===ne.length)return void Z(X);const le=ne.slice(se,Math.min(ne.length,20)-se),de=G.fetchStorePlatformData(le,{p:W}).then(ce=>{const pe=Object.assign({},ce,ee);X.storePlatformData[W]={results:pe},Z(X)})}else Z(X)})},d.resultsFromApiResponse=function(X,Z,$,ee,te){const ae={},ie=x.context("resultsFromApiResponse",()=>{const oe=D.traverse(X,["storePlatformData",W,"results"],{}),ne=[],se={},le=[],de=U.metricsPageInformationFromResponse(X);de.searchTerm=ee,de.pageUrl=te,de.iAdInfo=new U.IAdSearchInformation($.iAdId,$.appStoreClientRequestId);const ce=U.newLocationTracker(),pe=D.traverse(X,"pageData.bubbles.0",{});for(const Se of D.asArrayOrEmpty(pe,"results")){const ye=oe[Se.id];if(!ye){le.push({id:Se.id,entity:Se.entity});continue}if(!z.shouldFilter(ye)){const Ae=D.traverse(ye,"iad",null);let Te=!1;Ae&&!se[ye.id]&&(Te=!0,se[ye.id]=!0,de.iAdInfo.apply(ye.id,Ae));const ve=Se.entity;if("editorial"!==ve){const Ie=I(Se,ye,Te,de,ce);if(Ie){if("inAppPurchase"===Ie.type){const ke=Ie.resultModel;ke&&ke.parent&&(ae[ke.productIdentifier]=ke.parent.bundleId)}ne.push(Ie),U.nextPosition(ce)}}}}const ue=[],me=D.traverse(X,"pageData.facets",{});ue.push(new L.SearchFacetSet("deviceType",[new L.SearchFacetValue(B.string("SEARCH_FACET_IPAD_ONLY"),null,Z.deviceType),new L.SearchFacetValue(B.string("SEARCH_FACET_IPHONE_ONLY"),"iPhone",Z.deviceType)])),ue.push(new L.SearchFacetSet("price",[new L.SearchFacetValue(B.string("SEARCH_FACET_ANY_PRICE","Any"),null,Z.price),new L.SearchFacetValue(B.string("SEARCH_FACET_FREE","Any"),"freeOnly",Z.price)]));const fe=D.asArrayOrEmpty(me,"genres");if(fe.length){const Se=fe.map(ye=>{return new L.SearchFacetValue(D.asString(ye,"name"),D.asString(ye,"id"),Z.genreId)});Se.unshift(new L.SearchFacetValue(B.string("SEARCH_FACET_ANY_CATEGORY","Any"),null,Z.genreId)),ue.push(new L.SearchFacetSet("genreId",Se))}const ge=[new L.SearchFacetValue(B.string("SEARCH_FACET_RELEVANCE"),null,Z.sort)];for(const Se of D.asArrayOrEmpty(me,"sorts"))ge.push(new L.SearchFacetValue(B.string("SEARCH_FACET_"+Se),Se,Z.sort));1<ge.length&&ue.push(new L.SearchFacetSet("sort",ge));const he=D.asArrayOrEmpty(me,"ageBands").map(Se=>{return new L.SearchFacetValue(D.asString(Se,"name"),D.asString(Se,"ageBandId","coercible"),Z.ageBandId)});0<he.length&&ue.push(new L.SearchFacetSet("ageBandId",he));const Pe=new L.SearchResults;if(Pe.results=ne,Pe.facets=ue,Pe.isAutoPlayEnabled=!0,0<le.length){const Se=w(le,null,de,ce);Se.renderedAdvertIds=se,Pe.nextPage=E(Se)}return U.copyMetricsEventsIntoPageWithInformation(Pe,de),Pe});return new Promise(oe=>{0===Object.keys(ae).length?oe(ie):H.visibilityForIAPs(ae).then(se=>{const le=ie.results.filter(de=>{const ce=de;if(!ce||"inAppPurchase"!==ce.type)return!0;const pe=ce.resultModel;if(!pe)return!1;const ue=se[pe.productIdentifier];return null===ue||void 0===ue?pe.isVisibleByDefault:ue});ie.results=le,oe(ie)})})},d.resultsFromLookupResponse=function(X,Z,$){return x.context("resultsFromLookupResponse",()=>{const ee=U.newLocationTracker(),te=[];for(const ie of Z){const oe=ie.id,ne=X[oe];if(!ne){console.warn(`no data found for ${oe}, skipping`);continue}if(!z.shouldFilter(ne)){const se=D.traverse(ne,"iad",null);let le=!1;se&&(le=!0,$.renderedAdvertIds[ne.id]=!0);const de=I(ie,ne,le,$.pageInformation,$.metricsLocationTracker);de&&te.push(de)}}const ae=new L.SearchResults;return ae.results=te,ae.nextPage=E($),ae})};const J=30;d.createSearchToken=w,d.tokenToJSONString=E,d.searchTokenFromJSONString=function(X){return JSON.parse(X)},d.getResultsForLookup=function(X){return X&&X.results?X.results.slice(0,X.maxPerPage):[]},d.nextSearchToken=function(X){let Z=[];X&&X.results&&(Z=X.results.slice(X.maxPerPage,X.results.length));const $=Object.assign({},X);return $.results=Z,$}},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"../util/properties":147,"../wrappers/client":152,"../wrappers/client-ordering":151,"../wrappers/store":155,"./content":72,"./filtering":74,"./lockups":76,"./today":96}],88:[function(s,l,d){"use strict";function g(C){if(!E.default.isContentGiftingEnabled)return null;if(I.isNull(C))return null;const F=I.traverse(C,"offers.0");if(I.isNull(F))return null;const R=T.isPreorderFromPlatformData(C);if(R)return null;const O=I.asNumber(F,"price");return 0<O?I.asString(C,"id"):null}function h(C){return w.context("notesMetadataFromProductData",()=>{if(I.isNull(C))return null;const F=I.asString(C,"name");if(!F||0===F.length)return null;const R=I.asString(C,"artistName"),O=I.asString(C,"genreNames.0"),D=A.fileSizeInBytesFromProductData(C),x=I.asString(C,"kind");let L;switch(x){case"iosSoftware":{L="app";break}case"mobileSoftwareBundle":{L="bundle";break}case"softwareAddOn":{L="iap";break}default:L=null;}return new k.ShareSheetNotesMetadata(F,R,O,D,L)})}function P(C,F,R,O,D,x){return O?w.context("shareSheetDataWithContext",()=>{let L=null,M=null,N=null,U=null;return!I.isNull(x)&&I.asString(x,"url")&&(F&&(M=g(x)),L=A.iconFromPlatformData(x),N=I.asNumber(x,"contentRatingsBySystem.appsApple.value"),U=h(x)),new k.ShareSheetData(C,R,O,D,L,M,N,U)}):null}Object.defineProperty(d,"__esModule",{value:!0});const A=s("./content"),T=s("./offers"),I=s("../data/server-data"),k=s("../models"),_=s("../util/localization"),w=s("../data/validation"),E=s("../wrappers/bag");d.adamIdForShareSheetGiftActivityFromProductData=g,d.shareSheetDataWithContext=P,d.shareSheetDataForArticle=function(C,F,R,O){return P("article",!0,C,F,R,O)},d.shareSheetDataForProductFromProductData=function(C,F){return I.isNull(C)?null:w.context("shareSheetDataForProductFromProductData",()=>{const R=I.asString(C,"url"),O=I.asString(C,"shortUrl"),D=I.asString(C,"name"),x=I.asString(C,"artistName");if(!R||!D||!x)return null;const L=_.string("SHARE_SHEET_PRODUCT_TITLE_FORMAT").replace("{title}",D).replace("{developer}",x);return P("product",F,L,R,O,C)})}},{"../data/server-data":101,"../data/validation":104,"../models":121,"../util/localization":145,"../wrappers/bag":150,"./content":72,"./offers":79}],89:[function(s,l,d){"use strict";function h(){const N=new L.Shelf("screenshots"),U=new L.Artwork("http://is1.mzstatic.com/image/thumb/Purple122/v4/ce/df/03/cedf037f-61d8-d3ad-6bb8-45916b37fc25/source/{w}x{h}bb.{f}",1242,2208),B=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple122/v4/9d/7f/d9/9d7fd952-cb91-11f6-75ab-2b0b2f153fab/source/{w}x{h}bb.{f}",1242,2208),V=new L.Artwork("http://is5.mzstatic.com/image/thumb/Purple111/v4/1f/c9/ad/1fc9ad8c-f709-6e80-d40b-f88f9650ed37/source/{w}x{h}bb.{f}",1242,2208),z=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple122/v4/fc/4b/a7/fc4ba73c-49f8-59aa-acd6-af59f7857438/source/{w}x{h}bb.{f}",1242,2208),j=new L.Artwork("http://is5.mzstatic.com/image/thumb/Purple122/v4/09/f3/e1/09f3e1ce-8109-35de-a565-777841df1aee/source/{w}x{h}bb.{f}",1242,2208),q=new L.MediaPlatform("phone");return N.items=[new L.Screenshots([U,B,V,z,j],q)],N}function P(){const N=new L.Shelf("screenshots"),U=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple20/v4/89/98/e7/8998e773-5ed4-9954-532c-e98d940a1753/source/{w}x{h}bb.{f}",2048,1536),B=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple30/v4/3e/58/4f/3e584f42-a45f-5299-ea78-1ee3f54eff1e/source/{w}x{h}bb.{f}",2048,1536),V=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple30/v4/5d/ca/59/5dca590a-8992-5f8a-f8f3-6c73dd07b1a6/source/{w}x{h}bb.{f}",2048,1536),z=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple60/v4/ea/aa/82/eaaa82e8-9692-6ce8-63f9-8c805005126d/source/{w}x{h}bb.{f}",2048,1536),j=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple18/v4/18/2d/06/182d062c-5216-b6f8-6421-6c45391ec211/source/{w}x{h}bb.{f}",2048,1536),q=new L.MediaPlatform("pad");return N.items=[new L.Screenshots([U,B,V,z,j],q)],N}function S(){const N=new L.Shelf("paragraph"),B=new L.Paragraph("","text/plain");return N.items=[B],N}function y(){const N=new L.Shelf("appShowcase");N.backgroundColor="F1F4F6";const U=F(),B=new L.AppShowcase("large",U);return B.description="Editorial description that can go to a maximum of 2 lines.",U.offerDisplayProperties.hasInAppPurchases=!1,N.items=[B],N}function A(){const N=new L.Shelf("appShowcase");N.backgroundColor="F1F4F6";const U=new L.AppShowcase("large",F());return U.description="Editorial description that can go a maximum of 2 lines.",U.video=_(),N.items=[U],N}function T(){const N=new L.Shelf("appShowcase");N.backgroundColor="F1F4F6";const U=R();U.offerDisplayProperties.hasInAppPurchases=!1;const B=new L.AppShowcase("large",U);return B.description="Editorial description that can go a maximum of 2 lines.",B.video=w(),N.items=[B],N}function I(){const N=new L.Shelf("appShowcase");N.backgroundColor="F1F4F6";const U=new L.AppShowcase("small",O());return U.description="Editorial description with one line maximum.",U.video=w(),N.items=[U],N}function k(){const N=new L.Shelf("appShowcase");N.backgroundColor="F1F4F6";const U=new L.AppShowcase("smallAlignedLeft",F());return U.description="Editorial description with one line maximum.",U.video=E(),N.items=[U],N}function _(){const U=new L.Artwork("http://is3.mzstatic.com/image/thumb/Video122/v4/3f/f0/ad/3ff0ad5d-4f84-57c6-f828-a8caf69d2491/source/{w}x{h}bb.{f}",1920,1080);return new L.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo111/v4/93/8c/47/938c475c-187f-2109-460b-dc39c900dcaa/P42531580_default.m3u8",U)}function w(){const U=new L.Artwork("http://is3.mzstatic.com/image/thumb/Video71/v4/58/48/06/584806a0-c78a-8490-0afa-9b18528f5458/source/{w}x{h}bb.{f}",1080,1920);return new L.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo71/v4/b4/e1/b9/b4e1b9c3-f57d-13be-ac70-0ea4956d3c11/P39880163_default.m3u8",U)}function E(){const U=new L.Artwork("http://isq07.mzstatic.com/image/thumb/Purple6/v4/e7/14/8f/e7148f9e-b713-e955-c627-61a3c18a07cd/source/{w}x{h}bb.{f}",640,960);return new L.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo18/v4/43/27/ad/4327ad73-a80c-84e2-f13f-db2edd5cb830/P38656392_default.m3u8",U)}function C(){const N=new L.FlowAction("product");return N.pageUrl="https://itunes.apple.com/us/app/angry-birds-star-wars/id557137623?mt=8",N}function F(){const N=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);N.style="roundedRect";const U=new L.PurchaseConfiguration("1094591345","Niantic, Inc.","Pok\xE9mon GO","com.nianticlabs.pokemongo",null),B=new L.Lockup;B.adamId="1094591345",B.title="Pok\xE9mon GO",B.subtitles=["Niantic, Inc."],B.icon=N;const V=new L.OfferDisplayProperties("app",B.adamId,"colored");return V.hasInAppPurchases=!0,B.offerDisplayProperties=V,B.buttonAction=new L.OfferAction("GET","1094591345",U),B.clickAction=C(),B}function R(){const N=new L.Artwork("http://is1.mzstatic.com/image/thumb/Purple122/v4/2f/20/9f/2f209f6c-1855-1656-4a16-fe5c8b4ea220/source/{w}x{h}bb.{f}",1024,1024);N.style="roundedRect";const U=new L.PurchaseConfiguration("1145275343","Nintendo Co., Ltd.","Super Mario Run","com.nintendo.zara",null),B=new L.Lockup;B.adamId="1145275343",B.title="Super Mario Run",B.subtitles=["Nintendo Co., Ltd."],B.icon=N;const V=new L.OfferDisplayProperties("app",B.adamId,"colored");return V.hasInAppPurchases=!0,B.offerDisplayProperties=V,B.buttonAction=new L.OfferAction("GET","1145275343",U),B.clickAction=C(),B}function O(){const N=new L.PurchaseConfiguration("1152842283","Nintendo Co., Ltd.","Super Mario Run Stickers","com.nintendo.zara",null),U=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple111/v4/da/62/dc/da62dc63-be6b-aeb0-932c-66d998c652aa/source/{w}x{h}bb.{f}",1024,768);U.style="pill";const B=new L.Lockup;B.adamId="1152842283",B.title="Super Mario Run Stickers",B.subtitles=["Nintendo Co., Ltd."],B.icon=U;const V=new L.OfferDisplayProperties("app",B.adamId,"colored");return V.hasInAppPurchases=!0,B.offerDisplayProperties=V,B.buttonAction=new L.OfferAction("GET","1152842283",N),B.clickAction=C(),B}function D(){const N=new L.Shelf("inAppPurchaseShowcase");N.backgroundColor=L.InAppPurchaseShowcase.backgroundColor;const U=new L.InAppPurchaseShowcase(x());return U.subtitle="In-App Purchase for PinOut! Pinball.",U.description="May the force be with you.",N.items=[U],N}function x(){const N="1094591345",B=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);B.style="iap";const V=new L.Artwork("http://isq06.mzstatic.com/image/thumb/Purple117/v4/f9/69/5b/f9695b10-4f84-87bc-c3b4-9c3bba13d751/source/{w}x{h}bb.{f}",1024,1024);V.style="roundedRect";const z=new L.FlowAction("inAppPurchaseInstall");z.pageUrl=M.configureIAPInstallPageUrl(N,"1094591345");const j=new L.InAppPurchaseLockup;j.adamId=N,j.icon=B;const H=new L.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);H.style="roundedRect";const q=new L.Lockup;q.adamId="1094591345",q.title="Pok\xE9mon GO",q.icon=H,j.parent=q,j.title="Super Level Pack",j.description="May the force be with you. 32 exciting new levels.",j.theme="dark",j.buttonAction=new L.InAppPurchaseAction("com.apple.testIAPIdentifier",q.adamId,"com.rovio.angrybirdsstarwars",z,null);const G=new L.PurchaseConfiguration("1094591345","Niantic, Inc.","Pok\xE9mon GO","com.nianticlabs.pokemongo");j.buttonAction=new L.OfferAction("GET","1117844680",G);const W=new L.OfferDisplayProperties("app",N,"colored");j.offerDisplayProperties=W;const Y=new L.FlowAction("product");return Y.pageUrl=M.configureProductUrlFromInAppPurchase("https://itunes.apple.com/us/app/angry-birds-star-wars/id557137623?mt=8","com.rovio.testInAppId",!1),j.productAction=Y,j}Object.defineProperty(d,"__esModule",{value:!0});const L=s("../../models"),M=s("../lockups");d.testArticlePage=function(){const N=new L.Shelf("paragraph");N.items=[new L.Paragraph("The <b>next wave</b> of Pok\xE9mon is here! We love chasing all the new catches (Jumpluff, you will be ours!), but now it's time for more. \u201CPok\xE9mon GO is in the very beginning of what you\u2019ll see,\u201D says Raza Ahmad of Niantic. \u201CThis is page one of chapter one.\u201D Real-world events will soon pop up around the world, giving trainers a chance to gather in festival-style meet-ups and tackle group challenges, talk shop, and hang out. Gyms will get an overhaul, so players of every level can find a good, fair battle. And then there are the new missions that\u2019ll send you on a trek across the real world, unlocking the rarest of catches. More than 800 Pok\xE9mon have appeared already, and it looks like we won't run out of chapters anytime soon!","text/x-apple-as3-nqml","article")];const U=new L.Shelf("link");U.items=[new L.Link("A whole new world of accessories awaits you. Why not buy some?","apple.com",new L.ExternalUrlAction("https://apple.com"))];const B=new L.Artwork("https://pics.onsizzle.com/what-in-hydration-meow-irl-15236956.png",500,611),V=new L.Artwork("https://static01.nyt.com/images/2016/08/05/us/05onfire1_xp/05onfire1_xp-master768-v2.jpg",768,364),j=new L.Artwork("http://images.deccanchronicle.com/4af1e5891ce5b320bee7342c10ef7c650f4355da-tc-img-preview.jpg",800,727),q=new L.Artwork("https://s-media-cache-ak0.pinimg.com/originals/0b/12/e0/0b12e0aeb92732253f5778bef82408e0.png",1600,1280),G=new L.Artwork("https://s-media-cache-ak0.pinimg.com/originals/18/63/a3/1863a3bc5e2207f9fc71a6d738eb43fd.jpg",1452,2112),Y=new L.Artwork("http://cdn.cultofmac.com/wp-content/uploads/2013/06/Screen-Shot-2013-06-10-at-2.07.16-PM.jpg",640,359),Q=new L.Shelf("framedArtwork");Q.items=[new L.FramedArtwork(B,!1),new L.FramedArtwork(V,!1,"text/plain","\"Everything is fine\", quips dog in burning building. \"I am completely ok with this turn of events.\""),new L.FramedArtwork(j,!1,"text/plain","This cat does not appreciate time travel to certain destinations and eras.","1"),new L.FramedArtwork(q,!0),new L.FramedArtwork(G,!0,"text/x-apple-as3-nqml","I <b>didn't</b> start skiing until I was 50. My wife Lois taught me how to ski. I'm proficiently conservative. <i>&mdash; Buzz Aldrin</i>"),new L.FramedArtwork(Y,!0,"text/plain","In the browser!","2")];const J=new L.Shelf("quote");J.items=[new L.Quote("Two things are infinite: the universe and human stupidity; and I'm not sure about the universe.","Albert Einstein",new L.Artwork("http://s2.glbimg.com/2XRZcym-YggbI8KhFZiUKqgSaMI=/695x0/s.glbimg.com/po/tt2/f/original/2015/06/03/albert-einstein.jpg",695,463),!1),new L.Quote("I've missed more than 9000 shots in my career. I've lost almost 300 games. 26 times I've been trusted to take the game winning shot and missed. I've failed over and over and over again in my life. And that is why I succeed.","Michael Jordan",new L.Artwork("http://static.highsnobiety.com/wp-content/uploads/2014/10/michael-jordan-air-jordan-1-nba-ban-00.jpg",705,423),!0),new L.Quote("If you ask me anything I don\u2019t know, I\u2019m not going to answer.","Yogi Berra"),new L.Quote("My goal this weekend is to move... just enough so people don't think I'm dead.")];const X=new L.Artwork("http://is5.mzstatic.com/image/thumb/Video111/v4/62/7b/3e/627b3e14-0580-8ad0-05aa-902f24f89d05/source/{w}x{h}bb.{f}",1200,900),Z=new L.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo122/v4/42/aa/44/42aa44d4-8a92-2380-7c8a-3ca2f496acb1/P40205198_default.m3u8",X),$="In this gorgeous twist on the infinite runner, you guide an agile snowboarder down a never-ending mountain.",ee=new L.Shelf("framedVideo");ee.items=[new L.FramedVideo(Z,!1),new L.FramedVideo(Z,!0),new L.FramedVideo(Z,!0,"text/plain",$),new L.FramedVideo(Z,!1,"text/plain",$),new L.FramedVideo(Z,!1,"text/plain",$,"1")];const te=new L.ShareSheetData("article","Share this article with friends!","https://www.apple.com"),ae=new L.ShareSheetAction(te),ie=new L.Shelf("roundedButton"),oe=new L.RoundedButton("share","Share Story",!1,ae);return ie.items=[oe],new L.ArticlePage(null,[S(),h(),P(),N,U,Q,S(),y(),S(),A(),S(),T(),S(),I(),S(),k(),S(),D(),J,S(),ee,S(),ie])}},{"../../models":121,"../lockups":76}],90:[function(s,l,d){"use strict";function g(h){for(var P in h)d.hasOwnProperty(P)||(d[P]=h[P])}Object.defineProperty(d,"__esModule",{value:!0}),g(s("./article-test-page")),g(s("./lockup-test-page")),g(s("./misc-test-page")),g(s("./test-page")),g(s("./text-and-image-test-page")),g(s("./today-test-page"))},{"./article-test-page":89,"./lockup-test-page":91,"./misc-test-page":92,"./test-page":93,"./text-and-image-test-page":94,"./today-test-page":95}],91:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../../models");d.lockupTestPage=function(){const P=new h.AlertAction("toast");P.title="Click",P.message="Actions are working";const S=new h.AlertAction("toast");S.title="GET",S.message="You can't buy this!";const y=new h.Lockup;y.adamId="1117844680",y.icon=new h.Artwork("http://is2.mzstatic.com/image/thumb/Purple30/v4/f3/0d/57/f30d5755-4ed7-30db-11ea-499886b5b33f/source/{w}x{h}bb.{f}",1024,1024),y.title="Endless Ducker",y.subtitles=["Dude Perfect"],y.clickAction=P;const A=new h.Shelf("smallLockup");A.title="Horizontal Small Lockups",A.items=[y,y,y,y,y,y],A.isHorizontal=!0;const T=new h.Shelf("smallLockup");T.title="Vertical Small Lockups",T.items=[y,y,y,y];const I=new h.Shelf("mediumLockup");I.title="Horizontal Medium Lockups",I.items=[y,y,y,y,y,y],I.isHorizontal=!0;const k=new h.Shelf("mediumLockup");k.title="Vertical Medium Lockups",k.items=[y,y,y,y];const _=new h.Shelf("largeLockup");_.title="Horizontal Large Lockups",_.items=[y,y,y,y,y,y],_.isHorizontal=!0;const w=new h.Shelf("largeLockup");w.title="'Vertical' Large Lockups",w.items=[y,y,y,y];const E=new h.GenericPage([A,I,_,T,k,w]);return E.title="Lockups",E.presentationOptions=[],E}},{"../../models":121}],92:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../../models");d.miscTestPage=function(){const P=new h.AlertAction("toast");P.title="Click",P.message="Actions are working";const S=new h.EditorialCard;S.caption="Featured",S.title="Minecraft gets updated",S.subtitle="It's a lot faster",S.artwork=new h.Artwork("http://is4.mzstatic.com/image/thumb/Purple49/v4/a4/bb/fa/a4bbfa0e-393d-aab7-f789-03376f7c10ea/source/{w}x{h}bb.{f}",2048,1536),S.clickAction=P;const y=new h.Brick;y.artwork=new h.Artwork("http://isq06.mzstatic.com/image/thumb/Features127/v4/dd/07/49/dd0749bd-324f-b7c0-2127-ce7b8eaef196/source/{w}x{h}sr.{f}",426,270),y.accessibilityLabel="iJet: Shop together in iMessage",y.shortEditorialDescription="This is a short editorial description going two lines. And then some more.",y.clickAction=P;const A=new h.Shelf("brick");A.title="'Vertical' Bricks",A.items=[y,y,y,y,y,y];const T=new h.Shelf("brick");T.title="Horizontal Bricks",T.items=[y,y,y,y,y,y],T.isHorizontal=!0;const I=new h.Shelf("brick");I.title="Horizontal Bricks with Text",I.items=[y,y,y,y,y,y],I.isHorizontal=!0,I.presentationHints=new h.ShelfPresentationHints,I.presentationHints.showSupplementaryText=!0;const k=new h.Shelf("editorialCard");k.title="Vertical Editorial Cards",k.items=[S,S,S];const _=new h.Shelf("editorialCard");_.title="Horizontal Editorial Cards",_.items=[S,S,S],_.isHorizontal=!0;const w=new h.ExternalUrlAction("https://apple.com");w.title="Open apple.com",w.artwork=new h.Artwork("http://is1.mzstatic.com/image/thumb/Purple82/v4/f4/e1/21/f4e121c4-3785-8df9-f5ae-07c7d78df41c/mzl.kmqfemjr.png/150x150bb-85.jpg",22,22);const E=new h.ExternalUrlAction("prefs:root=CASTLE");E.title="Open iCloud Settings",E.artwork=new h.Artwork("resource://Developer.png",22,22),E.isSensitive=!0;const C=new h.HttpTemplateAction("https://notareal.site");C.title="Test Template Action",C.message="This request will fail by design",C.body="{}";const F=new h.HttpTemplateParameter("person.comment","jsonBody","text","Comment");F.isRequired=!1,F.maximumLength=100,C.parameters=[new h.HttpTemplateParameter("person.name","jsonBody","text","Name"),new h.HttpTemplateParameter("person.email","jsonBody","email","Email"),new h.HttpTemplateParameter("person.phoneNumber","jsonBody","phoneNumber","Phone Number"),new h.HttpTemplateParameter("person.amount","jsonBody","decimalPad","Amount"),F];const R=new h.Shelf("action");R.title="Horizontal Actions",R.items=[w,E,C,w,E,C],R.isHorizontal=!0;const O=new h.Shelf("action");O.title="Vertical Actions Odd Items",O.items=[w,E,C];const D=new h.Shelf("action");D.title="Vertical Actions Even Items",D.items=[w,E,C,P,w,E];const x=new h.FooterButton("Redeem",P),L=new h.FooterButton("Send Gift",P),M=new h.Shelf("footerButton");M.items=[x,L];const N=new h.Shelf("footerButton");N.items=[x];const U=new h.GenericPage([T,I,_,R,A,k,O,D,M,N]);return U.title="Miscellaneous",U.presentationOptions=[],U}},{"../../models":121}],93:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../../models"),P=s("../../data/urls");d.testPage=function(){const S=new h.FlowAction("page");S.title="Text and Images",S.pageUrl=`${P.Protocol.internal}:/${P.Path.test}/${P.Path.textAndImagesTest}`;const y=new h.FlowAction("page");y.title="Lockups",y.pageUrl=`${P.Protocol.internal}:/${P.Path.test}/${P.Path.lockupsTest}`;const A=new h.FlowAction("page");A.title="Miscellaneous",A.pageUrl=`${P.Protocol.internal}:/${P.Path.test}/${P.Path.miscTest}`;const T=new h.Shelf("action");T.items=[S,y,A];const I=new h.GenericPage([T]);return I.title="Available Components",I}},{"../../data/urls":103,"../../models":121}],94:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../../models");d.textAndImagesTestPage=function(){const P=new h.Shelf("artwork");P.items=[new h.Artwork("http://is3.mzstatic.com/image/thumb/Features5/v4/0b/4e/f8/0b4ef82e-c447-1949-c7f3-ac1896573d5c/source/{w}x{h}{c}.{f}",3200,600)];const S=new h.Paragraph("veryday carry salvia forage, vinyl crucifix live-edge hoodie squid literally cardigan tumeric. Squid tousled taxidermy fanny pack, lomo jianbing small batch listicle vape twee. Salvia roof party retro master cleanse.");S.alignment="left";const y=new h.Paragraph("Kickstarter viral prism, butcher four loko umami meditation man bun blog. Dreamcatcher snackwave tote bag, messenger bag cardigan la croix chia iPhone mlkshk affogato yuccie. Letterpress fanny pack ramps typewriter, swag flannel cornhole cred umami. Viral raw denim air plant, pabst williamsburg cold-pressed skateboard.");y.alignment="center";const A=new h.Paragraph("Hella master cleanse scenester, hexagon ugh la croix succulents lo-fi mumblecore pop-up typewriter freegan bespoke art party brooklyn. Lomo viral pour-over you probably haven't heard of them retro. Bespoke next level master cleanse, celiac dreamcatcher freegan four dollar toast portland vinyl hashtag. Yr chicharrones pok pok ramps fap tattooed.");A.alignment="right";const T=new h.Shelf("paragraph");T.title="Plain Text",T.items=[S,y,A];const I=new h.Paragraph(`This is a rich text string<br>
         <b>Bold</b><br>
         <em>Bold again</em><br>
         <i>Italic</i><br>
         <u>Underlined</u><br>
         <del>Strike through</del><br>
         <p><b><i>This</i></b> is a paragraph</p>`,"text/x-apple-as3-nqml"),k=new h.Paragraph(`<ol>
            <li>first ordered list item</li>
            <li>second ordered list item</li>
            <li>third ordered list item</li>
        </ol>
        <ul>
            <li>first unordered list item</li>
            <li>second unordered list item</li>
            <li>third unordered list item</li>
        </ul>`,"text/x-apple-as3-nqml"),_=new h.Shelf("paragraph");_.title="Rich Text",_.items=[I,k];const w=new h.GenericPage([P,T,_]);return w.title="Text and Images",w}},{"../../models":121}],95:[function(s,l,d){"use strict";function h(w,E){const C=new A.TodayCard;return C.heading=`FALLBACK ${E}`,C.title=`${E} things you need to know`,C.style="white",C.media=new A.TodayCardMediaMultiApp(y(E,F=>{const R=T.shallowCopyOf(w);return R.ordinal=I.decimal(F+1),R}),"This one line of text goes at the bottom and should truncate tail"),C.backgroundColor=A.TodayCardMediaMultiApp.multiAppBackgroundColor,C}function P(w){const F=new A.TodayCard;return F.heading=I.string("CARD_TITLE_IN_APP_PURCHASE"),F.media=new A.TodayCardInAppPurchase(S("1094591345","1094591345","dark")),F.clickAction=w,F.backgroundColor="F1F4F6",F}function S(w,E,C){const F=new A.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);F.style="iap";const R=new A.Artwork("http://isq06.mzstatic.com/image/thumb/Purple117/v4/f9/69/5b/f9695b10-4f84-87bc-c3b4-9c3bba13d751/source/{w}x{h}bb.{f}",1024,1024);R.style="roundedRect";const O=new A.FlowAction("inAppPurchaseInstall"),D=I.string("INSTALL_PAGE_BANNER_MESSAGE");O.pageUrl=k.configureIAPInstallPageUrl(w,E,D);const x=new A.InAppPurchaseLockup;x.adamId=w,x.icon=F;const L=new A.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);L.style="roundedRect";const M=new A.Lockup;M.adamId="1094591345",M.title="Pok\xE9mon GO",M.icon=L,x.parent=M,x.title="Super Level Pack",x.description="May the force be with you. 32 exciting new levels.",x.theme=C,x.buttonAction=new A.InAppPurchaseAction("com.apple.testIAPIdentifier",M.adamId,"com.rovio.angrybirdsstarwars",O,null);const N=new A.PurchaseConfiguration("1094591345","Niantic, Inc.","Pok\xE9mon GO","com.nianticlabs.pokemongo");x.buttonAction=new A.OfferAction("GET","1117844680",N);const U=new A.OfferDisplayProperties("app",w).newOfferDisplayPropertiesChangingAppearance(!1,"colored");x.offerDisplayProperties=U;const B=new A.FlowAction("product");return B.pageUrl=k.configureProductUrlFromInAppPurchase("https://itunes.apple.com/us/app/angry-birds-star-wars/id557137623?mt=8","com.rovio.testInAppId",!1),x.productAction=B,x}function y(w,E){const C=Array(w);for(let F=0;F<w;F++)C[F]=E(F);return C}Object.defineProperty(d,"__esModule",{value:!0});const A=s("../../models"),T=s("../../util/objects"),I=s("../../util/localization"),k=s("../lockups"),_=s("./article-test-page");d.testTodayPage=function(){const w=new A.FlowAction("article");w.pageData=_.testArticlePage();const E=new A.AlertAction("default");E.title="Nested Element Tapped",E.message="Everything is working a-ok",E.isCancelable=!0;const C=new A.Artwork("http://is2.mzstatic.com/image/thumb/Purple91/v4/cf/42/0a/cf420a48-41f3-8914-2475-d26c0a3a1e43/source/{w}x{h}bb.{f}",1024,1024);C.style="roundedRect";const F=new A.Artwork("resource://test-branded-single-app.png",535,491),R=new A.PurchaseConfiguration("1094591345","Niantic, Inc.","Pok\xE9mon GO","com.nianticlabs.pokemongo",null),O=new A.Lockup;O.adamId="1094591345",O.title="Pok\xE9mon GO",O.subtitles=["Niantic, Inc."],O.clickAction=E,O.buttonAction=new A.OfferAction("GET","1117844680",R);const D=new A.OfferDisplayProperties("app",O.adamId);D.hasInAppPurchases=!0,O.offerDisplayProperties=D;const x=new A.TodayCard;x.heading="Inside the future of Pok\xE9mon",x.title="GAME\nOF THE\nDAY",x.backgroundColor="49b6fe",x.style="dark",x.overlay=new A.TodayCardMarketingLockupOverlay(O,"This is one of the best games ive ever seen. You wont believe what Pikachu does next"),x.media=new A.TodayCardMediaBrandedSingleApp(C,F),x.clickAction=w;const L=new A.Lockup;L.adamId="1094591345",L.icon=C,L.title="Pok\xE9mon GO",L.subtitles=["Niantic, Inc."],L.buttonAction=new A.OfferAction("GET","1117844680",R);const M=new A.OfferDisplayProperties("app",L.adamId);M.hasInAppPurchases=!0,L.offerDisplayProperties=M,L.clickAction=E;const N=new A.TodayCard;N.heading="THE LIST",N.title="Top kids games\nfor traveling.",N.style="white",N.media=new A.TodayCardMediaList(y(10,ue=>{const me=T.shallowCopyOf(L);return me.ordinal=I.decimal(ue+1),me})),N.clickAction=w;const U=h(L,4);U.clickAction=w;const B=h(L,3);B.clickAction=w;const V=h(L,2);V.clickAction=w;const z=new A.TodayCard;z.heading="COLLECTION",z.title="Start the day right",z.style="white",z.media=new A.TodayCardMediaRiver(y(10,ue=>{const me=T.shallowCopyOf(L);return me.ordinal=I.decimal(ue+1),me}));const j=new A.TodayCard;j.heading="Inside the future of Pok\xE9mon",j.title="GAME\nOF THE\nDAY",j.style="dark",j.overlay=new A.TodayCardMarketingLockupOverlay(O,null),j.media=new A.TodayCardMediaBrandedSingleApp(C,null),j.backgroundColor=A.TodayCardMediaBrandedSingleApp.noArtBackgroundColor,j.clickAction=w;const H=P(w),q=new A.TodayCard;q.heading="Context",q.title="A context card with text",q.overlay=new A.TodayCardParagraphOverlay(new A.Paragraph("Isn't this wonderful text at the bottom of this card?")),q.media=new A.TodayCardMediaArtwork(F),q.clickAction=w;const G=new A.TodayCard;G.heading="Context",G.title="A context card with apps",G.overlay=new A.TodayCardParagraphOverlay(new A.Paragraph("Isn't this wonderful text at the bottom of this card?")),G.media=new A.TodayCardMediaArtwork(F),G.clickAction=w;const W=new A.TodayCard;W.heading="Single App",W.title="Single App Card with Background Image",W.overlay=new A.TodayCardLockupOverlay(O),W.media=new A.TodayCardMediaArtwork(F),W.clickAction=w;const Y=new A.TodayCard;Y.heading="Single App",Y.title="Single App Card with Icon",Y.overlay=new A.TodayCardLockupOverlay(O),Y.media=new A.TodayCardMediaAppIcon(C),Y.clickAction=w;const K=new A.TodayCard;K.heading="Grid",K.title="Mixed Grid App Card",K.media=new A.TodayCardMediaGrid(y(1,ue=>{const me=T.shallowCopyOf(L);return me.ordinal=I.decimal(ue+1),me}),"mixed"),K.clickAction=w;const Q=new A.TodayCard;Q.heading="Grid",Q.title="Large Grid App Card",Q.media=new A.TodayCardMediaGrid(y(1,ue=>{const me=T.shallowCopyOf(L);return me.ordinal=I.decimal(ue+1),me}),"large"),Q.clickAction=w;const J=new A.TodayCard;J.heading="Grid",J.title="Small Grid App Card",J.media=new A.TodayCardMediaGrid(y(1,ue=>{const me=T.shallowCopyOf(L);return me.ordinal=I.decimal(ue+1),me}),"small"),J.clickAction=w;const X=new A.TodayCard;X.heading="Video",X.title="Alto's Adventure";const Z=new A.Artwork("http://is5.mzstatic.com/image/thumb/Video111/v4/62/7b/3e/627b3e14-0580-8ad0-05aa-902f24f89d05/source/{w}x{h}bb.{f}",1200,900);X.media=new A.TodayCardMediaVideo(new A.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo122/v4/42/aa/44/42aa44d4-8a92-2380-7c8a-3ca2f496acb1/P40205198_default.m3u8",Z),"In this gorgeous twist on the infinite runner, you guide an agile snowboarder down a never-ending mountain."),X.clickAction=w;const $=new A.TodayCard;$.heading="Video",$.title="Alto's Adventure";const ee=new A.Artwork("http://is5.mzstatic.com/image/thumb/Video111/v4/62/7b/3e/627b3e14-0580-8ad0-05aa-902f24f89d05/source/{w}x{h}bb.{f}",1200,900);$.media=new A.TodayCardMediaVideo(new A.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo122/v4/42/aa/44/42aa44d4-8a92-2380-7c8a-3ca2f496acb1/P40205198_default.m3u8",ee)),$.clickAction=w;const te=new A.TodayCard;te.heading="The Original",te.title="Monument Valley";const ae=new A.Artwork("http://is3.mzstatic.com/image/thumb/Video5/v4/07/1b/39/071b39bc-f623-48a3-16e1-e3b6da9a0f8b/source/{w}x{h}bb.{f}",900,1200);te.media=new A.TodayCardMediaVideo(new A.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo1/v4/5d/03/ee/5d03ee9d-8340-3860-d0e1-f68822327291/P35897610_default.m3u8",ae)),te.clickAction=w;const ie=new A.TodayCard;ie.heading="SNEAK PEEK",ie.title="Monument Valley Going to Two";const oe=new A.Artwork("http://is3.mzstatic.com/image/thumb/Video117/v4/42/3e/86/423e86f2-904f-8d63-2e72-ee46b3c6a637/source/{w}x{h}bb.{f}",1080,1920);ie.media=new A.TodayCardMediaVideo(new A.Video("http://apptrailers.itunes.apple.com/apple-assets-us-std-000001/PurpleVideo117/v4/2f/c8/3d/2fc83d6b-8e24-c0c6-461d-652487df9f6d/P47278586_default.m3u8",oe),"We couldn\u2019t wait to go back to the land of twisty towers and uncanny beauty\u2014and this sequel didn\u2019t let us down."),ie.clickAction=w;const ne=new A.TodayCard;ne.heading="LINK",ne.title="Introducing Apple Watch Series 2";const se=new A.Artwork("resource://test-external-link-watch.png",535,491);ne.media=new A.TodayCardMediaArtwork(se);const le=new A.ExternalUrlAction("https://www.apple.com/apple-watch-series-2/");le.title="apple.com",ne.clickAction=le,ne.overlay=new A.TodayCardActionOverlay(le);const de=new A.Shelf("todayCard");de.items=[U,U,B,B,V,V,j,j,x,x,ie,te,X,$,N,N,z,z,H,H,q,q,G,G,W,W,Y,Y,K,K,Q,Q,J,J,ne,ne];const pe=new A.TodayPage([de]);return pe.title="TODAY TEST",pe}},{"../../models":121,"../../util/localization":145,"../../util/objects":146,"../lockups":76,"./article-test-page":89}],96:[function(s,l,d){"use strict";function g(J){switch(J.media.kind){case"brandedSingleApp":return J.title.replace(/\n/g," ");default:const X=K.string("TODAY_BRICK_STANDARD_DESCRIPTION"),Z=J.heading,$=J.title;return X&&Z&&$?X.replace("{heading}",Z).replace("{title}",$):null;}}function P(J,X){return q.catchingContext("todayCardFromPlatformData",()=>{const Z=U.asString(J,"displayStyle");return"Branded"===Z?k(J,X):"Content"===Z?A(J,X):"Media"===Z?y(J,X):(console.log(`Unknown style: ${Z}`),null)})}function y(J,X){return q.context("mediaCard",()=>{const Z=w(J,X);let $=null;const ee=U.traverse(J,"editorialVideo.storeFrontVideo4x3"),te=U.traverse(J,"editorialVideo.storeFrontVideo");if($="pad"===W.deviceType?ee||te:te||ee,!$){const de=I(J,Z,"editorialArtwork.mediaCard",X.prevailingCropCode);return T(J,de,[]),de}const ae=U.traverse($,"previewFrame"),ie=j.artworkFromApiArtwork(ae);if(!ie)return I(J,Z,"editorialArtwork.mediaCard",X.prevailingCropCode);const oe=U.asString($,"video");if(!oe)return I(J,Z,"editorialArtwork.mediaCard",X.prevailingCropCode);const ne=C(J,"short"),se=new V.Video(oe,ie),le=U.asString(J,"id");return H.addMetricsEventsToVideo(se,{pageInformation:X.metricsPageInformation,locationTracker:X.metricsLocationTracker,id:le}),Z.style="white",Z.media=new V.TodayCardMediaVideo(se,ne),Z})}function A(J,X){return q.context("contentCard",()=>{const Z=w(J,X);_(J,Z,X);try{let $=null;const ee=x(J),te=D(J);if(1===te.length){const ae=U.traverse(ee,te[0]),ie=U.asString(ae,"kind");"softwareAddOn"===ie&&($=ae,N(ee,$))}if($){const ae=z.inAppPurchaseLockupFromPlatformData($,{offerStyle:"colored",metricsOptions:{pageInformation:X.metricsPageInformation,locationTracker:X.metricsLocationTracker}});return ae?(ae.theme="dark",Z.media=new V.TodayCardInAppPurchase(ae),Z.media.impressionFields=ae.impressionFields,Z.media.impressionQueues=ae.impressionQueues,Z.media.impressionFields.parentId=Z.impressionFields.id,Z.backgroundColor="F1F4F6",Z):null}const ae=I(J,Z,"editorialArtwork.generalCard",X.prevailingCropCode);if(ae){const ie=U.asString(J,"displayStyle"),oe=O(ae.style,ie),ne=L(J,X,!0,oe);if(T(J,ae,ne),null!==Z.overlay&&Z.overlay instanceof V.TodayCardParagraphOverlay){const se=Z.overlay;se.style="white"}return Z}if(te&&1===te.length){const ie=L(J,X,!0);if(1!==ie.length)return null;const oe=ie[0];return Z.media=new V.TodayCardMediaAppIcon(oe.icon),T(J,Z,ie),null!==Z.overlay&&Z.overlay instanceof V.TodayCardLockupOverlay&&(Z.overlay.displaysIcon=!1),Z}const ie=te.filter(ne=>{const se=ee[ne],le=U.asBooleanOrFalse(se,"isHiddenFromSpringboard"),de=U.asBooleanOrFalse(se,"hasMessagesExtension");return!de||!le});let oe=U.asString(J,"displaySubStyle");switch(oe&&X.coercedGeneralCardSubType&&(oe=X.coercedGeneralCardSubType),oe){case"List":case"NumberedList":{const ne=L(J,X,!1);if(4>ne.length)return E(J,ne,Z),Z;if("NumberedList"===oe){let se=1;for(const le of ne)le.ordinal=`${se}`,se++}return Z.style="white",Z.media=new V.TodayCardMediaList(ne,null),Z}case"River":{const ne=M(ie,ee,X,!0);return 0===ne.length?null:G.enabled("newAppOfTheDayStyle")&&5>ne.length?(E(J,ne,Z),Z):(Z.style="white",Z.media=new V.TodayCardMediaRiver(ne),Z)}case"Grid":{const ne=M(ie,ee,X,!0);if(0===ne.length)return null;if(G.enabled("newAppOfTheDayStyle")&&5>=ne.length)return E(J,ne,Z),Z;const se=0!=ne.length%2;9>=ne.length&&se&&ne.pop(),Z.style="white";let le;const de=ne.length;return le=13>=de?"large":25>=de?"mixed":"small",Z.media=new V.TodayCardMediaGrid(ne,le),Z}default:return null;}}finally{H.popLocation(X.metricsLocationTracker)}})}function T(J,X,Z){if(X){const $=C(J,"short"),ee=U.asBooleanOrFalse(J,"ignoreITunesShortNotes");if($&&!ee)X.overlay=new V.TodayCardParagraphOverlay(new V.Paragraph($));else if(Z&&0!==Z.length)if(1===Z.length)X.overlay=new V.TodayCardLockupOverlay(Z[0]);else{const te=new V.TodayCardLockupListOverlay(Z);te.displaysTitle=!1,X.overlay=te}}}function I(J,X,Z,$){return q.context("cardWithArtwork",()=>{const ee=U.asBooleanOrFalse(J,"ignoreEditorialArt");if(ee)return null;const te=F(J,Z,$);if(te)X.media=new V.TodayCardMediaArtwork(te),X.style=R(te);else return null;return X.clickAction instanceof V.ExternalUrlAction&&(X.overlay=new V.TodayCardActionOverlay(X.clickAction),X.style="white"),X})}function k(J,X){return q.context("brandedCard",()=>{const Z=w(J,X);_(J,Z,X);const $=F(J,"editorialArtwork.dayCard",X.prevailingCropCode);$?Z.style=R($):(Z.backgroundColor=V.TodayCardMediaBrandedSingleApp.noArtBackgroundColor,Z.style="dark");const ee=U.asString(J,"displayStyle"),te=O(Z.style,ee),ae=L(J,X,!0,te);if(!ae||1!==ae.length)return null;const ie=ae[0],oe=U.asString(J,"displaySubStyle");switch(oe){case"AppOfDay":case"GameOfDay":{Z.overlay=new V.TodayCardLockupOverlay(ie);break}default:{const de=new V.TodayCardLockupOverlay(ie);de.displaysIcon=!1,Z.overlay=de;break}}Z.title=U.asString(J,"label"),Z.media=new V.TodayCardMediaBrandedSingleApp(ie.icon,$);const ne=U.asArrayOrEmpty(J,"cardIds"),se=ne[0],le=H.impressionOptionsForLockup(J,ie,{pageInformation:X.metricsPageInformation,locationTracker:X.metricsLocationTracker});return H.addImpressionFields(Z.media,le),H.popLocation(X.metricsLocationTracker),Z})}function _(J,X,Z){H.pushContentLocation({pageInformation:Z.metricsPageInformation,locationTracker:Z.metricsLocationTracker,targetType:"todayCard",idType:"its_id",id:U.asString(J,"id","coercible")},X.title)}function w(J,X){return q.context("basicCard",()=>{const Z=new V.TodayCard,$=U.asString(J,"label"),ee=U.asString(J,"displayStyle"),te=U.asString(J,"displaySubStyle");Z.heading=$;let ae=C(J,"name");U.isNull(ae)&&"Branded"===U.asString(J,"displayStyle")&&(ae=U.asString(J,"label")),Z.title=ae;const ie=Y.isCardDataOnboardingCard(J),oe={cardType:ee,franchise:$};U.isNull(te)||(oe.cardSubType=te),ie&&(oe.isOnboardingCard=ie);const ne=H.impressionOptions(J,ae,{targetType:"todayCard",pageInformation:X.metricsPageInformation,locationTracker:X.metricsLocationTracker}),se=ne;return se.actionDetails=oe,Z.clickAction=z.editorialItemActionFromPlatformData(J,se),H.addImpressionsFieldsToCard(Z,ne,$,ee,ie,te),Z})}function E(J,X,Z){const $=C(J,"short"),ee=new V.TodayCardMediaMultiApp(X,$);Z.media=ee,Z.backgroundColor=V.TodayCardMediaMultiApp.multiAppBackgroundColor}function C(J,X){const Z=U.asString(J,`editorialNotes.${X}`);return Z?Z:U.asString(J,`itunesNotes.${X}`)}function F(J,X,Z){const $=U.traverse(J,X);if($){const ee=j.artworkFromApiArtwork($);return ee.crop=Z?Z:"sr",("debug"===W.buildType||"internal"===W.buildType)&&(ee.quality=50),ee}return null}function R(J){if(!J||!J.backgroundColor)return null;const X=B.Color.fromString(J.backgroundColor);return X.luminance<Q?"dark":"light"}function O(J,X){if(!G.enabled("lightForDarkBackdropOfferTheme"))return null;if("Branded"!==X)return null;return"dark"===J?"dark":null}function D(J){const X=U.asArrayOrEmpty(J,"cardIds");return X?X:[]}function x(J){return U.traverse(J,"relatedContent",{})}function L(J,X,Z,$){const ee=x(J),te=D(J);return M(te,ee,X,Z,$)}function M(J,X,Z,$,ee){if(!X||!J||0===J.length)return[];const te=J.filter(ae=>{const ie=X[ae];if(ie){const oe=U.asString(ie,"kind");return"softwareAddOn"!==oe}return!0});return z.lockupsFromPlatformData(X,te,{lockupOptions:{metricsOptions:{pageInformation:Z.metricsPageInformation,locationTracker:Z.metricsLocationTracker},offerEnvironment:ee},shouldIgnoreLocationIncrement:$})}function N(J,X){q.context("hoistRelatedContentIntoiAP",()=>{const Z=U.asString(X,"softwareAdamIds.0","coercible"),$={};$[Z]=J[Z],X.software=$})}Object.defineProperty(d,"__esModule",{value:!0});const U=s("../data/server-data"),B=s("../data/color"),V=s("../models"),z=s("./lockups"),j=s("./content"),H=s("../metrics/helpers"),q=s("../data/validation"),G=s("../util/properties"),W=s("../wrappers/client"),Y=s("./onboarding-cards"),K=s("../util/localization");d.inlineTodayCardsFromPlatformData=function(J,X,Z,$){return q.context("todayCardsFromPlatformData",()=>{if(!J)return null;const ee=[];for(const te of X){const ae=J[te];if(ae){const ie=P(ae,Z);if(ie&&$(ie)){ie.inlineDescription=g(ie);const oe=ie.media;oe&&"brandedSingleApp"===oe.kind&&(G.enabled("useFeaturedInBrandedArt")?ie.title=null:oe.art=null),ee.push(ie)}}}return ee.length?new V.InlineTodayCards(ee):null})},d.todayCardFromPlatformData=P,d.isVideoCard=function(J){const X=U.asString(J,"displayStyle");if("Media"===X){let Z=null;const $=U.traverse(J,"editorialVideo.storeFrontVideo4x3"),ee=U.traverse(J,"editorialVideo.storeFrontVideo");if(Z="pad"===W.deviceType?$||ee:ee||$,Z){const te=U.asString(Z,"video");if(te)return!0}}return!1},d.itunesNotes=C;const Q=0.84;d.hoistRelatedContentIntoiAP=N},{"../data/color":98,"../data/server-data":101,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"../util/properties":147,"../wrappers/client":152,"./content":72,"./lockups":76,"./onboarding-cards":80}],97:[function(s,l,d){"use strict";function g(B){return E.context("parsingDataFromApiResponse",()=>{const V=w.traverse(B,"pageData.segmentedControl"),z=w.asString(V,"selectedIndex","coercible");if(w.isNull(z))throw new Error("Missing selectedIndex on top charts response");const j=w.traverse(V,["segments",z,"pageData"]);if(w.isNull(j))throw new Error("Missing page data on top charts response");const H=w.traverse(V,["segments",z]),q=R.metricsPageInformationFromResponse(H);q.timingMetrics=B[R.timingValues],q.pageUrl=B[R.requestedUrl];const G=w.traverse(B,["storePlatformData",M,"results"],{}),W=w.traverse(B,"storePlatformData.artwork.results",{});return{pageData:j,platformData:G,artworkData:W,metricsPageInformation:q}})}function h(B,V,z,j){return E.context("lockupFromApiChartItem",()=>{return F.lockupFromPlatformData(V,{ordinal:O.decimal(B+1),maxSubtitleCount:1,metricsOptions:{pageInformation:z,locationTracker:j}})})}function P(B,V){return E.context("segmentFromResponse",()=>{const z=R.newLocationTracker(),j=[],H=[];let q=0;for(const J of w.asArrayOrEmpty(B,"adamIds")){const X=V.platformData[J];if(!X){H.push(J);continue}D.shouldFilter(X)||(j.push(h(q,X,V.metricsPageInformation,z)),R.nextPosition(z),q++)}const G=[];if(0<j.length){const J=new C.Shelf("smallLockup");J.items=j,G.push(J)}const W=w.asString(B,"shortTitle"),Y=w.asString(B,"title"),K=new C.TopChartSegment(W,Y,G),Q=_.createPageToken(H);return Q.profile=M,Q.highestOrdinal=j.length,Q.metricsPageInformation=V.metricsPageInformation,Q.metricsLocationTracker=z,K.nextPage=Q,R.copyMetricsEventsIntoPageWithInformation(K,V.metricsPageInformation),K})}function S(B,V){return E.context("categoryFromResponse",()=>{const z=w.asString(V,"chartUrl");if(!z)return null;const j=new L.URL(z),H=j.query[N],q=w.asString(V,"genreId","coercible"),G=[];if(!q)for(const X of w.asArrayOrEmpty(V,"children")){const Z=S(B,X);Z&&G.push(Z)}const W=w.asString(V,"contentId"),Y=w.traverse(B.artworkData,[W,"artwork"]),K=x.artworkFromApiArtwork(Y),Q=w.asString(V,"shortName"),J=w.asString(V,"name");return new C.TopChartCategory(q,H,z,Q,J,K,G)})}function y(B,V,z){return E.context("categoriesFromParsingData",()=>{const j=w.traverse(B.pageData,"categoryList");if(!j)return{categories:null,selectedCategoryTitle:""};let H=w.asString(j,"parentCategoryLabel");const q=[],G=S(B,j);G&&(G.shortName=H,G.longName=H,q.push(G));for(const Y of w.asArrayOrEmpty(j,"children")){const K=S(B,Y);K&&q.push(K)}const W=A(V,z,q);return W&&(H=W),{categories:q,selectedCategoryTitle:H}})}function A(B,V,z){for(const j of z){if(V&&j.ageBandId===V||!V&&j.genreId===B)return j.shortName;const H=A(B,V,j.children);if(H)return H}return null}Object.defineProperty(d,"__esModule",{value:!0});const _=s("./pagination"),w=s("../data/server-data"),E=s("../data/validation"),C=s("../models"),F=s("./lockups"),R=s("../metrics/helpers"),O=s("../util/localization"),D=s("./filtering"),x=s("./content"),L=s("../data/urls"),M="lockup",N="ageBandId",U=new Set(["46"]);d.emptySegment=function(){return new C.TopChartSegment(null,null,[])},d.topChartsPageFromApiResponse=function(B){return E.context("topChartsPageFromApiResponse",()=>{const V=g(B),z=w.asString(V.pageData,"selectedChart.id");let j=null;const H=w.asString(V.pageData,"selectedChart.seeAllUrl");if(H){const X=new L.URL(H);j=X.query[N]}const q=w.asArrayOrEmpty(V.pageData,"topCharts");let G=0;const W=q.filter(X=>!U.has(X.id)).map((X,Z)=>{const $=w.asString(X,"id");return $===z&&(G=Z),P(X,V)}),Y=w.asString(V.pageData,"genre.id"),K=w.asString(V.pageData,"pageTitle"),Q=y(V,Y,j),J=new C.TopChartsPage(Y,j,K,W,Q.selectedCategoryTitle,Q.categories);return J.initialSegmentIndex=G,J})},d.topChartSegmentFromLookupResponse=function(B,V,z){return E.context("topChartSegmentFromLookupResponse",()=>{const j=[];let H=V.highestOrdinal;for(const W of V.ids){const Y=B[W];if(!Y){console.warn(`no data found for ${W}, skipping`);continue}D.shouldFilter(Y)||(j.push(h(H,Y,V.metricsPageInformation,V.metricsLocationTracker)),R.nextPosition(V.metricsLocationTracker),H++)}const q=[];if(0<j.length){const W=new C.Shelf("smallLockup");W.items=j,q.push(W),z.highestOrdinal+=j.length}const G=new C.TopChartSegment(null,null,q);return G.nextPage=z,G})}},{"../data/server-data":101,"../data/urls":103,"../data/validation":104,"../metrics/helpers":108,"../models":121,"../util/localization":145,"./content":72,"./filtering":74,"./lockups":76,"./pagination":81}],98:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});class g{constructor(h,P,S){this.red=h,this.green=P,this.blue=S}get luminance(){return 0.2126*this.red+0.7152*this.green+0.0722*this.blue}static fromString(h){if(!h)return null;const P=g.HEX_PARSER.exec(h);if(null===P||4!==P.length)return null;const S=parseInt(P[1],16)/255,y=parseInt(P[2],16)/255,A=parseInt(P[3],16)/255;return new g(S,y,A)}}g.HEX_PARSER=/#?([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])/,d.Color=g},{}],99:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});class g{static get contentType(){return"application/x-www-form-urlencoded"}constructor(){this._params=""}param(h,P){if(h&&P){const S=0<this._params.length?"&":"";this._params+=`${S}${encodeURIComponent(h)}=${encodeURIComponent(P)}`}return this}build(){return this._params}}d.FormBuilder=g},{}],100:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("../data/server-data"),P=s("../models");d.closestArtworkMatchingSize=function(S,y,A){const T=y/A;let I=0,k=null;for(const _ of S){const w=h.asNumber(_,"width"),E=h.asNumber(_,"height"),C=w/E;(C==T||Math.abs(T-C)<=Math.abs(T-I))&&(!k||w<=y&&w>k.width||k.width>y&&w<k.width&&w>k.width)&&(k=_,I=C)}if(k){const _=h.asString(k,"url"),w=h.asNumber(k,"width"),E=h.asNumber(k,"height"),C=h.asString(k,"checksum");return new P.Artwork(_,w,E,null,C)}return null}},{"../data/server-data":101,"../models":121}],101:[function(s,l,d){"use strict";function g(_){return P(_)?null:Array.isArray(_)?_.join("."):_}function h(_,w,E){if(P(_))return E;if(!w)return _;const C=Array.isArray(w)?w:w.split(".");let F=_;for(const R of C)if(F=F[R],P(F))return E;return F}function P(_){return null===_||_===void 0}Object.defineProperty(d,"__esModule",{value:!0});const k=s("./validation");d.objectPathToString=g,d.traverse=h,d.isNull=P,d.asArrayOrEmpty=function(_,w){const E=h(_,w,null);return Array.isArray(E)?E:(P(E)||k.context("asArrayOrEmpty",()=>{k.unexpectedType("defaultValue","array",E,g(w))}),[])},d.asBooleanOrFalse=function(_,w){const E=h(_,w,null);return"boolean"==typeof E?E:(P(E)||k.context("asBooleanOrFalse",()=>{k.unexpectedType("defaultValue","boolean",E,g(w))}),!1)},d.asString=function(_,w,E="coercible"){const C=h(_,w,null);if(P(C)||"string"==typeof C)return C;const F="object"==typeof C?null:C+"";switch(E){case"strict":{k.context("asString",()=>{k.unexpectedType("coercedValue","string",C,g(w))});break}case"coercible":{P(F)&&k.context("asString",()=>{k.unexpectedType("coercedValue","string",C,g(w))});break}case"none":default:}return F},d.asNumber=function(_,w,E="coercible"){const C=h(_,w,null);if(P(C)||"number"==typeof C)return C;const F=+C;switch(E){case"strict":{k.context("asNumber",()=>{k.unexpectedType("coercedValue","number",C,g(w))});break}case"coercible":{if(isNaN(F))return k.context("asNumber",()=>{k.unexpectedType("coercedValue","number",C,g(w))}),null;break}case"none":default:}return F},d.asBoolean=function(_,w,E="coercible"){const C=h(_,w,null);if(P(C))return null;const F=typeof C;if("boolean"==F)return C;if("string"==F){if("true"===C)return!0;if("false"===C)return!1}const R=!!C;switch(E){case"strict":{k.context("asBoolean",()=>{k.unexpectedType("coercedValue","number",C,g(w))});break}case"coercible":{if(P(R))return k.context("asBoolean",()=>{k.unexpectedType("coercedValue","number",C,g(w))}),null;break}case"none":default:}return R}},{"./validation":104}],102:[function(s,l,d){"use strict";function g(T){return-1!==A.indexOf(T.protocol)}Object.defineProperty(d,"__esModule",{value:!0});const S=s("./urls"),y=s("../util/objects"),A=[S.Protocol.https,S.Protocol.itmsApps,S.Protocol.itmsAppss,S.Protocol.itmsMessages,S.Protocol.itmsMessagess,S.Protocol.itmsWatch,S.Protocol.itmsWatchs];d.normalizedAppStoreUrl=function(T){let I="string"==typeof T?new S.URL(T):T;if(!g(I))return I;const k=I.query,_=k.url,w=!I.host||0===I.host.length;return w&&void 0!==_&&null!==_&&(I=new S.URL(_),k.dsid&&(I=I.append("query",{dsid:k.dsid}))),S.URL.fromComponents(S.Protocol.https,I.host,I.pathname,I.query,I.hash)},d.normalizedActionUrl=function(T){const I="string"==typeof T?new S.URL(T):T;if(!g(I))return I;const k=I.build();let _=y.shallowCopyOf(I.query),w;const E={"finance-app.itunes.apple.com":"account",arcadeSubscribePage:"arcade"},C=[{key:"MZSearch.woa",action:"search"},{key:"search",action:"search"},{key:"freeProductCodeWizard",action:"redeem"},{key:"redeemLandingPage",action:"redeem"},{key:"showDialogForRedeem",action:"redeem"},{key:"buyLandingPage",action:"gift"},{key:"buyCharityGiftWizard",action:"donate"},{key:"checkForPreorders",action:"checkForPreorders"},{key:"MZFinance.woa",action:"account"},{key:"arcade",action:"arcade"},{key:"today",action:"today"},{key:"apps",action:"apps"},{key:"games",action:"games"},{key:"updates",action:"updates"},{key:"discover",action:"today"},{key:"create",action:"today"},{key:"work",action:"today"},{key:"play",action:"today"},{key:"develop",action:"today"},{key:"categories",action:"today"}],F={"accessory-lookup":"accessoryLookup",showDialogForRedeem:"redeem","finance-app":"account",viewEula:"eula",software:"apps",discover:"today",create:"today",work:"today",play:"today",develop:"today",categories:"today"};let R=!1;for(const D of Object.keys(E))if(I.host&&-1!==I.host.indexOf(D)){R=!0,w=E[D];break}let O=!1;for(const D of C){const x=D.key;if(I.pathname&&-1!==I.pathComponents().indexOf(x)){O=!0,w=D.action,void 0!==_[x]&&delete _[x];break}}for(const D of Object.keys(F)){const x=void 0!==I.query[D]&&null!==I.query[D],L=I.query.action&&-1!==I.query.action.indexOf(D);if(x||L){w=F[D],void 0!==_[D]&&delete _[D];break}}if("account"===w&&-1!==k.indexOf("getPass")&&(w="addToPassbook",delete _.getPass),w){const L={action:w};return"redeem"===w&&(_.code||_.certId)?L.code=_.code||_.certId:("account"===w||"checkForPreorders"===w)&&(O||R)&&(L.originalUrl=I.toString()),_=Object.assign({},_,L),S.URL.fromComponents(I.protocol,null,null,_,I.hash)}return I}},{"../util/objects":146,"./urls":103}],103:[function(s,l,d){"use strict";function g(A,T,I){const k=A.indexOf(T);let w=A,_;if(-1!==k){const E=A.slice(0,k),C=A.slice(k+T.length,A.length);"prefix"===I?(_=E,w=C):(_=C,w=E)}return{result:_,remainder:w}}Object.defineProperty(d,"__esModule",{value:!0}),d.Protocol={internal:"x-as3-internal",https:"https",itms:"itms",itmss:"itmss",itmsAppss:"itms-appss",itmsApps:"itms-apps",itmsMessagess:"itms-messagess",itmsMessages:"itms-messages",itmsWatchs:"itms-watchs",itmsWatch:"itms-watch",file:"file",resource:"resource"},d.Path={shelf:"shelf",store:"WebObjects/MZStore.woa/wa",storeElements:"WebObjects/MZStoreElements.woa/wa",lookup:"lookup",docTypeLookup:"docTypeLookup",install:"install",grouping:"viewGrouping",today:"viewToday",genre:"genre",recommendationsSeeAll:"recommendationsSeeAll",screenshots:"screenshots",room:"viewRoom",multiRoom:"viewMultiRoom",topCharts:"viewTop",product:"app",developer:"developer",artist:"artist",ratings:"ratings",reviews:"reviews",personalizedReviews:"personalizedReviews",personalizedReviewActions:"personalizedReviewActions",article:"article",story:"story",editorialItem:"editorialItem",viewEditorialItem:"viewEditorialItem",mso:"mso",resetAndRedirect:"resetAndRedirect",test:"test",builtIn:"builtIn",textAndImagesTest:"textAndImage",lockupsTest:"lockups",miscTest:"misc"},d.Parameters={id:"id",ids:"ids",countryCode:"cc",featuredContentId:"fcId",popId:"popId",genreId:"genreId",mediaType:"mt",bundleIdentifier:"bundleIdentifier",offerName:"offerName",action:"action"},d.InAppPurchaseInstallPageParameters={inAppPurchaseId:"inAppPurchaseId",bannerMessage:"inAppPurchaseInstallPageBannerMessage"},d.TodayPageParameters={onboardingCardIds:"onboardingCardIds"},d.ProductPageParameters={url:"productUrl",isSubscription:"isSubscription"},d.ReviewsPageParameters={adamId:"adamId",startIndex:"startIndex",endIndex:"endIndex",sort:"sort"},d.MSOPageParameters={availableAdamIds:"availableAdamIds"},d.ShelfParameters={title:"shelfTitle",shouldInferSeeAllFromFetchedItems:"shelfShouldInferSeeAllFromFetchedItems",contentType:"shelfContentType",offerTheme:"shelfOfferTheme",offerSubtitlePosition:"offerSubtitlePosition",metricsPageInformation:"metricsPage"},d.Hashes={reviews:"reviews"},d.AbsentValue="null";const h=/^([a-z][a-z0-9.+-]*:)(\/\/)?([\S\s]*)/i,P=/([^=?&]+)=?([^&]*)/g,S=["hash","query","pathname","host"];class y{constructor(A){if(this.query={},!!A){let T=A;const I=h.exec(A);if(I){let _=I[1];_&&(_=_.split(":")[0]),this.protocol=_,T=I[3]}let k={remainder:T,result:null};for(const _ of S){if(!k.remainder)break;switch(_){case"hash":{k=g(k.remainder,"#","suffix"),this.hash=k.result;break}case"query":{k=g(k.remainder,"?","suffix"),k.result&&(this.query=y.queryFromString(k.result));break}case"pathname":{k=g(k.remainder,"/","suffix"),k.result&&(this.pathname="/"+k.result);break}case"host":{if(k.remainder){const w=g(k.remainder,"@","prefix"),E=w.result,C=w.remainder;if(E){const F=E.split(":");this.username=decodeURIComponent(F[0]),this.password=decodeURIComponent(F[1])}if(C){const F=C.split(":");this.host=F[0],this.port=F[1]}}break}default:throw new Error("Unhandled case!");}}}}set(A,T){return T?("query"===A&&"string"==typeof T&&(T=y.queryFromString(T)),this[A]=T,this):this}append(A,T){const I=this[A];let k;if("query"===A)"string"==typeof T&&(T=y.queryFromString(T)),k=Object.assign({},I,T);else{let _=I;_||(_="");let w=_;if("pathname"===A){const E=_.length;E&&"/"===I[E-1]||(w+="/")}w+=T,k=w}return this.set(A,k)}param(A,T){return A?(this.query||(this.query={}),this.query[A]=T,this):this}removeParam(A){return A&&this.query?(void 0!==this.query[A]&&delete this.query[A],this):this}path(A){return this.append("pathname",A)}pathComponents(){return this.pathname?this.pathname.split("/").filter(A=>0<A.length):[]}build(){return this.toString()}toString(){let A="";return this.protocol&&(A+=this.protocol+"://"),this.username&&(A+=encodeURIComponent(this.username),this.password&&(A+=":"+encodeURIComponent(this.password)),A+="@"),this.host&&(A+=this.host,this.port&&(A+=":"+this.port)),this.pathname&&(A+=this.pathname),this.query&&Object.keys(this.query).length&&(A+="?"+y.toQueryString(this.query)),this.hash&&(A+="#"+this.hash),A}static queryFromString(A){const T={};for(let I;I=P.exec(A);){const k=decodeURIComponent(I[1]),_=decodeURIComponent(I[2]);T[k]=_}return T}static toQueryString(A){let T="",I=!0;for(const k of Object.keys(A)){I||(T+="&"),I=!1,T+=encodeURIComponent(k);const _=A[k];_&&_.length&&(T+="="+encodeURIComponent(_))}return T}static from(A){return new y(A)}static fromComponents(A,T,I,k,_){const w=new y;return w.protocol=A,w.host=T,w.pathname=I,w.query=k,w.hash=_,w}copy(){const A=new y;return A.protocol=this.protocol,A.username=this.username,A.password=this.password,A.host=this.host,A.port=this.port,A.pathname=this.pathname,A.query=this.query,A.hash=this.hash,A}}d.URL=y},{}],104:[function(s,l,d){"use strict";function h(F){return F&&F.incidents!==void 0}function P(F){C.nameStack.push(F)}function S(){return 0===C.nameStack.length?["<empty stack>"]:C.nameStack.slice(0)}function y(){0===C.nameStack.length&&console.warn("endContext() called without active validation context, ignoring"),C.nameStack.pop()}function T(F,R,O){let D=null;O&&(D=F,C.suppressedIncidentPaths.push(O));let x=null;try{P(F),x=R()}catch(L){throw L.hasThrown||(E("defaultValue","no exception",L.message),L.hasThrown=!0),L}finally{F===D&&C.suppressedIncidentPaths.pop(),y()}return x}function k(F){-1!==C.suppressedIncidentPaths.indexOf(F.objectPath)||C.incidents.push(F)}function w(F){return Array.isArray(F)?"array":null===F?"null":typeof F}function E(F,R,O,D){const x=w(O),L=D?D:"<this>";k({type:"badType",expected:R,actual:`${x} (${O})`,objectPath:L,contextNames:S(),recoveryAction:F})}Object.defineProperty(d,"__esModule",{value:!0}),d.messageForRecoveryAction=function(F){return"coercedValue"===F?"Coerced format":"defaultValue"===F?"Default value used":"ignoredValue"===F?"Ignored value":"Unknown"};const C={nameStack:[],incidents:[],suppressedIncidentPaths:[]};d.beginContext=P,d.getContextNames=S,d.endContext=y,d.recordValidationIncidents=function(F){h(F)&&(F.incidents=C.incidents),C.incidents=[],C.nameStack=[],C.suppressedIncidentPaths=[]},d.context=T,d.catchingContext=function(F,R,O){let D=null;try{D=T(F,R)}catch(x){D=null,O&&(D=O(x))}return D},d.unexpectedNull=function(F,R,O){const D=O?O:"<this>";k({type:"nullValue",expected:R,actual:"null",objectPath:D,contextNames:S(),recoveryAction:F})},d.extendedTypeof=w,d.unexpectedType=E},{}],105:[function(s,l,d){"use strict";function h(I,k,_,w="mt"){if(T.isNull(I))return _;const E=T.asString(k,I);if(T.isNull(E))return _;let C=I;return w&&(C="mt"+I.charAt(0).toUpperCase()+I.slice(1)),_+="&"+C+"="+encodeURIComponent(E),_}Object.defineProperty(d,"__esModule",{value:!0});const P=s("../index"),S=s("./misc"),y=s("@amp-metrics/mt-metricskit"),A=s("./util"),T=s("../../data/server-data");d.addMetricsToBuyParams=function(I,k,_,w){let E=I;const C=S.fieldsFromPageInformation(k),F=A.emptyStringIfNullOrUndefined(T.asString(C,"pageId")),R=A.emptyStringIfNullOrUndefined(T.asString(C,"pageType")),O=A.emptyStringIfNullOrUndefined(T.asString(w,"pageContext"));if(E+="&"+y.eventHandlers.buyConfirmed.metricsBuyParamsString(F,R,O,P.METRICS_TOPIC),!w)return E;if(!_){const D=T.asString(w,"extRefUrl2"),x=A.extractSiriRefAppFromRefUrl(D);D&&x&&(w.refApp=x),E=h("extRefApp2",w,E,null),E=h("extRefUrl2",w,E,null);const L=A.searchTermFromRefUrl(T.asString(w,"refUrl"));E=T.isNull(L)?h("searchTerm",k,E):h("searchTerm",{searchTerm:L},E)}return E}},{"../../data/server-data":101,"../index":115,"./misc":111,"./util":114,"@amp-metrics/mt-metricskit":1}],106:[function(s,l,d){"use strict";function S(x,L,M,N){const U={};L&&(Object.assign(U,_.fieldsFromPageInformation(L)),N&&L.iAdInfo&&L.iAdInfo.iAdAdamId===x.adamId&&Object.assign(U,L.iAdInfo.clickFields)),U.actionType="buy",U.actionDetails={buyParams:x.purchaseConfiguration.buyParams},U.location=M,U.targetId=x.adamId;const B=C.isPreorderFromOfferAction(x);B&&(U.offerType="preorder",!O.isNull(x.expectedReleaseDate)&&(U.offerReleaseDate=F.millisecondsToUTCMidnightFromLocalDate(x.expectedReleaseDate)));const V=new R.MetricsClickEvent(x.adamId,"button",U);x.metricsEvents=[V]}function y(x,L,M=!1){let N=L.actionType;N||(N="navigate");const U={actionType:N};if(x instanceof R.FlowAction){U.actionUrl=x.pageUrl}else if(x instanceof R.ExternalUrlAction){U.actionUrl=x.url}L.actionDetails&&(U.actionDetails=L.actionDetails),L.actionContext&&(U.actionContext=L.actionContext),O.isNull(L.offerType)||(U.offerType=L.offerType),O.isNull(L.offerReleaseDate)||(U.offerReleaseDate=F.millisecondsToUTCMidnightFromLocalDate(L.offerReleaseDate)),U.location=E.createContentLocation(L,x.title),Object.assign(U,_.fieldsFromPageInformation(L.pageInformation)),L.isAdvert&&M&&L.pageInformation.iAdInfo&&Object.assign(U,L.pageInformation.iAdInfo.clickFields);const B=new R.MetricsClickEvent(L.id,w.targetTypeForMetricsOptions(L),w.sanitizedMetricsDictionary(U));x.metricsEvents=[B]}Object.defineProperty(d,"__esModule",{value:!0});const _=s("./misc"),w=s("./util"),E=s("./location"),C=s("../../builders/offers"),F=s("../../util/date-util"),R=s("../../models"),O=s("../../data/server-data"),D=s("../../data/validation");d.clickOptionsForLockup=function(x,L){return D.context("clickOptionsForLockup",()=>{const M=O.asString(x,"id","coercible"),N=Object.assign({},L,{id:M}),U=C.isPreorderFromPlatformData(x);return U&&(N.offerType="preorder"),N})},d.addBuyEventToOfferActionOnPage=function(x,L){const M=L.pageInformation,N=E.createContentLocation(L,x.title);S(x,M,N,L.isAdvert)},d.addBuyEventToOfferActionInheritingMetrics=function(x,L){const M=L.purchaseConfiguration.pageInformation;let N;for(const U of L.metricsEvents)if(N=U.eventFields.location,N)break;S(x,M,N,!1)},d.addClickEventToAction=y,d.addClickEventsToAdLockup=function(x,L){const M=new R.MetricsToroClickEvent(x.lineItem,x.impressionId,L.pageInformation.iAdInfo.iAdClickEventFields);if(x.clickAction){y(x.clickAction,L,!0);const N=x.clickAction.metricsEvents?x.clickAction.metricsEvents:[];N.push(M),x.clickAction.metricsEvents=N}if(x.buttonAction){const N=x.buttonAction.metricsEvents?x.buttonAction.metricsEvents:[];N.push(M),x.buttonAction.metricsEvents=N}if(x.transparencyAction){const N=L.pageInformation,U={actionType:"ad_transparency"};Object.assign(U,_.fieldsFromPageInformation(N)),N.iAdInfo&&Object.assign(U,N.iAdInfo.clickFields);const B=new R.MetricsClickEvent(x.adamId,"button",U),V=x.transparencyAction.metricsEvents?x.transparencyAction.metricsEvents:[];V.push(B),V.push(M),x.transparencyAction.metricsEvents=V}},d.addClickEventsToAdvertisingLockup=function(x,L){const M=new R.MetricsToroClickEvent(x.lineItem,x.impressionId,L.pageInformation.iAdInfo.iAdClickEventFields);if(x.clickAction){y(x.clickAction,L,!0);const N=x.clickAction.metricsEvents?x.clickAction.metricsEvents:[];N.push(M),x.clickAction.metricsEvents=N}if(x.buttonAction){const N=x.buttonAction.metricsEvents?x.buttonAction.metricsEvents:[];N.push(M),x.buttonAction.metricsEvents=N}if(x.transparencyAction){const N=L.pageInformation,U={actionType:"ad_transparency"};Object.assign(U,_.fieldsFromPageInformation(N)),N.iAdInfo&&Object.assign(U,N.iAdInfo.clickFields);const B=new R.MetricsClickEvent(x.adamId,"button",U),V=x.transparencyAction.metricsEvents?x.transparencyAction.metricsEvents:[];V.push(B),V.push(M),x.transparencyAction.metricsEvents=V}},d.addClickEventToSeeAllAction=function(x,L,M){const N=_.fieldsFromPageInformation(M.pageInformation);O.isNull(L)||(N.actionUrl=L),M.targetType||(M.targetType="button"),N.location=E.createBasicLocation(M,x.title),N.actionType="navigate",N.target="button_See All";const U=new R.MetricsClickEvent("See All","button",N);x.metricsEvents=[U]},d.addClickEventToInitiateSearch=function(x,L,M){const N=[];if("trending"===x.origin){const j="trending",H="button",q={actionType:j,actionUrl:w.emptyStringIfNullOrUndefined(x.url),location:E.createBasicLocation({pageInformation:null,locationTracker:M,targetType:H},x.term),page:"Search",pageDetails:"Apps",pageType:"Search",actionDetails:{term:L,actionType:j}},G=new R.MetricsClickEvent("",H,q);N.push(G)}let U="listItem",B="trending";const V={targetId:E.currentPosition(M)};switch(x.origin){case"trending":U="button",B="trending";break;case"hints":U="listItem",B="hint",V.actionDetails=L;break;default:}const z=new R.MetricsSearchEvent(x.term,U,B,x.url,V);N.push(z),x.metricsEvents=N}},{"../../builders/offers":79,"../../data/server-data":101,"../../data/validation":104,"../../models":121,"../../util/date-util":144,"./location":109,"./misc":111,"./util":114}],107:[function(s,l,d){"use strict";function g(R,O){const D={id:k.emptyStringIfNullOrUndefined(O.id),idType:k.idTypeForMetricsOptions(O),impressionType:k.targetTypeForMetricsOptions(O),kind:k.emptyStringIfNullOrUndefined(O.kind),name:k.emptyStringIfNullOrUndefined(R.title)};if(O&&O.recoMetricsData&&Object.assign(D,O.recoMetricsData),O&&O.locationTracker){const x=_.currentPosition(O.locationTracker);D.impressionIndex=x,""===D.id&&(console.log("impressionId missing. using location"),D.id=x.toString(),D.idType="sequential")}return C.isNull(O.offerType)||(D.offerType=O.offerType),""===D.id&&console.log(`impressionId missing. Tracking broken for ${D.name} of ${D.impressionType}`),D}function h(R,O){R&&(R.impressionFields=g(R,O),E.enabled("impressionsEventsDontNeedAQueue")&&delete R.impressionQueues)}function I(R,O,D){return F.context("impressionOptions",()=>{const x=C.asString(R,"kind"),L=C.asString(R,"id","coercible"),M=Object.assign({},D,{kind:x,title:O,id:L}),N=w.isPreorderFromPlatformData(R);return N&&(M.offerType="preorder"),M})}Object.defineProperty(d,"__esModule",{value:!0});const k=s("./util"),_=s("./location"),w=s("../../builders/offers"),E=s("../../util/properties"),C=s("../../data/server-data"),F=s("../../data/validation");d.addImpressionFields=h,d.addImpressionsFieldsToCard=function(R,O,D,x,L,M){if(R){const N=g(R,O);N.franchise=k.emptyStringIfNullOrUndefined(D),N.cardType=k.emptyStringIfNullOrUndefined(x),M&&(N.cardSubType=k.emptyStringIfNullOrUndefined(M)),L&&(N.isOnboardingCard=L),R.impressionFields=N,E.enabled("impressionsEventsDontNeedAQueue")&&delete R.impressionQueues}},d.addImpressionsFieldsToAdLockup=function(R,O,D){if(R&&D){h(R,O);const x=k.sanitizedMetricsDictionary(D.fastImpressionFields);Object.assign(R.impressionFields,x),E.enabled("impressionsEventsDontNeedAQueue")?(R.impressionFields.isInFastQueue=!0,delete R.impressionQueues):R.impressionFields.impressionQueues=["data-metrics","data-metrics-impressions-low-latency"],R.impressionFields.parentId="ad_container"}},d.addImpressionsFieldsToAdvertisingLockup=function(R,O,D){if(R&&D){h(R,O);const x=k.sanitizedMetricsDictionary(D.fastImpressionFields);Object.assign(R.impressionFields,x),E.enabled("impressionsEventsDontNeedAQueue")?(R.impressionFields.isInFastQueue=!0,delete R.impressionQueues):R.impressionFields.impressionQueues=["data-metrics","data-metrics-impressions-low-latency"],R.impressionFields.parentId="ad_container"}},d.addImpressionFieldsToInAppPurchaseLockup=function(R,O){R&&(!R.impressionFields&&h(R,O),R.parent&&R.parent.adamId&&(R.impressionFields.parentAdamId=k.emptyStringIfNullOrUndefined(R.parent.adamId)))},d.impressionOptionsForLockup=function(R,O,D){return I(R,O.title,D)},d.impressionOptions=I},{"../../builders/offers":79,"../../data/server-data":101,"../../data/validation":104,"../../util/properties":147,"./location":109,"./util":114}],108:[function(s,l,d){"use strict";function g(h){for(var P in h)d.hasOwnProperty(P)||(d[P]=h[P])}Object.defineProperty(d,"__esModule",{value:!0}),g(s("./clicks")),g(s("./impressions")),g(s("./location")),g(s("./page")),g(s("./buy")),g(s("./media")),g(s("./models")),g(s("./util"))},{"./buy":105,"./clicks":106,"./impressions":107,"./location":109,"./media":110,"./models":112,"./page":113,"./util":114}],109:[function(s,l,d){"use strict";function T(O){const D=E(O);return D?D.position:O.rootPosition}function k(O,D){const x=_(O,D);return x.idType=C.idTypeForMetricsOptions(O),x.id=C.emptyStringIfNullOrUndefined(O.id),O.fcKind&&(x.fcKind=O.fcKind),O.displayStyle&&(x.displayStyle=O.displayStyle),x}function _(O,D){const x={locationPosition:T(O.locationTracker),locationType:C.targetTypeForMetricsOptions(O),name:C.emptyStringIfNullOrUndefined(D)};return O.recoMetricsData&&Object.assign(x,O.recoMetricsData),x}function w(O){return O.locationStack.map(D=>{return D.location})}function E(O){const D=O.locationStack.length;return 0===D?null:O.locationStack[D-1]}Object.defineProperty(d,"__esModule",{value:!0});const C=s("./util"),F=s("../../data/validation");class R{constructor(){this.location=null,this.position=0}}d.newLocationTracker=function(){return{rootPosition:0,locationStack:[]}},d.createContentLocation=function(O,D){const x=w(O.locationTracker);return x.push(k(O,D)),x},d.createBasicLocation=function(O,D){const x=w(O.locationTracker);return x.push(_(O,D)),x},d.pushContentLocation=function(O,D){const x=new R;x.location=k(O,D),O.locationTracker.locationStack.push(x)},d.pushBasicLocation=function(O,D){const x=new R;x.location=_(O,D),O.locationTracker.locationStack.push(x)},d.popLocation=function(O){return 0===O.locationStack.length?void F.unexpectedType("ignoredValue","non-empty location stack",0):void O.locationStack.pop()},d.currentPosition=T,d.nextPosition=function(O){const D=E(O);D?D.position++:O.rootPosition++}},{"../../data/validation":104,"./util":114}],110:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("./misc"),P=s("./util"),S=s("./location"),y=s("../../models"),A=s("../../util/objects");d.addMetricsEventsToVideo=function(T,I){const k=h.fieldsFromPageInformation(I.pageInformation);k.id=P.emptyStringIfNullOrUndefined(I.id),k.idType=P.idTypeForMetricsOptions(I),k.type="video",k.typeDetails="iTunesStoreContent",k.location=S.createContentLocation(I,null),I.actionDetails&&(k.actionDetails=I.actionDetails),T.templateMediaEvent=new y.MetricsMediaEvent(k);const _=A.shallowCopyOf(k);_.actionUrl=T.videoUrl,T.templateClickEvent=new y.MetricsClickEvent(null,"button",_)}},{"../../models":121,"../../util/objects":146,"./location":109,"./misc":111,"./util":114}],111:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const h=s("./util");d.fieldsFromPageInformation=function(P){const S={};return P?(Object.assign(S,P.baseFields),P.pageUrl&&(S.pageUrl=P.pageUrl),h.sanitizedMetricsDictionary(S)):S}},{"./util":114}],112:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../index"),h=s("./util");d.timingValues=Symbol("metricsHelpers.timingValues"),d.requestedUrl=Symbol("metricsHelpers.requestedUrl"),d.iAdURLParameterStringToken="X-AppStore-iAdClickToken",d.iAdURLLineItemParameterStringToken="X-AppStore-iAdLineItem";class P{constructor(y,A){this.pageFields={},this.clickFields={},this.impressionsFields={},this.fastImpressionFields={},this.iAdClickEventFields={},this._iAdApplied=!1,this._iAdId=y,this._iAdAdamId=null,this.pageFields[g.HAS_IAD_DATA_KEY]=!0,this.pageFields.iAdAppStoreClientRequestId=A,this.pageFields.iAdId=h.emptyStringIfNullOrUndefined(y)}get iAdIsPresent(){return this._iAdApplied}get iAdAdamId(){return this._iAdAdamId}apply(y,A){if(this._iAdAdamId=y,A){this.impressionsFields[g.HAS_IAD_DATA_KEY]=!0,this.impressionsFields.iAdId=h.emptyStringIfNullOrUndefined(this._iAdId),this.fastImpressionFields.iAdImpressionId=h.emptyStringIfNullOrUndefined(A.impressionId),this.fastImpressionFields.iAdMetadata=h.emptyStringIfNullOrUndefined(A.metadata);const T={iAdFormat:h.sanitizedMetricsDictionary(A.format),iAdAlgoId:h.emptyStringIfNullOrUndefined(A.algoId),iAdImpressionId:h.emptyStringIfNullOrUndefined(A.impressionId),iAdMetadata:h.emptyStringIfNullOrUndefined(A.metadata)};this.pageFields.iAd=T,this.pageFields.adamId=y,this.clickFields[g.HAS_IAD_DATA_KEY]=!0,this.clickFields.iAdId=h.emptyStringIfNullOrUndefined(this._iAdId),this.clickFields.iAdImpressionId=h.emptyStringIfNullOrUndefined(A.impressionId),this.clickFields.iAdMetadata=h.emptyStringIfNullOrUndefined(A.metadata),Object.assign(this.iAdClickEventFields,A),this._iAdApplied=!0}}applyClickFieldsFromPageRequest(y,A){this._iAdApplied=!0,this._iAdAdamId=y,Object.assign(this.clickFields,A)}setSpecifiedCreativeUsed(y){this.fastImpressionFields.iAdIsSpecifiedCreativeUsed=y,this.clickFields.iAdIsSpecifiedCreativeUsed=y}}d.IAdSearchInformation=P;d.MetricsPageInformation=class{constructor(y={}){this.baseFields=y}}},{"../index":115,"./util":114}],113:[function(s,l,d){"use strict";function P(L,M,N){if(!D.isNull(M)){const U=I(M,N);U.push(y(M,N)),U.push(T(M,N)),L instanceof O.SearchResults||U.push(A(M,N)),L.metricsEvents=U}}function y(L,M){const N=k(L,M);L.iAdInfo&&Object.assign(N,L.iAdInfo.pageFields),D.isNull(L.offerReleaseDate)||(N.offerReleaseDate=R.millisecondsToUTCMidnightFromLocalDate(L.offerReleaseDate)),O.MetricsPageEvent.copyTimingMetricsInto(L.timingMetrics,N);const U=new O.MetricsPageEvent(N);return U}function A(L,M){const N=k(L,M),U=new O.MetricsBackClickEvent(N);return U}function T(L,M){const N=k(L,M);L.searchTerm&&(N.searchTerm=L.searchTerm),O.MetricsPageRenderEvent.copyTimingMetricsInto(L.timingMetrics,N);const U=new O.MetricsPageRenderEvent(N);return U}function I(L,M){const N=k(L,M);L.searchTerm&&(N.searchTerm=L.searchTerm);const U=x.shallowCopyOf(N);L.iAdInfo&&Object.assign(U,L.iAdInfo.impressionsFields);const B=new O.MetricsImpressionsEvent(U);let V=[B];if(L.iAdInfo){const z=x.shallowCopyOf(N);Object.assign(z,L.iAdInfo.impressionsFields);const j=new O.FastImpressionsEvent(U);V=[j,B]}return V}function k(L,M){const N=E.fieldsFromPageInformation(L);return D.isNull(N.pageUrl)&&!D.isNull(L.timingMetrics)&&(N.pageUrl=L.timingMetrics.pageURL),D.isNull(L.offerType)||(N.offerType=L.offerType),N&&M&&M(N),N}Object.defineProperty(d,"__esModule",{value:!0});const E=s("./misc"),C=s("./models"),F=s("./util"),R=s("../../util/date-util"),O=s("../../models"),D=s("../../data/server-data"),x=s("../../util/objects");d.metricsPageInformationFromResponse=function(L){const M=D.traverse(L,"pageData.metricsBase",{}),N=D.traverse(L,"pageData.metrics.fields");D.isNull(N)||Object.assign(M,N);const U=new C.MetricsPageInformation(F.sanitizedMetricsDictionary(M));U.timingMetrics=L[C.timingValues],U.pageUrl=L[C.requestedUrl];const B=L[C.iAdURLParameterStringToken];return B&&(U.iAdInfo=new C.IAdSearchInformation,U.iAdInfo.applyClickFieldsFromPageRequest(D.traverse(L,"pageData.id"),B)),U},d.fakeMetricsPageInformation=function(L,M,N){return new C.MetricsPageInformation({pageType:L,pageId:M,page:`${L}_${M}`,pageDetails:N})},d.copyMetricsEventsIntoPageWithInformation=P,d.copyMetricsEventsIntoSidepackedPagewithInformation=function(L,M){if(!D.isNull(M)){const N=[];N.push(A(M,null)),L.metricsEvents=N}},d.pageInformationForIAPPage=function(L,M){const N={pageId:F.emptyStringIfNullOrUndefined(M),pageType:"IAPInstallPage",parentId:F.emptyStringIfNullOrUndefined(L)},U=new C.MetricsPageInformation(N);return U},d.addPageEventsToInAppPurchasePage=function(L,M){P(L,M)}},{"../../data/server-data":101,"../../models":121,"../../util/date-util":144,"../../util/objects":146,"./misc":111,"./models":112,"./util":114}],114:[function(s,l,d){"use strict";function A(_){if(k.isNull(_))return null;if(_ instanceof Array){const w=[];for(const E of _){const C=A(E);k.isNull(C)||w.push(C)}return w}if(_ instanceof Object){const w={};return Object.keys(_).forEach(E=>{const R=_[E],O=A(R);k.isNull(O)||(w[E]=O)}),w}return _}Object.defineProperty(d,"__esModule",{value:!0});const I=s("../../data/urls"),k=s("../../data/server-data");d.targetTypeForMetricsOptions=function(_){let w=_.targetType;return w||(w="lockup"),w},d.idTypeForMetricsOptions=function(_){let w=_.idType;return w||(w="its_id"),w},d.emptyStringIfNullOrUndefined=function(_){return null===_||void 0===_?"":_},d.extractSiriRefAppFromRefUrl=function(_){if(!_)return null;const w=new I.URL(_);let E=null;for(const C of Object.keys(w.query))if("referrer"===C){"siri"===w.query[C]&&(E="com.apple.siri");break}return E},d.sanitizedMetricsDictionary=function(_){return A(_)},d.searchTermFromRefUrl=function(_){if(!_)return null;const w=new I.URL(_),E=w.query,C=E.term,F=w.pathname;if(k.isNull(C)||k.isNull(F))return null;if(!F.endsWith("/search"))return null;return C}},{"../../data/server-data":101,"../../data/urls":103}],115:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),function(P){for(var S in P)d.hasOwnProperty(S)||(d[S]=P[S])}(s("./posting"));const h=s("./helpers");d.helpers=h},{"./helpers":108,"./posting":116}],116:[function(s,l,d){"use strict";function g(O){const D=T.asString(O,"hostApp");return!T.isNull(D)&&w.has(D)}function h(O){if(T.asBoolean(O,"hasiAdData")){const D=T.asArrayOrEmpty(O,"impressions");if(1!==D.length)return!1;const x=D[0],L=T.asString(x,"impressionQueueTag");if("data-metrics-impressions-low-latency"!==L)return!1;const M=T.asString(x,"iAdImpressionId");return E.has(M)?(console.log("fastpipe impressions filtered for iAdImpressionId"+M),!0):(E.add(M),!1)}return!1}function P(O){if(!k.enabled("impressionsDoNotDuplicate")){const D=T.asArrayOrEmpty(O,"impressions");if(0!==D.length){const x={};for(const N of D){let U=T.asString(N,"id");const B=T.asString(N,"impressionIndex");B&&(U=`${U}${B}`);const V=T.asString(N,"name");V&&(U=`${U}${V}`);let z=x[U];z||(z=[],x[U]=z),z.push(N)}const L=Object.keys(x);if(D.length!==L.length){let M=[];for(const N of L){const U=x[N];if(1===U.length){M.push(U[0]);continue}const B=U.filter(V=>{const z=T.asString(V,"impressionParentId");return!!z});if(1<=B.length){const V=B[0];let z=T.asArrayOrEmpty(V,"impressionTimes");for(const j of U)T.isNull(T.asString(j,"impressionParentId"))&&(z=z.concat(T.asArrayOrEmpty(j,"impressionTimes")));V.impressionTimes=z,M=M.concat(B)}else if(1<U.length){const V=U[0];let z=T.asArrayOrEmpty(V,"impressionTimes");for(let j=1;j<U.length;++j){const H=U[j];z=z.concat(T.asArrayOrEmpty(H,"impressionTimes"))}V.impressionTimes=z,M.push(V)}}O.impressions=M}}}}Object.defineProperty(d,"__esModule",{value:!0});const S=s("@amp-metrics/mt-metricskit"),y=s("../wrappers/store-metrics"),A=s("../wrappers/bag"),T=s("../data/server-data"),I=s("./helpers/util"),k=s("../util/properties"),_={eventRecorder:{recordEvent(O,D){return D&&"search"!==D.eventType&&"submit"!==D.actionType&&(C=D),!D||S.config.metricsDisabledOrBlacklistedEvent(D.eventType)||g(D)?null:(S.config.removeBlacklistedFields(D),y.recordEvent(O,D),D)},sendMethod(){return"itms"}}},w=new Set([]);d.METRICS_TOPIC="xp_amp_appstore",d.HAS_IAD_DATA_KEY="hasiAdData";const E=new Set;let C={};const F={cookieString:"",appString:"",app(){return this.appString},appVersion(){return C.appVersion},capacityData(){return C.capacityData},capacityDataAvailable(){return C.capacityDataAvailable},capacityDisk(){return C.capacityDisk},capacitySystem(){return C.capacitySystem},capacitySystemAvailable(){return C.capacitySystemAvailable},connectionType(){return C.connection},cookie(){return null===this.cookieString||void 0===this.cookieString?"":this.cookieString},cookieOwnerObject(){const O=this.cookie().toString();return{cookie:O}},dsId(){return C.dsId},environmentBuild(){return C.environmentBuild},environmentDataCenter(){return null},environmentInstance(){return null},hostApp(){return C.hostApp},hostAppVersion(){return C.hostAppVersion},osLanguages(){return C.osLanguages},osVersion(){return C.osVersion},pageUrl(){return null},pixelRatio(){return C.pixelRatio},resourceRevNum(){const O=k.asString("version");return O},screenHeight(){return C.screenHeight},screenWidth(){return C.screenWidth},storeFrontHeader(){return C.storeFrontHeader},userAgent(){return C.userAgent},userType(){return C.userType},windowInnerHeight(){return C.windowInnerHeight},windowInnerWidth(){return C.windowInnerWidth},windowOuterHeight(){return C.windowOuterHeight},windowOuterWidth(){return C.windowOuterWidth}},R={sources(){return[A.default.metricsConfiguration]}};d.recorder={postEvent(O){F.cookieString=O.cookie,delete O.cookie,delete O.resourceRevNum,""===F.appString&&(F.appString=O.app);const D=O.eventType;return console.log(`metrics.recorder.postEvent(${D})`),"enter"===D?this.postEnterEvent(O):"exit"===D?this.postExitEvent(O):"click"===D?this.postClickEvent(O):"page"===D?this.postPageEvent(O):"search"===D?this.postSearchEvent(O):"impressions"===D?this.postImpressionsEvent(O):"media"===D?this.postMediaEvent(O):this.postGenericEvent(O)},flush(){y.flushUnrecordedEvents()},postEnterEvent(O){const D=S.eventHandlers.enter.metricsData(O.pageId,O.pageType,O.pageContext,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,D),D},postExitEvent(O){const D=S.eventHandlers.exit.metricsData(O.pageId,O.pageType,O.pageContext,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,D),y.flushUnrecordedEvents(),D},postClickEvent(O){P(O);const D=S.eventHandlers.click.metricsData(O.pageId,O.pageType,O.pageContext,O.target,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,D),O[d.HAS_IAD_DATA_KEY]&&y.flushUnrecordedEvents(),D},postPageEvent(O){const D=T.asString(O,"refUrl"),x=I.extractSiriRefAppFromRefUrl(D);D&&x&&(O.refApp=x);const L=I.searchTermFromRefUrl(D);L&&(O.searchTerm=L);const M=S.eventHandlers.page.metricsData(O.pageId,O.pageType,O.pageContext,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,M),M},postSearchEvent(O){const D=S.eventHandlers.search.metricsData(O.pageId,O.pageType,O.pageContext,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,D),D},postImpressionsEvent(O){if(null===O.impressions)return{};if(h(O))return{};P(O);const D=T.asString(O,"refUrl"),x=I.searchTermFromRefUrl(D);x&&(O.searchTerm=x),delete O.refUrl;const L=S.eventHandlers.impressions.metricsData(O.pageId,O.pageType,O.pageContext,O);return _.eventRecorder.recordEvent(d.METRICS_TOPIC,L),O[d.HAS_IAD_DATA_KEY]&&y.flushUnrecordedEvents(),L},postMediaEvent(O){const D=S.eventHandlers.media.metricsData(O.pageId,O.pageType,O.pageContext,O),x=D.position;return T.isNull(x)||(D.position=Math.round(x)),_.eventRecorder.recordEvent(d.METRICS_TOPIC,D),D},postGenericEvent(O){const D=O.topic||d.METRICS_TOPIC;return _.eventRecorder.recordEvent(D,O)}},S.init(d.METRICS_TOPIC,R.sources,_,null,null),S.system.environment.setDelegate(F)},{"../data/server-data":101,"../util/properties":147,"../wrappers/bag":150,"../wrappers/store-metrics":154,"./helpers/util":114,"@amp-metrics/mt-metricskit":1}],117:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.ImpressionableModel{constructor(L){super(),this.title=null,this.artwork=null,this.presentationStyle=[],this.actionClass=L}}d.Action=h;d.FlowAction=class extends h{constructor(L){super("FlowAction"),this.page=L,this.pageUrl=null,this.pageData=null,this.presentationContext="infer",this.animationBehavior="infer",this.origin="inapp"}};d.TabChangeAction=class extends h{constructor(L){super("TabChangeAction"),this.navigationTab=L,this.actions=[]}};d.ExternalUrlAction=class extends h{constructor(L,M=!0){super("ExternalUrlAction"),this.url=L,this.isSensitive=M}};d.CompoundAction=class extends h{constructor(L){super("CompoundAction"),this.actions=L}};d.OfferAction=class extends h{constructor(L,M,N){super("OfferAction"),this.title=L,this.adamId=M,this.purchaseConfiguration=N,N&&(this.bundleId=N.bundleId,this.lineItem=N.lineItem)}};d.InAppPurchaseAction=class extends h{constructor(L,M,N,U,B){super("InAppPurchaseAction"),this.productIdentifier=L,this.appAdamId=M,this.appBundleId=N,this.installRequiredAction=U,this.minimumShortVersionSupportingInAppPurchaseFlow=B}};d.AppStateAction=class extends h{constructor(L,M){super("AppStateAction"),this.title=M.title,this.adamId=L,this.defaultAction=M}};d.HttpAction=class extends h{constructor(L){super("HttpAction"),this.url=L,this.method="GET",this.headers={},this.body=null,this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}};d.HttpTemplateParameter=class{constructor(L,M,N,U){this.key=L,this.target=M,this.inputType=N,this.title=U,this.isRequired=!0,this.maximumLength=null}};class E extends h{constructor(L){super("HttpTemplateAction"),this.message=null,this.url=L,this.method="GET",this.headers={},this.body=null,this.parameters=[],this.isStoreRequest=!1,this.needsAuthentication=!1,this.retryCount=0,this.disableCache=!1,this.successAction=null,this.failureAction=null}}d.HttpTemplateAction=E;d.RateAction=class extends E{};d.SheetAction=class extends h{constructor(L){super("SheetAction"),this.actions=L,this.isCancelable=!1,this.message=null,this.style="default"}};d.AlertAction=class extends h{constructor(L){super("AlertAction"),this.style=L,this.title=null,this.message=null,this.isCancelable=!1,this.buttonActions=[],this.buttonTitles=[]}};d.ShareSheetAction=class extends h{constructor(L){super("ShareSheetAction"),this.data=L}};d.ReportConcernAction=class extends h{constructor(L){super("ReportConcernAction"),this.reasons=L}};d.ProductPageScrollAction=class extends h{constructor(L,M){super("ProductPageScrollAction"),this.section=L,this.clicksOnScroll=M}}},{"./base":119}],118:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(P,S,y){super(),this.card=P,this.shelves=S,this.footerLockup=y,this.isIncomplete=!1}}d.ArticlePage=h},{"./base":119}],119:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});class g{constructor(){this.incidents=[]}}d.Model=g;d.ImpressionableModel=class extends g{constructor(){super(),this.impressionQueues=["data-metrics"]}};d.PurchaseConfiguration=class extends g{constructor(F,R,O,D,x,L,M,N){super(),this.buyParams=F,this.vendor=R,this.appName=O,this.bundleId=D,this.appPlatforms=x,this.isPreorder=null===L||L===void 0?!1:L,this.excludeAttribution=null===M||M===void 0?!1:M,this.isRedownload=!1,this.skipInstall=!1,this.lineItem=N}};class S extends g{constructor(F,R,O,D,x,L,M,N,U,B,V,z,j,H,q,G,W,Y){super(),this.offerType=F,this.adamId=R,this.parentAdamId=D,this.style=null===O||O===void 0?"infer":O,this.environment=null===x||x===void 0?"light":x,this.tint=null===L||L===void 0?"blue":L,this.theme=S.deriveLegacyTheme(this.style,this.environment),this.titles=null===M||M===void 0?{}:M,this.subtitles=null===N||N===void 0?{}:N,this.title=U,this.subtitle=B,this.subtitlePosition=V,this.hasInAppPurchases=z,this.isDeletableSystemApp=j,this.isFree=H,this.offerLabelStyle=null===q||q===void 0?"none":q,this.hasDiscount=G,this.contentRating=W,this.subscriptionFamilyId=Y}newOfferDisplayPropertiesChangingAppearance(F,R,O,D){return new S(this.offerType,this.adamId,null!==R&&R!==void 0&&(F||"disabled"!==this.style)?R:this.style,this.parentAdamId,null===O||O===void 0?this.environment:O,null===D||D===void 0?this.tint:D,this.titles,this.subtitles,this.title,this.subtitle,this.subtitlePosition,this.hasInAppPurchases,this.isDeletableSystemApp,this.isFree,this.offerLabelStyle,this.hasDiscount,this.contentRating,this.subscriptionFamilyId)}static deriveLegacyTheme(F,R){return"grey"===F?"dark"===R?"lightForDarkBackdrop":"light":"colored"===F?"ad"===R?"white":"dark":"vibrant"===F?"vibrantDark":"white"===F?"white":"disabled"===F?"disabled":"dark"===R?"lightForDarkBackdrop":"infer"}}d.OfferDisplayProperties=S;d.PersonalizedOfferContext=class extends g{constructor(F,R,O){super(),this.offerAction=R,this.offerDisplayProperties=O,this.personalizedOfferType=F}};d.RemotePersonalizationResult=class extends g{constructor(F){super(),this.purchasedAdamIds=F}};class T extends g{constructor(F,R,O,D,x){super(),this.style=null,this.crop="bb",this.format="jpeg",this.quality=null,this.template=F,this.width=R,this.height=O,this.backgroundColor=D,this.checksum=x}createArtworkWithFullWidthCanvasArtWorkaround(){const F=new T(this.template.replace("{c}","bw").replace("bb.{f}","bw.{f}"),this.width,this.height,this.backgroundColor,this.checksum);return F.style=this.style,F.crop=this.crop,F.format=this.format,F.quality=this.quality,F}}d.Artwork=T;d.Screenshots=class extends g{constructor(F,R){super(),this.artwork=F,this.mediaPlatform=R}};d.MediaPlatform=class extends g{constructor(F,R){super(),this.appPlatform=F,this.deviceCornerRadiusFactor=R}isEqualTo(F){return F.appPlatform===this.appPlatform&&F.deviceCornerRadiusFactor===this.deviceCornerRadiusFactor}};class _{constructor(F,R){this.width=F,this.height=R}static fromNativeSize(F){return new _(F.width,F.height)}isEqualTo(F){return F.width===this.width&&F.height===this.height}}d.Size=_;d.ShareSheetNotesMetadata=class extends g{constructor(F,R,O,D,x){super(),this.itemName=F,this.developer=R,this.category=O,this.fileSize=D,this.mediaType=x}};d.ShareSheetData=class extends g{constructor(F,R,O,D,x,L,M,N){super(),this.context=F,this.text=R,this.url=O,this.shortUrl=D,this.artwork=x,this.giftAdamId=L,this.contentRating=M,this.notesMetadata=N}};d.ReportConcernReason=class extends g{constructor(F,R,O){super(),this.reasonId=F,this.name=R,this.uppercaseName=O}}},{}],120:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(S){super(),this.shelves=S,this.title=null,this.presentationOptions=[],this.isIncomplete=!1}}d.GenericPage=h;class P extends g.Model{}d.InAppPurchaseInstallPage=P},{"./base":119}],121:[function(s,l,d){"use strict";function g(h){for(var P in h)d.hasOwnProperty(P)||(d[P]=h[P])}Object.defineProperty(d,"__esModule",{value:!0}),g(s("./base")),g(s("./actions")),g(s("./shelves")),g(s("./metrics")),g(s("./product")),g(s("./reviews")),g(s("./search")),g(s("./generic-page")),g(s("./top-charts")),g(s("./article-page")),g(s("./today-page")),g(s("./mso"))},{"./actions":117,"./article-page":118,"./base":119,"./generic-page":120,"./metrics":122,"./mso":123,"./product":124,"./reviews":125,"./search":126,"./shelves":127,"./today-page":128,"./top-charts":129}],122:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(E,C,F){super(),this.instruction=E,this.eventFields=Object.freeze(C),this.invocationPoints=F}}d.MetricsEvent=h;d.MetricsClickEvent=class extends h{constructor(E,C,F){super("click",F,[]),this.targetType=C,this.targetId=E}};d.MetricsBackClickEvent=class extends h{constructor(E){const C={};Object.assign(C,E),C.actionType="back",super("click",C,["backButton"]),this.targetType="button",this.targetId="back"}};d.MetricsToroClickEvent=class extends h{constructor(E,C,F){super("toroClick",F,[]),this.lineItem=E,this.impressionId=C}};d.MetricsPageEvent=class extends h{constructor(E){super("page",E,["pageEnter"])}static copyTimingMetricsInto(E,C){E&&(C.clientCorrelationKey=E.clientCorrelationKey,C.requestStartTime=E.requestStartTime,C.responseStartTime=E.responseStartTime,C.responseEndTime=E.responseEndTime)}};d.MetricsSearchEvent=class extends h{constructor(E,C,F,R,O){const D={};Object.assign(D,O),D.term=E,D.targetType=C,D.actionType=F,D.actionUrl=R,super("search",D,[])}};d.MetricsPageRenderEvent=class extends h{constructor(E){super("pageRender",E,["never"])}static copyTimingMetricsInto(E,C){E&&(!C.pageUrl&&(C.pageUrl=E.pageURL),C.clientCorrelationKey=E.clientCorrelationKey,C.platformRequestStartTime=E.requestStartTime,C.platformResponseStartTime=E.responseStartTime,C.platformResponseEndTime=E.responseEndTime,C.platformResponseWasCached=E.responseWasCached,C.platformJsonParseStartTime=E.parseStartTime,C.platformJsonParseEndTime=E.parseEndTime)}};d.MetricsImpressionsEvent=class extends h{constructor(E){super("impressions",E,["pageExit","appExit"]),this.impressionQueue="data-metrics"}};d.FastImpressionsEvent=class extends h{constructor(E){super("impressions",E,["timer","pageExit","appExit"]),this.impressionQueue="data-metrics-impressions-low-latency"}};d.MetricsMediaEvent=class extends h{constructor(E){super("media",E,["never"])}}},{"./base":119}],123:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");d.MSOProviderData=class{constructor(S,y,A,T){this.name=S,this.url=y,this.artwork=A,this.roomUber=T}};class P extends g.Model{constructor(S,y){super(),this.apps=S,this.appsToAlwaysShow=y}}d.MSOAppsResponse=P},{"./base":119}],124:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base"),h=s("./shelves");class P extends g.Model{constructor(I,k,_,w,E,C,F="infer"){super(),this.type=I,this.content=k,this.caption=_,this.longCaption=w,this.leadingValue=F,this.accessibilityTitle=E,this.accessibilityCaption=C}}d.Badge=P;class S extends g.Model{constructor(I,k){super(),this.type=I,this.shelfId=k}}d.ProductPageSection=S;class y extends g.Model{constructor(I,k){super(),this.title=I,this.subtitle=k}}d.ProductPageExpandedOfferDetails=y;class A extends h.Lockup{}d.ProductPage=A;class T extends g.Model{constructor(I){super(),this.text=I}}d.ProductTextActivityProvider=T},{"./base":119,"./shelves":127}],125:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(_,w,E,C){super(),this.id=_,this.title=w,this.selectedActionTitle=E,this.url=C}}d.ReviewsPageSortOption=h;class P extends g.Model{}d.ReviewsPage=P;class S extends g.Model{}d.Ratings=S;class y extends g.Model{}d.Review=y;class A extends g.Model{}d.Response=A;class T extends g.Model{}d.TapToRate=T;class I extends g.Model{}d.ReviewActions=I;class k extends g.Model{constructor(_){super(),this.showsBadge=!1,this.title=null,this.notes=_,this.isCollapsed=!0}}d.EditorsChoice=k},{"./base":119}],126:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base"),h=s("./actions"),P=s("./shelves");class S extends g.Model{}d.SearchResults=S;class y extends g.Model{constructor(R,O){super(),this.type=R,this.values=O}}d.SearchFacetSet=y;class A extends g.Model{constructor(R,O,D=null){super(),this.name=R,this.value=O,this.isSelected=O===D}}d.SearchFacetValue=A;class T extends g.Model{constructor(R,O){super(),this.type=R,this.resultModel=O}}d.SearchResultContainer=T;class I extends P.MixedMediaLockup{constructor(R,O,D){super(),this.isAd=!0,this.lineItem=R,this.impressionId=O,this.transparencyAction=D,this.impressionQueues=["data-metrics","data-metrics-impressions-low-latency"]}}d.AdLockup=I;class k extends P.AppTrailersLockup{constructor(R,O,D){super(),this.isAd=!0,this.lineItem=R,this.impressionId=O,this.transparencyAction=D,this.impressionQueues=["data-metrics","data-metrics-impressions-low-latency"]}}d.AdvertisingLockup=k;class _ extends h.Action{constructor(R){super("AdTransparencyAction"),this.adTransparencyData=R}}d.AdTransparencyAction=_;class w extends g.ImpressionableModel{}d.EditorialSearchResult=w;class E extends h.Action{constructor(R,O,D){super("SearchAction"),this.term=R,this.url=O,this.origin=D}}d.SearchAction=E;class C extends g.Model{constructor(R){super(),this.hints=R}}d.SearchHintSet=C;class F extends g.Model{constructor(R,O){super(),this.title=R,this.searches=O}}d.TrendingSearches=F},{"./actions":117,"./base":119,"./shelves":127}],127:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(te,ae,ie){super(),this.title=te,this.summary=ie,this.items=ae}}d.Annotation=h;class P extends g.Model{constructor(te,ae){super(),this.text=te,this.subText=ae}}d.AnnotationItem=P;class S extends g.Model{constructor(te,ae){super(),this.type=te,this.lockup=ae,this.allowsAutoPlay=!0}}S.backgroundColor="F1F4F6",d.AppShowcase=S;class y extends g.Model{constructor(te){super(),this.message=te}}d.Banner=y;class A extends g.Model{constructor(te){super(),this.lockup=te}}A.backgroundColor="F1F4F6",d.InAppPurchaseShowcase=A;class T extends g.Model{constructor(te,ae){super(),this.videoUrl=te,this.preview=ae,this.templateMediaEvent=null}}d.Video=T;class I extends g.Model{constructor(te){super(),this.videosByType=te}}d.VideoSet=I;class k extends g.Model{}d.ProductMediaItem=k;class _ extends g.Model{constructor(te,ae){super(),this.items=te,this.mediaPlatform=ae}}d.ProductMedia=_;class w extends g.Model{constructor(te){super(),this.type=te}}d.ProductCapability=w;class E extends g.Model{constructor(te,ae){super(),this.paragraph=te,this.developerAction=ae}}d.ProductDescription=E;class C extends g.Model{constructor(te){super(),this.text=te,this.presentationStyle=[],this.clickAction=null}}d.Footnote=C;class F extends g.ImpressionableModel{}d.Lockup=F;class R extends F{}d.ScreenshotsLockup=R;d.MixedMediaLockup=class extends F{};d.TrailersLockup=class extends F{};class x extends g.Model{constructor(){super(...arguments),this.looping=!0}}d.Trailers=x;d.AppTrailersLockup=class extends R{constructor(){super(...arguments),this.looping=!0}};d.InAppPurchaseLockup=class extends F{};d.BundleLockup=class extends F{};class U extends g.ImpressionableModel{constructor(te,ae,ie){super(),this.text=te,this.mediaType=ae||"text/plain",this.style=ie||"standard",this.alignment="localized",this.isCollapsed=!1,this.wantsCollapsedNewlines=!0}}d.Paragraph=U;class B extends g.Model{constructor(te,ae,ie){super(),this.text=te,this.style=ae,this.mediaType=ie,this.wantsCollapsedNewlines=!0}}d.TitledParagraph=B;class V extends g.ImpressionableModel{constructor(){super(),this.caption=null,this.title=null,this.subtitle=null,this.artwork=null,this.clickAction=null}}d.EditorialCard=V;class z extends g.ImpressionableModel{constructor(){super(),this.artwork=null,this.accessibilityLabel=null,this.shortEditorialDescription=null,this.clickAction=null,this.personalizationStyle="none"}}d.Brick=z;class j extends g.ImpressionableModel{constructor(te,ae,ie){super(),this.descriptionText=te,this.summaryText=ae,this.clickAction=ie}}d.Link=j;class H extends g.Model{constructor(te,ae,ie){super(),this.text=te,this.clickAction=ae,this.type=ie}}d.ProductPageLink=H;class q extends g.Model{constructor(te){super(),this.buttons=te}}d.TitledButtonStack=q;class G extends g.Model{constructor(te,ae){super(),this.title=te,this.action=ae}}d.TitledButton=G;class W extends g.Model{constructor(te,ae){super(),this.text=te,this.buttonAction=ae}}d.FooterButton=W;class Y extends g.ImpressionableModel{constructor(te,ae,ie="text/plain",oe=null,ne=null,se=null){super(),this.artwork=te,this.isFullWidth=ae,this.hasRoundedCorners="boolean"==typeof se?se:!this.isFullWidth,this.ordinal=ne,this.caption=oe,this.captionMediaType=ie}}d.FramedArtwork=Y;class K extends g.ImpressionableModel{constructor(te,ae,ie="text/plain",oe=null,ne=null,se=null){super(),this.video=te,this.isFullWidth=ae,this.hasRoundedCorners="boolean"==typeof se?se:!this.isFullWidth,this.canPlayFullScreen=!0,this.allowsAutoPlay=!0,this.looping=!0,this.showAudioControl=!0,this.ordinal=ne,this.caption=oe,this.captionMediaType=ie}}d.FramedVideo=K;class Q extends g.Model{constructor(te,ae,ie,oe){super(),this.type=te,this.title=ae,this.hasDivider=ie,this.action=oe}}d.RoundedButton=Q;class J extends g.ImpressionableModel{constructor(te,ae,ie,oe){super(),this.text=te,this.credit=ae,this.artwork=ie,this.isFullWidthArtwork=oe||!1}}d.Quote=J;class X extends g.ImpressionableModel{constructor(te){super(),this.isPersonalized=!1,this.shouldFilterApps=!1,this.contentType=te,this.title=null,this.subtitle=null,this.seeAllAction=null,this.isHorizontal=!1,this.items=[],this.url=null,this.isHidden=!1,this.mergeWhenFetched=!1,this.backgroundColor=null,this.rowsPerColumn=null}}d.Shelf=X;class Z extends g.Model{}d.ShelfPresentationHints=Z;d.PredicateBuilder=class{constructor(){this.conditions=[]}whenHorizontalSizeClassIs(te){return this.conditions.push(`$horizontalSizeClass == "${te}"`),this}whenUserInterfaceIdiomIs(te){return this.conditions.push(`$userInterfaceIdiom == "${te}"`),this}build(){return this.conditions.join(" && ")}};class ee extends g.Model{constructor(){super(),this.shelves={},this.errors={}}}d.ShelfBatch=ee},{"./base":119}],128:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.ImpressionableModel{constructor(N){super(),this.kind=N}}d.TodayCardMedia=h;d.TodayCardMediaArtwork=class extends h{constructor(N){super("artwork"),this.art=N}};d.TodayCardMediaAppIcon=class extends h{constructor(N){super("appIcon"),this.icon=N}};class y extends h{constructor(N,U){super("brandedSingleApp"),this.icon=N,this.art=U}}y.noArtBackgroundColor="BBBBBB",d.TodayCardMediaBrandedSingleApp=y;d.TodayCardMediaList=class extends h{constructor(N,U){super("list"),this.lockups=N,this.marketingText=U}};class T extends h{constructor(N,U){super("multiApp"),this.lockups=N,this.additionalText=U}}T.multiAppBackgroundColor="F5F5F5",d.TodayCardMediaMultiApp=T;d.TodayCardInAppPurchase=class extends h{constructor(N){super("inAppPurchase"),this.lockup=N}};d.TodayCardMediaRiver=class extends h{constructor(N){super("river"),this.lockups=N,this.lockupImpressionLimit=10}};d.TodayCardMediaGrid=class extends h{constructor(N,U){super("grid"),this.lockups=N,this.artworkGridType=U,this.lockupImpressionLimit=3}};d.TodayCardMediaVideo=class extends h{constructor(N,U){super("video"),this.video=N,this.allowsAutoPlay=!0,this.looping=!0,this.description=U}};class E extends g.Model{constructor(N){super(),this.kind=N}}d.TodayCardOverlay=E;d.TodayCardLockupOverlay=class extends E{constructor(N){super("lockup"),this.lockup=N,this.displaysIcon=!0}};d.TodayCardMarketingLockupOverlay=class extends E{constructor(N,U,B){super("marketingLockup"),this.lockup=N,this.marketingText=U,this.hideBackground=B}};d.TodayCardLockupListOverlay=class extends E{constructor(N){super("lockupList"),this.lockups=N}};d.TodayCardParagraphOverlay=class extends E{constructor(N,U){super("paragraph"),this.paragraph=N,this.style=U}};d.TodayCardActionOverlay=class extends E{constructor(N){super("action"),this.action=N}};class x extends g.ImpressionableModel{constructor(){super(),this.heading=null,this.title=null,this.media=null,this.overlay=null,this.style=null,this.clickAction=null,this.backgroundColor=null,this.inlineDescription=null}}d.TodayCard=x;class L extends g.ImpressionableModel{constructor(N){super(),this.cards=N}}d.InlineTodayCards=L;class M extends g.Model{constructor(N,U){super(),this.shelves=N,this.title=null,this.nextPage=null,this.onboardingCardIds=U?U:[]}}d.TodayPage=M},{"./base":119}],129:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./base");class h extends g.Model{constructor(y,A,T){super(),this.shortName=y,this.longName=A,this.shelves=T,this.nextPage=null}}d.TopChartSegment=h;class P extends g.Model{constructor(y,A,T,I,k,_,w){super(),this.genreId=y,this.ageBandId=A,this.url=T,this.shortName=I,this.longName=k,this.artwork=_,this.children=w}}d.TopChartCategory=P;class S extends g.Model{constructor(y,A,T,I,k,_){super(),this.genreId=y,this.ageBandId=A,this.title=T,this.segments=I,this.categoriesButtonTitle=k,this.categories=_,this.initialSegmentIndex=0}}d.TopChartsPage=S},{"./base":119}],130:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("./data/validation");Promise.prototype.pipeInto=function(h){const P=this;P.then(S=>{try{g.recordValidationIncidents(S);const y=JSON.stringify(S);h.resolveToValue(y)}catch(y){h.resolveToError(y)}},S=>{h.resolveToError(S)})}},{"./data/validation":104}],131:[function(s,l){l.exports={resources:{"localization/ca-es.json":"resources/localization/9f043bc40634f32f540cb46cb7e2ec00/ca-es.json","localization/cs-cz.json":"resources/localization/1070b7952f5bf93e01a163c4c97111ee/cs-cz.json","localization/da-dk.json":"resources/localization/0a3f973528ed174c246ec65b7a046382/da-dk.json","localization/de-ch.json":"resources/localization/211b9d06fbc78cabf7880ab124567471/de-ch.json","localization/de-de.json":"resources/localization/211b9d06fbc78cabf7880ab124567471/de-de.json","localization/el-gr.json":"resources/localization/96c6e14a53559439c84fdec5ff8a0810/el-gr.json","localization/en-au.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-au.json","localization/en-ca.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-ca.json","localization/en-gb.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-gb.json","localization/en-ua.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-ua.json","localization/en-uk.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-uk.json","localization/en-us.json":"resources/localization/b8369b95424b3929b8408da977db998b/en-us.json","localization/es-es.json":"resources/localization/27c33cfab86fb004e84f3b5ab935d8a3/es-es.json","localization/es-mx.json":"resources/localization/babd82a6a10cca4581bdc0bcac834ff9/es-mx.json","localization/fi-fi.json":"resources/localization/c766fc3c31725150633cbfc895f8d3a7/fi-fi.json","localization/fr-ca.json":"resources/localization/2c9637021df74e83080de3f2c57d6a3e/fr-ca.json","localization/fr-ch.json":"resources/localization/37d21933894bcf09c28f6947b8f2d82d/fr-ch.json","localization/fr-fr.json":"resources/localization/37d21933894bcf09c28f6947b8f2d82d/fr-fr.json","localization/hi-in.json":"resources/localization/13c8cb58ec8aecb480cca660eb58ec21/hi-in.json","localization/hr-hr.json":"resources/localization/733e3eceff7c9b30f2c980c26a4ec5e4/hr-hr.json","localization/hu-hu.json":"resources/localization/116598ec7a32dc419bb802d7eb5884ea/hu-hu.json","localization/id-id.json":"resources/localization/e12099114fa18f737d26ccfd22de8cd1/id-id.json","localization/it-it.json":"resources/localization/c7ee623ced95fb8563286afe54fadf6c/it-it.json","localization/ja-jp.json":"resources/localization/03e4ca5adb7897d3dd43a7303091f9a9/ja-jp.json","localization/ko-kr.json":"resources/localization/44cfa3b6b07bca8d9631612e216b7653/ko-kr.json","localization/ms-my.json":"resources/localization/56cb317363b2830e4531d234c246a4be/ms-my.json","localization/nl-nl.json":"resources/localization/c9fabdd9ce7c57b6c9909e099885be5c/nl-nl.json","localization/no-no.json":"resources/localization/026dfdc14b301309eddf2ece88f44fff/no-no.json","localization/pl-pl.json":"resources/localization/a9a00125dc85ca57e0a87b27845beb87/pl-pl.json","localization/pt-br.json":"resources/localization/35f2fd7efb88dae1368a1e96b227f889/pt-br.json","localization/pt-pt.json":"resources/localization/55cd35b6db07e84bb5e07960685ab106/pt-pt.json","localization/ro-ro.json":"resources/localization/196183a4b73e831720d4348e090dfe75/ro-ro.json","localization/ru-ru.json":"resources/localization/6387c464754485030fdeb211c390636f/ru-ru.json","localization/sk-sk.json":"resources/localization/40ed71f4b0e6d076cdeb60809c92a39b/sk-sk.json","localization/sv-se.json":"resources/localization/987b76714493c3aa76536dbe6b50d578/sv-se.json","localization/th-th.json":"resources/localization/dcce5f9de492110b443c12ef600dc66c/th-th.json","localization/tr-tr.json":"resources/localization/a1911247cbbdc266a51b3e1287d67012/tr-tr.json","localization/uk-ua.json":"resources/localization/99343dc6462c0bc2d36e6082943d7cae/uk-ua.json","localization/vi-vi.json":"resources/localization/bb03208efb1b82ebb3e1eb0c60cb57ac/vi-vi.json","localization/zh-cn.json":"resources/localization/f51e47c6843b927eb47646b1d8c8a335/zh-cn.json","localization/zh-hans.json":"resources/localization/f51e47c6843b927eb47646b1d8c8a335/zh-hans.json","localization/zh-hant.json":"resources/localization/503bef20f3c9f98cc4c0654149e8a1be/zh-hant.json","localization/zh-hk.json":"resources/localization/503bef20f3c9f98cc4c0654149e8a1be/zh-hk.json","localization/zh-ma.json":"resources/localization/f51e47c6843b927eb47646b1d8c8a335/zh-ma.json","localization/zh-tw.json":"resources/localization/503bef20f3c9f98cc4c0654149e8a1be/zh-tw.json"},version:"11.3.1568335001+sha.1c411ea2"}},{}],132:[function(s,l,d){"use strict";function h(O){let D=I.default.accessoryRoomUrl;(void 0===D||null===D||"string"!=typeof D)&&(D="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewAccessoryRoom");const x=new T.URL(D);return x.query=O.query,x}function P(){let D=I.default.passbookMainUrl;return(void 0===D||null===D||"string"!=typeof D)&&(D="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewFeature?id=717384713&mt=8"),new T.URL(D)}function S(O){let D=I.default.libraryLinkUrl;(void 0===D||null===D||"string"!=typeof D)&&(D="https://itunes.apple.com/WebObjects/MZStoreServices.woa/wa/libraryLink");const x=new T.URL(D);return x.query=O.query,x}function y(O,D,x){const L=new A.FlowAction(D);return L.pageUrl=x.build(),L.pageData=O,L}Object.defineProperty(d,"__esModule",{value:!0});const A=s("../models"),T=s("../data/urls"),I=s("../wrappers/bag"),k=s("../builders/search"),_=s("../wrappers/store"),w=s("../builders/room"),E=s("../data/server-data"),C=s("../util/properties"),F=s("../builders/grouping"),R=s("./server-routing");d.actionForActionUrl=function(O){const x=O.query.action;switch(x){case"account":const L=new A.FlowAction("finance");L.presentationContext="presentModalFormSheet",L.animationBehavior="always";const M=O.query.originalUrl;return L.pageUrl=M?M:O.query.continuation?T.URL.fromComponents(null,x,null,{continuation:O.query.continuation}).toString():x,new Promise(Y=>Y(L));case"checkForPreorders":const N=O.query.originalUrl;return 0<N.length?_.fetchPlist(N,{isStoreRequest:!0}).then(()=>{return new A.TabChangeAction("today")}):new Promise((Y,K)=>{K(new Error("Original url is missing when creating action for checkForPreorders."))});case"redeem":if(C.enabled("redeemWithPromoCode")){const Y=new A.FlowAction("finance");return Y.presentationContext="presentModalFormSheet",Y.animationBehavior="always",Y.pageUrl=O.query.code&&0<O.query.code.length?`${x}/${O.query.code}`:x,new Promise(K=>K(Y))}case"gift":const U=new A.FlowAction("finance");return U.presentationContext="presentModalFormSheet",U.animationBehavior="always",U.pageUrl=x,new Promise(Y=>Y(U));case"donate":const B=new A.FlowAction("finance");return B.presentationContext="presentModalFormSheet",B.animationBehavior="always",B.pageUrl="charity",new Promise(Y=>Y(B));case"search":const V=O.query.term?O.query.term.replace(/\+/g," "):null;if(V&&0<V.length){const Y=k.assembleUrl(I.default.searchUrl,V,{}),K=new A.SearchAction(V,Y,"externalUrl"),Q=new A.FlowAction("search");return Q.pageData=K,new Promise(J=>J(Q))}const Y=new A.TabChangeAction("search");return new Promise(K=>K(Y));case"updates":case"today":case"apps":case"games":const z=new A.TabChangeAction(x);return new Promise(Y=>Y(z));case"accessoryLookup":const j=h(O);let H=null;return _.fetchJson(j.toString(),{isStoreRequest:!0}).then(Y=>{const K=E.asArrayOrEmpty(Y,"pageData.adamIds");return H=Y,_.fetchStorePlatformData(K.map(Q=>Q.toString()),{p:"lockup"})}).then(Y=>{H.storePlatformData={lockup:{results:Y}};const K=w.roomPageWithResponse(H,j);return y(K,"page",j)});case"passbook":const q=P(O);return _.fetchJson(q.toString(),{isStoreRequest:!0}).then(Y=>{return R.flowActionForServerResponse(Y,q)});case"library-link":const G=S(O);return _.fetchJson(G.toString(),{isStoreRequest:!0}).then(Y=>{const K=F.groupingPageWithResponse(Y);return y(K,"page",G)});case"arcade":const W=new A.FlowAction("article");return W.pageUrl="https://apps.apple.com/story/id1456880492",new Promise(Y=>Y(W));default:}return new Promise((L,M)=>{M(new Error(`FlowAction was not able to be created for this action URL: ${O}`))})}},{"../builders/grouping":75,"../builders/room":86,"../builders/search":87,"../data/server-data":101,"../data/urls":103,"../models":121,"../util/properties":147,"../wrappers/bag":150,"../wrappers/store":155,"./server-routing":141}],133:[function(s,l,d){"use strict";function g(B,V,z){const j=new h.FlowAction(V);return j.pageUrl=z.build(),j.pageData=B,j}Object.defineProperty(d,"__esModule",{value:!0});const h=s("../../models"),P=s("../../builders/static_pages"),S=s("../../builders/top-charts"),y=s("../../builders/developer"),A=s("../../wrappers/store"),T=s("../../builders/grouping"),I=s("../../builders/reviews"),k=s("../../builders/room"),_=s("../../builders/mso"),w=s("../../builders/multi-room"),E=s("../../builders/product-pages"),C=s("../../builders/onboarding-cards"),F=s("../server-routing"),R=s("../../data/urls"),O=s("../../builders/lockups"),D=s("../../builders/article"),x=s("../action-routing"),L=s("../../util/localization"),M=s("../../builders/product-page-ordering"),N=s("../../metrics/helpers"),U=s("../../builders/offers");d.default={topCharts(B,V,z){A.fetchJson(B.build(),{isStoreRequest:!0}).then(j=>S.topChartsPageFromApiResponse(j)).then(j=>{return g(j,"topCharts",B)}).then(z.resolve,z.reject)},product(B,V,z){function j(G,W){const Y={},K=V[R.Parameters.offerName];if(K){const Q="true"===V[R.ProductPageParameters.isSubscription];Y.spotlightSection=M.inAppPurchaseSection(Q),Y.spotlightInAppProductIdentifier=K}E.productPageFromUrl(G.toString(),Y).then(Q=>{const J=g(Q,"product",G),X=1===J.pageData.appPlatforms.length&&"tv"===J.pageData.appPlatforms[0];if(V[R.Parameters.action]===E.writeReviewAction&&!X){const Z=new h.FlowAction("writeReview");return Z.pageUrl=I.assembleWriteReviewUrl(Q.adamId),Z.pageData=Q.adamId,Z.presentationContext="presentModal",J.animationBehavior="never",new h.CompoundAction([J,Z])}if(V[R.Parameters.action]===E.reviewsAction&&!X){const Z=Q.shelfMapping.ratings;let $=null;return Z&&Z.seeAllAction&&($=Z.seeAllAction,$.animationBehavior="never"),J.animationBehavior="never",new h.CompoundAction([J,$])}return J}).then(W.resolve,W.reject)}const H=V[R.Parameters.bundleIdentifier],q=V[R.Parameters.ids];H?A.fetchStorePlatformData([H],{identifierType:"bundleId"}).then(G=>j(new R.URL(G[H].url),z)):"lookup"===V[R.Parameters.action]&&q?A.fetchStorePlatformData([q],{p:E.profile}).then(G=>j(new R.URL(G[q].url),z)):j(B,z)},sortedReviews(B,V,z){const j=V[R.ReviewsPageParameters.adamId],H=V[R.ReviewsPageParameters.sort],q=I.assembleReviewRowsUrl(j,0,I.pageSize,H),G=I.pageSize+1,W=G+I.pageSize,Y=I.reviewsPageUrl(j,G,W,H);A.fetchJson(q,{isStoreRequest:!0}).then(K=>I.reviewsPageForReviewsData(null,null,K,Y,null,0,j)).then(K=>g(K,"reviews",B)).then(z.resolve,z.reject)},reviews(B,V,z){E.productPageFromUrl(B.toString()).then(j=>{return g(j,"product",B)}).then(z.resolve,z.reject)},productInAppPurchase(B,V,z){const j=V[R.ProductPageParameters.url],H={},q="true"===V[R.ProductPageParameters.isSubscription];H.spotlightSection=M.inAppPurchaseSection(q),H.spotlightInAppProductIdentifier=V[R.Parameters.offerName],E.productPageFromUrl(j,H).then(G=>{return g(G,"product",B)}).then(z.resolve,z.reject)},inAppPurchaseInstall(B,V,z){const j=V[R.Parameters.id],H=V[R.InAppPurchaseInstallPageParameters.inAppPurchaseId];A.fetchStorePlatformData([j,H],{p:"lockup"}).then(G=>{const W=N.pageInformationForIAPPage(j,H),Y=G[H];let K;const Q={metricsOptions:{pageInformation:W,locationTracker:N.newLocationTracker()}};H&&Y&&(K=O.inAppPurchaseLockupFromPlatformData(Y,Q),K.theme="dark");const J=G[j];let X;j&&J&&(X=O.lockupFromPlatformData(J,Q));const Z=new h.InAppPurchaseInstallPage;Z.isComplete=!0,Z.lockup=K,Z.parentLockup=X;const $=U.offerDataFromPlatformData(Y);return Z.preInstallOfferDescription=U.installPagePreInstallTrialDescription($),Z.bannerMessage=L.string("INSTALL_PAGE_BANNER_MESSAGE"),N.addPageEventsToInAppPurchasePage(Z,W),Z}).then(G=>{return g(G,"inAppPurchaseInstall",B)}).then(z.resolve,z.reject)},developer(B,V,z){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(j=>y.developerPageFromResponse(j)).then(j=>{return g(j,"page",B)}).then(z.resolve,z.reject)},grouping(B,V,z){function j(G,W,Y,K){A.fetchJson(G.toString(),{isStoreRequest:!0}).then(Q=>{const J=T.groupingPageWithResponse(Q,W,Y);return J instanceof h.TodayPage?g(J,"today",B):g(J,"page",B)}).then(K.resolve,K.reject)}const H=C.extractOnboardingCardIdsFromParameters(V),q=B.removeParam(R.TodayPageParameters.onboardingCardIds);H&&0<H.length?A.fetchStorePlatformData(H,{p:"lockup"}).then(G=>j(q,H,G,z)):j(B,null,null,z)},article(B,V,z){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(j=>D.articlePageWithResponse(j)).then(j=>{return g(j,"article",B)}).then(z.resolve,z.reject)},room(B,V,z){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(j=>k.roomPageWithResponse(j,B)).then(j=>{return g(j,"page",B)}).then(z.resolve,z.reject)},multiRoom(B,V,z){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(j=>w.multiRoomPageWithResponse(j)).then(j=>{return g(j,"page",B)}).then(z.resolve,z.reject)},docTypeLookup(B,V,z){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(j=>k.docTypeLookupWithResponse(j,B)).then(j=>g(j,"page",B)).then(z.resolve,z.reject)},resetAndRedirect(B,V,z){A.fetchPlist(B.toString(),{isStoreRequest:!0}).then(z.resolve,z.reject)},msoRoom(B,V,z){const j=_.extractAvailableAdamIdsFromParameters(V),H=B.removeParam(R.MSOPageParameters.availableAdamIds);A.fetchJson(H.toString(),{isStoreRequest:!0}).then(q=>_.msoRoomPageWithResponse(q,B,j)).then(q=>g(q,"mso",B)).then(z.resolve,z.reject)},staticTestPage(B,V,z){z.resolve(g(P.testPage(),"page",B))},textAndImagesTestPage(B,V,z){z.resolve(g(P.textAndImagesTestPage(),"page",B))},lockupTestPage(B,V,z){z.resolve(g(P.lockupTestPage(),"page",B))},miscTestPage(B,V,z){z.resolve(g(P.miscTestPage(),"page",B))},actionHandler(B,V,z){x.actionForActionUrl(B,V).then(z.resolve,z.reject)},unknown(B,V){A.fetchJson(B.toString(),{isStoreRequest:!0}).then(z=>{return F.flowActionForServerResponse(z,B)}).then(V.resolve,V.reject)},unhandled(B,V){V.reject(new Error(`Unhandled page url: ${B}`))}}},{"../../builders/article":71,"../../builders/developer":73,"../../builders/grouping":75,"../../builders/lockups":76,"../../builders/mso":77,"../../builders/multi-room":78,"../../builders/offers":79,"../../builders/onboarding-cards":80,"../../builders/product-page-ordering":82,"../../builders/product-pages":83,"../../builders/reviews":84,"../../builders/room":86,"../../builders/static_pages":90,"../../builders/top-charts":97,"../../data/urls":103,"../../metrics/helpers":108,"../../models":121,"../../util/localization":145,"../../wrappers/store":155,"../action-routing":132,"../server-routing":141}],134:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../../builders/room"),h=s("../../builders/multi-room"),P=s("../../wrappers/store"),S=s("../../builders/pagination"),y=s("../../builders/reviews"),A=s("../../data/urls");d.default={room(T,I,k){const _=k.pageToken,w=S.getIdsForLookup(_);P.fetchStorePlatformData(w,{p:_.profile}).then(E=>{return g.roomPageWithContext(E,_)}).then(k.resolve,k.reject)},reviews(T,I,k){const _=+I[A.ReviewsPageParameters.startIndex],w=+I[A.ReviewsPageParameters.endIndex],E=I[A.ReviewsPageParameters.adamId],C=I[A.ReviewsPageParameters.sort],F=y.assembleReviewRowsUrl(E,_,w,C),R=w+1,O=R+y.pageSize,D=y.reviewsPageUrl(E,R,O,C);P.fetchJson(F,{isStoreRequest:!0}).then(x=>y.reviewsPageForReviewsData(null,null,x,D,null,_,E)).then(k.resolve,k.reject)},multiRoom(T,I,k){const _=k.pageToken,w=S.getIdsForLookup(_),E=S.getMetricsPageInformation(_);P.fetchStorePlatformData(w,{p:_.profile}).then(C=>{const F=h.multiRoomPageWithContext(_.missingSegments,C,[],E);return F}).then(k.resolve,k.reject)},docTypeLookup(T,I,k){const _=k.pageToken,w=S.getIdsForLookup(_);P.fetchStorePlatformData(w,{p:_.profile}).then(E=>{return g.roomPageWithContext(E,_)}).then(k.resolve,k.reject)},unhandled(T,I){I.reject(new Error(`Unhandled pagination url: ${T}`))}}},{"../../builders/multi-room":78,"../../builders/pagination":81,"../../builders/reviews":84,"../../builders/room":86,"../../data/urls":103,"../../wrappers/store":155}],135:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../../models"),h=s("../../builders/developer"),P=s("../../wrappers/store"),S=s("../../wrappers/client"),y=s("../../builders/reviews"),A=s("../../builders/grouping"),T=s("../../builders/product-pages"),I=s("../../metrics/helpers"),k=s("../../util/localization"),_=s("../../wrappers/client-ordering"),w=s("../../builders/product-page-ordering"),E=s("../../builders/lockups"),C=s("../../builders/article"),F=s("../../data/server-data"),R=s("../../builders/content");d.default={product(O,D,x){const L=D.token,M=JSON.parse(L);P.fetchStorePlatformData(M.ids,{p:"lockup"}).then(N=>{const U=T.shelfFromLookupResponse(N,M);if(U.mergeWhenFetched=!0,U.networkTimingMetrics=N[I.timingValues],M.shouldInferSeeAllFromFetchesItems){const V=new g.FlowAction("page");V.title=k.string("ACTION_SEE_ALL");const z=new g.Shelf(U.contentType);z.items=E.shallowCopyLockupsOverridingProperties(U.items,"infer");const j=new g.GenericPage([z]);I.copyMetricsEventsIntoPageWithInformation(j,M.destinationPageInformation),j.title=M.title,V.pageData=j,I.addClickEventToSeeAllAction(V,null,{pageInformation:M.sourcePageInformation,locationTracker:M.sourceLocationTracker}),U.seeAllAction=V}const B=U.items;if("inAppPurchaseLockup"===M.contentType&&B){const V=[],z=[];for(const j of B){const H=j.productIdentifier,q=w.inAppPurchaseSection(j.isSubscription);q.shelfId===M.inAppShelfId&&(V.push(H),j.isVisibleByDefault&&z.push(H))}return _.orderedVisibleIAPs(M.appBundleId,V,z,M.spotlightInAppProductIdentifier).then(j=>{return U.items=T.filteredInAppLockupsUsingOrdering(B,j),U})}return"todayBrick"===U.contentType&&0===U.items.length&&(U.isHidden=!0),U}).then(x.resolve,x.reject)},developer(O,D,x){const L=D.token,M=JSON.parse(L);P.fetchStorePlatformData(M.remainingIds,{p:"lockup",platform:M.lookupPlatform}).then(N=>h.loadMoreFromResponse(N,M)).then(x.resolve,x.reject)},grouping(O,D,x){const L=D.token,M=JSON.parse(L);switch(M.featuredContentId){case A.FeaturedContentID.Sundance_RecommendedAppsShelf:case A.FeaturedContentID.Sundance_RecommendedGamesShelf:{P.fetchJson(M.recommendationsUrl,{method:"POST",isStoreRequest:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(N=>{const U=A.shelfForRecommendationResponse(N,M);return U.networkTimingMetrics=N[I.timingValues],U}).then(x.resolve,x.reject);break}default:P.fetchStorePlatformData(M.ids,{p:M.storeLookupProfile}).then(N=>{return A.groupingPageShelfWithToken(N,M)}).then(x.resolve,x.reject);}},article(O,D,x){const L=D.token,M=JSON.parse(L);P.fetchStorePlatformData([M.contentId],{p:M.storeLookupProfile}).then(N=>{const U=C.articleShelfFromResponse(N,M);return U.networkTimingMetrics=N[I.timingValues],U}).then(x.resolve,x.reject)},articleScreenshots(O,D,x){const L=D.token,M=JSON.parse(L),N=D.appPlatform,U=R.storeLookupPlatformFromAppPlatform(N),B={p:"screenshots-by-type"};U&&(B.platform=U);const V=C.articleShelfFromResponse(M.contentData,M);P.fetchStorePlatformData([M.contentId],B).then(z=>{V.url=null;const j=z[M.contentId];let H=null;if(!F.isNull(j)){H=R.bestScreenshotData(N,j.screenshotsByType);const q=[];for(const G of H.artwork){const W=new g.ProductMediaItem;W.screenshot=G,q.push(W)}}return H&&(V.items=[H]),V.networkTimingMetrics=z[I.timingValues],V}).then(x.resolve,x.reject)},reviews(O,D,x){const L=D.id,M=decodeURIComponent(D.supportUrl),N=P.fetchJson(y.assembleReviewsUrl(L),{isStoreRequest:!0}),U=P.fetchJson(y.assembleReviewRowsUrl(L,0,y.pageSize),{isStoreRequest:!0});Promise.all([N,U]).then(([B,V])=>{return B.supportUrl=M,y.reviewsShelfForReviewsData(S.guid,B,V,!0)}).then(x.resolve,x.reject)},personalizedReviews(O,D,x){const L=D.id;P.fetchJson(y.assemblePersonalizedReviewUrl(L),{isStoreRequest:!0}).then(M=>{const N=M.userReview;if(N&&0<N.userReviewId){const U={userReviewList:[M.userReview]},B=y.reviewsShelfForReviewsData(S.guid,null,U,!1,!1);return B.isHorizontal=!1,B}return null}).then(x.resolve,x.reject)},personalizedReviewActions(O,D,x){const L=D.id,M=decodeURIComponent(D.supportUrl);P.fetchJson(y.assemblePersonalizedReviewUrl(L),{isStoreRequest:!0}).then(N=>{const U=N.userReview,B=U&&0<U.userReviewId,V=new g.Shelf("reviewActions"),z=y.reviewActionsForRatingsData({adamId:L,supportUrl:M},B);return V.items=[z],V.isPersonalized=!0,V}).then(x.resolve,x.reject)},unhandled(O,D){D.reject(new Error(`Unhandled shelf url: ${O}`))}}},{"../../builders/article":71,"../../builders/content":72,"../../builders/developer":73,"../../builders/grouping":75,"../../builders/lockups":76,"../../builders/product-page-ordering":82,"../../builders/product-pages":83,"../../builders/reviews":84,"../../data/server-data":101,"../../metrics/helpers":108,"../../models":121,"../../util/localization":145,"../../wrappers/client":152,"../../wrappers/client-ordering":151,"../../wrappers/store":155}],136:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../../data/urls");d.default={product:[{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.product}/{appName}/{id}`,query:[`${g.Parameters.mediaType}?`,`${g.Parameters.action}?`,`${g.Parameters.offerName}?`]},{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.product}/{id}`,query:[`${g.Parameters.mediaType}?`,`${g.Parameters.action}?`,`${g.Parameters.offerName}?`]},{protocol:g.Protocol.https,path:`/${g.Path.product}/{appName}/{id}`,query:[`${g.Parameters.mediaType}?`,`${g.Parameters.action}?`,`${g.Parameters.offerName}?`]},{protocol:g.Protocol.https,path:`/${g.Path.product}/{id}`,query:[`${g.Parameters.mediaType}?`,`${g.Parameters.action}?`,`${g.Parameters.offerName}?`]},{protocol:g.Protocol.https,query:[g.Parameters.bundleIdentifier]},{protocol:g.Protocol.https,query:[g.Parameters.action,g.Parameters.ids]}],reviews:[{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.product}/{appName}/{id}`,query:[g.Parameters.mediaType],hash:g.Hashes.reviews}],sortedReviews:[{protocol:g.Protocol.internal,path:`/${g.Path.reviews}/{adamId}/{sort}`}],productInAppPurchase:[{protocol:g.Protocol.internal,path:`/${g.Path.product}/${g.Path.lookup}`,query:[g.ProductPageParameters.url,g.Parameters.offerName,g.ProductPageParameters.isSubscription]}],inAppPurchaseInstall:[{protocol:g.Protocol.internal,path:`/${g.Path.product}/${g.Path.install}`,query:[`${g.Parameters.id}`,`${g.InAppPurchaseInstallPageParameters.inAppPurchaseId}?`,`${g.InAppPurchaseInstallPageParameters.bannerMessage}?`]}],topCharts:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.topCharts}`,query:[g.Parameters.genreId,g.Parameters.popId]}],developer:[{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.developer}/{developerName}/{id}`,query:[g.Parameters.mediaType]},{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.artist}/{developerName}/{id}`,query:[g.Parameters.mediaType]}],grouping:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.grouping}`,query:[g.Parameters.id,`${g.TodayPageParameters.onboardingCardIds}?`]},{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.today}`,query:[`${g.TodayPageParameters.onboardingCardIds}?`]},{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.genre}/{genreName}/{id}`,query:[g.Parameters.mediaType,"${urls.TodayPageParameters.onboardingCardIds}?"]}],article:[{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.editorialItem}/{id}`,query:[]},{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.story}/{id}`,query:[]},{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.viewEditorialItem}`,query:[g.Parameters.id]}],room:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.room}`,query:[g.Parameters.featuredContentId]},{protocol:g.Protocol.https,path:`/${g.Path.storeElements}/${g.Path.recommendationsSeeAll}`}],multiRoom:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.multiRoom}`,query:[g.Parameters.featuredContentId]}],msoRoom:[{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.mso}/{appName}/{id}`,query:[`${g.MSOPageParameters.availableAdamIds}?`]},{protocol:g.Protocol.https,path:`/${g.Path.mso}/{providerName}/{id}`,query:[`${g.MSOPageParameters.availableAdamIds}?`]},{protocol:g.Protocol.https,path:`/{countryCode}/${g.Path.mso}/{id}`,query:[`${g.MSOPageParameters.availableAdamIds}?`]},{protocol:g.Protocol.https,path:`/${g.Path.mso}/{id}`,query:[`${g.MSOPageParameters.availableAdamIds}?`]},{protocol:g.Protocol.https,path:`/${g.Path.mso}`,query:[g.Parameters.id,`${g.MSOPageParameters.availableAdamIds}?`]},{protocol:g.Protocol.https,path:`{countryCode}/${g.Path.mso}`,query:[g.Parameters.id,`${g.MSOPageParameters.availableAdamIds}?`]}],docTypeLookup:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.docTypeLookup}`}],resetAndRedirect:[{protocol:g.Protocol.https,path:`/${g.Path.store}/${g.Path.resetAndRedirect}`}],staticTestPage:[{protocol:g.Protocol.internal,path:`/${g.Path.test}`}],textAndImagesTestPage:[{protocol:g.Protocol.internal,path:`/${g.Path.test}/${g.Path.textAndImagesTest}`}],lockupTestPage:[{protocol:g.Protocol.internal,path:`/${g.Path.test}/${g.Path.lockupsTest}`}],miscTestPage:[{protocol:g.Protocol.internal,path:`/${g.Path.test}/${g.Path.miscTest}`}],action:[{query:[g.Parameters.action]}]}},{"../../data/urls":103}],137:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../../data/urls");d.default={product:[{protocol:g.Protocol.internal,path:`/${g.Path.product}/${g.Path.lookup}`,query:[g.Parameters.ids]}],reviews:[{protocol:g.Protocol.internal,path:`/${g.Path.reviews}/${g.Path.shelf}/{adamId}/{startIndex}/{endIndex}/{sort}`}],topCharts:[{protocol:g.Protocol.internal,path:`/${g.Path.topCharts}/{genre}/{pop}`}],room:[{protocol:g.Protocol.internal,path:`/${g.Path.room}/${g.Path.lookup}`}],multiRoom:[{protocol:g.Protocol.internal,path:`/${g.Path.multiRoom}/${g.Path.lookup}`}],docTypeLookup:[{protocol:g.Protocol.internal,path:`/${g.Path.docTypeLookup}/${g.Path.lookup}`}],grouping:[{protocol:g.Protocol.internal,path:`/${g.Path.grouping}/${g.Path.shelf}/{shelfToken}`}]}},{"../../data/urls":103}],138:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g=s("../../data/urls");d.default={product:[{protocol:g.Protocol.internal,path:`/${g.Path.product}/${g.Path.shelf}/{token}`}],grouping:[{protocol:g.Protocol.internal,path:`/${g.Path.grouping}/${g.Path.shelf}/{token}`}],topCharts:[{protocol:g.Protocol.internal,path:`/${g.Path.topCharts}/{genre}/${g.Path.shelf}/{pop}`}],developer:[{protocol:g.Protocol.internal,path:`/${g.Path.developer}/${g.Path.shelf}/{token}`}],reviews:[{protocol:g.Protocol.internal,path:`/${g.Path.reviews}/${g.Path.shelf}/{id}`}],personalizedReviews:[{protocol:g.Protocol.internal,path:`/${g.Path.personalizedReviews}/${g.Path.shelf}/{id}`}],personalizedReviewActions:[{protocol:g.Protocol.internal,path:`/${g.Path.personalizedReviewActions}/${g.Path.shelf}/{id}/{supportUrl}`}],article:[{protocol:g.Protocol.internal,path:`/${g.Path.article}/${g.Path.shelf}/{token}`}],articleScreenshots:[{protocol:g.Protocol.internal,path:`/${g.Path.article}/${g.Path.shelf}/${g.Path.screenshots}/{appPlatform}/{token}`}]}},{"../../data/urls":103}],139:[function(s,l,d){"use strict";function g(k){return k.startsWith("{")&&k.endsWith("}")}function h(k){return k.replace("{","").replace("}","")}function P(k){const _={};return k.forEach((w,E)=>{g(w)&&(_[w]=E)}),_}function S(k){return null===k||void 0===k?null:k}Object.defineProperty(d,"__esModule",{value:!0});const y=s("../data/urls"),A=s("../data/url-util");class T{constructor(k,_){this._protocol=S(k.protocol),this._hostName=k.hostName,k.path?(this._pathComponents=k.path.split("/").filter(w=>0<w.length),this._pathParameterMap=P(this._pathComponents)):(this._pathComponents=null,this._pathParameterMap=null),this._query=k.query,this._hash=k.hash,this._handler=_}matches(k){if(this._protocol&&k.protocol!==this._protocol)return!1;if(this._hostName&&k.host!==this._hostName)return!1;if(this._pathComponents){const _=this._pathComponents,w=k.pathComponents();if(_.length!==w.length)return!1;const E=_.length;for(let C=0;C<E;C++){const F=_[C];if(!g(F)){const R=w[C];if(F!==R)return!1}}}if(this._query)for(const _ of this._query){const w=-1!==_.indexOf("?"),E=_.replace("?","");if(!k.query[E]&&!w)return!1}return this._hash&&k.hash!==this._hash?!1:!0}dispatch(k,_){const w={};if(this._pathComponents){const E=k.pathComponents();for(const C of Object.keys(this._pathParameterMap)){const F=h(C),R=this._pathParameterMap[C];w[F]=decodeURIComponent(E[R])}}if(this._query)for(const E of this._query){const C=E.replace("?","");w[C]=k.query[C]}this._handler(k,w,_)}}d.UrlRoute=T;d.UrlRouter=class{constructor(){this._routes=[],this._unhandled=null}on(k,_){for(const w of k)this._routes.push(new T(w,_))}onUnknown(k){if(this._unknown)throw new Error("Cannot add more than one unknown function to UrlRouter");this._unknown=k}onUnhandled(k){if(this._unhandled)throw new Error("Cannot add more than one unhandled function to UrlRouter");this._unhandled=k}dispatch(k,_){let w="string"==typeof k?new y.URL(k):k;w=A.normalizedAppStoreUrl(w),w=A.normalizedActionUrl(w);for(const E of this._routes)if(E.matches(w))return void E.dispatch(w,_);this._unknown?this._unknown(w,_):this._unhandled&&this._unhandled(w,_)}}},{"../data/url-util":102,"../data/urls":103}],140:[function(s,l,d){"use strict";function h(L){return new Promise((M,N)=>{O.dispatch(L,{resolve:M,reject:N})})}Object.defineProperty(d,"__esModule",{value:!0});const A=s("./routing-components"),T=s("../models"),I=s("../wrappers/store"),k=s("./routes/page-routes"),_=s("./handlers/page-handlers"),w=s("./routes/shelf-routes"),E=s("./handlers/shelf-handlers"),C=s("./routes/pagination-routes"),F=s("./handlers/pagination-handlers"),R=s("../util/count-down-signal"),O=new A.UrlRouter;O.on(k.default.topCharts,_.default.topCharts),O.on(k.default.product,_.default.product),O.on(k.default.reviews,_.default.reviews),O.on(k.default.sortedReviews,_.default.sortedReviews),O.on(k.default.productInAppPurchase,_.default.productInAppPurchase),O.on(k.default.inAppPurchaseInstall,_.default.inAppPurchaseInstall),O.on(k.default.developer,_.default.developer),O.on(k.default.grouping,_.default.grouping),O.on(k.default.article,_.default.article),O.on(k.default.room,_.default.room),O.on(k.default.msoRoom,_.default.msoRoom),O.on(k.default.multiRoom,_.default.multiRoom),O.on(k.default.docTypeLookup,_.default.docTypeLookup),O.on(k.default.resetAndRedirect,_.default.resetAndRedirect),O.on(k.default.staticTestPage,_.default.staticTestPage),O.on(k.default.textAndImagesTestPage,_.default.textAndImagesTestPage),O.on(k.default.lockupTestPage,_.default.lockupTestPage),O.on(k.default.miscTestPage,_.default.miscTestPage),O.on(k.default.action,_.default.actionHandler),O.onUnknown(_.default.unknown);const D=new A.UrlRouter;D.on(w.default.developer,E.default.developer),D.on(w.default.grouping,E.default.grouping),D.on(w.default.product,E.default.product),D.on(w.default.reviews,E.default.reviews),D.on(w.default.personalizedReviews,E.default.personalizedReviews),D.on(w.default.personalizedReviewActions,E.default.personalizedReviewActions),D.on(w.default.article,E.default.article),D.on(w.default.articleScreenshots,E.default.articleScreenshots),D.onUnhandled(E.default.unhandled);const x=new A.UrlRouter;x.on(C.default.room,F.default.room),x.on(C.default.multiRoom,F.default.multiRoom),x.on(C.default.docTypeLookup,F.default.docTypeLookup),x.on(C.default.reviews,F.default.reviews),x.onUnhandled(F.default.unhandled),d.fetchPage=function(L){return h(L).then(M=>{return new Promise((N,U)=>{if(!M)throw new Error(`Promise resolved to null action for: ${L}`);"FlowAction"===M.actionClass?N(M.pageData):U(new Error("Action is not a flowAction and has no Page representation"))})})},d.fetchAction=h,d.fetchMoreOfPage=function(L){return new Promise((M,N)=>{const U=L.url;return U?void x.dispatch(U,{resolve:M,reject:N,pageToken:L}):void N(new Error("Page token missing required `url` property"))})},d.fetchShelf=function(L){return new Promise((M,N)=>{D.dispatch(L,{resolve:M,reject:N})})},d.fetchShelves=function(L){return new Promise((M,N)=>{const U=Object.keys(L),B=new T.ShelfBatch,V=new R.default(U.length);V.then(()=>{const z=0<Object.keys(B.shelves).length;if(z)M(B);else{const j=Object.keys(B.errors).map(H=>B.errors[H].message);0===j.length?N(new Error(`Could not load any shelves: ${JSON.stringify(L)}`)):N(new Error(j.join("\n")))}}),I.coalescingStorePlatformDataFetches(()=>{for(const z of U){const j=L[z];D.dispatch(j,{resolve:G=>{B.shelves[z]=G,V.countDown()},reject:G=>{B.errors[z]=G,V.countDown()}})}})})}},{"../models":121,"../util/count-down-signal":143,"../wrappers/store":155,"./handlers/page-handlers":133,"./handlers/pagination-handlers":134,"./handlers/shelf-handlers":135,"./routes/page-routes":136,"./routes/pagination-routes":137,"./routes/shelf-routes":138,"./routing-components":139}],141:[function(s,l,d){"use strict";function h(R,O,D){const x=new S.FlowAction(D);return x.pageUrl=O.build(),x.pageData=R,x}function P(R){let O=null;switch(R){case"artist_page":case"banner_room_page":case"custom_page":case"grouping_page":case"multi_room_page":case"room_page":O="page";break;case"top_charts_page":case"top_charts_see_all_page":case"segmented_page":O="topCharts";break;case"mac_app_page":case"software_page":O="product";break;case"search_page":O="search";break;case"mso_page":O="mso";break;case"editorial_item_product_page":O="article";break;default:O=null;}return O}Object.defineProperty(d,"__esModule",{value:!0});const S=s("../models"),y=s("../data/server-data"),A=s("../builders/product-pages"),T=s("../builders/top-charts"),I=s("../builders/search"),k=s("../builders/developer"),_=s("../builders/grouping"),w=s("../builders/room"),E=s("../builders/multi-room"),C=s("../builders/mso"),F=s("../builders/article");d.flowActionForServerResponse=function(R,O){return new Promise((D,x)=>{const L=y.asString(R,"pageData.componentName");let M=P(L);null==M&&x(new Error(`Unable to handle response from url: ${O}`));let N;switch(L){case"artist_page":N=k.developerPageFromResponse(R);break;case"top_charts_page":case"top_charts_see_all_page":case"segmented_page":N=T.topChartsPageFromApiResponse(R);break;case"software_page":N=A.productPageFromResponse(R);break;case"search_page":I.resultsFromApiResponse(R,{},null).then(U=>{D(h(U,O,M))});break;case"grouping_page":N=_.groupingPageWithResponse(R),N instanceof S.TodayPage&&(M="today");break;case"room_page":N=w.roomPageWithResponse(R,O);break;case"multi_room_page":N=E.multiRoomPageWithResponse(R);break;case"mso_page":N=C.msoRoomPageWithResponse(R,O,[]);break;case"editorial_item_product_page":N=F.articlePageWithResponse(R);break;default:}N?D(h(N,O,M)):x(new Error(`Unable to generate page model of type ${L} from url: ${O}`))})},d.flowPageForServerComponent=P},{"../builders/article":71,"../builders/developer":73,"../builders/grouping":75,"../builders/mso":77,"../builders/multi-room":78,"../builders/product-pages":83,"../builders/room":86,"../builders/search":87,"../builders/top-charts":97,"../data/server-data":101,"../models":121}],142:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});var g;(function(P){P[P.Apps=36]="Apps",P[P.Games=6014]="Games"})(g=d.GenreIds||(d.GenreIds={}));var h;(function(P){P[P.EditorialItem=59]="EditorialItem",P[P.Software=11]="Software"})(h=d.ContentKinds||(d.ContentKinds={}))},{}],143:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.default=class{constructor(h){this._count=h,this._triggers=[]}countDown(){if(0!==this._count&&(this._count--,0===this._count)){for(const h of this._triggers)h();this._triggers.splice(0)}}then(h){0===this._count?h():this._triggers.push(h)}}},{}],144:[function(s,l,d){"use strict";function h(y){return S.isNull(y)?null:new Date(Date.UTC(y.getFullYear(),y.getMonth(),y.getDate()))}Object.defineProperty(d,"__esModule",{value:!0});const S=s("../data/server-data");d.parseDateOmittingTimeFromString=function(y){return S.isNull(y)?null:(-1!==y.indexOf("T")&&(y=y.split("T")[0]),new Date(y.replace(/-/g,"/")))},d.convertLocalDateToUTCMidnight=h,d.millisecondsToUTCMidnightFromLocalDate=function(y){const A=h(y);return S.isNull(A)?null:A.getTime()}},{"../data/server-data":101}],145:[function(s,l,d){"use strict";function h(q,G){let W=H.string(q);if(!W||W===q){const Y=L.its.loc(q);W=Y===q?G?G:q:Y}return W}function E(q,G){C(q)||(z=q,L.its.updateLocale(G))}function C(q){return z===q}function F(){return"local"}function R(q,G){if(void 0===q||null===q)return null;switch(q=q.toLocaleLowerCase(),q){case"yue-hant":{const W=B.asString("macauStorefrontIdentifier");return"string"==typeof G&&-1!==G.indexOf(W)?"zh-ma":"zh-hk"}default:return q;}}function x(){return"* null *"}Object.defineProperty(d,"__esModule",{value:!0});const L=s("@amp/localization"),M=s("../wrappers/store"),N=s("../wrappers/bag"),U=s("../util/resource"),B=s("../util/properties"),V=s("../wrappers/client");let z=null,j=null;const H="undefined"==typeof ask?function(){return{identifier:"en",decimal(q){return null!==q&&void 0!==q?q+"":null},string(q){return q},stringWithCount(q){return q},stringWithCounts(q){return q},uppercased(q){return q},fileSize(q){return null!==q&&void 0!==q?`${q} bytes`:null},formattedCount(q){return null!==q&&void 0!==q?`${q}`:null},timeAgo(q){return null!==q&&void 0!==q?q.toString():null},formatDate(q,G){return null!==G&&void 0!==G?G.toString():null},relativeDate(q){return null!==q&&void 0!==q?q.toString():null}}}():ask.loc;d.identifier=H.identifier,d.safeIdentifier=d.identifier.split("_")[0],d.string=h,d.stringWithCount=function(q,G,W){let Y=B.enabled("stringWithCount")?H.stringWithCount(q,G):null;if(!Y||Y===q){const K=L.its.locWithCount(q,G,W);K&&(Y=K)}return Y},d.stringWithCounts=function(q,G){return H.stringWithCounts?H.stringWithCounts(q,G):null},d.uppercased=function(q){return q?d.safeIdentifier?q.toLocaleUpperCase(d.safeIdentifier):q:null},d.decimal=function(q,G){let W=null;return W=B.enabled("localizedDecimalPlaces")?H.decimal(q,G):H.decimal(q),W||("number"==typeof q?W=`* ${q.toString()} *`:W=x()),W},d.fileSize=function(q){let G=H.fileSize(q);return G||(G=x()),G},d.formattedCount=function(q){let G=H.formattedCount?H.formattedCount(q):null;return G||(G=x()),G},d.timeAgo=function(q){let G=H.timeAgo(q);return G||(G=x()),G},d.formatDate=function(q,G){let W=H.formatDate(q,G);return W||(W=x()),W},d.relativeDate=function(q){let G=H.relativeDate(q);return G||(G=x()),G},d.normalizedLocale=R,d.loadLocalizations=function(){if(j)return console.log(`Same Promise`),j;if((void 0===N.default.language||null===N.default.language)&&"none"!==F())return new Promise((q,G)=>{G(new Error("Bag language is not available. Unable to load localizations."))});switch(F()){case"local":{const q=R(N.default.language,V.storefrontIdentifier),G=`local/${q}`;if(!C(G)){const W=B.value(`localizations.${q}`);if(W!==void 0&&null!==W)E(G,W);else{const Y=B.value(`localizations.en-us`);Y!==void 0&&null!==Y&&E(G,Y)}}return new Promise(W=>{W()})}case"external":{const q=R(N.default.language,V.storefrontIdentifier),G=`localization/${q}.json`,W=U.url(G).toString();return C(W)?new Promise(Y=>{Y()}):(console.log(`Preload Localizations: ${W}`),j=M.fetchJson(W,{}).then(Y=>{return E(W,Y),j=null,Y},Y=>{throw j=null,Y}),j)}default:return new Promise(q=>{q()});}},d.deviceDisplayName=function(q){if(V.localizedModel)return V.localizedModel;switch(q){case"phone":const G=h("IPHONE_BRAND_NAME");return"IPHONE_BRAND_NAME"===G?"iPhone":G;case"pad":const W=h("IPAD_BRAND_NAME");return"IPAD_BRAND_NAME"===W?"iPad":W;case"tv":const Y=h("APPLE_TV_BRAND_NAME");return"APPLE_TV_BRAND_NAME"===Y?"Apple\xA0TV":Y;case"watch":const K=h("APPLE_WATCH_BRAND_NAME");return"APPLE_WATCH_BRAND_NAME"===K?"Apple\xA0Watch":K;case"mac":const Q=h("MAC_BRAND_NAME");return"MAC_BRAND_NAME"===Q?"Mac":Q;case"unknown":default:return null;}}},{"../util/properties":147,"../util/resource":148,"../wrappers/bag":150,"../wrappers/client":152,"../wrappers/store":155,"@amp/localization":60}],146:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.shallowCopyOf=function(h){if(null===h||void 0===h)return h;const P=Object.create(Object.getPrototypeOf(h));return Object.assign(P,h),P}},{}],147:[function(s,l,d){"use strict";function g(I){return!("undefined"!=typeof ask)||A.traverse(T,I)}Object.defineProperty(d,"__esModule",{value:!0});const A=s("../data/server-data"),T="undefined"==typeof ask?{tvAppEnabledStorefronts:["143441","143455","143460"]}:ask.props;d.value=g,d.enabled=function(I){const k=g(I);return"undefined"==typeof k?!("undefined"!=typeof ask)||!!T.clientFeatures[I]:!!k},d.asString=function(I){return A.asString(T,I)},d.asNumber=function(I){return A.asNumber(T,I)},d.asArray=function(I){return A.asArrayOrEmpty(T,I)}},{"../data/server-data":101}],148:[function(s,l,d){"use strict";function g(A){return S.resources[A]}function P(){return new y.URL("file:///Applications/AppStore.app/Frameworks/AppStoreKit.framework/JavaScript/release")}Object.defineProperty(d,"__esModule",{value:!0});const S=s("../resource-manifest.json"),y=s("../data/urls");d.path=g,d.url=function(A){return P().path(g(A))},d.baseUrl=P},{"../data/urls":103,"../resource-manifest.json":131}],149:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.join=function(h,P){if(null===h||null===P)return null;if(0===h.length)return"";let S=h.length,y="";return h.forEach((A,T)=>{null===A?S-=1:(y+=A,T<S-1&&(y+=P))}),y}},{}],150:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const g="undefined"==typeof ask?{}:ask.bag;d.default=g},{}],151:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const S=s("../util/properties"),y="undefined"!=typeof ask&&"undefined"!=typeof ask.clientOrdering?ask.clientOrdering:function(){return{orderedVisibleIAPs(A,T,I,k,_){const w=[],E=T.findIndex(function(C){return C===k});-1!==E&&w.push(k);for(const C of I)C!==k&&w.push(C);_(w,null)},visibilityForIAPs(A,T){T({},null)}}}();d.orderedVisibleIAPs=function(A,T,I,k){return new Promise((_,w)=>{if(!A||!T||!I)return void w(new Error("Client ordering API invoked with malformed parameters."));const E=T.filter(F=>{return null!==F&&F!==void 0}),C=I.filter(F=>{return null!==F&&F!==void 0});y.orderedVisibleIAPs(A,E,C,k,(F,R)=>{R?w(R):_(F)})})},d.visibilityForIAPs=function(A){return new Promise(T=>{return S.enabled("clientVisibility")?void y.visibilityForIAPs(A,(k,_)=>{_?T({}):T(k)}):void T({})})}},{"../util/properties":147}],152:[function(s,l,d){"use strict";function S(){return-1!==k.indexOf(d.modelIdentifier)}function y(){return-1!==_.indexOf(d.modelIdentifier)}Object.defineProperty(d,"__esModule",{value:!0});const A=s("../models/base"),T=s("../util/properties"),I="undefined"==typeof ask?function(){return{name:"AppStore",deviceType:"unknown",screenSize:{width:0,height:0},guid:"",isOperatingSystemAtLeast(){return!0},deviceHasCapabilities(){return!0},thinnedApplicationVariantIdentifier:null,modelIdentifier:"",localizedModel:"",storefrontIdentifier:"",newPaymentMethodEnabled:!1,deviceCapabilities:[],buildType:"production"}}():ask.client;d.name=I.name,d.deviceType=I.deviceType,d.screenSize=A.Size.fromNativeSize(I.screenSize),d.guid=I.guid,d.thinnedApplicationVariantIdentifier=I.thinnedApplicationVariantIdentifier,d.modelIdentifier=I.modelIdentifier,d.localizedModel=I.localizedModel,d.storefrontIdentifier=I.storefrontIdentifier,d.newPaymentMethodEnabled=I.newPaymentMethodEnabled,d.deviceCapabilities=I.deviceCapabilities,d.buildType=I.buildType||"production",d.isOperatingSystemAtLeast=function(w,E,C){return I.isOperatingSystemAtLeast(w,E,C)},d.deviceHasCapabilities=function(w){if(T.enabled("deviceCapabilitiesPassThrough"))return I.deviceHasCapabilities(w);if(!T.enabled("deviceCapabilities"))return!0;for(const E of w)if("arkit"===E){if(!y())return!1;}else if("nfc"===E){if(!S())return!1;}else if(E&&-1===d.deviceCapabilities.indexOf(E))return!1;return!0};const k=["iPhone9,1","iPhone9,3","iPhone10,1","iPhone10,4","iPhone9,2","iPhone9,4","iPhone10,2","iPhone10,5","iPhone10,3","iPhone10,6"],_=["iPhone8,1","iPhone8,2","iPhone9,1","iPhone9,3","iPhone9,2","iPhone9,4","iPhone8,4","iPad6,7","iPad6,8","iPad6,3","iPad6,4","iPad7,1","iPad7,2","iPad7,3","iPad7,4","iPad6,11","iPad6,12","iPhone10,1","iPhone10,4","iPhone10,2","iPhone10,5","iPhone10,3","iPhone10,6"]},{"../models/base":119,"../util/properties":147}],153:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const P="undefined"!=typeof ask&&"undefined"!=typeof ask.randomSource?ask.randomSource:function(){return{arc4random(){return S?S.arc4random():null},arc4random_uniform(y){return S?S.arc4random_uniform(y):null},sha256(y){return S?S.sha256(y):null},makeUUID(){return S?S.makeUUID():null}}}();let S=null;d.forTesting={stubbingRandomSource:function(y,A){S=y,A(),S=null}},d.arc4random=()=>P.arc4random(),d.arc4randomUniform=y=>P.arc4random_uniform(y),d.sha256=y=>P.sha256(y),d.makeUUID=()=>P.makeUUID()},{}],154:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.recordEvent=function(P,S){ask.storeMetrics.recordEvent(P,S)},d.flushUnrecordedEvents=function(){ask.storeMetrics.flushUnrecordedEvents()}},{}],155:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0});const T=s("../metrics/helpers"),I="undefined"==typeof ask?function(){return{fetchJson(k,_,w){w(null,{},new Error(`Unhandled fetchJson call for ${k} with ${JSON.stringify(_)}`))},fetchPlist(k,_,w){w(null,{},new Error(`Unhandled fetchPlist call for ${k} with ${JSON.stringify(_)}`))},beginStorePlatformDataFetches(){},commitStorePlatformDataFetches(){},fetchStorePlatformData(k,_,w){w(null,null,[],new Error(`Unhandled fetchStorePlatformData call for ${k} with ${JSON.stringify(_)}`))},performPurchase(k,_){_(null,new Error(`Unhandled makePurchase call with ${JSON.stringify(k)}`))}}}():ask.store;d.fetchJson=function(k,_){return new Promise((w,E)=>{I.fetchJson(k,_,(C,F,R)=>{R?E(R):(C&&(C[T.requestedUrl]=k.toString(),F&&(C[T.timingValues]=F)),w(C))})})},d.fetchPlist=function(k,_){return new Promise((w,E)=>{I.fetchPlist(k,_,(C,F,R)=>{R?E(R):(C&&(C[T.requestedUrl]=k.toString(),F&&(C[T.timingValues]=F)),w(C))})})},d.makePurchase=function(k){return new Promise((_,w)=>{I.performPurchase(k,(E,C)=>{C?w(C):E?_(E):w(new Error("Tried to make purchase but have no result and no error."))})})},d.coalescingStorePlatformDataFetches=function(k){try{I.beginStorePlatformDataFetches(),k()}catch(_){throw _}finally{I.commitStorePlatformDataFetches()}},d.fetchStorePlatformData=function(k,_){return new Promise((w,E)=>{const C=k.filter(F=>!!F).map(F=>F+"");I.fetchStorePlatformData(C,_,(F,R,O,D)=>{D?E(D):(F&&O&&(F[T.timingValues]=O),w(F))})})}},{"../metrics/helpers":108}],156:[function(s,l,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.current="undefined"==typeof ask?function(){return{firstName:"Jonny",lastName:"Appleseed",accountIdentifier:"appleseed@apple.com",dsid:"123456",isManagedAppleID:!1}}():ask.user},{}]},{},[65]);